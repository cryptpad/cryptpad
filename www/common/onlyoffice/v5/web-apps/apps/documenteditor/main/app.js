/*!
 * Copyright (C) Ascensio System SIA 2012-2022. All rights reserved
 *
 * https://www.onlyoffice.com/ 
 *
 * Version: 0.0.0 (build:0)
 */
function _extend_object(t,e){return"undefined"!=typeof _?_.extend({},t,e):Object?Object.assign({},t,e):e}function onDropDownKeyDown(t){var e=$(this),i=e.parent(),n=jQuery.Event("keydown.before.bs.dropdown",{keyCode:t.keyCode}),o=jQuery.Event("keydown.after.bs.dropdown",{keyCode:t.keyCode});i.trigger(n),i.hasClass("no-stop-propagate")?(arguments.length>1&&arguments[1]instanceof KeyboardEvent&&(t=arguments[1]),!/^(38|40|27|13|9|37|39)$/.test(t.keyCode)||t.ctrlKey||t.altKey||(patchDropDownKeyDownAdditional.call(this,t),/(37|39)/.test(t.keyCode)||(t.preventDefault(),t.stopPropagation()))):e.hasClass("move-focus")?(!/^(27|13|9|32)/.test(t.keyCode)||t.ctrlKey||t.altKey)&&(patchDropDownKeyDown.call(this,t),t.preventDefault(),t.stopPropagation()):(patchDropDownKeyDown.call(this,t),t.preventDefault(),t.stopPropagation()),i.trigger(o)}function checkFocusedItem(t,e){var i=t.innerHeight(),n=(i-t.height())/2,o=e.position().top,s=e.outerHeight();o<0?t.scrollTop(t.scrollTop()+o-n):o+s>i&&t.scrollTop(t.scrollTop()+o+s-i+n)}function patchDropDownKeyDown(t){if(/(38|40|27|37|39)/.test(t.keyCode)){var e=$(this);if(t.preventDefault(),t.stopPropagation(),!e.is(".disabled, :disabled")){var i=getParent(e),n=i.hasClass("open")||i.hasClass("over");if(!n||n&&27==t.keyCode){if(27==t.which){if(o=$("[role=menu] li.dropdown-submenu.over:visible",i),o.length)return o.eq(o.length-1).removeClass("over"),!1;i.hasClass("dropdown-submenu")&&i.hasClass("over")?(i.removeClass("over"),i.find("> a").focus()):i.find("[data-toggle=dropdown]").focus()}return n?e.click():void 0}var o=$("> [role=menu] > li:not(.divider):not(.disabled):visible",i).find("> a");if(o.length){var s=o.index(o.filter(":focus"));if(39==t.keyCode){if(s<0)return;var a=o.eq(s).parent();a.hasClass("dropdown-submenu")&&!a.hasClass("over")&&(a.mouseenter(),a.addClass("focused-submenu"),_.delay(function(){var t=$("> [role=menu]",a),e=t.find("> li:not(.divider):not(.disabled):visible > a"),i=t.find("> li:not(.divider):not(.disabled):visible .dataview"),n=t.find("> li:not(.divider):not(.disabled):visible ul.internal-menu");e.length>0&&i.length<1&&n.length<1&&e.index(e.filter(":focus"))<0&&e.eq(0).focus()},250))}else 37==t.keyCode?i.hasClass("dropdown-submenu")&&i.hasClass("over")&&(i.removeClass("over"),i.find("> a").focus()):(38==t.keyCode?s>0?s--:s=e.hasClass("no-cyclic")?0:o.length-1:40==t.keyCode&&(s<o.length-1?s++:s=e.hasClass("no-cyclic")?o.length-1:0),~s||(s=0),i.hasClass("dropdown-submenu")&&i.hasClass("over")&&i.addClass("focused-submenu"),checkFocusedItem(e,o.eq(s)),o.eq(s).focus())}}}}function patchDropDownKeyDownAdditional(t){if(/(38|40|27|37|39)/.test(t.keyCode)){var e=$(this);if(/(37|39)/.test(t.keyCode)||(t.preventDefault(),t.stopPropagation()),!e.is(".disabled, :disabled")){var i=getParent(e),n=i.hasClass("open")||i.hasClass("over");if(!n||n&&(27==t.keyCode||37==t.keyCode||39==t.keyCode))return n?e.click():void 0;var o=$("> [role=menu] > li:not(.divider):not(.disabled):visible",i).find("> a");if(o.length){var s=o.index(o.filter(".focus")),a=s;if(38==t.keyCode?s>0?s--:s=e.hasClass("no-cyclic")?0:o.length-1:40==t.keyCode&&(s<o.length-1?s++:s=e.hasClass("no-cyclic")?o.length-1:0),~s||(s=0),o.removeClass("focus"),o.eq(s).addClass("focus"),a!==s){var r=o.eq(a).parent().data("bs.tooltip");r&&r.hide(),r=o.eq(s).parent().data("bs.tooltip"),r&&r.show()}}}}}function getParent(t){var e=t.attr("data-target");e||(e=t.attr("href"),e=e&&/#/.test(e)&&e.replace(/.*(?=#[^\s]*$)/,""));var i=e&&$(e);return i&&i.length?i:t.parent()}function clearMenus(t){$(".dropdown-toggle").each(function(e){var i=$(this).parent();if(i.hasClass("open")){if("prevent-canvas-click"==i.attr("data-value"))return void i.attr("data-value","");i.trigger(e=$.Event("hide.bs.dropdown")),e.isDefaultPrevented()||i.removeClass("open").trigger("hidden.bs.dropdown",t)}})}function toggle(){$(".dropdown-backdrop").remove()}if(function(){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this||{},e=t._,i=Array.prototype,n=Object.prototype,o="undefined"!=typeof Symbol?Symbol.prototype:null,s=i.push,a=i.slice,r=n.toString,l=n.hasOwnProperty,c=Array.isArray,d=Object.keys,h=Object.create,p=function(){},m=function(t){return t instanceof m?t:this instanceof m?void(this._wrapped=t):new m(t)};"undefined"==typeof exports||exports.nodeType?t._=m:("undefined"!=typeof module&&!module.nodeType&&module.exports&&(exports=module.exports=m),exports._=m),m.VERSION="1.8.3";var u,g=function(t,e,i){if(void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case null:case 3:return function(i,n,o){return t.call(e,i,n,o)};case 4:return function(i,n,o,s){return t.call(e,i,n,o,s)}}return function(){return t.apply(e,arguments)}},b=function(t,e,i){return m.iteratee!==u?m.iteratee(t,e):null==t?m.identity:m.isFunction(t)?g(t,e,i):m.isObject(t)&&!m.isArray(t)?m.matcher(t):m.property(t)};m.iteratee=u=function(t,e){return b(t,e,1/0)};var f=function(t,e){return e=null==e?t.length-1:+e,function(){for(var i=Math.max(arguments.length-e,0),n=Array(i),o=0;o<i;o++)n[o]=arguments[o+e];switch(e){case 0:return t.call(this,n);case 1:return t.call(this,arguments[0],n);case 2:return t.call(this,arguments[0],arguments[1],n)}var s=Array(e+1);for(o=0;o<e;o++)s[o]=arguments[o];return s[e]=n,t.apply(this,s)}},C=function(t){if(!m.isObject(t))return{};if(h)return h(t);p.prototype=t;var e=new p;return p.prototype=null,e},v=function(t){return function(e){return null==e?void 0:e[t]}},_=function(t,e){for(var i=e.length,n=0;n<i;n++){if(null==t)return;t=t[e[n]]}return i?t:void 0},y=Math.pow(2,53)-1,x=v("length"),w=function(t){var e=x(t);return"number"==typeof e&&e>=0&&e<=y};m.each=m.forEach=function(t,e,i){e=g(e,i);var n,o;if(w(t))for(n=0,o=t.length;n<o;n++)e(t[n],n,t);else{var s=m.keys(t);for(n=0,o=s.length;n<o;n++)e(t[s[n]],s[n],t)}return t},m.map=m.collect=function(t,e,i){e=b(e,i);for(var n=!w(t)&&m.keys(t),o=(n||t).length,s=Array(o),a=0;a<o;a++){var r=n?n[a]:a;s[a]=e(t[r],r,t)}return s};var S=function(t){var e=function(e,i,n,o){var s=!w(e)&&m.keys(e),a=(s||e).length,r=t>0?0:a-1;for(o||(n=e[s?s[r]:r],r+=t);r>=0&&r<a;r+=t){var l=s?s[r]:r;n=i(n,e[l],l,e)}return n};return function(t,i,n,o){var s=arguments.length>=3;return e(t,g(i,o,4),n,s)}};m.reduce=m.foldl=m.inject=S(1),m.reduceRight=m.foldr=S(-1),m.find=m.detect=function(t,e,i){var n=w(t)?m.findIndex:m.findKey,o=n(t,e,i);if(void 0!==o&&-1!==o)return t[o]},m.filter=m.select=function(t,e,i){var n=[];return e=b(e,i),m.each(t,function(t,i,o){e(t,i,o)&&n.push(t)}),n},m.reject=function(t,e,i){return m.filter(t,m.negate(b(e)),i)},m.every=m.all=function(t,e,i){e=b(e,i);for(var n=!w(t)&&m.keys(t),o=(n||t).length,s=0;s<o;s++){var a=n?n[s]:s;if(!e(t[a],a,t))return!1}return!0},m.some=m.any=function(t,e,i){e=b(e,i);for(var n=!w(t)&&m.keys(t),o=(n||t).length,s=0;s<o;s++){var a=n?n[s]:s;if(e(t[a],a,t))return!0}return!1},m.contains=m.includes=m.include=function(t,e,i,n){return w(t)||(t=m.values(t)),("number"!=typeof i||n)&&(i=0),m.indexOf(t,e,i)>=0},m.invoke=f(function(t,e,i){var n,o;return m.isFunction(e)?o=e:m.isArray(e)&&(n=e.slice(0,-1),e=e[e.length-1]),m.map(t,function(t){var s=o;if(!s){if(n&&n.length&&(t=_(t,n)),null==t)return;s=t[e]}return null==s?s:s.apply(t,i)})}),m.pluck=function(t,e){return m.map(t,m.property(e))},m.where=function(t,e){return m.filter(t,m.matcher(e))},m.findWhere=function(t,e){return m.find(t,m.matcher(e))},m.max=function(t,e,i){var n,o,s=-1/0,a=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t){t=w(t)?t:m.values(t);for(var r=0,l=t.length;r<l;r++)null!=(n=t[r])&&n>s&&(s=n)}else e=b(e,i),m.each(t,function(t,i,n){((o=e(t,i,n))>a||o===-1/0&&s===-1/0)&&(s=t,a=o)});return s},m.min=function(t,e,i){var n,o,s=1/0,a=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t){t=w(t)?t:m.values(t);for(var r=0,l=t.length;r<l;r++)null!=(n=t[r])&&n<s&&(s=n)}else e=b(e,i),m.each(t,function(t,i,n){((o=e(t,i,n))<a||o===1/0&&s===1/0)&&(s=t,a=o)});return s},m.shuffle=function(t){return m.sample(t,1/0)},m.sample=function(t,e,i){if(null==e||i)return w(t)||(t=m.values(t)),t[m.random(t.length-1)];var n=w(t)?m.clone(t):m.values(t),o=x(n);e=Math.max(Math.min(e,o),0);for(var s=o-1,a=0;a<e;a++){var r=m.random(a,s),l=n[a];n[a]=n[r],n[r]=l}return n.slice(0,e)},m.sortBy=function(t,e,i){var n=0;return e=b(e,i),m.pluck(m.map(t,function(t,i,o){return{value:t,index:n++,criteria:e(t,i,o)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return t.index-e.index}),"value")};var A=function(t,e){return function(i,n,o){var s=e?[[],[]]:{};return n=b(n,o),m.each(i,function(e,o){var a=n(e,o,i);t(s,e,a)}),s}};m.groupBy=A(function(t,e,i){m.has(t,i)?t[i].push(e):t[i]=[e]}),m.indexBy=A(function(t,e,i){t[i]=e}),m.countBy=A(function(t,e,i){m.has(t,i)?t[i]++:t[i]=1});var k=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;m.toArray=function(t){return t?m.isArray(t)?a.call(t):m.isString(t)?t.match(k):w(t)?m.map(t,m.identity):m.values(t):[]},m.size=function(t){return null==t?0:w(t)?t.length:m.keys(t).length},m.partition=A(function(t,e,i){t[i?0:1].push(e)},!0),m.first=m.head=m.take=function(t,e,i){if(!(null==t||t.length<1))return null==e||i?t[0]:m.initial(t,t.length-e)},m.initial=function(t,e,i){return a.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))},m.last=function(t,e,i){if(!(null==t||t.length<1))return null==e||i?t[t.length-1]:m.rest(t,Math.max(0,t.length-e))},m.rest=m.tail=m.drop=function(t,e,i){return a.call(t,null==e||i?1:e)},m.compact=function(t){return m.filter(t,Boolean)};var T=function(t,e,i,n){n=n||[];for(var o=n.length,s=0,a=x(t);s<a;s++){var r=t[s];if(w(r)&&(m.isArray(r)||m.isArguments(r)))if(e)for(var l=0,c=r.length;l<c;)n[o++]=r[l++];else T(r,e,i,n),o=n.length;else i||(n[o++]=r)}return n};m.flatten=function(t,e){return T(t,e,!1)},m.without=f(function(t,e){return m.difference(t,e)}),m.uniq=m.unique=function(t,e,i,n){m.isBoolean(e)||(n=i,i=e,e=!1),null!=i&&(i=b(i,n));for(var o=[],s=[],a=0,r=x(t);a<r;a++){var l=t[a],c=i?i(l,a,t):l;e?(a&&s===c||o.push(l),s=c):i?m.contains(s,c)||(s.push(c),o.push(l)):m.contains(o,l)||o.push(l)}return o},m.union=f(function(t){return m.uniq(T(t,!0,!0))}),m.intersection=function(t){for(var e=[],i=arguments.length,n=0,o=x(t);n<o;n++){var s=t[n];if(!m.contains(e,s)){var a;for(a=1;a<i&&m.contains(arguments[a],s);a++);a===i&&e.push(s)}}return e},m.difference=f(function(t,e){return e=T(e,!0,!0),m.filter(t,function(t){return!m.contains(e,t)})}),m.unzip=function(t){for(var e=t&&m.max(t,x).length||0,i=Array(e),n=0;n<e;n++)i[n]=m.pluck(t,n);return i},m.zip=f(m.unzip),m.object=function(t,e){for(var i={},n=0,o=x(t);n<o;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i};var I=function(t){return function(e,i,n){i=b(i,n);for(var o=x(e),s=t>0?0:o-1;s>=0&&s<o;s+=t)if(i(e[s],s,e))return s;return-1}};m.findIndex=I(1),m.findLastIndex=I(-1),m.sortedIndex=function(t,e,i,n){i=b(i,n,1);for(var o=i(e),s=0,a=x(t);s<a;){var r=Math.floor((s+a)/2);i(t[r])<o?s=r+1:a=r}return s};var P=function(t,e,i){return function(n,o,s){var r=0,l=x(n);if("number"==typeof s)t>0?r=s>=0?s:Math.max(s+l,r):l=s>=0?Math.min(s+1,l):s+l+1;else if(i&&s&&l)return s=i(n,o),n[s]===o?s:-1;if(o!==o)return s=e(a.call(n,r,l),m.isNaN),s>=0?s+r:-1;for(s=t>0?r:l-1;s>=0&&s<l;s+=t)if(n[s]===o)return s;return-1}};m.indexOf=P(1,m.findIndex,m.sortedIndex),m.lastIndexOf=P(-1,m.findLastIndex),m.range=function(t,e,i){null==e&&(e=t||0,t=0),i||(i=e<t?-1:1);for(var n=Math.max(Math.ceil((e-t)/i),0),o=Array(n),s=0;s<n;s++,t+=i)o[s]=t;return o},m.chunk=function(t,e){if(null==e||e<1)return[];for(var i=[],n=0,o=t.length;n<o;)i.push(a.call(t,n,n+=e));return i};var M=function(t,e,i,n,o){if(!(n instanceof e))return t.apply(i,o);var s=C(t.prototype),a=t.apply(s,o);return m.isObject(a)?a:s};m.bind=f(function(t,e,i){if(!m.isFunction(t))throw new TypeError("Bind must be called on a function");var n=f(function(o){return M(t,n,e,this,i.concat(o))});return n}),m.partial=f(function(t,e){var i=m.partial.placeholder,n=function(){for(var o=0,s=e.length,a=Array(s),r=0;r<s;r++)a[r]=e[r]===i?arguments[o++]:e[r];for(;o<arguments.length;)a.push(arguments[o++]);return M(t,n,this,this,a)};return n}),m.partial.placeholder=m,m.bindAll=f(function(t,e){e=T(e,!1,!1);var i=e.length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var n=e[i];t[n]=m.bind(t[n],t)}}),m.memoize=function(t,e){var i=function(n){var o=i.cache,s=""+(e?e.apply(this,arguments):n);return m.has(o,s)||(o[s]=t.apply(this,arguments)),o[s]};return i.cache={},i},m.delay=f(function(t,e,i){return setTimeout(function(){return t.apply(null,i)},e)}),m.defer=m.partial(m.delay,m,1),m.throttle=function(t,e,i){var n,o,s,a,r=0;i||(i={});var l=function(){r=!1===i.leading?0:m.now(),n=null,a=t.apply(o,s),n||(o=s=null)},c=function(){var c=m.now();r||!1!==i.leading||(r=c);var d=e-(c-r);return o=this,s=arguments,d<=0||d>e?(n&&(clearTimeout(n),n=null),r=c,a=t.apply(o,s),n||(o=s=null)):n||!1===i.trailing||(n=setTimeout(l,d)),a};return c.cancel=function(){clearTimeout(n),r=0,n=o=s=null},c},m.debounce=function(t,e,i){var n,o,s=function(e,i){n=null,i&&(o=t.apply(e,i))},a=f(function(a){if(n&&clearTimeout(n),i){var r=!n;n=setTimeout(s,e),r&&(o=t.apply(this,a))}else n=m.delay(s,e,this,a);return o});return a.cancel=function(){clearTimeout(n),n=null},a},m.wrap=function(t,e){return m.partial(e,t)},m.negate=function(t){return function(){return!t.apply(this,arguments)}},m.compose=function(){var t=arguments,e=t.length-1;return function(){for(var i=e,n=t[e].apply(this,arguments);i--;)n=t[i].call(this,n);return n}},m.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},m.before=function(t,e){var i;return function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=null),i}},m.once=m.partial(m.before,2),m.restArgs=f;var U=!{toString:null}.propertyIsEnumerable("toString"),B=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],D=function(t,e){var i=B.length,o=t.constructor,s=m.isFunction(o)&&o.prototype||n,a="constructor";for(m.has(t,a)&&!m.contains(e,a)&&e.push(a);i--;)(a=B[i])in t&&t[a]!==s[a]&&!m.contains(e,a)&&e.push(a)};m.keys=function(t){if(!m.isObject(t))return[];if(d)return d(t);var e=[];for(var i in t)m.has(t,i)&&e.push(i);return U&&D(t,e),e},m.allKeys=function(t){if(!m.isObject(t))return[];var e=[];for(var i in t)e.push(i);return U&&D(t,e),e},m.values=function(t){for(var e=m.keys(t),i=e.length,n=Array(i),o=0;o<i;o++)n[o]=t[e[o]];return n},m.mapObject=function(t,e,i){e=b(e,i);for(var n=m.keys(t),o=n.length,s={},a=0;a<o;a++){var r=n[a];s[r]=e(t[r],r,t)}return s},m.pairs=function(t){for(var e=m.keys(t),i=e.length,n=Array(i),o=0;o<i;o++)n[o]=[e[o],t[e[o]]];return n},m.invert=function(t){for(var e={},i=m.keys(t),n=0,o=i.length;n<o;n++)e[t[i[n]]]=i[n];return e},m.functions=m.methods=function(t){var e=[];for(var i in t)m.isFunction(t[i])&&e.push(i);return e.sort()};var E=function(t,e){return function(i){var n=arguments.length;if(e&&(i=Object(i)),n<2||null==i)return i;for(var o=1;o<n;o++)for(var s=arguments[o],a=t(s),r=a.length,l=0;l<r;l++){var c=a[l];e&&void 0!==i[c]||(i[c]=s[c])}return i}};m.extend=E(m.allKeys),m.extendOwn=m.assign=E(m.keys),m.findKey=function(t,e,i){e=b(e,i);for(var n,o=m.keys(t),s=0,a=o.length;s<a;s++)if(n=o[s],e(t[n],n,t))return n};var V=function(t,e,i){return e in i};m.pick=f(function(t,e){var i={},n=e[0];if(null==t)return i;m.isFunction(n)?(e.length>1&&(n=g(n,e[1])),e=m.allKeys(t)):(n=V,e=T(e,!1,!1),t=Object(t));for(var o=0,s=e.length;o<s;o++){var a=e[o],r=t[a];n(r,a,t)&&(i[a]=r)}return i}),m.omit=f(function(t,e){var i,n=e[0];return m.isFunction(n)?(n=m.negate(n),e.length>1&&(i=e[1])):(e=m.map(T(e,!1,!1),String),n=function(t,i){return!m.contains(e,i)}),m.pick(t,n,i)}),m.defaults=E(m.allKeys,!0),m.create=function(t,e){var i=C(t);return e&&m.extendOwn(i,e),i},m.clone=function(t){return m.isObject(t)?m.isArray(t)?t.slice():m.extend({},t):t},m.tap=function(t,e){return e(t),t},m.isMatch=function(t,e){var i=m.keys(e),n=i.length;if(null==t)return!n;for(var o=Object(t),s=0;s<n;s++){var a=i[s];if(e[a]!==o[a]||!(a in o))return!1}return!0};var F,R;F=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!==t)return e!==e;var o=typeof t;return("function"===o||"object"===o||"object"==typeof e)&&R(t,e,i,n)},R=function(t,e,i,n){t instanceof m&&(t=t._wrapped),e instanceof m&&(e=e._wrapped);var s=r.call(t);if(s!==r.call(e))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return o.valueOf.call(t)===o.valueOf.call(e)}var a="[object Array]"===s;if(!a){if("object"!=typeof t||"object"!=typeof e)return!1;var l=t.constructor,c=e.constructor;if(l!==c&&!(m.isFunction(l)&&l instanceof l&&m.isFunction(c)&&c instanceof c)&&"constructor"in t&&"constructor"in e)return!1}i=i||[],n=n||[];for(var d=i.length;d--;)if(i[d]===t)return n[d]===e;if(i.push(t),n.push(e),a){if((d=t.length)!==e.length)return!1;for(;d--;)if(!F(t[d],e[d],i,n))return!1}else{var h,p=m.keys(t);if(d=p.length,m.keys(e).length!==d)return!1;for(;d--;)if(h=p[d],!m.has(e,h)||!F(t[h],e[h],i,n))return!1}return i.pop(),n.pop(),!0},m.isEqual=function(t,e){return F(t,e)},m.isEmpty=function(t){return null==t||(w(t)&&(m.isArray(t)||m.isString(t)||m.isArguments(t))?0===t.length:0===m.keys(t).length)},m.isElement=function(t){return!(!t||1!==t.nodeType)},m.isArray=c||function(t){return"[object Array]"===r.call(t)},m.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},m.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(t){m["is"+t]=function(e){return r.call(e)==="[object "+t+"]"}}),m.isArguments(arguments)||(m.isArguments=function(t){return m.has(t,"callee")});var L=t.document&&t.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof L&&(m.isFunction=function(t){return"function"==typeof t||!1}),m.isFinite=function(t){return!m.isSymbol(t)&&isFinite(t)&&!isNaN(parseFloat(t))},m.isNaN=function(t){return m.isNumber(t)&&isNaN(t)},m.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===r.call(t)},m.isNull=function(t){return null===t},m.isUndefined=function(t){return void 0===t},m.has=function(t,e){if(!m.isArray(e))return null!=t&&l.call(t,e);for(var i=e.length,n=0;n<i;n++){var o=e[n];if(null==t||!l.call(t,o))return!1;t=t[o]}return!!i},m.noConflict=function(){return t._=e,this},m.identity=function(t){return t},m.constant=function(t){return function(){return t}},m.noop=function(){},m.property=function(t){return m.isArray(t)?function(e){return _(e,t)}:v(t)},m.propertyOf=function(t){return null==t?function(){}:function(e){return m.isArray(e)?_(t,e):t[e]}},m.matcher=m.matches=function(t){return t=m.extendOwn({},t),function(e){return m.isMatch(e,t)}},m.times=function(t,e,i){var n=Array(Math.max(0,t));e=g(e,i,1);for(var o=0;o<t;o++)n[o]=e(o);return n},m.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},m.now=Date.now||function(){return(new Date).getTime()};var N={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},O=m.invert(N),H=function(t){var e=function(e){return t[e]},i="(?:"+m.keys(t).join("|")+")",n=RegExp(i),o=RegExp(i,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(o,e):t}};m.escape=H(N),m.unescape=H(O),m.result=function(t,e,i){m.isArray(e)||(e=[e]);var n=e.length;if(!n)return m.isFunction(i)?i.call(t):i;for(var o=0;o<n;o++){var s=null==t?void 0:t[e[o]];void 0===s&&(s=i,o=n),t=m.isFunction(s)?s.call(t):s}return t};var z=0;m.uniqueId=function(t){var e=++z+"";return t?t+e:e},m.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var $=/(.)^/,G={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},W=/\\|'|\r|\n|\u2028|\u2029/g,j=function(t){return"\\"+G[t]};m.template=function(t,e,i){!e&&i&&(e=i),e=m.defaults({},e,m.templateSettings);var n=RegExp([(e.escape||$).source,(e.interpolate||$).source,(e.evaluate||$).source].join("|")+"|$","g"),o=0,s="__p+='";t.replace(n,function(e,i,n,a,r){return s+=t.slice(o,r).replace(W,j),o=r+e.length,i?s+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?s+="'+\n((__t=("+n+"))==null?'':__t)+\n'":a&&(s+="';\n"+a+"\n__p+='"),e}),s+="';\n",e.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";var a;try{a=new Function(e.variable||"obj","_",s)}catch(t){throw t.source=s,t}var r=function(t){return a.call(this,t,m)};return r.source="function("+(e.variable||"obj")+"){\n"+s+"}",r},m.chain=function(t){var e=m(t);return e._chain=!0,e};var q=function(t,e){return t._chain?m(e).chain():e};m.mixin=function(t){return m.each(m.functions(t),function(e){var i=m[e]=t[e];m.prototype[e]=function(){var t=[this._wrapped];return s.apply(t,arguments),q(this,i.apply(m,t))}}),m},m.mixin(m),m.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=i[t];m.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!==t&&"splice"!==t||0!==i.length||delete i[0],q(this,i)}}),m.each(["concat","join","slice"],function(t){var e=i[t];m.prototype[t]=function(){return q(this,e.apply(this._wrapped,arguments))}}),m.prototype.value=function(){return this._wrapped},m.prototype.valueOf=m.prototype.toJSON=m.prototype.value,m.prototype.toString=function(){return String(this._wrapped)},"function"==typeof define&&define.amd&&define("underscore",[],function(){return m})}(),function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){"use strict";function i(t,e,i){i=i||yt;var n,o,s=i.createElement("script");if(s.text=t,e)for(n in xt)(o=e[n]||e.getAttribute&&e.getAttribute(n))&&s.setAttribute(n,o);i.head.appendChild(s).parentNode.removeChild(s)}function n(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?mt[ut.call(t)]||"object":typeof t}function o(t){var e=!!t&&"length"in t&&t.length,i=n(t);return!vt(t)&&!_t(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}function s(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}function a(t,e,i){return vt(e)?wt.grep(t,function(t,n){return!!e.call(t,n,t)!==i}):e.nodeType?wt.grep(t,function(t){return t===e!==i}):"string"!=typeof e?wt.grep(t,function(t){return pt.call(e,t)>-1!==i}):wt.filter(e,t,i)}function r(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function l(t){var e={};return wt.each(t.match(Dt)||[],function(t,i){e[i]=!0}),e}function c(t){return t}function d(t){throw t}function h(t,e,i,n){var o;try{t&&vt(o=t.promise)?o.call(t).done(e).fail(i):t&&vt(o=t.then)?o.call(t,e,i):e.apply(void 0,[t].slice(n))}catch(t){i.apply(void 0,[t])}}function p(){yt.removeEventListener("DOMContentLoaded",p),t.removeEventListener("load",p),wt.ready()}function m(t,e){return e.toUpperCase()}function u(t){return t.replace(Rt,"ms-").replace(Lt,m)}function g(){this.expando=wt.expando+g.uid++}function b(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:zt.test(t)?JSON.parse(t):t)}function f(t,e,i){var n;if(void 0===i&&1===t.nodeType)if(n="data-"+e.replace($t,"-$&").toLowerCase(),"string"==typeof(i=t.getAttribute(n))){try{i=b(i)}catch(t){}Ht.set(t,e,i)}else i=void 0;return i}function C(t,e,i,n){var o,s,a=20,r=n?function(){return n.cur()}:function(){return wt.css(t,e,"")},l=r(),c=i&&i[3]||(wt.cssNumber[e]?"":"px"),d=t.nodeType&&(wt.cssNumber[e]||"px"!==c&&+l)&&Wt.exec(wt.css(t,e));if(d&&d[3]!==c){for(l/=2,c=c||d[3],d=+l||1;a--;)wt.style(t,e,d+c),(1-s)*(1-(s=r()/l||.5))<=0&&(a=0),d/=s;d*=2,wt.style(t,e,d+c),i=i||[]}return i&&(d=+d||+l||0,o=i[1]?d+(i[1]+1)*i[2]:+i[2],n&&(n.unit=c,n.start=d,n.end=o)),o}function v(t){var e,i=t.ownerDocument,n=t.nodeName,o=Jt[n];return o||(e=i.body.appendChild(i.createElement(n)),o=wt.css(e,"display"),e.parentNode.removeChild(e),"none"===o&&(o="block"),Jt[n]=o,o)}function _(t,e){for(var i,n,o=[],s=0,a=t.length;s<a;s++)n=t[s],n.style&&(i=n.style.display,e?("none"===i&&(o[s]=Ot.get(n,"display")||null,o[s]||(n.style.display="")),""===n.style.display&&Xt(n)&&(o[s]=v(n))):"none"!==i&&(o[s]="none",Ot.set(n,"display",i)));for(s=0;s<a;s++)null!=o[s]&&(t[s].style.display=o[s]);return t}function y(t,e){var i;return i=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&s(t,e)?wt.merge([t],i):i}function x(t,e){for(var i=0,n=t.length;i<n;i++)Ot.set(t[i],"globalEval",!e||Ot.get(e[i],"globalEval"))}function w(t,e,i,o,s){for(var a,r,l,c,d,h,p=e.createDocumentFragment(),m=[],u=0,g=t.length;u<g;u++)if((a=t[u])||0===a)if("object"===n(a))wt.merge(m,a.nodeType?[a]:a);else if(ie.test(a)){for(r=r||p.appendChild(e.createElement("div")),l=(Qt.exec(a)||["",""])[1].toLowerCase(),c=ee[l]||ee._default,r.innerHTML=c[1]+wt.htmlPrefilter(a)+c[2],h=c[0];h--;)r=r.lastChild;wt.merge(m,r.childNodes),r=p.firstChild,r.textContent=""}else m.push(e.createTextNode(a));for(p.textContent="",u=0;a=m[u++];)if(o&&wt.inArray(a,o)>-1)s&&s.push(a);else if(d=Kt(a),r=y(p.appendChild(a),"script"),d&&x(r),i)for(h=0;a=r[h++];)te.test(a.type||"")&&i.push(a);return p}function S(){return!0}function A(){return!1}function k(t,e){return t===T()==("focus"===e)}function T(){try{return yt.activeElement}catch(t){}}function I(t,e,i,n,o,s){var a,r;if("object"==typeof e){"string"!=typeof i&&(n=n||i,i=void 0);for(r in e)I(t,r,i,n,e[r],s);return t}if(null==n&&null==o?(o=i,n=i=void 0):null==o&&("string"==typeof i?(o=n,n=void 0):(o=n,n=i,i=void 0)),!1===o)o=A;else if(!o)return t;return 1===s&&(a=o,o=function(t){return wt().off(t),a.apply(this,arguments)},o.guid=a.guid||(a.guid=wt.guid++)),t.each(function(){wt.event.add(this,e,o,n,i)})}function P(t,e,i){if(!i)return void(void 0===Ot.get(t,e)&&wt.event.add(t,e,S));Ot.set(t,e,!1),wt.event.add(t,e,{namespace:!1,handler:function(t){var n,o,s=Ot.get(this,e);if(1&t.isTrigger&&this[e]){if(s.length)(wt.event.special[e]||{}).delegateType&&t.stopPropagation();else if(s=ct.call(arguments),Ot.set(this,e,s),n=i(this,e),this[e](),o=Ot.get(this,e),s!==o||n?Ot.set(this,e,!1):o={},s!==o)return t.stopImmediatePropagation(),t.preventDefault(),o.value}else s.length&&(Ot.set(this,e,{value:wt.event.trigger(wt.extend(s[0],wt.Event.prototype),s.slice(1),this)}),t.stopImmediatePropagation())}})}function M(t,e){return s(t,"table")&&s(11!==e.nodeType?e:e.firstChild,"tr")?wt(t).children("tbody")[0]||t:t}function U(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function B(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function D(t,e){var i,n,o,s,a,r,l;if(1===e.nodeType){if(Ot.hasData(t)&&(s=Ot.get(t),l=s.events)){Ot.remove(e,"handle events");for(o in l)for(i=0,n=l[o].length;i<n;i++)wt.event.add(e,o,l[o][i])}Ht.hasData(t)&&(a=Ht.access(t),r=wt.extend({},a),Ht.set(e,r))}}function E(t,e){var i=e.nodeName.toLowerCase();"input"===i&&Zt.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}function V(t,e,n,o){e=dt(e);var s,a,r,l,c,d,h=0,p=t.length,m=p-1,u=e[0],g=vt(u);if(g||p>1&&"string"==typeof u&&!Ct.checkClone&&re.test(u))return t.each(function(i){var s=t.eq(i);g&&(e[0]=u.call(this,i,s.html())),V(s,e,n,o)});if(p&&(s=w(e,t[0].ownerDocument,!1,t,o),a=s.firstChild,1===s.childNodes.length&&(s=a),a||o)){for(r=wt.map(y(s,"script"),U),l=r.length;h<p;h++)c=s,h!==m&&(c=wt.clone(c,!0,!0),l&&wt.merge(r,y(c,"script"))),n.call(t[h],c,h);if(l)for(d=r[r.length-1].ownerDocument,wt.map(r,B),h=0;h<l;h++)c=r[h],te.test(c.type||"")&&!Ot.access(c,"globalEval")&&wt.contains(d,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?wt._evalUrl&&!c.noModule&&wt._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},d):i(c.textContent.replace(le,""),c,d))}return t}function F(t,e,i){for(var n,o=e?wt.filter(e,t):t,s=0;null!=(n=o[s]);s++)i||1!==n.nodeType||wt.cleanData(y(n)),n.parentNode&&(i&&Kt(n)&&x(y(n,"script")),n.parentNode.removeChild(n));return t}function R(t,e,i){var n,o,s,a,r=t.style;return i=i||de(t),i&&(a=i.getPropertyValue(e)||i[e],""!==a||Kt(t)||(a=wt.style(t,e)),!Ct.pixelBoxStyles()&&ce.test(a)&&pe.test(e)&&(n=r.width,o=r.minWidth,s=r.maxWidth,r.minWidth=r.maxWidth=r.width=a,a=i.width,r.width=n,r.minWidth=o,r.maxWidth=s)),void 0!==a?a+"":a}function L(t,e){return{get:function(){return t()?void delete this.get:(this.get=e).apply(this,arguments)}}}function N(t){for(var e=t[0].toUpperCase()+t.slice(1),i=me.length;i--;)if((t=me[i]+e)in ue)return t}function O(t){var e=wt.cssProps[t]||ge[t];return e||(t in ue?t:ge[t]=N(t)||t)}function H(t,e,i){var n=Wt.exec(e);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):e}function z(t,e,i,n,o,s){var a="width"===e?1:0,r=0,l=0;if(i===(n?"border":"content"))return 0;for(;a<4;a+=2)"margin"===i&&(l+=wt.css(t,i+jt[a],!0,o)),n?("content"===i&&(l-=wt.css(t,"padding"+jt[a],!0,o)),"margin"!==i&&(l-=wt.css(t,"border"+jt[a]+"Width",!0,o))):(l+=wt.css(t,"padding"+jt[a],!0,o),"padding"!==i?l+=wt.css(t,"border"+jt[a]+"Width",!0,o):r+=wt.css(t,"border"+jt[a]+"Width",!0,o));return!n&&s>=0&&(l+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-s-l-r-.5))||0),l}function $(t,e,i){var n=de(t),o=!Ct.boxSizingReliable()||i,a=o&&"border-box"===wt.css(t,"boxSizing",!1,n),r=a,l=R(t,e,n),c="offset"+e[0].toUpperCase()+e.slice(1);if(ce.test(l)){if(!i)return l;l="auto"}return(!Ct.boxSizingReliable()&&a||!Ct.reliableTrDimensions()&&s(t,"tr")||"auto"===l||!parseFloat(l)&&"inline"===wt.css(t,"display",!1,n))&&t.getClientRects().length&&(a="border-box"===wt.css(t,"boxSizing",!1,n),(r=c in t)&&(l=t[c])),(l=parseFloat(l)||0)+z(t,e,i||(a?"border":"content"),r,n,l)+"px"}function G(t,e,i,n,o){return new G.prototype.init(t,e,i,n,o)}function W(){ye&&(!1===yt.hidden&&t.requestAnimationFrame?t.requestAnimationFrame(W):t.setTimeout(W,wt.fx.interval),wt.fx.tick())}function j(){return t.setTimeout(function(){_e=void 0}),_e=Date.now()}function q(t,e){var i,n=0,o={height:t};for(e=e?1:0;n<4;n+=2-e)i=jt[n],o["margin"+i]=o["padding"+i]=t;return e&&(o.opacity=o.width=t),o}function K(t,e,i){for(var n,o=(J.tweeners[e]||[]).concat(J.tweeners["*"]),s=0,a=o.length;s<a;s++)if(n=o[s].call(i,e,t))return n}function Y(t,e,i){var n,o,s,a,r,l,c,d,h="width"in e||"height"in e,p=this,m={},u=t.style,g=t.nodeType&&Xt(t),b=Ot.get(t,"fxshow");i.queue||(a=wt._queueHooks(t,"fx"),null==a.unqueued&&(a.unqueued=0,r=a.empty.fire,a.empty.fire=function(){a.unqueued||r()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,wt.queue(t,"fx").length||a.empty.fire()})}));for(n in e)if(o=e[n],xe.test(o)){if(delete e[n],s=s||"toggle"===o,o===(g?"hide":"show")){if("show"!==o||!b||void 0===b[n])continue;g=!0}m[n]=b&&b[n]||wt.style(t,n)}if((l=!wt.isEmptyObject(e))||!wt.isEmptyObject(m)){h&&1===t.nodeType&&(i.overflow=[u.overflow,u.overflowX,u.overflowY],c=b&&b.display,null==c&&(c=Ot.get(t,"display")),d=wt.css(t,"display"),"none"===d&&(c?d=c:(_([t],!0),c=t.style.display||c,d=wt.css(t,"display"),_([t]))),("inline"===d||"inline-block"===d&&null!=c)&&"none"===wt.css(t,"float")&&(l||(p.done(function(){u.display=c}),null==c&&(d=u.display,c="none"===d?"":d)),u.display="inline-block")),i.overflow&&(u.overflow="hidden",p.always(function(){u.overflow=i.overflow[0],u.overflowX=i.overflow[1],u.overflowY=i.overflow[2]})),l=!1;for(n in m)l||(b?"hidden"in b&&(g=b.hidden):b=Ot.access(t,"fxshow",{display:c}),s&&(b.hidden=!g),g&&_([t],!0),p.done(function(){g||_([t]),Ot.remove(t,"fxshow");for(n in m)wt.style(t,n,m[n])})),l=K(g?b[n]:0,n,p),n in b||(b[n]=l.start,g&&(l.end=l.start,l.start=0))}}function X(t,e){var i,n,o,s,a;for(i in t)if(n=u(i),o=e[n],s=t[i],Array.isArray(s)&&(o=s[1],
s=t[i]=s[0]),i!==n&&(t[n]=s,delete t[i]),(a=wt.cssHooks[n])&&"expand"in a){s=a.expand(s),delete t[n];for(i in s)i in t||(t[i]=s[i],e[i]=o)}else e[n]=o}function J(t,e,i){var n,o,s=0,a=J.prefilters.length,r=wt.Deferred().always(function(){delete l.elem}),l=function(){if(o)return!1;for(var e=_e||j(),i=Math.max(0,c.startTime+c.duration-e),n=i/c.duration||0,s=1-n,a=0,l=c.tweens.length;a<l;a++)c.tweens[a].run(s);return r.notifyWith(t,[c,s,i]),s<1&&l?i:(l||r.notifyWith(t,[c,1,0]),r.resolveWith(t,[c]),!1)},c=r.promise({elem:t,props:wt.extend({},e),opts:wt.extend(!0,{specialEasing:{},easing:wt.easing._default},i),originalProperties:e,originalOptions:i,startTime:_e||j(),duration:i.duration,tweens:[],createTween:function(e,i){var n=wt.Tween(t,c.opts,e,i,c.opts.specialEasing[e]||c.opts.easing);return c.tweens.push(n),n},stop:function(e){var i=0,n=e?c.tweens.length:0;if(o)return this;for(o=!0;i<n;i++)c.tweens[i].run(1);return e?(r.notifyWith(t,[c,1,0]),r.resolveWith(t,[c,e])):r.rejectWith(t,[c,e]),this}}),d=c.props;for(X(d,c.opts.specialEasing);s<a;s++)if(n=J.prefilters[s].call(c,t,d,c.opts))return vt(n.stop)&&(wt._queueHooks(c.elem,c.opts.queue).stop=n.stop.bind(n)),n;return wt.map(d,K,c),vt(c.opts.start)&&c.opts.start.call(t,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),wt.fx.timer(wt.extend(l,{elem:t,anim:c,queue:c.opts.queue})),c}function Z(t){return(t.match(Dt)||[]).join(" ")}function Q(t){return t.getAttribute&&t.getAttribute("class")||""}function tt(t){return Array.isArray(t)?t:"string"==typeof t?t.match(Dt)||[]:[]}function et(t,e,i,o){var s;if(Array.isArray(e))wt.each(e,function(e,n){i||Ee.test(t)?o(t,n):et(t+"["+("object"==typeof n&&null!=n?e:"")+"]",n,i,o)});else if(i||"object"!==n(e))o(t,e);else for(s in e)et(t+"["+s+"]",e[s],i,o)}function it(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var n,o=0,s=e.toLowerCase().match(Dt)||[];if(vt(i))for(;n=s[o++];)"+"===n[0]?(n=n.slice(1)||"*",(t[n]=t[n]||[]).unshift(i)):(t[n]=t[n]||[]).push(i)}}function nt(t,e,i,n){function o(r){var l;return s[r]=!0,wt.each(t[r]||[],function(t,r){var c=r(e,i,n);return"string"!=typeof c||a||s[c]?a?!(l=c):void 0:(e.dataTypes.unshift(c),o(c),!1)}),l}var s={},a=t===je;return o(e.dataTypes[0])||!s["*"]&&o("*")}function ot(t,e){var i,n,o=wt.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((o[i]?t:n||(n={}))[i]=e[i]);return n&&wt.extend(!0,t,n),t}function st(t,e,i){for(var n,o,s,a,r=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===n&&(n=t.mimeType||e.getResponseHeader("Content-Type"));if(n)for(o in r)if(r[o]&&r[o].test(n)){l.unshift(o);break}if(l[0]in i)s=l[0];else{for(o in i){if(!l[0]||t.converters[o+" "+l[0]]){s=o;break}a||(a=o)}s=s||a}if(s)return s!==l[0]&&l.unshift(s),i[s]}function at(t,e,i,n){var o,s,a,r,l,c={},d=t.dataTypes.slice();if(d[1])for(a in t.converters)c[a.toLowerCase()]=t.converters[a];for(s=d.shift();s;)if(t.responseFields[s]&&(i[t.responseFields[s]]=e),!l&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=s,s=d.shift())if("*"===s)s=l;else if("*"!==l&&l!==s){if(!(a=c[l+" "+s]||c["* "+s]))for(o in c)if(r=o.split(" "),r[1]===s&&(a=c[l+" "+r[0]]||c["* "+r[0]])){!0===a?a=c[o]:!0!==c[o]&&(s=r[0],d.unshift(r[1]));break}if(!0!==a)if(a&&t.throws)e=a(e);else try{e=a(e)}catch(t){return{state:"parsererror",error:a?t:"No conversion from "+l+" to "+s}}}return{state:"success",data:e}}var rt=[],lt=Object.getPrototypeOf,ct=rt.slice,dt=rt.flat?function(t){return rt.flat.call(t)}:function(t){return rt.concat.apply([],t)},ht=rt.push,pt=rt.indexOf,mt={},ut=mt.toString,gt=mt.hasOwnProperty,bt=gt.toString,ft=bt.call(Object),Ct={},vt=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType},_t=function(t){return null!=t&&t===t.window},yt=t.document,xt={type:!0,src:!0,nonce:!0,noModule:!0},wt=function(t,e){return new wt.fn.init(t,e)};wt.fn=wt.prototype={jquery:"3.5.1",constructor:wt,length:0,toArray:function(){return ct.call(this)},get:function(t){return null==t?ct.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=wt.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return wt.each(this,t)},map:function(t){return this.pushStack(wt.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return this.pushStack(ct.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(wt.grep(this,function(t,e){return(e+1)%2}))},odd:function(){return this.pushStack(wt.grep(this,function(t,e){return e%2}))},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:ht,sort:rt.sort,splice:rt.splice},wt.extend=wt.fn.extend=function(){var t,e,i,n,o,s,a=arguments[0]||{},r=1,l=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[r]||{},r++),"object"==typeof a||vt(a)||(a={}),r===l&&(a=this,r--);r<l;r++)if(null!=(t=arguments[r]))for(e in t)n=t[e],"__proto__"!==e&&a!==n&&(c&&n&&(wt.isPlainObject(n)||(o=Array.isArray(n)))?(i=a[e],s=o&&!Array.isArray(i)?[]:o||wt.isPlainObject(i)?i:{},o=!1,a[e]=wt.extend(c,s,n)):void 0!==n&&(a[e]=n));return a},wt.extend({expando:"jQuery"+("3.5.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,i;return!(!t||"[object Object]"!==ut.call(t))&&(!(e=lt(t))||"function"==typeof(i=gt.call(e,"constructor")&&e.constructor)&&bt.call(i)===ft)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t,e,n){i(t,{nonce:e&&e.nonce},n)},each:function(t,e){var i,n=0;if(o(t))for(i=t.length;n<i&&!1!==e.call(t[n],n,t[n]);n++);else for(n in t)if(!1===e.call(t[n],n,t[n]))break;return t},makeArray:function(t,e){var i=e||[];return null!=t&&(o(Object(t))?wt.merge(i,"string"==typeof t?[t]:t):ht.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:pt.call(e,t,i)},merge:function(t,e){for(var i=+e.length,n=0,o=t.length;n<i;n++)t[o++]=e[n];return t.length=o,t},grep:function(t,e,i){for(var n=[],o=0,s=t.length,a=!i;o<s;o++)!e(t[o],o)!==a&&n.push(t[o]);return n},map:function(t,e,i){var n,s,a=0,r=[];if(o(t))for(n=t.length;a<n;a++)null!=(s=e(t[a],a,i))&&r.push(s);else for(a in t)null!=(s=e(t[a],a,i))&&r.push(s);return dt(r)},guid:1,support:Ct}),"function"==typeof Symbol&&(wt.fn[Symbol.iterator]=rt[Symbol.iterator]),wt.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,e){mt["[object "+e+"]"]=e.toLowerCase()});var St=function(t){function e(t,e,i,n){var o,s,a,r,l,d,p,m=e&&e.ownerDocument,u=e?e.nodeType:9;if(i=i||[],"string"!=typeof t||!t||1!==u&&9!==u&&11!==u)return i;if(!n&&(M(e),e=e||U,D)){if(11!==u&&(l=ft.exec(t)))if(o=l[1]){if(9===u){if(!(a=e.getElementById(o)))return i;if(a.id===o)return i.push(a),i}else if(m&&(a=m.getElementById(o))&&R(e,a)&&a.id===o)return i.push(a),i}else{if(l[2])return J.apply(i,e.getElementsByTagName(t)),i;if((o=l[3])&&_.getElementsByClassName&&e.getElementsByClassName)return J.apply(i,e.getElementsByClassName(o)),i}if(_.qsa&&!W[t+" "]&&(!E||!E.test(t))&&(1!==u||"object"!==e.nodeName.toLowerCase())){if(p=t,m=e,1===u&&(ct.test(t)||lt.test(t))){for(m=Ct.test(t)&&c(e.parentNode)||e,m===e&&_.scope||((r=e.getAttribute("id"))?r=r.replace(yt,xt):e.setAttribute("id",r=L)),d=S(t),s=d.length;s--;)d[s]=(r?"#"+r:":scope")+" "+h(d[s]);p=d.join(",")}try{return J.apply(i,m.querySelectorAll(p)),i}catch(e){W(t,!0)}finally{r===L&&e.removeAttribute("id")}}}return k(t.replace(at,"$1"),e,i,n)}function i(){function t(i,n){return e.push(i+" ")>y.cacheLength&&delete t[e.shift()],t[i+" "]=n}var e=[];return t}function n(t){return t[L]=!0,t}function o(t){var e=U.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function s(t,e){for(var i=t.split("|"),n=i.length;n--;)y.attrHandle[i[n]]=e}function a(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&t.sourceIndex-e.sourceIndex;if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function r(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&St(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function l(t){return n(function(e){return e=+e,n(function(i,n){for(var o,s=t([],i.length,e),a=s.length;a--;)i[o=s[a]]&&(i[o]=!(n[o]=i[o]))})})}function c(t){return t&&void 0!==t.getElementsByTagName&&t}function d(){}function h(t){for(var e=0,i=t.length,n="";e<i;e++)n+=t[e].value;return n}function p(t,e,i){var n=e.dir,o=e.next,s=o||n,a=i&&"parentNode"===s,r=H++;return e.first?function(e,i,o){for(;e=e[n];)if(1===e.nodeType||a)return t(e,i,o);return!1}:function(e,i,l){var c,d,h,p=[O,r];if(l){for(;e=e[n];)if((1===e.nodeType||a)&&t(e,i,l))return!0}else for(;e=e[n];)if(1===e.nodeType||a)if(h=e[L]||(e[L]={}),d=h[e.uniqueID]||(h[e.uniqueID]={}),o&&o===e.nodeName.toLowerCase())e=e[n]||e;else{if((c=d[s])&&c[0]===O&&c[1]===r)return p[2]=c[2];if(d[s]=p,p[2]=t(e,i,l))return!0}return!1}}function m(t){return t.length>1?function(e,i,n){for(var o=t.length;o--;)if(!t[o](e,i,n))return!1;return!0}:t[0]}function u(t,i,n){for(var o=0,s=i.length;o<s;o++)e(t,i[o],n);return n}function g(t,e,i,n,o){for(var s,a=[],r=0,l=t.length,c=null!=e;r<l;r++)(s=t[r])&&(i&&!i(s,n,o)||(a.push(s),c&&e.push(r)));return a}function b(t,e,i,o,s,a){return o&&!o[L]&&(o=b(o)),s&&!s[L]&&(s=b(s,a)),n(function(n,a,r,l){var c,d,h,p=[],m=[],b=a.length,f=n||u(e||"*",r.nodeType?[r]:r,[]),C=!t||!n&&e?f:g(f,p,t,r,l),v=i?s||(n?t:b||o)?[]:a:C;if(i&&i(C,v,r,l),o)for(c=g(v,m),o(c,[],r,l),d=c.length;d--;)(h=c[d])&&(v[m[d]]=!(C[m[d]]=h));if(n){if(s||t){if(s){for(c=[],d=v.length;d--;)(h=v[d])&&c.push(C[d]=h);s(null,v=[],c,l)}for(d=v.length;d--;)(h=v[d])&&(c=s?Q(n,h):p[d])>-1&&(n[c]=!(a[c]=h))}}else v=g(v===a?v.splice(b,v.length):v),s?s(null,a,v,l):J.apply(a,v)})}function f(t){for(var e,i,n,o=t.length,s=y.relative[t[0].type],a=s||y.relative[" "],r=s?1:0,l=p(function(t){return t===e},a,!0),c=p(function(t){return Q(e,t)>-1},a,!0),d=[function(t,i,n){var o=!s&&(n||i!==T)||((e=i).nodeType?l(t,i,n):c(t,i,n));return e=null,o}];r<o;r++)if(i=y.relative[t[r].type])d=[p(m(d),i)];else{if(i=y.filter[t[r].type].apply(null,t[r].matches),i[L]){for(n=++r;n<o&&!y.relative[t[n].type];n++);return b(r>1&&m(d),r>1&&h(t.slice(0,r-1).concat({value:" "===t[r-2].type?"*":""})).replace(at,"$1"),i,r<n&&f(t.slice(r,n)),n<o&&f(t=t.slice(n)),n<o&&h(t))}d.push(i)}return m(d)}function C(t,i){var o=i.length>0,s=t.length>0,a=function(n,a,r,l,c){var d,h,p,m=0,u="0",b=n&&[],f=[],C=T,v=n||s&&y.find.TAG("*",c),_=O+=null==C?1:Math.random()||.1,x=v.length;for(c&&(T=a==U||a||c);u!==x&&null!=(d=v[u]);u++){if(s&&d){for(h=0,a||d.ownerDocument==U||(M(d),r=!D);p=t[h++];)if(p(d,a||U,r)){l.push(d);break}c&&(O=_)}o&&((d=!p&&d)&&m--,n&&b.push(d))}if(m+=u,o&&u!==m){for(h=0;p=i[h++];)p(b,f,a,r);if(n){if(m>0)for(;u--;)b[u]||f[u]||(f[u]=Y.call(l));f=g(f)}J.apply(l,f),c&&!n&&f.length>0&&m+i.length>1&&e.uniqueSort(l)}return c&&(O=_,T=C),b};return o?n(a):a}var v,_,y,x,w,S,A,k,T,I,P,M,U,B,D,E,V,F,R,L="sizzle"+1*new Date,N=t.document,O=0,H=0,z=i(),$=i(),G=i(),W=i(),j=function(t,e){return t===e&&(P=!0),0},q={}.hasOwnProperty,K=[],Y=K.pop,X=K.push,J=K.push,Z=K.slice,Q=function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1},tt="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",et="[\\x20\\t\\r\\n\\f]",it="(?:\\\\[\\da-fA-F]{1,6}"+et+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",nt="\\["+et+"*("+it+")(?:"+et+"*([*^$|!~]?=)"+et+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+it+"))|)"+et+"*\\]",ot=":("+it+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+nt+")*)|.*)\\)|)",st=new RegExp(et+"+","g"),at=new RegExp("^"+et+"+|((?:^|[^\\\\])(?:\\\\.)*)"+et+"+$","g"),rt=new RegExp("^"+et+"*,"+et+"*"),lt=new RegExp("^"+et+"*([>+~]|"+et+")"+et+"*"),ct=new RegExp(et+"|>"),dt=new RegExp(ot),ht=new RegExp("^"+it+"$"),pt={ID:new RegExp("^#("+it+")"),CLASS:new RegExp("^\\.("+it+")"),TAG:new RegExp("^("+it+"|[*])"),ATTR:new RegExp("^"+nt),PSEUDO:new RegExp("^"+ot),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+et+"*(even|odd|(([+-]|)(\\d*)n|)"+et+"*(?:([+-]|)"+et+"*(\\d+)|))"+et+"*\\)|)","i"),bool:new RegExp("^(?:"+tt+")$","i"),needsContext:new RegExp("^"+et+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+et+"*((?:-\\d)?\\d*)"+et+"*\\)|)(?=[^-]|$)","i")},mt=/HTML$/i,ut=/^(?:input|select|textarea|button)$/i,gt=/^h\d$/i,bt=/^[^{]+\{\s*\[native \w/,ft=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Ct=/[+~]/,vt=new RegExp("\\\\[\\da-fA-F]{1,6}"+et+"?|\\\\([^\\r\\n\\f])","g"),_t=function(t,e){var i="0x"+t.slice(1)-65536;return e||(i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320))},yt=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,xt=function(t,e){return e?"\0"===t?"ï¿½":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t},wt=function(){M()},St=p(function(t){return!0===t.disabled&&"fieldset"===t.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{J.apply(K=Z.call(N.childNodes),N.childNodes),K[N.childNodes.length].nodeType}catch(t){J={apply:K.length?function(t,e){X.apply(t,Z.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}_=e.support={},w=e.isXML=function(t){var e=t.namespaceURI,i=(t.ownerDocument||t).documentElement;return!mt.test(e||i&&i.nodeName||"HTML")},M=e.setDocument=function(t){var e,i,n=t?t.ownerDocument||t:N;return n!=U&&9===n.nodeType&&n.documentElement?(U=n,B=U.documentElement,D=!w(U),N!=U&&(i=U.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",wt,!1):i.attachEvent&&i.attachEvent("onunload",wt)),_.scope=o(function(t){return B.appendChild(t).appendChild(U.createElement("div")),void 0!==t.querySelectorAll&&!t.querySelectorAll(":scope fieldset div").length}),_.attributes=o(function(t){return t.className="i",!t.getAttribute("className")}),_.getElementsByTagName=o(function(t){return t.appendChild(U.createComment("")),!t.getElementsByTagName("*").length}),_.getElementsByClassName=bt.test(U.getElementsByClassName),_.getById=o(function(t){return B.appendChild(t).id=L,!U.getElementsByName||!U.getElementsByName(L).length}),_.getById?(y.filter.ID=function(t){var e=t.replace(vt,_t);return function(t){return t.getAttribute("id")===e}},y.find.ID=function(t,e){if(void 0!==e.getElementById&&D){var i=e.getElementById(t);return i?[i]:[]}}):(y.filter.ID=function(t){var e=t.replace(vt,_t);return function(t){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}},y.find.ID=function(t,e){if(void 0!==e.getElementById&&D){var i,n,o,s=e.getElementById(t);if(s){if((i=s.getAttributeNode("id"))&&i.value===t)return[s];for(o=e.getElementsByName(t),n=0;s=o[n++];)if((i=s.getAttributeNode("id"))&&i.value===t)return[s]}return[]}}),y.find.TAG=_.getElementsByTagName?function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):_.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,n=[],o=0,s=e.getElementsByTagName(t);if("*"===t){for(;i=s[o++];)1===i.nodeType&&n.push(i);return n}return s},y.find.CLASS=_.getElementsByClassName&&function(t,e){if(void 0!==e.getElementsByClassName&&D)return e.getElementsByClassName(t)},V=[],E=[],(_.qsa=bt.test(U.querySelectorAll))&&(o(function(t){var e;B.appendChild(t).innerHTML="<a id='"+L+"'></a><select id='"+L+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&E.push("[*^$]="+et+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||E.push("\\["+et+"*(?:value|"+tt+")"),t.querySelectorAll("[id~="+L+"-]").length||E.push("~="),e=U.createElement("input"),e.setAttribute("name",""),t.appendChild(e),t.querySelectorAll("[name='']").length||E.push("\\["+et+"*name"+et+"*="+et+"*(?:''|\"\")"),t.querySelectorAll(":checked").length||E.push(":checked"),t.querySelectorAll("a#"+L+"+*").length||E.push(".#.+[+~]"),t.querySelectorAll("\\\f"),E.push("[\\r\\n\\f]")}),o(function(t){t.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var e=U.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&E.push("name"+et+"*[*^$|!~]?="),2!==t.querySelectorAll(":enabled").length&&E.push(":enabled",":disabled"),B.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&E.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),E.push(",.*:")})),(_.matchesSelector=bt.test(F=B.matches||B.webkitMatchesSelector||B.mozMatchesSelector||B.oMatchesSelector||B.msMatchesSelector))&&o(function(t){_.disconnectedMatch=F.call(t,"*"),F.call(t,"[s!='']:x"),V.push("!=",ot)}),E=E.length&&new RegExp(E.join("|")),V=V.length&&new RegExp(V.join("|")),e=bt.test(B.compareDocumentPosition),R=e||bt.test(B.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},j=e?function(t,e){if(t===e)return P=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i||(i=(t.ownerDocument||t)==(e.ownerDocument||e)?t.compareDocumentPosition(e):1,1&i||!_.sortDetached&&e.compareDocumentPosition(t)===i?t==U||t.ownerDocument==N&&R(N,t)?-1:e==U||e.ownerDocument==N&&R(N,e)?1:I?Q(I,t)-Q(I,e):0:4&i?-1:1)}:function(t,e){if(t===e)return P=!0,0;var i,n=0,o=t.parentNode,s=e.parentNode,r=[t],l=[e];if(!o||!s)return t==U?-1:e==U?1:o?-1:s?1:I?Q(I,t)-Q(I,e):0;if(o===s)return a(t,e);for(i=t;i=i.parentNode;)r.unshift(i);for(i=e;i=i.parentNode;)l.unshift(i);for(;r[n]===l[n];)n++;return n?a(r[n],l[n]):r[n]==N?-1:l[n]==N?1:0},U):U},e.matches=function(t,i){return e(t,null,null,i)},e.matchesSelector=function(t,i){if(M(t),_.matchesSelector&&D&&!W[i+" "]&&(!V||!V.test(i))&&(!E||!E.test(i)))try{var n=F.call(t,i);if(n||_.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(t){W(i,!0)}return e(i,U,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!=U&&M(t),R(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!=U&&M(t);var i=y.attrHandle[e.toLowerCase()],n=i&&q.call(y.attrHandle,e.toLowerCase())?i(t,e,!D):void 0;return void 0!==n?n:_.attributes||!D?t.getAttribute(e):(n=t.getAttributeNode(e))&&n.specified?n.value:null},e.escape=function(t){return(t+"").replace(yt,xt)},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,i=[],n=0,o=0;if(P=!_.detectDuplicates,I=!_.sortStable&&t.slice(0),t.sort(j),P){for(;e=t[o++];)e===t[o]&&(n=i.push(o));for(;n--;)t.splice(i[n],1)}return I=null,t},x=e.getText=function(t){var e,i="",n=0,o=t.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=x(t)}else if(3===o||4===o)return t.nodeValue}else for(;e=t[n++];)i+=x(e);return i},y=e.selectors={cacheLength:50,createPseudo:n,match:pt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(vt,_t),t[3]=(t[3]||t[4]||t[5]||"").replace(vt,_t),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return pt.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&dt.test(i)&&(e=S(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(vt,_t).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=z[t+" "];return e||(e=new RegExp("(^|"+et+")"+t+"("+et+"|$)"))&&z(t,function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(t,i,n){return function(o){var s=e.attr(o,t);return null==s?"!="===i:!i||(s+="","="===i?s===n:"!="===i?s!==n:"^="===i?n&&0===s.indexOf(n):"*="===i?n&&s.indexOf(n)>-1:"$="===i?n&&s.slice(-n.length)===n:"~="===i?(" "+s.replace(st," ")+" ").indexOf(n)>-1:"|="===i&&(s===n||s.slice(0,n.length+1)===n+"-"))}},CHILD:function(t,e,i,n,o){var s="nth"!==t.slice(0,3),a="last"!==t.slice(-4),r="of-type"===e;return 1===n&&0===o?function(t){return!!t.parentNode}:function(e,i,l){var c,d,h,p,m,u,g=s!==a?"nextSibling":"previousSibling",b=e.parentNode,f=r&&e.nodeName.toLowerCase(),C=!l&&!r,v=!1;if(b){if(s){for(;g;){for(p=e;p=p[g];)if(r?p.nodeName.toLowerCase()===f:1===p.nodeType)return!1;u=g="only"===t&&!u&&"nextSibling"}return!0}if(u=[a?b.firstChild:b.lastChild],a&&C){for(p=b,h=p[L]||(p[L]={}),d=h[p.uniqueID]||(h[p.uniqueID]={}),c=d[t]||[],m=c[0]===O&&c[1],v=m&&c[2],p=m&&b.childNodes[m];p=++m&&p&&p[g]||(v=m=0)||u.pop();)if(1===p.nodeType&&++v&&p===e){d[t]=[O,m,v];break}}else if(C&&(p=e,h=p[L]||(p[L]={}),d=h[p.uniqueID]||(h[p.uniqueID]={}),c=d[t]||[],m=c[0]===O&&c[1],v=m),!1===v)for(;(p=++m&&p&&p[g]||(v=m=0)||u.pop())&&((r?p.nodeName.toLowerCase()!==f:1!==p.nodeType)||!++v||(C&&(h=p[L]||(p[L]={}),d=h[p.uniqueID]||(h[p.uniqueID]={}),d[t]=[O,v]),p!==e)););return(v-=o)===n||v%n==0&&v/n>=0}}},PSEUDO:function(t,i){var o,s=y.pseudos[t]||y.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return s[L]?s(i):s.length>1?(o=[t,t,"",i],y.setFilters.hasOwnProperty(t.toLowerCase())?n(function(t,e){for(var n,o=s(t,i),a=o.length;a--;)n=Q(t,o[a]),t[n]=!(e[n]=o[a])}):function(t){return s(t,0,o)}):s}},pseudos:{not:n(function(t){var e=[],i=[],o=A(t.replace(at,"$1"));return o[L]?n(function(t,e,i,n){for(var s,a=o(t,null,n,[]),r=t.length;r--;)(s=a[r])&&(t[r]=!(e[r]=s))}):function(t,n,s){return e[0]=t,o(e,null,s,i),e[0]=null,!i.pop()}}),has:n(function(t){return function(i){return e(t,i).length>0}}),contains:n(function(t){return t=t.replace(vt,_t),function(e){return(e.textContent||x(e)).indexOf(t)>-1}}),lang:n(function(t){return ht.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(vt,_t).toLowerCase(),function(e){var i;do{if(i=D?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(i=i.toLowerCase())===t||0===i.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===B},focus:function(t){return t===U.activeElement&&(!U.hasFocus||U.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:r(!1),disabled:r(!0),checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!y.pseudos.empty(t)},header:function(t){return gt.test(t.nodeName)},input:function(t){return ut.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:l(function(){return[0]}),last:l(function(t,e){return[e-1]}),eq:l(function(t,e,i){return[i<0?i+e:i]}),even:l(function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t}),odd:l(function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t}),lt:l(function(t,e,i){for(var n=i<0?i+e:i>e?e:i;--n>=0;)t.push(n);return t}),gt:l(function(t,e,i){for(var n=i<0?i+e:i;++n<e;)t.push(n);return t})}},y.pseudos.nth=y.pseudos.eq;for(v in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})y.pseudos[v]=function(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}(v);for(v in{submit:!0,reset:!0})y.pseudos[v]=function(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}(v);return d.prototype=y.filters=y.pseudos,y.setFilters=new d,S=e.tokenize=function(t,i){var n,o,s,a,r,l,c,d=$[t+" "];if(d)return i?0:d.slice(0);for(r=t,l=[],c=y.preFilter;r;){n&&!(o=rt.exec(r))||(o&&(r=r.slice(o[0].length)||r),l.push(s=[])),n=!1,(o=lt.exec(r))&&(n=o.shift(),s.push({value:n,type:o[0].replace(at," ")}),r=r.slice(n.length));for(a in y.filter)!(o=pt[a].exec(r))||c[a]&&!(o=c[a](o))||(n=o.shift(),s.push({value:n,type:a,matches:o}),r=r.slice(n.length));if(!n)break}return i?r.length:r?e.error(t):$(t,l).slice(0)},A=e.compile=function(t,e){var i,n=[],o=[],s=G[t+" "];if(!s){for(e||(e=S(t)),i=e.length;i--;)s=f(e[i]),s[L]?n.push(s):o.push(s);s=G(t,C(o,n)),s.selector=t}return s},k=e.select=function(t,e,i,n){var o,s,a,r,l,d="function"==typeof t&&t,p=!n&&S(t=d.selector||t);if(i=i||[],1===p.length){if(s=p[0]=p[0].slice(0),s.length>2&&"ID"===(a=s[0]).type&&9===e.nodeType&&D&&y.relative[s[1].type]){if(!(e=(y.find.ID(a.matches[0].replace(vt,_t),e)||[])[0]))return i;d&&(e=e.parentNode),t=t.slice(s.shift().value.length)}for(o=pt.needsContext.test(t)?0:s.length;o--&&(a=s[o],!y.relative[r=a.type]);)if((l=y.find[r])&&(n=l(a.matches[0].replace(vt,_t),Ct.test(s[0].type)&&c(e.parentNode)||e))){if(s.splice(o,1),!(t=n.length&&h(s)))return J.apply(i,n),i;break}}return(d||A(t,p))(n,e,!D,i,!e||Ct.test(t)&&c(e.parentNode)||e),i},_.sortStable=L.split("").sort(j).join("")===L,_.detectDuplicates=!!P,M(),_.sortDetached=o(function(t){return 1&t.compareDocumentPosition(U.createElement("fieldset"))}),o(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||s("type|href|height|width",function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),_.attributes&&o(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||s("value",function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue}),o(function(t){return null==t.getAttribute("disabled")})||s(tt,function(t,e,i){var n;if(!i)return!0===t[e]?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null}),e}(t);wt.find=St,wt.expr=St.selectors,wt.expr[":"]=wt.expr.pseudos,wt.uniqueSort=wt.unique=St.uniqueSort,wt.text=St.getText,wt.isXMLDoc=St.isXML,wt.contains=St.contains,wt.escapeSelector=St.escape;var At=function(t,e,i){for(var n=[],o=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(o&&wt(t).is(i))break;n.push(t)}return n},kt=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},Tt=wt.expr.match.needsContext,It=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;wt.filter=function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?wt.find.matchesSelector(n,t)?[n]:[]:wt.find.matches(t,wt.grep(e,function(t){return 1===t.nodeType}))},wt.fn.extend({find:function(t){var e,i,n=this.length,o=this;if("string"!=typeof t)return this.pushStack(wt(t).filter(function(){for(e=0;e<n;e++)if(wt.contains(o[e],this))return!0}));for(i=this.pushStack([]),e=0;e<n;e++)wt.find(t,o[e],i);return n>1?wt.uniqueSort(i):i},filter:function(t){return this.pushStack(a(this,t||[],!1))},not:function(t){return this.pushStack(a(this,t||[],!0))},is:function(t){return!!a(this,"string"==typeof t&&Tt.test(t)?wt(t):t||[],!1).length}});var Pt,Mt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(wt.fn.init=function(t,e,i){var n,o;if(!t)return this;if(i=i||Pt,"string"==typeof t){if(!(n="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:Mt.exec(t))||!n[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof wt?e[0]:e,wt.merge(this,wt.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:yt,!0)),It.test(n[1])&&wt.isPlainObject(e))for(n in e)vt(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}return o=yt.getElementById(n[2]),o&&(this[0]=o,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):vt(t)?void 0!==i.ready?i.ready(t):t(wt):wt.makeArray(t,this)}).prototype=wt.fn,Pt=wt(yt);var Ut=/^(?:parents|prev(?:Until|All))/,Bt={children:!0,contents:!0,next:!0,prev:!0};wt.fn.extend({has:function(t){var e=wt(t,this),i=e.length;return this.filter(function(){for(var t=0;t<i;t++)if(wt.contains(this,e[t]))return!0})},closest:function(t,e){var i,n=0,o=this.length,s=[],a="string"!=typeof t&&wt(t);if(!Tt.test(t))for(;n<o;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(a?a.index(i)>-1:1===i.nodeType&&wt.find.matchesSelector(i,t))){s.push(i);break}return this.pushStack(s.length>1?wt.uniqueSort(s):s)},index:function(t){return t?"string"==typeof t?pt.call(wt(t),this[0]):pt.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(wt.uniqueSort(wt.merge(this.get(),wt(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),wt.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return At(t,"parentNode")},parentsUntil:function(t,e,i){return At(t,"parentNode",i)},next:function(t){return r(t,"nextSibling")},prev:function(t){return r(t,"previousSibling")},nextAll:function(t){return At(t,"nextSibling")},prevAll:function(t){return At(t,"previousSibling")},nextUntil:function(t,e,i){return At(t,"nextSibling",i)},prevUntil:function(t,e,i){return At(t,"previousSibling",i)},siblings:function(t){return kt((t.parentNode||{}).firstChild,t)},children:function(t){return kt(t.firstChild)},contents:function(t){return null!=t.contentDocument&&lt(t.contentDocument)?t.contentDocument:(s(t,"template")&&(t=t.content||t),wt.merge([],t.childNodes))}},function(t,e){wt.fn[t]=function(i,n){var o=wt.map(this,e,i);return"Until"!==t.slice(-5)&&(n=i),n&&"string"==typeof n&&(o=wt.filter(n,o)),this.length>1&&(Bt[t]||wt.uniqueSort(o),Ut.test(t)&&o.reverse()),this.pushStack(o)}});var Dt=/[^\x20\t\r\n\f]+/g;wt.Callbacks=function(t){t="string"==typeof t?l(t):wt.extend({},t);var e,i,o,s,a=[],r=[],c=-1,d=function(){for(s=s||t.once,o=e=!0;r.length;c=-1)for(i=r.shift();++c<a.length;)!1===a[c].apply(i[0],i[1])&&t.stopOnFalse&&(c=a.length,i=!1);t.memory||(i=!1),e=!1,s&&(a=i?[]:"")},h={add:function(){return a&&(i&&!e&&(c=a.length-1,r.push(i)),function e(i){wt.each(i,function(i,o){vt(o)?t.unique&&h.has(o)||a.push(o):o&&o.length&&"string"!==n(o)&&e(o)})}(arguments),i&&!e&&d()),this},remove:function(){return wt.each(arguments,function(t,e){for(var i;(i=wt.inArray(e,a,i))>-1;)a.splice(i,1),i<=c&&c--}),this},has:function(t){return t?wt.inArray(t,a)>-1:a.length>0},empty:function(){return a&&(a=[]),this},disable:function(){return s=r=[],a=i="",this},disabled:function(){return!a},lock:function(){return s=r=[],i||e||(a=i=""),this},locked:function(){return!!s},fireWith:function(t,i){return s||(i=i||[],i=[t,i.slice?i.slice():i],r.push(i),e||d()),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!o}};return h},wt.extend({Deferred:function(e){var i=[["notify","progress",wt.Callbacks("memory"),wt.Callbacks("memory"),2],["resolve","done",wt.Callbacks("once memory"),wt.Callbacks("once memory"),0,"resolved"],["reject","fail",wt.Callbacks("once memory"),wt.Callbacks("once memory"),1,"rejected"]],n="pending",o={state:function(){return n},always:function(){return s.done(arguments).fail(arguments),this},catch:function(t){return o.then(null,t)},pipe:function(){var t=arguments;return wt.Deferred(function(e){wt.each(i,function(i,n){var o=vt(t[n[4]])&&t[n[4]];s[n[1]](function(){var t=o&&o.apply(this,arguments);t&&vt(t.promise)?t.promise().progress(e.notify).done(e.resolve).fail(e.reject):e[n[0]+"With"](this,o?[t]:arguments)})}),t=null}).promise()},then:function(e,n,o){function s(e,i,n,o){return function(){
var r=this,l=arguments,h=function(){var t,h;if(!(e<a)){if((t=n.apply(r,l))===i.promise())throw new TypeError("Thenable self-resolution");h=t&&("object"==typeof t||"function"==typeof t)&&t.then,vt(h)?o?h.call(t,s(a,i,c,o),s(a,i,d,o)):(a++,h.call(t,s(a,i,c,o),s(a,i,d,o),s(a,i,c,i.notifyWith))):(n!==c&&(r=void 0,l=[t]),(o||i.resolveWith)(r,l))}},p=o?h:function(){try{h()}catch(t){wt.Deferred.exceptionHook&&wt.Deferred.exceptionHook(t,p.stackTrace),e+1>=a&&(n!==d&&(r=void 0,l=[t]),i.rejectWith(r,l))}};e?p():(wt.Deferred.getStackHook&&(p.stackTrace=wt.Deferred.getStackHook()),t.setTimeout(p))}}var a=0;return wt.Deferred(function(t){i[0][3].add(s(0,t,vt(o)?o:c,t.notifyWith)),i[1][3].add(s(0,t,vt(e)?e:c)),i[2][3].add(s(0,t,vt(n)?n:d))}).promise()},promise:function(t){return null!=t?wt.extend(t,o):o}},s={};return wt.each(i,function(t,e){var a=e[2],r=e[5];o[e[1]]=a.add,r&&a.add(function(){n=r},i[3-t][2].disable,i[3-t][3].disable,i[0][2].lock,i[0][3].lock),a.add(e[3].fire),s[e[0]]=function(){return s[e[0]+"With"](this===s?void 0:this,arguments),this},s[e[0]+"With"]=a.fireWith}),o.promise(s),e&&e.call(s,s),s},when:function(t){var e=arguments.length,i=e,n=Array(i),o=ct.call(arguments),s=wt.Deferred(),a=function(t){return function(i){n[t]=this,o[t]=arguments.length>1?ct.call(arguments):i,--e||s.resolveWith(n,o)}};if(e<=1&&(h(t,s.done(a(i)).resolve,s.reject,!e),"pending"===s.state()||vt(o[i]&&o[i].then)))return s.then();for(;i--;)h(o[i],a(i),s.reject);return s.promise()}});var Et=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;wt.Deferred.exceptionHook=function(e,i){t.console&&t.console.warn&&e&&Et.test(e.name)&&t.console.warn("jQuery.Deferred exception: "+e.message,e.stack,i)},wt.readyException=function(e){t.setTimeout(function(){throw e})};var Vt=wt.Deferred();wt.fn.ready=function(t){return Vt.then(t).catch(function(t){wt.readyException(t)}),this},wt.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--wt.readyWait:wt.isReady)||(wt.isReady=!0,!0!==t&&--wt.readyWait>0||Vt.resolveWith(yt,[wt]))}}),wt.ready.then=Vt.then,"complete"===yt.readyState||"loading"!==yt.readyState&&!yt.documentElement.doScroll?t.setTimeout(wt.ready):(yt.addEventListener("DOMContentLoaded",p),t.addEventListener("load",p));var Ft=function(t,e,i,o,s,a,r){var l=0,c=t.length,d=null==i;if("object"===n(i)){s=!0;for(l in i)Ft(t,e,l,i[l],!0,a,r)}else if(void 0!==o&&(s=!0,vt(o)||(r=!0),d&&(r?(e.call(t,o),e=null):(d=e,e=function(t,e,i){return d.call(wt(t),i)})),e))for(;l<c;l++)e(t[l],i,r?o:o.call(t[l],l,e(t[l],i)));return s?t:d?e.call(t):c?e(t[0],i):a},Rt=/^-ms-/,Lt=/-([a-z])/g,Nt=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};g.uid=1,g.prototype={cache:function(t){var e=t[this.expando];return e||(e={},Nt(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var n,o=this.cache(t);if("string"==typeof e)o[u(e)]=i;else for(n in e)o[u(n)]=e[n];return o},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][u(e)]},access:function(t,e,i){return void 0===e||e&&"string"==typeof e&&void 0===i?this.get(t,e):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,n=t[this.expando];if(void 0!==n){if(void 0!==e){Array.isArray(e)?e=e.map(u):(e=u(e),e=e in n?[e]:e.match(Dt)||[]),i=e.length;for(;i--;)delete n[e[i]]}(void 0===e||wt.isEmptyObject(n))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!wt.isEmptyObject(e)}};var Ot=new g,Ht=new g,zt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,$t=/[A-Z]/g;wt.extend({hasData:function(t){return Ht.hasData(t)||Ot.hasData(t)},data:function(t,e,i){return Ht.access(t,e,i)},removeData:function(t,e){Ht.remove(t,e)},_data:function(t,e,i){return Ot.access(t,e,i)},_removeData:function(t,e){Ot.remove(t,e)}}),wt.fn.extend({data:function(t,e){var i,n,o,s=this[0],a=s&&s.attributes;if(void 0===t){if(this.length&&(o=Ht.get(s),1===s.nodeType&&!Ot.get(s,"hasDataAttrs"))){for(i=a.length;i--;)a[i]&&(n=a[i].name,0===n.indexOf("data-")&&(n=u(n.slice(5)),f(s,n,o[n])));Ot.set(s,"hasDataAttrs",!0)}return o}return"object"==typeof t?this.each(function(){Ht.set(this,t)}):Ft(this,function(e){var i;if(s&&void 0===e){if(void 0!==(i=Ht.get(s,t)))return i;if(void 0!==(i=f(s,t)))return i}else this.each(function(){Ht.set(this,t,e)})},null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){Ht.remove(this,t)})}}),wt.extend({queue:function(t,e,i){var n;if(t)return e=(e||"fx")+"queue",n=Ot.get(t,e),i&&(!n||Array.isArray(i)?n=Ot.access(t,e,wt.makeArray(i)):n.push(i)),n||[]},dequeue:function(t,e){e=e||"fx";var i=wt.queue(t,e),n=i.length,o=i.shift(),s=wt._queueHooks(t,e),a=function(){wt.dequeue(t,e)};"inprogress"===o&&(o=i.shift(),n--),o&&("fx"===e&&i.unshift("inprogress"),delete s.stop,o.call(t,a,s)),!n&&s&&s.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return Ot.get(t,i)||Ot.access(t,i,{empty:wt.Callbacks("once memory").add(function(){Ot.remove(t,[e+"queue",i])})})}}),wt.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?wt.queue(this[0],t):void 0===e?this:this.each(function(){var i=wt.queue(this,t,e);wt._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&wt.dequeue(this,t)})},dequeue:function(t){return this.each(function(){wt.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,n=1,o=wt.Deferred(),s=this,a=this.length,r=function(){--n||o.resolveWith(s,[s])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";a--;)(i=Ot.get(s[a],t+"queueHooks"))&&i.empty&&(n++,i.empty.add(r));return r(),o.promise(e)}});var Gt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Wt=new RegExp("^(?:([+-])=|)("+Gt+")([a-z%]*)$","i"),jt=["Top","Right","Bottom","Left"],qt=yt.documentElement,Kt=function(t){return wt.contains(t.ownerDocument,t)},Yt={composed:!0};qt.getRootNode&&(Kt=function(t){return wt.contains(t.ownerDocument,t)||t.getRootNode(Yt)===t.ownerDocument});var Xt=function(t,e){return t=e||t,"none"===t.style.display||""===t.style.display&&Kt(t)&&"none"===wt.css(t,"display")},Jt={};wt.fn.extend({show:function(){return _(this,!0)},hide:function(){return _(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){Xt(this)?wt(this).show():wt(this).hide()})}});var Zt=/^(?:checkbox|radio)$/i,Qt=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,te=/^$|^module$|\/(?:java|ecma)script/i;!function(){var t=yt.createDocumentFragment(),e=t.appendChild(yt.createElement("div")),i=yt.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),e.appendChild(i),Ct.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",Ct.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue,e.innerHTML="<option></option>",Ct.option=!!e.lastChild}();var ee={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ee.tbody=ee.tfoot=ee.colgroup=ee.caption=ee.thead,ee.th=ee.td,Ct.option||(ee.optgroup=ee.option=[1,"<select multiple='multiple'>","</select>"]);var ie=/<|&#?\w+;/,ne=/^key/,oe=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,se=/^([^.]*)(?:\.(.+)|)/;wt.event={global:{},add:function(t,e,i,n,o){var s,a,r,l,c,d,h,p,m,u,g,b=Ot.get(t);if(Nt(t))for(i.handler&&(s=i,i=s.handler,o=s.selector),o&&wt.find.matchesSelector(qt,o),i.guid||(i.guid=wt.guid++),(l=b.events)||(l=b.events=Object.create(null)),(a=b.handle)||(a=b.handle=function(e){return void 0!==wt&&wt.event.triggered!==e.type?wt.event.dispatch.apply(t,arguments):void 0}),e=(e||"").match(Dt)||[""],c=e.length;c--;)r=se.exec(e[c])||[],m=g=r[1],u=(r[2]||"").split(".").sort(),m&&(h=wt.event.special[m]||{},m=(o?h.delegateType:h.bindType)||m,h=wt.event.special[m]||{},d=wt.extend({type:m,origType:g,data:n,handler:i,guid:i.guid,selector:o,needsContext:o&&wt.expr.match.needsContext.test(o),namespace:u.join(".")},s),(p=l[m])||(p=l[m]=[],p.delegateCount=0,h.setup&&!1!==h.setup.call(t,n,u,a)||t.addEventListener&&t.addEventListener(m,a)),h.add&&(h.add.call(t,d),d.handler.guid||(d.handler.guid=i.guid)),o?p.splice(p.delegateCount++,0,d):p.push(d),wt.event.global[m]=!0)},remove:function(t,e,i,n,o){var s,a,r,l,c,d,h,p,m,u,g,b=Ot.hasData(t)&&Ot.get(t);if(b&&(l=b.events)){for(e=(e||"").match(Dt)||[""],c=e.length;c--;)if(r=se.exec(e[c])||[],m=g=r[1],u=(r[2]||"").split(".").sort(),m){for(h=wt.event.special[m]||{},m=(n?h.delegateType:h.bindType)||m,p=l[m]||[],r=r[2]&&new RegExp("(^|\\.)"+u.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=p.length;s--;)d=p[s],!o&&g!==d.origType||i&&i.guid!==d.guid||r&&!r.test(d.namespace)||n&&n!==d.selector&&("**"!==n||!d.selector)||(p.splice(s,1),d.selector&&p.delegateCount--,h.remove&&h.remove.call(t,d));a&&!p.length&&(h.teardown&&!1!==h.teardown.call(t,u,b.handle)||wt.removeEvent(t,m,b.handle),delete l[m])}else for(m in l)wt.event.remove(t,m+e[c],i,n,!0);wt.isEmptyObject(l)&&Ot.remove(t,"handle events")}},dispatch:function(t){var e,i,n,o,s,a,r=new Array(arguments.length),l=wt.event.fix(t),c=(Ot.get(this,"events")||Object.create(null))[l.type]||[],d=wt.event.special[l.type]||{};for(r[0]=l,e=1;e<arguments.length;e++)r[e]=arguments[e];if(l.delegateTarget=this,!d.preDispatch||!1!==d.preDispatch.call(this,l)){for(a=wt.event.handlers.call(this,l,c),e=0;(o=a[e++])&&!l.isPropagationStopped();)for(l.currentTarget=o.elem,i=0;(s=o.handlers[i++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==s.namespace&&!l.rnamespace.test(s.namespace)||(l.handleObj=s,l.data=s.data,void 0!==(n=((wt.event.special[s.origType]||{}).handle||s.handler).apply(o.elem,r))&&!1===(l.result=n)&&(l.preventDefault(),l.stopPropagation()));return d.postDispatch&&d.postDispatch.call(this,l),l.result}},handlers:function(t,e){var i,n,o,s,a,r=[],l=e.delegateCount,c=t.target;if(l&&c.nodeType&&!("click"===t.type&&t.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==t.type||!0!==c.disabled)){for(s=[],a={},i=0;i<l;i++)n=e[i],o=n.selector+" ",void 0===a[o]&&(a[o]=n.needsContext?wt(o,this).index(c)>-1:wt.find(o,this,null,[c]).length),a[o]&&s.push(n);s.length&&r.push({elem:c,handlers:s})}return c=this,l<e.length&&r.push({elem:c,handlers:e.slice(l)}),r},addProp:function(t,e){Object.defineProperty(wt.Event.prototype,t,{enumerable:!0,configurable:!0,get:vt(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[wt.expando]?t:new wt.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var e=this||t;return Zt.test(e.type)&&e.click&&s(e,"input")&&P(e,"click",S),!1},trigger:function(t){var e=this||t;return Zt.test(e.type)&&e.click&&s(e,"input")&&P(e,"click"),!0},_default:function(t){var e=t.target;return Zt.test(e.type)&&e.click&&s(e,"input")&&Ot.get(e,"click")||s(e,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},wt.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},wt.Event=function(t,e){if(!(this instanceof wt.Event))return new wt.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?S:A,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&wt.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[wt.expando]=!0},wt.Event.prototype={constructor:wt.Event,isDefaultPrevented:A,isPropagationStopped:A,isImmediatePropagationStopped:A,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=S,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=S,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=S,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},wt.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(t){var e=t.button;return null==t.which&&ne.test(t.type)?null!=t.charCode?t.charCode:t.keyCode:!t.which&&void 0!==e&&oe.test(t.type)?1&e?1:2&e?3:4&e?2:0:t.which}},wt.event.addProp),wt.each({focus:"focusin",blur:"focusout"},function(t,e){wt.event.special[t]={setup:function(){return P(this,t,k),!1},trigger:function(){return P(this,t),!0},delegateType:e}}),wt.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,e){wt.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,n=this,o=t.relatedTarget,s=t.handleObj;return o&&(o===n||wt.contains(n,o))||(t.type=s.origType,i=s.handler.apply(this,arguments),t.type=e),i}}}),wt.fn.extend({on:function(t,e,i,n){return I(this,t,e,i,n)},one:function(t,e,i,n){return I(this,t,e,i,n,1)},off:function(t,e,i){var n,o;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,wt(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof t){for(o in t)this.off(o,e,t[o]);return this}return!1!==e&&"function"!=typeof e||(i=e,e=void 0),!1===i&&(i=A),this.each(function(){wt.event.remove(this,t,i,e)})}});var ae=/<script|<style|<link/i,re=/checked\s*(?:[^=]|=\s*.checked.)/i,le=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;wt.extend({htmlPrefilter:function(t){return t},clone:function(t,e,i){var n,o,s,a,r=t.cloneNode(!0),l=Kt(t);if(!(Ct.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||wt.isXMLDoc(t)))for(a=y(r),s=y(t),n=0,o=s.length;n<o;n++)E(s[n],a[n]);if(e)if(i)for(s=s||y(t),a=a||y(r),n=0,o=s.length;n<o;n++)D(s[n],a[n]);else D(t,r);return a=y(r,"script"),a.length>0&&x(a,!l&&y(t,"script")),r},cleanData:function(t){for(var e,i,n,o=wt.event.special,s=0;void 0!==(i=t[s]);s++)if(Nt(i)){if(e=i[Ot.expando]){if(e.events)for(n in e.events)o[n]?wt.event.remove(i,n):wt.removeEvent(i,n,e.handle);i[Ot.expando]=void 0}i[Ht.expando]&&(i[Ht.expando]=void 0)}}}),wt.fn.extend({detach:function(t){return F(this,t,!0)},remove:function(t){return F(this,t)},text:function(t){return Ft(this,function(t){return void 0===t?wt.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)})},null,t,arguments.length)},append:function(){return V(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){M(this,t).appendChild(t)}})},prepend:function(){return V(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=M(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return V(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return V(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(wt.cleanData(y(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return wt.clone(this,t,e)})},html:function(t){return Ft(this,function(t){var e=this[0]||{},i=0,n=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!ae.test(t)&&!ee[(Qt.exec(t)||["",""])[1].toLowerCase()]){t=wt.htmlPrefilter(t);try{for(;i<n;i++)e=this[i]||{},1===e.nodeType&&(wt.cleanData(y(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=[];return V(this,arguments,function(e){var i=this.parentNode;wt.inArray(this,t)<0&&(wt.cleanData(y(this)),i&&i.replaceChild(e,this))},t)}}),wt.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){wt.fn[t]=function(t){for(var i,n=[],o=wt(t),s=o.length-1,a=0;a<=s;a++)i=a===s?this:this.clone(!0),wt(o[a])[e](i),ht.apply(n,i.get());return this.pushStack(n)}});var ce=new RegExp("^("+Gt+")(?!px)[a-z%]+$","i"),de=function(e){var i=e.ownerDocument.defaultView;return i&&i.opener||(i=t),i.getComputedStyle(e)},he=function(t,e,i){var n,o,s={};for(o in e)s[o]=t.style[o],t.style[o]=e[o];n=i.call(t);for(o in e)t.style[o]=s[o];return n},pe=new RegExp(jt.join("|"),"i");!function(){function e(){if(d){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",d.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",qt.appendChild(c).appendChild(d);var e=t.getComputedStyle(d);n="1%"!==e.top,l=12===i(e.marginLeft),d.style.right="60%",a=36===i(e.right),o=36===i(e.width),d.style.position="absolute",s=12===i(d.offsetWidth/3),qt.removeChild(c),d=null}}function i(t){return Math.round(parseFloat(t))}var n,o,s,a,r,l,c=yt.createElement("div"),d=yt.createElement("div");d.style&&(d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",Ct.clearCloneStyle="content-box"===d.style.backgroundClip,wt.extend(Ct,{boxSizingReliable:function(){return e(),o},pixelBoxStyles:function(){return e(),a},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),l},scrollboxSize:function(){return e(),s},reliableTrDimensions:function(){var e,i,n,o;return null==r&&(e=yt.createElement("table"),i=yt.createElement("tr"),n=yt.createElement("div"),e.style.cssText="position:absolute;left:-11111px",i.style.height="1px",n.style.height="9px",qt.appendChild(e).appendChild(i).appendChild(n),o=t.getComputedStyle(i),r=parseInt(o.height)>3,qt.removeChild(e)),r}}))}();var me=["Webkit","Moz","ms"],ue=yt.createElement("div").style,ge={},be=/^(none|table(?!-c[ea]).+)/,fe=/^--/,Ce={position:"absolute",visibility:"hidden",display:"block"},ve={letterSpacing:"0",fontWeight:"400"};wt.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=R(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(t,e,i,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var o,s,a,r=u(e),l=fe.test(e),c=t.style;if(l||(e=O(r)),a=wt.cssHooks[e]||wt.cssHooks[r],void 0===i)return a&&"get"in a&&void 0!==(o=a.get(t,!1,n))?o:c[e];s=typeof i,"string"===s&&(o=Wt.exec(i))&&o[1]&&(i=C(t,e,o),s="number"),null!=i&&i===i&&("number"!==s||l||(i+=o&&o[3]||(wt.cssNumber[r]?"":"px")),Ct.clearCloneStyle||""!==i||0!==e.indexOf("background")||(c[e]="inherit"),a&&"set"in a&&void 0===(i=a.set(t,i,n))||(l?c.setProperty(e,i):c[e]=i))}},css:function(t,e,i,n){var o,s,a,r=u(e);return fe.test(e)||(e=O(r)),a=wt.cssHooks[e]||wt.cssHooks[r],a&&"get"in a&&(o=a.get(t,!0,i)),void 0===o&&(o=R(t,e,n)),"normal"===o&&e in ve&&(o=ve[e]),""===i||i?(s=parseFloat(o),!0===i||isFinite(s)?s||0:o):o}}),wt.each(["height","width"],function(t,e){wt.cssHooks[e]={get:function(t,i,n){if(i)return!be.test(wt.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?$(t,e,n):he(t,Ce,function(){return $(t,e,n)})},set:function(t,i,n){var o,s=de(t),a=!Ct.scrollboxSize()&&"absolute"===s.position,r=a||n,l=r&&"border-box"===wt.css(t,"boxSizing",!1,s),c=n?z(t,e,n,l,s):0;return l&&a&&(c-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(s[e])-z(t,e,"border",!1,s)-.5)),c&&(o=Wt.exec(i))&&"px"!==(o[3]||"px")&&(t.style[e]=i,i=wt.css(t,e)),H(t,i,c)}}}),wt.cssHooks.marginLeft=L(Ct.reliableMarginLeft,function(t,e){if(e)return(parseFloat(R(t,"marginLeft"))||t.getBoundingClientRect().left-he(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}))+"px"}),wt.each({margin:"",padding:"",border:"Width"},function(t,e){wt.cssHooks[t+e]={expand:function(i){for(var n=0,o={},s="string"==typeof i?i.split(" "):[i];n<4;n++)o[t+jt[n]+e]=s[n]||s[n-2]||s[0];return o}},"margin"!==t&&(wt.cssHooks[t+e].set=H)}),wt.fn.extend({css:function(t,e){return Ft(this,function(t,e,i){var n,o,s={},a=0;if(Array.isArray(e)){for(n=de(t),o=e.length;a<o;a++)s[e[a]]=wt.css(t,e[a],!1,n);return s}return void 0!==i?wt.style(t,e,i):wt.css(t,e)},t,e,arguments.length>1)}}),wt.Tween=G,G.prototype={constructor:G,init:function(t,e,i,n,o,s){this.elem=t,this.prop=i,this.easing=o||wt.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=s||(wt.cssNumber[i]?"":"px")},cur:function(){var t=G.propHooks[this.prop];return t&&t.get?t.get(this):G.propHooks._default.get(this)},run:function(t){var e,i=G.propHooks[this.prop];return this.options.duration?this.pos=e=wt.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):G.propHooks._default.set(this),this}},G.prototype.init.prototype=G.prototype,G.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=wt.css(t.elem,t.prop,""),e&&"auto"!==e?e:0)},set:function(t){wt.fx.step[t.prop]?wt.fx.step[t.prop](t):1!==t.elem.nodeType||!wt.cssHooks[t.prop]&&null==t.elem.style[O(t.prop)]?t.elem[t.prop]=t.now:wt.style(t.elem,t.prop,t.now+t.unit)}}},G.propHooks.scrollTop=G.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},wt.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},wt.fx=G.prototype.init,wt.fx.step={};var _e,ye,xe=/^(?:toggle|show|hide)$/,we=/queueHooks$/;wt.Animation=wt.extend(J,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return C(i.elem,t,Wt.exec(e),i),i}]},tweener:function(t,e){vt(t)?(e=t,t=["*"]):t=t.match(Dt);for(var i,n=0,o=t.length;n<o;n++)i=t[n],J.tweeners[i]=J.tweeners[i]||[],J.tweeners[i].unshift(e)},prefilters:[Y],prefilter:function(t,e){e?J.prefilters.unshift(t):J.prefilters.push(t)}}),wt.speed=function(t,e,i){var n=t&&"object"==typeof t?wt.extend({},t):{complete:i||!i&&e||vt(t)&&t,duration:t,easing:i&&e||e&&!vt(e)&&e};return wt.fx.off?n.duration=0:"number"!=typeof n.duration&&(n.duration in wt.fx.speeds?n.duration=wt.fx.speeds[n.duration]:n.duration=wt.fx.speeds._default),null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){vt(n.old)&&n.old.call(this),n.queue&&wt.dequeue(this,n.queue)},n},wt.fn.extend({fadeTo:function(t,e,i,n){return this.filter(Xt).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(t,e,i,n){var o=wt.isEmptyObject(t),s=wt.speed(e,i,n),a=function(){var e=J(this,wt.extend({},t),s);(o||Ot.get(this,"finish"))&&e.stop(!0)};return a.finish=a,o||!1===s.queue?this.each(a):this.queue(s.queue,a)},stop:function(t,e,i){var n=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&this.queue(t||"fx",[]),this.each(function(){var e=!0,o=null!=t&&t+"queueHooks",s=wt.timers,a=Ot.get(this);if(o)a[o]&&a[o].stop&&n(a[o]);else for(o in a)a[o]&&a[o].stop&&we.test(o)&&n(a[o]);for(o=s.length;o--;)s[o].elem!==this||null!=t&&s[o].queue!==t||(s[o].anim.stop(i),e=!1,s.splice(o,1));!e&&i||wt.dequeue(this,t)})},finish:function(t){return!1!==t&&(t=t||"fx"),this.each(function(){var e,i=Ot.get(this),n=i[t+"queue"],o=i[t+"queueHooks"],s=wt.timers,a=n?n.length:0;for(i.finish=!0,wt.queue(this,t,[]),o&&o.stop&&o.stop.call(this,!0),e=s.length;e--;)s[e].elem===this&&s[e].queue===t&&(s[e].anim.stop(!0),s.splice(e,1));for(e=0;e<a;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete i.finish})}}),wt.each(["toggle","show","hide"],function(t,e){var i=wt.fn[e];wt.fn[e]=function(t,n,o){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(q(e,!0),t,n,o)}}),wt.each({slideDown:q("show"),slideUp:q("hide"),slideToggle:q("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){wt.fn[t]=function(t,i,n){return this.animate(e,t,i,n)}}),wt.timers=[],wt.fx.tick=function(){var t,e=0,i=wt.timers;for(_e=Date.now();e<i.length;e++)(t=i[e])()||i[e]!==t||i.splice(e--,1);i.length||wt.fx.stop(),_e=void 0},wt.fx.timer=function(t){wt.timers.push(t),wt.fx.start()},wt.fx.interval=13,wt.fx.start=function(){ye||(ye=!0,W())},wt.fx.stop=function(){ye=null},wt.fx.speeds={slow:600,fast:200,_default:400},wt.fn.delay=function(e,i){return e=wt.fx?wt.fx.speeds[e]||e:e,i=i||"fx",this.queue(i,function(i,n){var o=t.setTimeout(i,e);n.stop=function(){t.clearTimeout(o)}})},function(){var t=yt.createElement("input"),e=yt.createElement("select"),i=e.appendChild(yt.createElement("option"));t.type="checkbox",Ct.checkOn=""!==t.value,Ct.optSelected=i.selected,t=yt.createElement("input"),t.value="t",t.type="radio",Ct.radioValue="t"===t.value}();var Se,Ae=wt.expr.attrHandle;wt.fn.extend({attr:function(t,e){return Ft(this,wt.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){wt.removeAttr(this,t)})}}),wt.extend({attr:function(t,e,i){var n,o,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===t.getAttribute?wt.prop(t,e,i):(1===s&&wt.isXMLDoc(t)||(o=wt.attrHooks[e.toLowerCase()]||(wt.expr.match.bool.test(e)?Se:void 0)),void 0!==i?null===i?void wt.removeAttr(t,e):o&&"set"in o&&void 0!==(n=o.set(t,i,e))?n:(t.setAttribute(e,i+""),i):o&&"get"in o&&null!==(n=o.get(t,e))?n:(n=wt.find.attr(t,e),null==n?void 0:n))},attrHooks:{type:{set:function(t,e){if(!Ct.radioValue&&"radio"===e&&s(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,n=0,o=e&&e.match(Dt);if(o&&1===t.nodeType)for(;i=o[n++];)t.removeAttribute(i)}}),Se={set:function(t,e,i){return!1===e?wt.removeAttr(t,i):t.setAttribute(i,i),i}},wt.each(wt.expr.match.bool.source.match(/\w+/g),function(t,e){var i=Ae[e]||wt.find.attr;Ae[e]=function(t,e,n){var o,s,a=e.toLowerCase();return n||(s=Ae[a],Ae[a]=o,o=null!=i(t,e,n)?a:null,Ae[a]=s),o}});var ke=/^(?:input|select|textarea|button)$/i,Te=/^(?:a|area)$/i;wt.fn.extend({prop:function(t,e){return Ft(this,wt.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[wt.propFix[t]||t]})}}),wt.extend({prop:function(t,e,i){var n,o,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&wt.isXMLDoc(t)||(e=wt.propFix[e]||e,o=wt.propHooks[e]),void 0!==i?o&&"set"in o&&void 0!==(n=o.set(t,i,e))?n:t[e]=i:o&&"get"in o&&null!==(n=o.get(t,e))?n:t[e]},propHooks:{tabIndex:{get:function(t){var e=wt.find.attr(t,"tabindex");return e?parseInt(e,10):ke.test(t.nodeName)||Te.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),Ct.optSelected||(wt.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),wt.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){wt.propFix[this.toLowerCase()]=this}),wt.fn.extend({addClass:function(t){var e,i,n,o,s,a,r,l=0;if(vt(t))return this.each(function(e){wt(this).addClass(t.call(this,e,Q(this)))});if(e=tt(t),e.length)for(;i=this[l++];)if(o=Q(i),n=1===i.nodeType&&" "+Z(o)+" "){for(a=0;s=e[a++];)n.indexOf(" "+s+" ")<0&&(n+=s+" ");r=Z(n),o!==r&&i.setAttribute("class",r)}return this},removeClass:function(t){var e,i,n,o,s,a,r,l=0;if(vt(t))return this.each(function(e){wt(this).removeClass(t.call(this,e,Q(this)))});if(!arguments.length)return this.attr("class","");if(e=tt(t),e.length)for(;i=this[l++];)if(o=Q(i),n=1===i.nodeType&&" "+Z(o)+" "){for(a=0;s=e[a++];)for(;n.indexOf(" "+s+" ")>-1;)n=n.replace(" "+s+" "," ");r=Z(n),o!==r&&i.setAttribute("class",r)}return this},toggleClass:function(t,e){var i=typeof t,n="string"===i||Array.isArray(t);return"boolean"==typeof e&&n?e?this.addClass(t):this.removeClass(t):vt(t)?this.each(function(i){wt(this).toggleClass(t.call(this,i,Q(this),e),e)}):this.each(function(){var e,o,s,a;if(n)for(o=0,s=wt(this),a=tt(t);e=a[o++];)s.hasClass(e)?s.removeClass(e):s.addClass(e);else void 0!==t&&"boolean"!==i||(e=Q(this),e&&Ot.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===t?"":Ot.get(this,"__className__")||""))})},hasClass:function(t){var e,i,n=0;for(e=" "+t+" ";i=this[n++];)if(1===i.nodeType&&(" "+Z(Q(i))+" ").indexOf(e)>-1)return!0;return!1}});var Ie=/\r/g;wt.fn.extend({val:function(t){var e,i,n,o=this[0];{if(arguments.length)return n=vt(t),this.each(function(i){var o;1===this.nodeType&&(o=n?t.call(this,i,wt(this).val()):t,null==o?o="":"number"==typeof o?o+="":Array.isArray(o)&&(o=wt.map(o,function(t){return null==t?"":t+""})),(e=wt.valHooks[this.type]||wt.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,o,"value")||(this.value=o))});if(o)return(e=wt.valHooks[o.type]||wt.valHooks[o.nodeName.toLowerCase()])&&"get"in e&&void 0!==(i=e.get(o,"value"))?i:(i=o.value,"string"==typeof i?i.replace(Ie,""):null==i?"":i)}}}),wt.extend({valHooks:{option:{get:function(t){var e=wt.find.attr(t,"value");return null!=e?e:Z(wt.text(t))}},select:{get:function(t){var e,i,n,o=t.options,a=t.selectedIndex,r="select-one"===t.type,l=r?null:[],c=r?a+1:o.length;for(n=a<0?c:r?a:0;n<c;n++)if(i=o[n],(i.selected||n===a)&&!i.disabled&&(!i.parentNode.disabled||!s(i.parentNode,"optgroup"))){if(e=wt(i).val(),r)return e;l.push(e)}return l},set:function(t,e){for(var i,n,o=t.options,s=wt.makeArray(e),a=o.length;a--;)n=o[a],(n.selected=wt.inArray(wt.valHooks.option.get(n),s)>-1)&&(i=!0);return i||(t.selectedIndex=-1),s}}}}),wt.each(["radio","checkbox"],function(){wt.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=wt.inArray(wt(t).val(),e)>-1}},Ct.checkOn||(wt.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}),Ct.focusin="onfocusin"in t;var Pe=/^(?:focusinfocus|focusoutblur)$/,Me=function(t){t.stopPropagation()};wt.extend(wt.event,{trigger:function(e,i,n,o){var s,a,r,l,c,d,h,p,m=[n||yt],u=gt.call(e,"type")?e.type:e,g=gt.call(e,"namespace")?e.namespace.split("."):[];if(a=p=r=n=n||yt,3!==n.nodeType&&8!==n.nodeType&&!Pe.test(u+wt.event.triggered)&&(u.indexOf(".")>-1&&(g=u.split("."),u=g.shift(),g.sort()),c=u.indexOf(":")<0&&"on"+u,e=e[wt.expando]?e:new wt.Event(u,"object"==typeof e&&e),e.isTrigger=o?2:3,e.namespace=g.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),i=null==i?[e]:wt.makeArray(i,[e]),h=wt.event.special[u]||{},o||!h.trigger||!1!==h.trigger.apply(n,i))){if(!o&&!h.noBubble&&!_t(n)){for(l=h.delegateType||u,Pe.test(l+u)||(a=a.parentNode);a;a=a.parentNode)m.push(a),r=a;r===(n.ownerDocument||yt)&&m.push(r.defaultView||r.parentWindow||t)}for(s=0;(a=m[s++])&&!e.isPropagationStopped();)p=a,e.type=s>1?l:h.bindType||u,d=(Ot.get(a,"events")||Object.create(null))[e.type]&&Ot.get(a,"handle"),d&&d.apply(a,i),(d=c&&a[c])&&d.apply&&Nt(a)&&(e.result=d.apply(a,i),!1===e.result&&e.preventDefault());return e.type=u,o||e.isDefaultPrevented()||h._default&&!1!==h._default.apply(m.pop(),i)||!Nt(n)||c&&vt(n[u])&&!_t(n)&&(r=n[c],r&&(n[c]=null),wt.event.triggered=u,e.isPropagationStopped()&&p.addEventListener(u,Me),n[u](),e.isPropagationStopped()&&p.removeEventListener(u,Me),wt.event.triggered=void 0,r&&(n[c]=r)),e.result}},simulate:function(t,e,i){var n=wt.extend(new wt.Event,i,{type:t,isSimulated:!0})
;wt.event.trigger(n,null,e)}}),wt.fn.extend({trigger:function(t,e){return this.each(function(){wt.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];if(i)return wt.event.trigger(t,e,i,!0)}}),Ct.focusin||wt.each({focus:"focusin",blur:"focusout"},function(t,e){var i=function(t){wt.event.simulate(e,t.target,wt.event.fix(t))};wt.event.special[e]={setup:function(){var n=this.ownerDocument||this.document||this,o=Ot.access(n,e);o||n.addEventListener(t,i,!0),Ot.access(n,e,(o||0)+1)},teardown:function(){var n=this.ownerDocument||this.document||this,o=Ot.access(n,e)-1;o?Ot.access(n,e,o):(n.removeEventListener(t,i,!0),Ot.remove(n,e))}}});var Ue=t.location,Be={guid:Date.now()},De=/\?/;wt.parseXML=function(e){var i;if(!e||"string"!=typeof e)return null;try{i=(new t.DOMParser).parseFromString(e,"text/xml")}catch(t){i=void 0}return i&&!i.getElementsByTagName("parsererror").length||wt.error("Invalid XML: "+e),i};var Ee=/\[\]$/,Ve=/\r?\n/g,Fe=/^(?:submit|button|image|reset|file)$/i,Re=/^(?:input|select|textarea|keygen)/i;wt.param=function(t,e){var i,n=[],o=function(t,e){var i=vt(e)?e():e;n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==i?"":i)};if(null==t)return"";if(Array.isArray(t)||t.jquery&&!wt.isPlainObject(t))wt.each(t,function(){o(this.name,this.value)});else for(i in t)et(i,t[i],e,o);return n.join("&")},wt.fn.extend({serialize:function(){return wt.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=wt.prop(this,"elements");return t?wt.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!wt(this).is(":disabled")&&Re.test(this.nodeName)&&!Fe.test(t)&&(this.checked||!Zt.test(t))}).map(function(t,e){var i=wt(this).val();return null==i?null:Array.isArray(i)?wt.map(i,function(t){return{name:e.name,value:t.replace(Ve,"\r\n")}}):{name:e.name,value:i.replace(Ve,"\r\n")}}).get()}});var Le=/%20/g,Ne=/#.*$/,Oe=/([?&])_=[^&]*/,He=/^(.*?):[ \t]*([^\r\n]*)$/gm,ze=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,$e=/^(?:GET|HEAD)$/,Ge=/^\/\//,We={},je={},qe="*/".concat("*"),Ke=yt.createElement("a");Ke.href=Ue.href,wt.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ue.href,type:"GET",isLocal:ze.test(Ue.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":qe,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":wt.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?ot(ot(t,wt.ajaxSettings),e):ot(wt.ajaxSettings,t)},ajaxPrefilter:it(We),ajaxTransport:it(je),ajax:function(e,i){function n(e,i,n,r){var c,p,m,_,y,x=i;d||(d=!0,l&&t.clearTimeout(l),o=void 0,a=r||"",w.readyState=e>0?4:0,c=e>=200&&e<300||304===e,n&&(_=st(u,w,n)),!c&&wt.inArray("script",u.dataTypes)>-1&&(u.converters["text script"]=function(){}),_=at(u,_,w,c),c?(u.ifModified&&(y=w.getResponseHeader("Last-Modified"),y&&(wt.lastModified[s]=y),(y=w.getResponseHeader("etag"))&&(wt.etag[s]=y)),204===e||"HEAD"===u.type?x="nocontent":304===e?x="notmodified":(x=_.state,p=_.data,m=_.error,c=!m)):(m=x,!e&&x||(x="error",e<0&&(e=0))),w.status=e,w.statusText=(i||x)+"",c?f.resolveWith(g,[p,x,w]):f.rejectWith(g,[w,x,m]),w.statusCode(v),v=void 0,h&&b.trigger(c?"ajaxSuccess":"ajaxError",[w,u,c?p:m]),C.fireWith(g,[w,x]),h&&(b.trigger("ajaxComplete",[w,u]),--wt.active||wt.event.trigger("ajaxStop")))}"object"==typeof e&&(i=e,e=void 0),i=i||{};var o,s,a,r,l,c,d,h,p,m,u=wt.ajaxSetup({},i),g=u.context||u,b=u.context&&(g.nodeType||g.jquery)?wt(g):wt.event,f=wt.Deferred(),C=wt.Callbacks("once memory"),v=u.statusCode||{},_={},y={},x="canceled",w={readyState:0,getResponseHeader:function(t){var e;if(d){if(!r)for(r={};e=He.exec(a);)r[e[1].toLowerCase()+" "]=(r[e[1].toLowerCase()+" "]||[]).concat(e[2]);e=r[t.toLowerCase()+" "]}return null==e?null:e.join(", ")},getAllResponseHeaders:function(){return d?a:null},setRequestHeader:function(t,e){return null==d&&(t=y[t.toLowerCase()]=y[t.toLowerCase()]||t,_[t]=e),this},overrideMimeType:function(t){return null==d&&(u.mimeType=t),this},statusCode:function(t){var e;if(t)if(d)w.always(t[w.status]);else for(e in t)v[e]=[v[e],t[e]];return this},abort:function(t){var e=t||x;return o&&o.abort(e),n(0,e),this}};if(f.promise(w),u.url=((e||u.url||Ue.href)+"").replace(Ge,Ue.protocol+"//"),u.type=i.method||i.type||u.method||u.type,u.dataTypes=(u.dataType||"*").toLowerCase().match(Dt)||[""],null==u.crossDomain){c=yt.createElement("a");try{c.href=u.url,c.href=c.href,u.crossDomain=Ke.protocol+"//"+Ke.host!=c.protocol+"//"+c.host}catch(t){u.crossDomain=!0}}if(u.data&&u.processData&&"string"!=typeof u.data&&(u.data=wt.param(u.data,u.traditional)),nt(We,u,i,w),d)return w;h=wt.event&&u.global,h&&0==wt.active++&&wt.event.trigger("ajaxStart"),u.type=u.type.toUpperCase(),u.hasContent=!$e.test(u.type),s=u.url.replace(Ne,""),u.hasContent?u.data&&u.processData&&0===(u.contentType||"").indexOf("application/x-www-form-urlencoded")&&(u.data=u.data.replace(Le,"+")):(m=u.url.slice(s.length),u.data&&(u.processData||"string"==typeof u.data)&&(s+=(De.test(s)?"&":"?")+u.data,delete u.data),!1===u.cache&&(s=s.replace(Oe,"$1"),m=(De.test(s)?"&":"?")+"_="+Be.guid+++m),u.url=s+m),u.ifModified&&(wt.lastModified[s]&&w.setRequestHeader("If-Modified-Since",wt.lastModified[s]),wt.etag[s]&&w.setRequestHeader("If-None-Match",wt.etag[s])),(u.data&&u.hasContent&&!1!==u.contentType||i.contentType)&&w.setRequestHeader("Content-Type",u.contentType),w.setRequestHeader("Accept",u.dataTypes[0]&&u.accepts[u.dataTypes[0]]?u.accepts[u.dataTypes[0]]+("*"!==u.dataTypes[0]?", "+qe+"; q=0.01":""):u.accepts["*"]);for(p in u.headers)w.setRequestHeader(p,u.headers[p]);if(u.beforeSend&&(!1===u.beforeSend.call(g,w,u)||d))return w.abort();if(x="abort",C.add(u.complete),w.done(u.success),w.fail(u.error),o=nt(je,u,i,w)){if(w.readyState=1,h&&b.trigger("ajaxSend",[w,u]),d)return w;u.async&&u.timeout>0&&(l=t.setTimeout(function(){w.abort("timeout")},u.timeout));try{d=!1,o.send(_,n)}catch(t){if(d)throw t;n(-1,t)}}else n(-1,"No Transport");return w},getJSON:function(t,e,i){return wt.get(t,e,i,"json")},getScript:function(t,e){return wt.get(t,void 0,e,"script")}}),wt.each(["get","post"],function(t,e){wt[e]=function(t,i,n,o){return vt(i)&&(o=o||n,n=i,i=void 0),wt.ajax(wt.extend({url:t,type:e,dataType:o,data:i,success:n},wt.isPlainObject(t)&&t))}}),wt.ajaxPrefilter(function(t){var e;for(e in t.headers)"content-type"===e.toLowerCase()&&(t.contentType=t.headers[e]||"")}),wt._evalUrl=function(t,e,i){return wt.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(t){wt.globalEval(t,e,i)}})},wt.fn.extend({wrapAll:function(t){var e;return this[0]&&(vt(t)&&(t=t.call(this[0])),e=wt(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this},wrapInner:function(t){return vt(t)?this.each(function(e){wt(this).wrapInner(t.call(this,e))}):this.each(function(){var e=wt(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=vt(t);return this.each(function(i){wt(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(t){return this.parent(t).not("body").each(function(){wt(this).replaceWith(this.childNodes)}),this}}),wt.expr.pseudos.hidden=function(t){return!wt.expr.pseudos.visible(t)},wt.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},wt.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch(t){}};var Ye={0:200,1223:204},Xe=wt.ajaxSettings.xhr();Ct.cors=!!Xe&&"withCredentials"in Xe,Ct.ajax=Xe=!!Xe,wt.ajaxTransport(function(e){var i,n;if(Ct.cors||Xe&&!e.crossDomain)return{send:function(o,s){var a,r=e.xhr();if(r.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(a in e.xhrFields)r[a]=e.xhrFields[a];e.mimeType&&r.overrideMimeType&&r.overrideMimeType(e.mimeType),e.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest");for(a in o)r.setRequestHeader(a,o[a]);i=function(t){return function(){i&&(i=n=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===t?r.abort():"error"===t?"number"!=typeof r.status?s(0,"error"):s(r.status,r.statusText):s(Ye[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=i(),n=r.onerror=r.ontimeout=i("error"),void 0!==r.onabort?r.onabort=n:r.onreadystatechange=function(){4===r.readyState&&t.setTimeout(function(){i&&n()})},i=i("abort");try{r.send(e.hasContent&&e.data||null)}catch(t){if(i)throw t}},abort:function(){i&&i()}}}),wt.ajaxPrefilter(function(t){t.crossDomain&&(t.contents.script=!1)}),wt.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return wt.globalEval(t),t}}}),wt.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),wt.ajaxTransport("script",function(t){if(t.crossDomain||t.scriptAttrs){var e,i;return{send:function(n,o){e=wt("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&o("error"===t.type?404:200,t.type)}),yt.head.appendChild(e[0])},abort:function(){i&&i()}}}});var Je=[],Ze=/(=)\?(?=&|$)|\?\?/;wt.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Je.pop()||wt.expando+"_"+Be.guid++;return this[t]=!0,t}}),wt.ajaxPrefilter("json jsonp",function(e,i,n){var o,s,a,r=!1!==e.jsonp&&(Ze.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ze.test(e.data)&&"data");if(r||"jsonp"===e.dataTypes[0])return o=e.jsonpCallback=vt(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,r?e[r]=e[r].replace(Ze,"$1"+o):!1!==e.jsonp&&(e.url+=(De.test(e.url)?"&":"?")+e.jsonp+"="+o),e.converters["script json"]=function(){return a||wt.error(o+" was not called"),a[0]},e.dataTypes[0]="json",s=t[o],t[o]=function(){a=arguments},n.always(function(){void 0===s?wt(t).removeProp(o):t[o]=s,e[o]&&(e.jsonpCallback=i.jsonpCallback,Je.push(o)),a&&vt(s)&&s(a[0]),a=s=void 0}),"script"}),Ct.createHTMLDocument=function(){var t=yt.implementation.createHTMLDocument("").body;return t.innerHTML="<form></form><form></form>",2===t.childNodes.length}(),wt.parseHTML=function(t,e,i){if("string"!=typeof t)return[];"boolean"==typeof e&&(i=e,e=!1);var n,o,s;return e||(Ct.createHTMLDocument?(e=yt.implementation.createHTMLDocument(""),n=e.createElement("base"),n.href=yt.location.href,e.head.appendChild(n)):e=yt),o=It.exec(t),s=!i&&[],o?[e.createElement(o[1])]:(o=w([t],e,s),s&&s.length&&wt(s).remove(),wt.merge([],o.childNodes))},wt.fn.load=function(t,e,i){var n,o,s,a=this,r=t.indexOf(" ");return r>-1&&(n=Z(t.slice(r)),t=t.slice(0,r)),vt(e)?(i=e,e=void 0):e&&"object"==typeof e&&(o="POST"),a.length>0&&wt.ajax({url:t,type:o||"GET",dataType:"html",data:e}).done(function(t){s=arguments,a.html(n?wt("<div>").append(wt.parseHTML(t)).find(n):t)}).always(i&&function(t,e){a.each(function(){i.apply(this,s||[t.responseText,e,t])})}),this},wt.expr.pseudos.animated=function(t){return wt.grep(wt.timers,function(e){return t===e.elem}).length},wt.offset={setOffset:function(t,e,i){var n,o,s,a,r,l,c,d=wt.css(t,"position"),h=wt(t),p={};"static"===d&&(t.style.position="relative"),r=h.offset(),s=wt.css(t,"top"),l=wt.css(t,"left"),c=("absolute"===d||"fixed"===d)&&(s+l).indexOf("auto")>-1,c?(n=h.position(),a=n.top,o=n.left):(a=parseFloat(s)||0,o=parseFloat(l)||0),vt(e)&&(e=e.call(t,i,wt.extend({},r))),null!=e.top&&(p.top=e.top-r.top+a),null!=e.left&&(p.left=e.left-r.left+o),"using"in e?e.using.call(t,p):("number"==typeof p.top&&(p.top+="px"),"number"==typeof p.left&&(p.left+="px"),h.css(p))}},wt.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){wt.offset.setOffset(this,t,e)});var e,i,n=this[0];if(n)return n.getClientRects().length?(e=n.getBoundingClientRect(),i=n.ownerDocument.defaultView,{top:e.top+i.pageYOffset,left:e.left+i.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var t,e,i,n=this[0],o={top:0,left:0};if("fixed"===wt.css(n,"position"))e=n.getBoundingClientRect();else{for(e=this.offset(),i=n.ownerDocument,t=n.offsetParent||i.documentElement;t&&(t===i.body||t===i.documentElement)&&"static"===wt.css(t,"position");)t=t.parentNode;t&&t!==n&&1===t.nodeType&&(o=wt(t).offset(),o.top+=wt.css(t,"borderTopWidth",!0),o.left+=wt.css(t,"borderLeftWidth",!0))}return{top:e.top-o.top-wt.css(n,"marginTop",!0),left:e.left-o.left-wt.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&"static"===wt.css(t,"position");)t=t.offsetParent;return t||qt})}}),wt.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,e){var i="pageYOffset"===e;wt.fn[t]=function(n){return Ft(this,function(t,n,o){var s;if(_t(t)?s=t:9===t.nodeType&&(s=t.defaultView),void 0===o)return s?s[e]:t[n];s?s.scrollTo(i?s.pageXOffset:o,i?o:s.pageYOffset):t[n]=o},t,n,arguments.length)}}),wt.each(["top","left"],function(t,e){wt.cssHooks[e]=L(Ct.pixelPosition,function(t,i){if(i)return i=R(t,e),ce.test(i)?wt(t).position()[e]+"px":i})}),wt.each({Height:"height",Width:"width"},function(t,e){wt.each({padding:"inner"+t,content:e,"":"outer"+t},function(i,n){wt.fn[n]=function(o,s){var a=arguments.length&&(i||"boolean"!=typeof o),r=i||(!0===o||!0===s?"margin":"border");return Ft(this,function(e,i,o){var s;return _t(e)?0===n.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(s=e.documentElement,Math.max(e.body["scroll"+t],s["scroll"+t],e.body["offset"+t],s["offset"+t],s["client"+t])):void 0===o?wt.css(e,i,r):wt.style(e,i,o,r)},e,a?o:void 0,a)}})}),wt.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){wt.fn[e]=function(t){return this.on(e,t)}}),wt.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),wt.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(t,e){wt.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}});var Qe=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;wt.proxy=function(t,e){var i,n,o;if("string"==typeof e&&(i=t[e],e=t,t=i),vt(t))return n=ct.call(arguments,2),o=function(){return t.apply(e||this,n.concat(ct.call(arguments)))},o.guid=t.guid=t.guid||wt.guid++,o},wt.holdReady=function(t){t?wt.readyWait++:wt.ready(!0)},wt.isArray=Array.isArray,wt.parseJSON=JSON.parse,wt.nodeName=s,wt.isFunction=vt,wt.isWindow=_t,wt.camelCase=u,wt.type=n,wt.now=Date.now,wt.isNumeric=function(t){var e=wt.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},wt.trim=function(t){return null==t?"":(t+"").replace(Qe,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return wt});var ti=t.jQuery,ei=t.$;return wt.noConflict=function(e){return t.$===wt&&(t.$=ei),e&&t.jQuery===wt&&(t.jQuery=ti),wt},void 0===e&&(t.jQuery=t.$=wt),wt}),function(){var t,e=this,i=e.Backbone,n=[],o=n.slice;t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="1.1.0";var s=e._;s||"undefined"==typeof require||(s=require("underscore")),t.$=e.jQuery||e.Zepto||e.ender||e.$,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a=t.Events={on:function(t,e,i){return l(this,"on",t,[e,i])&&e?(this._events||(this._events={}),(this._events[t]||(this._events[t]=[])).push({callback:e,context:i,ctx:i||this}),this):this},once:function(t,e,i){if(!l(this,"once",t,[e,i])||!e)return this;var n=this,o=s.once(function(){n.off(t,o),e.apply(this,arguments)});return o._callback=e,this.on(t,o,i)},off:function(t,e,i){var n,o,a,r,c,d,h,p;if(!this._events||!l(this,"off",t,[e,i]))return this;if(!t&&!e&&!i)return this._events={},this;for(r=t?[t]:s.keys(this._events),c=0,d=r.length;c<d;c++)if(t=r[c],a=this._events[t]){if(this._events[t]=n=[],e||i)for(h=0,p=a.length;h<p;h++)o=a[h],(e&&e!==o.callback&&e!==o.callback._callback||i&&i!==o.context)&&n.push(o);n.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=o.call(arguments,1);if(!l(this,"trigger",t,e))return this;var i=this._events[t],n=this._events.all;return i&&c(i,e),n&&c(n,arguments),this},stopListening:function(t,e,i){var n=this._listeningTo;if(!n)return this;var o=!e&&!i;i||"object"!=typeof e||(i=this),t&&((n={})[t._listenId]=t);for(var a in n)t=n[a],t.off(e,i,this),(o||s.isEmpty(t._events))&&delete this._listeningTo[a];return this}},r=/\s+/,l=function(t,e,i,n){if(!i)return!0;if("object"==typeof i){for(var o in i)t[e].apply(t,[o,i[o]].concat(n));return!1}if(r.test(i)){for(var s=i.split(r),a=0,l=s.length;a<l;a++)t[e].apply(t,[s[a]].concat(n));return!1}return!0},c=function(t,e){var i,n=-1,o=t.length,s=e[0],a=e[1],r=e[2];switch(e.length){case 0:for(;++n<o;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<o;)(i=t[n]).callback.call(i.ctx,s);return;case 2:for(;++n<o;)(i=t[n]).callback.call(i.ctx,s,a);return;case 3:for(;++n<o;)(i=t[n]).callback.call(i.ctx,s,a,r);return;default:for(;++n<o;)(i=t[n]).callback.apply(i.ctx,e)}},d={listenTo:"on",listenToOnce:"once"};s.each(d,function(t,e){a[e]=function(e,i,n){return(this._listeningTo||(this._listeningTo={}))[e._listenId||(e._listenId=s.uniqueId("l"))]=e,n||"object"!=typeof i||(n=this),e[t](i,n,this),this}}),a.bind=a.on,a.unbind=a.off,s.extend(t,a);var h=t.Model=function(t,e){var i=t||{};e||(e={}),this.cid=s.uniqueId("c"),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(i=this.parse(i,e)||{}),i=s.defaults({},i,s.result(this,"defaults")),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};s.extend(h.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(t){return s.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return s.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,i){var n,o,a,r,l,c,d,h;if(null==t)return this;if("object"==typeof t?(o=t,i=e):(o={})[t]=e,i||(i={}),!this._validate(o,i))return!1;a=i.unset,l=i.silent,r=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=s.clone(this.attributes),this.changed={}),h=this.attributes,d=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]);for(n in o)e=o[n],s.isEqual(h[n],e)||r.push(n),s.isEqual(d[n],e)?delete this.changed[n]:this.changed[n]=e,a?delete h[n]:h[n]=e;if(!l){r.length&&(this._pending=!0);for(var p=0,m=r.length;p<m;p++)this.trigger("change:"+r[p],this,h[r[p]],i)}if(c)return this;if(!l)for(;this._pending;)this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,s.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,s.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!s.isEmpty(this.changed):s.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&s.clone(this.changed);var e,i=!1,n=this._changing?this._previousAttributes:this.attributes;for(var o in t)s.isEqual(n[o],e=t[o])||((i||(i={}))[o]=e);return i},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return s.clone(this._previousAttributes)},fetch:function(t){t=t?s.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=this,i=t.success;return t.success=function(n){if(!e.set(e.parse(n,t),t))return!1;i&&i(e,n,t),e.trigger("sync",e,n,t)},F(this,t),this.sync("read",this,t)},save:function(t,e,i){var n,o,a,r=this.attributes;if(null==t||"object"==typeof t?(n=t,i=e):(n={})[t]=e,i=s.extend({validate:!0},i),n&&!i.wait){if(!this.set(n,i))return!1}else if(!this._validate(n,i))return!1;n&&i.wait&&(this.attributes=s.extend({},r,n)),void 0===i.parse&&(i.parse=!0);var l=this,c=i.success;return i.success=function(t){l.attributes=r;var e=l.parse(t,i);if(i.wait&&(e=s.extend(n||{},e)),s.isObject(e)&&!l.set(e,i))return!1;c&&c(l,t,i),l.trigger("sync",l,t,i)},F(this,i),o=this.isNew()?"create":i.patch?"patch":"update","patch"===o&&(i.attrs=n),a=this.sync(o,this,i),n&&i.wait&&(this.attributes=r),a},destroy:function(t){t=t?s.clone(t):{};var e=this,i=t.success,n=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(o){(t.wait||e.isNew())&&n(),i&&i(e,o,t),e.isNew()||e.trigger("sync",e,o,t)},this.isNew())return t.success(),!1;F(this,t);var o=this.sync("delete",this,t);return t.wait||n(),o},url:function(){var t=s.result(this,"urlRoot")||s.result(this.collection,"url")||V();return this.isNew()?t:t+("/"===t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(t){return this._validate({},s.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=s.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;return!i||(this.trigger("invalid",this,i,s.extend(e,{validationError:i})),!1)}});var p=["keys","values","pairs","invert","pick","omit"];s.each(p,function(t){h.prototype[t]=function(){var e=o.call(arguments);return e.unshift(this.attributes),s[t].apply(s,e)}});var m=t.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,s.extend({silent:!0},e))},u={add:!0,remove:!0,merge:!0},g={add:!0,remove:!1};s.extend(m.prototype,a,{model:h,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return t.sync.apply(this,arguments)},add:function(t,e){return this.set(t,s.extend({merge:!1},e,g))},remove:function(t,e){var i=!s.isArray(t);t=i?[t]:s.clone(t),e||(e={});var n,o,a,r;for(n=0,o=t.length;n<o;n++)(r=t[n]=this.get(t[n]))&&(delete this._byId[r.id],delete this._byId[r.cid],a=this.indexOf(r),this.models.splice(a,1),this.length--,e.silent||(e.index=a,r.trigger("remove",r,this,e)),this._removeReference(r));return i?t[0]:t},set:function(t,e){e=s.defaults({},e,u),e.parse&&(t=this.parse(t,e));var i=!s.isArray(t);t=i?t?[t]:[]:s.clone(t);var n,o,a,r,l,c,d,p=e.at,m=this.model,g=this.comparator&&null==p&&!1!==e.sort,b=s.isString(this.comparator)?this.comparator:null,f=[],C=[],v={},_=e.add,y=e.merge,x=e.remove,w=!(g||!_||!x)&&[];for(n=0,o=t.length;n<o;n++){if(l=t[n],a=l instanceof h?r=l:l[m.prototype.idAttribute],c=this.get(a))x&&(v[c.cid]=!0),y&&(l=l===r?r.attributes:l,e.parse&&(l=c.parse(l,e)),c.set(l,e),g&&!d&&c.hasChanged(b)&&(d=!0)),t[n]=c;else if(_){if(!(r=t[n]=this._prepareModel(l,e)))continue;f.push(r),r.on("all",this._onModelEvent,this),this._byId[r.cid]=r,null!=r.id&&(this._byId[r.id]=r)}w&&w.push(c||r)}if(x){for(n=0,o=this.length;n<o;++n)v[(r=this.models[n]).cid]||C.push(r);C.length&&this.remove(C,e)}if(f.length||w&&w.length)if(g&&(d=!0),this.length+=f.length,null!=p)for(n=0,o=f.length;n<o;n++)this.models.splice(p+n,0,f[n]);else{w&&(this.models.length=0);var S=w||f;for(n=0,o=S.length;n<o;n++)this.models.push(S[n])}if(d&&this.sort({silent:!0}),!e.silent){for(n=0,o=f.length;n<o;n++)(r=f[n]).trigger("add",r,this,e);(d||w&&w.length)&&this.trigger("sort",this,e)}return i?t[0]:t},reset:function(t,e){e||(e={});for(var i=0,n=this.models.length;i<n;i++)this._removeReference(this.models[i]);return e.previousModels=this.models,this._reset(),t=this.add(t,s.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,s.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,s.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return o.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t.id]||this._byId[t.cid]||this._byId[t]},at:function(t){return this.models[t]},where:function(t,e){return s.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),s.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(s.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return s.invoke(this.models,"get",t)},fetch:function(t){t=t?s.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=t.success,i=this;return t.success=function(n){var o=t.reset?"reset":"set";i[o](n,t),e&&e(i,n,t),i.trigger("sync",i,n,t)},F(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?s.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var i=this,n=e.success;return e.success=function(t,e,o){o.wait&&i.add(t,o),n&&n(t,e,o)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof h)return t.collection||(t.collection=this),t;e=e?s.clone(e):{},e.collection=this;var i=new this.model(t,e);return i.validationError?(this.trigger("invalid",this,i.validationError,e),!1):i},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){("add"!==t&&"remove"!==t||i===this)&&("destroy"===t&&this.remove(e,n),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];s.each(b,function(t){m.prototype[t]=function(){var e=o.call(arguments);return e.unshift(this.models),s[t].apply(s,e)}});var f=["groupBy","countBy","sortBy"];s.each(f,function(t){m.prototype[t]=function(e,i){var n=s.isFunction(e)?e:function(t){return t.get(e)};return s[t](this.models,n,i)}});var C=t.View=function(t){this.cid=s.uniqueId("view"),t||(t={}),s.extend(this,s.pick(t,_)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},v=/^(\S+)\s*(.*)$/,_=["model","collection","el","id","attributes","className","tagName","events"];s.extend(C.prototype,a,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,i){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],!1!==i&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=s.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var i=t[e];if(s.isFunction(i)||(i=this[t[e]]),i){var n=e.match(v),o=n[1],a=n[2];i=s.bind(i,this),o+=".delegateEvents"+this.cid,""===a?this.$el.on(o,i):this.$el.on(o,a,i)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(s.result(this,"el"),!1);else{var e=s.extend({},s.result(this,"attributes"));this.id&&(e.id=s.result(this,"id")),this.className&&(e.class=s.result(this,"className"));var i=t.$("<"+s.result(this,"tagName")+">").attr(e);this.setElement(i,!1)}}}),t.sync=function(e,i,n){var o=x[e];s.defaults(n||(n={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var a={type:o,dataType:"json"};if(n.url||(a.url=s.result(i,"url")||V()),null!=n.data||!i||"create"!==e&&"update"!==e&&"patch"!==e||(a.contentType="application/json",a.data=JSON.stringify(n.attrs||i.toJSON(n))),n.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),n.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){a.type="POST",n.emulateJSON&&(a.data._method=o);var r=n.beforeSend;n.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",o),r)return r.apply(this,arguments)}}"GET"===a.type||n.emulateJSON||(a.processData=!1),"PATCH"===a.type&&y&&(a.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=n.xhr=t.ajax(s.extend(a,n));return i.trigger("request",i,l,n),l};var y=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),x={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var w=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},S=/\((.*?)\)/g,A=/(\(\?)?:\w+/g,k=/\*\w+/g,T=/[\-{}\[\]+?.,\\\^$|#\s]/g;s.extend(w.prototype,a,{initialize:function(){},route:function(e,i,n){s.isRegExp(e)||(e=this._routeToRegExp(e)),s.isFunction(i)&&(n=i,i=""),n||(n=this[i]);var o=this;return t.history.route(e,function(s){var a=o._extractParameters(e,s);n&&n.apply(o,a),o.trigger.apply(o,["route:"+i].concat(a)),o.trigger("route",i,a),t.history.trigger("route",o,i,a)}),this},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=s.result(this,"routes");for(var t,e=s.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(T,"\\$&").replace(S,"(?:$1)?").replace(A,function(t,e){return e?t:"([^/]+)"}).replace(k,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return s.map(i,function(t){return t?decodeURIComponent(t):null})}});var I=t.History=function(){this.handlers=[],s.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},P=/^[#\/]|\s+$/g,M=/^\/+|\/+$/g,U=/msie [\w.]+/,B=/\/$/,D=/[?#].*$/;I.started=!1,s.extend(I.prototype,a,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var i=this.root.replace(B,"");t.indexOf(i)||(t=t.slice(i.length))}else t=this.getHash();return t.replace(P,"")},start:function(e){if(I.started)throw new Error("Backbone.history has already been started");I.started=!0,this.options=s.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var i=this.getFragment(),n=document.documentMode,o=U.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(M,"/"),o&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(i)),
this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!o?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=i;var a=this.location,r=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!r)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&r&&a.hash&&(this.fragment=this.getHash().replace(P,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),I.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(t){return t=this.fragment=this.getFragment(t),s.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0})},navigate:function(t,e){if(!I.started)return!1;e&&!0!==e||(e={trigger:!!e});var i=this.root+(t=this.getFragment(t||""));if(t=t.replace(D,""),this.fragment!==t){if(this.fragment=t,""===t&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),t.history=new I;var E=function(t,e){var i,n=this;i=t&&s.has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},s.extend(i,n,e);var o=function(){this.constructor=i};return o.prototype=n.prototype,i.prototype=new o,t&&s.extend(i.prototype,t),i.__super__=n.prototype,i};h.extend=m.extend=w.extend=C.extend=I.extend=E;var V=function(){throw new Error('A "url" property or function must be specified')},F=function(t,e){var i=e.error;e.error=function(n){i&&i(t,n,e),t.trigger("error",t,n,e)}}}.call(this),define("backbone",["underscore","jquery"],function(t){return function(){return t.Backbone}}(this)),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");if(function(t){"use strict";var e=t.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<9||1==e[0]&&9==e[1]&&e[2]<1||e[0]>3)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(jQuery),function(t){"use strict";function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(void 0!==t.style[i])return{end:e[i]};return!1}t.fn.emulateTransitionEnd=function(e){var i=!1,n=this;t(this).one("bsTransitionEnd",function(){i=!0});var o=function(){i||t(n).trigger(t.support.transition.end)};return setTimeout(o,e),this},t(function(){t.support.transition=e(),t.support.transition&&(t.event.special.bsTransitionEnd={bindType:t.support.transition.end,delegateType:t.support.transition.end,handle:function(e){if(t(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}})})}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var i=t(this),o=i.data("bs.alert");o||i.data("bs.alert",o=new n(this)),"string"==typeof e&&o[e].call(i)})}var i='[data-dismiss="alert"]',n=function(e){t(e).on("click",i,this.close)};n.VERSION="3.3.7",n.TRANSITION_DURATION=150,n.prototype.close=function(e){function i(){a.detach().trigger("closed.bs.alert").remove()}var o=t(this),s=o.attr("data-target");s||(s=o.attr("href"),s=s&&s.replace(/.*(?=#[^\s]*$)/,""));var a=t("#"===s?[]:s);e&&e.preventDefault(),a.length||(a=o.closest(".alert")),a.trigger(e=t.Event("close.bs.alert")),e.isDefaultPrevented()||(a.removeClass("in"),t.support.transition&&a.hasClass("fade")?a.one("bsTransitionEnd",i).emulateTransitionEnd(n.TRANSITION_DURATION):i())};var o=t.fn.alert;t.fn.alert=e,t.fn.alert.Constructor=n,t.fn.alert.noConflict=function(){return t.fn.alert=o,this},t(document).on("click.bs.alert.data-api",i,n.prototype.close)}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),o=n.data("bs.button"),s="object"==typeof e&&e;o||n.data("bs.button",o=new i(this,s)),"toggle"==e?o.toggle():e&&o.setState(e)})}var i=function(e,n){this.$element=t(e),this.options=t.extend({},i.DEFAULTS,n),this.isLoading=!1};i.VERSION="3.3.7",i.DEFAULTS={loadingText:"loading..."},i.prototype.setState=function(e){var i="disabled",n=this.$element,o=n.is("input")?"val":"html",s=n.data();e+="Text",null==s.resetText&&n.data("resetText",n[o]()),setTimeout(t.proxy(function(){n[o](null==s[e]?this.options[e]:s[e]),"loadingText"==e?(this.isLoading=!0,n.addClass(i).attr(i,i).prop(i,!0)):this.isLoading&&(this.isLoading=!1,n.removeClass(i).removeAttr(i).prop(i,!1))},this),0)},i.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var i=this.$element.find("input");"radio"==i.prop("type")?(i.prop("checked")&&(t=!1),e.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==i.prop("type")&&(i.prop("checked")!==this.$element.hasClass("active")&&(t=!1),this.$element.toggleClass("active")),i.prop("checked",this.$element.hasClass("active")),t&&i.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var n=t.fn.button;t.fn.button=e,t.fn.button.Constructor=i,t.fn.button.noConflict=function(){return t.fn.button=n,this},t(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(i){var n=t(i.target).closest(".btn");e.call(n,"toggle"),t(i.target).is('input[type="radio"], input[type="checkbox"]')||(i.preventDefault(),n.is("input,button")?n.trigger("focus"):n.find("input:visible,button:visible").first().trigger("focus"))}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(e){t(e.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(e.type))})}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),o=n.data("bs.carousel"),s=t.extend({},i.DEFAULTS,n.data(),"object"==typeof e&&e),a="string"==typeof e?e:s.slide;o||n.data("bs.carousel",o=new i(this,s)),"number"==typeof e?o.to(e):a?o[a]():s.interval&&o.pause().cycle()})}var i=function(e,i){this.$element=t(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=i,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",t.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",t.proxy(this.pause,this)).on("mouseleave.bs.carousel",t.proxy(this.cycle,this))};i.VERSION="3.3.7",i.TRANSITION_DURATION=600,i.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},i.prototype.keydown=function(t){if(!/input|textarea/i.test(t.target.tagName)){switch(t.which){case 37:this.prev();break;case 39:this.next();break;default:return}t.preventDefault()}},i.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(t.proxy(this.next,this),this.options.interval)),this},i.prototype.getItemIndex=function(t){return this.$items=t.parent().children(".item"),this.$items.index(t||this.$active)},i.prototype.getItemForDirection=function(t,e){var i=this.getItemIndex(e);if(("prev"==t&&0===i||"next"==t&&i==this.$items.length-1)&&!this.options.wrap)return e;var n="prev"==t?-1:1,o=(i+n)%this.$items.length;return this.$items.eq(o)},i.prototype.to=function(t){var e=this,i=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(t>this.$items.length-1||t<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){e.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",this.$items.eq(t))},i.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&t.support.transition&&(this.$element.trigger(t.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},i.prototype.next=function(){if(!this.sliding)return this.slide("next")},i.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},i.prototype.slide=function(e,n){var o=this.$element.find(".item.active"),s=n||this.getItemForDirection(e,o),a=this.interval,r="next"==e?"left":"right",l=this;if(s.hasClass("active"))return this.sliding=!1;var c=s[0],d=t.Event("slide.bs.carousel",{relatedTarget:c,direction:r});if(this.$element.trigger(d),!d.isDefaultPrevented()){if(this.sliding=!0,a&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var h=t(this.$indicators.children()[this.getItemIndex(s)]);h&&h.addClass("active")}var p=t.Event("slid.bs.carousel",{relatedTarget:c,direction:r});return t.support.transition&&this.$element.hasClass("slide")?(s.addClass(e),s[0].offsetWidth,o.addClass(r),s.addClass(r),o.one("bsTransitionEnd",function(){s.removeClass([e,r].join(" ")).addClass("active"),o.removeClass(["active",r].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger(p)},0)}).emulateTransitionEnd(i.TRANSITION_DURATION)):(o.removeClass("active"),s.addClass("active"),this.sliding=!1,this.$element.trigger(p)),a&&this.cycle(),this}};var n=t.fn.carousel;t.fn.carousel=e,t.fn.carousel.Constructor=i,t.fn.carousel.noConflict=function(){return t.fn.carousel=n,this};var o=function(i){var n,o=t(this),s=t(o.attr("data-target")||(n=o.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""));if(s.hasClass("carousel")){var a=t.extend({},s.data(),o.data()),r=o.attr("data-slide-to");r&&(a.interval=!1),e.call(s,a),r&&s.data("bs.carousel").to(r),i.preventDefault()}};t(document).on("click.bs.carousel.data-api","[data-slide]",o).on("click.bs.carousel.data-api","[data-slide-to]",o),t(window).on("load",function(){t('[data-ride="carousel"]').each(function(){var i=t(this);e.call(i,i.data())})})}(jQuery),function(t){"use strict";function e(e){var i,n=e.attr("data-target")||(i=e.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"");return t(n)}function i(e){return this.each(function(){var i=t(this),o=i.data("bs.collapse"),s=t.extend({},n.DEFAULTS,i.data(),"object"==typeof e&&e);!o&&s.toggle&&/show|hide/.test(e)&&(s.toggle=!1),o||i.data("bs.collapse",o=new n(this,s)),"string"==typeof e&&o[e]()})}var n=function(e,i){this.$element=t(e),this.options=t.extend({},n.DEFAULTS,i),this.$trigger=t('[data-toggle="collapse"][href="#'+e.id+'"],[data-toggle="collapse"][data-target="#'+e.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};n.VERSION="3.3.7",n.TRANSITION_DURATION=350,n.DEFAULTS={toggle:!0},n.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},n.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var e,o=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(o&&o.length&&(e=o.data("bs.collapse"))&&e.transitioning)){var s=t.Event("show.bs.collapse");if(this.$element.trigger(s),!s.isDefaultPrevented()){o&&o.length&&(i.call(o,"hide"),e||o.data("bs.collapse",null));var a=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[a](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var r=function(){this.$element.removeClass("collapsing").addClass("collapse in")[a](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return r.call(this);var l=t.camelCase(["scroll",a].join("-"));this.$element.one("bsTransitionEnd",t.proxy(r,this)).emulateTransitionEnd(n.TRANSITION_DURATION)[a](this.$element[0][l])}}}},n.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var i=this.dimension();this.$element[i](this.$element[i]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var o=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};if(!t.support.transition)return o.call(this);this.$element[i](0).one("bsTransitionEnd",t.proxy(o,this)).emulateTransitionEnd(n.TRANSITION_DURATION)}}},n.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},n.prototype.getParent=function(){return t(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(t.proxy(function(i,n){var o=t(n);this.addAriaAndCollapsedClass(e(o),o)},this)).end()},n.prototype.addAriaAndCollapsedClass=function(t,e){var i=t.hasClass("in");t.attr("aria-expanded",i),e.toggleClass("collapsed",!i).attr("aria-expanded",i)};var o=t.fn.collapse;t.fn.collapse=i,t.fn.collapse.Constructor=n,t.fn.collapse.noConflict=function(){return t.fn.collapse=o,this},t(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(n){var o=t(this);o.attr("data-target")||n.preventDefault();var s=e(o),a=s.data("bs.collapse"),r=a?"toggle":o.data();i.call(s,r)})}(jQuery),function(t){"use strict";function e(e){var i=e.attr("data-target");i||(i=e.attr("href"),i=i&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""));var n=i&&t(i);return n&&n.length?n:e.parent()}function i(i){i&&3===i.which||(t(o).remove(),t(s).each(function(){var n=t(this),o=e(n),s={relatedTarget:this};o.hasClass("open")&&(i&&"click"==i.type&&/input|textarea/i.test(i.target.tagName)&&t.contains(o[0],i.target)||(o.trigger(i=t.Event("hide.bs.dropdown",s)),i.isDefaultPrevented()||(n.attr("aria-expanded","false"),o.removeClass("open").trigger(t.Event("hidden.bs.dropdown",s)))))}))}function n(e){return this.each(function(){var i=t(this),n=i.data("bs.dropdown");n||i.data("bs.dropdown",n=new a(this)),"string"==typeof e&&n[e].call(i)})}var o=".dropdown-backdrop",s='[data-toggle="dropdown"]',a=function(e){t(e).on("click.bs.dropdown",this.toggle)};a.VERSION="3.3.7",a.prototype.toggle=function(n){var o=t(this);if(!o.is(".disabled, :disabled")){var s=e(o),a=s.hasClass("open");if(i(),!a){"ontouchstart"in document.documentElement&&!s.closest(".navbar-nav").length&&t(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(t(this)).on("click",i);var r={relatedTarget:this};if(s.trigger(n=t.Event("show.bs.dropdown",r)),n.isDefaultPrevented())return;o.trigger("focus").attr("aria-expanded","true"),s.toggleClass("open").trigger(t.Event("shown.bs.dropdown",r))}return!1}},a.prototype.keydown=function(i){if(/(38|40|27|32)/.test(i.which)&&!/input|textarea/i.test(i.target.tagName)){var n=t(this);if(i.preventDefault(),i.stopPropagation(),!n.is(".disabled, :disabled")){var o=e(n),a=o.hasClass("open");if(!a&&27!=i.which||a&&27==i.which)return 27==i.which&&o.find(s).trigger("focus"),n.trigger("click");var r=o.find(".dropdown-menu li:not(.disabled):visible a");if(r.length){var l=r.index(i.target);38==i.which&&l>0&&l--,40==i.which&&l<r.length-1&&l++,~l||(l=0),r.eq(l).trigger("focus")}}}};var r=t.fn.dropdown;t.fn.dropdown=n,t.fn.dropdown.Constructor=a,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=r,this},t(document).on("click.bs.dropdown.data-api",i).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",s,a.prototype.toggle).on("keydown.bs.dropdown.data-api",s,a.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",a.prototype.keydown)}(jQuery),function(t){"use strict";function e(e,n){return this.each(function(){var o=t(this),s=o.data("bs.modal"),a=t.extend({},i.DEFAULTS,o.data(),"object"==typeof e&&e);s||o.data("bs.modal",s=new i(this,a)),"string"==typeof e?s[e](n):a.show&&s.show(n)})}var i=function(e,i){this.options=i,this.$body=t(document.body),this.$element=t(e),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};i.VERSION="3.3.7",i.TRANSITION_DURATION=300,i.BACKDROP_TRANSITION_DURATION=150,i.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},i.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},i.prototype.show=function(e){var n=this,o=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(o),this.isShown||o.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){n.$element.one("mouseup.dismiss.bs.modal",function(e){t(e.target).is(n.$element)&&(n.ignoreBackdropClick=!0)})}),this.backdrop(function(){var o=t.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(n.$body),n.$element.show().scrollTop(0),n.adjustDialog(),o&&n.$element[0].offsetWidth,n.$element.addClass("in"),n.enforceFocus();var s=t.Event("shown.bs.modal",{relatedTarget:e});o?n.$dialog.one("bsTransitionEnd",function(){n.$element.trigger("focus").trigger(s)}).emulateTransitionEnd(i.TRANSITION_DURATION):n.$element.trigger("focus").trigger(s)}))},i.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",t.proxy(this.hideModal,this)).emulateTransitionEnd(i.TRANSITION_DURATION):this.hideModal())},i.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy(function(t){document===t.target||this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},i.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",t.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},i.prototype.resize=function(){this.isShown?t(window).on("resize.bs.modal",t.proxy(this.handleUpdate,this)):t(window).off("resize.bs.modal")},i.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")})},i.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},i.prototype.backdrop=function(e){var n=this,o=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var s=t.support.transition&&o;if(this.$backdrop=t(document.createElement("div")).addClass("modal-backdrop "+o).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",t.proxy(function(t){if(this.ignoreBackdropClick)return void(this.ignoreBackdropClick=!1);t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide())},this)),s&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;s?this.$backdrop.one("bsTransitionEnd",e).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):e()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var a=function(){n.removeBackdrop(),e&&e()};t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",a).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):a()}else e&&e()},i.prototype.handleUpdate=function(){this.adjustDialog()},i.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},i.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},i.prototype.checkScrollbar=function(){var t=window.innerWidth;if(!t){var e=document.documentElement.getBoundingClientRect();t=e.right-Math.abs(e.left)}this.bodyIsOverflowing=document.body.clientWidth<t,this.scrollbarWidth=this.measureScrollbar()},i.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",t+this.scrollbarWidth)},i.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},i.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var n=t.fn.modal;t.fn.modal=e,t.fn.modal.Constructor=i,t.fn.modal.noConflict=function(){return t.fn.modal=n,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(i){var n=t(this),o=n.attr("href"),s=t(n.attr("data-target")||o&&o.replace(/.*(?=#[^\s]+$)/,"")),a=s.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(o)&&o},s.data(),n.data());n.is("a")&&i.preventDefault(),s.one("show.bs.modal",function(t){t.isDefaultPrevented()||s.one("hidden.bs.modal",function(){n.is(":visible")&&n.trigger("focus")})}),e.call(s,a,this)})}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),o=n.data("bs.tooltip"),s="object"==typeof e&&e;!o&&/destroy|hide/.test(e)||(o||n.data("bs.tooltip",o=new i(this,s)),"string"==typeof e&&o[e]())})}var i=function(t,e){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",t,e)};i.VERSION="3.3.7",i.TRANSITION_DURATION=150,i.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},i.prototype.init=function(e,i,n){if(this.enabled=!0,this.type=e,this.$element=t(i),this.options=this.getOptions(n),this.$viewport=this.options.viewport&&t(t.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var o=this.options.trigger.split(" "),s=o.length;s--;){var a=o[s];if("click"==a)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=a){var r="hover"==a?"mouseenter":"focusin",l="hover"==a?"mouseleave":"focusout";this.$element.on(r+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.getOptions=function(e){return e=t.extend({},this.getDefaults(),this.$element.data(),e),e.delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},i.prototype.getDelegateOptions=function(){var e={},i=this.getDefaults();return this._options&&t.each(this._options,function(t,n){i[t]!=n&&(e[t]=n)}),e},i.prototype.enter=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);return i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusin"==e.type?"focus":"hover"]=!0),i.tip().hasClass("in")||"in"==i.hoverState?void(i.hoverState="in"):(clearTimeout(i.timeout),i.hoverState="in",i.options.delay&&i.options.delay.show?void(i.timeout=setTimeout(function(){"in"==i.hoverState&&i.show()},i.options.delay.show)):i.show())},i.prototype.isInStateTrue=function(){for(var t in this.inState)if(this.inState[t])return!0;return!1},i.prototype.leave=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);if(i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusout"==e.type?"focus":"hover"]=!1),!i.isInStateTrue()){if(clearTimeout(i.timeout),i.hoverState="out",!i.options.delay||!i.options.delay.hide)return i.hide();i.timeout=setTimeout(function(){"out"==i.hoverState&&i.hide()},i.options.delay.hide)}},i.prototype.show=function(){var e=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var n=t.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!n)return;var o=this,s=this.tip(),a=this.getUID(this.type);this.setContent(),s.attr("id",a),this.$element.attr("aria-describedby",a),this.options.animation&&s.addClass("fade");var r="function"==typeof this.options.placement?this.options.placement.call(this,s[0],this.$element[0]):this.options.placement,l=/\s?auto?\s?/i,c=l.test(r);c&&(r=r.replace(l,"")||"top"),s.detach().css({top:0,left:0,display:"block"}).addClass(r).data("bs."+this.type,this),this.options.container?s.appendTo(this.options.container):s.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var d=this.getPosition(),h=s[0].offsetWidth,p=s[0].offsetHeight;if(c){var m=r,u=this.getPosition(this.$viewport);r="bottom"==r&&d.bottom+p>u.bottom?"top":"top"==r&&d.top-p<u.top?"bottom":"right"==r&&d.right+h>u.width?"left":"left"==r&&d.left-h<u.left?"right":r,s.removeClass(m).addClass(r)}var g=this.getCalculatedOffset(r,d,h,p);this.applyPlacement(g,r);var b=function(){var t=o.hoverState;o.$element.trigger("shown.bs."+o.type),o.hoverState=null,"out"==t&&o.leave(o)};t.support.transition&&this.$tip.hasClass("fade")?s.one("bsTransitionEnd",b).emulateTransitionEnd(i.TRANSITION_DURATION):b()}},i.prototype.applyPlacement=function(e,i){var n=this.tip(),o=n[0].offsetWidth,s=n[0].offsetHeight,a=parseInt(n.css("margin-top"),10),r=parseInt(n.css("margin-left"),10);isNaN(a)&&(a=0),isNaN(r)&&(r=0),e.top+=a,e.left+=r,t.offset.setOffset(n[0],t.extend({using:function(t){n.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0),n.addClass("in");var l=n[0].offsetWidth,c=n[0].offsetHeight;"top"==i&&c!=s&&(e.top=e.top+s-c);var d=this.getViewportAdjustedDelta(i,e,l,c);d.left?e.left+=d.left:e.top+=d.top;var h=/top|bottom/.test(i),p=h?2*d.left-o+l:2*d.top-s+c,m=h?"offsetWidth":"offsetHeight";n.offset(e),this.replaceArrow(p,n[0][m],h)},i.prototype.replaceArrow=function(t,e,i){this.arrow().css(i?"left":"top",50*(1-t/e)+"%").css(i?"top":"left","")},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},i.prototype.hide=function(e){function n(){"in"!=o.hoverState&&s.detach(),o.$element&&o.$element.removeAttr("aria-describedby").trigger("hidden.bs."+o.type),e&&e()}var o=this,s=t(this.$tip),a=t.Event("hide.bs."+this.type);if(this.$element.trigger(a),!a.isDefaultPrevented())return s.removeClass("in"),t.support.transition&&s.hasClass("fade")?s.one("bsTransitionEnd",n).emulateTransitionEnd(i.TRANSITION_DURATION):n(),this.hoverState=null,this},i.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},i.prototype.hasContent=function(){return this.getTitle()},i.prototype.getPosition=function(e){e=e||this.$element;var i=e[0],n="BODY"==i.tagName,o=i.getBoundingClientRect();null==o.width&&(o=t.extend({},o,{width:o.right-o.left,height:o.bottom-o.top}));var s=window.SVGElement&&i instanceof window.SVGElement,a=n?{top:0,left:0}:s?null:e.offset(),r={scroll:n?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop()},l=n?{width:t(window).width(),height:t(window).height()}:null;return t.extend({},o,r,l,a)},i.prototype.getCalculatedOffset=function(t,e,i,n){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-n,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-n/2,left:e.left-i}:{top:e.top+e.height/2-n/2,left:e.left+e.width}},i.prototype.getViewportAdjustedDelta=function(t,e,i,n){var o={top:0,left:0};if(!this.$viewport)return o;var s=this.options.viewport&&this.options.viewport.padding||0,a=this.getPosition(this.$viewport);if(/right|left/.test(t)){var r=e.top-s-a.scroll,l=e.top+s-a.scroll+n;r<a.top?o.top=a.top-r:l>a.top+a.height&&(o.top=a.top+a.height-l)}else{var c=e.left-s,d=e.left+s+i;c<a.left?o.left=a.left-c:d>a.right&&(o.left=a.left+a.width-d)}return o},i.prototype.getTitle=function(){var t=this.$element,e=this.options;return t.attr("data-original-title")||("function"==typeof e.title?e.title.call(t[0]):e.title)},i.prototype.getUID=function(t){do{t+=~~(1e6*Math.random())}while(document.getElementById(t));return t},i.prototype.tip=function(){if(!this.$tip&&(this.$tip=t(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},i.prototype.enable=function(){this.enabled=!0},i.prototype.disable=function(){this.enabled=!1},i.prototype.toggleEnabled=function(){this.enabled=!this.enabled},i.prototype.toggle=function(e){var i=this;e&&((i=t(e.currentTarget).data("bs."+this.type))||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i))),e?(i.inState.click=!i.inState.click,i.isInStateTrue()?i.enter(i):i.leave(i)):i.tip().hasClass("in")?i.leave(i):i.enter(i)},i.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide(function(){t.$element.off("."+t.type).removeData("bs."+t.type),t.$tip&&t.$tip.detach(),t.$tip=null,t.$arrow=null,t.$viewport=null,t.$element=null})};var n=t.fn.tooltip;t.fn.tooltip=e,t.fn.tooltip.Constructor=i,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=n,this}}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),o=n.data("bs.popover"),s="object"==typeof e&&e;!o&&/destroy|hide/.test(e)||(o||n.data("bs.popover",o=new i(this,s)),"string"==typeof e&&o[e]())})}var i=function(t,e){this.init("popover",t,e)};if(!t.fn.tooltip)throw new Error("Popover requires tooltip.js");i.VERSION="3.3.7",i.DEFAULTS=t.extend({},t.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),i.prototype=t.extend({},t.fn.tooltip.Constructor.prototype),i.prototype.constructor=i,
i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),i=this.getContent();t.find(".popover-title")[this.options.html?"html":"text"](e),t.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof i?"html":"append":"text"](i),t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},i.prototype.hasContent=function(){return this.getTitle()||this.getContent()},i.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var n=t.fn.popover;t.fn.popover=e,t.fn.popover.Constructor=i,t.fn.popover.noConflict=function(){return t.fn.popover=n,this}}(jQuery),function(t){"use strict";function e(i,n){this.$body=t(document.body),this.$scrollElement=t(t(i).is(document.body)?window:i),this.options=t.extend({},e.DEFAULTS,n),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",t.proxy(this.process,this)),this.refresh(),this.process()}function i(i){return this.each(function(){var n=t(this),o=n.data("bs.scrollspy"),s="object"==typeof i&&i;o||n.data("bs.scrollspy",o=new e(this,s)),"string"==typeof i&&o[i]()})}e.VERSION="3.3.7",e.DEFAULTS={offset:10},e.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},e.prototype.refresh=function(){var e=this,i="offset",n=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),t.isWindow(this.$scrollElement[0])||(i="position",n=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var e=t(this),o=e.data("target")||e.attr("href"),s=/^#./.test(o)&&t(o);return s&&s.length&&s.is(":visible")&&[[s[i]().top+n,o]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){e.offsets.push(this[0]),e.targets.push(this[1])})},e.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,i=this.getScrollHeight(),n=this.options.offset+i-this.$scrollElement.height(),o=this.offsets,s=this.targets,a=this.activeTarget;if(this.scrollHeight!=i&&this.refresh(),e>=n)return a!=(t=s[s.length-1])&&this.activate(t);if(a&&e<o[0])return this.activeTarget=null,this.clear();for(t=o.length;t--;)a!=s[t]&&e>=o[t]&&(void 0===o[t+1]||e<o[t+1])&&this.activate(s[t])},e.prototype.activate=function(e){this.activeTarget=e,this.clear();var i=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',n=t(i).parents("li").addClass("active");n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate.bs.scrollspy")},e.prototype.clear=function(){t(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var n=t.fn.scrollspy;t.fn.scrollspy=i,t.fn.scrollspy.Constructor=e,t.fn.scrollspy.noConflict=function(){return t.fn.scrollspy=n,this},t(window).on("load.bs.scrollspy.data-api",function(){t('[data-spy="scroll"]').each(function(){var e=t(this);i.call(e,e.data())})})}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),o=n.data("bs.tab");o||n.data("bs.tab",o=new i(this)),"string"==typeof e&&o[e]()})}var i=function(e){this.element=t(e)};i.VERSION="3.3.7",i.TRANSITION_DURATION=150,i.prototype.show=function(){var e=this.element,i=e.closest("ul:not(.dropdown-menu)"),n=e.data("target");if(n||(n=e.attr("href"),n=n&&n.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var o=i.find(".active:last a"),s=t.Event("hide.bs.tab",{relatedTarget:e[0]}),a=t.Event("show.bs.tab",{relatedTarget:o[0]});if(o.trigger(s),e.trigger(a),!a.isDefaultPrevented()&&!s.isDefaultPrevented()){var r=t(n);this.activate(e.closest("li"),i),this.activate(r,r.parent(),function(){o.trigger({type:"hidden.bs.tab",relatedTarget:e[0]}),e.trigger({type:"shown.bs.tab",relatedTarget:o[0]})})}}},i.prototype.activate=function(e,n,o){function s(){a.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),e.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),r?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu").length&&e.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),o&&o()}var a=n.find("> .active"),r=o&&t.support.transition&&(a.length&&a.hasClass("fade")||!!n.find("> .fade").length);a.length&&r?a.one("bsTransitionEnd",s).emulateTransitionEnd(i.TRANSITION_DURATION):s(),a.removeClass("in")};var n=t.fn.tab;t.fn.tab=e,t.fn.tab.Constructor=i,t.fn.tab.noConflict=function(){return t.fn.tab=n,this};var o=function(i){i.preventDefault(),e.call(t(this),"show")};t(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',o).on("click.bs.tab.data-api",'[data-toggle="pill"]',o)}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),o=n.data("bs.affix"),s="object"==typeof e&&e;o||n.data("bs.affix",o=new i(this,s)),"string"==typeof e&&o[e]()})}var i=function(e,n){this.options=t.extend({},i.DEFAULTS,n),this.$target=t(this.options.target).on("scroll.bs.affix.data-api",t.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",t.proxy(this.checkPositionWithEventLoop,this)),this.$element=t(e),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};i.VERSION="3.3.7",i.RESET="affix affix-top affix-bottom",i.DEFAULTS={offset:0,target:window},i.prototype.getState=function(t,e,i,n){var o=this.$target.scrollTop(),s=this.$element.offset(),a=this.$target.height();if(null!=i&&"top"==this.affixed)return o<i&&"top";if("bottom"==this.affixed)return null!=i?!(o+this.unpin<=s.top)&&"bottom":!(o+a<=t-n)&&"bottom";var r=null==this.affixed,l=r?o:s.top,c=r?a:e;return null!=i&&o<=i?"top":null!=n&&l+c>=t-n&&"bottom"},i.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(i.RESET).addClass("affix");var t=this.$target.scrollTop(),e=this.$element.offset();return this.pinnedOffset=e.top-t},i.prototype.checkPositionWithEventLoop=function(){setTimeout(t.proxy(this.checkPosition,this),1)},i.prototype.checkPosition=function(){if(this.$element.is(":visible")){var e=this.$element.height(),n=this.options.offset,o=n.top,s=n.bottom,a=Math.max(t(document).height(),t(document.body).height());"object"!=typeof n&&(s=o=n),"function"==typeof o&&(o=n.top(this.$element)),"function"==typeof s&&(s=n.bottom(this.$element));var r=this.getState(a,e,o,s);if(this.affixed!=r){null!=this.unpin&&this.$element.css("top","");var l="affix"+(r?"-"+r:""),c=t.Event(l+".bs.affix");if(this.$element.trigger(c),c.isDefaultPrevented())return;this.affixed=r,this.unpin="bottom"==r?this.getPinnedOffset():null,this.$element.removeClass(i.RESET).addClass(l).trigger(l.replace("affix","affixed")+".bs.affix")}"bottom"==r&&this.$element.offset({top:a-e-s})}};var n=t.fn.affix;t.fn.affix=e,t.fn.affix.Constructor=i,t.fn.affix.noConflict=function(){return t.fn.affix=n,this},t(window).on("load",function(){t('[data-spy="affix"]').each(function(){var i=t(this),n=i.data();n.offset=n.offset||{},null!=n.offsetBottom&&(n.offset.bottom=n.offsetBottom),null!=n.offsetTop&&(n.offset.top=n.offsetTop),e.call(i,n)})})}(jQuery),define("bootstrap",["jquery"],function(){}),void 0===Common)var Common={};if(define("notification",["backbone"],function(t){"use strict";var e=function(){};if(_.extend(e.prototype,t.Events),void 0!==Common.NotificationCenter)throw"Native Common.NotificationCenter instance already defined.";e.extend=t.Model.extend,Common.NotificationCenter=new e}),function(){var t=function(t,e){for(var i=t.split("."),n=e||window,o=0,s=i.length;o<s;o++)n=n[i[o]]||{};return n},e=function(t){_.extend(this,t||{}),this.eventbus=new n({application:this}),this.createApplicationNamespace(),this.initialize.apply(this,arguments),!1!==this.autoCreate&&$($.proxy(this.onReady,this))};if(_.extend(e.prototype,{nameSpace:"Application",models:{},collections:{},controllers:{},allocationMap:{model:"Models",collection:"Collections",controller:"Controllers",view:"Views"},createApplicationNamespace:function(){var t=window;this.nameSpace&&void 0===t[this.nameSpace]&&(t[this.nameSpace]={}),t[this.nameSpace]=this,_.each(this.allocationMap,function(t,e){this[t]=this[t]||{}},this)},initialize:function(){},onReady:function(){this.start()},start:function(){this.initializeControllers(this.controllers||{}),this.launchControllers(),this.launch.call(this)},getClasseRefs:function(e,i){var n={},o=this.allocationMap[e],s=this[o];return _.each(i,function(e){n[e]=t(e,e.indexOf(".")>-1?window:s)},this),n},initializeControllers:function(e){this.controllers={},_.each(e,function(e){var i=e.indexOf(".")>-1?window:this[this.allocationMap.controller],n=t(e,i),o=(e.split(".").pop(),new n({id:e,application:this}));o.views=this.getClasseRefs("view",o.views||[]),_.extend(this.models,this.getClasseRefs("model",o.models||[])),_.extend(this.collections,this.getClasseRefs("collection",o.collections||{})),this.buildCollections(),this.controllers[e]=o},this)},launchControllers:function(){_.each(this.controllers,function(t,e){t.onLaunch(this)},this)},launch:function(){},addListeners:function(t,e){this.eventbus.addListeners(t,e)},getController:function(t){return this.controllers[t]},getModel:function(t){this._modelsCache=this._modelsCache||{};var e=this._modelsCache[t],i=this.getModelConstructor(t);return!e&&i&&(e=this.createModel(t),this._modelsCache[t]=e),e||null},getModelConstructor:function(t){return this.models[t]},createModel:function(t,e){var i=this.getModelConstructor(t),n=null;return i&&(n=new i(_.extend(e||{}))),n},getCollection:function(t){this._collectionsCache=this._collectionsCache||{};var e=this._collectionsCache[t],i=this.getCollectionConstructor(t);return!e&&i&&(e=this.createCollection(t),this._collectionsCache[t]=e),e||null},getCollectionConstructor:function(t){return this.collections[t]},createCollection:function(t){var e=this.getCollectionConstructor(t),i=null;return e&&(i=new e),i},buildCollections:function(){_.each(this.collections,function(t,e){this.getCollection(e)},this)}}),void 0!==Backbone.Application)throw"Native Backbone.Application instance already defined.";Backbone.Application=e,Backbone.Application.extend=Backbone.Model.extend;var i=function(t){_.extend(this,t||{}),this.initialize.apply(this,arguments)};if(_.extend(i.prototype,{name:null,views:{},models:{},collections:{},initialize:function(t){},addListeners:function(t){this.getApplication().addListeners(t,this)},onLaunch:function(t){},getApplication:function(){return this.application},getView:function(t){return this._viewsCache[t]},getViewConstructor:function(t){return this.views[t]},createView:function(t,e){var i=this.getViewConstructor(t),n=_.extend(e||{},{alias:t});return this._viewsCache=this._viewsCache||{},this._viewsCache[t]=new i(n),this._viewsCache[t].options=_.extend({},n),this._viewsCache[t]},getModel:function(t){return this.application.getModel(t)},getModelConstructor:function(t){return this.application.getModelConstructor(t)},createModel:function(t,e){return this.application.createModel(t)},getCollection:function(t){return this.application.getCollection(t)},getCollectionConstructor:function(t){return this.application.getCollectionConstructor(t)},createCollection:function(t){return this.application.createCollection(t)},fireEvent:function(t,e,i){this.application.eventbus.fireEvent(t,e,i)},bindViewEvents:function(t,e){this.unbindViewEvents(t),e=_.isFunction(e)?e.call(this):e;for(var i in e){var n=e[i];_.isFunction(n)||(n=this[e[i]]);var o=i.match(/^(\S+)\s*(.*)$/),s=o[1],a=o[2];n=_.bind(n,this),s+=".bindViewEvents"+t.cid,t.$el.on(s,a,n)}return this},unbindViewEvents:function(t){return t.$el.off(".bindViewEvents"+t.cid),this}}),void 0!==Backbone.Controller)throw"Native Backbone.Controller instance already defined.";Backbone.Controller=i,Backbone.Controller.extend=Backbone.Model.extend;var n=function(t){var e=this;_.extend(this,t||{}),_.extend(Backbone.View.prototype,{alias:null,hidden:!1,getAlias:function(){return this.options.alias},fireEvent:function(t,i){this.trigger.apply(this,arguments),e.fireEvent(this.getAlias(),t,i)},hide:function(){this.$el.hide(),this.hidden=!0},show:function(){this.$el.show(),this.hidden=!1}})};if(_.extend(n.prototype,{pool:{},addListeners:function(t,e){this.pool[e.id]=this.pool[e.id]||{};var i=this.pool[e.id];_.isArray(t)?_.each(t,function(t){this.addListeners(t,e)},this):_.isObject(t)&&_.each(t,function(t,e){_.each(t,function(t,n){i[e]=i[e]||{},i[e][n]=i[e][n]||[],i[e][n].push(t)},this)},this)},fireEvent:function(t,e,i){var n=this.getApplication();_.each(this.pool,function(o,s){var a=o[t];if(a){var r=a[e],l=n.getController(s);_.each(r,function(t){t.apply(l,i)})}},this)},getApplication:function(){return this.application}}),void 0!==Backbone.EventBus)throw"Native Backbone.Application instance already defined.";Backbone.EventBus=n}(),define("core",["backbone","notification"],function(){}),void 0===window.Common&&(window.Common={}),Common.component=Common.component||{},Common.Analytics=Common.component.Analytics=new function(){var t;return{initialize:function(e,i){if(void 0===e)throw"Analytics: invalid id.";if(void 0===i||"[object String]"!==Object.prototype.toString.apply(i))throw"Analytics: invalid category type.";t=i,$("head").append('<script type="text/javascript">var _gaq = _gaq || [];_gaq.push(["_setAccount", "'+e+'"]);_gaq.push(["_trackPageview"]);(function() {var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);})();<\/script>')},trackEvent:function(e,i,n){if(void 0!==e&&"[object String]"!==Object.prototype.toString.apply(e))throw"Analytics: invalid action type.";if(void 0!==i&&"[object String]"!==Object.prototype.toString.apply(i))throw"Analytics: invalid label type.";if(void 0!==n&&("[object Number]"!==Object.prototype.toString.apply(n)||!isFinite(n)))throw"Analytics: invalid value type.";if("undefined"!=typeof _gaq){if("undefined"===t)throw"Analytics is not initialized.";_gaq.push(["_trackEvent",t,e,i,n])}}}},define("analytics",["jquery"],function(){}),void 0===window.Common&&(window.Common={}),Common.Gateway=new function(){var t=this,e=$(t),i={init:function(t){e.trigger("init",t)},openDocument:function(t){e.trigger("opendocument",t)},showMessage:function(t){e.trigger("showmessage",t)},applyEditRights:function(t){e.trigger("applyeditrights",t)},processSaveResult:function(t){e.trigger("processsaveresult",t)},processRightsChange:function(t){e.trigger("processrightschange",t)},refreshHistory:function(t){e.trigger("refreshhistory",t)},setHistoryData:function(t){e.trigger("sethistorydata",t)},setEmailAddresses:function(t){e.trigger("setemailaddresses",t)},setActionLink:function(t){e.trigger("setactionlink",t.url)},processMailMerge:function(t){e.trigger("processmailmerge",t)},downloadAs:function(t){e.trigger("downloadas",t)},processMouse:function(t){e.trigger("processmouse",t)},internalCommand:function(t){e.trigger("internalcommand",t)},resetFocus:function(t){e.trigger("resetfocus",t)},setUsers:function(t){e.trigger("setusers",t)},showSharingSettings:function(t){e.trigger("showsharingsettings",t)},setSharingSettings:function(t){e.trigger("setsharingsettings",t)},insertImage:function(t){e.trigger("insertimage",t)},setMailMergeRecipients:function(t){e.trigger("setmailmergerecipients",t)},setRevisedFile:function(t){e.trigger("setrevisedfile",t)},setFavorite:function(t){e.trigger("setfavorite",t)},requestClose:function(t){e.trigger("requestclose",t)},blurFocus:function(t){e.trigger("blurfocus",t)},grabFocus:function(t){e.trigger("grabfocus",t)}},n=function(t){window.parent&&window.JSON&&(t.frameEditorId=window.frameEditorId,window.parent.postMessage(window.JSON.stringify(t),"*"))},o=function(t){if(t.origin===window.parentOrigin||t.origin===window.location.origin||"null"===t.origin&&("file://"===window.parentOrigin||"file://"===window.location.origin)){var e=t.data;if("[object String]"===Object.prototype.toString.apply(e)&&window.JSON){var n,o;try{n=window.JSON.parse(e)}catch(t){n=""}n&&(o=i[n.command])&&o.call(this,n.data)}}},s=function(t){o(t)};return window.attachEvent?window.attachEvent("onmessage",s):window.addEventListener("message",s,!1),{appReady:function(){n({event:"onAppReady"})},requestEditRights:function(){n({event:"onRequestEditRights"})},requestHistory:function(){n({event:"onRequestHistory"})},requestHistoryData:function(t){n({event:"onRequestHistoryData",data:t})},requestRestore:function(t,e){n({event:"onRequestRestore",data:{version:t,url:e}})},requestEmailAddresses:function(){n({event:"onRequestEmailAddresses"})},requestStartMailMerge:function(){n({event:"onRequestStartMailMerge"})},requestHistoryClose:function(t){n({event:"onRequestHistoryClose"})},reportError:function(t,e){n({event:"onError",data:{errorCode:t,errorDescription:e}})},reportWarning:function(t,e){n({event:"onWarning",data:{warningCode:t,warningDescription:e}})},sendInfo:function(t){n({event:"onInfo",data:t})},setDocumentModified:function(t){n({event:"onDocumentStateChange",data:t})},internalMessage:function(t,e){n({event:"onInternalMessage",data:{type:t,data:e}})},updateVersion:function(){n({event:"onOutdatedVersion"})},downloadAs:function(t){n({event:"onDownloadAs",data:t})},requestSaveAs:function(t,e){n({event:"onRequestSaveAs",data:{url:t,title:e}})},collaborativeChanges:function(){n({event:"onCollaborativeChanges"})},requestRename:function(t){n({event:"onRequestRename",data:t})},metaChange:function(t){n({event:"onMetaChange",data:t})},documentReady:function(){n({event:"onDocumentReady"})},requestClose:function(){n({event:"onRequestClose"})},requestMakeActionLink:function(t){n({event:"onMakeActionLink",data:t})},requestUsers:function(){n({event:"onRequestUsers"})},requestSendNotify:function(t){n({event:"onRequestSendNotify",data:t})},requestInsertImage:function(t){n({event:"onRequestInsertImage",data:{c:t}})},requestMailMergeRecipients:function(){n({event:"onRequestMailMergeRecipients"})},requestCompareFile:function(){n({event:"onRequestCompareFile"})},requestSharingSettings:function(){n({event:"onRequestSharingSettings"})},requestCreateNew:function(){n({event:"onRequestCreateNew"})},pluginsReady:function(){n({event:"onPluginsReady"})},on:function(i,n){var o=function(e,i){n.call(t,i)};e.on(i,o)}}},define("gateway",["jquery"],function(){}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("../vendor/es6-promise/es6-promise.auto.min",e):t.ES6Promise=e()}(this,function(){"use strict";function t(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}function e(t){return"function"==typeof t}function i(t){R=t}function n(t){L=t}function o(){return void 0!==F?function(){F(a)}:s()}function s(){var t=setTimeout;return function(){return t(a,1)}}function a(){for(var t=0;t<V;t+=2){(0,G[t])(G[t+1]),G[t]=void 0,G[t+1]=void 0}V=0}function r(t,e){var i=this,n=new this.constructor(c);void 0===n[j]&&A(n);var o=i._state;if(o){var s=arguments[o-1];L(function(){return x(o,n,s,i._result)})}else _(i,n,t,e);return n}function l(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var i=new e(c);return b(i,t),i}function c(){}function d(){return new TypeError("You cannot resolve a promise with itself")}function h(){return new TypeError("A promises callback cannot return that same promise.")}function p(t,e,i,n){try{t.call(e,i,n)}catch(t){return t}}function m(t,e,i){L(function(t){var n=!1,o=p(i,e,function(i){n||(n=!0,e!==i?b(t,i):C(t,i))},function(e){n||(n=!0,v(t,e))},"Settle: "+(t._label||" unknown promise"));!n&&o&&(n=!0,v(t,o))},t)}function u(t,e){e._state===K?C(t,e._result):e._state===Y?v(t,e._result):_(e,void 0,function(e){return b(t,e)},function(e){return v(t,e)})}function g(t,i,n){i.constructor===t.constructor&&n===r&&i.constructor.resolve===l?u(t,i):void 0===n?C(t,i):e(n)?m(t,i,n):C(t,i)}function b(e,i){if(e===i)v(e,d());else if(t(i)){var n=void 0;try{n=i.then}catch(t){return void v(e,t)}g(e,i,n)}else C(e,i)}function f(t){t._onerror&&t._onerror(t._result),y(t)}function C(t,e){t._state===q&&(t._result=e,t._state=K,0!==t._subscribers.length&&L(y,t))}function v(t,e){t._state===q&&(t._state=Y,t._result=e,L(f,t))}function _(t,e,i,n){var o=t._subscribers,s=o.length;t._onerror=null,o[s]=e,o[s+K]=i,o[s+Y]=n,0===s&&t._state&&L(y,t)}function y(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var n=void 0,o=void 0,s=t._result,a=0;a<e.length;a+=3)n=e[a],o=e[a+i],n?x(i,n,o,s):o(s);t._subscribers.length=0}}function x(t,i,n,o){var s=e(n),a=void 0,r=void 0,l=!0;if(s){try{a=n(o)}catch(t){l=!1,r=t}if(i===a)return void v(i,h())}else a=o;i._state!==q||(s&&l?b(i,a):!1===l?v(i,r):t===K?C(i,a):t===Y&&v(i,a))}function w(t,e){try{e(function(e){b(t,e)},function(e){v(t,e)})}catch(e){v(t,e)}}function S(){return X++}function A(t){t[j]=X++,t._state=void 0,t._result=void 0,t._subscribers=[]}function k(){return new Error("Array Methods must be provided an Array")}function T(t){return new J(this,t).promise}function I(t){var e=this;return new e(E(t)?function(i,n){for(var o=t.length,s=0;s<o;s++)e.resolve(t[s]).then(i,n)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function P(t){var e=this,i=new e(c);return v(i,t),i}function M(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function U(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function B(){var t=void 0;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===i&&!e.cast)return}t.Promise=Z}var D=void 0;D=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var E=D,V=0,F=void 0,R=void 0,L=function(t,e){G[V]=t,G[V+1]=e,2===(V+=2)&&(R?R(a):W())},N="undefined"!=typeof window?window:void 0,O=N||{},H=O.MutationObserver||O.WebKitMutationObserver,z="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),$="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,G=new Array(1e3),W=void 0;W=z?function(){return function(){return process.nextTick(a)}}():H?function(){var t=0,e=new H(a),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}():$?function(){var t=new MessageChannel;return t.port1.onmessage=a,function(){return t.port2.postMessage(0)}}():void 0===N&&"function"==typeof require?function(){try{var t=Function("return this")().require("vertx");return F=t.runOnLoop||t.runOnContext,o()}catch(t){return s()}}():s();var j=Math.random().toString(36).substring(2),q=void 0,K=1,Y=2,X=0,J=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(c),this.promise[j]||A(this.promise),E(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?C(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&C(this.promise,this._result))):v(this.promise,k())}return t.prototype._enumerate=function(t){for(var e=0;this._state===q&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,n=i.resolve;if(n===l){var o=void 0,s=void 0,a=!1;try{o=t.then}catch(t){a=!0,s=t}if(o===r&&t._state!==q)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(i===Z){var d=new i(c);a?v(d,s):g(d,t,o),this._willSettleAt(d,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(n(t),e)},t.prototype._settledAt=function(t,e,i){var n=this.promise;n._state===q&&(this._remaining--,t===Y?v(n,i):this._result[e]=i),0===this._remaining&&C(n,this._result)},t.prototype._willSettleAt=function(t,e){var i=this;_(t,void 0,function(t){return i._settledAt(K,e,t)},function(t){return i._settledAt(Y,e,t)})},t}(),Z=function(){function t(e){this[j]=S(),this._result=this._state=void 0,this._subscribers=[],c!==e&&("function"!=typeof e&&M(),this instanceof t?w(this,e):U())}return t.prototype.catch=function(t){return this.then(null,t)},t.prototype.finally=function(t){var i=this,n=i.constructor;return e(t)?i.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})}):i.then(t,t)},t}();return Z.prototype.then=r,Z.all=T,Z.race=I,Z.resolve=l,Z.reject=P,Z._setScheduler=i,Z._setAsap=n,Z._asap=L,Z.polyfill=B,Z.Promise=Z,Z.polyfill(),Z}),void 0===Common)var Common={};if(Common.Locale=new function(){"use strict";var l10n=null,loadcallback,apply=!1,defLang="en",currentLang=defLang,_applyLocalization=function(t){try{if(t&&(loadcallback=t),l10n){for(var e in l10n){var i=e.split(".");if(i&&i.length>2){for(var n=window,o=0;o<i.length-1;++o)void 0===n[i[o]]&&(n[i[o]]=new Object),n=n[i[o]];n&&(n[i[i.length-1]]=l10n[e])}}loadcallback&&loadcallback()}else apply=!0}catch(t){}},_get=function(prop,scope){var res="";return l10n&&scope&&scope.name&&!(res=l10n[scope.name+"."+prop])&&scope.default&&(res=scope.default),res||(scope?eval(scope.name).prototype[prop]:"")},_getCurrentLanguage=function(){return currentLang},_getLoadedLanguage=function(){return loadedLang},_getUrlParameterByName=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=e.exec(location.search);return null==i?"":decodeURIComponent(i[1].replace(/\+/g," "))},_requireLang=function(){var t=(_getUrlParameterByName("lang")||defLang).split(/[\-_]/)[0];currentLang=t,fetch("locale/"+t+".json?"+window.CP_urlArgs).then(function(e){if(!e.ok){if(currentLang=defLang,t!=defLang)return fetch("locale/"+defLang+".json");throw new Error("server error")}return e.json()}).then(function(t){if(t.json){if(!t.ok)throw new Error("server error");return t.json()}throw l10n=t,new Error("loaded")}).then(function(t){l10n=t||{},apply&&_applyLocalization()}).catch(function(t){l10n=l10n||{},apply&&_applyLocalization(),"loaded"==t.message||(currentLang=null,console.log("fetch error: "+t))})};if(window.fetch)_requireLang();else{var polyfills=["../vendor/fetch/fetch.umd"];window.Promise?require(polyfills,_requireLang):require(["../vendor/es6-promise/es6-promise.auto.min"],function(){require(polyfills,_requireLang)})}return{apply:_applyLocalization,get:_get,getCurrentLanguage:_getCurrentLanguage}},define("locale",function(){}),define("text",["module"],function(t){"use strict";var e,i,n,o,s,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,d=c&&location.protocol&&location.protocol.replace(/\:/,""),h=c&&location.hostname,p=c&&(location.port||void 0),m={},u=t.config&&t.config()||{};return e={version:"2.0.10",strip:function(t){if(t){t=t.replace(r,"");var e=t.match(l);e&&(t=e[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:u.createXhr||function(){var t,e,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(e=0;e<3;e+=1){i=a[e];try{t=new ActiveXObject(i)}catch(t){}if(t){a=[i];break}}return t},parseName:function(t){var e,i,n,o=!1,s=t.indexOf("."),a=0===t.indexOf("./")||0===t.indexOf("../");return-1!==s&&(!a||s>1)?(e=t.substring(0,s),i=t.substring(s+1,t.length)):e=t,n=i||e,s=n.indexOf("!"),-1!==s&&(o="strip"===n.substring(s+1),n=n.substring(0,s),i?i=n:e=n),{moduleName:e,ext:i,strip:o}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,i,n,o){var s,a,r,l=e.xdRegExp.exec(t);return!l||(s=l[2],a=l[3],a=a.split(":"),r=a[1],a=a[0],!(s&&s!==i||a&&a.toLowerCase()!==n.toLowerCase()||(r||a)&&r!==o))},finishLoad:function(t,i,n,o){n=i?e.strip(n):n,u.isBuild&&(m[t]=n),o(n)},load:function(t,i,n,o){if(o.isBuild&&!o.inlineText)return void n();u.isBuild=o.isBuild;var s=e.parseName(t),a=s.moduleName+(s.ext?"."+s.ext:""),r=i.toUrl(a),l=u.useXhr||e.useXhr;if(0===r.indexOf("empty:"))return void n();!c||l(r,d,h,p)?e.get(r,function(i){e.finishLoad(t,s.strip,i,n)},function(t){n.error&&n.error(t)}):i([a],function(t){e.finishLoad(s.moduleName+"."+s.ext,s.strip,t,n)})},write:function(t,i,n,o){if(m.hasOwnProperty(i)){var s=e.jsEscape(m[i]);n.asModule(t+"!"+i,"define(function () { return '"+s+"';});\n")}},writeFile:function(t,i,n,o,s){var a=e.parseName(i),r=a.ext?"."+a.ext:"",l=a.moduleName+r,c=n.toUrl(a.moduleName+r)+".js";e.load(l,n,function(i){var n=function(t){return o(c,t)};n.asModule=function(t,e){return o.asModule(t,c,e)},e.write(t,l,n,s)},s)}},"node"===u.env||!u.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(i=require.nodeRequire("fs"),e.get=function(t,e,n){try{var o=i.readFileSync(t,"utf8");0===o.indexOf("\ufeff")&&(o=o.substring(1)),e(o)}catch(t){n(t)}}):"xhr"===u.env||!u.env&&e.createXhr()?e.get=function(t,i,n,o){var s,a=e.createXhr();if(a.open("GET",t,!0),o)for(s in o)o.hasOwnProperty(s)&&a.setRequestHeader(s.toLowerCase(),o[s]);u.onXhr&&u.onXhr(a,t),a.onreadystatechange=function(e){var o,s;4===a.readyState&&(o=a.status,o>399&&o<600?(s=new Error(t+" HTTP status: "+o),s.xhr=a,n(s)):i(a.responseText),u.onXhrComplete&&u.onXhrComplete(a,t))},a.send(null)}:"rhino"===u.env||!u.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?e.get=function(t,e){var i,n,o=new java.io.File(t),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),"utf-8")),r="";try{for(i=new java.lang.StringBuffer,n=a.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=a.readLine());)i.append(s),i.append(n);r=String(i.toString())}finally{a.close()}e(r)}:("xpconnect"===u.env||!u.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,o=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in n,e.get=function(t,e){var i,a,r,l={};s&&(t=t.replace(/\//g,"\\")),r=new FileUtils.File(t);try{i=n["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream),i.init(r,1,0,!1),a=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream),a.init(i,"utf-8",i.available(),o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),a.readString(i.available(),l),a.close(),i.close(),e(l.value)}catch(t){throw new Error((r&&r.path||"")+": "+t)}}),e}),define("text!common/main/lib/template/Header.template",[],function(){return'<div id="header-container">\n    <div id="header-logo"></div>\n    <div id="header-caption"><div><%= headerCaption %></div></div>\n    <div id="header-documentcaption"><div><%= documentCaption %></div></div>\n    <div id="header-back" style="display: <%= canBack ? \'table-cell\' : \'none\' %>;"><div><%= textBack %></div></div>\n</div>'}),void 0===Common)var Common={}
;if(define("common/main/lib/component/BaseView",["backbone"],function(t){"use strict";Common.UI=_.extend(Common.UI||{},{Keys:{BACKSPACE:8,TAB:9,RETURN:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,HOME:36,END:35,SPACE:32,PAGEUP:33,PAGEDOWN:34,INSERT:45,EQUALITY_FF:61,NUM_PLUS:107,NUM_MINUS:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,MINUS_FF:173,EQUALITY:187,MINUS:189},BaseView:t.View.extend({isSuspendEvents:!1,initialize:function(t){this.options=this.options?_({}).extend(this.options,t):t},setVisible:function(t){return this[t?"show":"hide"]()},isVisible:function(){return $(this.el).is(":visible")},suspendEvents:function(){this.isSuspendEvents=!0},resumeEvents:function(){this.isSuspendEvents=!1}}),getId:function(t){return _.uniqueId(t||"asc-gen")}})}),void 0===Common)var Common={};if(define("common/main/lib/component/CheckBox",["common/main/lib/component/BaseView","underscore"],function(t,e){"use strict";Common.UI.CheckBox=Common.UI.BaseView.extend({options:{labelText:""},disabled:!1,rendered:!1,indeterminate:!1,checked:!1,value:"unchecked",template:e.template('<label class="checkbox-indeterminate"><input id="<%= id %>" type="checkbox" class="checkbox__native"><label for="<%= id %>" class="checkbox__shape"></label><span></span></label>'),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.options.el&&this.render()},render:function(t){var e=this;if(!e.rendered){var i=this.template({id:Common.UI.getId("chb-")});t?(this.setElement(t,!1),t.html(i)):e.$el.html(i),this.$chk=e.$el.find("input[type=checkbox]"),this.$label=e.$el.find("label.checkbox-indeterminate"),this.$span=e.$label.find("span"),this.$chk.on("click",this.onItemCheck.bind(this)),this.$label.on("keydown",this.onKeyDown.bind(this)),this.rendered=!0}return this.options.disabled&&this.setDisabled(this.options.disabled),void 0!==this.options.value&&this.setValue(this.options.value,!0),this.setCaption(this.options.labelText),this},setDisabled:function(t){this.rendered&&(t=!0===t,t!==this.disabled&&(this.$label.toggleClass("disabled",t),t?this.$chk.attr({disabled:t}):this.$chk.removeAttr("disabled"),void 0!==this.tabindex&&(t&&(this.tabindex=this.$label.attr("tabindex")),this.$label.attr("tabindex",t?"-1":this.tabindex))),this.disabled=t)},isDisabled:function(){return this.disabled},onItemCheck:function(t){this.disabled||(this.indeterminate?(this.indeterminate=!1,this.setValue(!1)):this.setValue(!this.checked))},setRawValue:function(t){this.checked=!0===t||"true"===t||"1"===t||1===t||"checked"===t,this.indeterminate="indeterminate"===t,this.value=this.indeterminate?"indeterminate":this.checked?"checked":"unchecked",this.$chk.prop({indeterminate:this.indeterminate,checked:this.checked})},setValue:function(t,e){this.rendered?t!=this.value&&(this.lastValue=this.value,this.setRawValue(t),!0!==e&&this.trigger("change",this,this.value,this.lastValue)):this.options.value=t},getValue:function(){return this.value},isChecked:function(){return this.checked},setCaption:function(t){this.$span.text(t),this.$span.css("visibility",t?"visible":"hidden")},onKeyDown:function(t){t.isDefaultPrevented()||t.keyCode===Common.UI.Keys.SPACE&&this.onItemCheck(t)},focus:function(){this.$label&&this.$label.focus()},setTabIndex:function(t){this.rendered&&(this.tabindex=t.toString(),!this.disabled&&this.$label.attr("tabindex",this.tabindex))}})}),void 0===Common)var Common={};if(void 0===Common.UI&&(Common.UI={}),Common.UI.FocusManager=new function(){var t=1,e=[],i=0,n=function(e){var i=[];return e.forEach||(e=[e]),e.forEach(function(e){if(e){var n={};e.cmp&&"string"==typeof e.selector?n=e:(n.cmp=e,e instanceof Common.UI.ListView?n.selector=".listview":e instanceof Common.UI.CheckBox?n.selector=".checkbox-indeterminate":e instanceof Common.UI.RadioBox?n.selector=".radiobox":e instanceof Common.UI.TreeView?n.selector=".treeview":e instanceof Common.UI.Button?n.selector="button":n.selector=".form-control"),n.el=(n.cmp.$el||$(n.cmp.el||n.cmp)).find(n.selector).addBack().filter(n.selector),n.el&&n.el.attr&&(n.cmp.setTabIndex?n.cmp.setTabIndex(t):n.el.attr("tabindex",t.toString())),i.push(n)}}),i},o=function(e){if(e&&!e.traps&&e.fields&&!(e.fields.length<1)){var i=$('<span aria-hidden="true" tabindex="'+t+'"></span>');i.on("focus",function(){if(!e.hidden)for(var t=e.fields,i=t.length-1;i>=0;i--){var n=t[i];if((n.cmp.isVisible?n.cmp.isVisible():n.cmp.is(":visible"))&&(!n.cmp.isDisabled||!n.cmp.isDisabled())){var o=n.selector?(n.cmp.$el||$(n.cmp.el||n.cmp)).find(n.selector).addBack().filter(n.selector):n.el;o&&setTimeout(function(){o.focus()},10);break}}}),e.parent.$window.prepend(i);var n=$('<span aria-hidden="true" tabindex="'+(t+1)+'"></span>');n.on("focus",function(){if(!e.hidden)for(var t=e.fields,i=0;i<t.length;i++){var n=t[i];if((n.cmp.isVisible?n.cmp.isVisible():n.cmp.is(":visible"))&&(!n.cmp.isDisabled||!n.cmp.isDisabled())){var o=n.selector?(n.cmp.$el||$(n.cmp.el||n.cmp)).find(n.selector).addBack().filter(n.selector):n.el;o&&setTimeout(function(){o.focus()},10);break}}}),e.parent.$window.append(n),e.traps=[i,n]}},s=function(t){var n=t?1:-1;for(var o in e)if(e.hasOwnProperty(o)){var s=e[o];s&&s.index<i-1&&s.traps&&s.traps[1].attr("tabindex",(parseInt(s.traps[1].attr("tabindex"))+n).toString())}},a=function(t,s){t&&t.cid&&(e[t.cid]?e[t.cid].fields=(e[t.cid].fields||[]).concat(n(s)):e[t.cid]={parent:t,fields:n(s),hidden:!1,index:i++},o(e[t.cid]))};return{init:function(){Common.NotificationCenter.on({"modal:show":function(t){t&&t.cid&&(e[t.cid]?e[t.cid].hidden=!1:(e[t.cid]={parent:t,hidden:!1,index:i++},s(!0)))},"window:show":function(t){t&&t.cid&&e[t.cid]&&!e[t.cid].fields&&(e[t.cid].fields=n(t.getFocusedComponents()),o(e[t.cid]));var i=t?t.getDefaultFocusableComponent():null;i&&setTimeout(function(){i.focus()},100)},"modal:close":function(t,n){t&&t.cid&&e[t.cid]&&(s(!1),delete e[t.cid],i--)},"modal:hide":function(t,i){t&&t.cid&&e[t.cid]&&(e[t.cid].hidden=!0)}})},add:a}},define("common/main/lib/component/FocusManager",function(){}),void 0===Common)var Common={};if(define("common/main/lib/component/Window",["common/main/lib/component/BaseView","common/main/lib/component/CheckBox","common/main/lib/component/FocusManager"],function(){"use strict";Common.UI.Window=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=$(".modals-mask");return 0==t.length&&(t=$("<div class='modals-mask'>").appendTo(document.body).hide(),t.attr("counter",0)),t}function e(t){if(!this.isLocked()&&this.isVisible()&&this.initConfig.enableKeyEvents&&!1!==this.pauseKeyEvents)switch(t.keyCode){case Common.UI.Keys.ESC:if($(".asc-loadmask").length<1)return t.preventDefault(),t.stopPropagation(),!1!==this.initConfig.closable&&(this.initConfig.toolcallback?this.initConfig.toolcallback.call(this):"hide"==this.initConfig.toolclose?this.hide():this.close()),!1;break;case Common.UI.Keys.RETURN:if(this.$window.find(".btn.primary").length&&$(".asc-loadmask").length<1&&!1===(this.initConfig.onprimary||this.onPrimary).call(this))return t.preventDefault(),!1}}function i(){if(void 0==window.innerHeight)var t=document.documentElement.offsetWidth,e=document.documentElement.offsetHeight;else t=Common.Utils.innerWidth(),e=Common.Utils.innerHeight();return e-=Common.Utils.InternalSettings.get("window-inactive-area-top"),{width:t,height:e,top:Common.Utils.InternalSettings.get("window-inactive-area-top")}}function n(){if("auto"==this.initConfig.height){var t=parseInt(this.$window.find("> .body").css("height"));this.initConfig.header&&(t+=parseInt(this.$window.find("> .header").css("height"))),this.$window.height(t)}}function o(){var t=i(),e=t.width,n=t.height;if("auto"==this.initConfig.height){var o=parseInt(this.$window.find(".body").css("height"));this.initConfig.header&&(o+=parseInt(this.$window.find(".header").css("height")))}else(o=this.initConfig.height)>n&&(o=n);var s="auto"==this.initConfig.width?parseInt(this.$window.find(".body").css("width")):this.initConfig.width,a=t.top+Math.floor((parseInt(n)-parseInt(o))/2),r=Math.floor((parseInt(e)-parseInt(s))/2);this.$window.css("left",r),this.$window.css("top",a)}function s(){var t=i(),e=t.width,n=t.height;this.getLeft()+this.getWidth()>e&&this.$window.css("left",e-this.getWidth()),this.getTop()<t.top?this.$window.css("top",t.top):this.getTop()+this.getHeight()>n&&(n-this.getHeight()<0?this.$window.css("top",t.top):this.$window.css("top",t.top+n-this.getHeight()))}function a(t){return{"-webkit-transition":"0.3s opacity","-moz-transition":"0.3s opacity","-ms-transition":"0.3s opacity","-o-transition":"0.3s opacity",opacity:t}}function r(t){if(!$(t.target).hasClass("close")&&!$(t.target).hasClass("help")){Common.UI.Menu.Manager.hideAll();var e=t instanceof jQuery.Event?Common.Utils.zoom():1;this.dragging.enabled=!0,this.dragging.initx=t.pageX*e-this.getLeft(),this.dragging.inity=t.pageY*e-this.getTop();var n=i(),o=n.width,s=n.height;this.dragging.maxx=o-this.getWidth(),this.dragging.maxy=s-this.getHeight(),this.dragging.maxy<0&&(this.dragging.maxy=0),this.dragging.maxy+=n.top,$(document).on("mousemove",this.binding.drag),$(document).on("mouseup",this.binding.dragStop),this.fireEvent("drag",[this,"start"])}}function l(){$(document).off("mousemove",this.binding.drag),$(document).off("mouseup",this.binding.dragStop),this.dragging.enabled=!1,this.fireEvent("drag",[this,"end"])}function c(t){if(this.dragging.enabled){var e=t instanceof jQuery.Event?Common.Utils.zoom():1,i=t.pageX*e-this.dragging.initx,n=t.pageY*e-this.dragging.inity,o=Common.Utils.InternalSettings.get("window-inactive-area-top");i<0?i=0:i>this.dragging.maxx&&(i=this.dragging.maxx),n<o?n=o:n>this.dragging.maxy&&(n=this.dragging.maxy),this.$window.css({left:i,top:n})}}function d(t){"mouseup"==t.type&&this.dragging.enabled&&l.call(this)}function h(t){Common.UI.Menu.Manager.hideAll();var e=$(t.target),n=this.getLeft(),o=this.getTop();this.resizing.enabled=!0,this.resizing.initpage_x=t.pageX*Common.Utils.zoom(),this.resizing.initpage_y=t.pageY*Common.Utils.zoom(),this.resizing.initx=this.resizing.initpage_x-n,this.resizing.inity=this.resizing.initpage_y-o,this.resizing.initw=this.getWidth(),this.resizing.inith=this.getHeight(),this.resizing.type=[e.hasClass("left")?-1:e.hasClass("right")?1:0,e.hasClass("top")?-1:e.hasClass("bottom")?1:0];var s=i(),a=s.width,r=s.height,l=this.initConfig.maxwidth?this.initConfig.maxwidth:a,c=this.initConfig.maxheight?this.initConfig.maxheight:r;this.resizing.minw=this.initConfig.minwidth,this.resizing.maxw=this.resizing.type[0]>0?Math.min(a-n,l):Math.min(n+this.resizing.initw,l),this.resizing.minh=this.initConfig.minheight,this.resizing.maxh=this.resizing.type[1]>0?Math.min(r-o,c):Math.min(o+this.resizing.inith,c),$(document.body).css("cursor",e.css("cursor")),this.$window.find(".resize-border").addClass("resizing"),this.$window.find(".header").addClass("resizing"),$(document).on("mousemove",this.binding.resize),$(document).on("mouseup",this.binding.resizeStop),this.fireEvent("resize",[this,"start"])}function p(t){if(this.resizing.enabled){var e=!1,i=t instanceof jQuery.Event?Common.Utils.zoom():1,n=t.pageX*i,o=t.pageY*i;if(this.resizing.type[0]){var s=this.resizing.initw+(n-this.resizing.initpage_x)*this.resizing.type[0];s>this.resizing.maxw?(n-=(s-this.resizing.maxw)*this.resizing.type[0],s=this.resizing.maxw):s<this.resizing.minw&&(n-=(s-this.resizing.minw)*this.resizing.type[0],s=this.resizing.minw),this.resizing.type[0]<0&&this.$window.css({left:n-this.resizing.initx}),this.setWidth(s),e=!0}if(this.resizing.type[1]){var a=this.resizing.inith+(o-this.resizing.initpage_y)*this.resizing.type[1];a>this.resizing.maxh?(o-=(a-this.resizing.maxh)*this.resizing.type[1],a=this.resizing.maxh):a<this.resizing.minh&&(o-=(a-this.resizing.minh)*this.resizing.type[1],a=this.resizing.minh),this.resizing.type[1]<0&&this.$window.css({top:o-this.resizing.inity}),this.setHeight(a),e=!0}e&&this.fireEvent("resizing")}}function m(){$(document).off("mousemove",this.binding.resize),$(document).off("mouseup",this.binding.resizeStop),$(document.body).css("cursor","auto"),this.$window.find(".resize-border").removeClass("resizing"),this.$window.find(".header").removeClass("resizing"),this.resizing.enabled=!1,this.fireEvent("resize",[this,"end"])}var u={closable:!0,header:!0,modal:!0,width:"auto",height:"auto",title:"Title",alias:"Window",cls:"",toolclose:"close",help:!1,maxwidth:void 0,maxheight:void 0,minwidth:0,minheight:0,enableKeyEvents:!0};return Common.UI.alert=function(t){function e(e){var i=e.getChild(".info-box"),n=e.getChild(".info-box .text > span"),o=e.getChild(".footer"),s=e.getChild(".header"),a=e.getChild(".body"),r=e.getChild(".icon"),l=r.length>0?r.height():0,c=e.getChild(".info-box .dont-show-checkbox");t.dontshow||a.css("padding-bottom","10px"),t.maxwidth&&"auto"==t.width&&n.position().left+n.width()+parseInt(i.css("padding-right"))>t.maxwidth&&(t.width=t.maxwidth),"auto"==t.width?(i.height(Math.max(n.height(),l)+(c.length>0?c.height()+parseInt(c.css("margin-top")):0)),a.height(parseInt(i.css("height"))+parseInt(o.css("height"))),e.setSize(n.position().left+n.width()+parseInt(i.css("padding-right")),parseInt(a.css("height"))+parseInt(s.css("height")))):(n.css("white-space","normal"),e.setWidth(t.width),i.height(Math.max(n.height(),l)+(c.length>0?c.height()+parseInt(c.css("margin-top")):0)),a.height(parseInt(i.css("height"))+parseInt(o.css("height"))),e.setHeight(parseInt(a.css("height"))+parseInt(s.css("height")))),n.height()<l-10&&n.css({"vertical-align":"baseline","line-height":l+"px"})}function i(e){t.callback&&t.callback.call(o,e.currentTarget.attributes.result.value,!!s&&"checked"==s.getValue()),o.close(!0)}function n(t){return i({currentTarget:o.getChild(".footer .dlg-btn")[0]}),!1}this.Window.prototype;t.buttons||(t.buttons=["ok"]),t.dontshow=t.dontshow||!1,t.width||(t.width="auto");_.extend(t,{cls:"alert",onprimary:n,tpl:_.template('<div class="info-box"><% if (typeof iconCls !== "undefined") { %><div class="icon img-commonctrl img-colored <%= iconCls %>"></div><% } %><div class="text" <% if (typeof iconCls == "undefined") { %> style="padding-left:10px;" <% } %>><span><%= msg %></span><% if (dontshow) { %><div class="dont-show-checkbox"></div><% } %></div></div><% if (dontshow) { %><div class="separator horizontal" style="width: 100%;"></div><% } %>')(t)});var o=new Common.UI.Window(t),s=null;return o.on({"render:after":function(n){var a=n.getChild(".footer");t.dontshow&&a.addClass("dontshow"),a.find(".dlg-btn").on("click",i),s=new Common.UI.CheckBox({el:o.$window.find(".dont-show-checkbox"),labelText:t.textDontShow||o.textDontShow}),e(n)},show:function(t){t.getChild(".footer .dlg-btn").focus()},close:function(){t.callback&&t.callback.call(o,"close")}}),o.show(),o},Common.UI.error=function(t){return t=t||{},!t.title&&(t.title=this.Window.prototype.textError),Common.UI.alert(_.extend(t,{iconCls:"error"}))},Common.UI.confirm=function(t){return t=t||{},!t.title&&(t.title=this.Window.prototype.textConfirmation),Common.UI.alert(_.extend(t,{iconCls:"confirm"}))},Common.UI.info=function(t){return t=t||{},!t.title&&(t.title=this.Window.prototype.textInformation),Common.UI.alert(_.extend(t,{iconCls:"info"}))},Common.UI.warning=function(t){return t=t||{},!t.title&&(t.title=this.Window.prototype.textWarning),Common.UI.alert(_.extend(t,{iconCls:"warn"}))},{$window:void 0,$lastmodal:void 0,dragging:{enabled:!1},resizing:{enabled:!1},initialize:function(t){this.initConfig={},this.binding={};var e={ok:this.okButtonText,cancel:this.cancelButtonText,yes:this.yesButtonText,no:this.noButtonText,close:this.closeButtonText};if(t.buttons&&_.isArray(t.buttons)){void 0==t.primary&&(t.primary="ok");var i={};_.each(t.buttons,function(n){"object"==typeof n?void 0!==n.value&&(i[n.value]={text:n.caption,cls:"custom"+(n.primary||t.primary==n.value?" primary":"")}):(i[n]={text:"custom"==n?t.customButtonText:e[n],cls:t.primary==n||_.indexOf(t.primary,n)>-1?"primary":""},"custom"==n&&(i[n].cls+=" custom"))}),t.buttons=i,t.footerCls=t.footerCls||"center"}_.extend(this.initConfig,u,t||{}),!this.initConfig.id&&(this.initConfig.id="window-"+this.cid),!this.initConfig.tpl&&(this.initConfig.tpl=""),Common.UI.BaseView.prototype.initialize.call(this,this.initConfig)},render:function(){var t=this.initConfig.renderTo||document.body;if($(t).append(_.template('<div class="asc-window<%= modal?" modal":"" %><%= cls?" "+cls:"" %>" id="<%= id %>" style="width:<%= width %>px;"><% if (header==true) { %><div class="header"><div class="tools"><% if (closable!==false) %><div class="tool close"></div><% %><% if (help===true) %><div class="tool help">?</div><% %></div><div class="title"><%= title %></div> </div><% } %><div class="body"><%= tpl %><% if (typeof (buttons) !== "undefined" && _.size(buttons) > 0) { %><div class="footer"><% for(var bt in buttons) { %><button class="btn normal dlg-btn <%= buttons[bt].cls %>" result="<%= bt %>"><%= buttons[bt].text %></button><% } %></div><% } %></div></div>')(this.initConfig)),this.$window=$("#"+this.initConfig.id),Common.Locale.getCurrentLanguage()&&"en"!==Common.Locale.getCurrentLanguage()&&this.$window.attr("applang",Common.Locale.getCurrentLanguage()),this.binding.keydown=_.bind(e,this),this.initConfig.header){this.binding.drag=_.bind(c,this),this.binding.dragStop=_.bind(l,this),this.binding.dragStart=_.bind(r,this);var i=function(){this.$window.find(".tool.close").hasClass("disabled")||(this.initConfig.toolcallback?this.initConfig.toolcallback.call(this):"hide"==this.initConfig.toolclose?this.hide():this.close())},n=function(){this.$window.find(".tool.help").hasClass("disabled")||this.fireEvent("help",this)};this.$window.find(".header").on("mousedown",this.binding.dragStart),this.$window.find(".tool.close").on("click",_.bind(i,this)),this.$window.find(".tool.help").on("click",_.bind(n,this)),this.initConfig.modal||Common.Gateway.on("processmouse",_.bind(d,this))}else this.$window.find(".body").css({top:0,"border-radius":"5px"});"auto"!==this.initConfig.height&&this.$window.css("height",this.initConfig.height),this.initConfig.resizable&&this.setResizable(this.initConfig.resizable);var o=this;return this.binding.winclose=function(t){o.$window&&o.isVisible()&&o.$window==t.$window&&o.close()},Common.NotificationCenter.on("window:close",this.binding.winclose),this.initConfig.footerCls&&this.$window.find(".footer").addClass(this.initConfig.footerCls),this.menuAddAlign=function(t,e,i){var n=this;o.$window.hasClass("notransform")?(t.css({left:e,top:i}),n.options.additionalAlign=null):(o.$window.addClass("notransform"),t.addClass("hidden"),setTimeout(function(){t.removeClass("hidden"),t.css({left:e,top:i}),n.options.additionalAlign=null},300))},this.fireEvent("render:after",this),this},show:function(e,i){if(this.initConfig.modal){var r=t();if(!1===this.options.animate||this.options.animate&&!1===this.options.animate.mask)r.attr("counter",parseInt(r.attr("counter"))+1),r.show();else{var l=$(":root").css("--modal-window-mask-opacity");r.css("opacity",0),r.attr("counter",parseInt(r.attr("counter"))+1),r.show(),setTimeout(function(){r.css(a(l))},1)}Common.NotificationCenter.trigger("modal:show",this),this.$lastmodal=$(".asc-window.modal:not(.dethrone):visible").first().addClass("dethrone")}this.$window?this.$window.is(":visible")||(this.$window.css({opacity:0}),s.call(this),this.$window.show()):(this.render(),n.call(this),_.isNumber(e)&&_.isNumber(i)?(this.$window.css("left",Math.floor(e)),this.$window.css("top",Math.floor(i))):o.call(this)),$(document).on("keydown."+this.cid,this.binding.keydown);var c=this;setTimeout(function(){c.fireEvent("animate:before",c)},10),!1!==this.options.animate?(this.$window.css({"-webkit-transform":"scale(0.8)","-moz-transform":"scale(0.8)","-ms-transform":"scale(0.8)","-o-transform":"scale(0.8)",opacity:0}),setTimeout(function(){c.$window.css({"-webkit-transition":"0.2s opacity, 0.2s -webkit-transform","-webkit-transform":"scale(1)","-moz-transition":"0.2s opacity, 0.2s -moz-transform","-moz-transform":"scale(1)","-ms-transition":"0.2s opacity, 0.2s -ms-transform","-ms-transform":"scale(1)","-o-transition":"0.2s opacity, 0.2s -o-transform","-o-transform":"scale(1)",opacity:"1"}),setTimeout(function(){c.fireEvent("animate:after",c)},210)},1),setTimeout(function(){c.$window.addClass("notransform"),c.fireEvent("show",c)},this.initConfig.modal?1e3:350)):(this.$window.css({opacity:1}),this.$window.addClass("notransform"),this.fireEvent("show",this),setTimeout(function(){c.fireEvent("animate:after",c)},10)),Common.NotificationCenter.trigger("window:show",this)},close:function(e){if($(document).off("keydown."+this.cid),this.initConfig.header&&this.$window.find(".header").off("mousedown",this.binding.dragStart),Common.NotificationCenter.off({"window:close":this.binding.winclose}),this.initConfig.modal){var i=t(),n=!0;if(i.attr("counter",parseInt(i.attr("counter"))-1),this.$lastmodal.length>0&&(this.$lastmodal.removeClass("dethrone"),n=!(this.$lastmodal.hasClass("modal")&&this.$lastmodal.is(":visible"))),n)if(!1!==this.options.animate){var o=$(":root").css("--modal-window-mask-opacity");i.css(a(0)),setTimeout(function(){parseInt(i.attr("counter"))<1&&(i.css("opacity",o),i.hide(),i.attr("counter",0))},300)}else parseInt(i.attr("counter"))<1&&(i.hide(),i.attr("counter",0));Common.NotificationCenter.trigger("modal:close",this,n&&parseInt(i.attr("counter"))<1)}this.$window.remove(),!0!==e&&this.fireEvent("close",this)},hide:function(){if($(document).off("keydown."+this.cid),this.$window){if(this.initConfig.modal){var e=t(),i=!0;if(e.attr("counter",parseInt(e.attr("counter"))-1),this.$lastmodal.length>0&&(this.$lastmodal.removeClass("dethrone"),i=!(this.$lastmodal.hasClass("modal")&&this.$lastmodal.is(":visible"))),i)if(!1!==this.options.animate){var n=$(":root").css("--modal-window-mask-opacity");e.css(a(0)),setTimeout(function(){parseInt(e.attr("counter"))<1&&(e.css("opacity",n),e.hide(),e.attr("counter",0))},300)}else parseInt(e.attr("counter"))<1&&(e.hide(),e.attr("counter",0));Common.NotificationCenter.trigger("modal:hide",this,i&&parseInt(e.attr("counter"))<1)}this.$window.hide(),this.$window.removeClass("notransform"),this.fireEvent("hide",this)}},isLocked:function(){return this.$window.hasClass("dethrone")||!this.initConfig.modal&&this.$window.parent().find(".asc-window.modal:visible").length},getChild:function(t){return t?this.$window.find(t):this.$window},setWidth:function(t){if(t>=0){var e=parseInt(this.$window.css("min-width"));t<e&&(t=e),t-=parseInt(this.$window.css("border-left-width"))+parseInt(this.$window.css("border-right-width")),this.$window.width(t)}},getWidth:function(){return parseInt(this.$window.css("width"))},setHeight:function(t){if(t>=0){var e=parseInt(this.$window.css("min-height"));t<e&&(t=e),t-=parseInt(this.$window.css("border-bottom-width"))+parseInt(this.$window.css("border-top-width")),this.$window.height(t),this.initConfig.header&&(t-=parseInt(this.$window.find("> .header").css("height"))),this.$window.find("> .body").css("height",t)}},getHeight:function(){return parseInt(this.$window.css("height"))},setSize:function(t,e){this.setWidth(t),this.setHeight(e)},getSize:function(){return[this.getWidth(),this.getHeight()]},setTitle:function(t){this.$window.find("> .header > .title").text(t)},getTitle:function(){return this.$window.find("> .header > .title").text()},getLeft:function(){return parseInt(this.$window.css("left"))},getTop:function(){return parseInt(this.$window.css("top"))},isVisible:function(){return this.$window&&this.$window.is(":visible")},setResizable:function(t,e,i){if(t!==this.resizable){if(t){var n='<div class="resize-border left" style="top:'+(this.initConfig.header?"33":"5")+'px; bottom: 5px; height: auto; border-right-style: solid; cursor: w-resize;"></div><div class="resize-border left bottom" style="border-bottom-left-radius: 5px; cursor: sw-resize;"></div><div class="resize-border bottom" style="left: 4px; right: 4px; width: auto; z-index: 2; border-top-style: solid; cursor: s-resize;"></div><div class="resize-border right bottom" style="border-bottom-right-radius: 5px; cursor: se-resize;"></div><div class="resize-border right" style="top:'+(this.initConfig.header?"33":"5")+'px; bottom: 5px; height: auto; border-left-style: solid; cursor: e-resize;"></div><div class="resize-border left top" style="border-top-left-radius: 5px; cursor: nw-resize;"></div><div class="resize-border top" style="left: 4px; right: 4px; width: auto; z-index: 2; border-bottom-style:'+(this.initConfig.header?"none":"solid")+'; cursor: n-resize;"></div><div class="resize-border right top" style="border-top-right-radius: 5px; cursor: ne-resize;"></div>';this.initConfig.header&&(n+='<div class="resize-border left" style="top: 5px; height: 28px; cursor: w-resize;"></div><div class="resize-border right" style="top: 5px; height: 28px; cursor: e-resize;"></div>'),this.$window.append(_.template(n)),this.binding.resize=_.bind(p,this),this.binding.resizeStop=_.bind(m,this),this.binding.resizeStart=_.bind(h,this),e&&e.length>1&&(this.initConfig.minwidth=e[0]),e&&e.length>1&&(this.initConfig.minheight=e[1]),i&&i.length>1&&(this.initConfig.maxwidth=i[0]),i&&i.length>1&&(this.initConfig.maxheight=i[1]),this.$window.find(".resize-border").on("mousedown",this.binding.resizeStart)}else this.$window.find(".resize-border").remove();this.resizable=t}else t&&(e&&e.length>1&&(this.initConfig.minwidth=e[0]),e&&e.length>1&&(this.initConfig.minheight=e[1]),i&&i.length>1&&(this.initConfig.maxwidth=i[0]),i&&i.length>1&&(this.initConfig.maxheight=i[1]))},suspendKeyEvents:function(){this.pauseKeyEvents=!1},resumeKeyEvents:function(){this.initConfig.enableKeyEvents&&(this.pauseKeyEvents=!0)},onPrimary:function(){},getFocusedComponents:function(){return[]},getDefaultFocusableComponent:function(){},cancelButtonText:"Cancel",okButtonText:"OK",yesButtonText:"Yes",noButtonText:"No",closeButtonText:"Close",textWarning:"Warning",textError:"Error",textConfirmation:"Confirmation",textInformation:"Information",textDontShow:"Don't show this message again"}}(),Common.UI.Window||{}))}),define("common/main/lib/view/RenameDialog",["common/main/lib/component/Window"],function(){"use strict";Common.Views.RenameDialog=Common.UI.Window.extend(_.extend({options:{width:330,header:!1,cls:"modal-dlg",filename:"",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,t||{}),this.template=['<div class="box">','<div class="input-row">',"<label>"+this.textName+"</label>","</div>",'<div id="id-dlg-newname" class="input-row"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this;t.inputName=new Common.UI.InputField({el:$("#id-dlg-newname"),style:"width: 100%;",validateOnBlur:!1,maxLength:t.options.maxLength,validation:function(e){return!/[\t*\+:\"<>?|\\\\/]/gim.test(e)||t.txtInvalidName+'*+:"<>?|/'}});var e=this.getChild();e.find(".btn").on("click",_.bind(this.onBtnClick,this)),t.inputNameEl=e.find("input")},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var t=this,e=t.options.filename.lastIndexOf(".");e>0&&(t.options.filename=t.options.filename.substring(0,e)),_.delay(function(){t.inputName.setValue(t.options.filename),t.inputNameEl.focus().select()},100)},onPrimary:function(t){return this._handleInput("ok"),!1},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},_handleInput:function(t){if(this.options.handler){if("ok"==t&&!0!==this.inputName.checkValidate())return void this.inputNameEl.focus();this.options.handler.call(this,t,this.inputName.getValue())}this.close()},textName:"File name",txtInvalidName:"The file name cannot contain any of the following characters: "},Common.Views.RenameDialog||{}))}),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/Header",["backbone","text!common/main/lib/template/Header.template","core","common/main/lib/view/RenameDialog"],function(t,e){"use strict";Common.Views.Header=t.View.extend(_.extend(function(){function t(t,e){var i=t.getEditingCount();h&&(i>1||i>0&&d&&!d.isEdit&&!d.isRestrictedEdit?(h.html(b({users:t.chain().filter(function(t){return t.get("online")&&!t.get("view")}).groupBy(function(t){return t.get("idOriginal")}).value(),usertpl:_.template(g),fnEncode:function(t){return Common.Utils.String.htmlEncode(AscCommon.UserInfoParser.getParsedName(t))}})),h.scroller=new Common.UI.Scroller({el:h.find("ul"),useKeyboard:!0,minScrollbarLength:40,alwaysVisibleY:!0}),h.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})):h.empty()),n(i,t.getEditingOriginalCount())}function i(e){t(e.collection)}function n(t,e){if(m){var i=t>1||t>0&&d&&!d.isEdit&&!d.isRestrictedEdit;i?(m.attr("data-toggle","dropdown").addClass("dropdown-toggle").menu=!0,p.show()):(m.removeAttr("data-toggle").removeClass("dropdown-toggle").menu=!1,p[!u&&d&&(d.sharingSettingsUrl&&d.sharingSettingsUrl.length||d.canRequestSharingSettings)?"show":"hide"]()),m.find(".caption").css({"font-size":i?"12px":"14px","margin-top":i?"0":"-1px"}).html(i?e:"&plus;");var n=m.data("bs.tooltip");n&&(n.options.title=i?n.options.titleExt:n.options.titleNorm,n.setContent())}}function o(){u=!0,p&&p.find("#tlb-change-rights").hide(),m&&!m.menu&&p.hide()}function s(t){if(m.menu){var e=m.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.hide())}else p.removeClass("open"),Common.NotificationCenter.trigger("collaboration:sharing")}function a(t){if(this.labelDocName&&(t.isCrypted&&this.labelDocName.before('<div class="inner-box-icon crypted"><svg class="icon"><use xlink:href="#svg-icon-crypted"></use></svg></div>'),!t.isEdit||!t.customization||!t.customization.compactHeader)){var e=this.labelDocName.parent(),i=e.position().left,n=e.next().outerWidth();i<n?this.labelDocName.parent().css("padding-left",n-i):this.labelDocName.parent().css("padding-right",i-n)}}function r(e){d=e;var i=this;if(i.btnGoBack.on("click",function(t){Common.NotificationCenter.trigger("goback")}),i.btnFavorite.on("click",function(t){Common.NotificationCenter.trigger("markfavorite",!i.options.favorite)}),i.logo&&i.logo.children(0).on("click",function(t){var e=i.branding&&i.branding.logo&&void 0!==i.branding.logo.url?i.branding.logo.url:"https://www.onlyoffice.com/";if(e){var n=window.open(e);n&&n.focus()}}),p){t(c),p.on("shown.bs.dropdown",function(){h.scroller&&h.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})}),p.find(".cousers-menu").on("click",function(t){return!1});var n=c.getEditingCount();m.tooltip({title:n>1||n>0&&!d.isEdit&&!d.isRestrictedEdit?i.tipViewUsers:i.tipAccessRights,titleNorm:i.tipAccessRights,titleExt:i.tipViewUsers,placement:"bottom",html:!0}),m.on("click",s.bind(i));var o=p.find("#tlb-change-rights");o.on("click",function(t){p.removeClass("open"),Common.NotificationCenter.trigger("collaboration:sharing")}),o[!e.isOffline&&(e.sharingSettingsUrl&&e.sharingSettingsUrl.length||e.canRequestSharingSettings)?"show":"hide"](),p[n>1||n>0&&!d.isEdit&&!d.isRestrictedEdit||!e.isOffline&&(e.sharingSettingsUrl&&e.sharingSettingsUrl.length||e.canRequestSharingSettings)?"show":"hide"]()}d.user.guest&&d.canRenameAnonymous&&(i.labelUserName?(i.labelUserName.addClass("clickable"),i.labelUserName.on("click",function(t){Common.NotificationCenter.trigger("user:rename")})):i.btnUserName&&i.btnUserName.on("click",function(t){Common.NotificationCenter.trigger("user:rename")})),i.btnPrint&&(i.btnPrint.updateHint(i.tipPrint+Common.Utils.String.platformKey("Ctrl+P")),i.btnPrint.on("click",function(t){i.fireEvent("print",i)})),i.btnSave&&(i.btnSave.updateHint(i.tipSave+Common.Utils.String.platformKey("Ctrl+S")),i.btnSave.on("click",function(t){i.fireEvent("save",i)})),i.btnUndo&&(i.btnUndo.updateHint(i.tipUndo+Common.Utils.String.platformKey("Ctrl+Z")),i.btnUndo.on("click",function(t){i.fireEvent("undo",i)})),
i.btnRedo&&(i.btnRedo.updateHint(i.tipRedo+Common.Utils.String.platformKey("Ctrl+Y")),i.btnRedo.on("click",function(t){i.fireEvent("redo",i)})),e.isEdit||(i.btnDownload&&(i.btnDownload.updateHint(i.tipDownload),i.btnDownload.on("click",function(t){i.fireEvent("downloadas",["original"])})),i.btnEdit&&(i.btnEdit.updateHint(i.tipGoEdit),i.btnEdit.on("click",function(t){i.fireEvent("go:editor",i)}))),i.btnOptions&&i.btnOptions.updateHint(i.tipViewSettings)}function l(t){var e=this,i=e.labelDocName.val();t.keyCode==Common.UI.Keys.RETURN?(i=i.trim(),_.isEmpty(i)||e.documentCaption===i||(/[\t*\+:\"<>?|\\\\/]/gim.test(i)?_.defer(function(){Common.UI.error({msg:(new Common.Views.RenameDialog).txtInvalidName+'*+:"<>?|/',callback:function(){_.delay(function(){e.labelDocName.focus()},50)}}),e.labelDocName.blur()}):(Common.Gateway.requestRename(i),Common.NotificationCenter.trigger("edit:complete",e)))):t.keyCode==Common.UI.Keys.ESC?(e.labelDocName.val(e.documentCaption),Common.NotificationCenter.trigger("edit:complete",this)):e.labelDocName.attr("size",i.length>10?i.length:10)}var c,d,h,p,m,u=!1,g='<li id="<%= user.get("iid") %>" class="<% if (!user.get("online")) { %> offline <% } if (user.get("view")) {%> viewmode <% } %>"><div class="user-name"><div class="color" style="background-color: <%= user.get("color") %>;"></div><label><%= fnEncode(user.get("username")) %></label><% if (len>1) { %><label style="margin-left:3px;">(<%=len%>)</label><% } %></div></li>',b=_.template("<ul><% for (originalId in users) { %><%= usertpl({user: users[originalId][0], fnEncode: fnEncode, len: users[originalId].length}) %><% } %></ul>");return{options:{branding:{},documentCaption:"",canBack:!1},el:"#header",template:_.template(e),events:{},initialize:function(e){var n=this;this.options=this.options?_.extend(this.options,e):e,this.documentCaption=this.options.documentCaption,this.branding=this.options.customization,this.isModified=!1,n.btnGoBack=new Common.UI.Button({id:"btn-goback",cls:"btn-header",iconCls:"toolbar__icon icon--inverse btn-goback",split:!0}),c=this.options.storeUsers,c.bind({add:i,change:i,reset:t}),n.btnOptions=new Common.UI.Button({cls:"btn-header no-caret",iconCls:"toolbar__icon icon--inverse btn-ic-options",menu:!0}),n.mnuZoom={options:{value:100}},n.btnFavorite=new Common.UI.Button({id:"btn-favorite",cls:"btn-header",iconCls:"toolbar__icon icon--inverse btn-favorite"}),Common.NotificationCenter.on({"app:ready":function(t){Common.Utils.asyncCall(r,n,t)},"app:face":function(t){Common.Utils.asyncCall(a,n,t)}}),Common.NotificationCenter.on("collaboration:sharingdeny",o)},render:function(t,e){return $(t).html(this.getPanel(e)),this},getPanel:function(t,e){function i(t,e,i){return new Common.UI.Button({cls:"btn-header",iconCls:t,disabled:!0===i}).render(e)}var n=this;if(!("left"!=t||e&&e.isDesktopApp))return o=$('<section class="logo"><div id="header-logo"><i></i></div></section>'),this.logo=o.find("#header-logo"),this.branding&&this.branding.logo&&this.branding.logo.image&&this.logo&&(this.logo.html('<img src="'+this.branding.logo.image+'" style="max-width:100px; max-height:20px; margin: 0;"/>'),this.logo.css({"background-image":"none",width:"auto"}),(this.branding.logo.url||void 0===this.branding.logo.url)&&this.logo.addClass("link")),o;if("right"==t){var o=$(_.template('<section><section id="box-doc-name"><label id="rib-doc-name" /></section><section style="display: inherit;"><div class="hedset"><div class="btn-slot" id="slot-hbtn-edit"></div><div class="btn-slot" id="slot-hbtn-print"></div><div class="btn-slot" id="slot-hbtn-download"></div></div><div class="hedset"><section id="tlb-box-users" class="box-cousers dropdown""><div class="btn-users"><i class="icon toolbar__icon icon--inverse btn-users"></i><label class="caption">&plus;</label></div><div class="cousers-menu dropdown-menu"><label id="tlb-users-menu-descr"><%= tipUsers %></label><div class="cousers-list"></div><label id="tlb-change-rights" class="link"><%= txtAccessRights %></label></div></section></div><div class="hedset"><div class="btn-slot" id="slot-btn-back"></div><div class="btn-slot" id="slot-btn-favorite"></div><div class="btn-slot" id="slot-btn-options"></div></div><div class="hedset"><div class="btn-slot" id="slot-btn-user-name"></div><div class="btn-current-user btn-header hidden"><i class="icon toolbar__icon icon--inverse btn-user"></i></div></div></section></section>')({tipUsers:this.labelCoUsersDescr,txtAccessRights:this.txtAccessRights}));return n.labelDocName?o.find("#rib-doc-name").hide():(n.labelDocName=o.find("#rib-doc-name"),n.documentCaption&&n.labelDocName.text(n.documentCaption)),_.isUndefined(this.options.canRename)||this.setCanRename(this.options.canRename),!0===this.options.canBack?n.btnGoBack.render(o.find("#slot-btn-back")):o.find("#slot-btn-back").hide(),void 0!==this.options.favorite&&null!==this.options.favorite?(n.btnFavorite.render(o.find("#slot-btn-favorite")),n.btnFavorite.changeIcon(n.options.favorite?{next:"btn-in-favorite"}:{curr:"btn-in-favorite"}),n.btnFavorite.updateHint(n.options.favorite?n.textRemoveFavorite:n.textAddFavorite)):o.find("#slot-btn-favorite").hide(),e.isEdit||(!e.canDownload&&!e.canDownloadOrigin||e.isOffline||(this.btnDownload=i("toolbar__icon icon--inverse btn-download",o.findById("#slot-hbtn-download"))),e.canPrint&&(this.btnPrint=i("toolbar__icon icon--inverse btn-print",o.findById("#slot-hbtn-print"))),e.canEdit&&e.canRequestEditRights&&(this.btnEdit=i("toolbar__icon icon--inverse btn-edit",o.findById("#slot-hbtn-edit")))),n.btnOptions.render(o.find("#slot-btn-options")),(!e.isEdit||e.customization&&e.customization.compactHeader)&&(e.user.guest&&e.canRenameAnonymous?n.btnUserName=i("toolbar__icon icon--inverse btn-user",o.findById("#slot-btn-user-name")):(n.elUserName=o.find(".btn-current-user"),n.elUserName.removeClass("hidden")),n.setUserName(n.options.userName)),h=o.find(".cousers-list"),p=o.find(".box-cousers"),m=o.find(".btn-users"),p.hide(),o}if("title"==t){var o=$(_.template('<section id="box-document-title"><div class="extra"></div><div class="hedset"><div class="btn-slot" id="slot-btn-dt-save"></div><div class="btn-slot" id="slot-btn-dt-print"></div><div class="btn-slot" id="slot-btn-dt-undo"></div><div class="btn-slot" id="slot-btn-dt-redo"></div></div><div class="lr-separator" id="id-box-doc-name"><label id="title-doc-name" /></div><label id="title-user-name"></label></section>')());if(!!n.labelDocName&&n.labelDocName.hide().off(),n.labelDocName=o.find("#title-doc-name"),n.labelDocName.text(n.documentCaption),n.labelUserName=$("> #title-user-name",o),n.setUserName(n.options.userName),e.canPrint&&e.isEdit&&(n.btnPrint=i("toolbar__icon icon--inverse btn-print",o.findById("#slot-btn-dt-print"),!0)),n.btnSave=i("toolbar__icon icon--inverse btn-save",o.findById("#slot-btn-dt-save"),!0),n.btnUndo=i("toolbar__icon icon--inverse btn-undo",o.findById("#slot-btn-dt-undo"),!0),n.btnRedo=i("toolbar__icon icon--inverse btn-redo",o.findById("#slot-btn-dt-redo"),!0),n.btnSave.$icon.is("svg")){n.btnSave.$icon.addClass("icon-save btn-save");var s=function(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg","use");return i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t),i.setAttribute("id",e),$(i)};s("#svg-btn-save-coauth","coauth").appendTo(n.btnSave.$icon),s("#svg-btn-save-sync","sync").appendTo(n.btnSave.$icon)}return o}},setVisible:function(t){},setBranding:function(t){var e;this.branding=t,t&&t.logo&&t.logo.image&&(e=$("#header-logo"))&&(e.html('<img src="'+t.logo.image+'" style="max-width:100px; max-height:20px; margin: 0;"/>'),e.css({"background-image":"none",width:"auto"}),(t.logo.url||void 0===t.logo.url)&&e.addClass("link"))},setDocumentCaption:function(t){return!t&&(t=""),this.documentCaption=t,this.isModified&&(t+="*"),this.labelDocName&&(this.labelDocName.text(t),this.setCanRename(!0)),t},getDocumentCaption:function(){return this.documentCaption},setDocumentChanged:function(t){this.isModified=t;var e=this.documentCaption;t&&(e+="*"),this.labelDocName.text(e)},setCanBack:function(t,e){return this.options.canBack=t,this.btnGoBack[t?"show":"hide"](),t&&this.btnGoBack.updateHint(e&&"string"==typeof e?e:this.textBack),this},getCanBack:function(){return this.options.canBack},setFavorite:function(t){return this.options.favorite=t,this.btnFavorite[void 0!==t&&null!==t?"show":"hide"](),this.btnFavorite.changeIcon(t?{next:"btn-in-favorite"}:{curr:"btn-in-favorite"}),this.btnFavorite.updateHint(t?this.textRemoveFavorite:this.textAddFavorite),this},getFavorite:function(){return this.options.favorite},setCanRename:function(t){t=!1;var e=this;if(e.options.canRename=t,e.labelDocName){var i=e.labelDocName;if(t)i.removeAttr("disabled").tooltip({title:e.txtRename,placement:"cursor"}),i.on({keydown:l.bind(this),blur:function(t){}});else{i.off(),i.attr("disabled",!0);var n=i.data("bs.tooltip");n&&(n.options.title="",n.setContent())}i.attr("data-can-copy",t)}},setUserName:function(t){return this.labelUserName?t?this.labelUserName.text(t).show():this.labelUserName.hide():(this.options.userName=t,this.btnUserName?this.btnUserName.updateHint(t):this.elUserName&&this.elUserName.tooltip({title:t,placement:"cursor",html:!0})),this},getButton:function(t){return"save"==t?this.btnSave:"users"==t?p:void 0},lockHeaderBtns:function(t,e){var i=this;if("users"==t)e?m.addClass("disabled").attr("disabled","disabled"):m.removeClass("disabled").attr("disabled","");else if("rename-user"==t)i.labelUserName?e?(i.labelUserName.removeClass("clickable"),i.labelUserName.addClass("disabled")):(i.labelUserName.addClass("clickable"),i.labelUserName.removeClass("disabled")):i.btnUserName&&i.btnUserName.setDisabled(e);else{var n=function(t){t&&(e?(t.keepState={disabled:t.isDisabled()},t.setDisabled(!0)):(t.setDisabled(t.keepState&&t.keepState.disabled||e),delete t.keepState))};switch(t){case"undo":n(i.btnUndo);break;case"redo":n(i.btnRedo);break;case"opts":n(i.btnOptions)}}},fakeMenuItem:function(){return{conf:{checked:!1,disabled:!1},setChecked:function(t){this.conf.checked=t},isChecked:function(){return this.conf.checked},setDisabled:function(t){this.conf.disabled=t},isDisabled:function(){return this.conf.disabled}}},textBack:"Go to Documents",txtRename:"Rename",txtAccessRights:"Change access rights",tipAccessRights:"Manage document access rights",labelCoUsersDescr:"Document is currently being edited by several users.",tipViewUsers:"View users and manage document access rights",tipDownload:"Download file",tipPrint:"Print file",tipGoEdit:"Edit current file",tipSave:"Save",tipUndo:"Undo",tipRedo:"Redo",textCompactView:"Hide Toolbar",textHideStatusBar:"Hide Status Bar",textHideLines:"Hide Rulers",textZoom:"Zoom",textAdvSettings:"Advanced Settings",tipViewSettings:"View Settings",textRemoveFavorite:"Remove from Favorites",textAddFavorite:"Mark as favorite",textHideNotes:"Hide Notes"}}(),Common.Views.Header||{}))}),define("text!documenteditor/main/app/template/Viewport.template",[],function(){return'<div class="layout-region">\n    <div id="viewport-vbox-layout" class="layout-ct vbox">\n        <section class="layout-ct">\n            <div id="file-menu-panel" class="toolbar-fullview-panel" style="display:none;"></div>\n        </section>\n        <section id="app-title" class="layout-item"></section>\n        <div id="toolbar" class="layout-item"></div>\n        <div class="layout-item middle">\n            <div id="viewport-hbox-layout" class="layout-ct hbox">\n                <div id="left-menu" class="layout-item" style="width: 40px;"></div>\n                <div id="about-menu-panel" class="left-menu-full-ct" style="display:none;"></div>\n                <div id="editor-container" class="layout-item"><div id="editor_sdk"></div></div>\n                <div id="right-menu" class="layout-item"></div>\n                <div id="left-panel-history" class="layout-item"></div>\n            </div>\n        </div>\n        <div id="statusbar" class="layout-item"></div>\n    </div>\n</div>\n'}),void 0===Common)var Common={};if(define("common/main/lib/component/Layout",["backbone"],function(){"use strict";var t=function(t){this.box=null,this.panels=[],this.splitters=[],_.extend(this,t||{})},e=function(){return{width:null,height:null,resize:!1,stretch:!1,rely:!1}};_.extend(t.prototype,Backbone.Events,{initialize:function(t){this.$parent=this.box.parent(),this.resize={eventMove:_.bind(this.resizeMove,this),eventStop:_.bind(this.resizeStop,this)};this.freeze=t.freeze,this.changeLayout(t.items)},doLayout:function(){},changeLayout:function(t){var i,n,o=!1;this.splitters&&this.splitters.forEach(function(t){t.resizer&&t.resizer.el.remove()},this),this.splitters=[],this.panels=[],t.forEach(function(t){t.el instanceof HTMLElement&&(t.el=$(t.el)),i=_.extend(new e,t),i.stretch&&(o=!0,i.rely=!1,i.resize=!1),this.panels.push(i),i.resize&&(n={isresizer:!0,minpos:i.resize.min||0,maxpos:i.resize.max||0,fmin:i.resize.fmin,fmax:i.resize.fmax,behaviour:i.behaviour,index:this.splitters.length,offset:i.resize.offset||0,multiply:i.resize.multiply},o?(i.resize.el=n.el=i.el.before('<div class="layout-resizer before"></div>').prev(),this.panels.splice(this.panels.length-1,0,n)):(i.resize.el=n.el=i.el.after('<div class="layout-resizer after"></div>').next(),this.panels.push(n)),this.splitters.push({resizer:n}),i.resize.hidden&&n.el.hide(),Common.Gateway.on("processmouse",this.resize.eventStop))},this),this.freezePanels(this.freeze)},getElementHeight:function(t){return parseInt(t.css("height"))},getElementWidth:function(t){return parseInt(t.css("width"))},getItem:function(t){for(var e in this.panels){var i=this.panels[e];if(i.alias==t)return i}},onSelectStart:function(t){return t.preventDefault&&t.preventDefault(),!1},addHandler:function(t,e,i){t.addEventListener?t.addEventListener(e,i):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i},removeHandler:function(t,e,i){t.removeEventListener?t.removeEventListener(e,i):t.detachEvent?t.detachEvent("on"+e,i):t["on"+e]=null},clearSelection:function(){if(window.getSelection){var t=window.getSelection();t.empty?t.empty():t.removeAllRanges&&t.removeAllRanges()}else document.selection&&document.selection.empty()},resizeStart:function(t){if(!this.freeze){this.clearSelection(),this.addHandler(window.document,"selectstart",this.onSelectStart),$(document).on({mousemove:this.resize.eventMove,mouseup:this.resize.eventStop}),Common.NotificationCenter.on({"frame:mousemove":this.resize.eventMove,"frame:mouseup":this.resize.eventStop});var e=t.data.panel;this.resize.type=t.data.type,this.resize.$el=e.el,this.resize.min=e.minpos,this.resize.fmin=e.fmin,this.resize.fmax=e.fmax,this.resize.behaviour=e.behaviour,this.resize.multiply=e.multiply,this.resize.$el.addClass("move"),"vertical"==t.data.type?(this.resize.height=parseInt(this.resize.$el.css("height")),this.resize.max=(e.maxpos>0?e.maxpos:this.resize.$el.parent().height()+e.maxpos)-this.resize.height,this.resize.inity=t.pageY*Common.Utils.zoom()-parseInt(t.currentTarget.style.top)):"horizontal"==t.data.type&&(this.resize.width=parseInt(this.resize.$el.css("width")),this.resize.max=(e.maxpos>0?e.maxpos:this.resize.$el.parent().width()+e.maxpos)-this.resize.width,this.resize.initx=t.pageX*Common.Utils.zoom()-parseInt(t.currentTarget.style.left)),this.resize.multiply&&this.resize.multiply.koeff&&(this.resize.max=Math.floor(this.resize.max/this.resize.multiply.koeff)*this.resize.multiply.koeff+(this.resize.multiply.offset||0)),Common.NotificationCenter.trigger("layout:resizestart")}},resizeMove:function(t){var e=t instanceof jQuery.Event?Common.Utils.zoom():1;if("vertical"==this.resize.type)var i="top",n=t.pageY*e-this.resize.inity;else"horizontal"==this.resize.type&&(i="left",n=t.pageX*e-this.resize.initx);if(this.resize.multiply&&this.resize.multiply.koeff){var o=this.resize.multiply.koeff,s=n/o,a=Math.floor(s)*o+(this.resize.multiply.offset||0),r=Math.ceil(s)*o+(this.resize.multiply.offset||0);n=n>a+o/2?r:a}this.resize.fmin&&this.resize.fmax?n<this.resize.fmin()||n>this.resize.fmax()||(this.resize.$el[0].style[i]=n+"px"):n<this.resize.min||n>this.resize.max||(this.resize.$el[0].style[i]=n+"px")},resizeStop:function(t){if(this.removeHandler(window.document,"selectstart",this.onSelectStart),$(document).off({mousemove:this.resize.eventMove,mouseup:this.resize.eventStop}),Common.NotificationCenter.off({"frame:mousemove":this.resize.eventMove,"frame:mouseup":this.resize.eventStop}),this.resize.$el){var e=t instanceof jQuery.Event?Common.Utils.zoom():1;if(t instanceof jQuery.Event||void 0!==t.pageY&&void 0!==t.pageX||(t.pageY=t.y,t.pageX=t.x),"vertical"==this.resize.type)var i="height",n=t.pageY*e-this.resize.inity;else"horizontal"==this.resize.type&&(i="width",n=t.pageX*e-this.resize.initx);if(this.resize.multiply&&this.resize.multiply.koeff){var o=this.resize.multiply.koeff,s=n/o,a=Math.floor(s)*o+(this.resize.multiply.offset||0),r=Math.ceil(s)*o+(this.resize.multiply.offset||0);n=n>a+o/2?r:a}this.resize.fmin&&this.resize.fmax?(n<this.resize.fmin()&&(n=this.resize.fmin()),n>this.resize.fmax()&&(n=this.resize.fmax())):(n<this.resize.min&&(n=this.resize.min),n>this.resize.max&&(n=this.resize.max));var l=null,c=null,d=0;this.resize.$el.hasClass("after")?(l=this.resize.$el.prev(),c=this.resize.$el.next(),d=parseInt(l.css(i))):(l=this.resize.$el.next(),c=this.resize.$el.next(),d=parseInt(l.css(i)),n=l.parent()[i]()-(n+this.resize[i])),"vertical"==this.resize.type&&(n-=l.position().top),"horizontal"==this.resize.type&&(n-=l.position().left),l.css(i,n+"px"),this.resize.behaviour&&c.css(i,parseInt(c.css(i))-(n-d)),this.resize.$el.removeClass("move"),delete this.resize.$el,this.resize.value!=n&&(this.doLayout(),this.trigger("layout:resizedrag",this)),Common.NotificationCenter.trigger("layout:resizestop")}},freezePanels:function(t){this.panels.forEach(function(e){!e.stretch&&e.resize&&$(e.resize.el).css("cursor",t?"default":"")}),this.freeze=t},setResizeValue:function(t,e){if(t>=this.splitters.length)return this.doLayout(),!1;var i=null,n=null,o=0,s=this.splitters[t].resizer,a="height";return e<s.fmin()&&(e=s.fmin()),e>s.fmax()&&(e=s.fmax()),s.el.hasClass("after")?(i=s.el.prev(),n=s.el.next(),o=parseInt(i.css(a))):(i=s.el.next(),e=i.parent()[a]()-(e+s[a]),n=s.el.next(),o=parseInt(i.css(a))),e-=i.position().top,i.css(a,e+"px"),s.behaviour&&n.css(a,parseInt(n.css(a))-(e-o)),s.value!=e&&this.doLayout(),Math.abs(o-e)>.99}}),!Common.UI&&(Common.UI={}),Common.UI.VBoxLayout=function(e){t.apply(this,arguments),this.initialize.apply(this,arguments)},Common.UI.VBoxLayout.prototype=_.extend(new t,{initialize:function(e){t.prototype.initialize.call(this,e)},doLayout:function(){var t,e,i=0;this.panels.forEach(function(n){n.stretch?t=n:(e=n.el.is(":visible"),e&&(i+=!0!==n.rely?n.height:this.getElementHeight(n.el)),n.resize&&!1!==n.resize.autohide&&n.resize.el&&(e?(n.resize.el.show(),t&&(i+=n.resize.height)):(n.resize.el.hide(),t&&(i-=n.resize.height))))},this),t&&(t.height=this.$parent.height()-i),i=0,this.panels.forEach(function(t){t.el.is(":visible")&&(e={top:i},!0!==t.rely&&(e.height=t.height),t.el.css(e),i+=e.height||this.getElementHeight(t.el))},this)},changeLayout:function(e){t.prototype.changeLayout.call(this,e),this.panels.forEach(function(t){!t.stretch&&!t.height&&(t.height=this.getElementHeight(t.el)),t.isresizer&&t.el.on("mousedown",{type:"vertical",panel:t},_.bind(this.resizeStart,this))},this),this.doLayout.call(this)}}),Common.UI.HBoxLayout=function(e){t.apply(this,arguments),this.initialize.apply(this,arguments)},Common.UI.HBoxLayout.prototype=_.extend(new t,{initialize:function(e){t.prototype.initialize.call(this,e)},doLayout:function(t){var e,i,n=0;this.panels.forEach(function(t){t.stretch?e=t:(i=t.el.is(":visible"),i&&(t.isresizer?n+=t.offset:n+=!0!==t.rely?t.width:this.getElementWidth(t.el)),t.resize&&!1!==t.resize.autohide&&t.resize.el&&(i?(t.resize.el.show(),e&&(n-=t.resize.width)):(t.resize.el.hide(),e&&(n-=t.resize.width))))},this),e&&(e.width=this.$parent.width()-n),n=0,this.panels.forEach(function(t){t.el.is(":visible")&&(i={left:n-(t.isresizer?t.width:0)},!0!==t.rely&&(i.width=t.width),t.el.css(i),t.isresizer?n+=t.offset:n+=this.getElementWidth(t.el))},this)},changeLayout:function(e){t.prototype.changeLayout.call(this,e),this.panels.forEach(function(t){!t.stretch&&!t.width&&(t.width=this.getElementWidth(t.el)),t.isresizer&&t.el.on("mousedown",{type:"horizontal",panel:t},_.bind(this.resizeStart,this))},this),this.doLayout.call(this)}}),Common.UI.VBoxLayout.prototype.constructor=Common.UI.VBoxLayout,Common.UI.HBoxLayout.prototype.constructor=Common.UI.HBoxLayout}),define("documenteditor/main/app/view/Viewport",["text!documenteditor/main/app/template/Viewport.template","jquery","underscore","backbone","common/main/lib/component/Layout"],function(t,e,i,n){"use strict";DE.Views.Viewport=n.View.extend({el:"#viewport",template:i.template(t),events:{},initialize:function(){},render:function(){this.$el.html(this.template({})),Common.Utils.isSafari?(e("body").addClass("safari"),e("body").mousewheel(function(t){t.preventDefault(),t.stopPropagation()})):Common.Utils.isChrome&&e("body").addClass("chrome");var t=e("#viewport-vbox-layout",this.$el);this.vlayout=new Common.UI.VBoxLayout({box:t,items:[{el:t.find("> .layout-item#app-title").hide(),alias:"title",height:Common.Utils.InternalSettings.get("document-title-height")},{el:t.find(" > .layout-item#toolbar"),alias:"toolbar",height:Common.localStorage.getBool("de-compact-toolbar")?Common.Utils.InternalSettings.get("toolbar-height-compact"):Common.Utils.InternalSettings.get("toolbar-height-normal")},{el:t.find(" > .layout-item.middle"),stretch:!0},{el:t.find(" > .layout-item#statusbar"),height:25}]}),t=e("#viewport-hbox-layout",this.$el);var i=t.find(" > .layout-item");return this.hlayout=new Common.UI.HBoxLayout({box:t,items:[{el:i[0],rely:!0,resize:{hidden:!0,autohide:!1,min:300,max:600}},{el:i[3],rely:!0,resize:{hidden:!0,autohide:!1,min:300,max:600}},{el:i[1],stretch:!0},{el:e(i[2]).hide(),rely:!0}]}),this},applyEditorMode:function(){var t=this,e=DE.getController("RightMenu").getView("RightMenu");t._rightMenu=e.render(this.mode),Common.localStorage.getBool("de-hidden-status")&&DE.getController("Statusbar").getView("Statusbar").setVisible(!1)},setMode:function(t){t.isDisconnected?(i.isUndefined(this.mode)&&(this.mode={}),this.mode.canCoAuthoring=!1):this.mode=t}})}),define("text!documenteditor/main/app/template/LeftMenu.template",[],function(){return'<div id="view-left-menu" class="tool-menu left">\r\n    <div class="tool-menu-btns">\r\n        <button id="left-btn-search" class="btn btn-category" content-target=""><i class="icon toolbar__icon btn-menu-search">&nbsp;</i></button>\r\n        \x3c!-- /** coauthoring begin **/ --\x3e\r\n        <button id="left-btn-comments" class="btn btn-category" content-target="left-panel-comments"><i class="icon toolbar__icon btn-menu-comments">&nbsp;</i></button>\r\n        <button id="left-btn-chat" class="btn btn-category" content-target="left-panel-chat"><i class="icon toolbar__icon btn-menu-chat">&nbsp;</i></button>\r\n        \x3c!-- /** coauthoring end **/ --\x3e\r\n        <button id="left-btn-plugins" class="btn btn-category" content-target=""><i class="icon toolbar__icon btn-menu-plugin">&nbsp;</i></button>\r\n        <button id="left-btn-navigation" class="btn btn-category" content-target=""><i class="icon toolbar__icon btn-menu-navigation">&nbsp;</i></button>\r\n        <button id="left-btn-support" class="btn btn-category" content-target=""><i class="icon toolbar__icon btn-menu-support">&nbsp;</i></button>\r\n        <button id="left-btn-about" class="btn btn-category" content-target=""><i class="icon toolbar__icon btn-menu-about">&nbsp;</i></button>\r\n    </div>\r\n    <div class="left-panel" style="">\r\n        \x3c!-- /** coauthoring begin **/ --\x3e\r\n        <div id="left-panel-comments" class="" style="display: none;"></div>\r\n        <div id="left-panel-chat" class="" style="display: none;"></div>\r\n        \x3c!-- /** coauthoring end **/ --\x3e\r\n        <div id="left-panel-navigation" class="" style="display: none; height: 100%;"></div>\r\n        <div id="left-panel-plugins" class="" style="display: none; height: 100%;"></div>\r\n    </div>\r\n</div>'}),void 0===Common)var Common={};if(define("common/main/lib/component/ToggleManager",["common/main/lib/component/BaseView"],function(){"use strict";function t(t,i){var n,o,s;if(i)for(n=e[t.toggleGroup],o=0,s=n.length;o<s;o++)n[o]!==t&&(n[o].isActive?n[o].isActive()&&n[o].toggle(!1):n[o].toggle(!1))}var e={};Common.UI.ToggleManager={register:function(i){if(i.toggleGroup){var n=e[i.toggleGroup];n||(n=e[i.toggleGroup]=[]),n.push(i),i.on("toggle",t)}},unregister:function(i){if(i.toggleGroup){var n=e[i.toggleGroup];n&&(_.without(n,i),i.off("toggle",t))}},getToggled:function(t){var i,n=e[t],o=0;if(n)for(i=n.length;o<i;o++)if(!0===n[o].pressed||!0===n[o].checked)return n[o];return null}}}),void 0===Common)var Common={};if(define("common/main/lib/component/Button",["common/main/lib/component/BaseView","common/main/lib/component/ToggleManager"],function(){"use strict";window.createButtonSet=function(){function t(t){}t.prototype=new Array,t.prototype.constructor=t;var e=!1;t.prototype.add=function(t){t.setDisabled(e),this.push(t)},t.prototype.setDisabled=function(t){e=t,this.forEach(function(e){e.setDisabled(t)})},t.prototype.toggle=function(t,e){this.forEach(function(i){i.toggle(t,e)})},t.prototype.pressed=function(){return this.some(function(t){return t.pressed})},t.prototype.contains=function(t){return this.some(function(e){return e.id==t})},t.prototype.concat=function(){var t=Array.prototype.slice.call(arguments),e=Array.prototype.slice.call(this);return t.forEach(function(t){t instanceof Array?Array.prototype.push.apply(e,t):t&&e.push(t)}),e};var i=Object.create(t.prototype);for(var n in arguments)i.add(arguments[n]);return i};Common.UI.Button=Common.UI.BaseView.extend({options:{id:null,hint:!1,enableToggle:!1,allowDepress:!0,toggleGroup:null,cls:"",iconCls:"",caption:"",menu:null,disabled:!1,pressed:!1,split:!1,visible:!0},template:_.template(["<% var applyicon = function() { %>","<% if (iconImg) { print('<img src=\"' + iconImg + '\">'); } else { %>",'<% if (iconCls != "") {  if (/svgicon/.test(iconCls)) {print(\'<svg class="icon"><use class="zoom-int" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'"></use><use class="zoom-grit" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'-150"></use></svg>\');} else print(\'<i class="icon \' + iconCls + \'">&nbsp;</i>\'); }} %>',"<% } %>","<% if ( !menu ) { %>",'<button type="button" class="btn <%= cls %>" id="<%= id %>" style="<%= style %>">',"<% applyicon() %>",'<span class="caption"><%= caption %></span>',"</button>","<% } else if (split == false) {%>",'<div class="btn-group" id="<%= id %>" style="<%= style %>">','<button type="button" class="btn dropdown-toggle <%= cls %>" data-toggle="dropdown">',"<% applyicon() %>",'<span class="caption"><%= caption %></span>','<span class="inner-box-caret"><i class="caret"></i></span>',"</button>","</div>","<% } else { %>",'<div class="btn-group split" id="<%= id %>" style="<%= style %>">','<button type="button" class="btn <%= cls %>">',"<% applyicon() %>",'<span class="caption"><%= caption %></span>',"</button>",'<button type="button" class="btn <%= cls %> dropdown-toggle" data-toggle="dropdown">','<i class="caret"></i>','<span class="sr-only"></span>',"</button>","</div>","<% } %>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.id=e.options.id||Common.UI.getId(),e.hint=e.options.hint,e.enableToggle=e.options.enableToggle,e.allowDepress=e.options.allowDepress,e.cls=e.options.cls,e.iconCls=e.options.iconCls,e.menu=e.options.menu,e.split=e.options.split,e.toggleGroup=e.options.toggleGroup,e.disabled=e.options.disabled,e.visible=e.options.visible,e.pressed=e.options.pressed,e.caption=e.options.caption,e.template=e.options.template||e.template,e.style=e.options.style,e.rendered=!1,e.options.el?e.render():e.options.parentEl&&e.render(e.options.parentEl)},render:function(t){var e=this;if(e.trigger("render:before",e),e.cmpEl=e.$el||$(e.el),t&&(e.setElement(t,!1),e.rendered||(/icon-top/.test(e.cls)&&e.caption&&/huge/.test(e.cls)&&(!0===e.split?(!!e.cls&&(e.cls=e.cls.replace(/\s?(?:x-huge|icon-top)/g,"")),this.template=_.template('<div class="btn-group x-huge split icon-top" id="<%= id %>" style="<%= style %>"><button type="button" class="btn <%= cls %> inner-box-icon"><span class="btn-fixflex-hcenter"><% if ( iconImg ) { %><img src="<%= iconImg %>"><% } else { %><% if (/svgicon/.test(iconCls)) {print(\'<svg class="icon"><use class="zoom-int" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'"></use><use class="zoom-grit" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'-150"></use></svg>\');} else print(\'<i class="icon \' + iconCls + \'">&nbsp;</i>\'); %><% } %></span></button><button type="button" class="btn <%= cls %> inner-box-caption dropdown-toggle" data-toggle="dropdown"><span class="btn-fixflex-vcenter"><span class="caption"><%= caption %></span><i class="caret"></i></span></button></div>')):e.menu?this.template=_.template('<div class="btn-group icon-top" id="<%= id %>" style="<%= style %>"><button type="button" class="btn dropdown-toggle <%= cls %>" data-toggle="dropdown"><div class="inner-box-icon"><% if ( iconImg ) { %><img src="<%= iconImg %>"><% } else { %><% if (/svgicon/.test(iconCls)) {print(\'<svg class="icon"><use class="zoom-int" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'"></use><use class="zoom-grit" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'-150"></use></svg>\');} else print(\'<i class="icon \' + iconCls + \'">&nbsp;</i>\'); %><% } %></div><div class="inner-box-caption"><span class="caption"><%= caption %></span><i class="caret"></i></div></button></div>'):this.template=_.template('<button type="button" class="btn <%= cls %>" id="<%= id %>" > <div class="inner-box-icon"><% if ( iconImg ) { %><img src="<%= iconImg %>"><% } else { %><% if (/svgicon/.test(iconCls)) {print(\'<svg class="icon"><use class="zoom-int" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'"></use><use class="zoom-grit" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'-150"></use></svg>\');} else print(\'<i class="icon \' + iconCls + \'">&nbsp;</i>\'); %><% } %></div><div class="inner-box-caption"><span class="caption"><%= caption %></span></div></button>')),e.cmpEl=$(this.template({id:e.id,cls:e.cls,iconCls:e.iconCls,iconImg:e.options.iconImg,menu:e.menu,split:e.split,disabled:e.disabled,pressed:e.pressed,caption:e.caption,style:e.style})),e.menu&&_.isObject(e.menu)&&_.isFunction(e.menu.render)&&e.menu.render(e.cmpEl),t.html(e.cmpEl),e.$icon=e.$el.find(".icon"))),!e.rendered){var i=e.cmpEl,n=i.hasClass("btn-group"),o=i.hasClass("split");if(e.options.hint){var s=e.cmpEl.closest(".asc-window");if("object"==typeof e.options.hint&&e.options.hint.length>1&&$("button",i).length>0){var a=$("button",i);e.btnEl=$(a[0]),e.btnMenuEl=$(a[1])}else e.btnEl=e.cmpEl,e.btnEl.attr("data-toggle","tooltip");if(e.btnEl.tooltip({title:"string"==typeof e.options.hint?e.options.hint:e.options.hint[0],placement:e.options.hintAnchor||"cursor"}),e.btnMenuEl&&e.btnMenuEl.tooltip({title:e.options.hint[1],placement:e.options.hintAnchor||"cursor"}),s.length>0){e.btnEl.data("bs.tooltip").tip().css("z-index",parseInt(s.css("z-index"))+10),e.btnMenuEl&&e.btnMenuEl.data("bs.tooltip").tip().css("z-index",parseInt(s.css("z-index"))+10);var r=function(t){if(s[0]===t.$window[0]){var i=e.btnEl.data("bs.tooltip");i&&(void 0===i.dontShow&&(i.dontShow=!0),i.hide()),Common.NotificationCenter.off({"modal:close":r})}};Common.NotificationCenter.on({"modal:close":r})}}_.isString(e.toggleGroup)&&(e.enableToggle=!0);var l,c=function(t){if(!e.disabled&&1==t.which){if(e.doToggle(),e.options.hint){var i=e.btnEl.data("bs.tooltip")
;i&&(void 0===i.dontShow&&(i.dontShow=!0),i.hide())}e.trigger("click",e,t)}},d=function(t,n,s){if(!t){var a=!1;$("button",i).each(function(t,e){if($(e).is(":hover"))return a=!0,!1}),a||(i.removeClass("over"),$("button",i).removeClass("over"))}if("button"==n){if(!t&&e.enableToggle&&e.allowDepress&&e.pressed)return;if(t&&!o&&e.enableToggle&&e.allowDepress&&!e.pressed)return void s.preventDefault();$("button:first",i).toggleClass("active",t)}else $("[data-toggle^=dropdown]",i).toggleClass("active",t);i.toggleClass("active",t)},h=function(t){if(!e.disabled&&1==t.which&&o){if(e.options.hint){var n=(e.btnMenuEl?e.btnMenuEl:e.btnEl).data("bs.tooltip");n&&(void 0===n.dontShow&&(n.dontShow=!0),n.hide())}var s=i.hasClass("open");d(!s,"arrow",t)}},p=function(t,e){o?d(e,"button",t):(i.toggleClass("active",e),$("button",i).toggleClass("active",e))},m=function(t){l=t.currentTarget.className.match(/dropdown/)?"arrow":"button",d(!0,l,t),$(document).on("mouseup",u)},u=function(t){d(!1,l,t),$(document).off("mouseup",u)},g=function(t,i){e.cmpEl.find(".dropdown-toggle").blur(),e.cmpEl.hasClass("active")!==e.pressed&&e.cmpEl.trigger("button.internal.active",[e.pressed])};n?(o&&($("[data-toggle^=dropdown]",i).on("mousedown",_.bind(h,this)),$("button",i).on("mousedown",_.bind(m,this)),e.options.width>0&&$("button:first",i).css("width",e.options.width-$("[data-toggle^=dropdown]",i).outerWidth())),i.on("hide.bs.dropdown",_.bind(d,e,!1,"arrow")),i.on("show.bs.dropdown",_.bind(d,e,!0,"arrow")),i.on("hidden.bs.dropdown",_.bind(g,e)),$("button:first",i).on("click",c)):i.on("click",c),i.on("button.internal.active",_.bind(p,e)),i.on("mouseover",function(t){e.disabled||(e.cmpEl.addClass("over"),e.trigger("mouseover",e,t))}),i.on("mouseout",function(t){e.cmpEl.removeClass("over"),e.disabled||e.trigger("mouseout",e,t)}),Common.UI.ToggleManager.register(e)}return e.rendered=!0,e.pressed&&e.toggle(e.pressed,!0),e.disabled&&e.setDisabled(!(e.disabled=!1)),e.visible||e.setVisible(e.visible),e.trigger("render:after",e),this},doToggle:function(){var t=this;!t.enableToggle||!1===t.allowDepress&&t.pressed||t.toggle()},toggle:function(t,e){var i=void 0===t?!this.pressed:!!t;this.pressed=i,this.cmpEl&&this.cmpEl.trigger("button.internal.active",[i]),e||this.trigger("toggle",this,i)},click:function(t){this.disabled||(this.doToggle(),this.trigger("click",this,t))},isActive:function(){return this.enableToggle?this.pressed:this.cmpEl.hasClass("active")},setDisabled:function(t){if(this.rendered&&this.disabled!=t){var e=this.cmpEl,i=e.hasClass("btn-group"),n=this;if((t=!0===t)!==e.hasClass("disabled")){var o=function(e){e.toggleClass("disabled",t),n.options.allowMouseEventsOnDisabled||(t?e.attr({disabled:t}):e.removeAttr("disabled"))};o(e),i&&o(e.children("button"))}if((t||!Common.Utils.isGecko)&&this.options.hint){var s=this.btnEl.data("bs.tooltip");s&&(t&&s.hide(),!Common.Utils.isGecko&&(s.enabled=!t)),this.btnMenuEl&&(s=this.btnMenuEl.data("bs.tooltip"))&&(t&&s.hide(),!Common.Utils.isGecko&&(s.enabled=!t))}if(t&&this.menu&&_.isObject(this.menu)&&this.menu.rendered&&this.menu.isVisible()&&setTimeout(function(){n.menu.hide()},1),n.options.signals){n.options.signals.indexOf("disabled")<0||n.trigger("disabled",n,t)}}this.disabled=t},isDisabled:function(){return this.disabled},setIconCls:function(t){var e=$(this.el).find(".icon"),i=this.iconCls;if(this.iconCls=t,/svgicon/.test(this.iconCls)){var n=/svgicon\s(\S+)/.exec(this.iconCls);e.find("use.zoom-int").attr("xlink:href",n&&n.length>1?"#"+n[1]:""),e.find("use.zoom-grit").attr("xlink:href",n&&n.length>1?"#"+n[1]+"-150":"")}else e.removeClass(i),e.addClass(t||"")},changeIcon:function(t){var e=this;t&&(t.curr||t.next)&&e.$icon&&(!!t.curr&&e.$icon.removeClass(t.curr),!!t.next&&!e.$icon.hasClass(t.next)&&e.$icon.addClass(t.next),e.options.signals&&(e.options.signals.indexOf("icon:changed")<0||e.trigger("icon:changed",e,t)))},hasIcon:function(t){return this.$icon.hasClass(t)},setVisible:function(t){this.cmpEl&&this.cmpEl.toggleClass("hidden",!t),this.visible=t},isVisible:function(){return this.cmpEl?this.cmpEl.is(":visible"):$(this.el).is(":visible")},updateHint:function(t){if(this.options.hint=t,this.rendered){var e=this.cmpEl,i=e.closest(".asc-window");if(!this.btnEl)if("object"==typeof this.options.hint&&this.options.hint.length>1&&$("button",e).length>0){var n=$("button",e);this.btnEl=$(n[0]),this.btnMenuEl=$(n[1])}else this.btnEl=e,this.btnEl.attr("data-toggle","tooltip");if(this.btnEl.data("bs.tooltip")&&this.btnEl.removeData("bs.tooltip"),this.btnMenuEl&&this.btnMenuEl.data("bs.tooltip")&&this.btnMenuEl.removeData("bs.tooltip"),this.btnEl.tooltip({title:"string"==typeof t?t:t[0],placement:this.options.hintAnchor||"cursor"}),this.btnMenuEl&&this.btnMenuEl.tooltip({title:t[1],placement:this.options.hintAnchor||"cursor"}),i.length>0&&(this.btnEl.data("bs.tooltip").tip().css("z-index",parseInt(i.css("z-index"))+10),this.btnMenuEl&&this.btnMenuEl.data("bs.tooltip").tip().css("z-index",parseInt(i.css("z-index"))+10)),this.disabled||!Common.Utils.isGecko){var o=this.btnEl.data("bs.tooltip");o&&(this.disabled&&o.hide(),!Common.Utils.isGecko&&(o.enabled=!this.disabled)),this.btnMenuEl&&(o=this.btnMenuEl.data("bs.tooltip"))&&(this.disabled&&o.hide(),!Common.Utils.isGecko&&(o.enabled=!this.disabled))}}},setCaption:function(t){if(this.caption!=t&&(this.caption=t,this.rendered)){var e=this.cmpEl.find(".caption");e.length>0?e.text(t):this.cmpEl.find("button:first").addBack().filter("button").text(t)}},setMenu:function(t){t&&_.isObject(t)&&_.isFunction(t.render)&&(this.menu=t,this.rendered&&this.menu.render(this.cmpEl))}})}),function(t){"function"==typeof define&&define.amd?define("jmousewheel",["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){function e(e){var a=e||window.event,r=l.call(arguments,1),c=0,d=0,h=0,p=0;if(e=t.event.fix(a),e.type="mousewheel","detail"in a&&(h=-1*a.detail),"wheelDelta"in a&&(h=a.wheelDelta),"wheelDeltaY"in a&&(h=a.wheelDeltaY),"wheelDeltaX"in a&&(d=-1*a.wheelDeltaX),"axis"in a&&a.axis===a.HORIZONTAL_AXIS&&(d=-1*h,h=0),c=0===h?d:h,"deltaY"in a&&(h=-1*a.deltaY,c=h),"deltaX"in a&&(d=a.deltaX,0===h&&(c=-1*d)),0!==h||0!==d){if(1===a.deltaMode){var m=t.data(this,"mousewheel-line-height");c*=m,h*=m,d*=m}else if(2===a.deltaMode){var u=t.data(this,"mousewheel-page-height");c*=u,h*=u,d*=u}return p=Math.max(Math.abs(h),Math.abs(d)),(!s||p<s)&&(s=p,n(a,p)&&(s/=40)),n(a,p)&&(c/=40,d/=40,h/=40),c=Math[c>=1?"floor":"ceil"](c/s),d=Math[d>=1?"floor":"ceil"](d/s),h=Math[h>=1?"floor":"ceil"](h/s),e.deltaX=d,e.deltaY=h,e.deltaFactor=s,e.deltaMode=0,r.unshift(e,c,d,h),o&&clearTimeout(o),o=setTimeout(i,200),(t.event.dispatch||t.event.handle).apply(this,r)}}function i(){s=null}function n(t,e){return d.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120==0}var o,s,a=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],r="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],l=Array.prototype.slice;if(t.event.fixHooks)for(var c=a.length;c;)t.event.fixHooks[a[--c]]=t.event.mouseHooks;var d=t.event.special.mousewheel={version:"3.1.9",setup:function(){if(this.addEventListener)for(var i=r.length;i;)this.addEventListener(r[--i],e,!1);else this.onmousewheel=e;t.data(this,"mousewheel-line-height",d.getLineHeight(this)),t.data(this,"mousewheel-page-height",d.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=r.length;t;)this.removeEventListener(r[--t],e,!1);else this.onmousewheel=null},getLineHeight:function(e){return parseInt(t(e)["offsetParent"in t.fn?"offsetParent":"parent"]().css("fontSize"),10)},getPageHeight:function(e){return t(e).height()},settings:{adjustOldDeltas:!0}};t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}),function(t){"use strict";"function"==typeof define&&define.amd?define("perfectscrollbar",["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";var e={wheelSpeed:10,wheelPropagation:!1,minScrollbarLength:null,useBothWheelAxes:!1,useKeyboard:!0,suppressScrollX:!1,suppressScrollY:!1,scrollXMarginOffset:0,scrollYMarginOffset:0,includePadding:!1,includeMargin:!0},i=function(){var t=0;return function(){var e=t;return t+=1,".perfect-scrollbar-"+e}}();t.fn.perfectScrollbar=function(n,o){return this.each(function(){var s=t.extend(!0,{},e),a=t(this);if("object"==typeof n?t.extend(!0,s,n):o=n,"update"===o)return a.data("perfect-scrollbar-update")&&a.data("perfect-scrollbar-update")(),a;if("destroy"===o)return a.data("perfect-scrollbar-destroy")&&a.data("perfect-scrollbar-destroy")(),a;if(a.data("perfect-scrollbar"))return a.data("perfect-scrollbar");a.addClass("ps-container oo");var r,l,c,d,h,p,m,u,g,b,f,C,v=t("<div class='ps-scrollbar-x-rail'></div>").appendTo(a),_=t("<div class='ps-scrollbar-y-rail'></div>").appendTo(a),y=t("<div class='ps-scrollbar-x'></div>").appendTo(v),x=t("<div class='ps-scrollbar-y'></div>").appendTo(_),w=parseInt(v.css("bottom"),10),S=parseInt(_.css("right"),10),A=i(),k=function(t,e){var i=t+e,n=C-b;f=i<0?0:i>n?n:i;var o=parseInt(f*(p-d)/(C-b),10);a.scrollTop(o),v.css({bottom:w-o})},T=function(t,e){var i=t+e,n=g-m;u=i<0?0:i>n?n:i;var o=parseInt(u*(h-c)/(g-m),10);a.scrollLeft(o),_.css({right:S-o})},I=function(t){return s.minScrollbarLength&&(t=Math.max(t,s.minScrollbarLength)),t},P=function(){v.css({left:a.scrollLeft(),bottom:w-a.scrollTop(),width:g,display:r?"inherit":"none"}),_.hasClass("in-scrolling")?_.css({right:S-a.scrollLeft(),height:C,display:l?"inherit":"none"}):_.css({top:a.scrollTop(),right:S-a.scrollLeft(),height:C,display:l?"inherit":"none"}),y&&y.css({left:u,width:m}),x&&x.css({top:f,height:b})},M=function(){c=s.includePadding?a.innerWidth():a.width(),d=s.includePadding?a.innerHeight():a.height(),C=d-(s.includeMargin?parseInt(_.css("margin-top"))+parseInt(_.css("margin-bottom")):0),g=c-(s.includeMargin?parseInt(v.css("margin-left"))+parseInt(v.css("margin-right")):0),h=a.prop("scrollWidth"),p=a.prop("scrollHeight"),!s.suppressScrollX&&c+s.scrollXMarginOffset<h?(r=!0,m=I(parseInt(g*c/h,10)),u=parseInt(a.scrollLeft()*(g-m)/(h-c),10)):(r=!1,m=0,u=0,a.scrollLeft(0)),!s.suppressScrollY&&d+s.scrollYMarginOffset<p?(l=!0,b=I(parseInt(C*d/p,10)),f=parseInt(a.scrollTop()*(C-b)/(p-d),10)):(l=!1,b=0,f=0,a.scrollTop(0)),f>=C-b&&(f=C-b),u>=g-m&&(u=g-m),P(),s.onChange&&s.onChange(this)},U=function(){var e,i;y.bind("mousedown"+A,function(t){i=t.pageX,e=y.position().left,v.addClass("in-scrolling"),t.stopPropagation(),t.preventDefault()}),t(document).bind("mousemove"+A,function(t){v.hasClass("in-scrolling")&&(T(e,t.pageX-i),t.stopPropagation(),t.preventDefault())}),t(document).bind("mouseup"+A,function(t){v.hasClass("in-scrolling")&&v.removeClass("in-scrolling")}),e=i=null},B=function(){var e,i;x.bind("mousedown"+A,function(t){i=t.pageY,e=x.position().top,_.addClass("in-scrolling");var n=parseInt(_.css("margin-top")),o=_[0].getBoundingClientRect();_.css({position:"fixed",left:o.left,top:o.top-n}),t.stopPropagation(),t.preventDefault()}),t(document).bind("mousemove"+A,function(t){_.hasClass("in-scrolling")&&(k(e,t.pageY-i),t.stopPropagation(),t.preventDefault())}),t(document).bind("mouseup"+A,function(t){_.hasClass("in-scrolling")&&(_.removeClass("in-scrolling"),_.css({position:"",left:"",top:""}),P())}),e=i=null},D=function(t,e){var i=a.scrollTop();if(0===t){if(!l)return!1;if(0===i&&e>0||i>=p-d&&e<0)return!s.wheelPropagation}var n=a.scrollLeft();if(0===e){if(!r)return!1;if(0===n&&t<0||n>=h-c&&t>0)return!s.wheelPropagation}return!0},E=function(){s.wheelSpeed/=10;var e=!1;a.bind("mousewheel"+A,function(i,n,o,c){var d=i.deltaX*i.deltaFactor||o,h=i.deltaY*i.deltaFactor||c;if(i&&i.target&&("textarea"===i.target.type||"input"===i.target.type)){i.stopImmediatePropagation(),i.preventDefault();var p=t(i.target).scrollTop(),m=0;return i.originalEvent?i.originalEvent.wheelDelta?m=i.originalEvent.wheelDelta:i.originalEvent.deltaY?m=40*-i.originalEvent.deltaY:i.originalEvent.detail&&(m=i.originalEvent.detail):m=void 0!==i.wheelDelta?i.wheelDelta:i.deltaY,void t(i.target).scrollTop(p-m)}e=!1,s.useBothWheelAxes?l&&!r?(h?a.scrollTop(a.scrollTop()-h*s.wheelSpeed):a.scrollTop(a.scrollTop()+d*s.wheelSpeed),e=!0):r&&!l&&(d?a.scrollLeft(a.scrollLeft()+d*s.wheelSpeed):a.scrollLeft(a.scrollLeft()-h*s.wheelSpeed),e=!0):(a.scrollTop(a.scrollTop()-h*s.wheelSpeed),a.scrollLeft(a.scrollLeft()+d*s.wheelSpeed)),M(),(e=e||D(d,h))&&(i.stopPropagation(),i.preventDefault())}),a.bind("MozMousePixelScroll"+A,function(t){e&&t.preventDefault()})},V=function(){var e=!1;a.bind("mouseenter"+A,function(t){e=!0}),a.bind("mouseleave"+A,function(t){e=!1});var i=!1;t(document).bind("keydown"+A,function(n){if(e&&!t(document.activeElement).is(":input,[contenteditable]")){var o=0,s=0;switch(n.which){case 37:o=-30;break;case 38:s=30;break;case 39:o=30;break;case 40:s=-30;break;case 33:s=90;break;case 32:case 34:s=-90;break;case 35:s=-d;break;case 36:s=d;break;default:return}a.scrollTop(a.scrollTop()-s),a.scrollLeft(a.scrollLeft()+o),i=D(o,s),i&&n.preventDefault()}})},F=function(){var t=function(t){t.stopPropagation()};x.bind("click"+A,t),_.bind("click"+A,function(t){var e=parseInt(b/2,10),i=t.pageY-_.offset().top-e,n=C-b,o=i/n;o<0?o=0:o>1&&(o=1),a.scrollTop((p-d)*o)}),y.bind("click"+A,t),v.bind("click"+A,function(t){var e=parseInt(m/2,10),i=t.pageX-v.offset().left-e,n=g-m,o=i/n;o<0?o=0:o>1&&(o=1),a.scrollLeft((h-c)*o)})},R=function(){var e=function(t,e){a.scrollTop(a.scrollTop()-e),a.scrollLeft(a.scrollLeft()-t),M()},i={},n=0,o={},s=null,r=!1;t(window).bind("touchstart"+A,function(t){r=!0}),t(window).bind("touchend"+A,function(t){r=!1}),a.bind("touchstart"+A,function(t){var e=t.originalEvent.targetTouches[0];i.pageX=e.pageX,i.pageY=e.pageY,n=(new Date).getTime(),null!==s&&clearInterval(s),t.stopPropagation()}),a.bind("touchmove"+A,function(t){if(!r&&1===t.originalEvent.targetTouches.length){var s=t.originalEvent.targetTouches[0],a={};a.pageX=s.pageX,a.pageY=s.pageY;var l=a.pageX-i.pageX,c=a.pageY-i.pageY;e(l,c),i=a;var d=(new Date).getTime(),h=d-n;h>0&&(o.x=l/h,o.y=c/h,n=d),t.preventDefault()}}),a.bind("touchend"+A,function(t){clearInterval(s),s=setInterval(function(){if(Math.abs(o.x)<.01&&Math.abs(o.y)<.01)return void clearInterval(s);e(30*o.x,30*o.y),o.x*=.8,o.y*=.8},10)})},L=function(){a.bind("scroll"+A,function(t){M()})},N=function(){a.unbind(A),t(window).unbind(A),t(document).unbind(A),a.data("perfect-scrollbar",null),a.data("perfect-scrollbar-update",null),a.data("perfect-scrollbar-destroy",null),y.remove(),x.remove(),v.remove(),_.remove(),y=x=c=d=h=p=m=u=w=b=f=S=null},O=function(e){a.addClass("ie").addClass("ie"+e);6===e&&(function(){var e=function(){t(this).addClass("hover")},i=function(){t(this).removeClass("hover")};a.bind("mouseenter"+A,e).bind("mouseleave"+A,i),v.bind("mouseenter"+A,e).bind("mouseleave"+A,i),_.bind("mouseenter"+A,e).bind("mouseleave"+A,i),y.bind("mouseenter"+A,e).bind("mouseleave"+A,i),x.bind("mouseenter"+A,e).bind("mouseleave"+A,i)}(),function(){P=function(){y.css({left:u+a.scrollLeft(),bottom:w,width:m}),x.css({top:f+a.scrollTop(),right:S,height:b}),y.hide().show(),x.hide().show()}}())},H="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch;return function(){var t=navigator.userAgent.toLowerCase().match(/(msie) ([\w.]+)/);t&&"msie"===t[1]&&O(parseInt(t[2],10)),M(),L(),U(),B(),F(),H&&R(),a.mousewheel&&E(),s.useKeyboard&&V(),a.data("perfect-scrollbar",a),a.data("perfect-scrollbar-update",M),a.data("perfect-scrollbar-destroy",N)}(),a})}}),void 0===Common)var Common={};define("common/main/lib/component/Scroller",["jmousewheel","perfectscrollbar","common/main/lib/component/BaseView"],function(){"use strict";Common.UI.Scroller=function(){var t;return _.extend(Common.UI.BaseView.extend({options:{wheelSpeed:20,wheelPropagation:!1,minScrollbarLength:null,useBothWheelAxes:!1,useKeyboard:!0,suppressScrollX:!1,suppressScrollY:!1,scrollXMarginOffset:5,scrollYMarginOffset:5,includePadding:!0,includeMargin:!0,alwaysVisibleX:!1,alwaysVisibleY:!1},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.options.el&&this.render()},render:function(){var t=this;return t.cmpEl=t.$el||$(this.el),t.rendered||(t.cmpEl.perfectScrollbar(_.extend({},t.options)),t.rendered=!0,this.setAlwaysVisibleX(t.options.alwaysVisibleX),this.setAlwaysVisibleY(t.options.alwaysVisibleY)),this},remove:function(){this.destroy(),Backbone.View.prototype.remove.call(this)},update:function(e){var i=this.options;e?(this.destroy(),i=_.extend(this.options,e),this.cmpEl.perfectScrollbar(i)):this.cmpEl.perfectScrollbar("update"),this.setAlwaysVisibleX(i.alwaysVisibleX),this.setAlwaysVisibleY(i.alwaysVisibleY);var n=function(e){t=!0;var i=function(e){$(document).unbind("mouseup",i),_.delay(function(){t=!1},10)};$(document).mouseup(i)};$(".ps-scrollbar-x-rail, .ps-scrollbar-y-rail, .ps-scrollbar-x, .ps-scrollbar-y",this.cmpEl).off("mousedown",n).on("mousedown",n)},destroy:function(){this.cmpEl.perfectScrollbar("destroy")},scrollLeft:function(t){this.cmpEl.scrollLeft(t),this.update()},scrollTop:function(t){this.cmpEl.scrollTop(t),this.update()},getScrollTop:function(){return this.cmpEl.scrollTop()},getScrollLeft:function(){return this.cmpEl.scrollLeft()},setAlwaysVisibleX:function(t){t?($(this.el).find(".ps-scrollbar-x-rail").addClass("always-visible-x"),$(this.el).find(".ps-scrollbar-x").addClass("always-visible-x")):($(this.el).find(".ps-scrollbar-x-rail").removeClass("always-visible-x"),$(this.el).find(".ps-scrollbar-x").addClass("always-visible-x"))},setAlwaysVisibleY:function(t){t?($(this.el).find(".ps-scrollbar-y-rail").addClass("always-visible-y"),$(this.el).find(".ps-scrollbar-y").addClass("always-visible-y")):($(this.el).find(".ps-scrollbar-y-rail").removeClass("always-visible-y"),$(this.el).find(".ps-scrollbar-y").addClass("always-visible-y"))},isVisible:function(){return $(this.el).find(".ps-scrollbar-y-rail").is(":visible")}}),{isMouseCapture:function(){return t}})}()}),define("common/main/lib/view/About",["common/main/lib/component/BaseView","common/main/lib/component/Scroller"],function(){"use strict";Common.Views.About=Common.UI.BaseView.extend(_.extend({menu:void 0,rendered:!1,options:{alias:"Common.Views.About"},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.txtVersionNum="0.0.0",this.template=_.template(['<table id="id-about-licensor-logo" cols="1" style="width: 100%; margin-top: 20px;">',"<tr>",'<td align="center"><div class="asc-about-office"></div></td>',"</tr>","<tr>",'<td align="center"><label class="asc-about-version">'+t.appName.toUpperCase()+"</label></td>","</tr>","<tr>",'<td align="center"><label class="asc-about-version" id="id-about-licensor-version-name">'+this.txtVersion+this.txtVersionNum+"</label></td>","</tr>","</table>",'<table id="id-about-licensor-info" cols="3" style="width: 100%;" class="margin-bottom">',"<tr>",'<td colspan="3" align="center" style="padding: 20px 0 10px 0;"><label class="asc-about-companyname"><%= publishername %></label></td>',"</tr>","<tr>",'<td colspan="3" align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtAddress+"</label>",'<label class="asc-about-desc"><%= publisheraddr %></label>',"</td>","</tr>","<tr>",'<td colspan="3" align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtMail+"</label>",'<a href="mailto:<%= supportemail %>"><%= supportemail %></a>',"</td>","</tr>","<tr>",'<td colspan="3" align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtTel+"</label>",'<label class="asc-about-desc"><%= phonenum %></label>',"</td>","</tr>","<tr>",'<td colspan="3" align="center">','<a href="<%= publisherurl %>" target="_blank"><% print(publisherurl.replace(/https?:\\/{2}/, "").replace(/\\/$/,"")) %></a>',"</td>","</tr>","</table>",'<table id="id-about-licensee-info" cols="1" style="width: 100%; margin-top: 20px;" class="hidden margin-bottom"><tbody>',"<tr>",'<td align="center" class="padding-small"><div id="id-about-company-logo"></div></td>',"</tr>","<tr>",'<td align="center"><label class="asc-about-version">'+t.appName.toUpperCase()+"</label></td>","</tr>","<tr>",'<td align="center"><label style="padding-bottom: 29px;" class="asc-about-version" id="id-about-licensee-version-name">'+this.txtVersion+this.txtVersionNum+"</label></td>","</tr>","<tr>",'<td align="center" class="padding-small">','<label class="asc-about-companyname" id="id-about-company-name"></label>',"</td>","</tr>","<tr>",'<td align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtAddress+"</label>",'<label class="asc-about-desc" id="id-about-company-address"></label>',"</td>","</tr>","<tr>",'<td align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtMail+"</label>",'<a href="mailto:" id="id-about-company-mail"></a>',"</td>","</tr>","<tr>",'<td align="center" class="padding-small">','<a href="" target="_blank" id="id-about-company-url"></a>',"</td>","</tr>","<tr>",'<td align="center">','<label class="asc-about-lic" id="id-about-company-lic"></label>',"</td>","</tr>","</table>",'<table id="id-about-licensor-short" cols="1" style="width: 100%; margin-top: 31px;" class="hidden"><tbody>',"<tr>",'<td style="width:50%;"><div class="separator horizontal short left"></div></td>','<td align="center"><label class="asc-about-header">'+this.txtPoweredBy+"</label></td>",'<td style="width:50%;"><div class="separator horizontal short"></div></td>',"</tr>","<tr>",'<td colspan="3" align="center" style="padding: 9px 0 10px;"><label class="asc-about-companyname"><%= publishername %></label></td>',"</tr>","<tr>",'<td colspan="3" align="center">','<label class="asc-about-desc"><% print(publisherurl.replace(/https?:\\/{2}/, "").replace(/\\/$/,"")) %></label>',"</td>","</tr>","</table>"].join("")),this.menu=t.menu},render:function(){if(!this.rendered){this.rendered=!0;var t=$(this.template({publishername:"Ascensio System SIA",publisheraddr:"20A-12 Ernesta Birznieka-Upisha street, Riga, Latvia, EU, LV-1050",publisherurl:"https://www.onlyoffice.com/",supportemail:"support@onlyoffice.com",phonenum:"+371 633-99867",scope:this}));this.cntLicenseeInfo=t.findById("#id-about-licensee-info"),this.cntLicensorInfo=t.findById("#id-about-licensor-info"),this.divCompanyLogo=t.findById("#id-about-company-logo"),this.lblCompanyName=t.findById("#id-about-company-name"),this.lblCompanyAddress=t.findById("#id-about-company-address"),this.lblCompanyMail=t.findById("#id-about-company-mail"),this.lblCompanyUrl=t.findById("#id-about-company-url"),this.lblCompanyLic=t.findById("#id-about-company-lic"),this.$el.html(t),this.$el.addClass("about-dlg"),this.licData&&this.setLicInfo(this.licData),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el,suppressScrollX:!0}))}return this},setLicInfo:function(t){if(this.rendered)if(t&&"object"==typeof t&&"object"==typeof t.customer){var e=t.customer;$("#id-about-licensor-logo").addClass("hidden"),$("#id-about-licensor-short").removeClass("hidden"),this.cntLicensorInfo.addClass("hidden"),this.cntLicenseeInfo.removeClass("hidden"),this.cntLicensorInfo.removeClass("margin-bottom");var i=e.name;if(i&&i.length?this.lblCompanyName.text(i):this.lblCompanyName.parents("tr").addClass("hidden"),i=e.address,i&&i.length?this.lblCompanyAddress.text(i):this.lblCompanyAddress.parents("tr").addClass("hidden"),(i=e.mail)&&i.length?this.lblCompanyMail.attr("href","mailto:"+i).text(i):this.lblCompanyMail.parents("tr").addClass("hidden"),(i=e.www)&&i.length){var n=/^https?:\/{2}/i.test(i)?"":"http://";this.lblCompanyUrl.attr("href",n+i).text(i)}else this.lblCompanyUrl.parents("tr").addClass("hidden");(i=e.info)&&i.length?this.lblCompanyLic.text(i):this.lblCompanyLic.parents("tr").addClass("hidden"),(i=e.logo)&&i.length?this.divCompanyLogo.html('<img src="'+i+'" style="max-width:216px; max-height: 35px;" />'):this.divCompanyLogo.parents("tr").addClass("hidden")}else this.cntLicenseeInfo.addClass("hidden"),this.cntLicensorInfo.addClass("margin-bottom");else this.licData=t||!0},show:function(){this.rendered||this.render(),Common.UI.BaseView.prototype.show.call(this,arguments),this.fireEvent("show",this)},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments),this.fireEvent("hide",this)},setMode:function(t){t.isLightVersion&&($("#id-about-licensor-version-name").text(this.txtEdition+this.txtVersion+this.txtVersionNum),$("#id-about-licensee-version-name").text(this.txtEdition+this.txtVersion+this.txtVersionNum))},txtPoweredBy:"Powered by",txtVersion:"Version ",txtLicensor:"LICENSOR",txtLicensee:"LICENSEE",txtAddress:"address: ",txtMail:"email: ",txtTel:"tel.: ",txtEdition:"Integration Edition "},Common.Views.About||{}))}),define("text!common/main/lib/template/Comments.template",[],function(){return'<% if (!hide) { %>\r\n    <div id="<%= id %>" class="user-comment-item">\r\n\r\n        \x3c!-- comment block --\x3e\r\n\r\n        <div class="user-name">\r\n            <div class="color" style="display: inline-block; background-color: <% if (usercolor!==null) { %><%=usercolor%><% } else { %> #cfcfcf <% } %>; " ></div><%= scope.getUserName(username) %>\r\n        </div>\r\n        <div class="user-date"><%=date%></div>\r\n        <% if (quote!==null && quote!==\'\') { %>\r\n        <div class="user-quote"><%=scope.getFixedQuote(quote)%></div>\r\n        <% } %>\r\n        <% if (!editText || scope.viewmode) { %>\r\n            <div oo_editor_input="true" tabindex="-1" class="user-message user-select"><%=scope.pickLink(comment)%></div>\r\n        <% } else { %>\r\n            <div class="inner-edit-ct">\r\n                <textarea class="msg-reply user-select textarea-control" maxlength="maxCommLength"><%=comment%></textarea>\r\n                <button class="btn normal dlg-btn primary btn-inner-edit" id="id-comments-change">textEdit</button>\r\n                <button class="btn normal dlg-btn btn-inner-close">textCancel</button>\r\n            </div>\r\n        <% } %>\r\n\r\n        \x3c!-- replys elements --\x3e\r\n\r\n        <% var add_arrow = true; %>\r\n        <% if (replys.length) { %>\r\n            <% _.each(replys, function (item, index) { %>\r\n                <% if (!item.get("hide")) { %>\r\n                <% if (add_arrow) { add_arrow = false; %>\r\n                    <div class="reply-arrow img-commonctrl"></div>\r\n                <% } %>\r\n                <div class="reply-item-ct" <% if (scope.viewmode && index==replys.length-1) { %>style="padding-bottom: 0;" <% } %>;>\r\n                    <div class="user-name">\r\n                        <div class="color" style="display: inline-block; background-color: <% if (item.get("usercolor")!==null) { %><%=item.get("usercolor")%><% } else { %> #cfcfcf <% } %>; " ></div><%= scope.getUserName(item.get("username")) %>\r\n                    </div>\r\n                    <div class="user-date"><%=item.get("date")%></div>\r\n                    <% if (!item.get("editText")) { %>\r\n                        <div oo_editor_input="true" tabindex="-1" class="user-message user-select"><%=scope.pickLink(item.get("reply"))%></div>\r\n                        <% if (!scope.viewmode) { %>\r\n                            <div class="btns-reply-ct">\r\n                            <% if (item.get("editable")) { %>\r\n                                <div class="btn-edit img-commonctrl" data-value="<%=item.get("id")%>"></div>\r\n                            <% } %>\r\n                            <% if (item.get("removable")) { %>\r\n                                <div class="btn-delete img-commonctrl" data-value="<%=item.get("id")%>"></div>\r\n                            <% } %>\r\n                            </div>\r\n                        <%}%>\r\n                    <% } else { %>\r\n                        <div class="inner-edit-ct">\r\n                            <textarea class="msg-reply textarea-fix user-select textarea-control" maxlength="maxCommLength"><%=item.get("reply")%></textarea>\r\n                            <button class="btn normal dlg-btn primary btn-inner-edit btn-fix" id="id-comments-change">textEdit</button>\r\n                            <button class="btn normal dlg-btn btn-inner-close">textClose</button>\r\n                        </div>\r\n                    <% } %>\r\n                </div>\r\n                <% } %>\r\n            <% }); %>\r\n        <% } %>\r\n\r\n        \x3c!-- add reply button --\x3e\r\n\r\n        <% if (!showReply && !scope.viewmode) { %>\r\n            <% if (replys.length && !add_arrow) { %>\r\n                <label class="user-reply" style="margin-left: 20px; margin-top: 5px;" role="presentation" tabindex="-1">textAddReply</label>\r\n            <% } else { %>\r\n                <label class="user-reply" role="presentation" tabindex="-1">textAddReply</label>\r\n            <% } %>\r\n        <% } %>\r\n\r\n        \x3c!-- edit buttons --\x3e\r\n\r\n        <% if (!editText && !lock && !scope.viewmode) { %>\r\n            <div class="edit-ct">\r\n                <% if (editable) { %>\r\n                    <div class="btn-edit img-commonctrl"></div>\r\n                <% } %>\r\n                <% if (removable) { %>\r\n                    <div class="btn-delete img-commonctrl"></div>\r\n                <% } %>\r\n                <% if (editable) { %>\r\n                <div class="btn-resolve <% if (resolved) print(\'comment-resolved\') %>" data-toggle="tooltip"></div>\r\n                <% } %>\r\n            </div>\r\n        <% } %>\r\n\r\n        \x3c!-- reply --\x3e\r\n\r\n        <% if (showReply) { %>\r\n            <div class="reply-ct">\r\n                <textarea class="msg-reply user-select textarea-control" placeholder="textAddReply" maxlength="maxCommLength"></textarea>\r\n                <button class="btn normal dlg-btn primary btn-reply" id="id-comments-change">textReply</button>\r\n                <button class="btn normal dlg-btn btn-close">textClose</button>\r\n            </div>\r\n        <% } %>\r\n        <% if (lock) { %>\r\n            <div class="lock-area"></div>\r\n            <div class="lock-author"><%=lockuserid%></div>\r\n        <% } %>\r\n        <% if (!last) { %>\r\n            <div class="separator-cmt"></div>\r\n        <% } %>\r\n    </div>\r\n<% } %>\r\n'}),define("text!common/main/lib/template/CommentsPanel.template",[],function(){return'<div id="comments-box" class="layout-ct vbox">\r\n    <div class="layout-item messages-ct"></div>\r\n    <div class="layout-item add-link-ct">\r\n        <label class="btn new"><%=textAddCommentToDoc%></label>\r\n    </div>\r\n    <div style="display: none;" class="layout-item new-comment-ct">\r\n        <div class="inner-ct">\r\n            <textarea id="comment-msg-new" class="user-select textarea-control" placeholder="<%=textEnterCommentHint%>" maxlength="<%=maxCommLength%>"></textarea>\r\n        </div>\r\n        <button class="btn add normal dlg-btn primary"><%=textAddComment%></button>\r\n        <button class="btn cancel normal dlg-btn"><%=textCancel%></button>\r\n    </div>\r\n</div>\r\n'}),void 0===window.Common&&(window.Common={}),void 0===Common.Utils&&(Common.Utils={});var utils=new function(){var t=navigator.userAgent.toLowerCase(),e=function(e){return e.test(t)},i="CSS1Compat"==document.compatMode,n=function(e,i){var n;return e&&(n=i.exec(t))?parseFloat(n[1]):0},o=document.documentMode,s=(e(/edge/),
e(/opera/)),a=s&&e(/version\/10\.5/),r=!s&&(e(/msie/)||e(/trident/)||e(/edge/)),l=r&&(e(/msie 7/)&&8!=o&&9!=o&&10!=o||7==o),c=r&&(e(/msie 8/)&&7!=o&&9!=o&&10!=o||8==o),d=r&&(e(/msie 9/)&&7!=o&&8!=o&&10!=o||9==o),h=r&&(e(/msie 10/)&&7!=o&&8!=o&&9!=o||10==o),p=r&&(e(/trident\/7\.0/)&&7!=o&&8!=o&&9!=o&&10!=o||11==o),m=r&&e(/msie 6/),u=!r&&e(/\bchrome\b/),g=!r&&e(/webkit/),b=!r&&!u&&e(/safari/),f=b&&e(/applewebkit\/4/),C=b&&e(/version\/3/),v=b&&e(/version\/4/),_=b&&e(/version\/5\.0/),y=b&&e(/version\/5/),x=!g&&!r&&e(/gecko/),w=x&&e(/rv:1\.9/),S=x&&e(/rv:2\.0/),A=x&&e(/rv:5\./),k=x&&e(/rv:10\./),T=w&&e(/rv:1\.9\.0/),I=w&&e(/rv:1\.9\.1/),P=w&&e(/rv:1\.9\.2/),M=e(/windows|win32/),U=e(/macintosh|mac os x/),B=e(/linux/),D=n(!0,/\bchrome\/(\d+\.\d+)/),E=n(!0,/\bfirefox\/(\d+\.\d+)/),V=n(r,/msie (\d+\.\d+)/),F=n(s,/version\/(\d+\.\d+)/),R=n(b,/version\/(\d+\.\d+)/),L=n(g,/webkit\/(\d+\.\d+)/),N=/^https/i.test(window.location.protocol),O=/^(mailto:)?([a-z0-9'\._-]+@[a-z0-9\.-]+\.[a-z0-9]{2,4})([a-ÑÑ0-9\._%+-=\? :&]*)/i,H=/^(((https?)|(ftps?)):\/\/)?([\-\wÐ°-ÑÑ]*:?[\-\wÐ°-ÑÑ]*@)?(((1[0-9]{2}|2[0-4][0-9]|25[0-5]|[1-9][0-9]|[0-9])\.){3}(1[0-9]{2}|2[0-4][0-9]|25[0-5]|[1-9][0-9]|[0-9]))(:\d+)?(\/[%\-\wÐ°-ÑÑ]*(\.[\wÐ°-ÑÑ]{2,})?(([\wÐ°-ÑÑ\-\.\?\\\/+@&#;:`~=%!,\(\)]*)(\.[\wÐ°-ÑÑ]{2,})?)*)*\/?/i,z=/^(((https?)|(ftps?)):\/\/)?([\-\wÐ°-ÑÑ]*:?[\-\wÐ°-ÑÑ]*@)?(([\-\wÐ°-ÑÑ]+\.)+[\wÐ°-ÑÑ\-]{2,}(:\d+)?(\/[%\-\wÐ°-ÑÑ]*(\.[\wÐ°-ÑÑ]{2,})?(([\wÐ°-ÑÑ\-\.\?\\\/\+@&#;:`'~=%!,\(\)]*)(\.[\wÐ°-ÑÑ]{2,})?)*)*\/?)/i,G=/^(((https?)|(ftps?)):\/\/)([\-\wÐ°-ÑÑ]*:?[\-\wÐ°-ÑÑ]*@)?(([\-\wÐ°-ÑÑ]+)(:\d+)?(\/[%\-\wÐ°-ÑÑ]*(\.[\wÐ°-ÑÑ]{2,})?(([\wÐ°-ÑÑ\-\.\?\\\/\+@&#;:`'~=%!,\(\)]*)(\.[\wÐ°-ÑÑ]{2,})?)*)*\/?)/i,W=/(mailto:)?([a-z0-9'\._-]+@[a-z0-9\.-]+\.[a-z0-9]{2,4})([a-ÑÑ0-9\._%+-=\?:&]*)/gi,j=/(mailto:|\s[@]|\s[+])?([a-z0-9'\._-]+@[a-z0-9\.-]+\.[a-z0-9]{2,4})([a-ÑÑ0-9\._%\+-=\?:&]*)/gi,q=/(((https?)|(ftps?)):\/\/([\-\wÐ°-ÑÑ]*:?[\-\wÐ°-ÑÑ]*@)?)(((1[0-9]{2}|2[0-4][0-9]|25[0-5]|[1-9][0-9]|[0-9])\.){3}(1[0-9]{2}|2[0-4][0-9]|25[0-5]|[1-9][0-9]|[0-9]))(:\d+)?(\/[%\-\wÐ°-ÑÑ]*(\.[\wÐ°-ÑÑ]{2,})?(([\wÐ°-ÑÑ\-\.\?\\\/\+@&#;:`~=%!,\(\)]*)(\.[\wÐ°-ÑÑ]{2,})?)*)*\/?/gi,K=/((((https?)|(ftps?)):\/\/([\-\wÐ°-ÑÑ]*:?[\-\wÐ°-ÑÑ]*@)?)|(([\-\wÐ°-ÑÑ]*:?[\-\wÐ°-ÑÑ]*@)?www\.))((([\-\wÐ°-ÑÑ]+\.)+[\wÐ°-ÑÑ\-]{2,}|([\-\wÐ°-ÑÑ]+))(:\d+)?(\/[%\-\wÐ°-ÑÑ]*(\.[\wÐ°-ÑÑ]{2,})?(([\wÐ°-ÑÑ\-\.\?\\\/\+@&#;:`~=%!,\(\)]*)(\.[\wÐ°-ÑÑ]{2,})?)*)*\/?)/gi,Y={Paragraph:0,Table:1,Header:2,TextArt:3,Shape:4,Image:5,Slide:6,Chart:7,MailMerge:8,Signature:9,Pivot:10,Cell:11,Slicer:12,Form:13},X={DRM:0,CSV:1,TXT:2,Paste:3,Columns:4,Data:5},J=(/android|avantgo|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent||navigator.vendor||window.opera),this),Z=function(){var t={};if(window.AscCommon&&window.AscCommon.checkDeviceScale)t=window.AscCommon.checkDeviceScale(),AscCommon.correctApplicationScale(t);else{window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.25) and (-webkit-max-device-pixel-ratio: 1.49), screen and (min-resolution: 1.25dppx) and (max-resolution: 1.49dppx)").matches?t.devicePixelRatio=1.5:window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5) and (-webkit-max-device-pixel-ratio: 1.74), screen and (min-resolution: 1.5dppx) and (max-resolution: 1.74dppx)").matches?t.devicePixelRatio=1.5:window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.75) and (-webkit-max-device-pixel-ratio: 1.99), screen and (min-resolution: 1.75dppx) and (max-resolution: 1.99dppx)").matches?t.devicePixelRatio=1.75:window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 2), screen and (min-resolution: 2dppx), screen and (min-resolution: 192dpi)").matches?t.devicePixelRatio=2:t.devicePixelRatio=1}var e=$(document.body),i=document.body.className,n=i.replace(/pixel-ratio__[\w-]+/gi,"").trim();t.devicePixelRatio<1.25?/pixel-ratio__/.test(i)&&(document.body.className=n):t.devicePixelRatio<1.5?/pixel-ratio__1_25/.test(i)||(document.body.className=n+" pixel-ratio__1_25"):t.devicePixelRatio<1.75?/pixel-ratio__1_5/.test(i)||(document.body.className=n+" pixel-ratio__1_5"):!(t.devicePixelRatio<1.75)&&t.devicePixelRatio<2?/pixel-ratio__1_75/.test(i)||(document.body.className=n+" pixel-ratio__1_75"):(e.addClass("pixel-ratio__2"),/pixel-ratio__2/.test(i)||(document.body.className=n+" pixel-ratio__2")),J.zoom=t.correct?t.zoom:1,J.innerWidth=window.innerWidth*J.zoom,J.innerHeight=window.innerHeight*J.zoom,J.applicationPixelRatio=t.applicationPixelRatio||t.devicePixelRatio};return J.zoom=1,J.applicationPixelRatio=1,J.innerWidth=window.innerWidth,J.innerHeight=window.innerHeight,r?$(document.body).addClass("ie"):(Z(),$(window).on("resize",Z)),{checkSize:Z,userAgent:t,isStrict:i,isIEQuirks:r&&!i&&(m||l||c||d),isOpera:s,isOpera10_5:a,isWebKit:g,isChrome:u,isSafari:b,isSafari3:C,isSafari4:v,isSafari5:y,isSafari5_0:_,isSafari2:f,isIE:r,isIE6:m,isIE7:l,isIE7m:m||l,isIE7p:r&&!m,isIE8:c,isIE8m:m||l||c,isIE8p:r&&!(m||l),isIE9:d,isIE9m:m||l||c||d,isIE9p:r&&!(m||l||c),isIE10:h,isIE10m:m||l||c||d||h,isIE10p:r&&!(m||l||c||d),isIE11:p,isIE11m:m||l||c||d||h||p,isIE11p:r&&!(m||l||c||d||h),isGecko:x,isGecko3:w,isGecko4:S,isGecko5:A,isGecko10:k,isFF3_0:T,isFF3_5:I,isFF3_6:P,isFF4:4<=E&&E<5,isFF5:5<=E&&E<6,isFF10:10<=E&&E<11,isLinux:B,isWindows:M,isMac:U,chromeVersion:D,firefoxVersion:E,ieVersion:V,operaVersion:F,safariVersion:R,webKitVersion:L,isSecure:N,emailRe:O,ipRe:H,hostnameRe:z,localRe:G,emailStrongRe:W,emailAddStrongRe:j,ipStrongRe:q,hostnameStrongRe:K,documentSettingsType:Y,importTextType:X,zoom:function(){return J.zoom},applicationPixelRatio:function(){return J.applicationPixelRatio},topOffset:0,innerWidth:function(){return J.innerWidth},innerHeight:function(){return J.innerHeight},croppedGeometry:function(){return{left:0,top:Common.Utils.InternalSettings.get("window-inactive-area-top"),width:J.innerWidth,height:J.innerHeight-Common.Utils.InternalSettings.get("window-inactive-area-top")}}}};Common.Utils=_extend_object(Common.Utils,utils),Common.Utils.ThemeColor=new function(){return{ThemeValues:[6,15,7,16,0,1,2,3,4,5],setColors:function(t,e){var i,n,o;if(e&&e.length>0){var s=[];for(i=0;i<e.length;i++)o=this.getHexColor(e[i].get_r(),e[i].get_g(),e[i].get_b()),s.push(o);this.standartcolors=s}var a=[];for(i=0;i<6;i++)for(n=0;n<10;n++){var r=i+6*n;o={color:this.getHexColor(t[r].get_r(),t[r].get_g(),t[r].get_b()),effectId:r,effectValue:this.ThemeValues[n]},a.push(o)}this.effectcolors=a},getEffectColors:function(){return this.effectcolors},getStandartColors:function(){return this.standartcolors},getHexColor:function(t,e,i){return t=t.toString(16),e=e.toString(16),i=i.toString(16),1==t.length&&(t="0"+t),1==e.length&&(e="0"+e),1==i.length&&(i="0"+i),t+e+i},getRgbColor:function(t){var e="object"==typeof t?t.color:t;e=e.replace(/#/,""),3==e.length&&(e=e.replace(/(.)/g,"$1$1")),e=parseInt(e,16);var i=new Asc.asc_CColor;return i.put_type("object"==typeof t&&void 0!==t.effectId?Asc.c_oAscColor.COLOR_TYPE_SCHEME:Asc.c_oAscColor.COLOR_TYPE_SRGB),i.put_r(e>>16),i.put_g((65280&e)>>8),i.put_b(255&e),i.put_a(255),void 0!==t.effectId&&i.put_value(t.effectId),i},colorValue2EffectId:function(t){if("object"==typeof t&&t&&void 0!==t.effectValue&&this.effectcolors)for(var e=0;e<this.effectcolors.length;e++)if(this.effectcolors[e].effectValue===t.effectValue&&t.color.toUpperCase()===this.effectcolors[e].color.toUpperCase()){t.effectId=this.effectcolors[e].effectId;break}return t}}};var metrics=new function(){var t=this;return t.c_MetricUnits={cm:0,pt:1,inch:2},t.currentMetric=t.c_MetricUnits.pt,t.metricName=["Cm","Pt","Inch"],t.defaultMetric=t.c_MetricUnits.cm,{c_MetricUnits:t.c_MetricUnits,txtCm:"cm",txtPt:"pt",txtInch:'"',setCurrentMetric:function(e){t.currentMetric=e},getCurrentMetric:function(){return t.currentMetric},getCurrentMetricName:function(){return this["txt"+t.metricName[t.currentMetric]]},getMetricName:function(e){return this["txt"+t.metricName[void 0!==e?e:0]]},setDefaultMetric:function(e){t.defaultMetric=e},getDefaultMetric:function(){return t.defaultMetric},fnRecalcToMM:function(e){if(null!==e&&void 0!==e)switch(t.currentMetric){case t.c_MetricUnits.cm:return 10*e;case t.c_MetricUnits.pt:return 25.4*e/72;case t.c_MetricUnits.inch:return 25.4*e}return e},fnRecalcFromMM:function(e){switch(t.currentMetric){case t.c_MetricUnits.cm:return parseFloat((e/10).toFixed(4));case t.c_MetricUnits.pt:return parseFloat((72*e/25.4).toFixed(3));case t.c_MetricUnits.inch:return parseFloat((e/25.4).toFixed(3))}return e}}};if(Common.Utils.Metric=_extend_object(Common.Utils.Metric,metrics),Common.Utils.RGBColor=function(t){var e,i,n;"#"==t.charAt(0)&&(t=t.substr(1,6)),t=t.replace(/ /g,""),t=t.toLowerCase();for(var o=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},{re:/^hsb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,process:function(t){var e={},i=Math.round(t[1]),n=Math.round(255*t[2]/100),o=Math.round(255*t[3]/100);if(0==n)e.r=e.g=e.b=o;else{var s=o,a=(255-n)*o/255,r=i%60*(s-a)/60;360==i&&(i=0),i<60?(e.r=s,e.b=a,e.g=a+r):i<120?(e.g=s,e.b=a,e.r=s-r):i<180?(e.g=s,e.r=a,e.b=a+r):i<240?(e.b=s,e.r=a,e.g=s-r):i<300?(e.b=s,e.g=a,e.r=a+r):i<360?(e.r=s,e.g=a,e.b=s-r):(e.r=0,e.g=0,e.b=0)}return[Math.round(e.r),Math.round(e.g),Math.round(e.b)]}},{re:/^(\w{2})(\w{2})(\w{2})$/,process:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,process:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}}],s=0;s<o.length;s++){var a=o[s].re,r=o[s].process,l=a.exec(t);if(l){var c=r(l);e=c[0],i=c[1],n=c[2]}}return e=e<0||isNaN(e)?0:e>255?255:e,i=i<0||isNaN(i)?0:i>255?255:i,n=n<0||isNaN(n)?0:n>255?255:n,{r:e,g:i,b:n,isEqual:function(t){return e==t.r&&i==t.g&&n==t.b},toRGB:function(){return"rgb("+e+", "+i+", "+n+")"},toRGBA:function(t){return void 0===t&&(t=1),"rgba("+e+", "+i+", "+n+", "+t+")"},toHex:function(){var t=e.toString(16),o=i.toString(16),s=n.toString(16);return 1==t.length&&(t="0"+t),1==o.length&&(o="0"+o),1==s.length&&(s="0"+s),"#"+t+o+s},toHSB:function(){var t={h:0,s:0,b:0},o=Math.min(e,i,n),s=Math.max(e,i,n),a=s-o;return t.b=s,t.s=0!=s?255*a/s:0,0!=t.s?t.h=e==s?0+(i-n)/a:i==s?2+(n-e)/a:4+(e-i)/a:t.h=0,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t.h=parseInt(t.h),t.s=parseInt(t.s),t.b=parseInt(t.b),t}}},Common.Utils.String=new function(){return{format:function(t){var e=_.toArray(arguments).slice(1);return e.length&&"object"==typeof e[0]&&(e=e[0]),t.replace(/\{(\d+)\}/g,function(t,i){return e[i]})},htmlEncode:function(t){return"undefined"!=typeof _?_.escape(t):t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},htmlDecode:function(t){return _.unescape(t)},ellipsis:function(t,e,i){if(t&&t.length>e){if(i){var n=t.substr(0,e-2),o=Math.max(n.lastIndexOf(" "),n.lastIndexOf("."),n.lastIndexOf("!"),n.lastIndexOf("?"));if(-1!==o&&o>=e-15)return n.substr(0,o)+"..."}return t.substr(0,e-3)+"..."}return t},platformKey:function(t,e,i){return _.isEmpty(e)&&(e=" ({0})"),Common.Utils.isMac?(_.isFunction(i)&&(t=i.call(this,t)),Common.Utils.String.format(e,t.replace(/\+(?=\S)/g,"").replace(/Ctrl|ctrl/g,"â").replace(/Alt|alt/g,"â¥").replace(/Shift|shift/g,"â§"))):Common.Utils.String.format(e,t)},parseFloat:function(t){return"string"==typeof t&&(t=t.replace(",",".")),parseFloat(t)},encodeSurrogateChar:function(t){if(t<65536)return String.fromCharCode(t);t-=65536;var e=55296|t>>10,i=56320|1023&t;return String.fromCharCode(e)+String.fromCharCode(i)},fixedDigits:function(t,e,i){void 0===i&&(i="0");for(var n="",o=t.toString(),s=o.length;s<e;s++)n+=i;return n+o}}},Common.Utils.isBrowserSupported=function(){return!(0!=Common.Utils.ieVersion&&Common.Utils.ieVersion<10||0!=Common.Utils.safariVersion&&Common.Utils.safariVersion<5||0!=Common.Utils.firefoxVersion&&Common.Utils.firefoxVersion<4||0!=Common.Utils.chromeVersion&&Common.Utils.chromeVersion<7||0!=Common.Utils.operaVersion&&Common.Utils.operaVersion<10.5)},Common.Utils.showBrowserRestriction=function(){if(!(document.getElementsByClassName&&document.getElementsByClassName("app-error-panel").length>0)){var t=window.DE?"Document":window.SSE?"Spreadsheet":window.PE?"Presentation":"that",e=document.createElement("div");e.innerHTML='<div class="app-error-panel"><div class="message-block"><div class="message-inner"><div class="title">Your browser is not supported.</div><div class="text">Sorry, '+t+' Editor is currently only supported in the latest versions of the Chrome, Firefox, Safari or Internet Explorer web browsers.</div></div></div><div class="message-auxiliary"></div></div>',document.body.appendChild(e),$("#loading-mask").hide().remove(),$("#viewport").hide().remove()}},Common.Utils.applyCustomization=function(t,e){for(var i in t){var n;if(e[i]&&(n=$(e[i]),n.length)){var o=t[i];!1===o||!1===o.visible?n.hide():(o.text&&n.text(o.text),!1===o.visible&&n.hide())}}},Common.Utils.applyCustomizationPlugins=function(plugins){if(plugins&&!(plugins.length<1)){var _createXMLHTTPObject=function(){var t;if("undefined"!=typeof XMLHttpRequest)t=new XMLHttpRequest;else try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=!1}}return t},_getPluginCode=function(url){if(!url)return"";try{var xhrObj=_createXMLHTTPObject();xhrObj&&url&&(xhrObj.open("GET",url,!1),xhrObj.send(""),200==xhrObj.status&&eval(xhrObj.responseText))}catch(t){}return null};plugins.forEach(function(t){t&&_getPluginCode(t)})}},Common.Utils.fillUserInfo=function(t,e,i,n){var o=t||{};return o.anonymous=!o.id,!o.id&&(o.id=n),o.fullname=o.name?o.name:i,o.group&&(o.fullname=o.group.toString()+AscCommon.UserInfoParser.getSeparator()+o.fullname),o.guest=!o.name,o},Common.Utils.createXhr=function(){var t;if("undefined"!=typeof XMLHttpRequest)t=new XMLHttpRequest;else try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=!1}}return t},Common.Utils.getConfigJson=function(t){if(t)try{var e=Common.Utils.createXhr();if(e)return e.open("GET",t,!1),e.send(""),JSON.parse(e.responseText)}catch(t){}return null},Common.Utils.loadConfig=function(t,e){fetch(t,{method:"get",headers:{Accept:"application/json"}}).then(function(t){return t.ok?t.json():"error"}).then(function(t){e(t)}).catch(function(t){e("error")})},Common.Utils.asyncCall=function(t,e,i){new Promise(function(t,e){t()}).then(function(){t.call(e,i)})},String.prototype.strongMatch=function(t){if(t&&t instanceof RegExp){var e=this.toString().match(t);return!!(e&&e.length>0&&e[0].length==this.length)}return!1},Common.Utils.InternalSettings=new function(){var t={};return{get:function(e){return t[e]},set:function(e,i){t[e]=i}}},Common.Utils.lockControls=function(t,e,i,n){function o(t,i){if(t&&_.contains(t.options.lock,i)){var n=t.keepState.indexOf(i);e?n<0&&t.keepState.push(i):n<0||t.keepState.splice(n,1)}}!i&&(i={});var s=i.array||n;i.merge&&(s=_.union(n,s)),_.each(s,function(e){e&&_.isFunction(e.setDisabled)&&(!e.keepState&&(e.keepState=[]),i.clear&&i.clear.length>0&&e.keepState.length>0&&(e.keepState=_.difference(e.keepState,i.clear)),_.isArray(t)?_.each(t,function(t){o(e,t)}):o(e,t),e.keepState.length>0?!e.isDisabled()&&e.setDisabled(!0):e.isDisabled()&&e.setDisabled(!1))})},Common.Utils.injectButtons=function(t,e,i,n,o,s,a,r){var l=createButtonSet();return l.setDisabled(!0),e=e||"id-toolbar-"+i,t.each(function(c,d){var h="btn-toolbar";/x-huge/.test(d.className)&&(h+=" x-huge icon-top");var p=new Common.UI.Button({parentEl:t.eq(c),id:e+c,cls:h,iconCls:i,caption:n,split:s||!1,menu:a||!1,enableToggle:r||!1,lock:o,disabled:!0});l.add(p)}),l},Common.Utils.injectComponent=function(t,e){e&&t.length&&(e.rendered?t.append(e.$el):e.render(t))},Common.Utils.warningDocumentIsLocked=function(t){t.disablefunc&&t.disablefunc(!0);var e=window.DE||window.PE||window.SSE;Common.UI.warning({msg:Common.Locale.get("warnFileLocked",{name:"Common.Translation",default:"You can't edit this file. Document is in use by another application."}),buttons:[{value:"view",caption:Common.Locale.get("warnFileLockedBtnView",{name:"Common.Translation",default:"Open for viewing"})},{value:"edit",caption:Common.Locale.get("warnFileLockedBtnEdit",{name:"Common.Translation",default:"Create a copy"})}],primary:"view",callback:function(i){"edit"==i&&(t.disablefunc&&t.disablefunc(!1),e.getController("Main").api.asc_setIsReadOnly(!1))}})},jQuery.fn.extend({elementById:function(t,e){var i=document.getElementById(t.substring(1));if(!i)if((e=e||this)instanceof jQuery)e.each(function(e,n){if(i=n.querySelectorAll(t),0==i.length){if("#"+n.id==t)return i=n,!1}else if(i.length)return i=i[0],!1});else if((i=e.querySelectorAll(t))&&i.length)return i[0];return i},findById:function(t,e){var i=$.fn.elementById.apply(this,arguments);return i?$(i):$()}}),Common.Utils.InternalSettings.set("toolbar-height-tabs",32),Common.Utils.InternalSettings.set("toolbar-height-tabs-top-title",28),Common.Utils.InternalSettings.set("toolbar-height-controls",67),Common.Utils.InternalSettings.set("document-title-height",28),Common.Utils.InternalSettings.set("window-inactive-area-top",0),Common.Utils.InternalSettings.set("toolbar-height-compact",Common.Utils.InternalSettings.get("toolbar-height-tabs")),Common.Utils.InternalSettings.set("toolbar-height-normal",Common.Utils.InternalSettings.get("toolbar-height-tabs")+Common.Utils.InternalSettings.get("toolbar-height-controls")),Common.Utils.ModalWindow=new function(){var t=0;return{show:function(){t++},close:function(){t--},isVisible:function(){return t>0}}},Common.Utils.UserInfoParser=new function(){var t=!1,e=String.fromCharCode(160);return{setParser:function(e){t=!!e},getSeparator:function(){return e},getParsedName:function(i){return t&&i?i.substring(i.indexOf(e)+1):i},getParsedGroups:function(i){if(t&&i){for(var n=i.indexOf(e),o=n>-1?i.substring(0,n).split(","):[],s=0;s<o.length;s++)o[s]=o[s].trim();return o}}}},define("common/main/lib/util/utils",function(){}),void 0===Common)var Common={};if(define("common/main/lib/component/ComboBox",["common/main/lib/component/BaseView","common/main/lib/component/Scroller"],function(){"use strict";Common.UI.ComboBoxModel=Backbone.Model.extend({defaults:function(){return{id:Common.UI.getId(),value:null,displayValue:null}}}),Common.UI.ComboBoxStore=Backbone.Collection.extend({model:Common.UI.ComboBoxModel}),Common.UI.ComboBox=Common.UI.BaseView.extend(function(){return{options:{id:null,cls:"",style:"",hint:!1,editable:!0,disabled:!1,menuCls:"",menuStyle:"",displayField:"displayValue",valueField:"value",search:!1,scrollAlwaysVisible:!1,takeFocusOnClose:!1},template:_.template(['<span class="input-group combobox <%= cls %>" id="<%= id %>" style="<%= style %>">','<input type="text" class="form-control" spellcheck="false">','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>',"<% }); %>","</ul>","</span>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=e.options.id||Common.UI.getId(),this.cls=e.options.cls,this.style=e.options.style,this.menuCls=e.options.menuCls,this.menuStyle=e.options.menuStyle,this.template=e.options.template||e.template,this.itemsTemplate=e.options.itemsTemplate,this.hint=e.options.hint,this.editable=e.options.editable,this.disabled=e.options.disabled,this.store=e.options.store||new Common.UI.ComboBoxStore,this.displayField=e.options.displayField,this.valueField=e.options.valueField,this.search=e.options.search,this.scrollAlwaysVisible=e.options.scrollAlwaysVisible,e.rendered=e.options.rendered||!1,this.lastValue=null,e.store.add(e.options.data),e.options.el&&e.render()},render:function(t){var e=this;if(e.rendered)this.cmpEl=e.$el||$(this.el);else{var i=this.store.toJSON();this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,menuCls:this.menuCls,menuStyle:this.menuStyle,items:i,scope:e})),this.itemsTemplate&&this.cmpEl.find("ul").html($(this.itemsTemplate({items:i,scope:e}))),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl)}if(!e.rendered){var n=this.cmpEl;if(this._input=n.find("input"),this._button=n.find(".btn"),n.on("click","a",_.bind(this.itemClicked,this)),n.on("mousedown","a",_.bind(this.itemMouseDown,this)),this.editable?(n.on("change","input",_.bind(this.onInputChanged,this)),n.on("keydown","input",_.bind(this.onInputKeyDown,this)),n.on("focusin","input",_.bind(this.onInputFocusIn,this)),n.on("click",".form-control",_.bind(this.onEditableInputClick,this))):(n.on("click",".form-control",_.bind(this.onInputClick,this)),this._input.attr("readonly","readonly"),this._input.attr("data-can-copy",!1)),e.options.hint){n.attr("data-toggle","tooltip"),n.tooltip({title:e.options.hint,placement:e.options.hintAnchor||"cursor"});var o=n.closest(".asc-window");if(o.length>0){n.data("bs.tooltip").tip().css("z-index",parseInt(o.css("z-index"))+10);var s=function(t){if(o[0]===t.$window[0]){var e=n.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.hide()),Common.NotificationCenter.off({"modal:close":s})}};Common.NotificationCenter.on({"modal:close":s})}n.find(".dropdown-menu").on("mouseenter",function(){var t=n.data("bs.tooltip");t&&(void 0===t.dontShow&&(t.dontShow=!0),t.hide())})}var a=n.find(".dropdown-menu");a.hasClass("menu-absolute")&&a.css("min-width",n.outerWidth()),n.on("show.bs.dropdown",_.bind(e.onBeforeShowMenu,e)),n.on("shown.bs.dropdown",_.bind(e.onAfterShowMenu,e)),n.on("hide.bs.dropdown",_.bind(e.onBeforeHideMenu,e)),n.on("hidden.bs.dropdown",_.bind(e.onAfterHideMenu,e)),n.on("keydown.after.bs.dropdown",_.bind(e.onAfterKeydownMenu,e)),Common.NotificationCenter.on("menumanager:hideall",_.bind(e.closeMenu,e)),this.setDefaultSelection(),this.listenTo(this.store,"reset",this.onResetItems)}return e.rendered=!0,e.disabled&&e.setDisabled(e.disabled),this},setData:function(t){this.store.reset([]),this.store.add(t),this.setRawValue(""),this.onResetItems()},openMenu:function(t){var e=this;this.scroller||(this.scroller=new Common.UI.Scroller(_.extend({el:$(".dropdown-menu",this.cmpEl),minScrollbarLength:40,includePadding:!0,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible},this.options.scroller))),_.delay(function(){e.cmpEl.addClass("open")},t||0)},closeMenu:function(){this.cmpEl.removeClass("open")},isMenuOpen:function(){return this.cmpEl.hasClass("open")},onBeforeShowMenu:function(t){if(this.scroller||(this.scroller=new Common.UI.Scroller(_.extend({el:$(".dropdown-menu",this.cmpEl),minScrollbarLength:40,includePadding:!0,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible},this.options.scroller))),Common.NotificationCenter.trigger("menu:show"),this.trigger("show:before",this,t),this.options.hint){var e=this.cmpEl.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.hide())}var i=this.cmpEl.find("ul");if(i.hasClass("menu-absolute")){var n=this.cmpEl.offset();i.css({left:n.left,top:n.top+this.cmpEl.outerHeight()+2})}else if(i.hasClass("menu-aligned")){var n=this.cmpEl.offset();i.toggleClass("show-top",n.top+this.cmpEl.outerHeight()+i.outerHeight()>Common.Utils.innerHeight())}},onAfterShowMenu:function(t){var e=$(this.el).find("ul"),i=e.find("> li.selected");if(i.length){var n=i.position().top,o=i.outerHeight(),s=e.outerHeight();if(n<0||n+o>s){var a=e.scrollTop()+n+(o-s)/2;a=Math.floor(a/o)*o,e.scrollTop(a)}setTimeout(function(){i.find("a").focus()},1)}else{var r=this;setTimeout(function(){r.cmpEl.find("ul li:first a").focus()},1)}this.scroller&&this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible}),this.trigger("show:after",this,t),this._search={}},onBeforeHideMenu:function(t){this.trigger("hide:before",this,t),Common.UI.Scroller.isMouseCapture()&&t.preventDefault()},onAfterHideMenu:function(t,e){if(this.cmpEl.find(".dropdown-toggle").blur(),this.trigger("hide:after",this,t,e),Common.NotificationCenter.trigger("menu:hide",this,e),this.options.takeFocusOnClose){var i=this;setTimeout(function(){i.focus()},1)}},onAfterKeydownMenu:function(t){if(t.keyCode==Common.UI.Keys.DOWN&&!this.editable&&!this.isMenuOpen())return this.openMenu(),this.onAfterShowMenu(),!1;if(t.keyCode==Common.UI.Keys.RETURN&&(this.editable||this.isMenuOpen())){var e=this.isMenuOpen();return $(t.target).click(),this.rendered&&(Common.Utils.isIE?this._input.trigger("change",{onkeydown:!0}):this._input.blur()),!e}if(t.keyCode==Common.UI.Keys.ESC&&this.isMenuOpen())return this._input.val(this.lastValue),this.closeMenu(),this.onAfterHideMenu(t),!1;if(this.search&&t.keyCode>64&&t.keyCode<91&&t.key){if("object"!=typeof this._search)return;var i=this;if(clearTimeout(this._search.timer),this._search.timer=setTimeout(function(){i._search={}},1e3),!this._search.text&&(this._search.text=""),!this._search.char&&(this._search.char=t.key),this._search.char!==t.key&&(this._search.full=!0),this._search.text+=t.key,void 0===this._search.index){var n=this.cmpEl.find("ul > li").find("> a");this._search.index=n.index(n.filter(":focus"))}this.selectCandidate()}},selectCandidate:function(){for(var t,e,i=this._search.index||0,n=new RegExp("^"+(this._search.full?this._search.text:this._search.char),"i"),o=0;o<this.store.length;o++){var s=this.store.at(o);if(n.test(s.get(this.displayField))&&(t||(t=s,e=o),this._search.full&&o==i||o>i)){t=s,e=o;break}}if(t){this._search.index=e;var s=$("#"+t.get("id")+" a",$(this.el));if(this.scroller){this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible});var a=$(this.el).find("ul"),r=s.position().top,l=s.outerHeight(),c=a.outerHeight();if(r<0||r+l>c){var d=a.scrollTop()+r;d=Math.floor(d/l)*l,a.scrollTop(d)}}s.focus()}},onInputKeyDown:function(t){var e=this;t.keyCode==Common.UI.Keys.ESC?(this._input.val(this.lastValue),this.closeMenu(),this.onAfterHideMenu(t)):t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN?(this.isMenuOpen()||this.openMenu(),_.delay(function(){e._skipInputChange=!0,e.cmpEl.find("ul li:first a").focus()},10)):t.keyCode==Common.UI.Keys.RETURN&&$(t.target).val()===e.lastValue?this._input.trigger("change",{reapply:!0}):e._skipInputChange=!1},onInputFocusIn:function(t){this.trigger("combo:focusin",this,t)},onInputChanged:function(t,e){if(!e||!e.synthetic){if(this._skipInputChange)return void(this._skipInputChange=!1);var i=$(t.target).val(),n={};if(!(this.lastValue!==i||e&&e.reapply))return void(e&&e.onkeydown&&this.trigger("combo:blur",this,t));if(n[this.valueField]=i,this.trigger("changed:before",this,n,t),!t.isDefaultPrevented()){var o;this._selectedItem=this.store.findWhere((o={},o[this.displayField]=i,o)),this._selectedItem&&(n=this._selectedItem.toJSON(),$(".selected",$(this.el)).removeClass("selected"),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected")),this.trigger("changed:after",this,n,t)}}},onInputClick:function(t){this._button&&this._button.dropdown("toggle"),t.preventDefault(),t.stopPropagation()},onEditableInputClick:function(t){if(this.options.hint){var e=this.cmpEl.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.hide())}this.isMenuOpen()&&1==t.which&&t.stopPropagation()},setDefaultSelection:function(){if(this.rendered){var t,e=this._input.val();e&&(this._selectedItem=this.store.findWhere((t={},t[this.displayField]=e,t)),this._selectedItem&&($(".selected",$(this.el)).removeClass("selected"),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected")))}},setDisabled:function(t){this.disabled=t,this.rendered&&(t?this._input.attr("disabled",!0):this._input.removeAttr("disabled"),this.cmpEl.toggleClass("disabled",t),this._button.toggleClass("disabled",t))},isDisabled:function(){return this.disabled},setRawValue:function(t){this.rendered&&(this._input.val(t).trigger("change",{synthetic:!0}),this.lastValue=null!==t&&void 0!==t?t.toString():t)},getRawValue:function(){return this.rendered?this._input.val():null},setValue:function(t,e){if(this.rendered){var i;this._selectedItem=this.store.findWhere((i={},i[this.valueField]=t,i)),$(".selected",$(this.el)).removeClass("selected"),this._selectedItem?(this.setRawValue(this._selectedItem.get(this.displayField)),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected")):this.setRawValue(void 0!==e?e:t)}},getValue:function(){return this.rendered?this._selectedItem&&!_.isUndefined(this._selectedItem.get(this.valueField))?this._selectedItem.get(this.valueField):this._input.val():null},getDisplayValue:function(t){return Common.Utils.String.htmlEncode(t[this.displayField])},getSelectedRecord:function(){return this.rendered&&this._selectedItem&&!_.isUndefined(this._selectedItem.get(this.valueField))?_.extend({},this._selectedItem.toJSON()):null},selectRecord:function(t){this.rendered&&t&&(this._selectedItem=t,$(".selected",$(this.el)).removeClass("selected"),this.setRawValue(this._selectedItem.get(this.displayField)),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected"))},itemClicked:function(t){var e=$(t.target).closest("li");this._selectedItem=this.store.findWhere({id:e.attr("id")}),this._selectedItem&&(this.lastValue=this._selectedItem.get(this.displayField),this._input.val(this.lastValue).trigger("change",{synthetic:!0}),$(".selected",$(this.el)).removeClass("selected"),e.addClass("selected"),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),t),t.preventDefault()),this._isMouseDownMenu=!1},itemMouseDown:function(t){if(1!=t.which)return t.preventDefault(),t.stopPropagation(),!1;this._isMouseDownMenu=!0},onResetItems:function(){this.itemsTemplate?$(this.el).find("ul").html($(this.itemsTemplate({items:this.store.toJSON(),scope:this}))):$(this.el).find("ul").html(_.template(["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%- item.value %>"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>',"<% }); %>"].join(""))({items:this.store.toJSON(),scope:this})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.scroller=new Common.UI.Scroller(_.extend({el:$(".dropdown-menu",this.cmpEl),minScrollbarLength:40,includePadding:!0,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible},this.options.scroller))},focus:function(){this._input&&this._input.focus()}}}()),Common.UI.ComboBoxCustom=Common.UI.ComboBox.extend(_.extend({itemClicked:function(t){Common.UI.ComboBox.prototype.itemClicked.call(this,t),this.options.updateFormControl&&this.options.updateFormControl.call(this,this._selectedItem)},setValue:function(t){Common.UI.ComboBox.prototype.setValue.call(this,t),this.options.updateFormControl&&this.options.updateFormControl.call(this,this._selectedItem)},selectRecord:function(t){Common.UI.ComboBox.prototype.selectRecord.call(this,t),this.options.updateFormControl&&this.options.updateFormControl.call(this,this._selectedItem)},focus:function(){this.cmpEl&&this.cmpEl.find(".form-control").focus()}},Common.UI.ComboBoxCustom||{}))}),void 0===Common)var Common={};if(define("common/main/lib/component/DataView",["common/main/lib/component/BaseView","common/main/lib/component/Scroller"],function(){"use strict";Common.UI.DataViewGroupModel=Backbone.Model.extend({defaults:function(){return{id:Common.UI.getId(),caption:"",inline:!1,headername:void 0}}}),Common.UI.DataViewGroupStore=Backbone.Collection.extend({model:Common.UI.DataViewGroupModel}),Common.UI.DataViewModel=Backbone.Model.extend({defaults:function(){return{id:Common.UI.getId(),selected:!1,allowSelected:!0,value:null,disabled:!1}}}),Common.UI.DataViewStore=Backbone.Collection.extend({model:Common.UI.DataViewModel}),Common.UI.DataViewItem=Common.UI.BaseView.extend({options:{},
template:_.template(['<div id="<%= id %>"><%= value %></div>'].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.template=e.options.template||e.template,e.listenTo(e.model,"change",this.model.get("skipRenderOnChange")?e.onChange:e.render),e.listenTo(e.model,"change:selected",e.onSelectChange),e.listenTo(e.model,"remove",e.remove)},render:function(){if(_.isUndefined(this.model.id))return this;var t=this.$el||$(this.el);t.html(this.template(this.model.toJSON())),t.addClass("item"),t.toggleClass("selected",this.model.get("selected")&&this.model.get("allowSelected")),t.off("click dblclick contextmenu"),t.on({click:_.bind(this.onClick,this),dblclick:_.bind(this.onDblClick,this),contextmenu:_.bind(this.onContextMenu,this)}),t.toggleClass("disabled",!!this.model.get("disabled")),_.isUndefined(this.model.get("cls"))||t.addClass(this.model.get("cls"));var e=t.data("bs.tooltip");return e&&void 0===e.dontShow&&t.is(":hover")&&(e.dontShow=!0),this.trigger("change",this,this.model),this},remove:function(){this.stopListening(this.model),this.trigger("remove",this,this.model),Common.UI.BaseView.prototype.remove.call(this)},onClick:function(t){if(this.model.get("disabled"))return!1;this.trigger("click",this,this.model,t)},onDblClick:function(t){if(this.model.get("disabled"))return!1;this.trigger("dblclick",this,this.model,t)},onContextMenu:function(t){this.trigger("contextmenu",this,this.model,t)},onSelectChange:function(t,e){this.trigger("select",this,t,e)},onChange:function(){if(_.isUndefined(this.model.id))return this;var t=this.$el||$(this.el);return t.toggleClass("selected",this.model.get("selected")&&this.model.get("allowSelected")),t.toggleClass("disabled",!!this.model.get("disabled")),this.trigger("change",this,this.model),this}}),Common.UI.DataView=Common.UI.BaseView.extend({options:{multiSelect:!1,handleSelect:!0,enableKeyEvents:!0,keyMoveDirection:"both",restoreHeight:0,emptyText:"",listenStoreEvents:!0,allowScrollbar:!0,scrollAlwaysVisible:!1,showLast:!0,useBSKeydown:!1,cls:""},template:_.template(['<div class="dataview inner <%= cls %>" style="<%= style %>">',"<% _.each(groups, function(group) { %>","<% if (group.headername !== undefined) { %>",'<div class="header-name"><%= group.headername %></div>',"<% } %>",'<div class="grouped-data <% if (group.inline) { %> inline <% } %> <% if (!_.isEmpty(group.caption)) { %> margin <% } %>" id="<%= group.id %>">',"<% if (!_.isEmpty(group.caption)) { %>",'<div class="group-description">',"<span><%= group.caption %></span>","</div>","<% } %>",'<div class="group-items-container">',"</div>","</div>","<% }); %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.template=e.options.template||e.template,e.store=e.options.store||new Common.UI.DataViewStore,e.groups=e.options.groups||null,e.itemTemplate=e.options.itemTemplate||null,e.multiSelect=e.options.multiSelect,e.handleSelect=e.options.handleSelect,e.parentMenu=e.options.parentMenu,e.enableKeyEvents=e.options.enableKeyEvents,e.useBSKeydown=e.options.useBSKeydown,e.showLast=e.options.showLast,e.style=e.options.style||"",e.cls=e.options.cls||"",e.emptyText=e.options.emptyText||"",e.listenStoreEvents=void 0===e.options.listenStoreEvents||e.options.listenStoreEvents,e.allowScrollbar=void 0===e.options.allowScrollbar||e.options.allowScrollbar,e.scrollAlwaysVisible=e.options.scrollAlwaysVisible||!1,e.tabindex=e.options.tabindex||0,e.parentMenu&&(e.parentMenu.options.restoreHeight=e.options.restoreHeight>0),e.rendered=!1,e.dataViewItems=[],"vertical"==e.options.keyMoveDirection?e.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN]:"horizontal"==e.options.keyMoveDirection?e.moveKeys=[Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT]:e.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN,Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT],e.options.el&&e.render()},render:function(t){var e=this;this.trigger("render:before",this),t?(this.setElement(t,!1),this.cmpEl=$(this.template({groups:e.groups?e.groups.toJSON():null,style:e.style,cls:e.cls})),t.html(this.cmpEl)):(this.cmpEl=e.$el||$(this.el),this.cmpEl.html(this.template({groups:e.groups?e.groups.toJSON():null,style:e.style,cls:e.cls})));var i=this.cmpEl.closest(".asc-window");return i.length<1&&(i=this.cmpEl.closest('[id^="menu-container-"]')),i.length>0&&(this.tipZIndex=parseInt(i.css("z-index"))+10),this.rendered||(this.listenStoreEvents&&(this.listenTo(this.store,"add",this.onAddItem),this.listenTo(this.store,"reset",this.onResetItems)),this.onResetItems(),this.parentMenu&&(this.cmpEl.closest("li").css("height","100%"),this.cmpEl.css("height","100%"),this.parentMenu.on("show:after",_.bind(this.alignPosition,this))),this.enableKeyEvents&&this.parentMenu&&this.handleSelect&&(e.showLast||this.parentMenu.on("show:before",function(t){e.deselectAll()}),this.parentMenu.on("show:after",function(t,i){i&&t.el!==i.target||(e.showLast&&e.showLastSelected(),Common.NotificationCenter.trigger("dataview:focus"),_.delay(function(){t.cmpEl.find(".dataview").focus()},10))}).on("hide:after",function(){Common.NotificationCenter.trigger("dataview:blur")}))),_.isUndefined(this.scroller)&&this.allowScrollbar&&(this.scroller=new Common.UI.Scroller({el:$(this.el).find(".inner").addBack().filter(".inner"),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:40,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible})),this.rendered=!0,this.cmpEl.on("click",function(t){if(/dataview/.test(t.target.className))return!1}),this.trigger("render:after",this),this},setStore:function(t){t&&(this.stopListening(this.store),this.store=t,this.listenStoreEvents&&(this.listenTo(this.store,"add",this.onAddItem),this.listenTo(this.store,"reset",this.onResetItems)))},selectRecord:function(t,e){if(this.handleSelect)return e&&this.suspendEvents(),this.multiSelect?t&&t.set({selected:!t.get("selected")}):(_.each(this.store.where({selected:!0}),function(t){t.set({selected:!1})}),t&&t.set({selected:!0})),e&&this.resumeEvents(),t},selectByIndex:function(t,e){if(this.store.length>0&&t>-1&&t<this.store.length)return this.selectRecord(this.store.at(t),e)},deselectAll:function(t){t&&this.suspendEvents(),_.each(this.store.where({selected:!0}),function(t){t.set({selected:!1})}),t&&this.resumeEvents()},getSelectedRec:function(){return this.multiSelect?this.store.where({selected:!0}):this.store.findWhere({selected:!0})},onAddItem:function(t,e,i){var n=new Common.UI.DataViewItem({template:this.itemTemplate,model:t});if(n){var o=$(this.el).find(".inner").addBack().filter(".inner");if(this.groups&&this.groups.length>0){var s=this.groups.findWhere({id:t.get("group")});s&&(o=o.find("#"+s.id+" .group-items-container"))}if(o){i&&0==i.at?o.prepend(n.render().el):o.append(n.render().el),this.dataViewItems.length<1&&o.find(".empty-text").remove();var a=_.indexOf(this.store.models,t);if(this.dataViewItems=this.dataViewItems.slice(0,a).concat(n).concat(this.dataViewItems.slice(a)),t.get("tip")){var r=$(n.el);r.attr("data-toggle","tooltip"),r.tooltip({title:t.get("tip"),placement:"cursor",zIndex:this.tipZIndex})}this.listenTo(n,"change",this.onChangeItem),this.listenTo(n,"remove",this.onRemoveItem),this.listenTo(n,"click",this.onClickItem),this.listenTo(n,"dblclick",this.onDblClickItem),this.listenTo(n,"select",this.onSelectItem),this.listenTo(n,"contextmenu",this.onContextMenuItem),this.isSuspendEvents||this.trigger("item:add",this,n,t)}}},onResetItems:function(){_.each(this.dataViewItems,function(t){var e=t.$el.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.tip().remove())},this),$(this.el).html(this.template({groups:this.groups?this.groups.toJSON():null,style:this.style,cls:this.cls})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.store.length<1&&this.emptyText.length>0&&$(this.el).find(".inner").addBack().filter(".inner").append('<table cellpadding="10" class="empty-text"><tr><td>'+this.emptyText+"</td></tr></table>"),_.each(this.dataViewItems,function(t){this.stopListening(t),t.stopListening(t.model)},this),this.dataViewItems=[];var t=this;this.store.each(function(e){t.onAddItem(e,t.store)},this),this.allowScrollbar&&(this.scroller=new Common.UI.Scroller({el:$(this.el).find(".inner").addBack().filter(".inner"),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:40,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible})),this.disabled&&this.setDisabled(this.disabled),this.attachKeyEvents(),this.lastSelectedRec=null,this._layoutParams=void 0},onChangeItem:function(t,e){this.isSuspendEvents||this.trigger("item:change",this,t,e)},onRemoveItem:function(t,e){var i=t.$el.data("bs.tooltip");if(i&&(void 0===i.dontShow&&(i.dontShow=!0),i.tip().remove()),this.stopListening(t),t.stopListening(),this.store.length<1&&this.emptyText.length>0){var n=$(this.el).find(".inner").addBack().filter(".inner");n.find(".empty-text").length<=0&&n.append('<table cellpadding="10" class="empty-text"><tr><td>'+this.emptyText+"</td></tr></table>")}for(var o=0;o<this.dataViewItems.length;o++)if(_.isEqual(t,this.dataViewItems[o])){this.dataViewItems.splice(o,1);break}this.isSuspendEvents||this.trigger("item:remove",this,t,e)},onClickItem:function(t,e,i){if(!this.disabled){window._event=i,this.showLast&&this.selectRecord(e),this.lastSelectedRec=null;var n=t.$el.data("bs.tooltip");n&&n.tip().remove(),this.isSuspendEvents||this.trigger("item:click",this,t,e,i)}},onDblClickItem:function(t,e,i){this.disabled||(window._event=i,this.showLast&&this.selectRecord(e),this.lastSelectedRec=null,this.isSuspendEvents||this.trigger("item:dblclick",this,t,e,i))},onSelectItem:function(t,e,i){this.isSuspendEvents||this.trigger(i?"item:select":"item:deselect",this,t,e,this._fromKeyDown)},onContextMenuItem:function(t,e,i){this.isSuspendEvents||this.trigger("item:contextmenu",this,t,e,i)},scrollToRecord:function(t,e){if(t){var i=$(this.el).find(".inner"),n=i.offset().top,o=_.indexOf(this.store.models,t),s=o>=0&&this.dataViewItems.length>o?$(this.dataViewItems[o].el):i.find("#"+t.get("id"));if(!(s.length<=0)){var a=s.offset().top,r=$(this.dataViewItems[0].el),l=r.length>0?r[0].clientTop:0;(e||a<n+l||a+.9*s.outerHeight()>n+l+i.height())&&(this.scroller&&this.allowScrollbar?this.scroller.scrollTop(i.scrollTop()+a-n-l,0):i.scrollTop(i.scrollTop()+a-n-l))}}},onKeyDown:function(t,e){if(!this.disabled)if(void 0===e&&(e=t),_.indexOf(this.moveKeys,e.keyCode)>-1||e.keyCode==Common.UI.Keys.RETURN){e.preventDefault(),e.stopPropagation();var i=this.getSelectedRec();if(null===this.lastSelectedRec&&(this.lastSelectedRec=i),e.keyCode==Common.UI.Keys.RETURN)this.lastSelectedRec=null,this.selectedBeforeHideRec&&(i=this.selectedBeforeHideRec),this.trigger("item:click",this,this,i,t),this.trigger("item:select",this,this,i,t),this.trigger("entervalue",this,i,t),this.parentMenu&&this.parentMenu.hide();else{var n=_.indexOf(this.store.models,i);if(n<0)if(e.keyCode==Common.UI.Keys.LEFT){var o=$(t.target).closest(".dropdown-submenu.over");o.length>0?(o.removeClass("over"),o.find("> a").focus()):n=0}else n=0;else if("both"==this.options.keyMoveDirection){void 0===this._layoutParams&&this.fillIndexesArray();var s=this.dataViewItems[n].topIdx,a=this.dataViewItems[n].leftIdx;if(n=void 0,e.keyCode==Common.UI.Keys.LEFT)for(;void 0===n;){if(--a<0){var o=$(t.target).closest(".dropdown-submenu.over");if(o.length>0){o.removeClass("over"),o.find("> a").focus();break}a=this._layoutParams.columns-1}n=this._layoutParams.itemsIndexes[s][a]}else if(e.keyCode==Common.UI.Keys.RIGHT)for(;void 0===n;)a++,a>this._layoutParams.columns-1&&(a=0),n=this._layoutParams.itemsIndexes[s][a];else if(e.keyCode==Common.UI.Keys.UP)for(;void 0===n;)s--,s<0&&(s=this._layoutParams.rows-1),n=this._layoutParams.itemsIndexes[s][a];else for(;void 0===n;)s++,s>this._layoutParams.rows-1&&(s=0),n=this._layoutParams.itemsIndexes[s][a]}else n=e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.LEFT?Math.max(0,n-1):Math.min(this.store.length-1,n+1);void 0!==n&&n>=0&&(i=this.store.at(n)),i&&(this._fromKeyDown=!0,this.selectRecord(i),this.scrollToRecord(i),this._fromKeyDown=!1)}}else this.trigger("item:keydown",this,i,t)},attachKeyEvents:function(){if(this.enableKeyEvents&&this.handleSelect){var t=$(this.el).find(".inner").addBack().filter(".inner");t.addClass("canfocused"),t.attr("tabindex",this.tabindex.toString()),t.on(this.parentMenu&&this.useBSKeydown?"dataview:keydown":"keydown",_.bind(this.onKeyDown,this))}},showLastSelected:function(){this.lastSelectedRec?(this.selectRecord(this.lastSelectedRec,!0),this.scrollToRecord(this.lastSelectedRec),this.lastSelectedRec=null):this.scrollToRecord(this.getSelectedRec())},setDisabled:function(t){this.disabled=t,$(this.el).find(".inner").addBack().filter(".inner").toggleClass("disabled",t)},isDisabled:function(){return this.disabled},setEmptyText:function(t){this.emptyText=t},alignPosition:function(){var t="menu"===this.parentMenu.cmpEl.attr("role")?this.parentMenu.cmpEl:this.parentMenu.cmpEl.find("[role=menu]"),e=Common.Utils.innerHeight()-10,i=$(this.el).find(".inner").addBack().filter(".inner"),n=i.parent(),o=parseInt(n.css("margin-top"))+parseInt(n.css("margin-bottom"))+parseInt(t.css("margin-top")),s=parseInt(t.css("padding-top"))+parseInt(t.css("padding-bottom")),a=t.outerHeight(),r=parseInt(t.css("top")),l={minScrollbarLength:40};this.scrollAlwaysVisible&&(l.alwaysVisibleY=this.scrollAlwaysVisible),r+a>e?(i.css("max-height",e-r-s-o+"px"),this.allowScrollbar&&this.scroller.update(l)):r+a<e&&i.height()<this.options.restoreHeight&&(i.css("max-height",Math.min(e-r-s-o,this.options.restoreHeight)+"px"),this.allowScrollbar&&this.scroller.update(l))},fillIndexesArray:function(){if(!(this.dataViewItems.length<=0)){this._layoutParams={itemsIndexes:[],columns:0,rows:0};for(var t=$(this.dataViewItems[0].el),e=t.outerWidth()+parseInt(t.css("margin-left"))+parseInt(t.css("margin-right")),i=this.$el.offset().left,n=t.offset().top,o=-1,s=0,a=0,r=0;r<this.dataViewItems.length;r++){var l=$(this.dataViewItems[r].el).offset().top-n;a=Math.floor(($(this.dataViewItems[r].el).offset().left-i)/e),l>o&&(o=l,this._layoutParams.itemsIndexes.push([]),s=this._layoutParams.itemsIndexes.length-1),this._layoutParams.itemsIndexes[s][a]=r,this.dataViewItems[r].topIdx=s,this.dataViewItems[r].leftIdx=a,this._layoutParams.columns<a&&(this._layoutParams.columns=a)}this._layoutParams.rows=this._layoutParams.itemsIndexes.length,this._layoutParams.columns++}},onResize:function(){this._layoutParams=void 0},focus:function(){this.cmpEl&&this.cmpEl.find(".dataview").focus()}}),Common.UI.DataViewSimple=Common.UI.BaseView.extend({options:{handleSelect:!0,enableKeyEvents:!0,keyMoveDirection:"both",restoreHeight:0,scrollAlwaysVisible:!1,useBSKeydown:!1},template:_.template(['<div class="dataview inner" style="<%= style %>">',"<% _.each(items, function(item) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>",'<div class="item" <% if(!!item.tip) { %> data-toggle="tooltip" <% } %> ><%= itemTemplate(item) %></div>',"<% }) %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.template=e.options.template||e.template,e.store=e.options.store||new Common.UI.DataViewStore,e.itemTemplate=e.options.itemTemplate||null,e.handleSelect=e.options.handleSelect,e.parentMenu=e.options.parentMenu,e.enableKeyEvents=e.options.enableKeyEvents,e.useBSKeydown=e.options.useBSKeydown,e.style=e.options.style||"",e.scrollAlwaysVisible=e.options.scrollAlwaysVisible||!1,e.tabindex=e.options.tabindex||0,e.parentMenu&&(e.parentMenu.options.restoreHeight=e.options.restoreHeight>0),e.rendered=!1,"vertical"==e.options.keyMoveDirection?e.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN]:"horizontal"==e.options.keyMoveDirection?e.moveKeys=[Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT]:e.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN,Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT],e.options.el&&e.render()},render:function(t){var e=this;this.trigger("render:before",this),t?(this.setElement(t,!1),this.cmpEl=$(this.template({items:e.store.toJSON(),itemTemplate:e.itemTemplate,style:e.style})),t.html(this.cmpEl)):(this.cmpEl=e.$el||$(this.el),this.cmpEl.html(this.template({items:e.store.toJSON(),itemTemplate:e.itemTemplate,style:e.style})));var i=this.cmpEl.closest(".asc-window");return i.length<1&&(i=this.cmpEl.closest('[id^="menu-container-"]')),i.length>0&&(this.tipZIndex=parseInt(i.css("z-index"))+10),this.rendered||(this.parentMenu?(this.cmpEl.closest("li").css("height","100%"),this.cmpEl.css("height","100%"),this.parentMenu.on("show:after",_.bind(this.alignPosition,this)),this.parentMenu.on("show:after",_.bind(this.onAfterShowMenu,this))):this.store.length>0&&this.onAfterShowMenu(),this.enableKeyEvents&&this.parentMenu&&this.handleSelect&&(this.parentMenu.on("show:before",function(t){e.deselectAll()}),this.parentMenu.on("show:after",function(t){Common.NotificationCenter.trigger("dataview:focus"),_.delay(function(){t.cmpEl.find(".dataview").focus()},10)}).on("hide:after",function(){Common.NotificationCenter.trigger("dataview:blur")})),this.attachKeyEvents(),this.cmpEl.on("click","div.item",_.bind(e.onClickItem,e))),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:$(this.el).find(".inner").addBack().filter(".inner"),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:40,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible})),this.rendered=!0,this.cmpEl.on("click",function(t){if(/dataview/.test(t.target.className))return!1}),this.trigger("render:after",this),this},selectRecord:function(t,e){if(this.handleSelect){if(e&&this.suspendEvents(),this.deselectAll(e),t){t.set({selected:!0});var i=_.indexOf(this.store.models,t);i>=0&&this.dataViewItems&&this.dataViewItems.length>i&&this.dataViewItems[i].el.addClass("selected")}return e&&this.resumeEvents(),t}},selectByIndex:function(t,e){if(this.store.length>0&&t>-1&&t<this.store.length)return this.selectRecord(this.store.at(t),e)},deselectAll:function(t){t&&this.suspendEvents(),_.each(this.store.where({selected:!0}),function(t){t.set({selected:!1})}),this.cmpEl.find(".item.selected").removeClass("selected"),t&&this.resumeEvents()},getSelectedRec:function(){return this.store.findWhere({selected:!0})},onResetItems:function(){this.dataViewItems&&_.each(this.dataViewItems,function(t){var e=t.el.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.tip().remove())},this),this.dataViewItems=null;var t=_.template(["<% _.each(items, function(item) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>",'<div class="item" <% if(!!item.tip) { %> data-toggle="tooltip" <% } %> ><%= itemTemplate(item) %></div>',"<% }) %>"].join(""));this.cmpEl&&this.cmpEl.find(".inner").html(t({items:this.store.toJSON(),itemTemplate:this.itemTemplate,style:this.style})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.scroller=new Common.UI.Scroller({el:$(this.el).find(".inner").addBack().filter(".inner"),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:40,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible}),!this.parentMenu&&this.store.length>0&&this.onAfterShowMenu(),this._layoutParams=void 0},setStore:function(t){t&&(this.store=t,this.onResetItems())},onClickItem:function(t){if(!this.disabled){window._event=t;var e=$(t.currentTarget).closest("div.item").index(),i=e>=0?this.store.at(e):null,n=e>=0?this.dataViewItems[e]:null;if(i&&n){i.set({selected:!0});var o=n.el.data("bs.tooltip");o&&o.tip().remove(),this.isSuspendEvents||this.trigger("item:click",this,n.el,i,t)}}},onAfterShowMenu:function(t){if(!this.dataViewItems){var e=this;this.dataViewItems=[],_.each(this.cmpEl.find("div.item"),function(t,i){var n=$(t),o=e.store.at(i);e.dataViewItems.push({el:n}),o.get("tip")&&n.tooltip({title:o.get("tip"),placement:"cursor",zIndex:e.tipZIndex})})}},scrollToRecord:function(t){if(t){var e=$(this.el).find(".inner"),i=e.offset().top,n=_.indexOf(this.store.models,t),o=n>=0&&this.dataViewItems.length>n?this.dataViewItems[n].el:e.find("#"+t.get("id"));if(!(o.length<=0)){var s=o.offset().top,a=this.dataViewItems[0].el,r=a.length>0?a[0].offsetTop:0;(s<i+r||s+o.outerHeight()>i+e.height())&&(this.scroller?this.scroller.scrollTop(e.scrollTop()+s-i-r,0):e.scrollTop(e.scrollTop()+s-i-r))}}},onKeyDown:function(t,e){if(!this.disabled)if(void 0===e&&(e=t),_.indexOf(this.moveKeys,e.keyCode)>-1||e.keyCode==Common.UI.Keys.RETURN){e.preventDefault(),e.stopPropagation();var i=this.getSelectedRec();if(e.keyCode==Common.UI.Keys.RETURN)this.selectedBeforeHideRec&&(i=this.selectedBeforeHideRec),this.trigger("item:click",this,this,i,t),this.parentMenu&&this.parentMenu.hide();else{var n=_.indexOf(this.store.models,i);if(n<0)if(e.keyCode==Common.UI.Keys.LEFT){var o=$(t.target).closest(".dropdown-submenu.over");o.length>0?(o.removeClass("over"),o.find("> a").focus()):n=0}else n=0;else if("both"==this.options.keyMoveDirection){void 0===this._layoutParams&&this.fillIndexesArray();var s=this.dataViewItems[n].topIdx,a=this.dataViewItems[n].leftIdx;if(n=void 0,e.keyCode==Common.UI.Keys.LEFT)for(;void 0===n;){if(--a<0){var o=$(t.target).closest(".dropdown-submenu.over");if(o.length>0){o.removeClass("over"),o.find("> a").focus();break}a=this._layoutParams.columns-1}n=this._layoutParams.itemsIndexes[s][a]}else if(e.keyCode==Common.UI.Keys.RIGHT)for(;void 0===n;)a++,a>this._layoutParams.columns-1&&(a=0),n=this._layoutParams.itemsIndexes[s][a];else if(e.keyCode==Common.UI.Keys.UP)for(;void 0===n;)s--,s<0&&(s=this._layoutParams.rows-1),n=this._layoutParams.itemsIndexes[s][a];else for(;void 0===n;)s++,s>this._layoutParams.rows-1&&(s=0),n=this._layoutParams.itemsIndexes[s][a]}else n=e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.LEFT?Math.max(0,n-1):Math.min(this.store.length-1,n+1);void 0!==n&&n>=0&&(i=this.store.at(n)),i&&(this._fromKeyDown=!0,this.selectRecord(i),this.scrollToRecord(i),this._fromKeyDown=!1)}}else this.trigger("item:keydown",this,i,t)},attachKeyEvents:function(){if(this.enableKeyEvents&&this.handleSelect){var t=$(this.el).find(".inner").addBack().filter(".inner");t.addClass("canfocused"),t.attr("tabindex",this.tabindex.toString()),t.on(this.parentMenu&&this.useBSKeydown?"dataview:keydown":"keydown",_.bind(this.onKeyDown,this))}},setDisabled:function(t){this.disabled=t,$(this.el).find(".inner").addBack().filter(".inner").toggleClass("disabled",t)},isDisabled:function(){return this.disabled},alignPosition:function(){var t="menu"===this.parentMenu.cmpEl.attr("role")?this.parentMenu.cmpEl:this.parentMenu.cmpEl.find("[role=menu]"),e=Common.Utils.innerHeight()-10,i=$(this.el).find(".inner").addBack().filter(".inner"),n=i.parent(),o=parseInt(n.css("margin-top"))+parseInt(n.css("margin-bottom"))+parseInt(t.css("margin-top")),s=parseInt(t.css("padding-top"))+parseInt(t.css("padding-bottom")),a=t.outerHeight(),r=parseInt(t.css("top")),l={minScrollbarLength:40};this.scrollAlwaysVisible&&(l.alwaysVisibleY=this.scrollAlwaysVisible),r+a>e?(i.css("max-height",e-r-s-o+"px"),this.scroller.update(l)):r+a<e&&i.height()<this.options.restoreHeight&&(i.css("max-height",Math.min(e-r-s-o,this.options.restoreHeight)+"px"),this.scroller.update(l))},fillIndexesArray:function(){if(!(this.dataViewItems.length<=0)){this._layoutParams={itemsIndexes:[],columns:0,rows:0};for(var t=this.dataViewItems[0].el,e=t.outerWidth()+parseInt(t.css("margin-left"))+parseInt(t.css("margin-right")),i=this.$el.offset().left,n=t.offset().top,o=-1,s=0,a=0,r=0;r<this.dataViewItems.length;r++){var l=this.dataViewItems[r],c=l.el.offset().top-n;a=Math.floor((l.el.offset().left-i)/e),c>o&&(o=c,this._layoutParams.itemsIndexes.push([]),s=this._layoutParams.itemsIndexes.length-1),this._layoutParams.itemsIndexes[s][a]=r,l.topIdx=s,l.leftIdx=a,this._layoutParams.columns<a&&(this._layoutParams.columns=a)}this._layoutParams.rows=this._layoutParams.itemsIndexes.length,this._layoutParams.columns++}},onResize:function(){this._layoutParams=void 0},focus:function(){this.cmpEl&&this.cmpEl.find(".dataview").focus()}}),$(document).on("keydown.dataview","[data-toggle=dropdown], [role=menu]",function(t){t.keyCode!==Common.UI.Keys.UP&&t.keyCode!==Common.UI.Keys.DOWN&&t.keyCode!==Common.UI.Keys.LEFT&&t.keyCode!==Common.UI.Keys.RIGHT&&t.keyCode!==Common.UI.Keys.RETURN||_.defer(function(){var e=$(t.target).closest(".dropdown-toggle");e.length?e.parent().find(".inner.canfocused").trigger("dataview:keydown",t):$(t.target).closest(".dropdown-submenu").find(".inner.canfocused").trigger("dataview:keydown",t)},100)})}),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/Comments",["text!common/main/lib/template/Comments.template","text!common/main/lib/template/CommentsPanel.template","common/main/lib/util/utils","common/main/lib/component/Button","common/main/lib/component/ComboBox","common/main/lib/component/DataView","common/main/lib/component/Layout","common/main/lib/component/Window"],function(t,e){"use strict";function i(t,e){var i,n,o=t;for(i in e)void 0!==i&&(n=e[i],o=o.replace(new RegExp(i,"g"),n));return o}var n=Common.UI.DataView.extend(function(){return{options:{handleSelect:!1,scrollable:!0,listenStoreEvents:!1,template:_.template('<div class="dataview-ct inner"></div>')},getTextBox:function(){var t=$(this.el).find("textarea");return t&&t.length?t:void 0},setFocusToTextBox:function(){var t=$(this.el).find("textarea");if(t&&t.length){var e=t.val();t.focus(),t.val(""),t.val(e)}},getActiveTextBoxVal:function(){var t=$(this.el).find("textarea");return t&&t.length?t.val().trim():""},autoHeightTextBox:function(){function t(){n.scrollHeight>n.clientHeight?i.css({height:n.scrollHeight+s+"px"}):(a=n.clientHeight)>=o&&(i.css({height:o+"px"}),n.scrollHeight>n.clientHeight&&(r=Math.max(n.scrollHeight+s,o),i.css({height:r+"px"}))),e.autoScrollToEditButtons()}var e=this,i=$(this.el).find("textarea"),n=null,o=55,s=0,a=0,r=0;i&&i.length&&(n=i.get(0))&&(s=.25*parseInt(i.css("lineHeight"),10),t(),i.bind("input propertychange",t)),this.textBox=i},clearTextBoxBind:function(){this.textBox&&(this.textBox.unbind("input propertychange"),this.textBox=void 0)},autoScrollToEditButtons:function(){var t=$("#id-comments-change"),e=null,i=this.el.getBoundingClientRect(),n=0;t.length&&(e=t.get(0).getBoundingClientRect())&&i&&(n=i.bottom-(e.bottom+7))<0&&this.scroller.scrollTop(this.scroller.getScrollTop()-n)}}}());Common.Views.Comments=Common.UI.BaseView.extend(_.extend({el:"#left-panel-comments",template:_.template(e),addCommentHeight:45,newCommentHeight:110,textBoxAutoSizeLocked:void 0,viewmode:!1,_commentsViewOnItemClick:function(t,e,i,n){function o(){d.update()}var s,a,r,l,c,d=this;if(s=$(n.target))if(a=i.get("editText"),r=i.get("showReply"),l=i.get("uid"),c=s.attr("data-value"),s.hasClass("btn-edit"))_.isUndefined(c)?a||(d.fireEvent("comment:closeEditing"),i.set("editText",!0),t.autoHeightTextBox(),o(),t.setFocusToTextBox(),d.hookTextBox()):(d.fireEvent("comment:closeEditing",[l]),d.fireEvent("comment:editReply",[l,c]),d.commentsView.reply=c,t.autoHeightTextBox(),o(),d.hookTextBox(),t.autoScrollToEditButtons(),t.setFocusToTextBox());else if(s.hasClass("btn-delete"))_.isUndefined(c)?(d.fireEvent("comment:remove",[l]),Common.NotificationCenter.trigger("edit:complete",d)):d.fireEvent("comment:removeReply",[l,c]),d.fireEvent("comment:closeEditing"),o();else if(s.hasClass("user-reply"))d.fireEvent("comment:closeEditing"),i.set("showReply",!0),o(),t.autoHeightTextBox(),d.hookTextBox(),t.autoScrollToEditButtons(),t.setFocusToTextBox();else if(s.hasClass("btn-reply",!1))r&&(d.fireEvent("comment:addReply",[l,t.getActiveTextBoxVal()]),d.fireEvent("comment:closeEditing"),o());else if(s.hasClass("btn-close",!1))d.fireEvent("comment:closeEditing",[l]);else if(s.hasClass("btn-inner-edit",!1))_.isUndefined(d.commentsView.reply)?a&&d.fireEvent("comment:change",[l,t.getActiveTextBoxVal()]):(d.fireEvent("comment:changeReply",[l,d.commentsView.reply,t.getActiveTextBoxVal()]),d.commentsView.reply=void 0),d.fireEvent("comment:closeEditing"),o();else if(s.hasClass("btn-inner-close",!1))d.fireEvent("comment:closeEditing"),d.commentsView.reply=void 0,o();else if(s.hasClass("btn-resolve",!1)){var h=s.data("bs.tooltip");h&&(h.dontShow=!0),d.fireEvent("comment:resolve",[l]),o()}else if(!s.hasClass("msg-reply")&&!s.hasClass("btn-resolve")){var p=!1;if(s.hasClass("user-message"))if(window.getSelection){var m=window.getSelection();p=""!==m.toString()}else document.selection&&(p=document.selection);d.fireEvent("comment:show",[l,!1,p])}},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.store=this.options.store},render:function(){var e=this;if(this.rendered||(this.$el.html(this.template({textAddCommentToDoc:e.textAddCommentToDoc,textAddComment:e.textAddComment,textCancel:e.textCancel,textEnterCommentHint:e.textEnterCommentHint,maxCommLength:Asc.c_oAscMaxCellOrCommentLength})),this.buttonAddCommentToDoc=new Common.UI.Button({el:$(".btn.new",this.$el),enableToggle:!1}),this.buttonAdd=new Common.UI.Button({action:"add",el:$(".btn.add",this.$el),enableToggle:!1}),this.buttonCancel=new Common.UI.Button({el:$(".btn.cancel",this.$el),enableToggle:!1}),this.buttonAddCommentToDoc.on("click",_.bind(this.onClickShowBoxDocumentComment,this)),this.buttonAdd.on("click",_.bind(this.onClickAddDocumentComment,this)),this.buttonCancel.on("click",_.bind(this.onClickCancelDocumentComment,this)),this.txtComment=$("#comment-msg-new",this.el),this.txtComment.keydown(function(t){if(!t.ctrlKey&&!t.metaKey||t.altKey||t.keyCode!=Common.UI.Keys.RETURN){if(t.keyCode===Common.UI.Keys.TAB){var i,n,o;o=this.selectionStart,n=this.selectionEnd,i=$(this),i.val(i.val().substring(0,o)+"\t"+i.val().substring(n)),this.selectionStart=this.selectionEnd=o+1,t.stopImmediatePropagation(),t.preventDefault()}}else e.onClickAddDocumentComment(),t.stopImmediatePropagation()})),this.commentsView)this.commentsView.onResetItems();else{this.commentsView=new n({el:$(".messages-ct",e.el),store:e.store,itemTemplate:_.template(i(t,{textAddReply:e.textAddReply,textAdd:e.textAdd,textCancel:e.textCancel,textEdit:e.textEdit,textReply:e.textReply,textClose:e.textClose,maxCommLength:Asc.c_oAscMaxCellOrCommentLength}))});var o=function(t,i,n){i.tipsArray&&i.tipsArray.forEach(function(t){t.remove()});var o=[],s=$(i.el).find(".btn-resolve:not(.comment-resolved)");s.tooltip({title:e.textResolve,placement:"cursor"}),s.each(function(t,e){o.push($(e).data("bs.tooltip").tip())}),s=$(i.el).find(".comment-resolved"),s.tooltip({title:e.textOpenAgain,placement:"cursor"}),s.each(function(t,e){o.push($(e).data("bs.tooltip").tip())}),i.tipsArray=o};this.commentsView.on({"item:add":o,"item:remove":o,"item:change":o,"item:click":this._commentsViewOnItemClick.bind(this)})}return this.rendered||this.setupLayout(),this.update(),this.rendered=!0,this},update:function(){this.updateLayout(),this.updateScrolls()},updateScrolls:function(){this.commentsView&&this.commentsView.scroller&&this.commentsView.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})},showEditContainer:function(t){var e=$(".add-link-ct",this.el),i=$(".new-comment-ct",this.el);$(".messages-ct",this.el),$("#comments-box",this.el);this.layout.freezePanels(!t),t?(e.css({display:"none"}),i.css({display:"table-row"}),this.txtComment.val(""),this.txtComment.focus(),this.textBoxAutoSizeLocked=void 0):(e.css({display:"table-row"}),i.css({display:"none"})),this.updateLayout(),this.updateScrolls()},onClickShowBoxDocumentComment:function(){this.fireEvent("comment:closeEditing"),this.showEditContainer(!0)},onClickAddDocumentComment:function(){this.fireEvent("comment:add",[this,this.txtComment.val().trim(),void 0,!1,!0]),this.txtComment.val("")},onClickCancelDocumentComment:function(){this.showEditContainer(!1)},saveText:function(t){this.commentsView&&this.commentsView.cmpEl.find(".lock-area").length<1&&(this.textVal=void 0,t?this.commentsView.clearTextBoxBind():this.textVal=this.commentsView.getActiveTextBoxVal())},loadText:function(){
if(this.textVal&&this.commentsView){var t=this.commentsView.getTextBox();t&&t.val(this.textVal)}},hookTextBox:function(){var t=this.commentsView.getTextBox();t&&t.keydown(function(t){if(!t.ctrlKey&&!t.metaKey||t.altKey||t.keyCode!=Common.UI.Keys.RETURN){if(t.keyCode===Common.UI.Keys.TAB){var e,i,n;n=this.selectionStart,i=this.selectionEnd,e=$(this),e.val(e.val().substring(0,n)+"\t"+e.val().substring(i)),this.selectionStart=this.selectionEnd=n+1,t.stopImmediatePropagation(),t.preventDefault()}}else{var o=$("#id-comments-change");o&&o.length&&o.click(),t.stopImmediatePropagation()}})},setupLayout:function(){var t=this,e=t.$el,i=$(".new-comment-ct",t.el),n=($(".add-link-ct",t.el),$("#comments-box",t.el)),o=n.find(" > .layout-item");t.layout=new Common.UI.VBoxLayout({box:n,freeze:!0,items:[{el:o[0],rely:!0,resize:{hidden:!1,autohide:!1,fmin:function(){var e=n.height();return"none"!==i.css("display")&&.5*e<t.newCommentHeight?e-t.newCommentHeight:.5*e},fmax:function(){return"none"!==i.css("display")?n.height()-t.newCommentHeight:n.height()-t.addCommentHeight}}},{el:o[1],stretch:!0},{el:o[2],stretch:!0}]}),t.layout.on("layout:resizedrag",function(){t.updateScrolls(),t.textBoxAutoSizeLocked=!0},this),$(window).on("resize",function(){if("none"!==e.css("display")){var i=$("#comments-box",t.el).height(),n=$(".new-comment-ct",t.el),o=$(".add-link-ct",t.el);"none"!==n.css("display")?t.layout.setResizeValue(0,Math.max(-t.newCommentHeight,Math.min(i-(n.height()+4),i-t.newCommentHeight))):t.layout.setResizeValue(0,Math.max(-t.addCommentHeight,Math.min(i-o.height(),i-t.addCommentHeight))),t.updateScrolls()}}),this.autoHeightTextBox()},changeLayout:function(t){var e=this,i=$(".new-comment-ct",this.el),n=$(".add-link-ct",this.el),o=$(".messages-ct",this.el);if(o.toggleClass("stretch",!t.canComments||t.compatibleFeatures),!t.canComments||t.compatibleFeatures)t.compatibleFeatures?(i.remove(),n.remove()):(i.hide(),n.hide()),this.layout.changeLayout([{el:o[0],rely:!1,stretch:!0}]);else{var s=$("#comments-box",this.el),a=s.find(" > .layout-item");n.show(),this.layout.changeLayout([{el:a[0],rely:!0,resize:{hidden:!1,autohide:!1,fmin:function(){var t=s.height();return"none"!==i.css("display")&&.5*t<e.newCommentHeight?t-e.newCommentHeight:.5*t},fmax:function(){return"none"!==i.css("display")?s.height()-e.newCommentHeight:s.height()-e.addCommentHeight}}},{el:a[1],stretch:!0},{el:a[2],stretch:!0}])}},updateLayout:function(){var t=$("#comments-box",this.el);"none"!==$(".new-comment-ct",this.el).css("display")?this.layout.setResizeValue(0,t.height()-this.newCommentHeight):this.layout.setResizeValue(0,t.height()-this.addCommentHeight)},autoHeightTextBox:function(){function t(){var t,o,s;if(t=$("#comment-msg-new",e.el),s=$("#comments-box",e.el).height(),0==t.val().length)return e.layout.setResizeValue(0,Math.max(-e.newCommentHeight,s-e.newCommentHeight)),void(e.textBoxAutoSizeLocked=void 0);_.isUndefined(e.textBoxAutoSizeLocked)&&(t.height(),o=t.get(0).scrollHeight,t.css({height:n+"px"}),t.height(),o=Math.max(t.get(0).scrollHeight+i,48),t.css({height:"100%"}),s=$("#comments-box",e.el).height(),e.layout.setResizeValue(0,Math.max(-e.newCommentHeight,Math.min(s-o-48,s-e.newCommentHeight))))}var e=this,i=0,n=44,o=$("#comment-msg-new",this.el);o.length<1||(i=.25*parseInt(o.css("lineHeight"),10),t(),o.bind("input propertychange",t),this.textBox=o)},getFixedQuote:function(t){return Common.Utils.String.ellipsis(Common.Utils.String.htmlEncode(t),120,!0)},getUserName:function(t){return Common.Utils.String.htmlEncode(AscCommon.UserInfoParser.getParsedName(t))},pickLink:function(t){var e,i,n=[];t.replace(Common.Utils.ipStrongRe,function(t){var i=/[\.,\?\+;:=!\(\)]+$/.exec(t);return i&&(t=t.substring(0,i.index)),e=arguments[arguments.length-2],n.push({start:e,end:t.length+e,str:'<a href="'+t+'" target="_blank" data-can-copy="true">'+t+"</a>"}),""}),(t.length<1e3||t.search(/\S{255,}/)<0)&&t.replace(Common.Utils.hostnameStrongRe,function(t){var o=/[\.,\?\+;:=!\(\)]+$/.exec(t);o&&(t=t.substring(0,o.index));var s=/(((^https?)|(^ftp)):\/\/)/i.test(t)?t:"http://"+t;return e=arguments[arguments.length-2],i=t.length,_.find(n,function(t){return e>=t.start&&e<t.end||e<=t.start&&e+i>t.start})||n.push({start:e,end:i+e,str:'<a href="'+s+'" target="_blank" data-can-copy="true">'+t+"</a>"}),""}),t.replace(Common.Utils.emailStrongRe,function(t){var o=/((^mailto:)\/\/)/i.test(t)?t:"mailto:"+t;return e=arguments[arguments.length-2],i=t.length,_.find(n,function(t){return e>=t.start&&e<t.end||e<=t.start&&e+i>t.start})||n.push({start:e,end:i+e,str:'<a href="'+o+'">'+t+"</a>"}),""}),n=_.sortBy(n,function(t){return t.start});for(var o=n.length>0?Common.Utils.String.htmlEncode(t.substring(0,n[0].start))+n[0].str:Common.Utils.String.htmlEncode(t),s=1;s<n.length;s++)o+=Common.Utils.String.htmlEncode(t.substring(n[s-1].end,n[s].start))+n[s].str;return n.length>0&&(o+=Common.Utils.String.htmlEncode(t.substring(n[s-1].end,t.length))),o},pickEMail:function(t,e){var i=Common.Utils.String.htmlEncode(e).match(/\B[@+][A-Z0-9._%+-]+@[A-Z0-9._]+\.[A-Z]+\b/gi);i=_.map(i,function(t){return t.slice(1,t.length)}),i.length>0&&Common.Gateway.requestSendNotify({emails:i,actionId:t,actionLink:{action:{type:"comment",data:t}},message:e})},textComments:"Comments",textAnonym:"Guest",textAddCommentToDoc:"Add Comment to Document",textAddComment:"Add Comment",textCancel:"Cancel",textAddReply:"Add Reply",textReply:"Reply",textClose:"Close",textResolved:"Resolved",textResolve:"Resolve",textEnterCommentHint:"Enter your comment here",textEdit:"Edit",textAdd:"Add",textOpenAgain:"Open Again",textHintAddComment:"Add Comment"},Common.Views.Comments||{}))}),define("text!common/main/lib/template/Chat.template",[],function(){return'<div id="chat-box" class="layout-ct vbox">\r\n    <div id="chat-users" class="layout-item area">\r\n        <div id="chat-user-ct"></div>\r\n    </div>\r\n    <div id="chat-messages" class="layout-item area">\r\n        <div id="chat-message-ct"></div>\r\n    </div>\r\n    <div id="chat-options" class="layout-item">\r\n        <div id="chat-options-ct">\r\n            <textarea id="chat-msg-text" class="user-select textarea-control" maxlength="<%=maxMsgLength%>"></textarea>\r\n            <button id="chat-msg-btn-add" class="btn normal dlg-btn primary"><%=scope.textSend%></button>\r\n        </div>\r\n    </div>\r\n</div>'}),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/Chat",["text!common/main/lib/template/Chat.template","common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout"],function(t){"use strict";Common.Views.Chat=Common.UI.BaseView.extend(_.extend({el:"#left-panel-chat",template:_.template(t),storeUsers:void 0,storeMessages:void 0,tplUser:['<li id="<%= user.get("iid") %>"<% if (!user.get("online")) { %> class="offline"<% } %>>','<div class="name"><div class="color" style="background-color: <%= user.get("color") %>;" ></div><%= scope.getUserName(user.get("username")) %>',"</div>","</li>"].join(""),templateUserList:_.template("<ul><% for (originalId in users) { %><%= _.template(usertpl)({user: users[originalId][0], scope: scope}) %><% } %></ul>"),tplMsg:["<li>",'<% if (msg.get("type")==1) { %>','<div class="message service" data-can-copy="true"><%= msg.get("message") %></div>',"<% } else { %>",'<div class="user-name" data-can-copy="true">','<div class="color" style="display: inline-block; background-color: <% if (msg.get("usercolor")!==null) { %><%=msg.get("usercolor")%><% } else { %> #cfcfcf <% } %>; " ></div><%= scope.getUserName(msg.get("username")) %>',"</div>",'<label class="message user-select" data-can-copy="true" tabindex="-1" oo_editor_input="true"><%= msg.get("message") %></label>',"<% } %>","</li>"].join(""),templateMsgList:_.template("<ul><% _.each(messages, function(item) { %><%= _.template(msgtpl)({msg: item, scope: scope}) %><% }); %></ul>"),events:{},usersBoxHeight:72,messageBoxHeight:70,addMessageBoxHeight:110,initialize:function(t){_.extend(this,t),Common.UI.BaseView.prototype.initialize.call(this,arguments),this.storeUsers.bind({add:_.bind(this._onResetUsers,this),change:_.bind(this._onResetUsers,this),reset:_.bind(this._onResetUsers,this)}),this.storeMessages.bind({add:_.bind(this._onAddMessage,this),reset:_.bind(this._onResetMessages,this)})},render:function(t){return t=t||this.el,$(t).html(this.template({scope:this,maxMsgLength:Asc.c_oAscMaxCellOrCommentLength})),this.panelBox=$("#chat-box",this.el),this.panelUsers=$("#chat-users",this.el),this.panelMessages=$("#chat-messages",this.el),this.txtMessage=$("#chat-msg-text",this.el),this.panelOptions=$("#chat-options",this.el),this.panelUsers.scroller=new Common.UI.Scroller({el:$("#chat-users"),useKeyboard:!0,minScrollbarLength:25}),this.panelMessages.scroller=new Common.UI.Scroller({el:$("#chat-messages"),includePadding:!0,useKeyboard:!0,minScrollbarLength:40}),$("#chat-msg-btn-add",this.el).on("click",_.bind(this._onBtnAddMessage,this)),this.txtMessage.on("keydown",_.bind(this._onKeyDown,this)),this.setupLayout(),this},focus:function(){var t=this;_.defer(function(){t.txtMessage.focus()},100),this.updateLayout(!0),this.setupAutoSizingTextBox()},_onKeyDown:function(t){t.keyCode==Common.UI.Keys.RETURN?!t.ctrlKey&&!t.metaKey||t.altKey||this._onBtnAddMessage(t):t.keyCode==Common.UI.Keys.ESC&&this.hide()},_onResetUsers:function(t,e){this.panelUsers&&(this.panelUsers.html(this.templateUserList({users:this.storeUsers.chain().filter(function(t){return t.get("online")}).groupBy(function(t){return t.get("idOriginal")}).value(),usertpl:this.tplUser,scope:this})),this.panelUsers.scroller.update({minScrollbarLength:25,alwaysVisibleY:!0}))},_onAddMessage:function(t,e,i){if(this.panelMessages){var n=this.panelMessages.find("ul");n&&n.length&&(this._prepareMessage(t),n.append(_.template(this.tplMsg)({msg:t,scope:this})),this.panelMessages.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0}),this.panelMessages.scroller.scrollTop(n.get(0).getBoundingClientRect().height))}},_onResetMessages:function(t,e){if(this.panelMessages){t.each(function(t){this._prepareMessage(t)},this),this.panelMessages.html(this.templateMsgList({messages:t.models,msgtpl:this.tplMsg,scope:this})),this.panelMessages.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})}},_onBtnAddMessage:function(t){this.txtMessage&&(this.fireEvent("message:add",[this,this.txtMessage.val().trim()]),this.txtMessage.val(""),this.focus())},_prepareMessage:function(t){var e=this.storeUsers.findOriginalUser(t.get("userid"));t.set({usercolor:e?e.get("color"):null,message:this._pickLink(t.get("message"))},{silent:!0})},_pickLink:function(t){var e,i,n=[];t.replace(Common.Utils.ipStrongRe,function(t){var i=/[\.,\?\+;:=!\(\)]+$/.exec(t);return i&&(t=t.substring(0,i.index)),e=arguments[arguments.length-2],n.push({start:e,end:t.length+e,str:'<a href="'+t+'" target="_blank" data-can-copy="true">'+t+"</a>"}),""}),(t.length<1e3||t.search(/\S{255,}/)<0)&&t.replace(Common.Utils.hostnameStrongRe,function(t){var o=/[\.,\?\+;:=!\(\)]+$/.exec(t);o&&(t=t.substring(0,o.index));var s=/(((^https?)|(^ftp)):\/\/)/i.test(t)?t:"http://"+t;return e=arguments[arguments.length-2],i=t.length,_.find(n,function(t){return e>=t.start&&e<t.end||e<=t.start&&e+i>t.start})||n.push({start:e,end:i+e,str:'<a href="'+s+'" target="_blank" data-can-copy="true">'+t+"</a>"}),""}),t.replace(Common.Utils.emailStrongRe,function(t){var o=/((^mailto:)\/\/)/i.test(t)?t:"mailto:"+t;return e=arguments[arguments.length-2],i=t.length,_.find(n,function(t){return e>=t.start&&e<t.end||e<=t.start&&e+i>t.start})||n.push({start:e,end:i+e,str:'<a href="'+o+'">'+t+"</a>"}),""}),n=_.sortBy(n,function(t){return t.start});for(var o=n.length>0?Common.Utils.String.htmlEncode(t.substring(0,n[0].start))+n[0].str:Common.Utils.String.htmlEncode(t),s=1;s<n.length;s++)o+=Common.Utils.String.htmlEncode(t.substring(n[s-1].end,n[s].start))+n[s].str;return n.length>0&&(o+=Common.Utils.String.htmlEncode(t.substring(n[s-1].end,t.length))),o},getUserName:function(t){return Common.Utils.String.htmlEncode(AscCommon.UserInfoParser.getParsedName(t))},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments),this.fireEvent("hide",this),this.textBoxAutoSizeLocked=void 0},setupLayout:function(){var t=this,e=$(t.el),i=this.panelBox.find(" > .layout-item");t.layout=new Common.UI.VBoxLayout({box:this.panelBox,items:[{el:i[0],rely:!0,behaviour:"splitter",resize:{hidden:!1,autohide:!1,fmin:function(){return t.usersBoxHeight},fmax:function(){return.5*t.panelBox.height()-t.messageBoxHeight}}},{el:i[1],rely:!0,behaviour:"splitter",resize:{hidden:!1,autohide:!1,fmin:function(){return Math.max(t.messageBoxHeight+t.usersBoxHeight,.5*t.panelBox.height())},fmax:function(){return t.panelBox.height()-t.addMessageBoxHeight}}},{el:i[2],stretch:!0}]}),t.layout.on("layout:resizedrag",function(e){t.updateScrolls(),t.usersCachedHeigt=t.panelUsers.height()+8+1,e.index||(t.textBoxAutoSizeLocked=!0)},this),$(window).on("resize",function(){"none"!==e.css("display")&&t.updateLayout()}),this.updateLayout();var n=this.panelBox.height();this.layout.setResizeValue(0,this.usersBoxHeight),this.layout.setResizeValue(1,Math.max(this.addMessageBoxHeight,Math.max(.5*n,n-t.panelOptions.height()-4))),this.setupAutoSizingTextBox(),this.txtMessage.bind("input propertychange",_.bind(this.updateHeightTextBox,this))},updateLayout:function(t){var e=this,i=this.panelBox.height();if(e.layout.setResizeValue(1,Math.max(e.addMessageBoxHeight,Math.max(.5*i,i-e.panelOptions.height()-4))),t){this.panelUsers.css("height");this.panelUsers.css("height","1px");var n=this.panelUsers.get(0).scrollHeight;e.layout.setResizeValue(0,Math.max(e.usersBoxHeight,Math.min(n+2,Math.floor(.5*i)-e.messageBoxHeight)))}else e.layout.setResizeValue(0,Math.max(e.usersBoxHeight,Math.min(e.usersCachedHeigt+2,Math.floor(.5*i)-e.messageBoxHeight)));e.updateScrolls(),e.updateHeightTextBox(null)},setupAutoSizingTextBox:function(){this.lineHeight=0,this.minHeight=44,this.lineHeight=1.25*parseInt(this.txtMessage.css("lineHeight"),10),this.updateHeightTextBox(!0)},updateHeightTextBox:function(t){var e,i,n=this.txtMessage;if(i=this.panelBox.height(),t&&0==n.val().length)return this.layout.setResizeValue(1,Math.max(this.addMessageBoxHeight,i-this.addMessageBoxHeight)),this.textBoxAutoSizeLocked=void 0,void this.updateScrolls();_.isUndefined(this.textBoxAutoSizeLocked)&&(n.height(),e=n.get(0).scrollHeight,n.css({height:this.minHeight+"px"}),n.height(),e=Math.max(n.get(0).scrollHeight+this.lineHeight,1),n.css({height:"100%"}),i=this.panelBox.height(),this.layout.setResizeValue(1,Math.max(this.addMessageBoxHeight,Math.min(i-e-40,i-this.addMessageBoxHeight)))&&this.updateScrolls())},updateScrolls:function(){this.panelUsers&&this.panelUsers.scroller&&this.panelMessages&&this.panelMessages.scroller&&(this.panelUsers.scroller.update({minScrollbarLength:25,alwaysVisibleY:!0}),this.panelMessages.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0}))},textSend:"Send"},Common.Views.Chat||{}))}),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/History",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout"],function(t){"use strict";Common.Views.History=Common.UI.BaseView.extend(_.extend({el:"#left-panel-history",storeHistory:void 0,template:_.template(['<div id="history-box" class="layout-ct vbox">','<div id="history-header" class="">','<div id="history-btn-back"><%=scope.textCloseHistory%></div>',"</div>",'<div id="history-list" class="">',"</div>",'<div id="history-expand-changes" class="">','<div id="history-btn-expand"><%=scope.textHideAll%></div>',"</div>","</div>"].join("")),initialize:function(t){_.extend(this,t),Common.UI.BaseView.prototype.initialize.call(this,arguments)},render:function(t){t=t||this.el,$(t).html(this.template({scope:this})).width((parseInt(Common.localStorage.getItem("de-mainmenu-width"))||MENU_SCALE_PART)-SCALE_MIN),this.viewHistoryList=new Common.UI.DataView({el:$("#history-list"),store:this.storeHistory,enableKeyEvents:!1,itemTemplate:_.template(['<div id="<%= id %>" class="history-item-wrap <% if (!isVisible) { %>hidden<% } %>" ','style="display: block; <% if (!isRevision) { %>padding-left: 40px;<% } %><% if (canRestore && selected) { %>padding-bottom: 6px;<% } %>">','<div class="user-date"><%= created %></div>',"<% if (markedAsVersion) { %>",'<div class="user-version">'+this.textVer+"<%=version%></div>","<% } %>","<% if (isRevision && hasChanges) { %>",'<div class="revision-expand img-commonctrl <% if (isExpanded) { %>up<% } %>"></div>',"<% } %>",'<div class="user-name">','<div class="color" style="display: inline-block; background-color:<%=usercolor%>;" >',"</div><%= Common.Utils.String.htmlEncode(AscCommon.UserInfoParser.getParsedName(username)) %>","</div>","<% if (canRestore && selected) { %>",'<label class="revision-restore" role="presentation" tabindex="-1">'+this.textRestore+"</label>","<% } %>","</div>"].join(""))});var e=this;this.viewHistoryList.onClickItem=function(t,i,n){var o=$(n.target);if(o&&o.hasClass("revision-expand")){var s=!i.get("isExpanded");i.set("isExpanded",s);var a=e.storeHistory.findRevisions(i.get("revision"));if(a&&a.length>1)for(var r=1;r<a.length;r++)a[r].set("isVisible",s);this.scroller.update({minScrollbarLength:40})}else Common.UI.DataView.prototype.onClickItem.call(this,t,i,n);e.btnExpand.cmpEl.text(e.storeHistory.hasCollapsed()?e.textShowAll:e.textHideAll)};var i=function(t,i,n){if(n.get("isRevision")){i.btnTip&&(i.btnTip.dontShow=!0,i.btnTip.tip().remove(),i.btnTip=null);var o=$(i.el).find(".revision-expand").tooltip({title:n.get("isExpanded")?e.textHide:e.textShow,placement:"cursor"});o.length>0&&(i.btnTip=o.data("bs.tooltip"))}};return this.viewHistoryList.on("item:add",i),this.viewHistoryList.on("item:change",i),this.btnBackToDocument=new Common.UI.Button({el:$("#history-btn-back"),enableToggle:!1}),this.btnExpand=new Common.UI.Button({el:$("#history-btn-expand"),enableToggle:!1}),this.trigger("render:after",this),this},textRestore:"Restore",textShow:"Expand",textHide:"Collapse",textCloseHistory:"Close History",textHideAll:"Hide detailed changes",textShowAll:"Show detailed changes",textVer:"ver."},Common.Views.History||{}))}),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/Plugins",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout","common/main/lib/component/Window"],function(t){"use strict";Common.Views.Plugins=Common.UI.BaseView.extend(_.extend({el:"#left-panel-plugins",storePlugins:void 0,template:_.template(['<div id="plugins-box" class="layout-ct vbox">','<label id="plugins-header"><%= scope.strPlugins %></label>','<div id="plugins-list" class="">',"</div>","</div>",'<div id="current-plugin-box" class="layout-ct vbox hidden">','<div id="current-plugin-header">',"<label></label>",'<div id="id-plugin-close" class="plugin-close img-commonctrl"></div>',"</div>",'<div id="current-plugin-frame" class="">',"</div>","</div>",'<div id="plugins-mask" style="display: none;">'].join("")),initialize:function(t){_.extend(this,t),this._locked=!1,this._state={DisabledControls:!1},this.lockedControls=[],Common.UI.BaseView.prototype.initialize.call(this,arguments),Common.NotificationCenter.on("app:ready",function(t){Common.Utils.asyncCall(this._onAppReady,this,t)}.bind(this))},render:function(t){return t&&(this.$el=$(t)),this.$el.html(this.template({scope:this})),this.pluginName=$("#current-plugin-header label"),this.pluginsPanel=$("#plugins-box"),this.pluginsMask=$("#plugins-mask",this.$el),this.currentPluginPanel=$("#current-plugin-box"),this.currentPluginFrame=$("#current-plugin-frame"),this.pluginMenu=new Common.UI.Menu({menuAlign:"tr-br",items:[]}),this.trigger("render:after",this),this},getPanel:function(){var t=$('<section id="plugins-panel" class="panel" data-tab="plugins"></section>'),e=$('<div class="group"></div>');return this.storePlugins.isEmpty()||this.storePlugins.each(function(t){}),e.appendTo(t),t},renderTo:function(t){if(!this.storePlugins.isEmpty()){var e=this,i=$('<div class="group"></div>');this.storePlugins.each(function(t){if(t.get("visible")){var n=t.get("variations"),o=t.get("guid"),s=n[t.get("currentVariation")].get("icons"),a=t.get("baseUrl")+e.parseIcons(s),r=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconImg:a,caption:t.get("name"),menu:n&&n.length>1,split:n&&n.length>1,value:o,hint:t.get("name")}),l=$('<span class="btn-slot text x-huge"></span>').appendTo(i);r.render(l),t.set("button",r),e.lockedControls.push(r)}}),t.html(i),$('<div class="separator long"></div>').prependTo(t)}},setLocked:function(t){this._locked=t},ChangeSettings:function(t){this.disableControls(this._locked)},disableControls:function(t){this._state.DisabledControls!==t&&(this._state.DisabledControls=t,_.each(this.lockedControls,function(e){e.setDisabled(t)}),this.pluginsMask&&this.pluginsMask.css("display",t?"block":"none"))},openInsideMode:function(t,e,i){return!!this.pluginsPanel&&(this.pluginsPanel.toggleClass("hidden",!0),this.currentPluginPanel.toggleClass("hidden",!1),this.pluginName.text(t),this.iframePlugin||(this.iframePlugin=document.createElement("iframe"),this.iframePlugin.id=void 0===i?"plugin_iframe":i,this.iframePlugin.name="pluginFrameEditor",this.iframePlugin.width="100%",this.iframePlugin.height="100%",this.iframePlugin.align="top",this.iframePlugin.frameBorder=0,this.iframePlugin.scrolling="no",this.iframePlugin.allow="camera; microphone; display-capture",this.iframePlugin.onload=_.bind(this._onLoad,this),this.currentPluginFrame.append(this.iframePlugin),this.loadMask||(this.loadMask=new Common.UI.LoadMask({owner:this.currentPluginFrame})),this.loadMask.setTitle(this.textLoading),this.loadMask.show(),this.iframePlugin.src=e),this.fireEvent("plugin:open",[this,"onboard","open"]),!0)},closeInsideMode:function(){this.pluginsPanel&&(this.iframePlugin&&(this.currentPluginFrame.empty(),this.iframePlugin=null),this.currentPluginPanel.toggleClass("hidden",!0),this.fireEvent("plugin:open",[this,"onboard","close"]))},openedPluginMode:function(t){var e=this.storePlugins.findWhere({guid:t});if(e){var i=e.get("button");i&&(i.toggle(!0),this.updatePluginButton(e),i.menu&&i.menu.items.length>0&&i.menu.items[0].setCaption(this.textStop))}},closedPluginMode:function(t){var e=this.storePlugins.findWhere({guid:t});if(e){var i=e.get("button");i&&(i.toggle(!1),this.updatePluginButton(e),i.menu&&i.menu.items.length>0&&i.menu.items[0].setCaption(this.textStart))}},_onLoad:function(){this.loadMask&&this.loadMask.hide()},_onAppReady:function(t){},parseIcons:function(t){if(t.length&&"string"!=typeof t[0]){for(var e=Common.UI.Themes.currentThemeId().toLowerCase(),i=Common.UI.Themes.isDarkTheme()?"dark":"light",n=-1,o=0;o<t.length;o++)if(t[o].theme&&t[o].theme.toLowerCase()==e){n=o;break}if(n<0)for(var o=0;o<t.length;o++)if(t[o].style&&t[o].style.toLowerCase()==i){n=o;break}n<0&&(n=0);var s,a,r=100*Common.Utils.applicationPixelRatio(),l=t[n],c=1e4,d=0;for(var h in l)l.hasOwnProperty(h)&&("default"==h?s=l[h]:isNaN(parseInt(h))||(d=Math.abs(r-parseInt(h)))<c-.01&&(c=d,a=l[h]));return c>.01&&s&&(a=s),{normal:a.normal,hover:a.hover||a.normal,active:a.active||a.normal}}var p=t[(Common.Utils.applicationPixelRatio()>1?1:0)+(t.length>2?2:0)];return{normal:p,hover:p,active:p}},updatePluginIcons:function(t){if(!t.get("visible"))return null;var e=t.get("variations"),i=e[t.get("currentVariation")].get("icons");t.set("parsedIcons",this.parseIcons(i)),this.updatePluginButton(t)},updatePluginButton:function(t){if(!t.get("visible"))return null;var e=t.get("button");e&&e.cmpEl&&e.cmpEl.find(".inner-box-icon img").attr("src",t.get("baseUrl")+t.get("parsedIcons")[e.isActive()?"active":"normal"])},createPluginButton:function(t){if(!t.get("visible"))return null;var e=this,i=t.get("variations"),n=t.get("guid"),o=i[t.get("currentVariation")].get("icons"),s=this.parseIcons(o),a=t.get("baseUrl")+s.normal;t.set("parsedIcons",s);var r=[];_.each(t.get("variations"),function(t,i){t.get("visible")&&r.push({caption:i>0?t.get("description"):e.textStart,value:parseInt(t.get("index"))})});var l=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconImg:a,caption:t.get("name"),menu:r.length>1,split:r.length>1,value:n,hint:t.get("name")});return l.split&&(l.setMenu(new Common.UI.Menu({items:r,pluginGuid:t.get("guid")})),l.menu.on("item:click",function(t,i,n){e.fireEvent("plugin:select",[t.options.pluginGuid,i.value])})),l.on("click",function(t,i){e.fireEvent("plugin:select",[t.options.value,0])}),t.set("button",l),e.lockedControls.push(l),l},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments),this.fireEvent("hide",this)},strPlugins:"Plugins",textLoading:"Loading",textStart:"Start",textStop:"Stop",groupCaption:"Plugins"},Common.Views.Plugins||{})),Common.Views.PluginDlg=Common.UI.Window.extend(_.extend({initialize:function(t){var e={};_.extend(e,{header:!0,enableKeyEvents:!1},t);var i=e.buttons&&_.size(e.buttons)>0?85:34;e.header||(i-=34),this.bordersOffset=40,e.width=Common.Utils.innerWidth()-2*this.bordersOffset-e.width<0?Common.Utils.innerWidth()-2*this.bordersOffset:e.width,e.height+=i,e.height=Common.Utils.innerHeight()-2*this.bordersOffset-e.height<0?Common.Utils.innerHeight()-2*this.bordersOffset:e.height,e.cls+=" advanced-settings-dlg",this.template=['<div id="id-plugin-container" class="box" style="height:'+(e.height-i)+'px;">','<div id="id-plugin-placeholder" style="width: 100%;height: 100%;"></div>',"</div>",'<% if ((typeof buttons !== "undefined") && _.size(buttons) > 0) { %>','<div class="separator horizontal"></div>',"<% } %>"].join(""),e.tpl=_.template(this.template)(e),this.url=t.url||"",this.frameId=t.frameId||"plugin_iframe",Common.UI.Window.prototype.initialize.call(this,e)},render:function(){Common.UI.Window.prototype.render.call(this),this.$window.find("> .body").css({height:"auto",overflow:"hidden"}),this.boxEl=this.$window.find(".body > .box"),this._headerFooterHeight=this.options.buttons&&_.size(this.options.buttons)>0?85:34,this.options.header||(this._headerFooterHeight-=34),this._headerFooterHeight+=parseInt(this.$window.css("border-top-width"))+parseInt(this.$window.css("border-bottom-width"));var t=document.createElement("iframe");t.id=this.frameId,t.name="pluginFrameEditor",t.width="100%",t.height="100%",t.align="top",t.frameBorder=0,t.scrolling="no",t.allow="camera; microphone; display-capture",t.onload=_.bind(this._onLoad,this);var e=this;setTimeout(function(){e.isLoaded||(e.loadMask=new Common.UI.LoadMask({owner:$("#id-plugin-placeholder")}),e.loadMask.setTitle(e.textLoading),e.loadMask.show(),e.isLoaded&&e.loadMask.hide())},500),t.src=this.url,$("#id-plugin-placeholder").append(t),this.on("resizing",function(t){e.boxEl.css("height",parseInt(e.$window.css("height"))-e._headerFooterHeight)});var i=function(){e.onWindowResize()};$(window).on("resize",i),this.on("close",function(){$(window).off("resize",i)})},_onLoad:function(){this.isLoaded=!0,this.loadMask&&this.loadMask.hide()},setInnerSize:function(t,e){var i=Common.Utils.innerHeight(),n=Common.Utils.innerWidth(),o=parseInt(this.$window.css("border-left-width"))+parseInt(this.$window.css("border-right-width")),s=2*this.bordersOffset;i-s<e+this._headerFooterHeight&&(e=i-s-this._headerFooterHeight),n-s<t+o&&(t=n-s-o),this.boxEl.css("height",e),Common.UI.Window.prototype.setHeight.call(this,e+this._headerFooterHeight),Common.UI.Window.prototype.setWidth.call(this,t+o),this.$window.css("left",(n-t-o)/2),this.$window.css("top",(i-e-this._headerFooterHeight)/2)},onWindowResize:function(){var t=Common.Utils.innerWidth(),e=Common.Utils.innerHeight(),i=this.getWidth(),n=this.getHeight(),o=this.resizable?0:this.bordersOffset;if(n<e-2*o+.1&&i<t-2*o+.1){var s=this.getLeft(),a=this.getTop();a<o?this.$window.css("top",o):a+n>e-o&&this.$window.css("top",e-o-n),s<o?this.$window.css("left",o):s+i>t-o&&this.$window.css("left",t-o-i)}else n>e-2*o&&(this.setHeight(Math.max(e-2*o,this.initConfig.minheight)),this.boxEl.css("height",Math.max(e-2*o,this.initConfig.minheight)-this._headerFooterHeight),this.$window.css("top",o)),i>t-2*o&&(this.setWidth(Math.max(t-2*o,this.initConfig.minwidth)),this.$window.css("left",o))},textLoading:"Loading"},Common.Views.PluginDlg||{}))}),define("common/main/lib/view/SearchDialog",["common/main/lib/component/Window"],function(){"use strict";Common.UI.SearchDialog=Common.UI.Window.extend(_.extend({options:{width:550,title:"Search & Replace",modal:!1,cls:"search",toolclose:"hide",alias:"SearchDialog"},initialize:function(t){_.extend(this.options,t||{}),this.template=['<div class="box">','<div class="input-row">','<span class="btn-placeholder" id="search-placeholder-btn-options"></span>','<input type="text" id="sd-text-search" class="input-field form-control" maxlength="255" placeholder="'+this.textSearchStart+'">',"</div>",'<div class="input-row">','<input type="text" id="sd-text-replace" class="input-field form-control" maxlength="255" placeholder="'+this.textReplaceDef+'">',"</div>",'<div class="input-row">','<label class="link" id="search-label-replace" result="replaceshow">'+this.txtBtnReplace+"</label>","</div>","</div>",'<div class="separator horizontal"></div>','<div class="footer right">','<button class="btn normal dlg-btn" result="replace">'+this.txtBtnReplace+"</button>",'<button class="btn normal dlg-btn" result="replaceall" style="margin-left: 6px;width: auto;min-width: 100px;">'+this.txtBtnReplaceAll+"</button>",'<button class="btn normal dlg-btn iconic" result="back"><span class="icon img-commonctrl back"></span></button>','<button class="btn normal dlg-btn iconic" result="next" style="margin-left: 6px;"><span class="icon img-commonctrl next"></span></button>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){return Common.UI.Window.prototype.render.call(this),this.miMatchCase=new Common.UI.MenuItem({caption:this.textMatchCase,checkable:!0}),this.miMatchWord=new Common.UI.MenuItem({caption:this.options.matchwordstr||this.textWholeWords,checkable:!0}),this.miHighlight=new Common.UI.MenuItem({caption:this.textHighlight,checkable:!0}),this.btnOptions=new Common.UI.Button({id:"search-btn-options",cls:"btn-toolbar",iconCls:"toolbar__icon btn-settings",menu:new Common.UI.Menu({items:[this.miMatchCase,this.miMatchWord,this.miHighlight]})}),this.options.extraoptions&&(this.btnOptions.menu.addItem({caption:"--"}),this.options.extraoptions.forEach(function(t){this.btnOptions.menu.addItem(t)},this)),this.btnOptions.render(this.$window.find("#search-placeholder-btn-options")),this.options.matchcase||this.miMatchCase.hide(),this.options.matchword||this.miMatchWord.hide(),this.options.markresult?this.options.markresult.applied&&this.miHighlight.setChecked(!0,!0):this.miHighlight.hide(),"search"===this.options.mode&&$(this.$window.find(".input-row").get(2)).hide(),this.txtSearch=this.$window.find("#sd-text-search"),this.txtReplace=this.$window.find("#sd-text-replace"),this.lblReplace=this.$window.find("#search-label-replace"),this.miHighlight.on("toggle",_.bind(this.onHighlight,this)),this.$window.find(".btn[result=back]").on("click",_.bind(this.onBtnClick,this,"back")),this.$window.find(".btn[result=next]").on("click",_.bind(this.onBtnClick,this,"next")),this.$window.find(".btn[result=replace]").on("click",_.bind(this.onBtnClick,this,"replace")),this.$window.find(".btn[result=replaceall]").on("click",_.bind(this.onBtnClick,this,"replaceall")),this.$window.find("label[result=replaceshow]").on("click",_.bind(this.onShowReplace,this)),this.txtSearch.on("keydown",null,"search",_.bind(this.onKeyPress,this)),this.txtReplace.on("keydown",null,"replace",_.bind(this.onKeyPress,this)),this.on("animate:before",_.bind(this.focus,this)),this},show:function(t,e){
Common.UI.Window.prototype.show.call(this),!this.mode&&!t&&(t="search"),t&&this.mode!=t&&this.setMode(t),e&&this.setSearchText(e),this.options.markresult&&this.miHighlight.checked&&this.fireEvent("search:highlight",[this,!0]),this.focus()},focus:function(){var t=this;setTimeout(function(){t.txtSearch.focus(),t.txtSearch.select()},10)},onKeyPress:function(t){this.isLocked()||(t.keyCode==Common.UI.Keys.RETURN?("search"==t.data?this.onBtnClick("next",t):"replace"==t.data&&"replace"==this.mode&&this.onBtnClick("replace",t),t.preventDefault(),t.stopPropagation()):t.keyCode==Common.UI.Keys.ESC&&$(".asc-loadmask").length<1&&(this.hide(),t.preventDefault(),t.stopPropagation()))},onBtnClick:function(t,e){if(!$(".asc-loadmask").length){var i={textsearch:this.txtSearch.val(),textreplace:this.txtReplace.val(),matchcase:this.miMatchCase.checked,matchword:this.miMatchWord.checked,highlight:this.miHighlight.checked};this.fireEvent("search:"+t,[this,i])}},setMode:function(t){this.mode=t;var e=this.$window.find(".input-row");"no-replace"===t?(this.setTitle(this.textTitle2),e.eq(1).hide(),e.eq(2).hide(),this.$window.find(".btn[result=replace]").hide(),this.$window.find(".btn[result=replaceall]").hide(),this.options.matchcase||this.options.matchword||this.options.markresult||(this.txtSearch.addClass("clear"),this.btnOptions.hide()),this.menuLookin&&this.menuLookin.menu.items[1].setDisabled(!1),this.setHeight(170)):(this.txtSearch.removeClass("clear"),this.setTitle(this.textTitle),"search"===t?(e.eq(2).show(),this.lblReplace.text(this.txtBtnReplace),e.eq(1).hide(),this.$window.find(".btn[result=replace]").hide(),this.$window.find(".btn[result=replaceall]").hide(),this.menuLookin&&this.menuLookin.menu.items[1].setDisabled(!1),this.setHeight(200)):(e.eq(2).show(),this.lblReplace.text(this.txtBtnHideReplace),e.eq(1).show(),this.$window.find(".btn[result=replace]").show(),this.$window.find(".btn[result=replaceall]").show(),this.menuLookin&&(this.menuLookin.menu.items[0].setChecked(!0),this.menuLookin.menu.items[1].setDisabled(!0)),this.setHeight(230)))},setSearchText:function(t){this.txtSearch&&this.txtSearch.val(t)},onShowReplace:function(t){this.setMode("replace"==this.mode?"search":"replace");var e=this;_.defer(function(){"replace"==e.mode?e.txtReplace.focus():e.txtSearch.focus()},300)},onHighlight:function(t,e){this.fireEvent("search:highlight",[this,e])},getSettings:function(){return{textsearch:this.txtSearch.val(),matchcase:this.miMatchCase.checked,matchword:this.miMatchWord.checked}},textTitle:"Search & Replace",textTitle2:"Search",txtBtnReplace:"Replace",txtBtnReplaceAll:"Replace All",textMatchCase:"Case sensitive",textWholeWords:"Whole words only",textHighlight:"Highlight results",textReplaceDef:"Enter the replacement text",textSearchStart:"Enter text for search",txtBtnHideReplace:"Hide Replace"},Common.UI.SearchDialog||{}))}),define("text!documenteditor/main/app/template/FileMenu.template",[],function(){return'<div class="panel-menu">\r\n    <li class="fm-first-item"></li>\r\n    <li id="fm-btn-return" class="fm-btn"></li>\r\n    <li class="devider"></li>\r\n    <li id="fm-btn-save" class="fm-btn"></li>\r\n    <li id="fm-btn-edit" class="fm-btn"></li>\r\n    <li id="fm-btn-download" class="fm-btn"></li>\r\n    <li id="fm-btn-save-copy" class="fm-btn"></li>\r\n    <li id="fm-btn-save-desktop" class="fm-btn"></li>\r\n    <li id="fm-btn-print" class="fm-btn"></li>\r\n    <li id="fm-btn-rename" class="fm-btn"></li>\r\n    <li id="fm-btn-protect" class="fm-btn"></li>\r\n    <li class="devider"></li>\r\n    <li id="fm-btn-recent" class="fm-btn"></li>\r\n    <li id="fm-btn-create" class="fm-btn"></li>\r\n    <li class="devider"></li>\r\n    <li id="fm-btn-info" class="fm-btn"></li>\r\n    <li id="fm-btn-rights" class="fm-btn"></li>\r\n    <li id="fm-btn-history" class="fm-btn"></li>\r\n    <li class="devider" class="fm-btn"></li>\r\n    <li id="fm-btn-settings" class="fm-btn"></li>\r\n    <li class="devider"></li>\r\n    <li id="fm-btn-help" class="fm-btn"></li>\r\n    <li class="devider"></li>\r\n    <li id="fm-btn-back" class="fm-btn"></li>\r\n</div>\r\n<div class="panel-context">\r\n    <div id="panel-saveas" class="content-box"></div>\r\n    <div id="panel-savecopy" class="content-box"></div>\r\n    <div id="panel-recentfiles" class="content-box"></div>\r\n    <div id="panel-createnew" class="content-box"></div>\r\n    <div id="panel-info" class="content-box"></div>\r\n    <div id="panel-rights" class="content-box"></div>\r\n    <div id="panel-settings" class="content-box"></div>\r\n    <div id="panel-help" class="content-box"></div>\r\n    <div id="panel-protect" class="content-box"></div>\r\n</div>'}),define("documenteditor/main/app/view/FileMenu",["text!documenteditor/main/app/template/FileMenu.template","underscore","common/main/lib/component/BaseView"],function(t,e){"use strict";DE.Views.FileMenu=Common.UI.BaseView.extend(e.extend({el:"#file-menu-panel",rendered:!1,options:{alias:"FileMenu"},template:e.template(t),events:function(){return{"click .fm-btn":e.bind(function(t){var i=$(t.currentTarget);i.hasClass("active")||($(".fm-btn",this.el).removeClass("active"),i.addClass("active"));var n=e.findWhere(this.items,{el:t.currentTarget});if(n){var o=this.panels[n.options.action];this.fireEvent("item:click",[this,n.options.action,!!o]),o&&(this.$el.find(".content-box:visible").hide(),this.active=n.options.action,o.show())}},this)}},initialize:function(){},render:function(){var t=$(this.template());if(this.miSave=new Common.UI.MenuItem({el:t.elementById("#fm-btn-save"),action:"save",caption:this.btnSaveCaption,canFocused:!1}),this.options.miSave&&(this.miSave.setDisabled(this.options.miSave.isDisabled()),delete this.options.miSave),this.miEdit=new Common.UI.MenuItem({el:t.elementById("#fm-btn-edit"),action:"edit",caption:this.btnToEditCaption,canFocused:!1}),this.miDownload=new Common.UI.MenuItem({el:t.elementById("#fm-btn-download"),action:"saveas",caption:this.btnDownloadCaption,canFocused:!1}),this.miSaveCopyAs=new Common.UI.MenuItem({el:t.elementById("#fm-btn-save-copy"),action:"save-copy",caption:this.btnSaveCopyAsCaption,canFocused:!1}),this.miSaveAs=new Common.UI.MenuItem({el:t.elementById("#fm-btn-save-desktop"),action:"save-desktop",caption:this.btnSaveAsCaption,canFocused:!1}),this.miPrint=new Common.UI.MenuItem({el:t.elementById("#fm-btn-print"),action:"print",caption:this.btnPrintCaption,canFocused:!1}),this.miRename=new Common.UI.MenuItem({el:t.elementById("#fm-btn-rename"),action:"rename",caption:this.btnRenameCaption,canFocused:!1}),this.options.miRename&&(this.miRename.setDisabled(this.options.miRename.isDisabled()),delete this.options.miRename),this.miProtect=new Common.UI.MenuItem({el:t.elementById("#fm-btn-protect"),action:"protect",caption:this.btnProtectCaption,canFocused:!1}),this.options.miProtect&&(this.miProtect.setDisabled(this.options.miProtect.isDisabled()),delete this.options.miProtect),this.miRecent=new Common.UI.MenuItem({el:t.elementById("#fm-btn-recent"),action:"recent",caption:this.btnRecentFilesCaption,canFocused:!1}),this.miNew=new Common.UI.MenuItem({el:t.elementById("#fm-btn-create"),action:"new",caption:this.btnCreateNewCaption,canFocused:!1}),this.miAccess=new Common.UI.MenuItem({el:t.elementById("#fm-btn-rights"),action:"rights",caption:this.btnRightsCaption,canFocused:!1}),this.miHistory=new Common.UI.MenuItem({el:t.elementById("#fm-btn-history"),action:"history",caption:this.btnHistoryCaption,canFocused:!1}),this.miHelp=new Common.UI.MenuItem({el:t.elementById("#fm-btn-help"),action:"help",caption:this.btnHelpCaption,canFocused:!1}),this.items=[],this.items.push(new Common.UI.MenuItem({el:t.elementById("#fm-btn-return"),action:"back",caption:this.btnCloseMenuCaption,canFocused:!1}),this.miSave,this.miEdit,this.miDownload,this.miSaveCopyAs,this.miSaveAs,this.miPrint,this.miRename,this.miProtect,this.miRecent,this.miNew,new Common.UI.MenuItem({el:t.elementById("#fm-btn-info"),action:"info",caption:this.btnInfoCaption,canFocused:!1}),this.miAccess,this.miHistory,new Common.UI.MenuItem({el:t.elementById("#fm-btn-settings"),action:"opts",caption:this.btnSettingsCaption,canFocused:!1}),this.miHelp,new Common.UI.MenuItem({el:t.elementById("#fm-btn-back"),action:"exit",caption:this.btnBackCaption,canFocused:!1})),this.rendered=!0,this.$el.html(t),this.$el.find(".content-box").hide(),e.isUndefined(this.scroller)){var i=this;this.scroller=new Common.UI.Scroller({el:this.$el.find(".panel-menu"),suppressScrollX:!0,alwaysVisibleY:!0}),Common.NotificationCenter.on("window:resize",function(){i.scroller.update()})}return this.applyMode(),this.api&&(this.panels.info.setApi(this.api),this.panels.opts&&this.panels.opts.setApi(this.api),this.panels.protect&&this.panels.protect.setApi(this.api)),this},show:function(t,e){if((!this.isVisible()||void 0!==t)&&this.mode){this.rendered||this.render();var i=!this.mode.canDownload||this.mode.isDesktopApp&&this.mode.isOffline?"info":"saveas";t||(t=this.active||i),this.$el.show(),this.scroller.update(),this.selectMenu(t,e,i),this.api.asc_enableKeyEvents(!1),this.fireEvent("menu:show",[this])}},hide:function(){this.$el.hide(),this.fireEvent("menu:hide",[this])},applyMode:function(){if(this.panels||(this.panels={opts:new DE.Views.FileMenuPanels.Settings({menu:this}).render(this.$el.find("#panel-settings")),info:new DE.Views.FileMenuPanels.DocumentInfo({menu:this}).render(this.$el.find("#panel-info")),rights:new DE.Views.FileMenuPanels.DocumentRights({menu:this}).render(this.$el.find("#panel-rights"))}),this.mode){this.miDownload[!this.mode.canDownload&&!this.mode.canDownloadOrigin||this.mode.isDesktopApp&&this.mode.isOffline?"hide":"show"]();var t=!!window.AscDesktopEditor&&window.AscDesktopEditor.isBlockchainSupport();this.miSaveCopyAs[!this.mode.canDownload&&!this.mode.canDownloadOrigin||this.mode.isDesktopApp&&this.mode.isOffline||!this.mode.canRequestSaveAs&&!this.mode.saveAsUrl||t?"hide":"show"](),this.miSaveAs[(this.mode.canDownload||this.mode.canDownloadOrigin)&&this.mode.isDesktopApp&&this.mode.isOffline?"show":"hide"](),this.miSave[this.mode.isEdit?"show":"hide"](),this.miEdit[!this.mode.isEdit&&this.mode.canEdit&&this.mode.canRequestEditRights?"show":"hide"](),this.miPrint[this.mode.canPrint?"show":"hide"](),this.miRename[this.mode.canRename&&!this.mode.isDesktopApp?"show":"hide"](),this.miProtect[this.mode.canProtect?"show":"hide"]();var e=this.mode.canDownload||this.mode.canDownloadOrigin||this.mode.isEdit||this.mode.canPrint||this.mode.canProtect||!this.mode.isEdit&&this.mode.canEdit&&this.mode.canRequestEditRights||this.mode.canRename&&!this.mode.isDesktopApp;this.miProtect.$el.find("+.devider")[e&&!this.mode.isDisconnected?"show":"hide"](),this.miRecent[this.mode.canOpenRecent?"show":"hide"](),this.miNew[this.mode.canCreateNew?"show":"hide"](),this.miNew.$el.find("+.devider")[this.mode.canCreateNew?"show":"hide"](),this.miAccess[!this.mode.isOffline&&this.document&&this.document.info&&(this.document.info.sharingSettings&&this.document.info.sharingSettings.length>0||this.mode.sharingSettingsUrl&&this.mode.sharingSettingsUrl.length||this.mode.canRequestSharingSettings)?"show":"hide"](),this.miHelp[this.mode.canHelp?"show":"hide"](),this.miHelp.$el.prev()[this.mode.canHelp?"show":"hide"](),this.mode.canBack?this.$el.find("#fm-btn-back").show().prev().show():this.$el.find("#fm-btn-back").hide().prev().hide(),this.customizationDone||(this.customizationDone=!0,Common.Utils.applyCustomization(this.mode.customization,{goback:"#fm-btn-back > a"})),this.panels.opts.setMode(this.mode),this.panels.info.setMode(this.mode),!this.mode.isDisconnected&&this.panels.info.updateInfo(this.document),this.panels.rights.setMode(this.mode),!this.mode.isDisconnected&&this.panels.rights.updateInfo(this.document),this.mode.canCreateNew&&this.mode.templates&&this.mode.templates.length&&($("a",this.miNew.$el).text(this.btnCreateNewCaption+"..."),!this.panels.new&&(this.panels.new=new DE.Views.FileMenuPanels.CreateNew({menu:this,docs:this.mode.templates}).render())),this.mode.canOpenRecent&&this.mode.recent&&!this.panels.recent&&(this.panels.recent=new DE.Views.FileMenuPanels.RecentFiles({menu:this,recent:this.mode.recent}).render()),this.mode.canProtect&&(!this.panels.protect&&(this.panels.protect=new DE.Views.FileMenuPanels.ProtectDoc({menu:this}).render()),this.panels.protect.setMode(this.mode)),this.mode.canDownload?!this.panels.saveas&&(this.panels.saveas=new DE.Views.FileMenuPanels.ViewSaveAs({menu:this}).render()):this.mode.canDownloadOrigin&&$("a",this.miDownload.$el).text(this.textDownload),this.mode.canDownload&&(this.mode.canRequestSaveAs||this.mode.saveAsUrl)&&!this.panels["save-copy"]&&(this.panels["save-copy"]=new DE.Views.FileMenuPanels.ViewSaveCopy({menu:this}).render()),this.mode.canHelp&&!this.panels.help&&(this.panels.help=new DE.Views.FileMenuPanels.Help({menu:this}).render(),this.panels.help.setLangConfig(this.mode.lang)),this.miHistory[this.mode.canUseHistory&&!this.mode.isDisconnected?"show":"hide"]()}},setMode:function(t,e){return t.isDisconnected?(this.mode.canEdit=this.mode.isEdit=!1,this.mode.canOpenRecent=this.mode.canCreateNew=!1,this.mode.isDisconnected=t.isDisconnected,this.mode.canRename=!1,t.enableDownload||(this.mode.canPrint=this.mode.canDownload=this.mode.canDownloadOrigin=!1)):this.mode=t,e||this.rendered&&this.applyMode(),this},setApi:function(t){return this.api=t,this.rendered&&(this.panels.info.setApi(t),this.panels.opts&&this.panels.opts.setApi(t),this.panels.protect&&this.panels.protect.setApi(t)),this},loadDocument:function(t){this.document=t.doc},selectMenu:function(t,e,i){if(t){var n=this._getMenuItem(t),o=this.panels[t];if(!n.isDisabled()&&n.isVisible()||(n=this._getMenuItem(i),o=this.panels[i]),n&&o){if($(".fm-btn",this.el).removeClass("active"),n.$el.addClass("active"),this.$el.find(".content-box:visible").hide(),o.show(e),this.scroller){var s=n.$el.position().top,a=n.$el.outerHeight(),r=this.$el.outerHeight();if(s<0||s+a>r){var l=this.scroller.$el.scrollTop()+s+(a-r)/2;l=Math.floor(l/a)*a,this.scroller.scrollTop(l)}}this.active=t}}},_getMenuItem:function(t){return e.find(this.items,function(e){return e.options.action==t})},SetDisabled:function(t){var e=this.getButton("save"),i=this.getButton("rename"),n=this.getButton("protect");e[t||!this.mode.isEdit?"hide":"show"](),n[t||!this.mode.isEdit?"hide":"show"](),i[t||!this.mode.canRename||this.mode.isDesktopApp?"hide":"show"]()},isVisible:function(){return!this.$el.is(":hidden")},getButton:function(t){if(this.rendered){if("save"==t)return this.miSave;if("rename"==t)return this.miRename;if("protect"==t)return this.miProtect}else{if("save"==t)return this.options.miSave?this.options.miSave:this.options.miSave=new Common.UI.MenuItem({});if("rename"==t)return this.options.miRename?this.options.miRename:this.options.miRename=new Common.UI.MenuItem({});if("protect"==t)return this.options.miProtect?this.options.miProtect:this.options.miProtect=new Common.UI.MenuItem({})}},btnSaveCaption:"Save",btnDownloadCaption:"Download as...",btnInfoCaption:"Document Info...",btnRightsCaption:"Access Rights...",btnCreateNewCaption:"Create New",btnRecentFilesCaption:"Open Recent...",btnPrintCaption:"Print",btnHelpCaption:"Help...",btnReturnCaption:"Back to Document",btnToEditCaption:"Edit Document",btnBackCaption:"Go to Documents",btnSettingsCaption:"Advanced Settings...",btnHistoryCaption:"Versions History",btnSaveAsCaption:"Save as",textDownload:"Download",btnRenameCaption:"Rename...",btnCloseMenuCaption:"Close Menu",btnProtectCaption:"Protect",btnSaveCopyAsCaption:"Save Copy as..."},DE.Views.FileMenu||{}))}),void 0===Common)var Common={};if(define("common/main/lib/component/TreeView",["common/main/lib/component/DataView"],function(){"use strict";Common.UI.TreeViewModel=Common.UI.DataViewModel.extend({defaults:function(){return{id:Common.UI.getId(),name:"",isNotHeader:!1,hasSubItems:!1,hasParent:!1,isEmptyItem:!1,isExpanded:!0,isVisible:!0,selected:!1,allowSelected:!0,disabled:!1,level:0,index:0}}}),Common.UI.TreeViewStore=Backbone.Collection.extend({model:Common.UI.TreeViewModel,expandSubItems:function(t){var e=this,i=function(t,n,o){for(var s=t+1;s<e.length;s++){var a=e.at(s),r=a.get("level");if(!(r>o))return s-1;n&&a.set("isVisible",!0),a.get("hasSubItems")&&(s=i(s,a.get("isExpanded"),r))}};t.set("isExpanded",!0),i(t.get("index"),!0,t.get("level"))},collapseSubItems:function(t){for(var e=t.get("level"),i=t.get("index"),n=i+1;n<this.length;n++){var o=this.at(n);if(!(o.get("level")>e))break;o.set("isVisible",!1)}return n-1},expandAll:function(){this.each(function(t){t.set("isExpanded",!0),t.set("isVisible",!0)})},collapseAll:function(){for(var t=0;t<this.length;t++){var e=this.at(t);e.get("isNotHeader")||(e.set("isExpanded",!1),t=this.collapseSubItems(e))}},expandToLevel:function(t){for(var e=this,i=function(n,o){var s=e.at(n);s.set("isExpanded",!1);for(var a=n+1;a<e.length;a++){var r=e.at(a),l=r.get("level");if(!(l>o))return a-1;l<=t&&s.set("isExpanded",!0),r.set("isVisible",l<=t),r.get("hasSubItems")&&(a=i(a,l))}},n=0;n<this.length;n++){var o=this.at(n);(o.get("level")<=t||!o.get("hasParent"))&&(o.set("isVisible",!0),o.get("isNotHeader")||(n=i(n,o.get("level"))))}}}),Common.UI.TreeView=Common.UI.DataView.extend(function(){return{options:{handleSelect:!0,showLast:!0,allowScrollbar:!0,scrollAlwaysVisible:!0,emptyItemText:"",keyMoveDirection:"both"},template:_.template(['<div class="treeview inner" style="<%= style %>"></div>'].join("")),initialize:function(t){t.store=t.store||new Common.UI.TreeViewStore,t.emptyItemText=t.emptyItemText||"",t.itemTemplate=t.itemTemplate||_.template(['<div id="<%= id %>" class="tree-item <% if (!isVisible) { %>hidden<% } %>" style="display: block;padding-left: <%= level*16 + 24 %>px;">',"<% if (hasSubItems) { %>",'<div class="tree-caret img-commonctrl <% if (!isExpanded) { %>up<% } %>" style="margin-left: <%= level*16 %>px;"></div>',"<% } %>","<% if (isNotHeader) { %>",'<div class="name not-header"><%= Common.Utils.String.htmlEncode(name) %></div>',"<% } else if (isEmptyItem) { %>",'<div class="name empty">'+t.emptyItemText+"</div>","<% } else { %>",'<div class="name"><%= Common.Utils.String.htmlEncode(name) %></div>',"<% } %>","</div>"].join("")),Common.UI.DataView.prototype.initialize.call(this,t)},onAddItem:function(t,e,i){var n=new Common.UI.DataViewItem({template:this.itemTemplate,model:t});if(n){var o=(this.$el||$(this.el)).find(".inner").addBack().filter(".inner");if(o){if(this.dataViewItems.length<1&&o.find(".empty-text").remove(),i&&"number"==typeof i.at){var s=i.at,a=o.find("> div");s>0?$(a.get(s-1)).after(n.render().el):a.length>0?$(a[s]).before(n.render().el):o.append(n.render().el),this.dataViewItems=this.dataViewItems.slice(0,s).concat(n).concat(this.dataViewItems.slice(s))}else o.append(n.render().el),this.dataViewItems.push(n);var r=t.get("name");if(r.length>37-2*t.get("level")&&t.set("tip",r),t.get("tip")){var l=$(n.el);l.attr("data-toggle","tooltip"),l.tooltip({title:t.get("tip"),placement:"cursor",zIndex:this.tipZIndex})}this.listenTo(n,"change",this.onChangeItem),this.listenTo(n,"remove",this.onRemoveItem),this.listenTo(n,"click",this.onClickItem),this.listenTo(n,"dblclick",this.onDblClickItem),this.listenTo(n,"select",this.onSelectItem),this.listenTo(n,"contextmenu",this.onContextMenuItem),this.isSuspendEvents||this.trigger("item:add",this,n,t)}}},onClickItem:function(t,e,i){var n=$(i.target);if(n&&n.hasClass("tree-caret")){var o=t.$el.data("bs.tooltip");o&&o.tip().remove();var s=!e.get("isExpanded");e.set("isExpanded",s),this.store[s?"expandSubItems":"collapseSubItems"](e),this.scroller.update({minScrollbarLength:40,alwaysVisibleY:this.scrollAlwaysVisible})}else Common.UI.DataView.prototype.onClickItem.call(this,t,e,i)},expandAll:function(){this.store.expandAll(),this.scroller.update({minScrollbarLength:40,alwaysVisibleY:this.scrollAlwaysVisible})},collapseAll:function(){this.store.collapseAll(),this.scroller.update({minScrollbarLength:40,alwaysVisibleY:this.scrollAlwaysVisible})},expandToLevel:function(t){this.store.expandToLevel(t),this.scroller.update({minScrollbarLength:40,alwaysVisibleY:this.scrollAlwaysVisible})},expandRecord:function(t){t&&(t.set("isExpanded",!0),this.store.expandSubItems(t),this.scroller.update({minScrollbarLength:40,alwaysVisibleY:this.scrollAlwaysVisible}))},collapseRecord:function(t){t&&(t.set("isExpanded",!1),this.store.collapseSubItems(t),this.scroller.update({minScrollbarLength:40,alwaysVisibleY:this.scrollAlwaysVisible}))},onKeyDown:function(t,e){if(!this.disabled)if(void 0===e&&(e=t),_.indexOf(this.moveKeys,e.keyCode)>-1||e.keyCode==Common.UI.Keys.RETURN){e.preventDefault(),e.stopPropagation();var i=this.getSelectedRec();if(null===this.lastSelectedRec&&(this.lastSelectedRec=i),e.keyCode==Common.UI.Keys.RETURN)this.lastSelectedRec=null,this.selectedBeforeHideRec&&(i=this.selectedBeforeHideRec),this.trigger("item:click",this,this,i,t),this.trigger("item:select",this,this,i,t),this.trigger("entervalue",this,i,t),this.parentMenu&&this.parentMenu.hide();else{var n=_.indexOf(this.store.models,i);if(n<0)if(e.keyCode==Common.UI.Keys.LEFT){var o=$(t.target).closest(".dropdown-submenu.over");o.length>0?(o.removeClass("over"),o.find("> a").focus()):n=0}else n=0;else if("both"==this.options.keyMoveDirection){var s=i.get("hasSubItems"),a=(i.get("hasParent"),i.get("isExpanded"));if(e.keyCode==Common.UI.Keys.LEFT)s&&a&&this.collapseRecord(i);else if(e.keyCode==Common.UI.Keys.RIGHT)s&&!a&&this.expandRecord(i);else if(e.keyCode==Common.UI.Keys.DOWN){for(var r=n+1;r<this.store.length;r++)if(this.store.at(r).get("isVisible")){n=r;break}}else if(e.keyCode==Common.UI.Keys.UP)for(var r=n-1;r>=0;r--)if(this.store.at(r).get("isVisible")){n=r;break}}else n=e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.LEFT?Math.max(0,n-1):Math.min(this.store.length-1,n+1);void 0!==n&&n>=0&&(i=this.store.at(n)),i&&(this._fromKeyDown=!0,this.selectRecord(i),this._fromKeyDown=!1,this.scrollToRecord(i))}}else this.trigger("item:keydown",this,i,t)},focus:function(){this.cmpEl&&this.cmpEl.find(".treeview").focus()}}}())}),define("documenteditor/main/app/view/Navigation",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout","common/main/lib/component/TreeView"],function(t){"use strict";DE.Views.Navigation=Common.UI.BaseView.extend(_.extend({el:"#left-panel-navigation",storeNavigation:void 0,template:_.template(['<div id="navigation-box" class="layout-ct vbox">','<div id="navigation-list" class="">',"</div>","</div>"].join("")),initialize:function(t){_.extend(this,t),Common.UI.BaseView.prototype.initialize.call(this,arguments)},render:function(t){return t=t||this.el,$(t).html(this.template({scope:this})),this.$el=$(t),this.viewNavigationList=new Common.UI.TreeView({el:$("#navigation-list"),store:this.storeNavigation,enableKeyEvents:!1,emptyText:this.txtEmpty,emptyItemText:this.txtEmptyItem,style:"border: none;"}),this.viewNavigationList.cmpEl.off("click"),this.navigationMenu=new Common.UI.Menu({items:[{caption:this.txtPromote,value:"promote"},{caption:this.txtDemote,value:"demote"},{caption:"--"},{caption:this.txtHeadingBefore,value:"before"},{caption:this.txtHeadingAfter,value:"after"},{caption:this.txtNewHeading,value:"new"},{caption:"--"},{caption:this.txtSelect,value:"select"},{caption:"--"},{caption:this.txtExpand,value:"expand"},{caption:this.txtCollapse,value:"collapse"},{caption:this.txtExpandToLevel,menu:new Common.UI.Menu({menuAlign:"tl-tr",style:"min-width: 60px;",items:[{caption:"1",value:1},{caption:"2",value:2},{caption:"3",value:3},{caption:"4",value:4},{caption:"5",value:5},{caption:"6",value:6},{caption:"7",value:7},{caption:"8",value:8},{caption:"9",value:9}]})}]}),this.trigger("render:after",this),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.fireEvent("show",this)},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments),this.fireEvent("hide",this)},ChangeSettings:function(t){},txtPromote:"Promote",txtDemote:"Demote",txtHeadingBefore:"New heading before",txtHeadingAfter:"New heading after",txtNewHeading:"New subheading",txtSelect:"Select content",txtExpand:"Expand all",txtCollapse:"Collapse all",txtExpandToLevel:"Expand to level...",txtEmpty:"There are no headings in the document.<br>Apply a heading style to the text so that it appears in the table of contents.",txtEmptyItem:"Empty Heading"},DE.Views.Navigation||{}))}),define("documenteditor/main/app/view/LeftMenu",["text!documenteditor/main/app/template/LeftMenu.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/view/About","common/main/lib/view/Comments","common/main/lib/view/Chat","common/main/lib/view/History","common/main/lib/view/Plugins","common/main/lib/view/About","common/main/lib/view/SearchDialog","documenteditor/main/app/view/FileMenu","documenteditor/main/app/view/Navigation"],function(t,e,i,n){"use strict";DE.Views.LeftMenu=n.View.extend(i.extend({el:"#left-menu",template:i.template(t),events:function(){return{"click #left-btn-comments":i.bind(this.onCoauthOptions,this),"click #left-btn-chat":i.bind(this.onCoauthOptions,this),"click #left-btn-plugins":i.bind(this.onCoauthOptions,this),"click #left-btn-navigation":i.bind(this.onCoauthOptions,this),"click #left-btn-support":function(){var t=this.mode.customization;t&&t.feedback&&t.feedback.url?window.open(t.feedback.url):window.open("https://support.onlyoffice.com")}}},initialize:function(){this.minimizedMode=!0,this._state={}},render:function(){var t=e(this.template({}));return this.btnSearch=new Common.UI.Button({action:"search",el:t.elementById("#left-btn-search"),hint:this.tipSearch+Common.Utils.String.platformKey("Ctrl+F"),disabled:!0,enableToggle:!0}),this.btnAbout=new Common.UI.Button({action:"about",el:t.elementById("#left-btn-about"),hint:this.tipAbout,enableToggle:!0,disabled:!0,toggleGroup:"leftMenuGroup"}),this.btnSupport=new Common.UI.Button({action:"support",el:t.elementById("#left-btn-support"),hint:this.tipSupport,disabled:!0}),this.btnComments=new Common.UI.Button({el:t.elementById("#left-btn-comments"),hint:this.tipComments+Common.Utils.String.platformKey("Ctrl+Shift+H"),enableToggle:!0,disabled:!0,toggleGroup:"leftMenuGroup"}),this.btnChat=new Common.UI.Button({el:t.elementById("#left-btn-chat"),hint:this.tipChat+Common.Utils.String.platformKey("Alt+Q"),enableToggle:!0,disabled:!0,toggleGroup:"leftMenuGroup"}),this.btnComments.hide(),this.btnChat.hide(),this.btnComments.on("click",this.onBtnMenuClick.bind(this)),this.btnComments.on("toggle",this.onBtnCommentsToggle.bind(this)),this.btnChat.on("click",this.onBtnMenuClick.bind(this)),this.btnPlugins=new Common.UI.Button({el:t.elementById("#left-btn-plugins"),hint:this.tipPlugins,enableToggle:!0,disabled:!0,toggleGroup:"leftMenuGroup"}),this.btnPlugins.hide(),this.btnPlugins.on("click",this.onBtnMenuClick.bind(this)),this.btnNavigation=new Common.UI.Button({el:t.elementById("#left-btn-navigation"),hint:this.tipNavigation,enableToggle:!0,disabled:!0,toggleGroup:"leftMenuGroup"}),this.btnNavigation.on("click",this.onBtnMenuClick.bind(this)),this.btnSearch.on("click",this.onBtnMenuClick.bind(this)),this.btnAbout.on("toggle",this.onBtnMenuToggle.bind(this)),this.menuFile=new DE.Views.FileMenu,this.btnAbout.panel=new Common.Views.About({el:"#about-menu-panel",appName:"Document Editor"}),this.$el.html(t),this},onBtnMenuToggle:function(t,e){e?(t.panel.show(),this._state.pluginIsRunning||this.$el.width(40),this.btnSearch.isActive()&&this.btnSearch.toggle(!1)):t.panel.hide(),DE.getController("Toolbar").DisableToolbar(1==e),this.supressEvents||Common.NotificationCenter.trigger("layout:changed","leftmenu")},onBtnCommentsToggle:function(t,e){e||this.fireEvent("comments:hide",this)},onBtnMenuClick:function(t,e){this.supressEvents=!0,this.btnAbout.toggle(!1),"search"==t.options.action||(t.pressed?this.$el.width()>40||this.$el.width(parseInt(Common.localStorage.getItem("de-mainmenu-width"))||300):this._state.pluginIsRunning||(Common.localStorage.setItem("de-mainmenu-width",this.$el.width()),this.$el.width(40))),this.supressEvents=!1,Common.NotificationCenter.trigger("layout:changed","leftmenu")},onCoauthOptions:function(t){this.mode.canCoAuthoring&&(this.mode.canViewComments&&(this.btnComments.pressed&&this.btnComments.$el.hasClass("notify")&&this.btnComments.$el.removeClass("notify"),this.panelComments[this.btnComments.pressed?"show":"hide"](),this.fireEvent(this.btnComments.pressed?"comments:show":"comments:hide",this)),this.mode.canChat&&(this.btnChat.pressed?(this.btnChat.$el.hasClass("notify")&&this.btnChat.$el.removeClass("notify"),this.panelChat.show(),this.panelChat.focus()):this.panelChat.hide())),this.panelNavigation&&(this.btnNavigation.pressed?this.panelNavigation.show():this.panelNavigation.hide())},setOptionsPanel:function(t,e){"chat"==t?this.panelChat=e.render("#left-panel-chat"):"comment"==t?this.panelComments=e:"history"==t?this.panelHistory=e.render("#left-panel-history"):"plugins"!=t||this.panelPlugins?"navigation"!=t||this.panelNavigation||(this.panelNavigation=e.render("#left-panel-navigation")):this.panelPlugins=e.render()},markCoauthOptions:function(t,e){"chat"!=t||!this.btnChat.isVisible()||this.btnChat.isDisabled()||this.btnChat.pressed||this.btnChat.$el.addClass("notify"),"comments"!=t||!this.btnComments.isVisible()||this.btnComments.pressed||this.btnComments.isDisabled()&&!e||this.btnComments.$el.addClass("notify")},close:function(t){this.menuFile.isVisible()?this.menuFile.hide():(this.btnAbout.toggle(!1),this._state.pluginIsRunning||this.$el.width(40),this.mode.canCoAuthoring&&(this.mode.canViewComments&&(this.panelComments.hide(),this.btnComments.pressed&&this.fireEvent("comments:hide",this),this.btnComments.toggle(!1,!0)),this.mode.canChat&&(this.panelChat.hide(),this.btnChat.toggle(!1))),this.mode.canPlugins&&this.panelPlugins&&!this._state.pluginIsRunning&&(this.panelPlugins.hide(),this.btnPlugins.toggle(!1,!0)),this.panelNavigation&&(this.panelNavigation.hide(),this.btnNavigation.toggle(!1,!0)))},isOpened:function(){var t=this.btnSearch.pressed;return!t&&(t=this.btnComments.pressed||this.btnChat.pressed),t},disableMenu:function(t,e){this.btnSearch.setDisabled(!1),this.btnAbout.setDisabled(!1),this.btnSupport.setDisabled(!1),this.btnComments.setDisabled(!1),this.btnChat.setDisabled(!1),this.btnPlugins.setDisabled(!1),this.btnNavigation.setDisabled(!1)},showMenu:function(t,e){var i=/^(\w+):?(\w*)$/.exec(t);"file"==i[1]?(this.menuFile.isVisible(),this.menuFile.show(i[2].length?i[2]:void 0,e)):"chat"==t?!this.btnChat.isVisible()||this.btnChat.isDisabled()||this.btnChat.pressed||(this.btnChat.toggle(!0),this.onBtnMenuClick(this.btnChat),this.onCoauthOptions(),this.panelChat.focus()):"comments"==t&&(!this.btnComments.isVisible()||this.btnComments.isDisabled()||this.btnComments.pressed||(this.btnComments.toggle(!0),this.onBtnMenuClick(this.btnComments),this.onCoauthOptions()))},getMenu:function(t){switch(t){default:return null;case"file":return this.menuFile;case"about":return this.btnAbout.panel}},setMode:function(t){return this.mode=t,this.btnAbout.panel.setMode(t),this},showHistory:function(){this._state.pluginIsRunning=!1,this.panelHistory.show(),this.panelHistory.$el.width((parseInt(Common.localStorage.getItem("de-mainmenu-width"))||300)-40),Common.NotificationCenter.trigger("layout:changed","history")},setDeveloperMode:function(t,n,o){if(this.$el.is(":visible")){if((t&Asc.c_oLicenseMode.Trial||t&Asc.c_oLicenseMode.Developer)&&!this.developerHint){var s="";t&Asc.c_oLicenseMode.Trial&&t&Asc.c_oLicenseMode.Developer?s=this.txtTrialDev:0!=(t&Asc.c_oLicenseMode.Trial)?s=this.txtTrial:0!=(t&Asc.c_oLicenseMode.Developer)&&(s=this.txtDeveloper),s=s.toUpperCase(),this.developerHint=e('<div id="developer-hint">'+s+"</div>").appendTo(this.$el),this.devHeight=this.developerHint.outerHeight(),!this.devHintInited&&e(window).on("resize",i.bind(this.onWindowResize,this)),this.devHintInited=!0}
if(this.developerHint&&this.developerHint.toggleClass("hidden",!(t&Asc.c_oLicenseMode.Trial||t&Asc.c_oLicenseMode.Developer)),n&&!this.betaHint){var a=t?'style="margin-top: 4px;"':"",r=(o||"").split("."),l="";r.length>0&&(l+="v. "+r[0]),r.length>1&&(l+="."+r[1]),this.betaHint=e('<div id="beta-hint"'+a+">"+l+" (beta)</div>").appendTo(this.$el),this.betaHeight=this.betaHint.outerHeight(),!this.devHintInited&&e(window).on("resize",i.bind(this.onWindowResize,this)),this.devHintInited=!0}this.betaHint&&this.betaHint.toggleClass("hidden",!n);var c=this.$el.find("button.btn-category:visible"),d=c.length>0?e(c[c.length-1]):null;this.minDevPosition=d?d.offset().top-d.offsetParent().offset().top+d.height()+20:20,this.onWindowResize()}},setLimitMode:function(){if(this.$el.is(":visible")){if(!this.limitHint){var t=this.txtLimit.toUpperCase();this.limitHint=e('<div id="limit-hint" style="margin-top: 4px;">'+t+"</div>").appendTo(this.$el),this.limitHeight=this.limitHint.outerHeight(),!this.devHintInited&&e(window).on("resize",i.bind(this.onWindowResize,this)),this.devHintInited=!0}this.limitHint&&this.limitHint.toggleClass("hidden",!1);var n=this.$el.find("button.btn-category:visible"),o=n.length>0?e(n[n.length-1]):null;this.minDevPosition=o?o.offset().top-o.offsetParent().offset().top+o.height()+20:20,this.onWindowResize()}},onWindowResize:function(){var t=(this.devHeight||0)+(this.betaHeight||0)+(this.limitHeight||0),e=Math.max((this.$el.height()-t)/2,this.minDevPosition);this.developerHint&&(this.developerHint.css("top",e),e+=this.devHeight),this.betaHint&&(this.betaHint.css("top",e),e+=this.betaHeight+4),this.limitHint&&this.limitHint.css("top",e)},tipComments:"Comments",tipChat:"Chat",tipAbout:"About",tipSupport:"Feedback & Support",tipSearch:"Search",tipPlugins:"Plugins",txtDeveloper:"DEVELOPER MODE",txtTrial:"TRIAL MODE",txtTrialDev:"Trial Developer Mode",tipNavigation:"Navigation",txtLimit:"Limit Access"},DE.Views.LeftMenu||{}))}),define("documenteditor/main/app/controller/Viewport",["core","common/main/lib/view/Header","documenteditor/main/app/view/Viewport","documenteditor/main/app/view/LeftMenu"],function(t){"use strict";DE.Controllers.Viewport=Backbone.Controller.extend(_.assign({models:[],collections:[],views:["Viewport","Common.Views.Header"],initialize:function(){var t=this;this.addListeners({FileMenu:{"menu:hide":t.onFileMenu.bind(t,"hide"),"menu:show":t.onFileMenu.bind(t,"show")},Toolbar:{"render:before":function(e){var i=DE.getController("Main").appOptions;e.setExtra("right",t.header.getPanel("right",i)),(!i.isEdit||i.customization&&i.customization.compactHeader)&&e.setExtra("left",t.header.getPanel("left",i))},"view:compact":function(e,i){t.header.mnuitemCompactToolbar.setChecked(i,!0),t.viewport.vlayout.getItem("toolbar").height=i?Common.Utils.InternalSettings.get("toolbar-height-compact"):Common.Utils.InternalSettings.get("toolbar-height-normal")},"undo:disabled":function(e){t.header.btnUndo&&(t.header.btnUndo.keepState?t.header.btnUndo.keepState.disabled=e:t.header.btnUndo.setDisabled(e))},"redo:disabled":function(e){t.header.btnRedo&&(t.header.btnRedo.keepState?t.header.btnRedo.keepState.disabled=e:t.header.btnRedo.setDisabled(e))},"print:disabled":function(e){t.header.btnPrint&&t.header.btnPrint.setDisabled(e)},"save:disabled":function(e){t.header.btnSave&&t.header.btnSave.setDisabled(e)}}})},setApi:function(t){this.api=t,this.api.asc_registerCallback("asc_onZoomChange",this.onApiZoomChange.bind(this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",this.onApiCoAuthoringDisconnect.bind(this)),Common.NotificationCenter.on("api:disconnect",this.onApiCoAuthoringDisconnect.bind(this))},getApi:function(){return this.api},onLaunch:function(){this.viewport=this.createView("Viewport").render(),this.api=new Asc.asc_docs_api({"id-view":"editor_sdk",translate:this.getApplication().getController("Main").translationTable}),this.header=this.createView("Common.Views.Header",{headerCaption:"Document Editor",storeUsers:DE.getCollection("Common.Collections.Users")}),Common.NotificationCenter.on("layout:changed",_.bind(this.onLayoutChanged,this)),$(window).on("resize",_.bind(this.onWindowResize,this));var t=$("#left-menu"),e=$("#left-panel-history");this.viewport.hlayout.on("layout:resizedrag",function(){this.api.Resize(),Common.localStorage.setItem("de-mainmenu-width",e.is(":visible")?e.width()+SCALE_MIN:t.width())},this),this.boxSdk=$("#editor_sdk"),this.boxSdk.css("border-left","none"),this.header.mnuitemFitPage=this.header.fakeMenuItem(),this.header.mnuitemFitWidth=this.header.fakeMenuItem(),Common.NotificationCenter.on("app:face",this.onAppShowed.bind(this)),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},onAppShowed:function(t){var e=this;e.appConfig=t;var i=Common.Utils.InternalSettings,n=$(".toolbar-fullview-panel");if(n.css("top",i.get("toolbar-height-tabs")),e.viewport.$el.attr("applang",e.appConfig.lang.split(/[\-_]/)[0]),!(t.isEdit||t.isRestrictedEdit&&t.canFillForms&&t.canFeatureForms)||!Common.localStorage.itemExists("de-compact-toolbar")&&t.customization&&t.customization.compactToolbar){var o=e.viewport.vlayout.getItem("toolbar");o&&(o.height=i.get("toolbar-height-tabs"))}if(t.customization&&(t.customization.toolbarNoTabs&&e.viewport.vlayout.getItem("toolbar").el.addClass("style-off-tabs"),t.customization.toolbarHideFileName&&e.viewport.vlayout.getItem("toolbar").el.addClass("style-skip-docname")),t.isEdit&&(!t.customization||!t.customization.compactHeader)){var s=e.viewport.vlayout.getItem("title").el;s.html(e.header.getPanel("title",t)).show(),s.find(".extra").html(e.header.getPanel("left",t));var a=e.viewport.vlayout.getItem("toolbar");a.el.addClass("top-title"),a.height-=i.get("toolbar-height-tabs")-i.get("toolbar-height-tabs-top-title");var r=i.get("toolbar-height-tabs-top-title");i.set("toolbar-height-tabs",r),i.set("toolbar-height-compact",r),i.set("toolbar-height-normal",r+i.get("toolbar-height-controls")),n.css("top",r+i.get("document-title-height")),a=e.getApplication().getController("Toolbar").getView(),a.btnCollabChanges=e.header.btnSave}},onAppReady:function(t){var e=this;if(e.header.btnOptions){var i=!(t.isEdit||t.isRestrictedEdit&&t.canFillForms&&t.canFeatureForms);(t.isEdit||t.isRestrictedEdit&&t.canFillForms&&t.canFeatureForms)&&(Common.localStorage.itemExists("de-compact-toolbar")?i=Common.localStorage.getBool("de-compact-toolbar"):t.customization&&t.customization.compactToolbar&&(i=!0)),e.header.mnuitemCompactToolbar=new Common.UI.MenuItem({caption:e.header.textCompactView,checked:i,checkable:!0,value:"toolbar"}),t.isEdit||(e.header.mnuitemCompactToolbar.hide(),Common.NotificationCenter.on("tab:visible",_.bind(function(t,i){"plugins"!=t&&"review"!=t&&"forms"!=t||!i||e.header.mnuitemCompactToolbar.show()},this)));var n=new Common.UI.MenuItem({caption:e.header.textHideStatusBar,checked:Common.localStorage.getBool("de-hidden-status"),checkable:!0,value:"statusbar"});t.canBrandingExt&&t.customization&&!1===t.customization.statusBar&&n.hide();var o=new Common.UI.MenuItem({caption:e.header.textHideLines,checked:Common.Utils.InternalSettings.get("de-hidden-rulers"),checkable:!0,value:"rulers"});t.isEdit||o.hide(),e.header.mnuitemFitPage=new Common.UI.MenuItem({caption:e.textFitPage,checkable:!0,checked:e.header.mnuitemFitPage.isChecked(),value:"zoom:page"}),e.header.mnuitemFitWidth=new Common.UI.MenuItem({caption:e.textFitWidth,checkable:!0,checked:e.header.mnuitemFitWidth.isChecked(),value:"zoom:width"}),e.header.mnuZoom=new Common.UI.MenuItem({template:_.template(['<div id="hdr-menu-zoom" class="menu-zoom" style="height: 25px;" ',"<% if(!_.isUndefined(options.stopPropagation)) { %>",'data-stopPropagation="true"',"<% } %>",">",'<label class="title">'+e.header.textZoom+"</label>",'<button id="hdr-menu-zoom-in" type="button" style="float:right; margin: 2px 5px 0 0;" class="btn small btn-toolbar"><i class="icon toolbar__icon btn-zoomup">&nbsp;</i></button>','<label class="zoom"><%= options.value %>%</label>','<button id="hdr-menu-zoom-out" type="button" style="float:right; margin-top: 2px;" class="btn small btn-toolbar"><i class="icon toolbar__icon btn-zoomdown">&nbsp;</i></button>',"</div>"].join("")),stopPropagation:!0,value:e.header.mnuZoom.options.value}),e.header.btnOptions.setMenu(new Common.UI.Menu({cls:"pull-right",style:"min-width: 180px;",items:[e.header.mnuitemCompactToolbar,n,o,{caption:"--"},e.header.mnuitemFitPage,e.header.mnuitemFitWidth,e.header.mnuZoom,{caption:"--"},new Common.UI.MenuItem({caption:e.header.textAdvSettings,value:"advanced"})]}));var s=function(t){"up"==t?e.api.zoomIn():e.api.zoomOut(),Common.NotificationCenter.trigger("edit:complete",e.header)};new Common.UI.Button({el:$("#hdr-menu-zoom-out",e.header.mnuZoom.$el),cls:"btn-toolbar"}).on("click",s.bind(e,"down")),new Common.UI.Button({el:$("#hdr-menu-zoom-in",e.header.mnuZoom.$el),cls:"btn-toolbar"}).on("click",s.bind(e,"up")),e.header.btnOptions.menu.on("item:click",e.onOptionsItemClick.bind(this))}},onLayoutChanged:function(t){switch(t){default:this.viewport.vlayout.doLayout();case"rightmenu":this.viewport.hlayout.doLayout();break;case"history":var e=this.viewport.hlayout.items[1];e.resize.el&&(this.boxSdk.css("border-left",""),e.resize.el.show()),this.viewport.hlayout.doLayout();break;case"leftmenu":var e=this.viewport.hlayout.items[0];e.resize.el&&(e.el.width()>40?(this.boxSdk.css("border-left",""),e.resize.el.show()):(e.resize.el.hide(),this.boxSdk.css("border-left","0 none"))),this.viewport.hlayout.doLayout();break;case"header":case"toolbar":case"status":this.viewport.vlayout.doLayout()}this.api.Resize()},onWindowResize:function(t){this.onLayoutChanged("window"),Common.NotificationCenter.trigger("window:resize")},onFileMenu:function(t){var e=this,i="show"==t;e.header.lockHeaderBtns("undo",i),e.header.lockHeaderBtns("redo",i),e.header.lockHeaderBtns("opts",i),e.header.lockHeaderBtns("users",i)},onApiZoomChange:function(t,e){this.header.mnuitemFitPage.setChecked(2==e,!0),this.header.mnuitemFitWidth.setChecked(1==e,!0),this.header.mnuZoom.options.value=t,this.header.mnuZoom.$el&&$(".menu-zoom label.zoom",this.header.mnuZoom.$el).html(t+"%")},onOptionsItemClick:function(t,e,i){var n=this;switch(e.value){case"toolbar":n.header.fireEvent("toolbar:setcompact",[t,e.isChecked()]);break;case"statusbar":n.header.fireEvent("statusbar:hide",[e,e.isChecked()]);break;case"rulers":n.api.asc_SetViewRulers(!e.isChecked()),Common.localStorage.setBool("de-hidden-rulers",e.isChecked()),Common.Utils.InternalSettings.set("de-hidden-rulers",e.isChecked()),Common.NotificationCenter.trigger("layout:changed","rulers"),Common.NotificationCenter.trigger("edit:complete",n.header);break;case"zoom:page":e.isChecked()?n.api.zoomFitToPage():n.api.zoomCustomMode(),Common.NotificationCenter.trigger("edit:complete",n.header);break;case"zoom:width":e.isChecked()?n.api.zoomFitToWidth():n.api.zoomCustomMode(),Common.NotificationCenter.trigger("edit:complete",n.header);break;case"advanced":n.header.fireEvent("file:settings",n.header)}},onApiCoAuthoringDisconnect:function(t){this.header&&(this.header.btnDownload&&!t&&this.header.btnDownload.hide(),this.header.btnPrint&&!t&&this.header.btnPrint.hide(),this.header.btnEdit&&this.header.btnEdit.hide(),this.header.lockHeaderBtns("rename-user",!0))},SetDisabled:function(t){this.header&&this.header.lockHeaderBtns("rename-user",t)},textFitPage:"Fit to Page",textFitWidth:"Fit to Width"},DE.Controllers.Viewport))}),$(document).off("keydown.bs.dropdown.data-api").on("keydown.bs.dropdown.data-api","[data-toggle=dropdown], [role=menu]",onDropDownKeyDown),"ontouchstart"in document.documentElement&&$(document).on("click.bs.dropdown.data-api","[data-toggle=dropdown]",toggle),function(){function t(t){1!=t.which&&void 0!=t.which||clearMenus(/form-control/.test(t.target.className))}var e,i=$._data($(document).get(0),"events");i&&i.click&&i.click.every(function(t,i,n){return/click/.test(t.type)&&!t.selector&&/bs\..+\.dropdown/.test(t.namespace)&&(e=t.handler),!e}),e&&$(document).off("click.bs.dropdown.data-api",e).on("click.bs.dropdown.data-api",t)}(),define("common/main/lib/extend/Bootstrap",function(){}),void 0===Common)var Common={};if(define("common/main/lib/component/MenuItem",["common/main/lib/component/BaseView","common/main/lib/component/ToggleManager"],function(){"use strict";Common.UI.MenuItem=Common.UI.BaseView.extend({options:{id:null,cls:"",style:"",hint:!1,checkable:!1,checked:!1,allowDepress:!1,disabled:!1,value:null,toggleGroup:null,iconCls:"",menu:null,canFocused:!0},tagName:"li",template:_.template(['<a id="<%= id %>" class="<%= cls %>" style="<%= style %>" <% if(options.canFocused) { %> tabindex="-1" type="menuitem" <% }; if(!_.isUndefined(options.stopPropagation)) { %> data-stopPropagation="true" <% }; %> >',"<% if (!_.isEmpty(iconCls)) { %>",'<span class="menu-item-icon <%= iconCls %>"></span>',"<% } %>","<%= caption %>","</a>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=e.options.id||Common.UI.getId(),this.cls=e.options.cls,this.style=e.options.style,this.caption=e.options.caption,this.menu=e.options.menu||null,this.checkable=e.options.checkable,this.checked=e.options.checked,e.allowDepress=e.options.allowDepress,this.disabled=e.options.disabled,this.value=e.options.value,this.toggleGroup=e.options.toggleGroup,this.template=e.options.template||this.template,this.iconCls=e.options.iconCls,this.hint=e.options.hint,this.rendered=!1,null===this.menu||this.menu instanceof Common.UI.Menu||this.menu instanceof Common.UI.MenuSimple||(this.menu=new Common.UI.Menu(_.extend({},e.options.menu))),e.options.el&&this.render()},render:function(){var t=this,e=t.$el||$(this.el);if(t.trigger("render:before",t),"--"===t.caption)e.addClass("divider");else if(!this.rendered){e.off("click"),Common.UI.ToggleManager.unregister(t),e.html(this.template({id:t.id,cls:t.cls,caption:t.caption,iconCls:t.iconCls,style:t.style,options:t.options})),t.menu&&(e.addClass("dropdown-submenu"),t.menu.render(e),e.mouseenter(_.bind(t.menu.alignPosition,t.menu)),e.focusout(_.bind(t.onBlurItem,t)),e.hover(_.bind(t.onHoverItem,t),_.bind(t.onUnHoverItem,t)));var i=e.children(":first");this.checkable&&i&&(i.toggleClass("checkable",this.checkable),i.toggleClass("no-checkmark",!1===this.options.checkmark),i.toggleClass("checked",this.checked),_.isEmpty(this.iconCls)||i.css("background-image","none")),t.options.hint&&(e.attr("data-toggle","tooltip"),e.tooltip({title:t.options.hint,placement:t.options.hintAnchor||function(t,e){var i=this.getPosition(),n=t.offsetWidth,o=t.offsetHeight,s=Common.Utils.innerWidth(),a=Common.Utils.innerHeight(),r=i.top,l=i.left+i.width+2;r+o>a&&(r=a-o-2),l+n>s&&(l=i.left-n-2),$(t).offset({top:r,left:l}).addClass("in")}})),this.disabled&&e.toggleClass("disabled",this.disabled),e.on("click",_.bind(this.onItemClick,this)),e.on("mousedown",_.bind(this.onItemMouseDown,this)),Common.UI.ToggleManager.register(t)}return t.cmpEl=e,t.rendered=!0,t.trigger("render:after",t),this},setCaption:function(t,e){this.caption=t,this.rendered&&(this.cmpEl.find("a").contents().last()[0].textContent=e?t:Common.Utils.String.htmlEncode(t))},setIconCls:function(t){if(this.rendered&&!_.isEmpty(this.iconCls)){var e=this.cmpEl.children(":first");e&&e.find(".menu-item-icon").removeClass(this.iconCls).addClass(t)}this.iconCls=t},setChecked:function(t,e){this.toggle(t,e)},isChecked:function(){return this.checked},setDisabled:function(t){this.disabled=!!t,this.rendered&&this.cmpEl.toggleClass("disabled",this.disabled)},isDisabled:function(){return this.disabled},toggle:function(t,e){var i=void 0===t?!this.checked:!!t;if(this.checkable){if(this.checked=i,this.rendered){var n=this.cmpEl.children(":first");n&&(n.toggleClass("checked",this.checked),_.isEmpty(this.iconCls)||n.css("background-image","none"))}e||this.trigger("toggle",this,i)}},onItemMouseDown:function(t){if(1!=t.which)return t.preventDefault(),t.stopPropagation(),!1;t.stopPropagation()},onItemClick:function(t){return(1==t.which||void 0===t.which&&!this.menu)&&(this.disabled||!this.allowDepress&&this.checked&&this.toggleGroup||this.menu||this.setChecked(!this.checked),this.menu?t.target.id!=this.id&&void(this.menu.isOver||this.cmpEl.removeClass("over")):!this.disabled&&void this.trigger("click",this,t))},onHoverItem:function(t){this._doHover(t)},onUnHoverItem:function(t){this._doUnHover(t)},onBlurItem:function(t){this._doUnHover(t)},_doHover:function(t){var e=this;e.menu&&!e.disabled&&(clearTimeout(e.hideMenuTimer),e.cmpEl.trigger("show.bs.dropdown"),e.expandMenuTimer=_.delay(function(){e.cmpEl.addClass("over"),e.cmpEl.trigger("shown.bs.dropdown")},200))},_doUnHover:function(t){var e=this;if(e.cmpEl.hasClass("dropdown-submenu")&&e.cmpEl.hasClass("over")&&(t&&t.relatedTarget&&e.cmpEl.find(t.relatedTarget).length>0||e.cmpEl.hasClass("focused-submenu")))return void e.cmpEl.removeClass("focused-submenu");if(e.menu&&!e.disabled&&(clearTimeout(e.expandMenuTimer),e.hideMenuTimer=_.delay(function(){e.menu.isOver||e.cmpEl.removeClass("over")},200),t&&"focusout"!==t.type)){var i=e.cmpEl.children(":focus");i.length>0&&(i.blur(),e.cmpEl.closest("ul").focus())}}}),Common.UI.MenuItemSeparator=function(t){return t=t||{},t.caption="--",new Common.UI.MenuItem(t)}}),void 0===Common)var Common={};if(define("common/main/lib/component/Menu",["common/main/lib/extend/Bootstrap","common/main/lib/component/BaseView","common/main/lib/component/MenuItem","common/main/lib/component/Scroller"],function(){"use strict";Common.UI.Menu=function(){var t=function(){var t=[],e={};return{register:function(i){e[i.id]=i,i.on("show:after",function(e){t.push(e)}).on("hide:after",function(e){var i=t.indexOf(e);i>-1&&t.splice(i,1)})},unregister:function(i){var n=t.indexOf(i);delete e[i.id],n>-1&&t.splice(n,1),i.off("show:after").off("hide:after")},hideAll:function(){return Common.NotificationCenter.trigger("menumanager:hideall"),!!(t&&t.length>0)&&(_.each(t,function(t){t&&t.hide()}),!0)}}}();return _.extend(Common.UI.BaseView.extend({options:{cls:"",style:"",itemTemplate:null,items:[],menuAlign:"tl-bl",menuAlignEl:null,offset:[0,0],cyclic:!0,search:!1,scrollAlwaysVisible:!0},template:_.template(['<ul class="dropdown-menu <%= options.cls %>" oo_editor_input="true" style="<%= options.style %>" role="menu"></ul>'].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e);var i=this;this.id=this.options.id||Common.UI.getId(),this.itemTemplate=this.options.itemTemplate||Common.UI.MenuItem.prototype.template,this.rendered=!1,this.items=[],this.offset=[0,0],this.menuAlign=this.options.menuAlign,this.menuAlignEl=this.options.menuAlignEl,this.scrollAlwaysVisible=this.options.scrollAlwaysVisible,this.search=this.options.search,this.options.restoreHeight&&(this.options.restoreHeight="number"==typeof this.options.restoreHeight?this.options.restoreHeight:this.options.maxHeight?this.options.maxHeight:1e5,!this.options.maxHeight&&(this.options.maxHeight=this.options.restoreHeight)),this.options.cyclic||(this.options.cls+=" no-cyclic"),_.each(this.options.items,function(t){t instanceof Common.UI.MenuItem?i.items.push(t):i.items.push(new Common.UI.MenuItem(_.extend({tagName:"li",template:i.itemTemplate},t)))}),this.options.el&&this.render(),t.register(this)},remove:function(){t.unregister(this),Common.UI.BaseView.prototype.remove.call(this)},render:function(t){var e=this;this.trigger("render:before",this),this.cmpEl=e.$el||$(this.el),t?(this.setElement(t,!1),e.rendered||(this.cmpEl=$(this.template({options:e.options})),t.append(this.cmpEl))):e.rendered||(this.cmpEl=this.template({options:e.options}),this.$el.append(this.cmpEl));var i=this.cmpEl.parent(),n="menu"===i.attr("role")?i:i.find("[role=menu]");return this.menuRoot=n,n&&(e.rendered||_.each(e.items||[],function(t){n.append(t.render().el),t.on("click",_.bind(e.onItemClick,e)),t.on("toggle",_.bind(e.onItemToggle,e))}),this.options.maxHeight&&(n.css({"max-height":e.options.maxHeight}),this.scroller=new Common.UI.Scroller({el:e.$el.find(".dropdown-menu "),minScrollbarLength:30,suppressScrollX:!0,alwaysVisibleY:this.scrollAlwaysVisible})),n.css({position:"fixed",right:"auto",left:-1e3,top:-1e3}),this.parentEl=n.parent(),this.parentEl.on("show.bs.dropdown",_.bind(e.onBeforeShowMenu,e)),this.parentEl.on("shown.bs.dropdown",_.bind(e.onAfterShowMenu,e)),this.parentEl.on("hide.bs.dropdown",_.bind(e.onBeforeHideMenu,e)),this.parentEl.on("hidden.bs.dropdown",_.bind(e.onAfterHideMenu,e)),this.parentEl.on("keydown.after.bs.dropdown",_.bind(e.onAfterKeydownMenu,e)),n.hover(function(t){e.isOver=!0},function(t){e.isOver=!1})),this.rendered=!0,this.trigger("render:after",this),this},isVisible:function(){return this.rendered&&this.cmpEl.is(":visible")},show:function(){this.rendered&&this.parentEl&&!this.parentEl.hasClass("open")&&this.cmpEl.dropdown("toggle")},hide:function(){this.rendered&&this.parentEl&&(this.parentEl.hasClass("open")?this.cmpEl.dropdown("toggle"):this.parentEl.hasClass("over")&&this.parentEl.removeClass("over"))},insertItem:function(t,e){var i=this;this.cmpEl;if(e instanceof Common.UI.MenuItem||(e=new Common.UI.MenuItem(_.extend({tagName:"li",template:i.itemTemplate},e))),t<0||t>=i.items.length?i.items.push(e):i.items.splice(t,0,e),this.rendered){var n=this.menuRoot;n&&(t<0?n.append(e.render().el):0===t?n.prepend(e.render().el):n.children("li:nth-child("+(t+1)+")").before(e.render().el),e.on("click",_.bind(i.onItemClick,i)),e.on("toggle",_.bind(i.onItemToggle,i)))}},addItem:function(t){this.insertItem(-1,t)},removeItem:function(t){var e=this,i=e.items.indexOf(t);i>-1&&(e.items.splice(i,1),t.off("click").off("toggle"),t.remove())},removeItems:function(t,e){if(!(t>this.items.length-1)){t+e>this.items.length&&(e=this.items.length-t);for(var i=t;i<t+e;i++)this.items[i].off("click").off("toggle"),this.items[i].remove();this.items.splice(t,e)}},removeAll:function(){var t=this;_.each(t.items,function(t){t.off("click").off("toggle"),t.remove()}),t.items=[]},onBeforeShowMenu:function(t){Common.NotificationCenter.trigger("menu:show"),this.trigger("show:before",this,t),this.alignPosition()},onAfterShowMenu:function(t){if(this.trigger("show:after",this,t),this.scroller){var e=this.menuRoot;if(void 0===this.wheelSpeed){var i=e.find("> li:first"),n=i.length?i.outerHeight():1;this.wheelSpeed=Math.min(Math.floor(e.height()/n)*n/10,20)}this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible,wheelSpeed:this.wheelSpeed});var o=e.find("> li .checked");if(o.length){var s=o.position().top,n=o.outerHeight(),a=e.outerHeight();if(s<0||s+n>a){var r=e.scrollTop()+s+(n-a)/2;r=Math.floor(r/n)*n,e.scrollTop(r)}setTimeout(function(){o.focus()},1)}}this._search={}},onBeforeHideMenu:function(t){this.trigger("hide:before",this,t),Common.UI.Scroller.isMouseCapture()&&t.preventDefault()},onAfterHideMenu:function(t,e){this.trigger("hide:after",this,t,e),Common.NotificationCenter.trigger("menu:hide",this,e)},onAfterKeydownMenu:function(t){if(this.trigger("keydown:before",this,t),!t.isDefaultPrevented())if(t.keyCode==Common.UI.Keys.RETURN){var e=$(t.target).closest("li");if(e.length<=0&&(e=$(t.target).parent().find("li .dataview")),e.length>0&&e.click(),e.hasClass("dropdown-submenu")||Common.UI.Menu.Manager.hideAll(),$(t.currentTarget).closest("li").hasClass("dropdown-submenu"))return t.stopPropagation(),!1}else if(t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN)this.fromKeyDown=!0;else if(t.keyCode==Common.UI.Keys.ESC);else if(this.search&&t.keyCode>64&&t.keyCode<91&&t.key){var i=this;if(clearTimeout(this._search.timer),this._search.timer=setTimeout(function(){i._search={}},1e3),!this._search.text&&(this._search.text=""),!this._search.char&&(this._search.char=t.key),this._search.char!==t.key&&(this._search.full=!0),this._search.text+=t.key,void 0===this._search.index){var n=this.menuRoot.find("> li").find("> a");this._search.index=n.index(n.filter(":focus"))}this.selectCandidate()}},selectCandidate:function(){for(var t,e,i=this._search.index||0,n=new RegExp("^"+(this._search.full?this._search.text:this._search.char),"i"),o=0;o<this.items.length;o++){var s=this.items[o];if(n.test(s.caption)&&(t||(t=s,e=o),this._search.full&&o==i||o>i)){t=s,e=o;break}}if(t){this._search.index=e;var s=t.cmpEl.find("a");if(this.scroller){this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible,wheelSpeed:this.wheelSpeed});var a=s.position().top,r=s.outerHeight(),l=this.menuRoot.outerHeight();if(a<0||a+r>l){var c=this.menuRoot.scrollTop()+a;c=Math.floor(c/r)*r,this.menuRoot.scrollTop(c)}}s.focus()}},onItemClick:function(t,e){if(t.menu||(this.isOver=!1),t.options.stopPropagation){e.stopPropagation();var i=this;return void _.delay(function(){i.$el.parent().parent().find("[data-toggle=dropdown]").focus()},10)}this.trigger("item:click",this,t,e)},onItemToggle:function(t,e,i){this.trigger("item:toggle",this,t,e,i)},setOffset:function(t,e){this.offset[0]=_.isUndefined(t)?this.offset[0]:t,this.offset[1]=_.isUndefined(e)?this.offset[1]:e,this.alignPosition()},getOffset:function(){return this.offset},alignPosition:function(t,e){var i=this.menuRoot,n=this.menuAlignEl||i.parent(),o=this.menuAlign.match(/^([a-z]+)-([a-z]+)/),s=n.offset(),a=Common.Utils.innerWidth()-10,r=Common.Utils.innerHeight()-10,l=i.outerWidth(),c=i.outerHeight(),d=n.outerWidth(),h=n.outerHeight(),p={tl:[0,0],bl:[0,c],tr:[l,0],br:[l,c]},m={tl:[0,0],tr:[d,0],bl:[0,h],br:[d,h]},u=s.left-p[o[1]][0]+m[o[2]][0]+this.offset[0],g=s.top-p[o[1]][1]+m[o[2]][1]+this.offset[1];if(u+l>a&&(u=n.is("li.dropdown-submenu")?s.left-l+2:a-l),u<0&&(u=0),this.options.restoreHeight)"number"==typeof this.options.restoreHeight&&(g+c>r?(i.css("max-height",r-g+"px"),!this.scroller&&(this.scroller=new Common.UI.Scroller({el:this.$el.find(".dropdown-menu "),minScrollbarLength:30,suppressScrollX:!0,alwaysVisibleY:this.scrollAlwaysVisible})),this.wheelSpeed=void 0):g+c<r&&i.height()<this.options.restoreHeight&&(i.css("max-height",Math.min(r-g,this.options.restoreHeight)+"px"),this.wheelSpeed=void 0));else{var b=Common.Utils.croppedGeometry();r=b.height-10,g+c>r+b.top&&(t&&"string"==typeof t?(o=t.match(/^([a-z]+)-([a-z]+)/),g=s.top-p[o[1]][1]+m[o[2]][1]+this.offset[1]+(e||0)):g=r-c),g<b.top&&(g=b.top)}if(this.options.additionalAlign)this.options.additionalAlign.call(this,i,u,g);else{var f={left:u,top:g};c<r||(f["margin-top"]=0),i.css(f)}},clearAll:function(){_.each(this.items,function(t){t.setChecked&&t.setChecked(!1,!0)})}}),{Manager:function(){return t}()})}(),Common.UI.MenuSimple=Common.UI.BaseView.extend({options:{cls:"",style:"",itemTemplate:null,items:[],menuAlign:"tl-bl",menuAlignEl:null,offset:[0,0],cyclic:!0,search:!1,scrollAlwaysVisible:!0},template:_.template(['<ul class="dropdown-menu <%= options.cls %>" oo_editor_input="true" style="<%= options.style %>" role="menu">',"<% _.each(items, function(item) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>","<% item.checked = item.checked || false;  %>","<li><%= itemTemplate(item) %></li>","<% }) %>","</ul>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);this.id=this.options.id||Common.UI.getId(),this.itemTemplate=this.options.itemTemplate||_.template(['<a id="<%= id %>" <% if(typeof style !== "undefined") { %> style="<%= style %>" <% } %>','<% if(typeof canFocused !== "undefined") { %> tabindex="-1" type="menuitem" <% } %>','<% if(typeof stopPropagation !== "undefined") { %> data-stopPropagation="true" <% } %>','class="<% if (checked) { %> checked <% } %>" >','<% if (typeof iconCls !== "undefined") { %>','<span class="menu-item-icon <%= iconCls %>"></span>',"<% } %>","<%= caption %>","</a>"].join("")),this.rendered=!1,this.items=this.options.items||[],this.offset=[0,0],this.menuAlign=this.options.menuAlign,this.menuAlignEl=this.options.menuAlignEl,this.scrollAlwaysVisible=this.options.scrollAlwaysVisible,this.search=this.options.search,this.options.restoreHeight&&(this.options.restoreHeight="number"==typeof this.options.restoreHeight?this.options.restoreHeight:this.options.maxHeight?this.options.maxHeight:1e5,!this.options.maxHeight&&(this.options.maxHeight=this.options.restoreHeight)),this.options.cyclic||(this.options.cls+=" no-cyclic"),this.options.el&&this.render(),Common.UI.Menu.Manager.register(this)},remove:function(){Common.UI.Menu.Manager.unregister(this),Common.UI.BaseView.prototype.remove.call(this)},render:function(t){var e=this;this.trigger("render:before",this),this.cmpEl=e.$el||$(this.el),t&&this.setElement(t,!1),e.rendered||(this.cmpEl=$(this.template({items:e.items,itemTemplate:e.itemTemplate,options:e.options})),t?t.append(this.cmpEl):this.$el.append(this.cmpEl));var i=this.cmpEl.parent(),n="menu"===i.attr("role")?i:i.find("[role=menu]");return this.menuRoot=n,n&&(e.rendered||(n.on("click","li",_.bind(e.onItemClick,e)),n.on("mousedown","li",_.bind(e.onItemMouseDown,e))),this.options.maxHeight&&(n.css({"max-height":e.options.maxHeight}),this.scroller=new Common.UI.Scroller({el:e.$el.find(".dropdown-menu "),minScrollbarLength:30,suppressScrollX:!0,alwaysVisibleY:this.scrollAlwaysVisible})),n.css({position:"fixed",right:"auto",left:-1e3,top:-1e3}),this.parentEl=n.parent(),this.parentEl.on("show.bs.dropdown",_.bind(e.onBeforeShowMenu,e)),this.parentEl.on("shown.bs.dropdown",_.bind(e.onAfterShowMenu,e)),this.parentEl.on("hide.bs.dropdown",_.bind(e.onBeforeHideMenu,e)),this.parentEl.on("hidden.bs.dropdown",_.bind(e.onAfterHideMenu,e)),this.parentEl.on("keydown.after.bs.dropdown",_.bind(e.onAfterKeydownMenu,e)),n.hover(function(t){e.isOver=!0},function(t){e.isOver=!1})),this.rendered=!0,this.trigger("render:after",this),this},resetItems:function(t){this.items=t||[],this.$items=null;var e=_.template(["<% _.each(items, function(item) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>","<% item.checked = item.checked || false;  %>","<li><%= itemTemplate(item) %></li>","<% }) %>"].join(""));this.cmpEl&&this.cmpEl.html(e({items:this.items,itemTemplate:this.itemTemplate,options:this.options}))},isVisible:function(){return this.rendered&&this.cmpEl.is(":visible")},show:function(){this.rendered&&this.parentEl&&!this.parentEl.hasClass("open")&&this.cmpEl.dropdown("toggle")},hide:function(){this.rendered&&this.parentEl&&(this.parentEl.hasClass("open")?this.cmpEl.dropdown("toggle"):this.parentEl.hasClass("over")&&this.parentEl.removeClass("over"))},onItemClick:function(t){if(1!=t.which&&void 0!==t.which)return!1;var e=$(t.currentTarget).closest("li").index(),i=e>=0?this.items[e]:null;if(i){if(i.disabled)return!1;if(i.checkable&&!i.checked&&this.setChecked(e,!i.checked),this.isOver=!1,i.stopPropagation){t.stopPropagation();var n=this;return void _.delay(function(){n.$el.parent().parent().find("[data-toggle=dropdown]").focus()},10)}this.trigger("item:click",this,i,t)}},onItemMouseDown:function(t){if(1!=t.which)return t.preventDefault(),t.stopPropagation(),!1;t.stopPropagation()},setChecked:function(t,e,i){this.toggle(t,e,i)},toggle:function(t,e,i){var n=!!e,o=this.items[t];if(this.clearAll(),o&&o.checkable){if(o.checked=n,this.rendered){var s=o.el||this.cmpEl.find("#"+o.id);s&&(s.toggleClass("checked",o.checked),_.isEmpty(o.iconCls)||s.css("background-image","none"))}i||this.trigger("item:toggle",this,o,n)}},setDisabled:function(t){this.disabled=!!t,this.rendered&&this.cmpEl.toggleClass("disabled",this.disabled)},isDisabled:function(){return this.disabled},onBeforeShowMenu:function(t){Common.NotificationCenter.trigger("menu:show"),this.trigger("show:before",this,t),this.alignPosition()},onAfterShowMenu:function(t){if(this.trigger("show:after",this,t),this.scroller){this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible});var e=this.menuRoot,i=e.find("> li .checked");if(i.length){var n=i.position().top,o=i.outerHeight(),s=e.outerHeight();if(n<0||n+o>s){var a=e.scrollTop()+n+(o-s)/2;a=Math.floor(a/o)*o,e.scrollTop(a)}setTimeout(function(){i.focus()},1)}}if(this._search={},this.search&&!this.$items){var r=this
;this.$items=this.menuRoot.find("> li").find("> a"),_.each(this.$items,function(t,e){r.items[e].el=$(t)})}},onBeforeHideMenu:function(t){this.trigger("hide:before",this,t),Common.UI.Scroller.isMouseCapture()&&t.preventDefault()},onAfterHideMenu:function(t,e){this.trigger("hide:after",this,t,e),Common.NotificationCenter.trigger("menu:hide",this,e)},onAfterKeydownMenu:function(t){if(t.keyCode==Common.UI.Keys.RETURN){var e=$(t.target).closest("li");if(e.length<=0&&(e=$(t.target).parent().find("li .dataview")),e.length>0&&e.click(),e.hasClass("dropdown-submenu")||Common.UI.Menu.Manager.hideAll(),$(t.currentTarget).closest("li").hasClass("dropdown-submenu"))return t.stopPropagation(),!1}else if(t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN)this.fromKeyDown=!0;else if(t.keyCode==Common.UI.Keys.ESC);else if(this.search&&t.keyCode>64&&t.keyCode<91&&t.key){var i=this;clearTimeout(this._search.timer),this._search.timer=setTimeout(function(){i._search={}},1e3),!this._search.text&&(this._search.text=""),!this._search.char&&(this._search.char=t.key),this._search.char!==t.key&&(this._search.full=!0),this._search.text+=t.key,void 0===this._search.index&&(this._search.index=this.$items.index(this.$items.filter(":focus"))),this.selectCandidate()}},selectCandidate:function(){for(var t,e,i=this._search.index||0,n=new RegExp("^"+(this._search.full?this._search.text:this._search.char),"i"),o=0;o<this.items.length;o++){var s=this.items[o];if(n.test(s.caption)&&(t||(t=s,e=o),this._search.full&&o==i||o>i)){t=s,e=o;break}}if(t){this._search.index=e;var s=t.el;if(this.scroller){this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible});var a=s.position().top,r=s.outerHeight(),l=this.menuRoot.outerHeight();if(a<0||a+r>l){var c=this.menuRoot.scrollTop()+a;c=Math.floor(c/r)*r,this.menuRoot.scrollTop(c)}}s.focus()}},setOffset:function(t,e){this.offset[0]=_.isUndefined(t)?this.offset[0]:t,this.offset[1]=_.isUndefined(e)?this.offset[1]:e,this.alignPosition()},getOffset:function(){return this.offset},alignPosition:function(t,e){var i=this.menuRoot,n=this.menuAlignEl||i.parent(),o=this.menuAlign.match(/^([a-z]+)-([a-z]+)/),s=n.offset(),a=Common.Utils.innerWidth(),r=Common.Utils.innerHeight()-10,l=i.outerWidth(),c=i.outerHeight(),d=n.outerWidth(),h=n.outerHeight(),p={tl:[0,0],bl:[0,c],tr:[l,0],br:[l,c]},m={tl:[0,0],tr:[d,0],bl:[0,h],br:[d,h]},u=s.left-p[o[1]][0]+m[o[2]][0]+this.offset[0],g=s.top-p[o[1]][1]+m[o[2]][1]+this.offset[1];u+l>a&&(u=n.is("li.dropdown-submenu")?s.left-l+2:a-l),this.options.restoreHeight?"number"==typeof this.options.restoreHeight&&(g+c>r?(i.css("max-height",r-g+"px"),!this.scroller&&(this.scroller=new Common.UI.Scroller({el:this.$el.find(".dropdown-menu "),minScrollbarLength:30,suppressScrollX:!0,alwaysVisibleY:this.scrollAlwaysVisible}))):g+c<r&&i.height()<this.options.restoreHeight&&i.css("max-height",Math.min(r-g,this.options.restoreHeight)+"px")):(g+c>r&&(t&&"string"==typeof t?(o=t.match(/^([a-z]+)-([a-z]+)/),g=s.top-p[o[1]][1]+m[o[2]][1]+this.offset[1]+(e||0)):g=r-c),g<0&&(g=0)),this.options.additionalAlign?this.options.additionalAlign.call(this,i,u,g):i.css({left:Math.ceil(u),top:Math.ceil(g)})},clearAll:function(){this.cmpEl&&this.cmpEl.find("li > a.checked").removeClass("checked"),_.each(this.items,function(t){t.checked=!1})}})}),void 0===Common)var Common={};if(define("common/main/lib/component/Calendar",["common/main/lib/component/BaseView","common/main/lib/util/utils"],function(){"use strict";Common.UI.Calendar=Common.UI.BaseView.extend(_.extend({template:_.template(['<div id="calendar" class="calendar-box">','<div class="calendar-header">','<div class="top-row">','<div id="prev-arrow"><button type="button"><i class="arrow-prev img-commonctrl"></i></button></div>','<div class="title"></div>','<div id="next-arrow"><button type="button"><i class="arrow-next img-commonctrl" /></button></div>',"</div>",'<div class="bottom-row"></div>',"</div>",'<div class="calendar-content"></div>',"</div>"].join("")),options:{date:void 0,firstday:0},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.monthNames=[this.textJanuary,this.textFebruary,this.textMarch,this.textApril,this.textMay,this.textJune,this.textJuly,this.textAugust,this.textSeptember,this.textOctober,this.textNovember,this.textDecember],this.dayNamesShort=[this.textShortSunday,this.textShortMonday,this.textShortTuesday,this.textShortWednesday,this.textShortThursday,this.textShortFriday,this.textShortSaturday],this.monthShortNames=[this.textShortJanuary,this.textShortFebruary,this.textShortMarch,this.textShortApril,this.textShortMay,this.textShortJune,this.textShortJuly,this.textShortAugust,this.textShortSeptember,this.textShortOctober,this.textShortNovember,this.textShortDecember],e.options.date=t.date,_.isUndefined(t.firstday)||0!==t.firstday&&1!==t.firstday||(e.options.firstday=t.firstday),e.enableKeyEvents=e.options.enableKeyEvents,e._state=void 0,e.render()},render:function(){var t=this;return t.cmpEl=t.$el||$(this.el),t.cmpEl.html(this.template()),t.currentDate=t.options.date||new Date,t.btnPrev=new Common.UI.Button({parentEl:t.cmpEl.find("#prev-arrow"),cls:"",iconCls:"arrow-prev img-commonctrl"}),t.btnPrev.on("click",_.bind(t.onClickPrev,t)),t.btnNext=new Common.UI.Button({parentEl:t.cmpEl.find("#next-arrow"),cls:"",iconCls:"arrow-next img-commonctrl"}),t.btnNext.on("click",_.bind(t.onClickNext,t)),t.cmpEl.on("keydown",function(e){t.trigger("calendar:keydown",t,e)}),t.renderMonth(t.currentDate),this.trigger("render:after",this),this},onClickPrev:function(){var t=this;if(0===t._state){var e=new Date(t.currentDate);e.setMonth(e.getMonth()-1),e.getFullYear()>0&&t.renderMonth(e)}else if(1===t._state){var e=new Date(t.currentDate);e.setFullYear(e.getFullYear()-1),e.getFullYear()>0&&t.renderMonths(e)}else if(2===t._state){var i,n=t.currentDate.getFullYear();n%10!=0?(i=String(n),i=Number(i.slice(0,-1)+"0")-1):i=n-1,i>0&&(t.currentDate.setFullYear(i),t.renderYears(i))}},onClickNext:function(){var t=this;if(0===t._state){var e=new Date(t.currentDate);e.setMonth(e.getMonth()+1),e.getFullYear()>0&&t.renderMonth(e)}else if(1===t._state){var e=new Date(t.currentDate);e.setFullYear(e.getFullYear()+1),e.getFullYear()>0&&t.renderMonths(e)}else if(2===t._state){var i,n=t.currentDate.getFullYear();n%10!=9?(i=String(n),i=Number(i.slice(0,-1)+"9")+1):i=n+1,i>0&&(t.currentDate.setFullYear(i),t.renderYears(i))}},renderYears:function(t){var e=this,t=_.isNumber(t)?t:e.currentDate?e.currentDate.getFullYear():(new Date).getFullYear();e._state=2,e.$el.removeClass("view-days view-months").addClass("view-years");var i=t,n=t;if(i%10!=0){var o=String(t);i=Number(o.slice(0,-1)+"0")}if(n%10!=9){var o=String(t);n=Number(o.slice(0,-1)+"9")}e.topTitle=_.template(["<label>"+i+"-"+n+"</label>"].join("")),e.cmpEl.find(".calendar-header .title").html(e.topTitle),e.bottomTitle=_.template(["<label>"+e.textYears+"</label>"].join("")),e.cmpEl.find(".calendar-header .bottom-row").html(e.bottomTitle);for(var s=[],a=i-3,r=0;r<16;r++)s.push({year:a>0?a:"",isCurrentDecade:a>=i&&a<=n,disabled:!(a>0),selected:_.isDate(e.selectedDate)?a===e.selectedDate.getFullYear():a===(new Date).getFullYear()}),a++;e.yearPicker?e.yearPicker.store.reset(s):(e.yearPicker=new Common.UI.DataView({el:e.cmpEl.find(".calendar-content"),store:new Common.UI.DataViewStore(s),itemTemplate:_.template('<div class="name-year <% if (!isCurrentDecade) { %> no-current-decade <% } %>" data-year="<%= year %>"><%= year %></div>')}),e.yearPicker.on("item:click",function(t,i,n,o){var s=n.get("year"),a=new Date;a.setFullYear(s),e.renderMonths(a)}),e.enableKeyEvents&&this.yearPicker.on("item:keydown",function(t,e,i){i.keyCode==Common.UI.Keys.ESC&&Common.NotificationCenter.trigger("dataview:blur")})),e.enableKeyEvents&&_.delay(function(){e.monthPicker.focus()},10)},renderMonths:function(t){var e=this,i=_.isDate(t)?t:e.currentDate?e.currentDate:new Date,n=i.getFullYear();e._state=1,e.currentDate=i,e.$el.removeClass("view-years view-days").addClass("view-months"),e.topTitle=_.template(['<div class="button"><label>'+n+"</label></div>"].join("")),e.cmpEl.find(".calendar-header .title").html(e.topTitle),e.cmpEl.find(".calendar-header .title").off(),e.cmpEl.find(".calendar-header .title").on("click",_.bind(e.renderYears,e)),e.bottomTitle=_.template(["<label>"+e.textMonths+"</label>"].join("")),e.cmpEl.find(".calendar-header .bottom-row").html(e.bottomTitle);for(var o=[],s=new Date,a=0;a<12;a++)o.push({indexMonth:a,nameMonth:e.monthShortNames[a],year:n,curYear:!0,isCurrentMonth:a===i.getMonth(),selected:_.isDate(e.selectedDate)?a===e.selectedDate.getMonth()&&n===e.selectedDate.getFullYear():a===s.getMonth()&&n===s.getFullYear()});n+=1;for(var a=0;a<4;a++)o.push({indexMonth:a,nameMonth:e.monthShortNames[a],year:n,curYear:!1,selected:_.isDate(e.selectedDate)?a===e.selectedDate.getMonth()&&n===e.selectedDate.getFullYear():a===s.getMonth()&&n===s.getFullYear()});e.monthsPicker?e.monthsPicker.store.reset(o):(e.monthsPicker=new Common.UI.DataView({el:e.cmpEl.find(".calendar-content"),store:new Common.UI.DataViewStore(o),itemTemplate:_.template('<div class="name-month <% if (!curYear) { %> no-cur-year <% } %>" data-month="<%= indexMonth %>" data-year="<%= year %>"><%= nameMonth %></div>')}),e.monthsPicker.on("item:click",function(t,i,n,o){var s=n.get("indexMonth"),a=n.get("year"),r=new Date;r.setFullYear(a,s),e.renderMonth(r)}),e.enableKeyEvents&&this.monthsPicker.on("item:keydown",function(t,e,i){i.keyCode==Common.UI.Keys.ESC&&Common.NotificationCenter.trigger("dataview:blur")})),e.enableKeyEvents&&_.delay(function(){e.monthPicker.focus()},10)},renderMonth:function(t){var e=this;e._state=0;var i=e.options.firstday,n=t||new Date,o=n.getMonth(),s=(n.getDay(),n.getDate(),n.getFullYear());e.currentDate=n,e.$el.removeClass("view-years view-months").addClass("view-days"),e.topTitle=_.template(['<div class="button">',"<label>"+e.monthNames[o]+" "+s+"</label>","</div>"].join("")),e.cmpEl.find(".calendar-header .title").html(e.topTitle),e.cmpEl.find(".calendar-header .title").off(),e.cmpEl.find(".calendar-header .title").on("click",_.bind(e.renderMonths,e));for(var a="",r=i;r<7;r++)a+="<label>"+e.dayNamesShort[r]+"</label>";i>0&&(a+="<label>"+e.dayNamesShort[0]+"</label>"),e.cmpEl.find(".calendar-header .bottom-row").html(_.template(a));var l=[],c=new Date(n);c.setDate(1);var d,h,p,m=c.getDay(),u=e.daysInMonth(c.getTime()-864e6);d=0===i?m>0?u-(m-1):1:0===m?u-5:u-(m-2),m>0&&0===i||1===i?o-1>=0?(h=o-1,p=s):(h=11,p=s-1):(h=o,p=s);var g=new Date;g.setFullYear(p,h,d);for(var b=new Date,f=0;f<6;f++)for(var C=0;C<7;C++){var v=g.getDay(),y=g.getDate(),x=g.getMonth(),w=g.getFullYear();l.push({indexInWeek:v,dayNumber:y,month:x,year:w,isCurrentMonth:x===o,selected:_.isDate(e.selectedDate)?y===e.selectedDate.getDate()&&x===e.selectedDate.getMonth()&&w===e.selectedDate.getFullYear():y===b.getDate()&&x===b.getMonth()&&w===b.getFullYear()}),g.setDate(y+1)}e.monthPicker?e.monthPicker.store.reset(l):(e.monthPicker=new Common.UI.DataView({el:e.cmpEl.find(".calendar-content"),store:new Common.UI.DataViewStore(l),itemTemplate:_.template('<div class="number-day<% if (indexInWeek === 6 || indexInWeek === 0) { %> weekend<% } %><% if (!isCurrentMonth) { %> no-current-month<% } %>" data-number="<%= dayNumber %>" data-month="<%= month %>" data-year="<%= year %>"><%= dayNumber %></div>')}),e.monthPicker.on("item:click",function(t,i,n,o){var s=n.get("dayNumber"),a=n.get("month"),r=n.get("year");_.isUndefined(e.selectedDate)&&(e.selectedDate=new Date),e.selectedDate.setFullYear(r,a,s),e.trigger("date:click",e,e.selectedDate)}),e.enableKeyEvents&&this.monthPicker.on("item:keydown",function(t,e,i){i.keyCode==Common.UI.Keys.ESC&&Common.NotificationCenter.trigger("dataview:blur")})),e.enableKeyEvents&&_.delay(function(){e.monthPicker.focus()},10)},daysInMonth:function(t){var e;e=t?new Date(t):new Date;var i=new Date;return i.setFullYear(e.getFullYear(),e.getMonth()+1,0),i.getDate()},setDate:function(t){_.isDate(t)&&(this.selectedDate=new Date(t),this.renderMonth(this.selectedDate))},textJanuary:"January",textFebruary:"February",textMarch:"March",textApril:"April",textMay:"May",textJune:"June",textJuly:"July",textAugust:"August",textSeptember:"September",textOctober:"October",textNovember:"November",textDecember:"December",textShortJanuary:"Jan",textShortFebruary:"Feb",textShortMarch:"Mar",textShortApril:"Apr",textShortMay:"May",textShortJune:"Jun",textShortJuly:"Jul",textShortAugust:"Aug",textShortSeptember:"Sep",textShortOctober:"Oct",textShortNovember:"Nov",textShortDecember:"Dec",textShortSunday:"Su",textShortMonday:"Mo",textShortTuesday:"Tu",textShortWednesday:"We",textShortThursday:"Th",textShortFriday:"Fr",textShortSaturday:"Sa",textMonths:"Months",textYears:"Years"},Common.UI.Calendar||{}))}),void 0===Common)var Common={};if(define("common/main/lib/view/InsertTableDialog",["common/main/lib/component/Window"],function(){"use strict";Common.Views.InsertTableDialog=Common.UI.Window.extend(_.extend({options:{width:230,height:156,style:"min-width: 230px;",cls:"modal-dlg",split:!1,buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:t.split?this.txtTitleSplit:this.txtTitle},t||{}),this.template=['<div class="box">','<div class="input-row">','<label class="text columns-text" style="width: 130px;">'+this.txtColumns+'</label><div class="columns-val" style="float: right;"></div>',"</div>",'<div class="input-row" style="margin-top: 10px;">','<label class="text rows-text" style="width: 130px;">'+this.txtRows+'</label><div class="rows-val" style="float: right;"></div>',"</div>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this.getChild();t.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.udColumns=new Common.UI.MetricSpinner({el:t.find(".columns-val"),step:1,width:64,value:2,defaultUnit:"",maxValue:63,minValue:1,allowDecimal:!1}),this.udRows=new Common.UI.MetricSpinner({el:t.find(".rows-val"),step:1,width:64,value:2,defaultUnit:"",maxValue:100,minValue:1,allowDecimal:!1})},getFocusedComponents:function(){return[this.udColumns,this.udRows]},getDefaultFocusableComponent:function(){return this.udColumns},onBtnClick:function(t){this.options.handler&&this.options.handler.call(this,t.currentTarget.attributes.result.value,{columns:this.udColumns.getNumberValue(),rows:this.udRows.getNumberValue()}),this.close()},onPrimary:function(){return this.options.handler&&this.options.handler.call(this,"ok",{columns:this.udColumns.getNumberValue(),rows:this.udRows.getNumberValue()}),this.close(),!1},txtTitle:"Table Size",txtTitleSplit:"Split Cell",txtColumns:"Number of Columns",txtRows:"Number of Rows",textInvalidRowsCols:"You need to specify valid rows and columns count.",txtMinText:"The minimum value for this field is {0}",txtMaxText:"The maximum value for this field is {0}"},Common.Views.InsertTableDialog||{}))}),void 0===Common)var Common={};if(define("common/main/lib/view/CopyWarningDialog",["common/main/lib/component/Window"],function(){"use strict";Common.Views.CopyWarningDialog=Common.UI.Window.extend(_.extend({options:{width:500,height:325,cls:"modal-dlg copy-warning",buttons:["ok"]},initialize:function(t){_.extend(this.options,{title:this.textTitle,buttons:["ok"]},t||{}),this.template=['<div class="box">','<p class="message">'+this.textMsg+"</p>",'<div class="hotkeys">',"<div>",'<p class="hotkey">'+Common.Utils.String.platformKey("Ctrl+C","{0}")+"</p>",'<p class="message">'+this.textToCopy+"</p>","</div>","<div>",'<p class="hotkey">'+Common.Utils.String.platformKey("Ctrl+X","{0}")+"</p>",'<p class="message">'+this.textToCut+"</p>","</div>","<div>",'<p class="hotkey">'+Common.Utils.String.platformKey("Ctrl+V","{0}")+"</p>",'<p class="message">'+this.textToPaste+"</p>","</div>","</div>",'<div id="copy-warning-checkbox" style="margin-top: 20px; text-align: left;"></div>',"</div>",'<div class="separator horizontal"></div>'].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.chDontShow=new Common.UI.CheckBox({el:$("#copy-warning-checkbox"),labelText:this.textDontShow}),this.getChild().find(".btn").on("click",_.bind(this.onBtnClick,this)),this.autoSize()},autoSize:function(){var t=this.getChild(".box"),e=this.getChild(".footer"),i=this.getChild(".header"),n=this.getChild(".body");n.height(parseInt(t.height())+parseInt(e.css("height"))),this.setHeight(parseInt(n.css("height"))+parseInt(i.css("height")))},onBtnClick:function(t){this.options.handler&&this.options.handler.call(this,"checked"==this.chDontShow.getValue()),this.close()},onKeyPress:function(t){t.keyCode==Common.UI.Keys.RETURN&&(this.options.handler&&this.options.handler.call(this,"checked"==this.chDontShow.getValue()),this.close())},getSettings:function(){return"checked"==this.chDontShow.getValue()},textTitle:"Copy, Cut and Paste Actions",textMsg:"Copy, cut and paste actions using the editor toolbar buttons and context menu actions will be performed within this editor tab only.<br><br>.To copy or paste to or from applications outside the editor tab use the following keyboard combinations:",textToCopy:"for Copy",textToPaste:"for Paste",textToCut:"for Cut",textDontShow:"Don't show this message again"},Common.Views.CopyWarningDialog||{}))}),void 0===Common)var Common={};if(define("common/main/lib/component/RadioBox",["common/main/lib/component/BaseView","underscore"],function(t,e){"use strict";Common.UI.RadioBox=Common.UI.BaseView.extend({options:{labelText:""},disabled:!1,rendered:!1,template:e.template('<label class="radiobox"><input type="radio" name="<%= name %>" id="<%= id %>" class="button__radiobox"><label for="<%= id %>" class="radiobox__shape"></label><span></span></label>'),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);this.name=this.options.name||Common.UI.getId(),this.render(),this.options.disabled&&this.setDisabled(this.options.disabled),void 0!==this.options.checked&&this.setValue(this.options.checked,!0),this.setCaption(this.options.labelText),this.$radio.on("click",e.bind(this.onItemCheck,this))},render:function(){var t=this.$el||$(this.el);return t.html(this.template({labelText:this.options.labelText,name:this.name,id:Common.UI.getId("rdb-")})),this.$radio=t.find("input[type=radio]"),this.$label=t.find("label.radiobox"),this.$span=this.$label.find("span"),this.$label.on("keydown",this.onKeyDown.bind(this)),this.rendered=!0,this},setDisabled:function(t){this.rendered&&(t!==this.disabled&&(this.$label.toggleClass("disabled",t),this.$radio.toggleClass("disabled",t),t?this.$radio.attr({disabled:t}):this.$radio.removeAttr("disabled"),void 0!==this.tabindex&&(t&&(this.tabindex=this.$label.attr("tabindex")),this.$label.attr("tabindex",t?"-1":this.tabindex))),this.disabled=t)},isDisabled:function(){return this.disabled},onItemCheck:function(t){this.disabled||this.setValue(!0)},setRawValue:function(t){var t=!0===t||"true"===t||"1"===t||1===t;$("input[type=radio][name="+this.name+"]").removeClass("checked"),this.$radio.toggleClass("checked",t),this.$radio.prop("checked",t)},setValue:function(t,e){if(this.rendered){var i=this.$radio.hasClass("checked");this.setRawValue(t),!0!==e&&i!==t&&this.trigger("change",this,this.$radio.is(":checked"))}else this.options.checked=t},getValue:function(){return this.$radio.is(":checked")},setCaption:function(t){this.$span.text(t),this.$span.css("visibility",t?"visible":"hidden")},onKeyDown:function(t){t.isDefaultPrevented()||t.keyCode===Common.UI.Keys.SPACE&&this.onItemCheck(t)},focus:function(){this.$label&&this.$label.focus()},setTabIndex:function(t){this.rendered&&(this.tabindex=t.toString(),!this.disabled&&this.$label.attr("tabindex",this.tabindex))}})}),define("common/main/lib/view/OptionsDialog",["common/main/lib/component/Window","common/main/lib/component/RadioBox"],function(){"use strict";Common.Views.OptionsDialog=Common.UI.Window.extend(_.extend({options:{width:214,header:!0,style:"min-width: 214px;",cls:"modal-dlg",items:[],buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,t||{}),this.template=['<div class="box">','<% if (typeof label !== "undefined" && label !=="") { %>','<label style="margin-bottom: 10px;"><%= label %></label>',"<% } %>","<% _.each(items, function(item, index) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>",'<div id="<%= item.id %>" style="margin-bottom: 10px;"></div>',"<% }) %>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.radio=[],Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this,e=t.getChild(),i=this.options.items,n=!0;if(this.checkedIndex=-1,i){for(var o=0;o<i.length;o++){var s=i[o];this.radio.push(new Common.UI.RadioBox({el:e.find("#"+s.id),labelText:s.caption||"",name:"asc-radio-opt-dlg",value:s.value,disabled:!!s.disabled,checked:n&&!s.disabled}).on("change",function(e,i,n){i&&(t.currentCell=e.options.value)})),!n&&!s.checked||s.disabled||(n=!1,this.checkedIndex=o)}this.checkedIndex>=0&&this.radio[this.checkedIndex].setValue(!0)}e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this))},getFocusedComponents:function(){return this.radio},getDefaultFocusableComponent:function(){return this.checkedIndex>=0?this.radio[this.checkedIndex]:null},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,this,t),this.close()},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},getSettings:function(){return this.currentCell},onPrimary:function(){return this._handleInput("ok"),!1}},Common.Views.OptionsDialog||{}))}),define("text!documenteditor/main/app/template/DropcapSettingsAdvanced.template",[],function(){
return'<div id="id-adv-dropcap-frame" class="settings-panel">\n    <div class="inner-content">\n        <table cols="3" style="width: 100%">\n            <tr>\n                <td colspan="3">\n                    <label class="header  padding-small"><%= scope.textPosition %></label>\n                </td>\n            </tr>\n            <tr>\n                <td colspan="3" class="settins-cell padding-large">\n                    <span id="frame-advanced-button-none" style="margin-right:5px;"></span>\n                    <span id="frame-advanced-button-inline" style="margin-right:5px;"></span>\n                    <span id="frame-advanced-button-flow"></span>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small" colspan="3">\n                    <div class="separator horizontal"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="settins-cell padding-small" width="80">\n                    <label class="input-label"><%= scope.textWidth %></label>\n                </td>\n                <td class="settins-cell padding-small" width="130" style="padding-right: 10px;">\n                    <div id="frame-advanced-input-widthtype"></div>\n                </td>\n                <td class="settins-cell padding-small" width="95">\n                    <div id="frame-advanced-input-width"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="settins-cell padding-small" width="80">\n                    <label class="input-label"><%= scope.textHeight %></label>\n                </td>\n                <td class="settins-cell padding-small" width="130" style="padding-right: 10px;">\n                    <div id="frame-advanced-input-heighttype"></div>\n                </td>\n                <td class="settins-cell padding-small" width="95">\n                    <div id="frame-advanced-input-height"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small" colspan="3">\n                    <div class="separator horizontal"></div>\n                </td>\n            </tr>\n            <tr>\n                <td colspan="3">\n                    <label class="header"><%= scope.textHorizontal %></label>\n                </td>\n            </tr>\n            <tr>\n                <td colspan="2"></td>\n                <td class="settins-cell">\n                    <label class="input-label"><%= scope.textRelative %></label>\n                </td>\n            </tr>\n            <tr>\n                <td class="settins-cell padding-small" width="80">\n                    <label class="input-label"><%= scope.textPosition %></label>\n                </td>\n                <td class="settins-cell padding-small" width="130" style="padding-right: 10px;">\n                    <div id="frame-advanced-input-hposition"></div>\n                </td>\n                <td class="settins-cell padding-small" width="95">\n                    <div id="frame-advanced-input-hrelative"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="settins-cell padding-small" colspan="2" style="padding-right: 10px;">\n                    <label class="input-label" style="float: right;"><%= scope.textDistance %></label>\n                </td>\n                <td class="settins-cell padding-small">\n                    <div id="frame-advanced-input-hdist"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small" colspan="3">\n                    <div class="separator horizontal"></div>\n                </td>\n            </tr>\n            <tr>\n                <td colspan="3">\n                    <label class="header"><%= scope.textVertical %></label>\n                </td>\n            </tr>\n            <tr>\n                <td colspan="2"></td>\n                <td class="settins-cell">\n                    <label class="input-label"><%= scope.textRelative %></label>\n                </td>\n            </tr>\n            <tr>\n                <td class="settins-cell padding-small" width="80">\n                    <label class="input-label"><%= scope.textPosition %></label>\n                </td>\n                <td class="settins-cell padding-small" width="130" style="padding-right: 10px;">\n                    <div id="frame-advanced-input-vposition"></div>\n                </td>\n                <td class="settins-cell padding-small" width="95">\n                    <div id="frame-advanced-input-vrelative"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="settins-cell padding-small" colspan="2" style="padding-right: 10px;">\n                    <label class="input-label" style="float: right;"><%= scope.textDistance %></label>\n                </td>\n                <td class="settins-cell padding-small">\n                    <div id="frame-advanced-input-vdist"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small" colspan="3">\n                    <div id="frame-advanced-checkbox-move"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-adv-dropcap-dropcap" class="settings-panel">\n    <div class="inner-content">\n        <label class="header padding-small" style="width: 100%;"><%= scope.textPosition %></label>\n        <div class="padding-small" style="width: 100%">\n            <span id="drop-advanced-button-none" style="margin-right:5px;"></span>\n            <span id="drop-advanced-button-intext" style="margin-right:5px;"></span>\n            <span id="drop-advanced-button-inmargin" style="margin-right:5px;"></span>\n        </div>\n        <label class="header padding-small" style="width: 100%;"><%= scope.textParameters %></label>\n        <label class="input-label"><%= scope.textFont %></label>\n        <div id="drop-advanced-input-fonts" class="padding-small" style="width: 100%;"></div>\n    </div>\n    <div class="inner-content">\n        <table cols="2" style="width: 100%;">\n            <tr>\n                <td width="50%">\n                    <label class="input-label"><%= scope.textRowHeight %></label>\n                    <div id="drop-advanced-input-rowheight"></div>\n                </td>\n                <td width="50%">\n                    <label class="input-label"><%= scope.textDistance %></label>\n                    <div id="drop-advanced-input-distance"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-adv-dropcap-borders" class="settings-panel">\n    <div class="inner-content">\n        <div style="width: 100%;" class="padding-small">\n            <label class="input-label" style="margin-right: 5px;"><%= scope.textBorderWidth %></label>\n            <div id="drop-advanced-input-bordersize" style="display: inline-block; vertical-align: middle; width: 93px;"></div>\n            <div style="display: inline-block; float:right;vertical-align: middle;">\n                <label class="input-label" style="margin-right: 5px;"><%= scope.textBorderColor %></label>\n                <div id="drop-advanced-button-bordercolor" style="display: inline-block;"></div>\n            </div>\n        </div>\n        <label class="input-label padding-small" style="width: 100%;"><%= scope.textBorderDesc %></label>\n        <div style="width: 100%;" class="padding-large">\n            <div id="drop-advanced-borderstyler" style="display: inline-block; vertical-align: middle; width: 200px; height: 170px;outline: 1px solid #ccc;"></div>\n            <div style="display: inline-block; float:right;vertical-align: middle; width: 80px; height: 170px; padding-top: 10px; padding-left: 4px;">\n                <div id="drop-advanced-button-borderline-00" style="display: inline-block;"></div>\n                <div id="drop-advanced-button-borderline-01" style="display: inline-block;"></div>\n                <div id="drop-advanced-button-borderline-10" style="display: inline-block;"></div>\n                <div id="drop-advanced-button-borderline-11" style="display: inline-block;"></div>\n                <div id="drop-advanced-button-borderline-20" style="display: inline-block;"></div>\n                <div id="drop-advanced-button-borderline-21" style="display: inline-block;"></div>\n                <div id="drop-advanced-button-borderline-30" style="display: inline-block;"></div>\n                <div id="drop-advanced-button-borderline-31" style="display: inline-block;"></div>\n            </div>\n        </div>\n        <div style="width: 100%;" class="padding-small">\n            <label class="input-label" style="margin-right: 5px;"><%= scope.textBackColor %></label>\n            <div id="drop-advanced-button-color" style="display: inline-block;"></div>\n        </div>\n    </div>\n</div>\n<div id="id-adv-dropcap-margins" class="settings-panel">\n    <div class="inner-content">\n        <table cols="2" style="width: 100%;">\n            <tr>\n                <td class="padding-small" width="50%">\n                    <label class="input-label"><%= scope.textTop %></label>\n                    <div id="drop-advanced-input-top"></div>\n                </td>\n                <td class="padding-small" width="50%">\n                    <label class="input-label"><%= scope.textLeft %></label>\n                    <div id="drop-advanced-input-left"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small" width="50%">\n                    <label class="input-label"><%= scope.textBottom %></label>\n                    <div id="drop-advanced-input-bottom"></div>\n                </td>\n                <td class="padding-small" width="50%">\n                    <label class="input-label"><%= scope.textRight %></label>\n                    <div id="drop-advanced-input-right"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>'}),void 0===Common)var Common={};var FONT_TYPE_RECENT=4;if(define("common/main/lib/component/ComboBoxFonts",["common/main/lib/component/ComboBox"],function(){"use strict";Common.UI.ComboBoxFonts=Common.UI.ComboBox.extend(function(){var t=Asc.FONT_THUMBNAIL_HEIGHT||28,e=document.createElement("canvas"),i=e.getContext("2d"),n=/^(zh|ja|ko)$/i.test(Common.Locale.getCurrentLanguage())?"_ea":"",o=[{ratio:1,path:"../../../../sdkjs/common/Images/fonts_thumbnail"+n+".png?"+window.CP_urlArgs,width:300,height:t},{ratio:1.25,path:"../../../../sdkjs/common/Images/fonts_thumbnail"+n+"@1.25x.png?"+window.CP_urlArgs,width:375,height:1.25*t},{ratio:1.5,path:"../../../../sdkjs/common/Images/fonts_thumbnail"+n+"@1.5x.png?"+window.CP_urlArgs,width:450,height:1.5*t},{ratio:1.75,path:"../../../../sdkjs/common/Images/fonts_thumbnail"+n+"@1.75x.png?"+window.CP_urlArgs,width:525,height:1.75*t},{ratio:2,path:"../../../../sdkjs/common/Images/fonts_thumbnail"+n+"@2x.png?"+window.CP_urlArgs,width:600,height:2*t}],s=0,a=1,r=Common.Utils.applicationPixelRatio();"object"==typeof window.AscDesktopEditor&&(o[0].path=window.AscDesktopEditor.getFontsSprite(""),o[1].path=window.AscDesktopEditor.getFontsSprite("@1.25x"),o[2].path=window.AscDesktopEditor.getFontsSprite("@1.5x"),o[3].path=window.AscDesktopEditor.getFontsSprite("@1.75x"),o[4].path=window.AscDesktopEditor.getFontsSprite("@2x"));for(var l=Math.abs(r-o[0].ratio),c=0,d=1;d<o.length;d++)(c=Math.abs(r-o[d].ratio))<l-1e-4&&(l=c,s=d);return e.height=o[s].height,e.width=o[s].width,{template:_.template(['<div class="input-group combobox fonts <%= cls %>" id="<%= id %>" style="<%= style %>">','<input type="text" class="form-control" spellcheck="false"> ','<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>','<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">','<li class="divider">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>">','<a class="font-item" tabindex="-1" type="menuitem" style="height:<%=scope.getListItemHeight()%>px;"></a>',"</li>","<% }); %>","</ul>","</div>"].join("")),initialize:function(t){Common.UI.ComboBox.prototype.initialize.call(this,_.extend(t,{displayField:"name",scroller:{wheelSpeed:20,alwaysVisibleY:!0,onChange:this.updateVisibleFontsTiles.bind(this)}})),this.recent=_.isNumber(t.recent)?t.recent:5;var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:"",Common.NotificationCenter.on("fonts:load",_.bind(this.fillFonts,this))},render:function(t){var e=null,i="";return _.isUndefined(this._input)||(e=this._input.val(),i=this._input.attr("tabindex")),Common.UI.ComboBox.prototype.render.call(this,t),this.setRawValue(e),this._input.attr("tabindex",i),this._input.on("keyup",_.bind(this.onInputKeyUp,this)),this._input.on("keydown",_.bind(this.onInputKeyDown,this)),this._input.on("focus",_.bind(function(){this.inFormControl=!0},this)),this._input.on("blur",_.bind(function(){this.inFormControl=!1},this)),this},onAfterKeydownMenu:function(t){var e=this;if(t.keyCode==Common.UI.Keys.RETURN){if($(t.target).closest("input").length){if(this.lastValue===this._input.val())return!0;this._input.trigger("change")}else $(t.target).click(),this.rendered&&(Common.Utils.isIE?this._input.trigger("change",{onkeydown:!0}):this._input.blur());return!1}if(t.keyCode==Common.UI.Keys.ESC&&this.isMenuOpen())return this._input.val(this.lastValue),setTimeout(function(){e.closeMenu(),e.onAfterHideMenu(t)},10),!1;(t.keyCode==Common.UI.Keys.HOME&&!t.shiftKey||t.keyCode==Common.UI.Keys.END&&!t.shiftKey||t.keyCode==Common.UI.Keys.BACKSPACE&&!e._input.is(":focus"))&&this.isMenuOpen()&&(e._input.focus(),setTimeout(function(){e._input[0].selectionStart=e._input[0].selectionEnd=t.keyCode==Common.UI.Keys.HOME?0:e._input[0].value.length},10)),this.updateVisibleFontsTiles()},onInputKeyUp:function(t){if(t.keyCode!=Common.UI.Keys.RETURN&&t.keyCode!==Common.UI.Keys.SHIFT&&t.keyCode!==Common.UI.Keys.CTRL&&t.keyCode!==Common.UI.Keys.ALT&&t.keyCode!==Common.UI.Keys.LEFT&&t.keyCode!==Common.UI.Keys.RIGHT&&t.keyCode!==Common.UI.Keys.HOME&&t.keyCode!==Common.UI.Keys.END&&t.keyCode!==Common.UI.Keys.ESC&&t.keyCode!==Common.UI.Keys.INSERT&&t.keyCode!==Common.UI.Keys.TAB&&(t.stopPropagation(),this.selectCandidate(t.keyCode==Common.UI.Keys.DELETE||t.keyCode==Common.UI.Keys.BACKSPACE),this._selectedItem)){var e=this;void 0===e._timerSelection&&(e._timerSelection=setInterval(function(){if(!(new Date-e._inInputKeyDown<100)&&e._selectedItem){clearInterval(e._timerSelection),e._timerSelection=void 0;var t=e._input[0],i=e._selectedItem.get(e.displayField),n=t.value;e.rendered&&(document.selection?document.selection.createRange().text=i:(t.selectionStart||"0"==t.selectionStart)&&(t.value=i,t.selectionStart=n.length,t.selectionEnd=i.length))}},10))}},onInputKeyDown:function(t){this._inInputKeyDown=new Date;var e=this;t.keyCode==Common.UI.Keys.ESC?(this._input.val(this.lastValue),setTimeout(function(){e.closeMenu(),e.onAfterHideMenu(t)},10)):t.keyCode!=Common.UI.Keys.RETURN&&t.keyCode!=Common.UI.Keys.CTRL&&t.keyCode!=Common.UI.Keys.SHIFT&&t.keyCode!=Common.UI.Keys.ALT&&t.keyCode!=Common.UI.Keys.TAB?(this.isMenuOpen()||t.ctrlKey||this.openMenu(),t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN?_.delay(function(){var i=t.keyCode==Common.UI.Keys.DOWN?e.cmpEl.find("ul li.selected").nextAll("li:not(.divider)"):e.cmpEl.find("ul li.selected").prevAll("li:not(.divider)");i=i.length>0?i.eq(0):t.keyCode==Common.UI.Keys.DOWN?e.cmpEl.find("ul li:not(.divider):first"):e.cmpEl.find("ul li:not(.divider):last"),i=i.find("a"),e._skipInputChange=!0,i.focus(),e.updateVisibleFontsTiles()},10):e._skipInputChange=!1):t.keyCode==Common.UI.Keys.RETURN&&this._input.val()===e.lastValue&&this._input.trigger("change",{reapply:!0})},onInputChanged:function(t,e){if(!e||!e.synthetic){if(this._skipInputChange)return void(this._skipInputChange=!1);if(this._isMouseDownMenu)return void(this._isMouseDownMenu=!1);var i=$(t.target).val(),n={};if(!(this.lastValue!==i||e&&e.reapply))return void(e&&e.onkeydown&&this.trigger("combo:blur",this,t));n[this.valueField]=i,n[this.displayField]=i,this.trigger("changed:before",this,n,t),t.isDefaultPrevented()||(this._selectedItem?(n[this.valueField]=this._selectedItem.get(this.displayField),this.setRawValue(n[this.valueField]),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),t),this.addItemToRecent(this._selectedItem),this.closeMenu()):(this.setRawValue(n[this.valueField]),n.isNewFont=!0,this.trigger("selected",this,n,t),this.closeMenu()),this.trigger("changed:after",this,n,t))}},getImageUri:function(t){if(t.cloneid){var n=$(this.el).find("ul > li#"+t.cloneid+" img");return null!=n?n[0].src:void 0}return i.clearRect(0,0,o[s].width,o[s].height),i.drawImage(this.spriteThumbs,0,-o[s].height*Math.floor(t.imgidx/a)),e.toDataURL()},getImageWidth:function(){return 300},getImageHeight:function(){return t},getListItemHeight:function(){return 28},loadSprite:function(t){t&&(this.spriteThumbs=new Image,this.spriteThumbs.onload=t,this.spriteThumbs.src=o[s].path)},fillFonts:function(t,e){var i=this;this.loadSprite(function(){if(a=Math.floor(i.spriteThumbs.width/o[s].width)||1,i.store.set(t.toJSON()),i.rendered=!1,_.isUndefined(i.scroller)||(i.scroller.destroy(),delete i.scroller),i._scrollerIsInited=!1,i.render($(i.el)),i._fontsArray=i.store.toJSON(),i.recent>0){i.store.on("add",i.onInsertItem,i),i.store.on("remove",i.onRemoveItem,i),Common.Utils.InternalSettings.set(i.appPrefix+"-settings-recent-fonts",Common.localStorage.getItem(i.appPrefix+"-settings-recent-fonts"));var e=Common.Utils.InternalSettings.get(i.appPrefix+"-settings-recent-fonts");e=e?e.split(";"):[],e.reverse().forEach(function(t){t&&i.addItemToRecent(i.store.findWhere({name:t}),!0)})}})},onApiChangeFont:function(t){var e=this,i=_.isFunction(t.get_Name)?t.get_Name():t.asc_getFontName();this.__name!==i&&(this.__name=i,this.__nameId||(this.__nameId=setTimeout(function(){e.onApiChangeFontInternal(e.__name),e.__nameId=null},100)))},onApiChangeFontInternal:function(t){if(!this.inFormControl&&this.getRawValue()!==t){var e=this.store.findWhere({name:t});if($(".selected",$(this.el)).removeClass("selected"),e){this.setRawValue(e.get(this.displayField));var i=$("#"+e.get("id"),$(this.el)),n=$("ul.dropdown-menu",this.cmpEl);i&&n&&(i.addClass("selected"),this.recent<=0&&n.scrollTop(i.offset().top-n.offset().top))}else this.setRawValue(t)}},itemClicked:function(t){this.__name=void 0,this.__nameId&&(clearTimeout(this.__nameId),this.__nameId=void 0),Common.UI.ComboBox.prototype.itemClicked.apply(this,arguments);var e=$(t.target).closest("li"),i=this.store.findWhere({id:e.attr("id")});this.addItemToRecent(i)},onInsertItem:function(t){$(this.el).find("ul").prepend(_.template(['<li id="<%= item.id %>">','<a class="font-item" tabindex="-1" type="menuitem" style="height:<%=scope.getListItemHeight()%>px;"></a>',"</li>"].join(""))({item:t.attributes,scope:this}))},onRemoveItem:function(t,e,i){$(this.el).find("ul > li#"+t.id).remove()},onBeforeShowMenu:function(t){if(this.store.length<1)return void t.preventDefault();if(Common.UI.ComboBox.prototype.onBeforeShowMenu.apply(this,arguments),!this.getSelectedRecord()&&this.getRawValue()){var e=this.store.where({name:this.getRawValue()});e&&e.length&&this.selectRecord(e[e.length-1])}},onAfterShowMenu:function(t){this.recent>0?(this.scroller&&!this._scrollerIsInited&&(this.scroller.update(),this._scrollerIsInited=!0),$(this.el).find("ul").scrollTop(0),this.trigger("show:after",this,t),this.flushVisibleFontsTiles(),this.updateVisibleFontsTiles(null,0)):Common.UI.ComboBox.prototype.onAfterShowMenu.apply(this,arguments)},onAfterHideMenu:function(t){this.lastValue!==this._input.val()&&this._input.val(this.lastValue),Common.UI.ComboBox.prototype.onAfterHideMenu.apply(this,arguments)},addItemToRecent:function(t,e){if(t&&!(this.recent<1)){var i=this.store.findWhere({name:t.get("name"),type:FONT_TYPE_RECENT});i&&this.store.remove(i);var n=this.store.where({type:FONT_TYPE_RECENT});n.length<this.recent||this.store.remove(n[this.recent-1]);var o=t.clone();if(o.set({type:FONT_TYPE_RECENT,id:Common.UI.getId(),cloneid:t.id}),this.store.add(o,{at:0}),!e){var s=[];this.store.where({type:FONT_TYPE_RECENT}).forEach(function(t){s.push(t.get("name"))}),s=s.join(";"),Common.localStorage.setItem(this.appPrefix+"-settings-recent-fonts",s),Common.Utils.InternalSettings.set(this.appPrefix+"-settings-recent-fonts",s)}}},selectCandidate:function(t){var e=this,i=this._input.val().toLowerCase();this._fontsArray||(this._fontsArray=this.store.toJSON());var n=_.find(this._fontsArray,function(n){return t?n[e.displayField].toLowerCase()==i:0==n[e.displayField].toLowerCase().indexOf(i)});if(this._selectedItem=n?this.store.findWhere({id:n.id}):null,$(".selected",$(this.el)).removeClass("selected"),this._selectedItem){var o=$("#"+this._selectedItem.get("id"),$(this.el)),s=$("ul[role=menu]",$(this.el));if(o.length>0&&s.length>0){o.addClass("selected");var a=o.position().top,r=s.scrollTop();0!=a&&s.scrollTop(r+a)}}},updateVisibleFontsTiles:function(e,i){var n=this,r=0,l=n.store.length,c=0;if(n.tiles||(n.tiles=[]),l!==n.tiles.length)for(r=n.tiles.length;r<l;++r)n.tiles.unshift(null);_.isUndefined(i)&&(i=parseInt($(n.el).find(".ps-scrollbar-x-rail").css("bottom")));var d=$(n.el).find(".dropdown-menu").height(),h=Math.max(Math.floor(d/28)+3,0),p=Math.max(Math.floor(-i/28)-1,0),m=p+h,u=$(n.el).find("a");for(r=0;r<l;++r)if(p<=r&&r<m){if(null===n.tiles[r]){var g=document.createElement("canvas"),b=g.getContext("2d");g.height=o[s].height,g.width=o[s].width,g.style.width="300px",g.style.height=t+"px",c=Math.floor(n.store.at(r).get("imgidx")/a),b.clearRect(0,0,o[s].width,o[s].height),b.drawImage(n.spriteThumbs,0,-o[s].height*c),n.tiles[r]=g,$(u[r]).get(0).appendChild(g)}}else n.tiles[r]&&(n.tiles[r].parentNode.removeChild(n.tiles[r]),n.tiles[r]=null)},flushVisibleFontsTiles:function(){for(var t=this.tiles.length-1;t>=0;--t)this.tiles[t]&&(this.tiles[t].parentNode.removeChild(this.tiles[t]),this.tiles[t]=null)}}}())}),void 0===Common)var Common={};if(define("common/main/lib/component/MetricSpinner",["common/main/lib/component/BaseView"],function(){"use strict";Common.UI.MetricSpinner=Common.UI.BaseView.extend({options:{minValue:0,maxValue:100,step:1,defaultUnit:"px",allowAuto:!1,autoText:"Auto",hold:!0,speed:"medium",width:90,allowDecimal:!0},disabled:!1,value:"0 px",rendered:!1,template:'<input type="text" class="form-control" spellcheck="false"><div class="spinner-buttons"><button type="button" class="spinner-up"><i class="arrow"></i></button><button type="button" class="spinner-down"><i class="arrow"></i></button></div>',initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this,i=e.$el||$(this.el);i.addClass("spinner"),i.on("mousedown",".spinner-up",_.bind(this.onMouseDown,this,!0)),i.on("mousedown",".spinner-down",_.bind(this.onMouseDown,this,!1)),i.on("mouseup",".spinner-up",_.bind(this.onMouseUp,this,!0)),i.on("mouseup",".spinner-down",_.bind(this.onMouseUp,this,!1)),i.on("mouseover",".spinner-up, .spinner-down",_.bind(this.onMouseOver,this)),i.on("mouseout",".spinner-up, .spinner-down",_.bind(this.onMouseOut,this)),i.on("keydown",".form-control",_.bind(this.onKeyDown,this)),i.on("keyup",".form-control",_.bind(this.onKeyUp,this)),i.on("blur",".form-control",_.bind(this.onBlur,this)),i.on("input",".form-control",_.bind(this.onInput,this)),this.options.allowDecimal||i.on("keypress",".form-control",_.bind(this.onKeyPress,this)),i.on("focus","input.form-control",function(){setTimeout(function(){e.$input&&e.$input.select()},1)}),Common.Utils.isGecko&&i.on("blur","input.form-control",function(){setTimeout(function(){e.$input&&(e.$input[0].selectionStart=e.$input[0].selectionEnd=0)},1)}),this.switches={count:1,enabled:!0,fromKeyDown:!1},"medium"===this.options.speed?this.switches.speed=300:"fast"===this.options.speed?this.switches.speed=100:this.switches.speed=500,this.render(),this.options.disabled&&this.setDisabled(this.options.disabled),void 0!==this.options.value&&(this.value=this.options.value),this.setRawValue(this.value),this.options.width&&i.width(this.options.width),void 0===this.options.defaultValue&&(this.options.defaultValue=this.options.minValue),this.oldValue=this.options.minValue,this.lastValue=null},render:function(){var t=this.$el||$(this.el);return t.html(this.template),this.$input=t.find(".form-control"),this.rendered=!0,void 0!=this.options.tabindex&&this.$input.attr("tabindex",this.options.tabindex),this},setDisabled:function(t){var e=this.$el||$(this.el);t!==this.disabled&&(e.find("button").toggleClass("disabled",t),e.toggleClass("disabled",t),t?this.$input.attr({disabled:t}):this.$input.removeAttr("disabled")),this.disabled=t},isDisabled:function(){return this.disabled},setDefaultUnit:function(t){if(this.options.defaultUnit!=t){var e=this.options.defaultUnit;this.options.defaultUnit=t,this.setMinValue(this._recalcUnits(this.options.minValue,e)),this.setMaxValue(this._recalcUnits(this.options.maxValue,e)),this.setValue(this._recalcUnits(this.getNumberValue(),e),!0)}},setMinValue:function(t){this.options.minValue=t},setMaxValue:function(t){this.options.maxValue=t},setStep:function(t){this.options.step=t},getNumberValue:function(){return this.checkAutoText(this.value)?-1:parseFloat(this.value)},getUnitValue:function(){return this.options.defaultUnit},getValue:function(){return this.value},setRawValue:function(t){this.$input&&this.$input.val(t)},getRawValue:function(){return this.$input.val()},setValue:function(t,e){var i=!1;if(this._fromKeyDown=!1,this.lastValue=this.value,void 0===t||""===t)this.value="";else if(this.options.allowAuto&&(Math.abs(Common.Utils.String.parseFloat(t)+1)<1e-4||this.checkAutoText(t)))this.value=this.options.autoText;else{var n=this._add(Common.Utils.String.parseFloat(t),0,this.options.allowDecimal?3:0);(void 0===t||isNaN(n))&&(n=this.oldValue,i=!0);var o=this.options.defaultUnit;if(void 0!==t.match){var s=t.match(/(px|em|%|en|ex|pt|"|cm|mm|pc|s|ms|ÑÐ¼|Ð¼Ð¼|Ð¿Ñ|ÑÐµÐº|Ð¼Ñ)$/i);null!==s&&"undefined"!==s[0]&&(o=s[0].toLowerCase())}this.options.defaultUnit===o||i||(n=this._recalcUnits(n,o)),n>this.options.maxValue&&(n=this.options.maxValue,i=!0),n<this.options.minValue&&(n=this.options.minValue,i=!0),this.value=(n+" "+this.options.defaultUnit).trim(),this.oldValue=n}!0!==e&&this.lastValue!==this.value&&this.trigger("change",this,this.value,this.lastValue),!0!==e&&i&&this.trigger("inputerror",this,this.value),this.rendered?this.setRawValue(this.value):this.options.value=this.value},setMask:function(t){this.options.maskExp=t},onMouseDown:function(t,e){this.disabled||(e&&$(e.currentTarget).addClass("active"),this.options.hold&&(this.switches.fromKeyDown=!1,this._startSpin(t,e)))},onMouseUp:function(t,e){this.disabled||($(e.currentTarget).removeClass("active"),this.options.hold?this._stopSpin():this._step(t))},onMouseOver:function(t){this.disabled||$(t.currentTarget).addClass("over")},onMouseOut:function(t){this.disabled||($(t.currentTarget).removeClass("active over"),this.options.hold&&this._stopSpin())},onKeyDown:function(t){if(!this.disabled){if(!this.options.hold||t.keyCode!=Common.UI.Keys.UP&&t.keyCode!=Common.UI.Keys.DOWN)if(t.keyCode==Common.UI.Keys.RETURN)if(this.options.defaultUnit&&this.options.defaultUnit.length){var e=this.getRawValue();if(this.value!=e)return this.onEnterValue(),this.trigger("inputleave",this),this.value==e}else this.onEnterValue();else this._fromKeyDown=!0;else t.preventDefault(),t.stopPropagation(),void 0===this.switches.timeout&&(this.switches.fromKeyDown=!0,this._startSpin(t.keyCode==Common.UI.Keys.UP,t));t.keyCode==Common.UI.Keys.ESC&&this.setRawValue(this.value),t.keyCode!=Common.UI.Keys.RETURN&&t.keyCode!=Common.UI.Keys.ESC||this.trigger("inputleave",this)}},onKeyUp:function(t){this.disabled||t.keyCode!=Common.UI.Keys.UP&&t.keyCode!=Common.UI.Keys.DOWN||(t.stopPropagation(),t.preventDefault(),this.options.hold?this._stopSpin():this._step(t.keyCode==Common.UI.Keys.UP))},onKeyPress:function(t){if(!this.disabled){var e=String.fromCharCode(t.charCode);"."==e||","==e?(t.preventDefault(),t.stopPropagation()):!this.options.maskExp||this.options.maskExp.test(e)||t.ctrlKey||t.keyCode===Common.UI.Keys.RETURN||(t.preventDefault(),t.stopPropagation())}},onInput:function(t,e){this.disabled||t.isDefaultPrevented()||this.trigger("changing",this,$(t.target).val(),t)},onEnterValue:function(){if(this.$input){var t=this.getRawValue();this.setValue(""===t?this.value:t),this.trigger("entervalue",this)}},onBlur:function(t){if(this.$input){var e=this.getRawValue();this.setValue(""===e?this.value:e),this.options.hold&&this.switches.fromKeyDown&&this._stopSpin()}},_startSpin:function(t,e){if(!this.disabled){var i=this.switches.count;1===i?(this._step(t,!0),i=1):i=i<3?1.5:i<8?2.5:6,this.switches.timeout=setTimeout($.proxy(function(){this._step(t,!0),this._startSpin(t)},this),this.switches.speed/i),this.switches.count++}},_stopSpin:function(t){void 0!==this.switches.timeout&&(clearTimeout(this.switches.timeout),this.switches.timeout=void 0,this.switches.count=1,this.trigger("change",this,this.value,this.lastValue))},_increase:function(t){var e=this;if(!e.readOnly){var i=e.options.step;e._fromKeyDown?(i=this.getRawValue(),i=_.isEmpty(i)?e.oldValue:Common.Utils.String.parseFloat(i)):""!==e.getValue()?(i=e.checkAutoText(e.getValue())?e.options.defaultValue-e.options.step:Common.Utils.String.parseFloat(e.getValue()),isNaN(i)&&(i=this.oldValue)):i=e.options.defaultValue-e.options.step,e.setValue((this._add(i,e.options.step,e.options.allowDecimal?3:0)+" "+this.options.defaultUnit).trim(),t)}},_decrease:function(t){var e=this;if(!e.readOnly){var i=e.options.step;if(e._fromKeyDown)i=this.getRawValue(),i=_.isEmpty(i)?e.oldValue:Common.Utils.String.parseFloat(i);else if(""!==e.getValue()){if(i=e.checkAutoText(e.getValue())?e.options.minValue:Common.Utils.String.parseFloat(e.getValue()),isNaN(i)&&(i=this.oldValue),e.options.allowAuto&&this._add(i,-e.options.step,e.options.allowDecimal?3:0)<e.options.minValue)return void e.setValue(e.options.autoText,!0)}else i=e.options.defaultValue;e.setValue((this._add(i,-e.options.step,e.options.allowDecimal?3:0)+" "+this.options.defaultUnit).trim(),t)}},_step:function(t,e){t?this._increase(e):this._decrease(e),this.options.hold&&this.switches.fromKeyDown&&this.$input&&this.$input.select()},_add:function(t,e,i){var n=Math.pow(10,i||this.options.allowDecimal?2:0);return(Math.round(t*n)+Math.round(e*n))/n},_recalcUnits:function(t,e){if(e.match(/(s|ms|ÑÐµÐº|Ð¼Ñ)$/i)&&this.options.defaultUnit.match(/(s|ms|ÑÐµÐº|Ð¼Ñ)$/i)){var i=t;return"ms"!=e&&"Ð¼Ñ"!=e||(i=parseFloat((i/1e3).toFixed(6))),"ms"!=this.options.defaultUnit&&"Ð¼Ñ"!=this.options.defaultUnit||(i=parseFloat((1e3*i).toFixed(6))),i}if(null===e.match(/(pt|"|cm|mm|pc|ÑÐ¼|Ð¼Ð¼|Ð¿Ñ)$/i)||null===this.options.defaultUnit.match(/(pt|"|cm|mm|pc|ÑÐ¼|Ð¼Ð¼|Ð¿Ñ)$/i))return t;var i=t;return"cm"==e||"ÑÐ¼"==e?i*=10:"pt"==e||"Ð¿Ñ"==e?i=25.4*i/72:'"'==e?i*=25.4:"pc"==e&&(i=25.4*i/6),"cm"==this.options.defaultUnit||"ÑÐ¼"==this.options.defaultUnit?i=parseFloat((i/10).toFixed(6)):"pt"==this.options.defaultUnit||"Ð¿Ñ"==this.options.defaultUnit?i=parseFloat((72*i/25.4).toFixed(3)):'"'==this.options.defaultUnit?i=parseFloat((i/25.4).toFixed(3)):"pc"==this.options.defaultUnit&&(i=parseFloat((6*i/25.4).toFixed(6))),i},focus:function(){this.$input&&this.$input.focus()},setDefaultValue:function(t){this.options.defaultValue=t},checkAutoText:function(t){if(this.options.allowAuto&&"string"==typeof t){var e=t.toLowerCase();return e==this.options.autoText.toLowerCase()||"auto"==e}return!1}}),Common.UI.CustomSpinner=Common.UI.MetricSpinner.extend(_.extend({initialize:function(t){this.options.toCustomFormat=t.toCustomFormat?t.toCustomFormat:function(t){
return t},this.options.fromCustomFormat=t.fromCustomFormat?t.fromCustomFormat:function(t){return t},Common.UI.MetricSpinner.prototype.initialize.call(this,t)},setRawValue:function(t){this.$input&&this.$input.val(this.options.toCustomFormat(t))},getRawValue:function(){return this.options.fromCustomFormat(this.$input.val())}},Common.UI.CustomSpinner||{}))}),void 0===Common)var Common={};if(define("common/main/lib/component/TableStyler",["common/main/lib/component/BaseView"],function(){"use strict";Common.UI.CellStyler=Common.UI.BaseView.extend({options:{clickOffset:10,overwriteStyle:!0,maxBorderSize:6,halfBorderSize:!1,defaultBorderSize:1,defaultBorderColor:"#ccc"},template:_.template(['<div id="<%=id%>" class="tablestyler-cell" style="">','<div class="cell-content" style="">','<div class="content-text"></div>',"</div>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e,i,n=this,o=void 0,s={},a={},r={};n.id=n.options.id||Common.UI.getId(),n.clickOffset=n.options.clickOffset,n.overwriteStyle=n.options.overwriteStyle,n.maxBorderSize=n.options.maxBorderSize,n.halfBorderSize=n.options.halfBorderSize,n.defaultBorderSize=n.options.defaultBorderSize,n.defaultBorderColor=n.options.defaultBorderColor,n.col=n.options.col,n.row=n.options.row,e=n.defaultBorderSize,i=new Common.Utils.RGBColor(n.defaultBorderColor),s={top:e,right:e,bottom:e,left:e},a={top:i,right:i,bottom:i,left:i},r={top:1,right:1,bottom:1,left:1},n.rendered=!1;var l=function(){if(!_.isUndefined(o)){var t=s.left>.1&&s.left<1?1:s.left,e=Math.abs(n.halfBorderSize?.5*(t%2?t-1:t):t);t=s.right>.1&&s.right<1?1:s.right;var i=Math.abs(n.halfBorderSize?.5*(t%2?t+1:t):t);t=s.top>.1&&s.top<1?1:s.top;var l=Math.abs(n.halfBorderSize?.5*(t%2?t-1:t):t);t=s.bottom>.1&&s.bottom<1?1:s.bottom;var c=Math.abs(n.halfBorderSize?.5*(t%2?t+1:t):t),d="inset "+(e>.1&&e<1?1:e)+"px 0 0 "+a.left.toRGBA(r.left)+", inset "+-1*(i>.1&&i<1?1:i)+"px 0 0 "+a.right.toRGBA(r.right)+", inset 0 "+(l>.1&&l<1?1:l)+"px 0 "+a.top.toRGBA(r.top)+", inset 0 "+-1*(c>.1&&c<1?1:c)+"px 0 "+a.bottom.toRGBA(r.bottom);o.css("box-shadow",d)}};n.on("render:after",function(t){this.cmpEl&&(o=this.cmpEl.find(".cell-content"),l()),this.cmpEl.on("click",function(t){var o={x:t.pageX*Common.Utils.zoom()-n.cmpEl.offset().left,y:t.pageY*Common.Utils.zoom()-n.cmpEl.offset().top},c=function(t,e,i,n,o){var s,a,r=0;for(s=0,a=t-1;s<t;a=s++)(i[s]<=o&&o<i[a]||i[a]<=o&&o<i[s])&&n<(e[a]-e[s])*(o-i[s])/(i[a]-i[s])+e[s]&&(r=!r);return r},d=n.cmpEl.outerWidth(),h=n.cmpEl.outerHeight();c(4,[0,d,d-n.clickOffset,n.clickOffset],[0,0,n.clickOffset,n.clickOffset],o.x,o.y)?(n.overwriteStyle?s.top==e&&a.top.isEqual(i)?s.top=0:(s.top=e,a.top=i,r.top=e<1?.3:1):(s.top=s.top>0?0:e,a.top=i),n.fireEvent("borderclick",n,"t",s.top,a.top.toHex())):c(4,[d,d,d-n.clickOffset,d-n.clickOffset],[0,h,h-n.clickOffset,n.clickOffset],o.x,o.y)?(n.overwriteStyle?s.right==e&&a.right.isEqual(i)?s.right=0:(s.right=e,a.right=i,r.right=e<1?.3:1):(s.right=s.right>0?0:e,a.right=i),n.fireEvent("borderclick",n,"r",s.right,a.right.toHex())):c(4,[0,n.clickOffset,d-n.clickOffset,d],[h,h-n.clickOffset,h-n.clickOffset,h],o.x,o.y)?(n.overwriteStyle?s.bottom==e&&a.bottom.isEqual(i)?s.bottom=0:(s.bottom=e,a.bottom=i,r.bottom=e<1?.3:1):(s.bottom=s.bottom>0?0:e,a.bottom=i),n.fireEvent("borderclick",n,"b",s.bottom,a.bottom.toHex())):c(4,[0,n.clickOffset,n.clickOffset,0],[0,n.clickOffset,h-n.clickOffset,h],o.x,o.y)&&(n.overwriteStyle?s.left==e&&a.left.isEqual(i)?s.left=0:(s.left=e,a.left=i,r.left=e<1?.3:1):(s.left=s.left>0?0:e,a.left=i),n.fireEvent("borderclick",n,"l",s.left,a.left.toHex())),l()})}),n.setBordersSize=function(t,e){e=e>this.maxBorderSize?this.maxBorderSize:e,t.indexOf("t")>-1&&(s.top=e,r.top=e<1?.3:1),t.indexOf("r")>-1&&(s.right=e,r.right=e<1?.3:1),t.indexOf("b")>-1&&(s.bottom=e,r.bottom=e<1?.3:1),t.indexOf("l")>-1&&(s.left=e,r.left=e<1?.3:1),l()},n.setBordersColor=function(t,e){var i=new Common.Utils.RGBColor(e);t.indexOf("t")>-1&&(a.top=i),t.indexOf("r")>-1&&(a.right=i),t.indexOf("b")>-1&&(a.bottom=i),t.indexOf("l")>-1&&(a.left=i),l()},n.getBorderSize=function(t){switch(t){case"t":return s.top;case"r":return s.right;case"b":return s.bottom;case"l":return s.left}return null},n.getBorderColor=function(t){switch(t){case"t":return a.top.toHex();case"r":return a.right.toHex();case"b":return a.bottom.toHex();case"l":return a.left.toHex()}return null},n.setVirtualBorderSize=function(t){e=t>this.maxBorderSize?this.maxBorderSize:t},n.setVirtualBorderColor=function(t){var e=new Common.Utils.RGBColor(t);i.isEqual(e)||(i=e)},n.getVirtualBorderSize=function(){return e},n.getVirtualBorderColor=function(){return i.toHex()},n.options.el&&n.render()},render:function(t){var e=this;return this.trigger("render:before",this),e.rendered?this.cmpEl=this.$el:(this.cmpEl=$(this.template({id:this.id})),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl)),e.rendered=!0,this.trigger("render:after",this),this}}),Common.UI.TableStyler=Common.UI.BaseView.extend({options:{width:200,height:200,rows:2,columns:2,cellPadding:10,tablePadding:10,overwriteStyle:!0,maxBorderSize:6,spacingMode:!1,defaultBorderSize:1,defaultBorderColor:"#ccc"},template:_.template(['<div id="<%=scope.id%>" class="table-styler" style="position: relative; width: <%=scope.width%>px; height:<%=scope.height%>px;">','<div class="ts-preview-box ts-preview-box--lt" style="left: 0; top: 0; width: <%=scope.tablePadding%>px; height: <%=scope.tablePadding%>px;"></div>','<div class="ts-preview-box ts-preview-box--mt" style="left: <%=scope.tablePadding%>px; top: 0; right: <%=scope.tablePadding%>px; height: <%=scope.tablePadding%>px;">','<div id="<%=scope.id%>-table-top-border-selector" style="position: absolute; z-index: 1; height: <%=scope.tablePadding%>px; left: 0; right: 0; top:  <%=scope.tablePadding * .5%>px;">','<table width="100%" height="100%">',"<tr>",'<td id="<%=scope.id%>-table-top-border" style="height:50%; border-bottom: <%=borderSize.top%>px solid <%borderColor.top.toHex()%>;"></td>',"</tr>","<tr>","<td></td>","</tr>","</table>","</div>","</div>",'<div class="ts-preview-box ts-preview-box--rt" style="top: 0; right: 0; width: <%=scope.tablePadding%>px; height: <%=scope.tablePadding%>px;"></div>','<div class="ts-preview-box ts-preview-box--lm" style="left: 0; top: <%=scope.tablePadding%>px; width: <%=scope.tablePadding%>px; height: <%=scope.height - 2 * scope.tablePadding%>px;">','<div id="<%=scope.id%>-table-left-border-selector" style="position: absolute; z-index: 1; left: <%=scope.tablePadding * .5%>px; top: 0; bottom: 0; width: <%=scope.tablePadding%>px;">','<table width="100%" height="100%">',"<tr>",'<td id="<%=scope.id%>-table-left-border" style="border-right: <%=borderSize.left%>px solid <%=borderColor.left.toHex()%>;"></td>','<td width="50%"></td>',"</tr>","</table>","</div>","</div>",'<div class="ts-preview-box ts-preview-box--mm" style="left: <%=scope.tablePadding%>px; top: <%=scope.tablePadding%>px; right: <%=scope.tablePadding%>px; bottom: <%=scope.tablePadding%>px;">','<table id="<%=scope.id%>-table-content" cols="<%=scope.columns%>" width="100%" height="100%" style="border-collapse: inherit; border-spacing: <%= scope.spacingMode ? scope.cellPadding : 0 %>px;">',"<% for (var row = 0; row < scope.rows; row++) { %>","<tr>","<% for (var col = 0; col < scope.columns; col++) { %>",'<td id="<%=scope.id%>-cell-container-<%=col%>-<%=row%>" class="content-box"></td>',"<% } %>","</tr>","<% } %>","</table>","</div>",'<div class="ts-preview-box ts-preview-box--rm" style="right: 0; top: <%=scope.tablePadding%>px; width: <%=scope.tablePadding%>px; height: <%=scope.height - 2 * scope.tablePadding%>px;">','<div id="<%=scope.id%>-table-right-border-selector" style="position: absolute; z-index: 1; right: <%=scope.tablePadding * .5%>px; top: 0; bottom: 0; width: <%=scope.tablePadding%>px;">','<table width="100%" height="100%">',"<tr>",'<td id="<%=scope.id%>-table-right-border" style="border-right: <%=borderSize.right%>px solid <%=borderColor.right.toHex()%>;"></td>','<td width="50%"></td>',"</tr>","</table>","</div>","</div>",'<div class="ts-preview-box ts-preview-box--lb" style="left: 0; bottom: 0; width: <%=scope.tablePadding%>px; height: <%=scope.tablePadding%>px;"></div>','<div class="ts-preview-box ts-preview-box--mb" style="left: <%=scope.tablePadding%>px; bottom: 0; right: <%=scope.tablePadding%>px; height: <%=scope.tablePadding%>px;">','<div id="<%=scope.id%>-table-bottom-border-selector" style="position: absolute; z-index: 1; height: <%=scope.tablePadding%>px; left: 0; right: 0; bottom:  <%=scope.tablePadding * .5%>px;">','<table width="100%" height="100%">',"<tr>",'<td id="<%=scope.id%>-table-bottom-border" style="height:50%; border-bottom: <%=borderSize.bottom%>px solid <%=borderColor.bottom.toHex()%>;"></td>',"</tr>","<tr>","<td></td>","</tr>","</table>","</div>","</div>",'<div class="ts-preview-box ts-preview-box--rb" style="bottom: 0; right: 0; width: <%=scope.tablePadding%>px; height: <%=scope.tablePadding%>px;"></div>',"</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e,i,n,o,s,a,r,l,c,d,h,p,m=this;m.id=m.options.id||Common.UI.getId(),m.width=m.options.width,m.height=m.options.height,m.rows=m.options.rows,m.columns=m.options.columns,m.cellPadding=m.options.cellPadding,m.tablePadding=m.options.tablePadding,m.overwriteStyle=m.options.overwriteStyle,m.maxBorderSize=m.options.maxBorderSize,m.spacingMode=m.options.spacingMode,m.defaultBorderSize=m.options.defaultBorderSize,m.defaultBorderColor=m.options.defaultBorderColor,c=m.defaultBorderSize>m.maxBorderSize?m.maxBorderSize:m.defaultBorderSize,d=new Common.Utils.RGBColor(m.defaultBorderColor);var u={top:c,right:c,bottom:c,left:c},g={top:d,right:d,bottom:d,left:d};m.rendered=!1;var b=function(){e&&e.css("border-bottom",(u.top>.1&&u.top<1?1:u.top)+"px solid "+g.top.toRGBA(u.top<1?.2:1)),i&&i.css("border-right",(u.right>.1&&u.right<1?1:u.right)+"px solid "+g.right.toRGBA(u.right<1?.2:1)),n&&n.css("border-bottom",(u.bottom>.1&&u.bottom<1?1:u.bottom)+"px solid "+g.bottom.toRGBA(u.bottom<1?.2:1)),o&&o.css("border-right",(u.left>.1&&u.left<1?1:u.left)+"px solid "+g.left.toRGBA(u.left<1?.2:1)),f(s),f(a),f(r),f(l)},f=function(t){return t.hide(0,function(){$(this).show()})};m.on("render:after",function(t){var b=m.id;e=$("#"+b+"-table-top-border"),i=$("#"+b+"-table-right-border"),n=$("#"+b+"-table-bottom-border"),o=$("#"+b+"-table-left-border"),s=$("#"+b+"-table-top-border-selector"),a=$("#"+b+"-table-right-border-selector"),r=$("#"+b+"-table-bottom-border-selector"),l=$("#"+b+"-table-left-border-selector"),h=$("#"+b+"-table-content"),p=h.find(".cell-content"),h.find(".content-box").css("height",m.rows>1?"50%":"auto"),s.on("click",function(t){m.overwriteStyle?u.top==c&&g.top.isEqual(d)?u.top=0:(u.top=c,g.top=d):(u.top=u.top>0?0:c,g.top=d),e.css("border-bottom",(u.top>.1&&u.top<1?1:u.top)+"px solid "+g.top.toRGBA(u.top<1?.2:1)),f(s),m.fireEvent("borderclick",m,"t",u.top,g.top.toHex())}),a.on("click",function(t){m.overwriteStyle?u.right==c&&g.right.isEqual(d)?u.right=0:(u.right=c,g.right=d):(u.right=u.right>0?0:c,g.right=d),i.css("border-right",(u.right>.1&&u.right<1?1:u.right)+"px solid "+g.right.toRGBA(u.right<1?.2:1)),f(a),m.fireEvent("borderclick",m,"r",u.right,g.right.toHex())}),r.on("click",function(t){m.overwriteStyle?u.bottom==c&&g.bottom.isEqual(d)?u.bottom=0:(u.bottom=c,g.bottom=d):(u.bottom=u.bottom>0?0:c,g.bottom=d),n.css("border-bottom",(u.bottom>.1&&u.bottom<1?1:u.bottom)+"px solid "+g.bottom.toRGBA(u.bottom<1?.2:1)),f(r),m.fireEvent("borderclick",m,"b",u.bottom,g.bottom.toHex())}),l.on("click",function(t){m.overwriteStyle?u.left==c&&g.left.isEqual(d)?u.left=0:(u.left=c,g.left=d):(u.left=u.left>0?0:c,g.left=d),o.css("border-right",(u.left>.1&&u.left<1?1:u.left)+"px solid "+g.left.toRGBA(u.left<1?.2:1)),f(l),m.fireEvent("borderclick",m,"l",u.left,g.left.toHex())})}),m.getVirtualBorderSize=function(){return c},m.getVirtualBorderColor=function(){return d.toHex()},m.setVirtualBorderSize=function(t){t=t>m.maxBorderSize?m.maxBorderSize:t,c=t;for(var e=0;e<m.rows;e++)for(var i=0;i<m.columns;i++){var n=m.getCell(i,e);n.setVirtualBorderSize(t)}},m.setVirtualBorderColor=function(t){var e=new Common.Utils.RGBColor(t);if(!d.isEqual(e)){d=e;for(var i=0;i<m.rows;i++)for(var n=0;n<m.columns;n++){var o=m.getCell(n,i);o.setVirtualBorderColor(d.toHex())}}},m.setBordersSize=function(t,e){e=e>m.maxBorderSize?m.maxBorderSize:e,t.indexOf("t")>-1&&(u.top=e),t.indexOf("r")>-1&&(u.right=e),t.indexOf("b")>-1&&(u.bottom=e),t.indexOf("l")>-1&&(u.left=e),b()},m.setBordersColor=function(t,e){var i=new Common.Utils.RGBColor(e);t.indexOf("t")>-1&&(g.top=i),t.indexOf("r")>-1&&(g.right=i),t.indexOf("b")>-1&&(g.bottom=i),t.indexOf("l")>-1&&(g.left=i),b()},m.getBorderSize=function(t){switch(t){case"t":return u.top;case"r":return u.right;case"b":return u.bottom;case"l":return u.left}return null},m.getBorderColor=function(t){switch(t){case"t":return g.top.toHex();case"r":return g.right.toHex();case"b":return g.bottom.toHex();case"l":return g.left.toHex()}return null},m.setTableColor=function(t){h.toggleClass("transparent","transparent"==t),h.css("background-color","transparent"==t?t:"#"+t)},m.setCellsColor=function(t){!m.spacingMode&&h.toggleClass("transparent","transparent"==t),p.css("background-color","transparent"==t?t:"#"+t)},m.options.el&&m.render(null,{borderSize:u,borderColor:g,virtualBorderSize:c,virtualBorderColor:d})},render:function(t){var e=this,i=arguments[1];if(this.trigger("render:before",this),e.rendered?this.cmpEl=$(this.el):(this.cmpEl=$(this.template(_.extend({scope:e},i))),t?(this.setElement(t,!1),this.setElement(t,!1),t.html(this.cmpEl)):$(this.el).html(this.cmpEl)),!e.rendered){this.cmpEl;this._cells=[];for(var n=0;n<e.rows;n++)for(var o=0;o<e.columns;o++){var s=new Common.UI.CellStyler({el:$("#"+e.id+"-cell-container-"+o+"-"+n),overwriteStyle:e.overwriteStyle,halfBorderSize:!e.spacingMode,defaultBorderSize:e.spacingMode?i.virtualBorderSize:0,defaultBorderColor:i.virtualBorderColor.toHex(),id:e.id+"-cell-"+o+"-"+n,col:o,row:n});this._cells.push(s),s.on("borderclick",function(t,i,n,o){var s,a,r;if("t"==i){if(t.row>0)for(s=0;s<e.columns;s++)r=e.getCell(s,t.row-1),r.setBordersSize("b",n),r.setBordersColor("b",o);for(s=0;s<e.columns;s++)r=e.getCell(s,t.row),t.halfBorderSize&&t.row<1?r.setBordersSize("t",0):r.setBordersSize("t",n),r.setBordersColor("t",o)}else if("b"==i){if(t.row<e.rows-1)for(s=0;s<e.columns;s++)r=e.getCell(s,t.row+1),r.setBordersSize("t",n),r.setBordersColor("t",o);for(s=0;s<e.columns;s++)r=e.getCell(s,t.row),t.halfBorderSize&&t.row>=e.rows-1?r.setBordersSize("b",0):r.setBordersSize("b",n),r.setBordersColor("b",o)}else if("l"==i){if(t.col>0)for(a=0;a<e.rows;a++)r=e.getCell(t.col-1,a),r.setBordersSize("r",n),r.setBordersColor("r",o);for(a=0;a<e.rows;a++)r=e.getCell(t.col,a),t.halfBorderSize&&t.col<1?r.setBordersSize("l",0):r.setBordersSize("l",n),r.setBordersColor("l",o)}else if("r"==i){if(t.col<e.columns-1)for(a=0;a<e.rows;a++)r=e.getCell(t.col+1,a),r.setBordersSize("l",n),r.setBordersColor("l",o);for(a=0;a<e.rows;a++)r=e.getCell(t.col,a),t.halfBorderSize&&t.col>=e.columns-1?r.setBordersSize("r",0):r.setBordersSize("r",n),r.setBordersColor("r",o)}})}}return e.rendered=!0,this.trigger("render:after",this),this},getCell:function(t,e){return _.findWhere(this._cells,{id:this.id+"-cell-"+t+"-"+e})}})}),define("text!common/main/lib/template/ExtendedColorDialog.template",[],function(){return'<div class="color-box">\r\n    <div id="id-hsb-colorpicker" style="vertical-align:top;">\r\n    </div>\r\n    <div class="color-info" style="">\r\n        <div style="margin-left:15px;">\r\n            <label class="color-label"><%= txtNew %></label>\r\n            <div id="field-new-color" class="color-cnt top"></div>\r\n            <div id="field-start-color" class="color-cnt bottom"></div>\r\n            <label class="color-label"><%= txtCurrent %></label>\r\n        </div>\r\n        <div style="padding:13px 0 2px 0;">\r\n            <label class="input-label">R:</label>\r\n            <div id="extended-spin-r" class="color-spin"></div>\r\n        </div>\r\n        <div style="padding:2px 0;">\r\n            <label class="input-label">G:</label>\r\n            <div id="extended-spin-g" class="color-spin"></div>\r\n        </div>\r\n        <div style="padding:2px 0;">\r\n            <label class="input-label">B:</label>\r\n            <div id="extended-spin-b" class="color-spin"></div>\r\n        </div>\r\n        <div style="padding:11px 0 0 0;">\r\n            <label class="input-label" style="width:12px;">#:</label>\r\n            <input id="extended-text-color" type="text" role="textbox" style="width:62px; height: 22px;">\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="footer center">\r\n    <button class="btn normal dlg-btn primary" result="1"><%= txtAdd %></button>\r\n    <button class="btn normal dlg-btn" result="0"><%= txtCancel %></button>\r\n</div>\r\n'}),void 0===Common)var Common={};if(define("common/main/lib/component/HSBColorPicker",["common/main/lib/component/BaseView","common/main/lib/util/utils"],function(){"use strict";Common.UI.HSBColorPicker=Common.UI.BaseView.extend({template:_.template('<div class="hsb-colorpicker"><% if (this.showCurrentColor) { %><div class="top-panel"><span class="color-value"><span class="transparent-color img-colorpicker"></span></span><div class="color-text"></div></div><% } %><div><div class="cnt-hb img-colorpicker"><div class="cnt-hb-arrow img-colorpicker"></div></div><% if (this.changeSaturation) { %><div class="cnt-root"><div class="cnt-sat img-colorpicker"><div class="cnt-sat-arrow img-colorpicker"></div></div></div><% } %></div><% if (this.allowEmptyColor) { %><div class="empty-color"><%= this.textNoColor %></div><% } %></div>'),color:"#ff0000",options:{allowEmptyColor:!1,changeSaturation:!0,showCurrentColor:!0},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e,i,n,o,s,a,r,l,c=this,d=(c.$el||$(this.el),0),h=100,p=100;c.allowEmptyColor=c.options.allowEmptyColor,c.changeSaturation=c.options.changeSaturation,c.showCurrentColor=c.options.showCurrentColor;var m=function(t,e){var i=new Common.Utils.RGBColor("hsb("+t.h+","+t.s+","+t.b+")"),n=i.toHex();c.color=e?"transparent":n,u(),c.trigger("changecolor",c,c.color)},u=function(){s.length>0&&a.length>0&&("transparent"==c.color?a.show():(s.css("background-color",c.color),a.hide())),n.length>0&&n.css("background-color",new Common.Utils.RGBColor("hsb("+d+", 100, 100)").toHex()),r.length>0&&(r[0].innerHTML="transparent"==c.color?c.textNoColor:c.color.toUpperCase()),e.length>0&&i.length>0&&(e.css("left",h+"%"),e.css("top",100-p+"%"),i.css("top",parseInt(100*d/360)+"%"))},g=function(t,i,o){if(e.length>0&&n.length>0){var s=[Math.max(0,Math.min(100,parseInt((t.pageX*Common.Utils.zoom()-n.offset().left)/n.width()*100))),Math.max(0,Math.min(100,parseInt((t.pageY*Common.Utils.zoom()-n.offset().top)/n.height()*100)))];e.css("left",s[0]+"%"),e.css("top",s[1]+"%"),h=s[0],p=100-s[1],m({h:d,s:h,b:p})}},b=function(t,e,n){if(i&&o){var s=Math.max(0,Math.min(100,parseInt((t.pageY*Common.Utils.zoom()-o.offset().top)/o.height()*100)));i.css("top",s+"%"),d=parseInt(360*s/100),m({h:d,s:h,b:p})}},f=function(t,e,i){$(document).on("mouseup",C),$(document).on("mousemove",g)},C=function(t,e,i){$(document).off("mouseup",C),$(document).off("mousemove",g),g(t)},v=function(t,e,i){$(document).on("mouseup",_),$(document).on("mousemove",b),b(t)},_=function(t,e,i){$(document).off("mouseup",_),$(document).off("mousemove",b)},y=function(t){var e=new Common.util.RGBColor(c.color).toHSB();m(e,!0)},x=function(t){var m,g=$(c.el);g&&(e=g.find(".cnt-hb-arrow"),i=g.find(".cnt-sat-arrow"),n=g.find(".cnt-hb"),o=g.find(".cnt-sat"),s=g.find(".color-value"),r=g.find(".color-text"),l=g.find(".empty-color"),s.length>0&&(a=s.find(".transparent-color")),n.length>0&&(n.off("mousedown"),n.on("mousedown",f)),o.length>0&&(o.off("mousedown"),o.on("mousedown",v)),l.length>0&&(l.off("click"),l.on("click",y)),m="transparent"==c.color?{h:0,s:100,b:100}:new Common.Utils.RGBColor(c.color).toHSB(),d=m.h,h=m.s,p=m.b,d==h&&d==p&&0==d&&(h=100),u())};c.setColor=function(t){if(c.color!=t){var e;e="transparent"==t?{h:0,s:100,b:100}:new Common.Utils.RGBColor(t).toHSB(),d=e.h,h=e.s,p=e.b,d==h&&d==p&&0==d&&(h=100),c.color=t,u()}},c.getColor=function(){return c.color},c.on("render:after",x),c.render()},render:function(){return(this.$el||$(this.el)).html(this.template()),this.trigger("render:after",this),this},textNoColor:"No Color"})}),void 0===Common)var Common={};if(define("common/main/lib/component/MaskedField",["common/main/lib/component/BaseView"],function(){"use strict";Common.UI.MaskedField=Common.UI.BaseView.extend({options:{maskExp:"",maxLength:999},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this,i=e.$el||$(this.el);i.addClass("masked-field user-select"),i.attr("maxlength",e.options.maxLength),i.on("keypress",function(t){var n=String.fromCharCode(t.which);e.options.maskExp.test(n)||t.ctrlKey||(t.keyCode==Common.UI.Keys.RETURN&&e.trigger("changed",e,i.val()),t.preventDefault(),t.stopPropagation())}),i.on("input",function(t){e.trigger("change",e,i.val())}),i.on("blur",function(t){e.trigger("changed",e,i.val())})},render:function(){return this},setValue:function(t){this.options.maskExp.test(t)&&t.length<=this.options.maxLength&&this.$el.val(t)},getValue:function(){this.$el.val()}})}),void 0===Common)var Common={};if(define("common/main/lib/view/ExtendedColorDialog",["text!common/main/lib/template/ExtendedColorDialog.template","common/main/lib/component/HSBColorPicker","common/main/lib/component/MetricSpinner","common/main/lib/component/MaskedField","common/main/lib/component/Window"],function(t){"use strict";Common.UI.ExtendedColorDialog=Common.UI.Window.extend(_.extend({tpl:_.template(t),options:{},rendered:!1,initialize:function(t){Common.UI.Window.prototype.initialize.call(this,{cls:"extended-color-dlg",tpl:this.tpl({txtNew:this.textNew,txtCurrent:this.textCurrent,txtAdd:this.addButtonText,txtCancel:this.cancelButtonText}),header:!1,width:340,height:272}),this.hexRe=/\s*#?([0-9a-fA-F][0-9a-fA-F]?)([0-9a-fA-F][0-9a-fA-F]?)([0-9a-fA-F][0-9a-fA-F]?)\s*/},render:function(){function t(t){e.trigger("onmodalresult",parseInt(t.currentTarget.attributes.result.value)),e.close(!0)}var e=this;return Common.UI.Window.prototype.render.call(this),this.colorsPicker=new Common.UI.HSBColorPicker({el:$("#id-hsb-colorpicker"),showCurrentColor:!1}),this.colorsPicker.on("changecolor",_.bind(this.onChangeColor,this)),this.colorNew=$("#field-new-color"),this.colorSaved=$("#field-start-color"),this.spinR=new Common.UI.MetricSpinner({el:$("#extended-spin-r"),step:1,width:63,value:"0",defaultUnit:"",maxValue:255,minValue:0,maskExp:/[0-9]/,allowDecimal:!1}),this.spinG=new Common.UI.MetricSpinner({el:$("#extended-spin-g"),step:1,width:63,value:"0",defaultUnit:"",maxValue:255,minValue:0,maskExp:/[0-9]/,allowDecimal:!1}),this.spinB=new Common.UI.MetricSpinner({el:$("#extended-spin-b"),step:1,width:63,value:"0",defaultUnit:"",maxValue:255,minValue:0,maskExp:/[0-9]/,allowDecimal:!1}),this.textColor=new Common.UI.MaskedField({el:$("#extended-text-color"),width:55,maskExp:/[a-fA-F0-9]/,maxLength:6}),this.spinR.on("change",_.bind(this.showColor,this,null,!0)).on("changing",_.bind(this.onChangingRGB,this,1)),this.spinG.on("change",_.bind(this.showColor,this,null,!0)).on("changing",_.bind(this.onChangingRGB,this,2)),this.spinB.on("change",_.bind(this.showColor,this,null,!0)).on("changing",_.bind(this.onChangingRGB,this,3)),this.textColor.on("change",_.bind(this.onChangeMaskedField,this)),this.textColor.on("changed",_.bind(this.onChangedMaskedField,this)),this.textColor.$el.on("focus",function(){setTimeout(function(){e.textColor.$el&&e.textColor.$el.select()},1)}),this.spinR.$el.find("input").attr("maxlength",3),this.spinG.$el.find("input").attr("maxlength",3),this.spinB.$el.find("input").attr("maxlength",3),this.on("close",function(){e.trigger("onmodalresult",0)}),$(this)[0].getChild(".footer .dlg-btn").on("click",t),this.rendered=!0,void 0!==this.color&&this.setColor(this.color),this},getFocusedComponents:function(){return[this.spinR,this.spinG,this.spinB,{cmp:this.textColor,selector:"input"}]},getDefaultFocusableComponent:function(){return this.getChild("#extended-text-color")},onChangeColor:function(t,e){this.colorNew.css({"background-color":e}),this.stopevents=!0;var i=e.match(this.hexRe);this.spinR.setValue(parseInt(i[1],16)),this.spinG.setValue(parseInt(i[2],16)),this.spinB.setValue(parseInt(i[3],16)),this.textColor.setValue((i[1]+i[2]+i[3]).toUpperCase()),this.stopevents=!1},showColor:function(t,e){if(!this.stopevents){var i=this.spinR.getNumberValue(),n=null==i||i<0?0:i>255?255:i;e&&this.spinR.setValue(n,!0),n=n.toString(16),i=this.spinG.getNumberValue();var o=null==i||i<0?0:i>255?255:i;e&&this.spinG.setValue(o,!0),o=o.toString(16),i=this.spinB.getNumberValue();var s=null==i||i<0?0:i>255?255:i;e&&this.spinB.setValue(s,!0),s=s.toString(16);var a=(1==n.length?"0"+n:n)+(1==o.length?"0"+o:o)+(1==s.length?"0"+s:s);this.colorsPicker.setColor("#"+a),"hex"!=t&&this.textColor.setValue(a.toUpperCase()),this.colorNew.css("background-color","#"+a)}},onChangingRGB:function(t,e,i,n){if(!this.stopevents){var o,s,a,r;switch(i=_.isEmpty(i)||isNaN(parseInt(i))?parseInt(e.getValue()):parseInt(i),t){case 1:o=(null==i||isNaN(i)||i<0?0:i>255?255:i).toString(16),r=this.spinG.getNumberValue(),s=(null==r||r<0?0:r>255?255:r).toString(16),r=this.spinB.getNumberValue(),a=(null==r||r<0?0:r>255?255:r).toString(16);break;case 2:r=this.spinR.getNumberValue(),o=(null==r||r<0?0:r>255?255:r).toString(16),s=(null==i||isNaN(i)||i<0?0:i>255?255:i).toString(16),r=this.spinB.getNumberValue(),a=(null==r||r<0?0:r>255?255:r).toString(16);break;case 3:r=this.spinR.getNumberValue(),o=(null==r||r<0?0:r>255?255:r).toString(16),r=this.spinG.getNumberValue(),s=(null==r||r<0?0:r>255?255:r).toString(16),a=(null==i||isNaN(i)||i<0?0:i>255?255:i).toString(16)}var l=(1==o.length?"0"+o:o)+(1==s.length?"0"+s:s)+(1==a.length?"0"+a:a);this.colorsPicker.setColor("#"+l),this.textColor.setValue(l.toUpperCase()),this.colorNew.css("background-color","#"+l)}},onChangeMaskedField:function(t,e){e=/^[a-fA-F0-9]{0,6}$/.test(e)?e:"000000",e="000000"+e;var i=e.match(/([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/i);this.stopevents=!0,this.spinR.setValue(parseInt(i[1],16)),this.spinG.setValue(parseInt(i[2],16)),this.spinB.setValue(parseInt(i[3],16)),this.stopevents=!1,this.rendered&&this.showColor("hex")},onChangedMaskedField:function(t,e){/^[a-fA-F0-9]{0,6}$/.test(e)&&!_.isEmpty(e)||t.setValue("000000"),this.rendered&&this.showColor("",!0)},getColor:function(){var t=/#?([a-fA-F0-9]{6})/.exec(this.colorsPicker.getColor());return t?t[1]:null},setColor:function(t){var e=this;if(!0!==this.rendered)return void(this.color=t);var i=/#?([a-fA-F0-9]{6})/.test(t)?t:"ff0000";e.colorsPicker.setColor("#"+i),function(){"transparent"==t?e.colorSaved.addClass("color-transparent"):(e.colorSaved.removeClass("color-transparent"),e.colorSaved.css("background-color","#"+t)),e.colorNew.css("background-color","#"+i)}(),e.stopevents=!0;var n=e.hexRe.exec(i);e.spinR.setValue(parseInt(n[1],16)),e.spinG.setValue(parseInt(n[2],16)),e.spinB.setValue(parseInt(n[3],16)),e.textColor.setValue((n[1]+n[2]+n[3]).toUpperCase()),e.stopevents=!1},onPrimary:function(){return this.trigger("onmodalresult",1),this.close(!0),!1},addButtonText:"Add",textNew:"New",textCurrent:"Current",textRGBErr:"The entered value is incorrect.<br>Please enter a numeric value between 0 and 255.",textHexErr:"The entered value is incorrect.<br>Please enter a value between 000000 and FFFFFF."},Common.UI.ExtendedColorDialog||{}))}),void 0===Common)var Common={};define("common/main/lib/component/ThemeColorPalette",["common/main/lib/component/BaseView","common/main/lib/view/ExtendedColorDialog"],function(){"use strict";Common.UI.ThemeColorPalette=Common.UI.BaseView.extend(_.extend({options:{dynamiccolors:10,standardcolors:10,themecolors:10,effects:5,allowReselect:!0,transparent:!1,value:"000000"},template:_.template('<div style="padding: 8px 12px 12px;"><% var me = this; %><% $(colors).each(function(num, item) { %><% if (me.isBlankSeparator(item)) { %> <div class="palette-color-spacer" style="width:100%;height:8px;float:left;"></div><% } else if (me.isSeparator(item)) { %> </div><div class="divider" style="width:100%;float:left;"></div><div style="padding: 12px;"><% } else if (me.isColor(item)) { %> <a class="palette-color color-<%=item%>" style="background:#<%=item%>" hidefocus="on"><em><span style="background:#<%=item%>;" unselectable="on">&#160;</span></em></a><% } else if (me.isTransparent(item)) { %><a class="color-<%=item%>" hidefocus="on"><em><span unselectable="on">&#160;</span></em></a><% } else if (me.isEffect(item)) { %><a effectid="<%=item.effectId%>" effectvalue="<%=item.effectValue%>" class="palette-color-effect color-<%=item.color%>" style="background:#<%=item.color%>" hidefocus="on"><em><span style="background:#<%=item.color%>;" unselectable="on">&#160;</span></em></a><% } else if (me.isCaption(item)) { %><div class="palette-color-caption" style="width:100%;float:left;font-size: 11px;"><%=item%></div><% } %><% }); %></div><% if (me.options.dynamiccolors!==undefined) { %><div class="palette-color-spacer" style="width:100%;height:8px;float:left;"></div><div style="padding: 12px;"><% for (var i=0; i<me.options.dynamiccolors; i++) { %><a class="color-dynamic-<%=i%> dynamic-empty-color" color="" hidefocus="on"><em><span unselectable="on">&#160;</span></em></a><% } %><% } %></div>'),colorRe:/(?:^|\s)color-(.{6})(?:\s|$)/,selectedCls:"selected",initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this,i=e.$el||$(this.el);this.colors=e.options.colors||this.generateColorData(e.options.themecolors,e.options.effects,e.options.standardcolors,e.options.transparent),i.addClass("theme-colorpalette"),this.render(),this.options.updateColorsArr&&this.updateColors(this.options.updateColorsArr[0],this.options.updateColorsArr[1]),this.options.value&&this.select(this.options.value,!0),this.updateCustomColors(),i.closest(".btn-group").on("show.bs.dropdown",_.bind(this.updateCustomColors,this)),i.closest(".dropdown-submenu").on("show.bs.dropdown",_.bind(this.updateCustomColors,this)),i.on("click",_.bind(this.handleClick,this))},render:function(){return this.$el.html(this.template({colors:this.colors})),this},isBlankSeparator:function(t){return"string"==typeof t&&"-"==t},isSeparator:function(t){return"string"==typeof t&&"--"==t},isColor:function(t){return"string"==typeof t&&/[0-9A-F]{6}/.test(t)},isTransparent:function(t){return"string"==typeof t&&"transparent"==t},isCaption:function(t){return"string"==typeof t&&"-"!=t&&"--"!=t&&!/[0-9A-F]{6}|transparent/.test(t)},isEffect:function(t){return"object"==typeof t&&void 0!==t.effectId},getColor:function(){return this.value},updateCustomColors:function(){var t=this.$el||$(this.el);if(t){var e=t.find("a."+this.selectedCls),i=e.length>0&&/color-dynamic/.test(e[0].className)?e.attr("color"):void 0;i&&(i=i.toUpperCase(),e.removeClass(this.selectedCls));var n=Common.localStorage.getItem("asc."+Common.localStorage.getId()+".colors.custom");n=n?n.split(","):[];for(var o,s=-1,a=n.length<this.options.dynamiccolors?n.length:this.options.dynamiccolors;++s<a;)o=t.find(".color-dynamic-"+s),o.removeClass("dynamic-empty-color").attr("color",n[s]),o.find("span").css({"background-color":"#"+n[s]}),n[s]==i&&(o.addClass(this.selectedCls),i=void 0)}},handleClick:function(t){var e,i=this,n=$(t.target).closest("a");if(0!=n.length)if(n.hasClass("color-transparent"))$(i.el).find("a."+i.selectedCls).removeClass(i.selectedCls),n.addClass(i.selectedCls),i.value="transparent",
i.trigger("select",i,"transparent");else if(n[0].className.search("color-dynamic")<0)if((!/^[a-fA-F0-9]{6}$/.test(i.value)||_.indexOf(i.colors,i.value)<0)&&(i.value=!1),$(i.el).find("a."+i.selectedCls).removeClass(i.selectedCls),n.addClass(i.selectedCls),e=n[0].className.match(i.colorRe)[1],n.hasClass("palette-color-effect")){var o=parseInt(n.attr("effectid"));e&&(i.value=e.toUpperCase(),i.trigger("select",i,{color:e,effectId:o}))}else/#?[a-fA-F0-9]{6}/.test(e)&&(e=/#?([a-fA-F0-9]{6})/.exec(e)[1].toUpperCase(),i.value=e,i.trigger("select",i,e));else/dynamic-empty-color/.test(n[0].className)?setTimeout(function(){i.addNewColor()},10):($(i.el).find("a."+i.selectedCls).removeClass(i.selectedCls),n.addClass(i.selectedCls),e=n.attr("color"),e&&i.trigger("select",i,e),i.value=e.toUpperCase())},setCustomColor:function(t){var e=this.$el||$(this.el);if(t=/#?([a-fA-F0-9]{6})/.exec(t)){this.saveCustomColor(t[1]),e.find("a."+this.selectedCls).removeClass(this.selectedCls);var i=e.find(".dynamic-empty-color");0==i.length&&(this.updateCustomColors(),i=e.find(".color-dynamic-"+(this.options.dynamiccolors-1))),i.first().removeClass("dynamic-empty-color").addClass(this.selectedCls).attr("color",t[1]),i.first().find("span").css({"background-color":"#"+t[1]}),this.select(t[1],!0)}},saveCustomColor:function(t){var e="asc."+Common.localStorage.getId()+".colors.custom",i=Common.localStorage.getItem(e);i=i?i.split(","):[],i.push(t)>this.options.dynamiccolors&&i.shift(),Common.localStorage.setItem(e,i.join().toUpperCase())},addNewColor:function(t){var e=this,i=new Common.UI.ExtendedColorDialog({});i.on("onmodalresult",function(t){e._isdlgopen=!1,1==t&&(e.setCustomColor(i.getColor()),e.fireEvent("select",e,i.getColor()))}),e._isdlgopen=!0,i.setColor(void 0!==e.value&&!1!==e.value?e.value:void 0!==t?t:"000000"),i.show()},isDialogOpen:function(){return 1==this._isdlgopen},select:function(t,e){var i=this.$el||$(this.el);if(i.find("a."+this.selectedCls).removeClass(this.selectedCls),"object"==typeof t){var n;void 0!==t.effectId?(n=i.find('a[effectid="'+t.effectId+'"]').first(),n.length>0?(n.addClass(this.selectedCls),this.value=n[0].className.match(this.colorRe)[1].toUpperCase()):this.value=!1):void 0!==t.effectValue&&(n=i.find('a[effectvalue="'+t.effectValue+'"].color-'+t.color.toUpperCase()).first(),n.length>0?(n.addClass(this.selectedCls),this.value=n[0].className.match(this.colorRe)[1].toUpperCase()):this.value=!1)}else if(/#?[a-fA-F0-9]{6}/.test(t)&&(t=/#?([a-fA-F0-9]{6})/.exec(t)[1].toUpperCase(),this.value=t),/^[a-fA-F0-9]{6}|transparent$/.test(t)&&_.indexOf(this.colors,t)>=0)_.indexOf(this.colors,this.value)<0&&(this.value=!1),(t!=this.value||this.options.allowReselect)&&("transparent"==t?i.find("a.color-transparent").addClass(this.selectedCls):i.find("a.palette-color.color-"+t).first().addClass(this.selectedCls),this.value=t,!0!==e&&this.fireEvent("select",this,t));else{var o=i.find("#"+t).first();0==o.length&&(o=i.find('a[color="'+t+'"]').first()),o.length>0&&(o.addClass(this.selectedCls),this.value=t.toUpperCase())}},selectByRGB:function(t,e){var i=this.$el||$(this.el);i.find("a."+this.selectedCls).removeClass(this.selectedCls);var n="object"==typeof t?t.color:t;if(/#?[a-fA-F0-9]{6}/.test(n)&&(n=/#?([a-fA-F0-9]{6})/.exec(n)[1].toUpperCase()),/^[a-fA-F0-9]{6}|transparent$/.test(n)&&(n!=this.value||this.options.allowReselect)){var o="transparent"==n?i.find("a.color-transparent"):i.find("a.color-"+n).first();0==o.length&&(o=i.find("#"+n).first()),0==o.length&&(o=i.find('a[color="'+n+'"]').first()),o.length>0&&(o.addClass(this.selectedCls),this.value=n),!0!==e&&this.fireEvent("select",this,n)}},updateColors:function(t,e,i){if(void 0!==t&&void 0!==e){var n=this,o=n.$el||$(this.el);void 0===n.aColorElements&&(n.aColorElements=o.find("a.palette-color")),void 0===n.aEffectElements&&(n.aEffectElements=o.find("a.palette-color-effect"));for(var s,a=0,r=0,l=0;l<n.colors.length;l++)if("string"==typeof n.colors[l]&&/[0-9A-F]{6}/.test(n.colors[l])){if(a>=e.length)continue;s=$(n.aColorElements[a]),s.removeClass("color-"+n.colors[l]),n.colors[l]=e[a].toUpperCase(),s.addClass("color-"+n.colors[l]),s.css({background:"#"+n.colors[l]}),s.find("span").first().css({background:"#"+n.colors[l]}),a++}else if("object"==typeof n.colors[l]&&void 0!==n.colors[l].effectId){if(r>=t.length)continue;s=$(n.aEffectElements[r]),t[r].color=t[r].color.toUpperCase(),n.colors[l].color!==t[r].color&&(s.removeClass("color-"+n.colors[l].color),s.addClass("color-"+t[r].color),s.css({background:"#"+t[r].color}),s.find("span").first().css({background:"#"+t[r].color})),n.colors[l].effectId!==t[r].effectId&&s.attr("effectid",""+t[r].effectId),n.colors[l].effectValue!==t[r].effectValue&&s.attr("effectvalue",""+t[r].effectValue),n.colors[l]=t[r],r++}if(i)this.select(i,!0);else{var c=o.find("a."+this.selectedCls);c.length&&c.hasClass("palette-color-effect")&&(this.value=c[0].className.match(this.colorRe)[1].toUpperCase())}this.options.updateColorsArr=void 0}},clearSelection:function(t){this.$el.find("a."+this.selectedCls).removeClass(this.selectedCls),this.value=void 0},generateColorData:function(t,e,i,n){var o=[],s=t>0&&e>0?t*e:0;if(t>0){o=[this.textThemeColors,"-"];for(var a=0;a<t;a++)o.push({color:"FFFFFF",effectId:1});e>0&&o.push("-");for(var a=0;a<s;a++)o.push({color:"FFFFFF",effectId:1});i&&o.push("-","--","-")}if(i){o.push(this.textStandartColors,"-"),n&&(o.push("transparent"),i--);for(var a=0;a<i;a++)o.push("FFFFFF")}return this.options.dynamiccolors&&(t||i)&&o.push("-","--"),o},textThemeColors:"Theme Colors",textStandartColors:"Standart Colors"},Common.UI.ThemeColorPalette||{}))}),define("common/main/lib/view/AdvancedSettingsWindow",["common/main/lib/component/Window"],function(){"use strict";Common.Views.AdvancedSettingsWindow=Common.UI.Window.extend(_.extend({initialize:function(t){var e={};_.extend(e,{height:200,header:!0,cls:"advanced-settings-dlg",toggleGroup:"advanced-settings-group",contentTemplate:"",items:[],buttons:["ok","cancel"]},t),this.template=t.template||['<div class="box" style="height:'+(e.height-85)+'px;">','<div class="menu-panel">',"<% _.each(items, function(item) { %>",'<button class="btn btn-category" content-target="<%= item.panelId %>"><span class=""><%= item.panelCaption %></span></button>',"<% }); %>","</div>",'<div class="separator"></div>','<div class="content-panel" >'+e.contentTemplate+"</div>","</div>",'<div class="separator horizontal"></div>'].join(""),e.tpl=_.template(this.template)(e),this.handler=e.handler,this.toggleGroup=e.toggleGroup,this.contentWidth=e.contentWidth,this.storageName=e.storageName,Common.UI.Window.prototype.initialize.call(this,e)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this,e=this.getChild();e.find(".dlg-btn").on("click",_.bind(this.onDlgBtnClick,this)),this.on("animate:after",_.bind(this.onAnimateAfter,this)),this.btnsCategory=[],_.each(e.find(".btn-category"),function(e,i){var n=$(e),o=new Common.UI.Button({el:n,enableToggle:!0,toggleGroup:t.toggleGroup,allowDepress:!1,contentTarget:n.attr("content-target")});o.on("click",_.bind(t.onCategoryClick,t,o,i)),t.btnsCategory.push(o)});var i=e.find(".content-panel"),n=e.find(".menu-panel");i.width(this.contentWidth),e.width((n.length>0?n.width():0)+i.outerWidth()+2),this.content_panels=e.find(".settings-panel"),this.btnsCategory.length>0&&this.btnsCategory[0].toggle(!0,!0)},setHeight:function(t){Common.UI.Window.prototype.setHeight.call(this,t),this.getChild().find(".body > .box").css("height",t-85)},onDlgBtnClick:function(t){var e=t.currentTarget.attributes.result.value;this.handler&&this.handler.call(this,e,"ok"==e?this.getSettings():void 0)||this.close()},onCategoryClick:function(t,e){this.content_panels.filter(".active").removeClass("active"),$("#"+t.options.contentTarget).addClass("active")},getSettings:function(){},onPrimary:function(){if(!this.handler||!this.handler.call(this,"ok",this.getSettings()))return this.close(),!1},setActiveCategory:function(t){if(!(this.btnsCategory.length<1)){t=t>=0&&t<this.btnsCategory.length?t:0;var e=this.btnsCategory[t];if(!e.isVisible()||e.isDisabled())for(var i=0;i<this.btnsCategory.length;i++){var n=this.btnsCategory[i];if(n.isVisible()&&!n.isDisabled()){e=n,t=i;break}}e.toggle(!0),this.onCategoryClick(e,t)}},getActiveCategory:function(){var t=-1;return this.btnsCategory.forEach(function(e,i){e.pressed&&(t=i)}),t},close:function(t){this.storageName&&Common.localStorage.setItem(this.storageName,this.getActiveCategory()),Common.UI.Window.prototype.close.call(this,t)},onAnimateAfter:function(){}},Common.Views.AdvancedSettingsWindow||{}))});var c_oAscFrameWrap={None:-1,Inline:!1,Flow:!0};if(define("documenteditor/main/app/view/DropcapSettingsAdvanced",["text!documenteditor/main/app/template/DropcapSettingsAdvanced.template","core","common/main/lib/component/Button","common/main/lib/component/CheckBox","common/main/lib/component/ComboBoxFonts","common/main/lib/component/MetricSpinner","common/main/lib/component/TableStyler","common/main/lib/component/ThemeColorPalette","common/main/lib/view/AdvancedSettingsWindow"],function(t){"use strict";DE.Views.DropcapSettingsAdvanced=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:320,height:380,toggleGroup:"dropcap-adv-settings-group",storageName:"de-dropcap-settings-adv-category"},initialize:function(e){_.extend(this.options,{title:this.textTitle,contentTemplate:_.template(t)({scope:this}),items:[{panelId:"id-adv-dropcap-frame",panelCaption:this.textFrame},{panelId:"id-adv-dropcap-dropcap",panelCaption:this.strDropcap},{panelId:"id-adv-dropcap-borders",panelCaption:this.strBorders},{panelId:"id-adv-dropcap-margins",panelCaption:this.strMargins}]},e),this.tableStylerRows=this.options.tableStylerRows,this.tableStylerColumns=this.options.tableStylerColumns,this.fontStore=this.options.fontStore,this.borderProps=this.options.borderProps,this.isFrame=this.options.isFrame,this.api=this.options.api,this.Borders={},this.BorderSize={ptValue:0,pxValue:0},this.paragraphShade="transparent",this._changedProps=null,this.ChangedBorders=void 0,this._noApply=!0,this.Margins=void 0,this._originalProps=new Asc.asc_CParagraphProperty(this.options.paragraphProps),Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){var t=this;Common.Views.AdvancedSettingsWindow.prototype.render.call(this),this.tableStyler=new Common.UI.TableStyler({el:$("#drop-advanced-borderstyler"),width:200,height:170,rows:this.tableStylerRows,columns:this.tableStylerColumns,spacingMode:!1}),_.each([[c_tableBorder.BORDER_HORIZONTAL_TOP,"t","btn-borders-large toolbar__icon toolbar__icon-big paragraph-borders-top","00"],[c_tableBorder.BORDER_HORIZONTAL_CENTER,"m","btn-borders-large toolbar__icon toolbar__icon-big paragraph-borders-inner","01"],[c_tableBorder.BORDER_HORIZONTAL_BOTTOM,"b","btn-borders-large toolbar__icon toolbar__icon-big paragraph-borders-bottom","10"],[c_tableBorder.BORDER_OUTER,"lrtb","btn-borders-large toolbar__icon toolbar__icon-big paragraph-borders-outer","11"],[c_tableBorder.BORDER_VERTICAL_LEFT,"l","btn-borders-large toolbar__icon toolbar__icon-big paragraph-borders-left","20"],[c_tableBorder.BORDER_ALL,"lrtbm","btn-borders-large toolbar__icon toolbar__icon-big paragraph-borders-all","21"],[c_tableBorder.BORDER_VERTICAL_RIGHT,"r","btn-borders-large toolbar__icon toolbar__icon-big paragraph-borders-right","30"],[c_tableBorder.BORDER_NONE,"","btn-borders-large toolbar__icon toolbar__icon-big paragraph-borders-none","31"]],function(e,i){new Common.UI.Button({parentEl:$("#drop-advanced-button-borderline-"+e[3]),posId:e[0],strId:e[1],iconCls:e[2],style:"margin-left: 5px; margin-bottom: 4px;",cls:"btn-options large"}).on("click",function(e){t._ApplyBorderPreset(e.options.strId)})},this);var e=Common.Utils.Metric.getMetricName(Common.Utils.Metric.c_MetricUnits.pt);this.cmbBorderSize=new Common.UI.ComboBorderSize({el:$("#drop-advanced-input-bordersize"),style:"width: 90px;",store:new Backbone.Collection,takeFocusOnClose:!0,data:[{id:Common.UI.getId(),displayValue:this.txtNoBorders,value:0,borderstyle:""},{id:Common.UI.getId(),displayValue:"0.5 "+e,value:.5,pxValue:.5,offsety:0},{id:Common.UI.getId(),displayValue:"1 "+e,value:1,pxValue:1,offsety:20},{id:Common.UI.getId(),displayValue:"1.5 "+e,value:1.5,pxValue:2,offsety:40},{id:Common.UI.getId(),displayValue:"2.25 "+e,value:2.25,pxValue:3,offsety:60},{id:Common.UI.getId(),displayValue:"3 "+e,value:3,pxValue:4,offsety:80},{id:Common.UI.getId(),displayValue:"4.5 "+e,value:4.5,pxValue:5,offsety:100},{id:Common.UI.getId(),displayValue:"6 "+e,value:6,pxValue:6,offsety:120}]}).on("selected",_.bind(function(t,e){this.BorderSize={ptValue:e.value,pxValue:e.pxValue},this.tableStyler.setVirtualBorderSize(this.BorderSize.pxValue)},this));var i=this.cmbBorderSize.store.at(2);this.cmbBorderSize.setValue(i.get("value")),this.BorderSize={ptValue:i.get("value"),pxValue:i.get("pxValue")},this.btnBorderColor=new Common.UI.ColorButton({parentEl:$("#drop-advanced-button-bordercolor"),additionalAlign:this.menuAddAlign,color:"auto",auto:!0}),this.btnBorderColor.on("color:select",_.bind(function(t,e){this.tableStyler.setVirtualBorderColor("object"==typeof e?e.color:e)},this)),this.btnBorderColor.on("auto:select",_.bind(function(t,e){this.tableStyler.setVirtualBorderColor("object"==typeof e?e.color:e)},this)),this.colorsBorder=this.btnBorderColor.getPicker(),this.btnBackColor=new Common.UI.ColorButton({parentEl:$("#drop-advanced-button-color"),additionalAlign:this.menuAddAlign,transparent:!0}),this.btnBackColor.on("color:select",_.bind(function(e,i){t.paragraphShade=i,t._changedProps&&(void 0!==t._changedProps.get_Shade()&&null!==t._changedProps.get_Shade()||t._changedProps.put_Shade(new Asc.asc_CParagraphShd),"transparent"==i?t._changedProps.get_Shade().put_Value(Asc.c_oAscShdNil):(t._changedProps.get_Shade().put_Value(Asc.c_oAscShdClear),t._changedProps.get_Shade().put_Color(Common.Utils.ThemeColor.getRgbColor(i))));var n="object"==typeof i?i.color:i;t.tableStyler.setCellsColor(n)},this)),this.colorsBack=this.btnBackColor.getPicker(),this.spnMarginTop=new Common.UI.MetricSpinner({el:$("#drop-advanced-input-top"),step:.1,width:100,value:"0 cm",defaultUnit:"cm",maxValue:55.87,minValue:0}).on("change",_.bind(function(t,e,i){this._noApply||(_.isUndefined(this.Margins)&&(this.Margins={}),this.Margins.Top=Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))},t)),this.spnMarginLeft=new Common.UI.MetricSpinner({el:$("#drop-advanced-input-left"),step:.1,width:100,value:"0 cm",defaultUnit:"cm",maxValue:55.87,minValue:0}).on("change",_.bind(function(t,e,i){this._noApply||(_.isUndefined(this.Margins)&&(this.Margins={}),this.Margins.Left=Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))},t)),this.spnMarginBottom=new Common.UI.MetricSpinner({el:$("#drop-advanced-input-bottom"),step:.1,width:100,value:"0 cm",defaultUnit:"cm",maxValue:55.87,minValue:0}).on("change",_.bind(function(t,e,i){this._noApply||(_.isUndefined(this.Margins)&&(this.Margins={}),this.Margins.Bottom=Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))},t)),this.spnMarginRight=new Common.UI.MetricSpinner({el:$("#drop-advanced-input-right"),step:.1,width:100,value:"0 cm",defaultUnit:"cm",maxValue:55.87,minValue:0}).on("change",_.bind(function(t,e,i){this._noApply||(_.isUndefined(this.Margins)&&(this.Margins={}),this.Margins.Right=Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))},t)),this.btnNone=new Common.UI.Button({parentEl:$("#drop-advanced-button-none"),cls:"btn huge-1 btn-options",iconCls:"icon-advanced-wrap options__icon options__icon-huge btn-drop-none",enableToggle:!0,toggleGroup:"dropAdvGroup",allowDepress:!1,hint:this.textNone}).on("toggle",_.bind(function(e,i){t._changedProps&&i&&(t._DisableElem(Asc.c_oAscDropCap.None),t._changedProps.put_DropCap(Asc.c_oAscDropCap.None))},t)),this.btnInText=new Common.UI.Button({parentEl:$("#drop-advanced-button-intext"),cls:"btn huge-1 btn-options",iconCls:"icon-advanced-wrap options__icon options__icon-huge btn-drop-text",enableToggle:!0,toggleGroup:"dropAdvGroup",allowDepress:!1,hint:this.textInText}).on("toggle",_.bind(function(e,i){t._changedProps&&i&&(t._DisableElem(Asc.c_oAscDropCap.Drop),t._changedProps.put_DropCap(Asc.c_oAscDropCap.Drop))},t)),this.btnInMargin=new Common.UI.Button({parentEl:$("#drop-advanced-button-inmargin"),cls:"btn huge-1 btn-options",iconCls:"icon-advanced-wrap options__icon options__icon-huge btn-drop-margin",enableToggle:!0,toggleGroup:"dropAdvGroup",allowDepress:!1,hint:this.textInMargin}).on("toggle",_.bind(function(e,i){t._changedProps&&i&&(t._DisableElem(Asc.c_oAscDropCap.Margin),t._changedProps.put_DropCap(Asc.c_oAscDropCap.Margin))},t)),this.spnRowHeight=new Common.UI.MetricSpinner({el:$("#drop-advanced-input-rowheight"),step:1,width:120,value:3,defaultUnit:"",maxValue:10,minValue:1,allowDecimal:!1}).on("change",_.bind(function(e,i,n){t._changedProps&&t._changedProps.put_Lines(e.getNumberValue())},t)),this.numDistance=new Common.UI.MetricSpinner({el:$("#drop-advanced-input-distance"),step:.1,width:120,value:"0 cm",defaultUnit:"cm",maxValue:55.87,minValue:0}).on("change",_.bind(function(e,i,n){t._changedProps&&t._changedProps.put_HSpace(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue()))},t)),this.cmbFonts=new Common.UI.ComboBoxFonts({el:$("#drop-advanced-input-fonts"),cls:"input-group-nr",style:"width: 290px;",menuCls:"scrollable-menu",menuStyle:"min-width: 55px;max-height: 236px;",store:new Common.Collections.Fonts,recent:0,hint:this.tipFontName,takeFocusOnClose:!0}).on("selected",_.bind(function(e,i){t._changedProps&&t._changedProps.put_FontFamily(i.name)},t)),this.btnFrameNone=new Common.UI.Button({parentEl:$("#frame-advanced-button-none"),cls:"btn huge-1 btn-options",iconCls:"options__icon options__icon-huge none",enableToggle:!0,toggleGroup:"frameAdvGroup",allowDepress:!1,hint:this.textNone}).on("toggle",_.bind(function(e,i){t._changedProps&&i&&(t._DisableElem(c_oAscFrameWrap.None),t._changedProps.put_Wrap(c_oAscFrameWrap.None))},t)),this.btnFrameInline=new Common.UI.Button({parentEl:$("#frame-advanced-button-inline"),cls:"btn huge-1 btn-options",iconCls:"options__icon options__icon-huge table-align-center",enableToggle:!0,toggleGroup:"frameAdvGroup",allowDepress:!1,hint:this.textInline}).on("toggle",_.bind(function(e,i){t._changedProps&&i&&(t._DisableElem(c_oAscFrameWrap.Inline),t._changedProps.put_Wrap(c_oAscFrameWrap.Inline))},t)),this.btnFrameFlow=new Common.UI.Button({parentEl:$("#frame-advanced-button-flow"),cls:"btn huge-1 btn-options",iconCls:"options__icon options__icon-huge table-flow",enableToggle:!0,toggleGroup:"frameAdvGroup",allowDepress:!1,hint:this.textFlow}).on("toggle",_.bind(function(e,i){t._changedProps&&i&&(t._DisableElem(c_oAscFrameWrap.Flow),t._changedProps.put_Wrap(c_oAscFrameWrap.Flow))},t)),this._arrWidth=[{displayValue:this.textAuto,value:0},{displayValue:this.textExact,value:1}],this.cmbWidth=new Common.UI.ComboBox({el:$("#frame-advanced-input-widthtype"),cls:"input-group-nr",menuStyle:"min-width: 130px;",editable:!1,takeFocusOnClose:!0,data:this._arrWidth}).on("selected",_.bind(function(e,i){t._changedProps&&(t.spnWidth.suspendEvents(),t.spnWidth.setValue(0==i.value?"":1),t.spnWidth.resumeEvents(),t._changedProps.put_W(0==i.value?void 0:Common.Utils.Metric.fnRecalcToMM(this.spnWidth.getNumberValue())))},t)),this.cmbWidth.setValue(this._arrWidth[0].value),this.spnWidth=new Common.UI.MetricSpinner({el:$("#frame-advanced-input-width"),maxValue:55.88,minValue:.02,step:.1,defaultUnit:"cm",value:""}).on("change",_.bind(function(e,i,n){t._changedProps&&(t.cmbWidth.suspendEvents(),t.cmbWidth.setValue(this._arrWidth[1].value),t.cmbWidth.resumeEvents(),t._changedProps.put_W(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue())))},t)),this._arrHeight=[{displayValue:this.textAuto,value:0},{displayValue:this.textExact,value:1},{displayValue:this.textAtLeast,value:2}],this.cmbHeight=new Common.UI.ComboBox({el:$("#frame-advanced-input-heighttype"),cls:"input-group-nr",menuStyle:"min-width: 130px;",editable:!1,takeFocusOnClose:!0,data:this._arrHeight}).on("selected",_.bind(function(e,i){t._changedProps&&(t.spnHeight.suspendEvents(),t.spnHeight.setValue(0==i.value?"":1),t.spnHeight.resumeEvents(),t._changedProps.put_HRule(0==i.value?Asc.linerule_Auto:1==i.value?Asc.linerule_Exact:Asc.linerule_AtLeast),i.value>0&&this._changedProps.put_H(Common.Utils.Metric.fnRecalcToMM(this.spnHeight.getNumberValue())))},t)),this.cmbHeight.setValue(this._arrHeight[0].value),this.spnHeight=new Common.UI.MetricSpinner({el:$("#frame-advanced-input-height"),maxValue:55.88,minValue:.02,step:.1,defaultUnit:"cm",value:""}).on("change",_.bind(function(e,i,n){if(t._changedProps){var o=Asc.linerule_Auto;t.cmbHeight.getValue()==t._arrHeight[1].value?o=Asc.linerule_Exact:t.cmbHeight.getValue()==t._arrHeight[2].value&&(o=Asc.linerule_AtLeast),o==Asc.linerule_Auto&&(t.cmbHeight.suspendEvents(),t.cmbHeight.setValue(t._arrHeight[2].value),o=Asc.linerule_AtLeast,t.cmbHeight.resumeEvents()),t._changedProps.put_HRule(o),t._changedProps.put_H(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue()))}},t)),this.spnX=new Common.UI.MetricSpinner({el:$("#frame-advanced-input-hdist"),maxValue:55.87,minValue:0,step:.1,defaultUnit:"cm",value:"0 cm",width:"auto"}).on("change",_.bind(function(e,i,n){t._changedProps&&t._changedProps.put_HSpace(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue()))},t)),this.spnY=new Common.UI.MetricSpinner({el:$("#frame-advanced-input-vdist"),maxValue:55.87,minValue:0,step:.1,defaultUnit:"cm",value:"0 cm",width:"auto"}).on("change",_.bind(function(e,i,n){t._changedProps&&t._changedProps.put_VSpace(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue()))},t)),this._arrHAlign=[{displayValue:this.textLeft,value:Asc.c_oAscXAlign.Left},{displayValue:this.textCenter,value:Asc.c_oAscXAlign.Center},{displayValue:this.textRight,value:Asc.c_oAscXAlign.Right}],this.cmbHAlign=new Common.UI.ComboBox({el:$("#frame-advanced-input-hposition"),cls:"input-group-nr",menuStyle:"min-width: 130px;",data:this._arrHAlign,takeFocusOnClose:!0}).on("changed:after",_.bind(function(e,i){if(t._changedProps)if(e.getSelectedRecord())t._changedProps.put_XAlign(i.value);else{var n=Common.Utils.String.parseFloat(i.value);isNaN(n)||(t._changedProps.put_XAlign(void 0),t._changedProps.put_X(Common.Utils.Metric.fnRecalcToMM(n)))}},t)).on("selected",_.bind(function(e,i){t._changedProps&&t._changedProps.put_XAlign(i.value)},t)),this.cmbHAlign.setValue(this._arrHAlign[0].value),this._arrHRelative=[{displayValue:this.textMargin,value:Asc.c_oAscHAnchor.Margin},{displayValue:this.textPage,value:Asc.c_oAscHAnchor.Page},{displayValue:this.textColumn,value:Asc.c_oAscHAnchor.Text}],this.cmbHRelative=new Common.UI.ComboBox({el:$("#frame-advanced-input-hrelative"),cls:"input-group-nr",menuStyle:"min-width: 95px;",data:this._arrHRelative,editable:!1,takeFocusOnClose:!0}).on("selected",_.bind(function(e,i){t._changedProps&&t._changedProps.put_HAnchor(i.value)},t)),this.cmbHRelative.setValue(this._arrHRelative[1].value),this._arrVAlign=[{displayValue:this.textTop,value:Asc.c_oAscYAlign.Top},{displayValue:this.textCenter,value:Asc.c_oAscYAlign.Center},{displayValue:this.textBottom,value:Asc.c_oAscYAlign.Bottom}],this.cmbVAlign=new Common.UI.ComboBox({el:$("#frame-advanced-input-vposition"),cls:"input-group-nr",menuStyle:"min-width: 130px;",data:this._arrVAlign,takeFocusOnClose:!0}).on("changed:after",_.bind(function(e,i){if(t._changedProps)if(e.getSelectedRecord())t._changedProps.put_YAlign(i.value);else{var n=Common.Utils.String.parseFloat(i.value);isNaN(n)||(t._changedProps.put_YAlign(void 0),t._changedProps.put_Y(Common.Utils.Metric.fnRecalcToMM(Common.Utils.String.parseFloat(i.value))))}},t)).on("selected",_.bind(function(e,i){t._changedProps&&t._changedProps.put_YAlign(i.value)},t)),this.cmbVAlign.setValue(this._arrVAlign[0].value),this._arrVRelative=[{displayValue:this.textMargin,value:Asc.c_oAscVAnchor.Margin},{displayValue:this.textPage,value:Asc.c_oAscVAnchor.Page},{displayValue:this.textParagraph,value:Asc.c_oAscVAnchor.Text}],this.cmbVRelative=new Common.UI.ComboBox({el:$("#frame-advanced-input-vrelative"),cls:"input-group-nr",menuStyle:"min-width: 95px;",data:this._arrVRelative,editable:!1,takeFocusOnClose:!0}).on("selected",_.bind(function(e,i){t._changedProps&&(t._changedProps.put_VAnchor(i.value),this.chMove.setValue(i.value==Asc.c_oAscVAnchor.Text,!0))},t)),this.cmbVRelative.setValue(this._arrVRelative[2].value),this.chMove=new Common.UI.CheckBox({el:$("#frame-advanced-checkbox-move"),labelText:this.textMove}).on("change",_.bind(function(e,i){if(t._changedProps){var n=this.cmbVRelative.store.at("checked"==i?2:1);t.cmbVRelative.setValue(n.get("value")),t._changedProps.put_VAnchor(n.get("value"))}},t)),this.on("show",_.bind(this.onShowDialog,this)),this.afterRender()},afterRender:function(){this.updateMetricUnit(),this.updateThemeColors(),this.isFrame||this.cmbFonts.fillFonts(this.fontStore),this._setDefaults(this._originalProps),void 0!==this.borderProps&&(this.btnBorderColor.setColor(this.borderProps.borderColor),this.btnBorderColor.setAutoColor("auto"==this.borderProps.borderColor),this.tableStyler.setVirtualBorderColor("object"==typeof this.btnBorderColor.color?this.btnBorderColor.color.color:this.btnBorderColor.color),"auto"==this.borderProps.borderColor?this.colorsBorder.clearSelection():this.colorsBorder.select(this.borderProps.borderColor,!0),this.cmbBorderSize.setValue(this.borderProps.borderSize.ptValue),this.BorderSize={ptValue:this.borderProps.borderSize.ptValue,pxValue:this.borderProps.borderSize.pxValue},this.tableStyler.setVirtualBorderSize(this.BorderSize.pxValue)),this.setTitle(this.isFrame?this.textTitleFrame:this.textTitle);for(var t=0;t<this.tableStyler.rows;t++)for(var e=0;e<this.tableStyler.columns;e++)this.tableStyler.getCell(e,t).on("borderclick",function(t,e,i,n){void 0===this.ChangedBorders&&(this.ChangedBorders=new Asc.asc_CParagraphBorders),this._UpdateCellBordersStyle(t,e,i,n,this.Borders)},this);this.tableStyler.on("borderclick",function(t,e,i,n){void 0===this.ChangedBorders&&(this.ChangedBorders=new Asc.asc_CParagraphBorders),this._UpdateTableBordersStyle(t,e,i,n,this.Borders)},this);var i="object"==typeof this.paragraphShade?this.paragraphShade.color:this.paragraphShade;if(this.tableStyler.setCellsColor(i),this.isFrame&&this.setHeight(500),this.btnsCategory[this.isFrame?1:0].setVisible(!1),this.storageName){var n=Common.localStorage.getItem(this.storageName);this.setActiveCategory(null!==n?parseInt(n):0)}},getFocusedComponents:function(){return[this.cmbWidth,this.spnWidth,this.cmbHeight,this.spnHeight,this.cmbHAlign,this.cmbHRelative,this.spnX,this.cmbVAlign,this.cmbVRelative,this.spnY,this.chMove,this.cmbFonts,this.spnRowHeight,this.numDistance,this.spnMarginTop,this.spnMarginLeft,this.spnMarginBottom,this.spnMarginRight]},onCategoryClick:function(t,e){Common.Views.AdvancedSettingsWindow.prototype.onCategoryClick.call(this,t,e);var i=this;setTimeout(function(){0==e?i.cmbWidth.focus():1==e?i.cmbFonts.focus():3==e&&i.spnMarginTop.focus()},100)},getSettings:function(){if(null===this.ChangedBorders?this._changedProps.put_Borders(this.Borders):void 0!==this.ChangedBorders&&this._changedProps.put_Borders(this.ChangedBorders),this.Margins){var t=this._changedProps.get_Borders();void 0!==t&&null!==t||(this._changedProps.put_Borders(new Asc.asc_CParagraphBorders),t=this._changedProps.get_Borders()),void 0!==this.Margins.Left&&(void 0!==t.get_Left()&&null!==t.get_Left()||t.put_Left(new Asc.asc_CTextBorder(this.Borders.get_Left())),t.get_Left().put_Space(this.Margins.Left)),void 0!==this.Margins.Top&&(void 0!==t.get_Top()&&null!==t.get_Top()||t.put_Top(new Asc.asc_CTextBorder(this.Borders.get_Top())),t.get_Top().put_Space(this.Margins.Top)),void 0!==this.Margins.Right&&(void 0!==t.get_Right()&&null!==t.get_Right()||t.put_Right(new Asc.asc_CTextBorder(this.Borders.get_Right())),t.get_Right().put_Space(this.Margins.Right)),void 0!==this.Margins.Bottom&&(void 0!==t.get_Bottom()&&null!==t.get_Bottom()||t.put_Bottom(new Asc.asc_CTextBorder(this.Borders.get_Bottom())),t.get_Bottom().put_Space(this.Margins.Bottom),void 0!==t.get_Between()&&null!==t.get_Between()||t.put_Between(new Asc.asc_CTextBorder(this.Borders.get_Between())),t.get_Between().put_Space(this.Margins.Bottom))}return this._changedProps.put_FromDropCapMenu(!this.isFrame),{paragraphProps:this._changedProps,borderProps:{borderSize:this.BorderSize,borderColor:this.btnBorderColor.isAutoColor()?"auto":this.btnBorderColor.color}}},onShowDialog:function(t){!this.isFrame&&this.btnNone.pressed?this._DisableElem(Asc.c_oAscDropCap.None):this.isFrame&&this.btnFrameNone.pressed&&this._DisableElem(c_oAscFrameWrap.None)},onBtnBordersClick:function(t,e){if(this.updateBordersStyle(t.options.strId,!0),this.api){var i=new Asc.CTableProp;i.put_CellBorders(this.CellBorders),i.put_CellSelect(!0),this.api.tblApply(i)}this.fireEvent("editcomplete",this)},updateThemeColors:function(){this.colorsBorder.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBack.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors())},updateMetricUnit:function(){var t=this;_.each([t.spnMarginTop,t.spnMarginLeft,t.spnMarginBottom,t.spnMarginRight,t.numDistance,t.spnWidth,t.spnHeight,t.spnX,t.spnY],function(t){t.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),t.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)})},_setDefaults:function(t){if(t){this._noApply=!0,this._originalProps=new Asc.asc_CParagraphProperty(t);var e=t.get_FramePr();if(e){var i;if(this.isFrame){i=e.get_W(),this.cmbWidth.setValue(void 0===i?this._arrWidth[0].value:this._arrWidth[1].value),this.spnWidth.setValue(void 0!==i?Common.Utils.Metric.fnRecalcFromMM(i):""),i=e.get_HRule(),void 0!==i?(this.cmbHeight.setValue(i===Asc.linerule_Exact?this._arrHeight[1].value:this._arrHeight[2].value),this.spnHeight.setValue(Common.Utils.Metric.fnRecalcFromMM(e.get_H()))):(this.cmbHeight.setValue(this._arrHeight[0].value),this.spnHeight.setValue("")),i=e.get_HSpace(),this.spnX.setValue(void 0!==i?Common.Utils.Metric.fnRecalcFromMM(i):0),i=e.get_VSpace(),this.spnY.setValue(void 0!==i?Common.Utils.Metric.fnRecalcFromMM(i):0),i=e.get_HAnchor();for(var n=0;n<this._arrHRelative.length;n++)if(i==this._arrHRelative[n].value){this.cmbHRelative.setValue(this._arrHRelative[n].value);break}if(void 0!==(i=e.get_XAlign())){for(var n=0;n<this._arrHAlign.length;n++)if(i==this._arrHAlign[n].value){this.cmbHAlign.setValue(this._arrHAlign[n].value);break}}else i=e.get_X(),this.cmbHAlign.setValue(Common.Utils.Metric.fnRecalcFromMM(void 0!==i?i:0)+" "+Common.Utils.Metric.getCurrentMetricName());i=e.get_VAnchor();for(var n=0;n<this._arrVRelative.length;n++)if(i==this._arrVRelative[n].value){this.cmbVRelative.setValue(this._arrVRelative[n].value);break}if(this.chMove.setValue(i==Asc.c_oAscVAnchor.Text),void 0!==(i=e.get_YAlign())){for(var n=0;n<this._arrVAlign.length;n++)if(i==this._arrVAlign[n].value){this.cmbVAlign.setValue(this._arrVAlign[n].value);break}}else i=e.get_Y(),this.cmbVAlign.setValue(Common.Utils.Metric.fnRecalcFromMM(void 0!==i?i:0)+" "+Common.Utils.Metric.getCurrentMetricName());i=e.get_Wrap(),!1===i?this.btnFrameInline.toggle(!0,!1):this.btnFrameFlow.toggle(!0,!1)}else if(this.spnRowHeight.setValue(null!==e.get_Lines()?e.get_Lines():""),this.numDistance.setValue(null!==e.get_HSpace()?Common.Utils.Metric.fnRecalcFromMM(e.get_HSpace()):""),i=e.get_DropCap(),i==Asc.c_oAscDropCap.Drop?this.btnInText.toggle(!0,!1):i==Asc.c_oAscDropCap.Margin?this.btnInMargin.toggle(!0,!1):this.btnNone.toggle(!0,!1),i=e.get_FontFamily()){var o=this.cmbFonts.store.findWhere({name:i.get_Name()});o?this.cmbFonts.setValue(o.get("name")):this.cmbFonts.setRawValue(i.get_Name())}if(this.Borders=new Asc.asc_CParagraphBorders(e.get_Borders()),this.Borders){
var s=this.Borders.get_Left(),a=null!==s&&void 0!==s&&null!==s.get_Space()&&void 0!==s.get_Space()?Common.Utils.Metric.fnRecalcFromMM(s.get_Space()):"";this.spnMarginLeft.setValue(a),s=this.Borders.get_Top(),a=null!==s&&void 0!==s&&null!==s.get_Space()&&void 0!==s.get_Space()?Common.Utils.Metric.fnRecalcFromMM(s.get_Space()):"",this.spnMarginTop.setValue(a),s=this.Borders.get_Right(),a=null!==s&&void 0!==s&&null!==s.get_Space()&&void 0!==s.get_Space()?Common.Utils.Metric.fnRecalcFromMM(s.get_Space()):"",this.spnMarginRight.setValue(a),s=this.Borders.get_Bottom(),a=null!==s&&void 0!==s&&null!==s.get_Space()&&void 0!==s.get_Space()?Common.Utils.Metric.fnRecalcFromMM(s.get_Space()):"",this.spnMarginBottom.setValue(a)}var r=e.get_Shade();if(null!==r&&void 0!==r&&r.get_Value()===Asc.c_oAscShdClear){var l=r.get_Color();l?l.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.paragraphShade={color:Common.Utils.ThemeColor.getHexColor(l.get_r(),l.get_g(),l.get_b()),effectValue:l.get_value()}:this.paragraphShade=Common.Utils.ThemeColor.getHexColor(l.get_r(),l.get_g(),l.get_b()):this.paragraphShade="transparent"}else this.paragraphShade="transparent";if(this.btnBackColor.setColor(this.paragraphShade),_.isObject(this.paragraphShade)){for(var c=!1,n=0;n<10;n++)if(Common.Utils.ThemeColor.ThemeValues[n]==this.paragraphShade.effectValue){this.colorsBack.select(this.paragraphShade,!0),c=!0;break}c||this.colorsBack.clearSelection()}else this.colorsBack.select(this.paragraphShade,!0);this._UpdateBorders()}this._noApply=!1,this._changedProps=new Asc.asc_CParagraphFrame,this.isFrame&&e&&void 0!==e.get_W()&&this._changedProps.put_W(e.get_W()),this.ChangedBorders=void 0}},_DisableElem:function(t){var e=t===Asc.c_oAscDropCap.None||t===c_oAscFrameWrap.None;_.each(this.btnsCategory,function(t){"id-adv-dropcap-borders"!=t.options.contentTarget&&"id-adv-dropcap-margins"!=t.options.contentTarget||t.setDisabled(e)}),this.isFrame?(e=t==c_oAscFrameWrap.None,this.cmbHAlign.setDisabled(e),this.cmbHRelative.setDisabled(e),this.spnX.setDisabled(e),this.cmbVAlign.setDisabled(e),this.cmbVRelative.setDisabled(e),this.spnY.setDisabled(e),this.chMove.setDisabled(e),this.cmbWidth.setDisabled(e),this.cmbHeight.setDisabled(e),this.spnWidth.setDisabled(e),this.spnHeight.setDisabled(e)):(e=t==Asc.c_oAscDropCap.None,this.spnRowHeight.setDisabled(e),this.numDistance.setDisabled(e),this.cmbFonts.setDisabled(e))},_UpdateBorders:function(){var t=this.BorderSize,e=this.btnBorderColor.color;if(this._UpdateBorder(this.Borders.get_Left(),"l"),this._UpdateBorder(this.Borders.get_Top(),"t"),this._UpdateBorder(this.Borders.get_Right(),"r"),this._UpdateBorder(this.Borders.get_Bottom(),"b"),null!==this.Borders.get_Between())for(var i=0;i<this.tableStyler.columns;i++)this._UpdateCellBorder(this.Borders.get_Between(),"b",this.tableStyler.getCell(i,0)),this._UpdateCellBorder(this.Borders.get_Between(),"t",this.tableStyler.getCell(i,1));this.tableStyler.setVirtualBorderSize(t.pxValue),this.tableStyler.setVirtualBorderColor("object"==typeof e?e.color:e)},_UpdateCellBorder:function(t,e,i){null!==t&&void 0!==t&&null!==t.get_Value()&&null!==t.get_Size()&&null!==t.get_Color()&&1==t.get_Value()?(i.setBordersSize(e,this._BorderPt2Px(72*t.get_Size()/25.4)),i.setBordersColor(e,"rgb("+t.get_Color().get_r()+","+t.get_Color().get_g()+","+t.get_Color().get_b()+")")):i.setBordersSize(e,0)},_UpdateBorder:function(t,e){null!==t&&void 0!==t&&null!==t.get_Value()&&null!==t.get_Size()&&null!==t.get_Color()&&1==t.get_Value()?(this.tableStyler.setBordersSize(e,this._BorderPt2Px(72*t.get_Size()/25.4)),this.tableStyler.setBordersColor(e,"rgb("+t.get_Color().get_r()+","+t.get_Color().get_g()+","+t.get_Color().get_b()+")")):this.tableStyler.setBordersSize(e,0)},_BorderPt2Px:function(t){return 0==t?0:t<.6?.5:t<=1?1:t<=1.5?2:t<=2.25?3:t<=3?4:t<=4.5?5:6},_ApplyBorderPreset:function(t){this.ChangedBorders=null,this.Borders.put_Left(this._UpdateBorderStyle(this.Borders.get_Left(),t.indexOf("l")>-1)),this.Borders.put_Top(this._UpdateBorderStyle(this.Borders.get_Top(),t.indexOf("t")>-1)),this.Borders.put_Right(this._UpdateBorderStyle(this.Borders.get_Right(),t.indexOf("r")>-1)),this.Borders.put_Bottom(this._UpdateBorderStyle(this.Borders.get_Bottom(),t.indexOf("b")>-1)),this.Borders.put_Between(this._UpdateBorderStyle(this.Borders.get_Between(),t.indexOf("m")>-1)),this._UpdateBorders()},_UpdateBorderStyle:function(t,e){if(null==t&&(t=new Asc.asc_CTextBorder),e&&this.BorderSize.ptValue>0){var i=parseFloat(this.BorderSize.ptValue);t.put_Value(1),t.put_Size(25.4*i/72);var n;this.btnBorderColor.isAutoColor()?(n=new Asc.asc_CColor,n.put_auto(!0)):n=Common.Utils.ThemeColor.getRgbColor(this.btnBorderColor.color),t.put_Color(n)}else t.put_Color(new Asc.asc_CColor),t.put_Value(0);return t},_UpdateCellBordersStyle:function(t,e,i,n,o){var s=o;0==t.col&&e.indexOf("l")>-1&&(s.put_Left(this._UpdateBorderStyle(s.get_Left(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Left(new Asc.asc_CTextBorder(s.get_Left()))),t.col==this.tableStylerColumns-1&&e.indexOf("r")>-1&&(s.put_Right(this._UpdateBorderStyle(s.get_Right(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Right(new Asc.asc_CTextBorder(s.get_Right()))),0==t.row&&e.indexOf("t")>-1&&(s.put_Top(this._UpdateBorderStyle(s.get_Top(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Top(new Asc.asc_CTextBorder(s.get_Top()))),t.row==this.tableStylerRows-1&&e.indexOf("b")>-1&&(s.put_Bottom(this._UpdateBorderStyle(s.get_Bottom(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Bottom(new Asc.asc_CTextBorder(s.get_Bottom()))),(0==t.row&&e.indexOf("b")>-1||t.row==this.tableStylerRows-1&&e.indexOf("t")>-1)&&(s.put_Between(this._UpdateBorderStyle(s.get_Between(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Between(new Asc.asc_CTextBorder(s.get_Between())))},_UpdateTableBordersStyle:function(t,e,i,n,o){var s=o;e.indexOf("l")>-1&&(s.put_Left(this._UpdateBorderStyle(s.get_Left(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Left(new Asc.asc_CTextBorder(s.get_Left()))),e.indexOf("t")>-1&&(s.put_Top(this._UpdateBorderStyle(s.get_Top(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Top(new Asc.asc_CTextBorder(s.get_Top()))),e.indexOf("r")>-1&&(s.put_Right(this._UpdateBorderStyle(s.get_Right(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Right(new Asc.asc_CTextBorder(s.get_Right()))),e.indexOf("b")>-1&&(s.put_Bottom(this._UpdateBorderStyle(s.get_Bottom(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Bottom(new Asc.asc_CTextBorder(s.get_Bottom())))},textTitle:"Drop Cap - Advanced Settings",strBorders:"Borders & Fill",textBorderWidth:"Border Size",textBorderColor:"Border Color",textBackColor:"Background Color",textBorderDesc:"Click on diagramm or use buttons to select borders",txtNoBorders:"No borders",textPosition:"Position",textAlign:"Alignment",textTop:"Top",textLeft:"Left",textBottom:"Bottom",textRight:"Right",textCenter:"Center",strMargins:"Margins",strDropcap:"Drop Cap",textNone:"None",textInText:"In text",textInMargin:"In margin",textParameters:"Parameters",textRowHeight:"Height in rows",textDistance:"Distance from text",textFont:"Font",textInline:"Inline frame",textFlow:"Flow frame",textFrame:"Frame",textWidth:"Width",textHeight:"Height",textAuto:"Auto",textExact:"Exactly",textAtLeast:"At least",textMove:"Move with text",textHorizontal:"Horizontal",textVertical:"Vertical",textRelative:"Relative to",textColumn:"Column",textMargin:"Margin",textPage:"Page",textParagraph:"Paragraph",tipFontName:"Font Name",textTitleFrame:"Frame - Advanced Settings"},DE.Views.DropcapSettingsAdvanced||{}))}),function(t){var e=t.fn.tooltip;e.prototype=t.fn.tooltip.Constructor.prototype,t.extend(t.fn.tooltip.Constructor.DEFAULTS,{container:"body",delay:{show:500},arrow:!1});var i=function(t,e){this.init("tooltip",t,e)};i.prototype=t.extend({},t.fn.tooltip.Constructor.prototype,{constructor:i,init:function(){e.prototype.init.apply(this,arguments),"cursor"==this.options.placement&&/hover/.exec(this.options.trigger)&&this.$element.on("mousemove.tooltip",this.options.selector,t.proxy(this.mousemove,this)),this.options.zIndex&&this.tip().css("z-index",this.options.zIndex);var i=this;Common.NotificationCenter.on({"layout:changed":function(t){!i.options.hideonclick&&i.tip().is(":visible")&&i.hide()}})},mousemove:function(t){this.targetXY=[t.clientX*Common.Utils.zoom(),t.clientY*Common.Utils.zoom()]},leave:function(t){e.prototype.leave.apply(this,arguments),this.dontShow=void 0},show:function(i){if(this.hasContent()&&this.enabled&&!this.dontShow){if(!this.$element.is(":visible")&&this.$element.closest("[role=menu]").length>0)return;var n=this.tip();!1===this.options.arrow&&n.addClass("arrow-free"),this.options.cls&&n.addClass(this.options.cls);var o="function"!=typeof this.options.placement?/^([a-zA-Z]+)-?([a-zA-Z]*)$/.exec(this.options.placement):null;if(i||!o||o[2].length){var s=t.Event("show.bs.tooltip");if(this.$element.trigger(s),s.isDefaultPrevented())return;if(this.setContent(),this.options.animation&&n.addClass("fade"),n.detach().css({top:0,left:0,display:"block"}),this.options.container?n.appendTo(this.options.container):n.insertAfter(this.$element),"function"==typeof this.options.placement)this.options.placement.call(this,n[0],this.$element[0]);else if("object"==typeof i){var a={top:i[1]+15,left:i[0]+18},r=Common.Utils.innerWidth(),l=Common.Utils.innerHeight();a.left+n.width()>r&&(a.left=r-n.width()-30),a.top+n.height()>l&&(a.top=l-n.height()-30),n.offset(a).addClass("in")}else{var c=this.getPosition(),d=n[0].offsetWidth,h=n[0].offsetHeight;switch(o[1]){case"bottom":a={top:c.top+c.height+10};break;case"top":a={top:c.top-h-10}}switch(o[2]){case"left":a.left=c.left,this.$element.outerWidth()<=18&&(a.left-=4);break;case"right":a.left=c.left+c.width-d,this.$element.outerWidth()<=18&&(a.left+=4)}this.applyPlacement(a,o[1]),this.moveArrow(),n.addClass(o[1]).addClass(o[0])}this.$element.trigger("shown.bs.tooltip")}else e.prototype.show.apply(this,arguments);var p=this;clearTimeout(p.timeout),p.timeout=setTimeout(function(){"in"==p.hoverState&&p.hide(),p.dontShow=!1},5e3)}},moveArrow:function(){var t=this.tip().find(".tooltip-arrow, .arrow");switch(this.options.placement){case"top-left":case"bottom-left":t.css("left",10);break;case"top-right":case"bottom-right":t.css("right",10)}},enter:function(e){if("mouseenter"===e.type){var i=t(e.target);if(!(i.is("[role=menu]")||i.parentsUntil(e.currentTarget,"[role=menu]").length&&e.target!==e.currentTarget||this.tip().is(":visible"))){var n=e instanceof this.constructor?e:t(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs.tooltip");clearTimeout(n.timeout),n.hoverState="in",n.options.delay&&n.options.delay.show?n.timeout=setTimeout(function(){"in"==n.hoverState&&n.show("cursor"==n.options.placement?n.targetXY:void 0)},n.options.delay.show):n.show()}}},replaceArrow:function(t,i,n){!1===this.options.arrow?this.arrow().hide():e.prototype.replaceArrow.apply(this,arguments)},getCalculatedOffset:function(t,i,n,o){var s=e.prototype.getCalculatedOffset.apply(this,arguments);if(this.options.offset>0||this.options.offset<0)switch(/(bottom|top)/.exec(t)[1]){case"bottom":s.top+=this.options.offset;break;case"top":s.top-=this.options.offset}return s}});var n=t.fn.tooltip;t.fn.tooltip=function(e){return this.each(function(){var n=t(this),o=n.data("bs.tooltip"),s="object"==typeof e&&e;o||n.data("bs.tooltip",o=new i(this,s)),"string"==typeof e&&o[e]()})},t.fn.tooltip.Constructor=i,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=n,this}}(window.jQuery),define("tip",function(){}),define("common/main/lib/component/Tooltip",["tip","backbone"],function(){"use strict";var t=function(t){this.$element=this.placement=void 0,this.init.call(this,t)};_.extend(t.prototype,Backbone.Events,{init:function(t){if(this.$element=t.owner instanceof Backbone.View?t.owner.$el:$(t.owner),this.placement=t.placement,this.$element.data("bs.tooltip")&&this.$element.removeData("bs.tooltip"),this.$element.tooltip({title:t.title,trigger:"manual",placement:t.placement,offset:t.offset,cls:t.cls,html:t.html,hideonclick:t.hideonclick}),t.hideonclick){var e=this.$element.data("bs.tooltip");e&&e.tip().on("click",function(){e.hide()})}this.$element.on("shown.bs.tooltip",_.bind(this.onTipShown,this)),this.$element.on("hidden.bs.tooltip",_.bind(this.onTipHidden,this))},show:function(t){this.getBSTip().show(t)},hide:function(t){this.getBSTip().hide(t)},setTitle:function(t){var e=this.getBSTip();e&&(e.options.title=t)},updateTitle:function(){var t=this.getBSTip();t.$tip.find(".tooltip-inner")[t.options.html?"html":"text"](t.options.title)},getBSTip:function(){return this.$element.data("bs.tooltip")},onTipShown:function(){this.trigger("tooltip:show",this)},onTipHidden:function(){this.trigger("tooltip:hide",this)},isVisible:function(){return this.getBSTip().tip().is(":visible")}}),Common.UI=Common.UI||{},Common.UI.Tooltip=t}),void 0===Common)var Common={};if(define("common/main/lib/component/InputField",["common/main/lib/component/BaseView","common/main/lib/component/Tooltip","common/main/lib/component/Button"],function(){"use strict";Common.UI.InputField=Common.UI.BaseView.extend(function(){return{options:{id:null,cls:"",style:"",value:"",type:"text",name:"",validation:null,allowBlank:!0,placeHolder:"",blankError:null,spellcheck:!1,maskExp:"",validateOnChange:!1,validateOnBlur:!0,disabled:!1,editable:!0},template:_.template(['<div class="input-field" style="<%= style %>">',"<input ",'type="<%= type %>" ','name="<%= name %>" ','spellcheck="<%= spellcheck %>" ','class="form-control <%= cls %>" ','placeholder="<%= placeHolder %>" ','value="<%= value %>"',">",'<span class="input-error"></span>',"</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=e.options.id||Common.UI.getId(),this.cls=e.options.cls,this.style=e.options.style,this.value=e.options.value,this.type=e.options.type,this.name=e.options.name,this.validation=e.options.validation,this.allowBlank=e.options.allowBlank,this.placeHolder=e.options.placeHolder,this.template=e.options.template||e.template,this.editable=e.options.editable,this.disabled=e.options.disabled,this.spellcheck=e.options.spellcheck,this.blankError=e.options.blankError||"This field is required",this.validateOnChange=e.options.validateOnChange,this.validateOnBlur=e.options.validateOnBlur,this.maxLength=e.options.maxLength,e.rendered=e.options.rendered||!1,e.options.el&&e.render()},render:function(t){var e=this;if(e.rendered?this.cmpEl=this.$el:(this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,value:this.value,type:this.type,name:this.name,placeHolder:this.placeHolder,spellcheck:this.spellcheck,scope:e})),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl)),!e.rendered){var i=this.cmpEl;if(this._input=this.cmpEl.find("input").addBack().filter("input"),this.editable&&(this._input.on("blur",_.bind(this.onInputChanged,this)),this._input.on("keypress",_.bind(this.onKeyPress,this)),this._input.on("keydown",_.bind(this.onKeyDown,this)),this._input.on("keyup",_.bind(this.onKeyUp,this)),this.validateOnChange&&this._input.on("input",_.bind(this.onInputChanging,this)),this.maxLength&&this._input.attr("maxlength",this.maxLength)),this.setEditable(this.editable),this.disabled&&this.setDisabled(this.disabled),this._input.closest(".asc-window").length>0)var n=function(){var t=i.find(".input-error").data("bs.tooltip");t&&t.tip().remove(),Common.NotificationCenter.off({"modal:close":n})};Common.NotificationCenter.on({"modal:close":n})}return e.rendered=!0,this},_doChange:function(t,e){if(!e||!e.synthetic){var i=$(t.target).val(),n=this.value;this.trigger("changed:before",this,i,n,t),t.isDefaultPrevented()||(this.value=i,this.validateOnBlur&&this.checkValidate(),this.trigger("changed:after",this,i,n,t))}},onInputChanged:function(t,e){this._doChange(t,e)},onInputChanging:function(t,e){var i=$(t.target).val(),n=this.value;t.isDefaultPrevented()||(this.value=i,this.validateOnBlur&&this.checkValidate(),this.trigger("changing",this,i,n,t))},onKeyPress:function(t){if(this.trigger("keypress:before",this,t),!t.isDefaultPrevented()){if(this.options.maskExp&&!_.isEmpty(this.options.maskExp.source)){var e=String.fromCharCode(t.which);this.options.maskExp.test(e)||t.ctrlKey||t.keyCode===Common.UI.Keys.RETURN||(t.preventDefault(),t.stopPropagation())}this.trigger("keypress:after",this,t)}},onKeyDown:function(t){this.trigger("keydown:before",this,t),t.isDefaultPrevented()||(t.keyCode===Common.UI.Keys.RETURN&&this._doChange(t),t.keyCode==Common.UI.Keys.ESC&&this.setValue(this.value),t.keyCode!=Common.UI.Keys.RETURN&&t.keyCode!=Common.UI.Keys.ESC||this.trigger("inputleave",this))},onKeyUp:function(t){this.trigger("keyup:before",this,t),t.isDefaultPrevented()||this.trigger("keyup:after",this,t)},setEditable:function(t){var e=this._input;this.editable=t,t&&e?(e.removeAttr("readonly"),e.removeAttr("data-can-copy")):(e.attr("readonly","readonly"),e.attr("data-can-copy",!1))},isEditable:function(){return this.editable},setDisabled:function(t){this.disabled=t,$(this.el).toggleClass("disabled",t),t?this._input.attr("disabled",!0):this._input.removeAttr("disabled")},isDisabled:function(){return this.disabled},setValue:function(t){this.value=t,this.rendered&&this._input.val(t)},getValue:function(){return this.value},focus:function(){this._input&&this._input.focus()},checkValidate:function(){var t=this,e=[];if(!t.allowBlank&&_.isEmpty(t.value)&&e.push(t.blankError),_.isFunction(t.validation)){var i=t.validation.call(t,t.value);!0!==i&&(e=_.flatten(e.concat(i)))}if(!_.isEmpty(e)){if(t.cmpEl.hasClass("error")){var n=t.cmpEl.find(".input-error").data("bs.tooltip");return n&&(n.options.title=e.join("\n"),n.setContent()),e}t.cmpEl.addClass("error");var o=t.cmpEl.find(".input-error"),s=o.closest(".asc-window"),n=o.data("bs.tooltip");return n&&n.tip().remove(),o.attr("data-toggle","tooltip"),o.removeData("bs.tooltip"),o.tooltip({title:e.join("\n"),placement:"cursor"}),s.length>0&&o.data("bs.tooltip").tip().css("z-index",parseInt(s.css("z-index"))+10),e}return t.cmpEl.removeClass("error"),!0},showError:function(t,e){var i=this;if(_.isEmpty(t))i.cmpEl.removeClass("error"),i.cmpEl.removeClass("warning");else{i.cmpEl.addClass(e?"warning":"error");var n=i.cmpEl.find(".input-error"),o=n.closest(".asc-window"),s=n.data("bs.tooltip");s&&s.tip().remove(),n.attr("data-toggle","tooltip"),n.removeData("bs.tooltip"),n.tooltip({title:t.join("\n"),placement:"cursor"}),o.length>0&&n.data("bs.tooltip").tip().css("z-index",parseInt(o.css("z-index"))+10)}},showWarning:function(t){this.showError(t,!0)}}}()),Common.UI.InputFieldBtn=Common.UI.InputField.extend(function(){return{options:{id:null,cls:"",style:"",value:"",type:"text",name:"",validation:null,allowBlank:!0,placeHolder:"",blankError:null,spellcheck:!1,maskExp:"",validateOnChange:!1,validateOnBlur:!0,disabled:!1,editable:!0,iconCls:"btn-select-range",btnHint:""},template:_.template(['<div class="input-field input-field-btn" style="<%= style %>">',"<input ",'type="<%= type %>" ','name="<%= name %>" ','spellcheck="<%= spellcheck %>" ','class="form-control <%= cls %>" ','placeholder="<%= placeHolder %>" ','value="<%= value %>"',">",'<span class="input-error"></span>','<div class="select-button"><button type="button" class="btn btn-toolbar"><i class="icon toolbar__icon <%= iconCls %>"></i></button></div>',"</div>"].join("")),render:function(t){var e=this;if(e.rendered?this.cmpEl=this.$el:(this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,value:this.value,type:this.type,name:this.name,placeHolder:this.placeHolder,spellcheck:this.spellcheck,iconCls:this.options.iconCls,scope:e})),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl)),!e.rendered){var i=this.cmpEl;if(this._button=new Common.UI.Button({el:this.cmpEl.find("button"),hint:this.options.btnHint||""}),this._button.on("click",_.bind(this.onButtonClick,this)),this._input=this.cmpEl.find("input").addBack().filter("input"),this.editable&&(this._input.on("blur",_.bind(this.onInputChanged,this)),this._input.on("keypress",_.bind(this.onKeyPress,this)),this._input.on("keydown",_.bind(this.onKeyDown,this)),this._input.on("keyup",_.bind(this.onKeyUp,this)),this.validateOnChange&&this._input.on("input",_.bind(this.onInputChanging,this)),this.maxLength&&this._input.attr("maxlength",this.maxLength)),this.setEditable(this.editable),this.disabled&&this.setDisabled(this.disabled),this._input.closest(".asc-window").length>0)var n=function(){var t=i.find(".input-error").data("bs.tooltip");t&&t.tip().remove(),Common.NotificationCenter.off({"modal:close":n})};Common.NotificationCenter.on({"modal:close":n})}return e.rendered=!0,this},onButtonClick:function(t,e){this.trigger("button:click",this,e)},setDisabled:function(t){this.disabled=t,$(this.el).toggleClass("disabled",t),t?this._input.attr("disabled",!0):this._input.removeAttr("disabled"),this._button.setDisabled(t)},setBtnDisabled:function(t){this._button.setDisabled(t)},updateBtnHint:function(t){this.options.hint=t,this.rendered&&this._button.updateHint(this.options.hint)}}}())}),void 0===Common)var Common={};var c_oHyperlinkType={InternalLink:0,WebLink:1};if(define("documenteditor/main/app/view/HyperlinkSettingsDialog",["common/main/lib/util/utils","common/main/lib/component/InputField","common/main/lib/component/Window"],function(){"use strict";DE.Views.HyperlinkSettingsDialog=Common.UI.Window.extend(_.extend({options:{width:350,style:"min-width: 230px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box" style="height: 319px;">','<div class="input-row" style="margin-bottom: 10px;">','<button type="button" class="btn btn-text-default auto" id="id-dlg-hyperlink-external" style="border-top-right-radius: 0;border-bottom-right-radius: 0;">',this.textExternal,"</button>",'<button type="button" class="btn btn-text-default auto" id="id-dlg-hyperlink-internal" style="border-top-left-radius: 0;border-bottom-left-radius: 0;border-left-width: 0;margin-left: -1px;">',this.textInternal,"</button>","</div>",'<div id="id-external-link">','<div class="input-row">',"<label>"+this.textUrl+"</label>","</div>",'<div id="id-dlg-hyperlink-url" class="input-row" style="margin-bottom: 5px;"></div>',"</div>",'<div id="id-internal-link">','<div class="input-row">',"<label>"+this.textUrl+"</label>","</div>",'<div id="id-dlg-hyperlink-list" style="width:100%; height: 171px;"></div>',"</div>",'<div class="input-row">',"<label>"+this.textDisplay+"</label>","</div>",'<div id="id-dlg-hyperlink-display" class="input-row" style="margin-bottom: 5px;"></div>','<div class="input-row">',"<label>"+this.textTooltip+"</label>","</div>",'<div id="id-dlg-hyperlink-tip" class="input-row" style="margin-bottom: 5px;"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.api=this.options.api,this._originalProps=null,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this,e=this.getChild();t.btnExternal=new Common.UI.Button({el:$("#id-dlg-hyperlink-external"),enableToggle:!0,toggleGroup:"hyperlink-type",allowDepress:!1,pressed:!0}),t.btnExternal.on("click",_.bind(t.onLinkTypeClick,t,c_oHyperlinkType.WebLink)),t.btnInternal=new Common.UI.Button({el:$("#id-dlg-hyperlink-internal"),enableToggle:!0,toggleGroup:"hyperlink-type",allowDepress:!1}),t.btnInternal.on("click",_.bind(t.onLinkTypeClick,t,c_oHyperlinkType.InternalLink)),t.inputUrl=new Common.UI.InputField({el:$("#id-dlg-hyperlink-url"),allowBlank:!1,blankError:t.txtEmpty,style:"width: 100%;",validateOnBlur:!1,validation:function(e){var i=$.trim(e);if(i.length>2083)return t.txtSizeLimit;var n=t.api.asc_getUrlType(i);return t.isEmail=2==n,n>0||t.txtNotUrl}}),t.inputUrl._input.on("input",function(e){t.isInputFirstChange&&t.inputUrl.showError(),t.isInputFirstChange=!1;var i=$(e.target).val();t.isAutoUpdate&&(t.inputDisplay.setValue(i),t.isTextChanged=!0),t.btnOk.setDisabled(""==$.trim(i))}),t.inputDisplay=new Common.UI.InputField({el:$("#id-dlg-hyperlink-display"),allowBlank:!0,validateOnBlur:!1,style:"width: 100%;"}).on("changed:after",function(){t.isTextChanged=!0}),t.inputDisplay._input.on("input",function(e){t.isAutoUpdate=""==$(e.target).val()}),t.inputTip=new Common.UI.InputField({el:$("#id-dlg-hyperlink-tip"),style:"width: 100%;",maxLength:Asc.c_oAscMaxTooltipLength}),t.internalList=new Common.UI.TreeView({el:$("#id-dlg-hyperlink-list"),store:new Common.UI.TreeViewStore,enableKeyEvents:!0,tabindex:1}),t.internalList.on("item:select",_.bind(this.onSelectItem,this)),t.btnOk=new Common.UI.Button({el:e.find(".primary")}),e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),t.internalList.on("entervalue",_.bind(t.onPrimary,t)),t.externalPanel=e.find("#id-external-link"),t.internalPanel=e.find("#id-internal-link")},getFocusedComponents:function(){return[this.inputUrl,this.internalList,this.inputDisplay,this.inputTip]},ShowHideElem:function(t){this.externalPanel.toggleClass("hidden",t!==c_oHyperlinkType.WebLink),this.internalPanel.toggleClass("hidden",t!==c_oHyperlinkType.InternalLink);var e=this.internalList.store;if(t==c_oHyperlinkType.InternalLink){if(e.length<1){var i=this.api.asc_GetHyperlinkAnchors(),n=i.length,o=0,s=0,a=[];a.push(new Common.UI.TreeViewModel({name:this.txtBeginning,level:0,index:0,hasParent:!1,isEmptyItem:!1,isNotHeader:!0,hasSubItems:!1})),a.push(new Common.UI.TreeViewModel({name:this.txtHeadings,level:0,index:1,hasParent:!1,isEmptyItem:!1,isNotHeader:!1,type:Asc.c_oAscHyperlinkAnchor.Heading,hasSubItems:!1}));for(var r=0;r<n;r++){var l=i[r],c=i[r].asc_GetHeadingLevel()+1,d=!0;l.asc_GetType()==Asc.c_oAscHyperlinkAnchor.Heading&&(c>o&&a[a.length-1].set("hasSubItems",!0),c<=s&&(s=c,d=!1),a.push(new Common.UI.TreeViewModel({name:l.asc_GetHeadingText(),level:c,index:r+2,hasParent:d,type:Asc.c_oAscHyperlinkAnchor.Heading,headingParagraph:l.asc_GetHeadingParagraph()})),o=c)}a.push(new Common.UI.TreeViewModel({name:this.txtBookmarks,level:0,index:a.length,hasParent:!1,isEmptyItem:!1,isNotHeader:!1,type:Asc.c_oAscHyperlinkAnchor.Bookmark,hasSubItems:!1})),o=0;for(var r=0;r<n;r++){var l=i[r],d=!0;l.asc_GetType()==Asc.c_oAscHyperlinkAnchor.Bookmark&&(o<1&&a[a.length-1].set("hasSubItems",!0),a.push(new Common.UI.TreeViewModel({name:l.asc_GetBookmarkName(),level:1,index:a.length,hasParent:!1,type:Asc.c_oAscHyperlinkAnchor.Bookmark})),o=1)}e.reset(a),this.internalList.collapseAll()}var h=this.internalList.getSelectedRec();this.btnOk.setDisabled(!h||0==h.get("level")&&h.get("index")>0);var p=this;_.delay(function(){p.inputDisplay.focus()},50)}else{this.btnOk.setDisabled(""==$.trim(this.inputUrl.getValue()));var p=this;_.delay(function(){p.inputUrl.focus()},50)}},onLinkTypeClick:function(t,e,i){if(this.ShowHideElem(t),this.isAutoUpdate){if(t==c_oHyperlinkType.InternalLink){var n=this.internalList.getSelectedRec();this.inputDisplay.setValue(n&&(n.get("level")||0==n.get("index"))?n.get("name"):"")}else this.inputDisplay.setValue(this.inputUrl.getValue());this.isTextChanged=!0}},onSelectItem:function(t,e,i,n){this.btnOk.setDisabled(0==i.get("level")&&i.get("index")>0),this.isAutoUpdate&&(this.inputDisplay.setValue(i.get("level")||0==i.get("index")?i.get("name"):""),this.isTextChanged=!0)},show:function(){Common.UI.Window.prototype.show.apply(this,arguments)},setSettings:function(t){if(t){var e=this,i=t.get_Bookmark(),n=(null===i||""==i)&&(t.get_Value()||!Common.Utils.InternalSettings.get("de-settings-link-type"))?c_oHyperlinkType.WebLink:c_oHyperlinkType.InternalLink;if(n==c_oHyperlinkType.WebLink?e.btnExternal.toggle(!0):e.btnInternal.toggle(!0),e.ShowHideElem(n),n==c_oHyperlinkType.WebLink)t.get_Value()?e.inputUrl.setValue(t.get_Value().replace(new RegExp(" ","g"),"%20")):e.inputUrl.setValue(""),this.btnOk.setDisabled(""==$.trim(this.inputUrl.getValue()));else{if(t.is_TopOfDocument())this.internalList.selectByIndex(0);else if(t.is_Heading()){var o=this.internalList.store.findWhere({type:Asc.c_oAscHyperlinkAnchor.Heading,headingParagraph:t.get_Heading()});o&&(this.internalList.expandRecord(this.internalList.store.at(1)),this.internalList.scrollToRecord(this.internalList.selectRecord(o)))}else{var o=this.internalList.store.findWhere({type:Asc.c_oAscHyperlinkAnchor.Bookmark,name:i});o&&(this.internalList.expandRecord(this.internalList.store.findWhere({type:Asc.c_oAscHyperlinkAnchor.Bookmark,level:0})),this.internalList.scrollToRecord(this.internalList.selectRecord(o)))}var o=this.internalList.getSelectedRec();this.btnOk.setDisabled(!o||0==o.get("level")&&o.get("index")>0)}null!==t.get_Text()?(e.inputDisplay.setValue(t.get_Text()),e.inputDisplay.setDisabled(!1),e.isAutoUpdate=""==e.inputDisplay.getValue()||n==c_oHyperlinkType.WebLink&&e.inputUrl.getValue()==e.inputDisplay.getValue()):(e.inputDisplay.setValue(this.textDefault),e.inputDisplay.setDisabled(!0)),this.isTextChanged=!1,e.inputTip.setValue(t.get_ToolTip()),e._originalProps=t}},getSettings:function(){var t=this,e=new Asc.CHyperlinkProperty,i="",n=this.btnExternal.isActive()?c_oHyperlinkType.WebLink:c_oHyperlinkType.InternalLink;if(n==c_oHyperlinkType.WebLink){var o=$.trim(t.inputUrl.getValue());/(((^https?)|(^ftp)):\/\/)|(^mailto:)/i.test(o)||(o=(t.isEmail?"mailto:":"http://")+o),o=o.replace(new RegExp("%20","g")," "),e.put_Value(o),e.put_Bookmark(null),i=o}else{var s=this.internalList.getSelectedRec();if(s){e.put_Bookmark(s.get("name")),0==s.get("index")&&e.put_TopOfDocument();var a=s.get("headingParagraph");a&&e.put_Heading(a),i=s.get("name")}}return t.inputDisplay.isDisabled()||!t.isTextChanged&&!_.isEmpty(t.inputDisplay.getValue())?e.put_Text(null):((_.isEmpty(t.inputDisplay.getValue())||n==c_oHyperlinkType.WebLink&&t.isAutoUpdate)&&t.inputDisplay.setValue(i),e.put_Text(t.inputDisplay.getValue())),e.put_ToolTip(t.inputTip.getValue()),e.put_InternalHyperlink(t._originalProps.get_InternalHyperlink()),e},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(t){return this._handleInput("ok"),!1},_handleInput:function(t){if(this.options.handler){if("ok"==t){if(this.btnExternal.isActive()){if(!0!==this.inputUrl.checkValidate())return this.isInputFirstChange=!0,void this.inputUrl.focus()}else{var e=this.internalList.getSelectedRec();if(!e||0==e.get("level")&&e.get("index")>0)return}if(!0!==this.inputDisplay.checkValidate())return void this.inputDisplay.focus();!this._originalProps.get_Bookmark()&&!this._originalProps.get_Value()&&Common.Utils.InternalSettings.set("de-settings-link-type",this.btnInternal.isActive())}this.options.handler.call(this,this,t)}this.close()},textUrl:"Link to",textDisplay:"Display",txtEmpty:"This field is required",txtNotUrl:'This field should be a URL in the format "http://www.example.com"',textTooltip:"ScreenTip text",textDefault:"Selected text",textTitle:"Hyperlink Settings",textExternal:"External Link",textInternal:"Place in Document",txtBeginning:"Beginning of document",txtHeadings:"Headings",txtBookmarks:"Bookmarks",txtSizeLimit:"This field is limited to 2083 characters"},DE.Views.HyperlinkSettingsDialog||{}))}),define("text!documenteditor/main/app/template/ParagraphSettingsAdvanced.template",[],function(){
return'<div id="id-adv-paragraph-indents" class="settings-panel active">\r\n    <div class="inner-content">\r\n            <div>\r\n                <div class="padding-large" style="display: inline-block;">\r\n                    <label class="input-label"><%= scope.textAlign %></label>\r\n                    <div id="paragraphadv-spin-text-alignment"></div>\r\n                </div>\r\n                <div class="padding-large text-only" style="float: right;">\r\n                    <label class="input-label"><%= scope.strIndentsOutlinelevel %></label>\r\n                    <div id="paragraphadv-spin-outline-level"></div>\r\n                </div>\r\n            </div>\r\n            <div><label class="header" style="padding-bottom: 4px;"><%= scope.strIndent %></label></div>\r\n            <div>\r\n                <div class="padding-large" style="display: inline-block;margin-right: 3px;">\r\n                 <label class="input-label"><%= scope.strIndentsLeftText %></label>\r\n                    <div id="paragraphadv-spin-indent-left"></div>\r\n                </div>\x3c!--\r\n             --\x3e<div class="padding-large" style="display: inline-block;margin-right: 3px;">\r\n                    <label class="input-label"><%= scope.strIndentsRightText %></label>\r\n                    <div id="paragraphadv-spin-indent-right"></div>\r\n                </div>\x3c!--\r\n             --\x3e<div class="padding-large" style="display: inline-block;vertical-align: top">\r\n                    <div>\r\n                        <label class="input-label"><%= scope.strIndentsSpecial %></label>\r\n                    </div>\r\n                <div>\r\n                        <div id="paragraphadv-spin-special" style="display: inline-block; margin-right: 3px;"></div>\x3c!--\r\n                     --\x3e<div id="paragraphadv-spin-special-by" style="display: inline-block;"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div><label class="header" style="padding-bottom: 4px;"><%= scope.strSpacing %></label></div>\r\n            <div>\r\n                <div style="display: inline-block;margin-right: 3px;">\r\n                    <label class="input-label"><%= scope.strIndentsSpacingBefore %></label>\r\n                    <div id="paragraphadv-spin-spacing-before"></div>\r\n                </div>\x3c!--\r\n             --\x3e<div style="display: inline-block;margin-right: 3px;">\r\n                    <label class="input-label"><%= scope.strIndentsSpacingAfter %></label>\r\n                    <div id="paragraphadv-spin-spacing-after"></div>\r\n                </div>\x3c!--\r\n             --\x3e<div style="display: inline-block;vertical-align: top">\r\n                    <div>\r\n                        <label class="input-label"><%= scope.strIndentsLineSpacing %></label>\r\n                    </div>\r\n                    <div>\r\n                        <div id="paragraphadv-spin-line-rule" style="display: inline-block;margin-right: 3px;"></div>\x3c!--\r\n                     --\x3e<div id="paragraphadv-spin-line-height" style="display: inline-block;"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="text-only" style="padding-top: 8px;">\r\n                <div id="paragraphadv-checkbox-add-interval"></div>\r\n            </div>\r\n            <div class="padding-large" style="padding-top: 16px; display: none;">\r\n                <div style="border: 1px solid #cbcbcb; width: 350px;">\r\n                    <div id="paragraphadv-indent-preview" style="height: 58px; position: relative;"></div>\r\n                </div>\r\n            </div>\r\n    </div>\r\n</div>\r\n<div id="id-adv-paragraph-line" class="settings-panel">\r\n    <div class="inner-content text-only" style="padding-right: 0px;" >\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <div id="paragraphadv-checkbox-break-before"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <div id="paragraphadv-checkbox-keep-lines"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <div id="paragraphadv-checkbox-orphan"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <div id="paragraphadv-checkbox-keep-next"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" colspan="2">\r\n                    <div id="paragraphadv-checkbox-suppress-line-numbers"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-adv-paragraph-borders" class="settings-panel">\r\n    <div class="inner-content">\r\n        <div style="width: 100%;" class="padding-small">\r\n            <label class="input-label"><%= scope.textBorderWidth %></label>\r\n            <div id="paragraphadv-combo-border-size" style="display: inline-block; vertical-align: middle; width: 93px;"></div>\r\n            <div style="display: inline-block; vertical-align: middle; padding-left: 20px;">\r\n                <label class="input-label" ><%= scope.textBorderColor %></label>\r\n                <div id="paragraphadv-border-color-btn" style="display: inline-block;"></div>\r\n            </div>\r\n        </div>\r\n        <label class="input-label padding-small" style="width: 100%;"><%= scope.textBorderDesc %></label>\r\n        <div style="width: 100%;" class="padding-large">\r\n            <div id="id-deparagraphstyler" style="display: inline-block; vertical-align: middle; width: 200px; height: 170px;outline: 1px solid #ccc; margin-top: 2px;"></div>\r\n            <div style="display: inline-block; vertical-align: top; width: 76px; text-align: right; height: 170px; padding-top: 0px; margin-left: 9px;">\r\n                <div id="paragraphadv-button-border-top" style="display: inline-block;"></div>\r\n                <div id="paragraphadv-button-border-inner-hor" style="display: inline-block;"></div>\r\n                <div id="paragraphadv-button-border-bottom" style="display: inline-block;"></div>\r\n                <div id="paragraphadv-button-border-outer" style="display: inline-block;"></div>\r\n                <div id="paragraphadv-button-border-left" style="display: inline-block;"></div>\r\n                <div id="paragraphadv-button-border-all" style="display: inline-block;"></div>\r\n                <div id="paragraphadv-button-border-right" style="display: inline-block;"></div>\r\n                <div id="paragraphadv-button-border-none" style="display: inline-block;"></div>\r\n            </div>\r\n        </div>\r\n        <div style="width: 100%;" class="padding-small">\r\n            <label class="input-label" style="margin-right: 5px;"><%= scope.textBackColor %></label>\r\n            <div id="paragraphadv-back-color-btn" style="display: inline-block;"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div id="id-adv-paragraph-font" class="settings-panel">\r\n    <div class="inner-content" style="width: 100%;">\r\n        <div class="padding-small">\r\n            <label class="header"><%= scope.textEffects %></label>\r\n        </div>\r\n        <table cols="2">\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <div id="paragraphadv-checkbox-strike"></div>\r\n                </td>\r\n                <td class="padding-small" style="padding-left: 40px;">\r\n                    <div id="paragraphadv-checkbox-subscript"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <div id="paragraphadv-checkbox-double-strike"></div>\r\n                </td>\r\n                <td class="padding-small" style="padding-left: 40px;">\r\n                    <div id="paragraphadv-checkbox-small-caps"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <div id="paragraphadv-checkbox-superscript"></div>\r\n                </td>\r\n                <td class="padding-large" style="padding-left: 40px;">\r\n                    <div id="paragraphadv-checkbox-all-caps"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n        <div class="padding-small">\r\n            <label class="header"><%= scope.textCharacterSpacing %></label>\r\n        </div>\r\n        <div class="padding-large">\r\n            <div style="display: inline-block;">\r\n                <label class="input-label"><%= scope.textSpacing %></label>\r\n                <div id="paragraphadv-spin-spacing"></div>\r\n            </div>\r\n            <div class="text-only" style="display: inline-block; margin-left: 15px;">\r\n                <label class="input-label"><%= scope.textPosition %></label>\r\n                <div id="paragraphadv-spin-position"></div>\r\n            </div>\r\n        </div>\r\n        <div class="doc-content-color" style="outline: 1px solid #cbcbcb;">\r\n            <div id="paragraphadv-font-img" style="width: 300px; height: 80px; position: relative; margin: 0 auto;"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div id="id-adv-paragraph-tabs" class="settings-panel">\r\n    <div class="inner-content">\r\n            <div class="padding-large">\r\n                <label class="input-label"><%= scope.textDefault %></label>\r\n                <div id="paraadv-spin-default-tab"></div>\r\n\r\n            </div>\r\n            <div>\r\n                <div class="padding-large" style="display: inline-block; margin-right: 8px;">\r\n                    <label class="input-label"><%= scope.textTabPosition %></label>\r\n                    <div id="paraadv-spin-tab"></div>\r\n                </div>\r\n                <div class="padding-large" style=" display: inline-block; margin-right: 9px;">\r\n                    <label class="input-label"><%= scope.textAlign %></label>\r\n                    <div id="paraadv-cmb-align"></div>\r\n                </div>\r\n                <div class="padding-large" style="display: inline-block;">\r\n                    <label class="input-label"><%= scope.textLeader %></label>\r\n                    <div id="paraadv-cmb-leader"></div>\r\n                </div>\r\n            </div>\r\n            <div>\r\n                <div colspan=3 class="padding-large">\r\n                     <div id="paraadv-list-tabs" style="width:348px; height: 116px;"></div>\r\n                </div>\r\n            </div>\r\n            <div>\r\n                <button type="button" class="btn btn-text-default" id="paraadv-button-add-tab" style="width:108px;margin-right: 9px; display: inline-block;"><%= scope.textSet %></button>\r\n                <button type="button" class="btn btn-text-default" id="paraadv-button-remove-tab" style="width:108px;margin-right: 9px; display: inline-block;"><%= scope.textRemove %></button>\r\n                <button type="button" class="btn btn-text-default" id="paraadv-button-remove-all" style="width:108px;display: inline-block;"><%= scope.textRemoveAll %></button>\r\n            </div>\r\n    </div>\r\n</div>\r\n<div id="id-adv-paragraph-margins" class="settings-panel">\r\n    <div class="inner-content">\r\n            <div>\r\n                <div class="padding-small" style="display: inline-block;">\r\n                    <label class="input-label"><%= scope.textTop %></label>\r\n                    <div id="paraadv-number-margin-top"></div>\r\n                </div>\r\n                <div class="padding-small" style="display: inline-block; padding-left: 15px;">\r\n                    <label class="input-label"><%= scope.textLeft %></label>\r\n                    <div id="paraadv-number-margin-left"></div>\r\n                </div>\r\n            </div>\r\n            <div>\r\n                <div class="padding-small" style="display: inline-block;">\r\n                    <label class="input-label"><%= scope.textBottom %></label>\r\n                    <div id="paraadv-number-margin-bottom"></div>\r\n                </div>\r\n                <div class="padding-small" style="display: inline-block; padding-left: 15px;">\r\n                    <label class="input-label"><%= scope.textRight %></label>\r\n                    <div id="paraadv-number-margin-right"></div>\r\n                </div>\r\n            </div>\r\n    </div>\r\n</div>'}),void 0===Common)var Common={};if(define("common/main/lib/component/ColorButton",["common/main/lib/component/Button","common/main/lib/component/ThemeColorPalette"],function(){"use strict";Common.UI.ColorButton=Common.UI.Button.extend(_.extend({options:{id:null,hint:!1,enableToggle:!1,allowDepress:!1,toggleGroup:null,cls:"",iconCls:"",caption:"",menu:null,disabled:!1,pressed:!1,split:!1,visible:!0},template:_.template(['<div class="btn-group" id="<%= id %>">','<button type="button" class="btn btn-color dropdown-toggle <%= cls %>" data-toggle="dropdown" style="<%= style %>">',"<span>&nbsp;</span>",'<span class="inner-box-caret">','<i class="caret"></i>',"</span>","</button>","</div>"].join("")),initialize:function(t){if(!t.menu&&!1!==t.menu){var e=this;t.menu=e.getMenu(t),e.on("render:after",function(i){e.getPicker(t.color,t.colors)})}Common.UI.Button.prototype.initialize.call(this,t)},render:function(t){Common.UI.Button.prototype.render.call(this,t),this.options.auto&&(this.autocolor="object"==typeof this.options.auto?this.options.auto.color||"000000":"000000"),void 0!==this.options.color&&this.setColor(this.options.color)},onColorSelect:function(t,e){this.setColor(e),this.setAutoColor(!1),this.trigger("color:select",this,e)},setColor:function(t){"auto"==t&&this.options.auto&&(t=this.autocolor);var e=$(this.cmpEl).find("button span:nth-child(1)");this.color=t,e.toggleClass("color-transparent","transparent"==t),e.css({"background-color":"transparent"==t?t:"object"==typeof t?"#"+t.color:"#"+t})},getPicker:function(t,e){return this.colorPicker||(this.colorPicker=new Common.UI.ThemeColorPalette({el:this.cmpEl.find("#"+this.menu.id+"-color-menu"),transparent:this.options.transparent,value:t,colors:e}),this.colorPicker.on("select",_.bind(this.onColorSelect,this)),this.cmpEl.find("#"+this.menu.id+"-color-new").on("click",_.bind(this.addNewColor,this)),this.options.auto&&(this.cmpEl.find("#"+this.menu.id+"-color-auto").on("click",_.bind(this.onAutoColorSelect,this)),this.colorAuto=this.cmpEl.find("#"+this.menu.id+"-color-auto > a"),"auto"==t&&this.setAutoColor(!0))),this.colorPicker},getMenu:function(t){if("object"!=typeof this.menu){t=t||this.options;var e=t.paletteHeight||216,i=Common.UI.getId(),n=[];t.auto&&(this.autocolor="object"==typeof t.auto?t.auto.color||"000000":"000000",n.push({id:i+"-color-auto",caption:"object"==typeof t.auto?t.auto.caption||this.textAutoColor:this.textAutoColor,template:_.template('<a tabindex="-1" type="menuitem"><span class="menu-item-icon color-auto" style="background-image: none; width: 12px; height: 12px; margin: 1px 7px 0 1px; background-color: #'+this.autocolor+';"></span><%= caption %></a>')}),n.push({caption:"--"}));return new Common.UI.Menu({id:i,cls:"shifted-left",additionalAlign:t.additionalAlign,items:(t.additionalItems?t.additionalItems:[]).concat(n).concat([{template:_.template('<div id="'+i+'-color-menu" style="width: 169px; height:'+e+'px; margin: 10px;"></div>')},{template:_.template('<a id="'+i+'-color-new" style="">'+this.textNewColor+"</a>")}])})}return this.menu},setMenu:function(t){t=t||this.getMenu(),Common.UI.Button.prototype.setMenu.call(this,t),this.getPicker(this.options.color,this.options.colors)},addNewColor:function(){this.colorPicker&&this.colorPicker.addNewColor("object"==typeof this.color?this.color.color:this.color)},onAutoColorSelect:function(){this.setColor("auto"),this.setAutoColor(!0),this.colorPicker&&this.colorPicker.clearSelection(),this.trigger("auto:select",this,this.autocolor)},setAutoColor:function(t){this.colorAuto&&(t&&!this.colorAuto.hasClass("selected")?this.colorAuto.addClass("selected"):!t&&this.colorAuto.hasClass("selected")&&this.colorAuto.removeClass("selected"))},isAutoColor:function(){return this.colorAuto&&this.colorAuto.hasClass("selected")},textNewColor:"Add New Custom Color",textAutoColor:"Automatic"},Common.UI.ColorButton||{})),Common.UI.ButtonColored=Common.UI.Button.extend(_.extend({render:function(t){Common.UI.Button.prototype.render.call(this,t),$("button:first-child",this.cmpEl).append($('<div class="btn-color-value-line"></div>')),this.colorEl=this.cmpEl.find(".btn-color-value-line")},setColor:function(t){this.colorEl&&(this.colorEl.css({"background-color":"transparent"==t?t:"object"==typeof t?"#"+t.color:"#"+t}),this.colorEl.toggleClass("bordered","transparent"==t))}},Common.UI.ButtonColored||{}))}),void 0===Common)var Common={};if(define("common/main/lib/component/ListView",["common/main/lib/component/DataView"],function(){"use strict";Common.UI.ListView=Common.UI.DataView.extend(function(){return{options:{handleSelect:!0,enableKeyEvents:!0,showLast:!0,simpleAddMode:!1,keyMoveDirection:"vertical",itemTemplate:_.template('<div id="<%= id %>" class="list-item" style=""><%= value %></div>'),cls:""},template:_.template(['<div class="listview inner <%= cls %>"></div>'].join("")),onResetItems:function(){this.innerEl=null,Common.UI.DataView.prototype.onResetItems.call(this),this.trigger("items:reset",this)},createNewItem:function(t){return new Common.UI.DataViewItem({template:this.itemTemplate,model:t})},onAddItem:function(t,e,i){var n=this.createNewItem(t);if(this.innerEl||(this.innerEl=$(this.el).find(".inner")),n&&this.innerEl){if(this.dataViewItems.length<1&&this.innerEl.find(".empty-text").remove(),this.options.simpleAddMode)this.innerEl.append(n.render().el),this.dataViewItems.push(n);else{var o=_.indexOf(this.store.models,t),s=this.innerEl.find("> div");o>0?$(s.get(o-1)).after(n.render().el):s.length>0?$(s[o]).before(n.render().el):this.innerEl.append(n.render().el),this.dataViewItems=this.dataViewItems.slice(0,o).concat(n).concat(this.dataViewItems.slice(o))}if(this.listenTo(n,"change",this.onChangeItem),this.listenTo(n,"remove",this.onRemoveItem),this.listenTo(n,"click",this.onClickItem),this.listenTo(n,"dblclick",this.onDblClickItem),this.listenTo(n,"select",this.onSelectItem),t.get("tip")){var a=$(n.el);a.attr("data-toggle","tooltip"),a.tooltip({title:t.get("tip"),placement:"cursor",zIndex:this.tipZIndex})}this.isSuspendEvents||this.trigger("item:add",this,n,t)}},focus:function(){this.cmpEl&&this.cmpEl.find(".listview").focus()},scrollToRecord:function(t,e){if(!this._fromKeyDown)return void Common.UI.DataView.prototype.scrollToRecord.call(this,t,e);if(t){var i=$(this.el).find(".inner"),n=i.innerHeight(),o=_.indexOf(this.store.models,t),s=o>=0&&this.dataViewItems.length>o?$(this.dataViewItems[o].el):i.find("#"+t.get("id"));if(!(s.length<=0)){var a,r=s.position().top,l=s.outerHeight();e||r<0?a=i.scrollTop()+r:r+l>n&&(a=i.scrollTop()+r+l-n),void 0!==a&&(this.scroller&&this.allowScrollbar?this.scroller.scrollTop(a,0):i.scrollTop(a))}}}}}())}),define("documenteditor/main/app/view/ParagraphSettingsAdvanced",["text!documenteditor/main/app/template/ParagraphSettingsAdvanced.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox","common/main/lib/component/ThemeColorPalette","common/main/lib/component/ColorButton","common/main/lib/component/ListView","common/main/lib/component/TableStyler"],function(t){"use strict";DE.Views.ParagraphSettingsAdvanced=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:370,height:394,toggleGroup:"paragraph-adv-settings-group",storageName:"de-para-settings-adv-category"},initialize:function(e){var i=this;_.extend(this.options,{title:this.textTitle,items:[{panelId:"id-adv-paragraph-indents",panelCaption:this.strParagraphIndents},{panelId:"id-adv-paragraph-line",panelCaption:this.strParagraphLine},{panelId:"id-adv-paragraph-borders",panelCaption:this.strBorders},{panelId:"id-adv-paragraph-font",panelCaption:this.strParagraphFont},{panelId:"id-adv-paragraph-tabs",panelCaption:this.strTabs},{panelId:"id-adv-paragraph-margins",panelCaption:this.strMargins}],contentTemplate:_.template(t)({scope:this})},e),Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this.Borders={},this.BorderSize={ptValue:0,pxValue:0},this.paragraphShade="transparent",this._changedProps=null,this.ChangedBorders=void 0,this.checkGroup=0,this._noApply=!0,this._tabListChanged=!1,this.Margins=void 0,this.FirstLine=void 0,this.LeftIndent=void 0,this.Spacing=null,this.spinners=[],this.tableStylerRows=this.options.tableStylerRows,this.tableStylerColumns=this.options.tableStylerColumns,this.borderProps=this.options.borderProps,this.api=this.options.api,this._originalProps=new Asc.asc_CParagraphProperty(this.options.paragraphProps),this.isChart=this.options.isChart,this.CurLineRuleIdx=this._originalProps.get_Spacing().get_LineRule(),this._arrLineRule=[{displayValue:this.textAtLeast,defaultValue:5,value:c_paragraphLinerule.LINERULE_LEAST,minValue:.03,step:.01,defaultUnit:"cm"},{displayValue:this.textAuto,defaultValue:1,value:c_paragraphLinerule.LINERULE_AUTO,minValue:.5,step:.01,defaultUnit:""},{displayValue:this.textExact,defaultValue:5,value:c_paragraphLinerule.LINERULE_EXACT,minValue:.03,step:.01,defaultUnit:"cm"}],this._arrSpecial=[{displayValue:this.textNoneSpecial,value:c_paragraphSpecial.NONE_SPECIAL,defaultValue:0},{displayValue:this.textFirstLine,value:c_paragraphSpecial.FIRST_LINE,defaultValue:12.7},{displayValue:this.textHanging,value:c_paragraphSpecial.HANGING,defaultValue:12.7}],this.CurSpecial=void 0,this._arrTextAlignment=[{displayValue:this.textTabLeft,value:c_paragraphTextAlignment.LEFT},{displayValue:this.textTabCenter,value:c_paragraphTextAlignment.CENTERED},{displayValue:this.textTabRight,value:c_paragraphTextAlignment.RIGHT},{displayValue:this.textJustified,value:c_paragraphTextAlignment.JUSTIFIED}],this._arrOutlinelevel=[{displayValue:this.textBodyText,value:-1}];for(var n=0;n<9;n++)this._arrOutlinelevel.push({displayValue:this.textLevel+" "+(n+1),value:n});this._arrTabAlign=[{value:Asc.c_oAscTabType.Left,displayValue:this.textTabLeft},{value:Asc.c_oAscTabType.Center,displayValue:this.textTabCenter},{value:Asc.c_oAscTabType.Right,displayValue:this.textTabRight}],this._arrKeyTabAlign=[],this._arrTabAlign.forEach(function(t){i._arrKeyTabAlign[t.value]=t.displayValue}),this._arrTabLeader=[{value:Asc.c_oAscTabLeader.None,displayValue:this.textNone},{value:Asc.c_oAscTabLeader.Dot,displayValue:"...................."},{value:Asc.c_oAscTabLeader.Hyphen,displayValue:"-----------------"},{value:Asc.c_oAscTabLeader.MiddleDot,displayValue:"Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·"},{value:Asc.c_oAscTabLeader.Underscore,displayValue:"__________"}],this._arrKeyTabLeader=[],this._arrTabLeader.forEach(function(t){i._arrKeyTabLeader[t.value]=t.displayValue})},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.numIndentsLeft=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-indent-left"),step:.1,width:85,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:-55.87}),this.numIndentsLeft.on("change",_.bind(function(t,e,i,n){this._changedProps&&(null!==this._changedProps.get_Ind()&&void 0!==this._changedProps.get_Ind()||this._changedProps.put_Ind(new Asc.asc_CParagraphInd),this._changedProps.get_Ind().put_Left(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},this)),this.spinners.push(this.numIndentsLeft),this.numIndentsRight=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-indent-right"),step:.1,width:85,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:-55.87}),this.numIndentsRight.on("change",_.bind(function(t,e,i,n){this._changedProps&&(null!==this._changedProps.get_Ind()&&void 0!==this._changedProps.get_Ind()||this._changedProps.put_Ind(new Asc.asc_CParagraphInd),this._changedProps.get_Ind().put_Right(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},this)),this.spinners.push(this.numIndentsRight),this.numSpacingBefore=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-spacing-before"),step:.1,width:85,value:"",defaultUnit:"cm",maxValue:55.88,minValue:0,allowAuto:!0,autoText:this.txtAutoText}),this.numSpacingBefore.on("change",_.bind(function(t,e,i,n){if(null===this.Spacing){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;this.Spacing=o.get_Spacing()}var s=t.getNumberValue();this.Spacing.put_Before(s<0?-1:Common.Utils.Metric.fnRecalcToMM(s))},this)),this.spinners.push(this.numSpacingBefore),this.numSpacingAfter=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-spacing-after"),step:.1,width:85,value:"",defaultUnit:"cm",maxValue:55.88,minValue:0,allowAuto:!0,autoText:this.txtAutoText}),this.numSpacingAfter.on("change",_.bind(function(t,e,i,n){if(null===this.Spacing){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;this.Spacing=o.get_Spacing()}var s=t.getNumberValue();this.Spacing.put_After(s<0?-1:Common.Utils.Metric.fnRecalcToMM(s))},this)),this.spinners.push(this.numSpacingAfter),this.cmbLineRule=new Common.UI.ComboBox({el:$("#paragraphadv-spin-line-rule"),cls:"input-group-nr",editable:!1,data:this._arrLineRule,style:"width: 85px;",menuStyle:"min-width: 85px;",takeFocusOnClose:!0}),this.cmbLineRule.setValue(this.CurLineRuleIdx),this.cmbLineRule.on("selected",_.bind(this.onLineRuleSelect,this)),this.numLineHeight=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-line-height"),step:.01,width:85,value:"",defaultUnit:"",maxValue:132,minValue:.5}),this.spinners.push(this.numLineHeight),this.numLineHeight.on("change",_.bind(this.onNumLineHeightChange,this)),this.chAddInterval=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-add-interval"),labelText:this.strSomeParagraphSpace}),this.cmbSpecial=new Common.UI.ComboBox({el:$("#paragraphadv-spin-special"),cls:"input-group-nr",editable:!1,data:this._arrSpecial,style:"width: 85px;",menuStyle:"min-width: 85px;",takeFocusOnClose:!0}),this.cmbSpecial.setValue(""),this.cmbSpecial.on("selected",_.bind(this.onSpecialSelect,this)),this.numSpecialBy=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-special-by"),step:.1,width:85,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:0}),this.spinners.push(this.numSpecialBy),this.numSpecialBy.on("change",_.bind(this.onFirstLineChange,this)),this.cmbTextAlignment=new Common.UI.ComboBox({el:$("#paragraphadv-spin-text-alignment"),cls:"input-group-nr",editable:!1,data:this._arrTextAlignment,style:"width: 173px;",menuStyle:"min-width: 173px;",takeFocusOnClose:!0}),this.cmbTextAlignment.setValue(""),this.cmbOutlinelevel=new Common.UI.ComboBox({el:$("#paragraphadv-spin-outline-level"),cls:"input-group-nr",editable:!1,data:this._arrOutlinelevel,style:"width: 174px;",menuStyle:"min-width: 174px;",takeFocusOnClose:!0}),this.cmbOutlinelevel.setValue(-1),this.cmbOutlinelevel.on("selected",_.bind(this.onOutlinelevelSelect,this)),this.chBreakBefore=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-break-before"),labelText:this.strBreakBefore}),this.chBreakBefore.on("change",_.bind(function(t,e,i,n){this._changedProps&&this._changedProps.put_PageBreakBefore("checked"==t.getValue())},this)),this.chKeepLines=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-keep-lines"),labelText:this.strKeepLines}),this.chKeepLines.on("change",_.bind(function(t,e,i,n){this._changedProps&&this._changedProps.put_KeepLines("checked"==t.getValue())},this)),this.chOrphan=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-orphan"),labelText:this.strOrphan}),this.chOrphan.on("change",_.bind(function(t,e,i,n){this._changedProps&&this._changedProps.put_WidowControl("checked"==t.getValue())},this)),this.chKeepNext=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-keep-next"),labelText:this.strKeepNext}),this.chKeepNext.on("change",_.bind(function(t,e,i,n){this._changedProps&&this._changedProps.put_KeepNext("checked"==t.getValue())},this)),this.chLineNumbers=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-suppress-line-numbers"),labelText:this.strSuppressLineNumbers}),this.chLineNumbers.on("change",_.bind(function(t,e,i,n){this._changedProps&&this._changedProps.put_SuppressLineNumbers("checked"==t.getValue())},this)),this.cmbBorderSize=new Common.UI.ComboBorderSize({el:$("#paragraphadv-combo-border-size"),style:"width: 93px;"});var e=this.cmbBorderSize.store.at(2);this.BorderSize={ptValue:e.get("value"),pxValue:e.get("pxValue")},this.cmbBorderSize.setValue(this.BorderSize.ptValue),this.cmbBorderSize.on("selected",_.bind(this.onBorderSizeSelect,this)),this.btnBorderColor=new Common.UI.ColorButton({parentEl:$("#paragraphadv-border-color-btn"),additionalAlign:this.menuAddAlign,color:"auto",auto:!0}),this.colorsBorder=this.btnBorderColor.getPicker(),this.btnBorderColor.on("color:select",_.bind(this.onColorsBorderSelect,this)),this.btnBorderColor.on("auto:select",_.bind(this.onColorsBorderSelect,this)),this.BordersImage=new Common.UI.TableStyler({el:$("#id-deparagraphstyler"),width:200,height:170,rows:this.tableStylerRows,columns:this.tableStylerColumns,spacingMode:!1});var i=[["lrtb","btn-borders-large toolbar__icon toolbar__icon-big paragraph-borders-outer","paragraphadv-button-border-outer",this.tipOuter],["lrtbm","btn-borders-large toolbar__icon toolbar__icon-big paragraph-borders-all","paragraphadv-button-border-all",this.tipAll],["","btn-borders-large toolbar__icon toolbar__icon-big paragraph-borders-none","paragraphadv-button-border-none",this.tipNone],["l","btn-borders-large toolbar__icon toolbar__icon-big paragraph-borders-left","paragraphadv-button-border-left",this.tipLeft],["r","btn-borders-large toolbar__icon toolbar__icon-big paragraph-borders-right","paragraphadv-button-border-right",this.tipRight],["t","btn-borders-large toolbar__icon toolbar__icon-big paragraph-borders-top","paragraphadv-button-border-top",this.tipTop],["m","btn-borders-large toolbar__icon toolbar__icon-big paragraph-borders-inner","paragraphadv-button-border-inner-hor",this.tipInner],["b","btn-borders-large toolbar__icon toolbar__icon-big paragraph-borders-bottom","paragraphadv-button-border-bottom",this.tipBottom]];this._btnsBorderPosition=[],_.each(i,function(t,e,i){var n=new Common.UI.Button({parentEl:$("#"+t[2]),style:"margin-left: 5px; margin-bottom: 4px;",cls:"btn-options large",iconCls:t[1],strId:t[0],hint:t[3]});n.on("click",_.bind(this._ApplyBorderPreset,this)),this._btnsBorderPosition.push(n)},this),this.btnBackColor=new Common.UI.ColorButton({parentEl:$("#paragraphadv-back-color-btn"),transparent:!0,additionalAlign:this.menuAddAlign}),this.colorsBack=this.btnBackColor.getPicker(),this.btnBackColor.on("color:select",_.bind(this.onColorsBackSelect,this)),this.chStrike=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-strike"),labelText:this.strStrike}),this.chStrike.on("change",_.bind(this.onStrikeChange,this)),this.chDoubleStrike=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-double-strike"),labelText:this.strDoubleStrike}),this.chDoubleStrike.on("change",_.bind(this.onDoubleStrikeChange,this)),this.chSuperscript=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-superscript"),labelText:this.strSuperscript}),this.chSuperscript.on("change",_.bind(this.onSuperscriptChange,this)),this.chSubscript=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-subscript"),labelText:this.strSubscript}),this.chSubscript.on("change",_.bind(this.onSubscriptChange,this)),this.chSmallCaps=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-small-caps"),labelText:this.strSmallCaps}),this.chSmallCaps.on("change",_.bind(this.onSmallCapsChange,this)),
this.chAllCaps=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-all-caps"),labelText:this.strAllCaps}),this.chAllCaps.on("change",_.bind(this.onAllCapsChange,this)),this.numSpacing=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-spacing"),step:.01,width:90,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:-55.87}),this.numSpacing.on("change",_.bind(function(t,e,i,n){if(this._changedProps&&this._changedProps.put_TextSpacing(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;o.put_TextSpacing(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api.SetDrawImagePlaceParagraph("paragraphadv-font-img",o)}},this)),this.spinners.push(this.numSpacing),this.numPosition=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-position"),step:.01,width:90,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:-55.87}),this.numPosition.on("change",_.bind(function(t,e,i,n){if(this._changedProps&&this._changedProps.put_Position(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;o.put_Position(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api.SetDrawImagePlaceParagraph("paragraphadv-font-img",o)}},this)),this.spinners.push(this.numPosition),this.numTab=new Common.UI.MetricSpinner({el:$("#paraadv-spin-tab"),step:.1,width:108,defaultUnit:"cm",value:"1.25 cm",maxValue:55.87,minValue:0}),this.spinners.push(this.numTab),this.numDefaultTab=new Common.UI.MetricSpinner({el:$("#paraadv-spin-default-tab"),step:.1,width:108,defaultUnit:"cm",value:"1.25 cm",maxValue:55.87,minValue:0}),this.numDefaultTab.on("change",_.bind(function(t,e,i,n){this._changedProps&&this._changedProps.put_DefaultTab(parseFloat(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()).toFixed(1)))},this)),this.spinners.push(this.numDefaultTab),this.tabList=new Common.UI.ListView({el:$("#paraadv-list-tabs"),emptyText:this.noTabs,store:new Common.UI.DataViewStore,template:_.template(['<div class="listview inner" style=""></div>'].join("")),itemTemplate:_.template(['<div id="<%= id %>" class="list-item" style="width: 100%;display:inline-block;">','<div style="width:117px;display: inline-block;"><%= value %></div>','<div style="width:121px;display: inline-block;"><%= displayTabAlign %></div>','<div style="width:96px;display: inline-block;"><%= displayTabLeader %></div>',"</div>"].join("")),tabindex:1}),this.tabList.store.comparator=function(t){return t.get("tabPos")},this.tabList.on("item:select",_.bind(this.onSelectTab,this));var n=function(){t._noApply||(t._tabListChanged=!0)};this.listenTo(this.tabList.store,"add",n),this.listenTo(this.tabList.store,"remove",n),this.listenTo(this.tabList.store,"reset",n),this.cmbAlign=new Common.UI.ComboBox({el:$("#paraadv-cmb-align"),style:"width: 108px;",menuStyle:"min-width: 108px;",editable:!1,cls:"input-group-nr",data:this._arrTabAlign,takeFocusOnClose:!0}),this.cmbAlign.setValue(Asc.c_oAscTabType.Left),this.cmbLeader=new Common.UI.ComboBox({el:$("#paraadv-cmb-leader"),style:"width: 108px;",menuStyle:"min-width: 108px;",editable:!1,cls:"input-group-nr",data:this._arrTabLeader,takeFocusOnClose:!0}),this.cmbLeader.setValue(Asc.c_oAscTabLeader.None),this.btnAddTab=new Common.UI.Button({el:$("#paraadv-button-add-tab")}),this.btnAddTab.on("click",_.bind(this.addTab,this)),this.btnRemoveTab=new Common.UI.Button({el:$("#paraadv-button-remove-tab")}),this.btnRemoveTab.on("click",_.bind(this.removeTab,this)),this.btnRemoveAll=new Common.UI.Button({el:$("#paraadv-button-remove-all")}),this.btnRemoveAll.on("click",_.bind(this.removeAllTabs,this)),this.spnMarginTop=new Common.UI.MetricSpinner({el:$("#paraadv-number-margin-top"),step:.1,width:100,defaultUnit:"cm",value:"0 cm",maxValue:55.87,minValue:0}),this.spnMarginTop.on("change",_.bind(function(t,e,i,n){this._noApply||(void 0===this.Margins&&(this.Margins={}),this.Margins.Top=Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))},this)),this.spinners.push(this.spnMarginTop),this.spnMarginBottom=new Common.UI.MetricSpinner({el:$("#paraadv-number-margin-bottom"),step:.1,width:100,defaultUnit:"cm",value:"0 cm",maxValue:55.87,minValue:0}),this.spnMarginBottom.on("change",_.bind(function(t,e,i,n){this._noApply||(void 0===this.Margins&&(this.Margins={}),this.Margins.Bottom=Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))},this)),this.spinners.push(this.spnMarginBottom),this.spnMarginLeft=new Common.UI.MetricSpinner({el:$("#paraadv-number-margin-left"),step:.1,width:100,defaultUnit:"cm",value:"0.19 cm",maxValue:9.34,minValue:0}),this.spnMarginLeft.on("change",_.bind(function(t,e,i,n){this._noApply||(void 0===this.Margins&&(this.Margins={}),this.Margins.Left=Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))},this)),this.spinners.push(this.spnMarginLeft),this.spnMarginRight=new Common.UI.MetricSpinner({el:$("#paraadv-number-margin-right"),step:.1,width:100,defaultUnit:"cm",value:"0.19 cm",maxValue:9.34,minValue:0}),this.spnMarginRight.on("change",_.bind(function(t,e,i,n){this._noApply||(void 0===this.Margins&&(this.Margins={}),this.Margins.Right=Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))},this)),this.spinners.push(this.spnMarginRight),this.TextOnlySettings=$(".text-only"),this.afterRender()},getFocusedComponents:function(){return[this.cmbTextAlignment,this.cmbOutlinelevel,this.numIndentsLeft,this.numIndentsRight,this.cmbSpecial,this.numSpecialBy,this.numSpacingBefore,this.numSpacingAfter,this.cmbLineRule,this.numLineHeight,this.chAddInterval,this.chBreakBefore,this.chKeepLines,this.chOrphan,this.chKeepNext,this.chLineNumbers,this.chStrike,this.chSubscript,this.chDoubleStrike,this.chSmallCaps,this.chSuperscript,this.chAllCaps,this.numSpacing,this.numPosition,this.numDefaultTab,this.numTab,this.cmbAlign,this.cmbLeader,this.tabList,this.btnAddTab,this.btnRemoveTab,this.btnRemoveAll,this.spnMarginTop,this.spnMarginLeft,this.spnMarginBottom,this.spnMarginRight]},onCategoryClick:function(t,e,i,n){Common.Views.AdvancedSettingsWindow.prototype.onCategoryClick.call(this,t,e);var o=this;setTimeout(function(){switch(e){case 0:o.cmbTextAlignment.focus();break;case 1:o.chBreakBefore.focus();break;case 3:o.chStrike.focus(),n&&n instanceof jQuery.Event&&o.api.SetDrawImagePlaceParagraph("paragraphadv-font-img",o._originalProps||new Asc.asc_CParagraphProperty);break;case 4:o.numDefaultTab.focus();break;case 5:o.spnMarginTop.focus()}},10)},onAnimateAfter:function(){3==this.getActiveCategory()&&this.api.SetDrawImagePlaceParagraph("paragraphadv-font-img",this._originalProps||new Asc.asc_CParagraphProperty)},getSettings:function(){if(null===this.ChangedBorders?this._changedProps.put_Borders(this.Borders):void 0!==this.ChangedBorders&&this._changedProps.put_Borders(this.ChangedBorders),this.Margins){var t=this._changedProps.get_Borders();void 0!==t&&null!==t||(this._changedProps.put_Borders(new Asc.asc_CParagraphBorders),t=this._changedProps.get_Borders()),void 0!==this.Margins.Left&&(void 0!==t.get_Left()&&null!==t.get_Left()||t.put_Left(new Asc.asc_CTextBorder(this.Borders.get_Left())),t.get_Left().put_Space(this.Margins.Left)),void 0!==this.Margins.Top&&(void 0!==t.get_Top()&&null!==t.get_Top()||t.put_Top(new Asc.asc_CTextBorder(this.Borders.get_Top())),t.get_Top().put_Space(this.Margins.Top)),void 0!==this.Margins.Right&&(void 0!==t.get_Right()&&null!==t.get_Right()||t.put_Right(new Asc.asc_CTextBorder(this.Borders.get_Right())),t.get_Right().put_Space(this.Margins.Right)),void 0!==this.Margins.Bottom&&(void 0!==t.get_Bottom()&&null!==t.get_Bottom()||t.put_Bottom(new Asc.asc_CTextBorder(this.Borders.get_Bottom())),t.get_Bottom().put_Space(this.Margins.Bottom),void 0!==t.get_Between()&&null!==t.get_Between()||t.put_Between(new Asc.asc_CTextBorder(this.Borders.get_Between())),t.get_Between().put_Space(this.Margins.Bottom))}if(this._tabListChanged&&(null!==this._changedProps.get_Tabs()&&void 0!==this._changedProps.get_Tabs()||this._changedProps.put_Tabs(new Asc.asc_CParagraphTabs),this.tabList.store.each(function(t,e){var i=new Asc.asc_CParagraphTab(Common.Utils.Metric.fnRecalcToMM(t.get("tabPos")),t.get("tabAlign"),t.get("tabLeader"));this._changedProps.get_Tabs().add_Tab(i)},this)),null!==this._changedProps.get_Ind()&&void 0!==this._changedProps.get_Ind()){var e=this._changedProps.get_Ind().get_Left(),i=this._changedProps.get_Ind().get_FirstLine();void 0===e&&void 0===i||!(i<0||this.FirstLine<0)||(i<0||void 0===i||null===i?(void 0!==i&&null!==i||(i=this.FirstLine),void 0!==e&&null!==e||(e=this.LeftIndent),void 0!==e&&null!==e&&this._changedProps.get_Ind().put_Left(e-i)):(void 0!==e&&null!==e||(e=this.LeftIndent),void 0!==e&&null!==e&&this._changedProps.get_Ind().put_Left(e)))}null!==this.Spacing&&this._changedProps.asc_putSpacing(this.Spacing);var n=this.chAddInterval.getValue();this._changedProps.asc_putContextualSpacing("checked"==n);var o=this.cmbTextAlignment.getValue();return this._changedProps.asc_putJc(void 0!==o&&null!==o?o:c_paragraphTextAlignment.LEFT),{paragraphProps:this._changedProps,borderProps:{borderSize:this.BorderSize,borderColor:this.btnBorderColor.isAutoColor()?"auto":this.btnBorderColor.color}}},_setDefaults:function(t){if(t){this._originalProps=new Asc.asc_CParagraphProperty(t),this.hideTextOnlySettings(this.isChart),this.FirstLine=null!==t.get_Ind()?t.get_Ind().get_FirstLine():null,this.LeftIndent=null!==t.get_Ind()?t.get_Ind().get_Left():null,this.FirstLine<0&&null!==this.LeftIndent&&(this.LeftIndent=this.LeftIndent+this.FirstLine),this.numIndentsLeft.setValue(null!==this.LeftIndent?Common.Utils.Metric.fnRecalcFromMM(this.LeftIndent):"",!0),this.numIndentsRight.setValue(null!==t.get_Ind()&&null!==t.get_Ind().get_Right()?Common.Utils.Metric.fnRecalcFromMM(t.get_Ind().get_Right()):"",!0);var e=t.get_Spacing()?t.get_Spacing().get_Before():null;this.numSpacingBefore.setValue(null!==e?e<0?e:Common.Utils.Metric.fnRecalcFromMM(e):"",!0),e=t.get_Spacing()?t.get_Spacing().get_After():null,this.numSpacingAfter.setValue(null!==e?e<0?e:Common.Utils.Metric.fnRecalcFromMM(e):"",!0);var i=t.get_Spacing().get_LineRule();if(this.cmbLineRule.setValue(null!==i?i:"",!0),null!==t.get_Spacing()&&null!==t.get_Spacing().get_Line()?this.numLineHeight.setValue(i==c_paragraphLinerule.LINERULE_AUTO?t.get_Spacing().get_Line():Common.Utils.Metric.fnRecalcFromMM(t.get_Spacing().get_Line()),!0):this.numLineHeight.setValue("",!0),this.chAddInterval.setValue(null!==t.get_ContextualSpacing()&&void 0!==t.get_ContextualSpacing()?t.get_ContextualSpacing():"indeterminate",!0),void 0===this.CurSpecial&&(this.CurSpecial=0===t.get_Ind().get_FirstLine()?c_paragraphSpecial.NONE_SPECIAL:t.get_Ind().get_FirstLine()>0?c_paragraphSpecial.FIRST_LINE:c_paragraphSpecial.HANGING),this.cmbSpecial.setValue(this.CurSpecial),this.numSpecialBy.setValue(null!==this.FirstLine?Math.abs(Common.Utils.Metric.fnRecalcFromMM(this.FirstLine)):"",!0),this.cmbTextAlignment.setValue(void 0!==t.get_Jc()&&null!==t.get_Jc()?t.get_Jc():c_paragraphTextAlignment.LEFT,!0),this.chKeepLines.setValue(null!==t.get_KeepLines()&&void 0!==t.get_KeepLines()?t.get_KeepLines():"indeterminate",!0),this.chBreakBefore.setValue(null!==t.get_PageBreakBefore()&&void 0!==t.get_PageBreakBefore()?t.get_PageBreakBefore():"indeterminate",!0),this.chKeepNext.setValue(null!==t.get_KeepNext()&&void 0!==t.get_KeepNext()?t.get_KeepNext():"indeterminate",!0),this.chOrphan.setValue(null!==t.get_WidowControl()&&void 0!==t.get_WidowControl()?t.get_WidowControl():"indeterminate",!0),this.chLineNumbers.setValue(null!==t.get_SuppressLineNumbers()&&void 0!==t.get_SuppressLineNumbers()?t.get_SuppressLineNumbers():"indeterminate",!0),this.Borders=new Asc.asc_CParagraphBorders(t.get_Borders()),this.Borders){var n=this.Borders.get_Left(),o=null!==n&&void 0!==n&&null!==n.get_Space()&&void 0!==n.get_Space()?Common.Utils.Metric.fnRecalcFromMM(n.get_Space()):"";this.spnMarginLeft.setValue(o,!0),n=this.Borders.get_Top(),o=null!==n&&void 0!==n&&null!==n.get_Space()&&void 0!==n.get_Space()?Common.Utils.Metric.fnRecalcFromMM(n.get_Space()):"",this.spnMarginTop.setValue(o,!0),n=this.Borders.get_Right(),o=null!==n&&void 0!==n&&null!==n.get_Space()&&void 0!==n.get_Space()?Common.Utils.Metric.fnRecalcFromMM(n.get_Space()):"",this.spnMarginRight.setValue(o,!0),n=this.Borders.get_Bottom(),o=null!==n&&void 0!==n&&null!==n.get_Space()&&void 0!==n.get_Space()?Common.Utils.Metric.fnRecalcFromMM(n.get_Space()):"",this.spnMarginBottom.setValue(o,!0)}var s=t.get_Shade();if(null!==s&&void 0!==s&&s.get_Value()===Asc.c_oAscShdClear){var a=s.get_Color();a?a.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.paragraphShade={color:Common.Utils.ThemeColor.getHexColor(a.get_r(),a.get_g(),a.get_b()),effectValue:a.get_value()}:this.paragraphShade=Common.Utils.ThemeColor.getHexColor(a.get_r(),a.get_g(),a.get_b()):this.paragraphShade="transparent"}else this.paragraphShade="transparent";if(this.btnBackColor.setColor(this.paragraphShade),"object"==typeof this.paragraphShade){for(var r=!1,l=0;l<10;l++)if(Common.Utils.ThemeColor.ThemeValues[l]==this.paragraphShade.effectValue){this.colorsBack.select(this.paragraphShade,!0),r=!0;break}r||this.colorsBack.clearSelection()}else this.colorsBack.select(this.paragraphShade,!0);this._UpdateBorders(),this._noApply=!0,this.chStrike.setValue(null!==t.get_Strikeout()&&void 0!==t.get_Strikeout()?t.get_Strikeout():"indeterminate",!0),this.chDoubleStrike.setValue(null!==t.get_DStrikeout()&&void 0!==t.get_DStrikeout()?t.get_DStrikeout():"indeterminate",!0),this.chSubscript.setValue(null!==t.get_Subscript()&&void 0!==t.get_Subscript()?t.get_Subscript():"indeterminate",!0),this.chSuperscript.setValue(null!==t.get_Superscript()&&void 0!==t.get_Superscript()?t.get_Superscript():"indeterminate",!0),this.chSmallCaps.setValue(null!==t.get_SmallCaps()&&void 0!==t.get_SmallCaps()?t.get_SmallCaps():"indeterminate",!0),this.chAllCaps.setValue(null!==t.get_AllCaps()&&void 0!==t.get_AllCaps()?t.get_AllCaps():"indeterminate",!0),this.numSpacing.setValue(null!==t.get_TextSpacing()&&void 0!==t.get_TextSpacing()?Common.Utils.Metric.fnRecalcFromMM(t.get_TextSpacing()):"",!0),this.numPosition.setValue(null!==t.get_Position()&&void 0!==t.get_Position()?Common.Utils.Metric.fnRecalcFromMM(t.get_Position()):"",!0),this.numDefaultTab.setValue(null!==t.get_DefaultTab()&&void 0!==t.get_DefaultTab()?Common.Utils.Metric.fnRecalcFromMM(parseFloat(t.get_DefaultTab().toFixed(1))):"",!0);var c=this.tabList.store,d=t.get_Tabs();if(d){for(var h=[],p=d.get_Count(),l=0;l<p;l++){var m=d.get_Tab(l),u=Common.Utils.Metric.fnRecalcFromMM(parseFloat(m.get_Pos().toFixed(1))),g=new Common.UI.DataViewModel;g.set({tabPos:u,value:parseFloat(u.toFixed(3))+" "+Common.Utils.Metric.getCurrentMetricName(),tabAlign:m.get_Value(),tabLeader:m.get_Leader(),displayTabLeader:this._arrKeyTabLeader[m.get_Leader()],displayTabAlign:this._arrKeyTabAlign[m.get_Value()]}),h.push(g)}c.reset(h,{silent:!1}),this.tabList.selectByIndex(0)}this.cmbOutlinelevel.setValue(void 0===t.get_OutlineLvl()||null===t.get_OutlineLvl()?-1:t.get_OutlineLvl()),this.cmbOutlinelevel.setDisabled(!!t.get_OutlineLvlStyle()),this._noApply=!1,this._changedProps=new Asc.asc_CParagraphProperty,this.ChangedBorders=void 0}},updateMetricUnit:function(){if(this.spinners)for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),"paragraphadv-spin-spacing"==e.el.id||"paragraphadv-spin-position"==e.el.id||"paragraphadv-spin-spacing-before"==e.el.id||"paragraphadv-spin-spacing-after"==e.el.id?e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.01):e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}this._arrLineRule[2].defaultUnit=this._arrLineRule[0].defaultUnit=Common.Utils.Metric.getCurrentMetricName(),this._arrLineRule[2].minValue=this._arrLineRule[0].minValue=parseFloat(Common.Utils.Metric.fnRecalcFromMM(.3).toFixed(2)),this._arrLineRule[2].step=this._arrLineRule[0].step=Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.01,null!==this.CurLineRuleIdx&&(this.numLineHeight.setDefaultUnit(this._arrLineRule[this.CurLineRuleIdx].defaultUnit),this.numLineHeight.setStep(this._arrLineRule[this.CurLineRuleIdx].step))},updateThemeColors:function(){this.colorsBorder.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBack.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors())},afterRender:function(){if(this.updateMetricUnit(),this.updateThemeColors(),this._setDefaults(this._originalProps),void 0!==this.borderProps){this.btnBorderColor.setColor(this.borderProps.borderColor),this.btnBorderColor.setAutoColor("auto"==this.borderProps.borderColor),this.BordersImage.setVirtualBorderColor("object"==typeof this.btnBorderColor.color?this.btnBorderColor.color.color:this.btnBorderColor.color),"auto"==this.borderProps.borderColor?this.colorsBorder.clearSelection():this.colorsBorder.select(this.borderProps.borderColor,!0),this.cmbBorderSize.setValue(this.borderProps.borderSize.ptValue);var t=this.cmbBorderSize.getSelectedRecord();t&&this.onBorderSizeSelect(this.cmbBorderSize,t)}for(var e=0;e<this.BordersImage.rows;e++)for(var i=0;i<this.BordersImage.columns;i++)this.BordersImage.getCell(i,e).on("borderclick",function(t,e,i,n){void 0===this.ChangedBorders&&(this.ChangedBorders=new Asc.asc_CParagraphBorders),this._UpdateCellBordersStyle(t,e,i,n,this.Borders)},this);this.BordersImage.on("borderclick",function(t,e,i,n){void 0===this.ChangedBorders&&(this.ChangedBorders=new Asc.asc_CParagraphBorders),this._UpdateTableBordersStyle(t,e,i,n,this.Borders)},this);var n="object"==typeof this.paragraphShade?this.paragraphShade.color:this.paragraphShade;if(this.BordersImage.setCellsColor(n),this.storageName){var o=Common.localStorage.getItem(this.storageName);this.setActiveCategory(null!==o?parseInt(o):0)}},onStrikeChange:function(t,e,i,n){if(this._changedProps&&1!=this.checkGroup&&this._changedProps.put_Strikeout("checked"==t.getValue()),this.checkGroup=0,"checked"==t.getValue()&&(this.checkGroup=1,this.chDoubleStrike.setValue(0),this._changedProps&&this._changedProps.put_DStrikeout(!1),this.checkGroup=0),this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;o.put_Strikeout("checked"==t.getValue()),o.put_DStrikeout("checked"==this.chDoubleStrike.getValue()),this.api.SetDrawImagePlaceParagraph("paragraphadv-font-img",o)}},onDoubleStrikeChange:function(t,e,i,n){if(this._changedProps&&1!=this.checkGroup&&this._changedProps.put_DStrikeout("checked"==t.getValue()),this.checkGroup=0,"checked"==t.getValue()&&(this.checkGroup=1,this.chStrike.setValue(0),this._changedProps&&this._changedProps.put_Strikeout(!1),this.checkGroup=0),this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;o.put_DStrikeout("checked"==t.getValue()),o.put_Strikeout("checked"==this.chStrike.getValue()),this.api.SetDrawImagePlaceParagraph("paragraphadv-font-img",o)}},onSuperscriptChange:function(t,e,i,n){if(this._changedProps&&2!=this.checkGroup&&this._changedProps.put_Superscript("checked"==t.getValue()),this.checkGroup=0,"checked"==t.getValue()&&(this.checkGroup=2,this.chSubscript.setValue(0),this._changedProps&&this._changedProps.put_Subscript(!1),this.checkGroup=0),this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;o.put_Superscript("checked"==t.getValue()),o.put_Subscript("checked"==this.chSubscript.getValue()),this.api.SetDrawImagePlaceParagraph("paragraphadv-font-img",o)}},onSubscriptChange:function(t,e,i,n){if(this._changedProps&&2!=this.checkGroup&&this._changedProps.put_Subscript("checked"==t.getValue()),this.checkGroup=0,"checked"==t.getValue()&&(this.checkGroup=2,this.chSuperscript.setValue(0),this._changedProps&&this._changedProps.put_Superscript(!1),this.checkGroup=0),this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;o.put_Subscript("checked"==t.getValue()),o.put_Superscript("checked"==this.chSuperscript.getValue()),this.api.SetDrawImagePlaceParagraph("paragraphadv-font-img",o)}},onSmallCapsChange:function(t,e,i,n){if(this._changedProps&&3!=this.checkGroup&&this._changedProps.put_SmallCaps("checked"==t.getValue()),this.checkGroup=0,"checked"==t.getValue()&&(this.checkGroup=3,this.chAllCaps.setValue(0),this._changedProps&&this._changedProps.put_AllCaps(!1),this.checkGroup=0),this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;o.put_SmallCaps("checked"==t.getValue()),o.put_AllCaps("checked"==this.chAllCaps.getValue()),this.api.SetDrawImagePlaceParagraph("paragraphadv-font-img",o)}},onAllCapsChange:function(t,e,i,n){if(this._changedProps&&3!=this.checkGroup&&this._changedProps.put_AllCaps("checked"==t.getValue()),this.checkGroup=0,"checked"==t.getValue()&&(this.checkGroup=3,this.chSmallCaps.setValue(0),this._changedProps&&this._changedProps.put_SmallCaps(!1),this.checkGroup=0),this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;o.put_AllCaps("checked"==t.getValue()),o.put_SmallCaps("checked"==this.chSmallCaps.getValue()),this.api.SetDrawImagePlaceParagraph("paragraphadv-font-img",o)}},onBorderSizeSelect:function(t,e){this.BorderSize={ptValue:e.value,pxValue:e.pxValue},this.BordersImage.setVirtualBorderSize(this.BorderSize.pxValue)},onColorsBorderSelect:function(t,e){this.BordersImage.setVirtualBorderColor("object"==typeof e?e.color:e)},onColorsBackSelect:function(t,e){this.paragraphShade=e,this._changedProps&&(void 0!==this._changedProps.get_Shade()&&null!==this._changedProps.get_Shade()||this._changedProps.put_Shade(new Asc.asc_CParagraphShd),"transparent"==this.paragraphShade?this._changedProps.get_Shade().put_Value(Asc.c_oAscShdNil):(this._changedProps.get_Shade().put_Value(Asc.c_oAscShdClear),this._changedProps.get_Shade().put_Color(Common.Utils.ThemeColor.getRgbColor(this.paragraphShade))));var i="object"==typeof e?e.color:e;this.BordersImage.setCellsColor(i)},_ApplyBorderPreset:function(t){var e=t.options.strId;this.ChangedBorders=null,this.Borders.put_Left(this._UpdateBorderStyle(this.Borders.get_Left(),e.indexOf("l")>-1)),this.Borders.put_Top(this._UpdateBorderStyle(this.Borders.get_Top(),e.indexOf("t")>-1)),this.Borders.put_Right(this._UpdateBorderStyle(this.Borders.get_Right(),e.indexOf("r")>-1)),this.Borders.put_Bottom(this._UpdateBorderStyle(this.Borders.get_Bottom(),e.indexOf("b")>-1)),this.Borders.put_Between(this._UpdateBorderStyle(this.Borders.get_Between(),e.indexOf("m")>-1)),this._UpdateBorders()},_UpdateBorderStyle:function(t,e){if(null==t&&(t=new Asc.asc_CTextBorder),e&&this.BorderSize.ptValue>0){var i=parseFloat(this.BorderSize.ptValue);t.put_Value(1),t.put_Size(25.4*i/72);var n;this.btnBorderColor.isAutoColor()?(n=new Asc.asc_CColor,n.put_auto(!0)):n=Common.Utils.ThemeColor.getRgbColor(this.btnBorderColor.color),t.put_Color(n)}else t.put_Color(new Asc.asc_CColor),t.put_Value(0);return t},_UpdateCellBordersStyle:function(t,e,i,n,o){var s=o;0==t.col&&e.indexOf("l")>-1&&(s.put_Left(this._UpdateBorderStyle(s.get_Left(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Left(new Asc.asc_CTextBorder(s.get_Left()))),t.col==this.tableStylerColumns-1&&e.indexOf("r")>-1&&(s.put_Right(this._UpdateBorderStyle(s.get_Right(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Right(new Asc.asc_CTextBorder(s.get_Right()))),0==t.row&&e.indexOf("t")>-1&&(s.put_Top(this._UpdateBorderStyle(s.get_Top(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Top(new Asc.asc_CTextBorder(s.get_Top()))),t.row==this.tableStylerRows-1&&e.indexOf("b")>-1&&(s.put_Bottom(this._UpdateBorderStyle(s.get_Bottom(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Bottom(new Asc.asc_CTextBorder(s.get_Bottom()))),(0==t.row&&e.indexOf("b")>-1||t.row==this.tableStylerRows-1&&e.indexOf("t")>-1)&&(s.put_Between(this._UpdateBorderStyle(s.get_Between(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Between(new Asc.asc_CTextBorder(s.get_Between())))},_UpdateTableBordersStyle:function(t,e,i,n,o){var s=o;e.indexOf("l")>-1&&(s.put_Left(this._UpdateBorderStyle(s.get_Left(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Left(new Asc.asc_CTextBorder(s.get_Left()))),e.indexOf("t")>-1&&(s.put_Top(this._UpdateBorderStyle(s.get_Top(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Top(new Asc.asc_CTextBorder(s.get_Top()))),e.indexOf("r")>-1&&(s.put_Right(this._UpdateBorderStyle(s.get_Right(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Right(new Asc.asc_CTextBorder(s.get_Right()))),e.indexOf("b")>-1&&(s.put_Bottom(this._UpdateBorderStyle(s.get_Bottom(),i>0)),this.ChangedBorders&&this.ChangedBorders.put_Bottom(new Asc.asc_CTextBorder(s.get_Bottom())))},_UpdateBorders:function(){var t=this.BorderSize,e=this.btnBorderColor.color;if(this._UpdateBorder(this.Borders.get_Left(),"l"),this._UpdateBorder(this.Borders.get_Top(),"t"),this._UpdateBorder(this.Borders.get_Right(),"r"),this._UpdateBorder(this.Borders.get_Bottom(),"b"),null!==this.Borders.get_Between())for(var i=0;i<this.BordersImage.columns;i++)this._UpdateCellBorder(this.Borders.get_Between(),"b",this.BordersImage.getCell(i,0)),this._UpdateCellBorder(this.Borders.get_Between(),"t",this.BordersImage.getCell(i,1));this.BordersImage.setVirtualBorderSize(t.pxValue),this.BordersImage.setVirtualBorderColor("object"==typeof e?e.color:e)},_UpdateCellBorder:function(t,e,i){null!==t&&void 0!==t&&null!==t.get_Value()&&null!==t.get_Size()&&null!==t.get_Color()&&1==t.get_Value()?(i.setBordersSize(e,this._BorderPt2Px(72*t.get_Size()/25.4)),i.setBordersColor(e,"rgb("+t.get_Color().get_r()+","+t.get_Color().get_g()+","+t.get_Color().get_b()+")")):i.setBordersSize(e,0)},_UpdateBorder:function(t,e){null!==t&&void 0!==t&&null!==t.get_Value()&&null!==t.get_Size()&&null!==t.get_Color()&&1==t.get_Value()?(this.BordersImage.setBordersSize(e,this._BorderPt2Px(72*t.get_Size()/25.4)),this.BordersImage.setBordersColor(e,"rgb("+t.get_Color().get_r()+","+t.get_Color().get_g()+","+t.get_Color().get_b()+")")):this.BordersImage.setBordersSize(e,0)},_BorderPt2Px:function(t){return 0==t?0:t<.6?.5:t<=1?1:t<=1.5?2:t<=2.25?3:t<=3?4:t<=4.5?5:6},addTab:function(t,e){var i=this.numTab.getNumberValue(),n=this.cmbAlign.getValue(),o=this.cmbLeader.getValue(),s=this._arrKeyTabAlign[n],a=this._arrKeyTabLeader[o],r=this.tabList.store,l=r.find(function(t){return Math.abs(t.get("tabPos")-i)<.001});l?(l.set("tabAlign",n),l.set("tabLeader",o),l.set("displayTabAlign",s),l.set("displayTabLeader",a),this._tabListChanged=!0):(l=new Common.UI.DataViewModel,l.set({tabPos:i,value:i+" "+Common.Utils.Metric.getCurrentMetricName(),tabAlign:n,tabLeader:o,displayTabLeader:a,displayTabAlign:s}),r.add(l)),this.tabList.selectRecord(l),this.tabList.scrollToRecord(l)},removeTab:function(t,e){var i=this.tabList.getSelectedRec();if(i){var n=this.tabList.store,o=_.indexOf(n.models,i);n.remove(i),o>n.length-1&&(o=n.length-1),n.length>0&&(this.tabList.selectByIndex(o),this.tabList.scrollToRecord(n.at(o)))}},removeAllTabs:function(t,e){this.tabList.store.reset()},onSelectTab:function(t,e,i){if(i){var n={};if(_.isFunction(i.toJSON)){if(!i.get("selected"))return;n=i.toJSON()}else n=i;this.numTab.setValue(n.tabPos),this.cmbAlign.setValue(n.tabAlign),this.cmbLeader.setValue(n.tabLeader)}},hideTextOnlySettings:function(t){this.TextOnlySettings.toggleClass("hidden",1==t),this.btnsCategory[1].setVisible(!t),this.btnsCategory[2].setVisible(!t),this.btnsCategory[5].setVisible(!t)},onLineRuleSelect:function(t,e){if(null===this.Spacing){var i=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;this.Spacing=i.get_Spacing()}if(this.Spacing.put_LineRule(e.value),this.CurLineRuleIdx!==this.Spacing.get_LineRule()){this.numLineHeight.setDefaultUnit(this._arrLineRule[e.value].defaultUnit),this.numLineHeight.setMinValue(this._arrLineRule[e.value].minValue),this.numLineHeight.setStep(this._arrLineRule[e.value].step);var n=this.numLineHeight.getNumberValue();this.Spacing.get_LineRule()===c_paragraphLinerule.LINERULE_AUTO?this.numLineHeight.setValue(this._arrLineRule[e.value].defaultValue):this.CurLineRuleIdx===c_paragraphLinerule.LINERULE_AUTO?this.numLineHeight.setValue(Common.Utils.Metric.fnRecalcFromMM(this._arrLineRule[e.value].defaultValue)):this.numLineHeight.setValue(n),this.CurLineRuleIdx=e.value}},onNumLineHeightChange:function(t,e,i,n){if(""!==this.cmbLineRule.getRawValue()){if(null===this.Spacing){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;this.Spacing=o.get_Spacing()}this.Spacing.put_Line(this.cmbLineRule.getValue()==c_paragraphLinerule.LINERULE_AUTO?t.getNumberValue():Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))}},onSpecialSelect:function(t,e){if(this.CurSpecial=e.value,this.CurSpecial===c_paragraphSpecial.NONE_SPECIAL&&this.numSpecialBy.setValue(0,!0),this._changedProps){null!==this._changedProps.get_Ind()&&void 0!==this._changedProps.get_Ind()||this._changedProps.put_Ind(new Asc.asc_CParagraphInd);var i=Common.Utils.Metric.fnRecalcToMM(this.numSpecialBy.getNumberValue());0===i&&(this.numSpecialBy.setValue(Common.Utils.Metric.fnRecalcFromMM(this._arrSpecial[e.value].defaultValue),!0),i=this._arrSpecial[e.value].defaultValue),this.CurSpecial===c_paragraphSpecial.HANGING&&(i=-i),this._changedProps.get_Ind().put_FirstLine(i)}},onFirstLineChange:function(t,e,i,n){if(this._changedProps){null!==this._changedProps.get_Ind()&&void 0!==this._changedProps.get_Ind()||this._changedProps.put_Ind(new Asc.asc_CParagraphInd);var o=Common.Utils.Metric.fnRecalcToMM(t.getNumberValue());this.CurSpecial===c_paragraphSpecial.NONE_SPECIAL&&o>0?(this.CurSpecial=c_paragraphSpecial.FIRST_LINE,this.cmbSpecial.setValue(c_paragraphSpecial.FIRST_LINE)):0===o?(this.CurSpecial=c_paragraphSpecial.NONE_SPECIAL,this.cmbSpecial.setValue(c_paragraphSpecial.NONE_SPECIAL)):this.CurSpecial===c_paragraphSpecial.HANGING&&(o=-o),this._changedProps.get_Ind().put_FirstLine(o)}},onOutlinelevelSelect:function(t,e){this._changedProps&&this._changedProps.put_OutlineLvl(e.value>-1?e.value:null)},textTitle:"Paragraph - Advanced Settings",strIndentsLeftText:"Left",strIndentsRightText:"Right",strParagraphIndents:"Indents & Spacing",strParagraphPosition:"Placement",strParagraphFont:"Font",strBreakBefore:"Page break before",strKeepLines:"Keep lines together",strBorders:"Borders & Fill",textBorderWidth:"Border Size",textBorderColor:"Border Color",textBackColor:"Background Color",textBorderDesc:"Click on diagramm or use buttons to select borders",txtNoBorders:"No borders",textEffects:"Effects",textCharacterSpacing:"Character Spacing",textSpacing:"Spacing",textPosition:"Position",strDoubleStrike:"Double strikethrough",strStrike:"Strikethrough",strSuperscript:"Superscript",strSubscript:"Subscript",strSmallCaps:"Small caps",strAllCaps:"All caps",strOrphan:"Orphan control",strKeepNext:"Keep with next",strTabs:"Tab",textSet:"Specify",textRemove:"Remove",textRemoveAll:"Remove All",textTabLeft:"Left",textTabRight:"Right",textTabCenter:"Center",textAlign:"Alignment",textTabPosition:"Tab Position",textDefault:"Default Tab",textTop:"Top",textLeft:"Left",textBottom:"Bottom",textRight:"Right",strMargins:"Margins",tipTop:"Set Top Border Only",tipLeft:"Set Left Border Only",tipBottom:"Set Bottom Border Only",tipRight:"Set Right Border Only",tipAll:"Set Outer Border and All Inner Lines",tipNone:"Set No Borders",tipInner:"Set Horizontal Inner Lines Only",tipOuter:"Set Outer Border Only",noTabs:"The specified tabs will appear in this field",textLeader:"Leader",textNone:"None",strParagraphLine:"Line & Page Breaks",strIndentsSpacingBefore:"Before",strIndentsSpacingAfter:"After",strIndentsLineSpacing:"Line Spacing",
txtAutoText:"Auto",textAuto:"Multiple",textAtLeast:"At least",textExact:"Exactly",strSomeParagraphSpace:"Don't add interval between paragraphs of the same style",strIndentsSpecial:"Special",textNoneSpecial:"(none)",textFirstLine:"First line",textHanging:"Hanging",textJustified:"Justified",textBodyText:"Basic Text",textLevel:"Level",strIndentsOutlinelevel:"Outline level",strIndent:"Indents",strSpacing:"Spacing",strSuppressLineNumbers:"Suppress line numbers"},DE.Views.ParagraphSettingsAdvanced||{}))}),define("text!documenteditor/main/app/template/TableSettingsAdvanced.template",[],function(){return'<div id="id-adv-table-width" class="settings-panel active">\r\n    <div class="inner-content">\r\n        <table cols="3">\r\n            <tr>\r\n                <td colspan="3" class="padding-small">\r\n                    <label class="header"><%= scope.textTableSize %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td style="vertical-align: bottom; padding-bottom: 11px;">\r\n                    <div id="tableadv-checkbox-width"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textWidth %></label>\r\n                    <div id="tableadv-number-width" style="margin-right: 10px;"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textMeasure %></label>\r\n                    <div id="tableadv-cmb-unit" style="width: 115px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan="3" class="padding-large">\r\n                    <div id="tableadv-checkbox-autofit"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n        <div class="padding-small"></div>\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textDefaultMargins %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="125px">\r\n                    <label class="input-label"><%= scope.textTop %></label>\r\n                    <div id="tableadv-number-margin-table-top"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textLeft %></label>\r\n                    <div id="tableadv-number-margin-table-left"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textBottom %></label>\r\n                    <div id="tableadv-number-margin-table-bottom"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textRight %></label>\r\n                    <div id="tableadv-number-margin-table-right"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n        <div class="padding-small"></div>\r\n        <table cols="2">\r\n            <tr>\r\n                <td colspan="2" class="padding-small">\r\n                    <label class="header"><%= scope.textOptions %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td style="vertical-align: bottom; padding-bottom: 19px;">\r\n                    <div id="tableadv-checkbox-spacing"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textAllowSpacing %></label>\r\n                    <div id="tableadv-number-spacing"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n    <div class="inner-content">\r\n    </div>\r\n</div>\r\n<div id="id-adv-table-cell-props" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="3">\r\n            <tr>\r\n                <td colspan="3" class="padding-small">\r\n                    <label class="header"><%= scope.textCellSize %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td style="vertical-align: bottom; padding-bottom: 19px;">\r\n                    <div id="tableadv-checkbox-prefwidth"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textPrefWidth %></label>\r\n                    <div id="tableadv-number-prefwidth" style="margin-right: 10px;"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textMeasure %></label>\r\n                    <div id="tableadv-combo-prefwidth-unit" style="width: 115px;"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n        <div class="padding-small"></div>\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textMargins %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan="2" class="padding-small">\r\n                    <div id="tableadv-checkbox-margins"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="125px">\r\n                    <label class="input-label"><%= scope.textTop %></label>\r\n                    <div id="tableadv-number-margin-top"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textLeft %></label>\r\n                    <div id="tableadv-number-margin-left"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textBottom %></label>\r\n                    <div id="tableadv-number-margin-bottom"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textRight %></label>\r\n                    <div id="tableadv-number-margin-right"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan="2" class="padding-small"></td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textCellOptions %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan="2" class="padding-small">\r\n                    <div id="tableadv-checkbox-wrap"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-adv-table-wrap" class="settings-panel">\r\n    <div class="inner-content padding-large">\r\n        <label class="header padding-small" style="display: block;"><%= scope.textWrappingStyle %></label>\r\n        <div id="tableadv-button-wrap-none" style="display: inline-block; margin-right:5px;"></div>\r\n        <div id="tableadv-button-wrap-parallel" style="display: inline-block; margin-right:5px;"></div>\r\n    </div>\r\n    <div class="padding-small"></div>\r\n    <div class="inner-content">\r\n        <div id="tableadv-panel-align" style="width: 100%;">\r\n            <label class="header padding-small"><%= scope.textAlign %></label>\r\n            <div class="padding-large">\r\n                <div id="tableadv-button-align-left" style="display: inline-block; margin-right:5px;"></div>\r\n                <div id="tableadv-button-align-center" style="display: inline-block; margin-right:5px;"></div>\r\n                <div id="tableadv-button-align-right" style="display: inline-block; margin-right:5px;"></div>\r\n                <div style="display: inline-block; vertical-align: bottom; margin-left: 20px; margin-bottom: 1px;">\r\n                    <label class="input-label" style="display: block;"><%= scope.textIndLeft %></label>\r\n                    <div id="tableadv-number-indent"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div id="tableadv-panel-distance" class="settings-hidden" style="width: 100%;">\r\n            <table cols="2" style="width: 100%;">\r\n                <tr>\r\n                    <td colspan=2 class="padding-small">\r\n                        <label class="header"><%= scope.textDistance %></label>\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <td class="padding-small" width="125px">\r\n                        <label class="input-label"><%= scope.textTop %></label>\r\n                        <div id="tableadv-number-distance-top"></div>\r\n                    </td>\r\n                    <td class="padding-small">\r\n                        <label class="input-label"><%= scope.textLeft %></label>\r\n                        <div id="tableadv-number-distance-left"></div>\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <td class="padding-small">\r\n                        <label class="input-label"><%= scope.textBottom %></label>\r\n                        <div id="tableadv-number-distance-bottom"></div>\r\n                    </td>\r\n                    <td class="padding-small">\r\n                        <label class="input-label"><%= scope.textRight %></label>\r\n                        <div id="tableadv-number-distance-right"></div>\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div id="id-adv-table-borders" class="settings-panel">\r\n    <div class="inner-content padding-large">\r\n        <div style="width: 100%;">\r\n            <label class="input-label"><%= scope.textBorderWidth %></label>\r\n            <div id="tableadv-combo-border-size" style="display: inline-block; vertical-align: middle; width: 93px;"></div>\r\n            <div style="display: inline-block; float:right;vertical-align: middle;">\r\n                <label class="input-label" ><%= scope.textBorderColor %></label>\r\n                <div id="tableadv-border-color-btn" style="display: inline-block;"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="inner-content">\r\n        <label class="input-label padding-large" style="width: 100%;"><%= scope.textBorderDesc %></label>\r\n        <div id="tableadv-panel-borders" style="width: 100%;" class="padding-large">\r\n            <div id="id-detablestyler" style="display: inline-block; vertical-align: middle; width: 200px; height: 200px;outline: 1px solid #ccc;"></div>\r\n            <div style="display: inline-block; vertical-align: middle; width: 76px; height: 200px; padding-top: 10px; padding-left: 10px;">\r\n                <div id="tableadv-button-border-all"></div>\r\n                <div id="tableadv-button-border-none"></div>\r\n                <div id="tableadv-button-border-inner"></div>\r\n                <div id="tableadv-button-border-outer"></div>\r\n            </div>\r\n        </div>\r\n        <div id="tableadv-panel-borders-spacing" style="width: 100%;" class="padding-large settings-hidden">\r\n            <div id="id-detablestyler-spacing" style="display: inline-block; vertical-align: middle; width: 200px; height: 200px;outline: 1px solid #ccc;"></div>\r\n            <div style="display: inline-block; float:right;vertical-align: middle; width: 76px; height: 200px; padding-top: 10px;">\r\n                <div id="tableadv-button-border-all-none" style="display: inline-block;"></div>\r\n                <div id="tableadv-button-border-all-table" style="display: inline-block;"></div>\r\n                <div id="tableadv-button-border-none-none" style="display: inline-block;"></div>\r\n                <div id="tableadv-button-border-none-table" style="display: inline-block;"></div>\r\n                <div id="tableadv-button-border-inner-none" style="display: inline-block;"></div>\r\n                <div id="tableadv-button-border-inner-table" style="display: inline-block;"></div>\r\n                <div id="tableadv-button-border-outer-none" style="display: inline-block;"></div>\r\n                <div id="tableadv-button-border-outer-table" style="display: inline-block;"></div>\r\n            </div>\r\n        </div>\r\n        <div style="width: 100%;">\r\n            <div id="tableadv-panel-cell-back" style="display: inline-block;">\r\n                <label class="input-label" style="margin-right: 5px;"><%= scope.textBackColor %></label>\r\n                <div id="tableadv-button-back-color" style="display: inline-block;"></div>\r\n            </div>\r\n            <div id="tableadv-panel-table-back" style="display: inline-block;">\r\n                <label class="input-label" style="margin-right: 5px;"><%= scope.textTableBackColor %></label>\r\n                <div id="tableadv-button-table-back-color" style="display: inline-block;"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div id="id-adv-table-position" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="3" style="width: 100%;">\r\n            <tr>\r\n                <td colspan="3" class="padding-small">\r\n                    <label class="header"><%= scope.textHorizontal %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td style="vertical-align: bottom; padding-bottom: 12px;">\r\n                    <div id="tableadv-radio-halign"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textAlignment %></label>\r\n                    <div id="tableadv-combo-halign" style="width: 115px;"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textRelative %></label>\r\n                    <div id="tableadv-combo-hrelative" style="width: 115px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td style="vertical-align: bottom; padding-bottom: 12px;">\r\n                    <div id="tableadv-radio-hposition"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textPosition %></label>\r\n                    <div id="tableadv-spin-x"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textRightOf %></label>\r\n                    <div id="tableadv-combo-hposition" style="width: 115px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan="3" class="padding-small">\r\n                    <label class="header"><%= scope.textVertical %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td style="vertical-align: bottom; padding-bottom: 12px;">\r\n                    <div id="tableadv-radio-valign"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textAlignment %></label>\r\n                    <div id="tableadv-combo-valign" style="width: 115px;"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textRelative %></label>\r\n                    <div id="tableadv-combo-vrelative" style="width: 115px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td style="vertical-align: bottom; padding-bottom: 19px;">\r\n                    <div id="tableadv-radio-vposition"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textPosition %></label>\r\n                    <div id="tableadv-spin-y"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textBelow %></label>\r\n                    <div id="tableadv-combo-vposition" style="width: 115px;"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n    <div class="separator horizontal padding-large"></div>\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan="2" class="padding-small">\r\n                    <label class="header"><%= scope.textOptions %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    <div id="tableadv-checkbox-move"></div>\r\n                </td>\r\n                <td>\r\n                    <div id="tableadv-checkbox-overlap"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-adv-table-alttext" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="1" width="100%">\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <label class="header"><%= scope.textAltTitle %></label>\r\n                    <div id="table-advanced-alt-title"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    <label class="header"><%= scope.textAltDescription %></label>\r\n                    <textarea id="table-advanced-alt-description" class="form-control" style="width: 100%; height: 120px;"></textarea>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    <label><%= scope.textAltTip %></label>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>'}),define("documenteditor/main/app/view/TableSettingsAdvanced",["text!documenteditor/main/app/template/TableSettingsAdvanced.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/ComboBox","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox","common/main/lib/component/RadioBox","common/main/lib/component/ThemeColorPalette","common/main/lib/component/ColorButton","common/main/lib/component/ListView","common/main/lib/component/TableStyler"],function(t){"use strict";DE.Views.TableSettingsAdvanced=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:340,height:436,toggleGroup:"table-adv-settings-group",storageName:"de-table-settings-adv-category"},initialize:function(e){_.extend(this.options,{title:this.textTitle,items:[{panelId:"id-adv-table-width",panelCaption:this.textTable},{panelId:"id-adv-table-cell-props",panelCaption:this.textCellProps},{panelId:"id-adv-table-borders",panelCaption:this.textBordersBackgroung},{panelId:"id-adv-table-position",panelCaption:this.textTablePosition},{panelId:"id-adv-table-wrap",panelCaption:this.textWrap},{panelId:"id-adv-table-alttext",panelCaption:this.textAlt}],contentTemplate:_.template(t)({scope:this})},e),Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this.spinners=[],this._changedProps=null,this._cellBackground=null,this._state={HAlignType:Asc.c_oAscXAlign.Left,HAlignFrom:Asc.c_oAscHAnchor.Margin,HPositionFrom:Asc.c_oAscHAnchor.Margin,VAlignType:Asc.c_oAscYAlign.Top,VAlignFrom:Asc.c_oAscVAnchor.Margin,VPositionFrom:Asc.c_oAscVAnchor.Margin,spnXChanged:!1,spnYChanged:!1,fromWrapInline:!1,verticalPropChanged:!1,horizontalPropChanged:!1,alignChanged:!1},this._allTable=!1,this.TableMargins={Left:.19,Right:.19,Top:0,Bottom:0},this.CellMargins={Left:.19,Right:.19,Top:null,Bottom:null,Flag:0},this.TableBorders={},this.CellBorders={},this.ChangedTableBorders=void 0,this.ChangedCellBorders=void 0,this.BorderSize={ptValue:0,pxValue:0},this.TableColor={Value:1,Color:"transparent"},this.CellColor={Value:1,Color:"transparent"},this.IndeterminateColor="#C8C8C8",this.IndeterminateSize=4.5,this.tableStylerRows=this.options.tableStylerRows,this.tableStylerColumns=this.options.tableStylerColumns,this.borderProps=this.options.borderProps,this.pageWidth=210,this._originalProps=new Asc.CTableProp(this.options.tableProps)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this._marginsChange=function(t,e,i,n,o,s){"table"==o?this.TableMargins[s]=t.getNumberValue():this.CellMargins[s]=t.getNumberValue()},this.chWidth=new Common.UI.CheckBox({el:$("#tableadv-checkbox-width"),value:!0,labelText:""}),this.chWidth.on("change",_.bind(function(t,e,i,n){var o="checked"==e;this.nfWidth.setDisabled(!o),this.cmbUnit.setDisabled(!o),this._changedProps&&(o&&this.nfWidth.getNumberValue()>0?this._changedProps.put_Width(this.cmbUnit.getValue()?-this.nfWidth.getNumberValue():Common.Utils.Metric.fnRecalcToMM(this.nfWidth.getNumberValue())):this._changedProps.put_Width(null))},this)),this.nfWidth=new Common.UI.MetricSpinner({el:$("#tableadv-number-width"),step:.1,width:115,defaultUnit:"cm",value:"10 cm",maxValue:55.88,minValue:0}),this.nfWidth.on("change",_.bind(function(t,e,i,n){this._changedProps&&this._changedProps.put_Width(this.cmbUnit.getValue()?-t.getNumberValue():Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))},this));var e=Common.Utils.Metric.getCurrentMetric();this.cmbUnit=new Common.UI.ComboBox({el:$("#tableadv-cmb-unit"),style:"width: 115px;",menuStyle:"min-width: 115px;",editable:!1,cls:"input-group-nr",data:[{value:0,displayValue:e==Common.Utils.Metric.c_MetricUnits.pt?this.txtPt:e==Common.Utils.Metric.c_MetricUnits.inch?this.txtInch:this.txtCm},{value:1,displayValue:this.txtPercent}],takeFocusOnClose:!0}),this.cmbUnit.on("selected",_.bind(function(t,e){if(this._changedProps){var i=Common.Utils.Metric.fnRecalcFromMM(558);this.nfWidth.setDefaultUnit(e.value?"%":Common.Utils.Metric.getCurrentMetricName()),this.nfWidth.setMaxValue(e.value?parseFloat((100*i/this.pageWidth).toFixed(2)):i),this.nfWidth.setStep(e.value||Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1),this.nfWidth.setValue(e.value?100*this.nfWidth.getNumberValue()/this.pageWidth:this.pageWidth*this.nfWidth.getNumberValue()/100),this._changedProps.put_Width(e.value?-this.nfWidth.getNumberValue():Common.Utils.Metric.fnRecalcToMM(this.nfWidth.getNumberValue()))}},this)),this.chAllowSpacing=new Common.UI.CheckBox({el:$("#tableadv-checkbox-spacing"),value:!0,labelText:""}),this.chAllowSpacing.on("change",_.bind(function(t,e,i,n){var o="checked"==e;this._changedProps&&(this.nfSpacing.setDisabled(!o),this.ShowHideSpacing(o),this._changedProps&&(o&&this.nfSpacing.getNumberValue()>0?this._changedProps.put_Spacing(Common.Utils.Metric.fnRecalcToMM(this.nfSpacing.getNumberValue())):this._changedProps.put_Spacing(null)))},this)),this.nfSpacing=new Common.UI.MetricSpinner({el:$("#tableadv-number-spacing"),step:.1,width:115,defaultUnit:"cm",value:"0.5 cm",maxValue:2.14,minValue:0}),this.nfSpacing.on("change",_.bind(function(t,e,i,n){this._changedProps&&this._changedProps.put_Spacing(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))},this)),this.spinners.push(this.nfSpacing),this.chAutofit=new Common.UI.CheckBox({el:$("#tableadv-checkbox-autofit"),value:!0,labelText:this.textAutofit}),this.chAutofit.on("change",_.bind(function(t,e,i,n){this._changedProps&&this._changedProps.put_TableLayout("checked"==t.getValue()?Asc.c_oAscTableLayout.AutoFit:Asc.c_oAscTableLayout.Fixed)},this)),this.spnTableMarginTop=new Common.UI.MetricSpinner({el:$("#tableadv-number-margin-table-top"),step:.1,width:85,defaultUnit:"cm",value:"0 cm",maxValue:55.87,minValue:0}),this.spnTableMarginTop.on("change",_.bind(function(t,e,i,n){this._marginsChange(t,e,i,n,"table","Top"),this._changedProps&&(void 0===this._changedProps.get_DefaultMargins()&&this._changedProps.put_DefaultMargins(new Asc.asc_CPaddings),this._changedProps.get_DefaultMargins().put_Top(null!==this.TableMargins.Top?Common.Utils.Metric.fnRecalcToMM(this.TableMargins.Top):null),this.TableMargins.isChanged=!0)},this)),this.spinners.push(this.spnTableMarginTop),this.spnTableMarginBottom=new Common.UI.MetricSpinner({el:$("#tableadv-number-margin-table-bottom"),step:.1,width:85,defaultUnit:"cm",value:"0 cm",maxValue:55.87,minValue:0}),this.spnTableMarginBottom.on("change",_.bind(function(t,e,i,n){this._marginsChange(t,e,i,n,"table","Bottom"),this._changedProps&&(void 0===this._changedProps.get_DefaultMargins()&&this._changedProps.put_DefaultMargins(new Asc.asc_CPaddings),this._changedProps.get_DefaultMargins().put_Bottom(null!==this.TableMargins.Bottom?Common.Utils.Metric.fnRecalcToMM(this.TableMargins.Bottom):null),this.TableMargins.isChanged=!0)},this)),this.spinners.push(this.spnTableMarginBottom),this.spnTableMarginLeft=new Common.UI.MetricSpinner({el:$("#tableadv-number-margin-table-left"),step:.1,width:85,defaultUnit:"cm",value:"0.19 cm",maxValue:9.34,minValue:0}),this.spnTableMarginLeft.on("change",_.bind(function(t,e,i,n){this._marginsChange(t,e,i,n,"table","Left"),this._changedProps&&(void 0===this._changedProps.get_DefaultMargins()&&this._changedProps.put_DefaultMargins(new Asc.asc_CPaddings),this._changedProps.get_DefaultMargins().put_Left(null!==this.TableMargins.Left?Common.Utils.Metric.fnRecalcToMM(this.TableMargins.Left):null),this.TableMargins.isChanged=!0)},this)),this.spinners.push(this.spnTableMarginLeft),this.spnTableMarginRight=new Common.UI.MetricSpinner({el:$("#tableadv-number-margin-table-right"),step:.1,width:85,defaultUnit:"cm",value:"0.19 cm",maxValue:9.34,minValue:0}),this.spnTableMarginRight.on("change",_.bind(function(t,e,i,n){this._marginsChange(t,e,i,n,"table","Right"),this._changedProps&&(void 0===this._changedProps.get_DefaultMargins()&&this._changedProps.put_DefaultMargins(new Asc.asc_CPaddings),this._changedProps.get_DefaultMargins().put_Right(null!==this.TableMargins.Right?Common.Utils.Metric.fnRecalcToMM(this.TableMargins.Right):null),this.TableMargins.isChanged=!0)},this)),this.spinners.push(this.spnTableMarginRight);var i=function(){"indeterminate"==t.CellMargins.Flag?t._changedProps.get_CellMargins().put_Flag(1):"checked"==t.CellMargins.Flag?t._changedProps.get_CellMargins().put_Flag(0):t._changedProps.get_CellMargins().put_Flag(2)};this.chCellMargins=new Common.UI.CheckBox({el:$("#tableadv-checkbox-margins"),value:!0,labelText:this.textCheckMargins}),this.chCellMargins.on("change",_.bind(function(t,e,n,o){"checked"==n&&this._originalProps&&1==this._originalProps.get_CellMargins().get_Flag()&&t.setValue("indeterminate",!0),this.fillMargins.call(this,t.getValue()),this.CellMargins.Flag=t.getValue(),this._changedProps&&(void 0===this._changedProps.get_CellMargins()&&this._changedProps.put_CellMargins(new Asc.CMargins),this._changedProps.get_CellMargins().put_Left(null!==this.CellMargins.Left?Common.Utils.Metric.fnRecalcToMM(this.CellMargins.Left):null),this._changedProps.get_CellMargins().put_Top(null!==this.CellMargins.Top?Common.Utils.Metric.fnRecalcToMM(this.CellMargins.Top):null),this._changedProps.get_CellMargins().put_Bottom(null!==this.CellMargins.Bottom?Common.Utils.Metric.fnRecalcToMM(this.CellMargins.Bottom):null),this._changedProps.get_CellMargins().put_Right(null!==this.CellMargins.Right?Common.Utils.Metric.fnRecalcToMM(this.CellMargins.Right):null),i())},this)),this.spnMarginTop=new Common.UI.MetricSpinner({el:$("#tableadv-number-margin-top"),step:.1,width:85,defaultUnit:"cm",value:"0 cm",maxValue:55.87,minValue:0}),this.spnMarginTop.on("change",_.bind(function(t,e,n,o){this._marginsChange(t,e,n,o,"cell","Top"),this._changedProps&&(void 0===this._changedProps.get_CellMargins()&&this._changedProps.put_CellMargins(new Asc.CMargins),this._changedProps.get_CellMargins().put_Top(null!==this.CellMargins.Top?Common.Utils.Metric.fnRecalcToMM(this.CellMargins.Top):null),i())},this)),this.spinners.push(this.spnMarginTop),this.spnMarginBottom=new Common.UI.MetricSpinner({el:$("#tableadv-number-margin-bottom"),step:.1,width:85,defaultUnit:"cm",value:"0 cm",maxValue:55.87,minValue:0}),this.spnMarginBottom.on("change",_.bind(function(t,e,n,o){this._marginsChange(t,e,n,o,"cell","Bottom"),this._changedProps&&(void 0===this._changedProps.get_CellMargins()&&this._changedProps.put_CellMargins(new Asc.CMargins),this._changedProps.get_CellMargins().put_Bottom(null!==this.CellMargins.Bottom?Common.Utils.Metric.fnRecalcToMM(this.CellMargins.Bottom):null),i())},this)),this.spinners.push(this.spnMarginBottom),this.spnMarginLeft=new Common.UI.MetricSpinner({el:$("#tableadv-number-margin-left"),step:.1,width:85,defaultUnit:"cm",value:"0.19 cm",maxValue:9.34,minValue:0}),this.spnMarginLeft.on("change",_.bind(function(t,e,n,o){this._marginsChange(t,e,n,o,"cell","Left"),this._changedProps&&(void 0===this._changedProps.get_CellMargins()&&this._changedProps.put_CellMargins(new Asc.CMargins),this._changedProps.get_CellMargins().put_Left(null!==this.CellMargins.Left?Common.Utils.Metric.fnRecalcToMM(this.CellMargins.Left):null),i())},this)),this.spinners.push(this.spnMarginLeft),this.spnMarginRight=new Common.UI.MetricSpinner({el:$("#tableadv-number-margin-right"),step:.1,width:85,defaultUnit:"cm",value:"0.19 cm",maxValue:9.34,minValue:0}),this.spnMarginRight.on("change",_.bind(function(t,e,n,o){this._marginsChange(t,e,n,o,"cell","Right"),this._changedProps&&(void 0===this._changedProps.get_CellMargins()&&this._changedProps.put_CellMargins(new Asc.CMargins),this._changedProps.get_CellMargins().put_Right(null!==this.CellMargins.Right?Common.Utils.Metric.fnRecalcToMM(this.CellMargins.Right):null),i())},this)),this.spinners.push(this.spnMarginRight),this.chPrefWidth=new Common.UI.CheckBox({el:$("#tableadv-checkbox-prefwidth"),value:!1,labelText:""}),this.chPrefWidth.on("change",_.bind(function(t,e,i,n){var o="checked"==e;this.nfPrefWidth.setDisabled(!o),this.cmbPrefWidthUnit.setDisabled(!o),this._changedProps&&(o&&this.nfPrefWidth.getNumberValue()>0?this._changedProps.put_CellsWidth(this.cmbPrefWidthUnit.getValue()?-this.nfPrefWidth.getNumberValue():Common.Utils.Metric.fnRecalcToMM(this.nfPrefWidth.getNumberValue())):this._changedProps.put_CellsWidth(null))},this)),this.nfPrefWidth=new Common.UI.MetricSpinner({el:$("#tableadv-number-prefwidth"),step:.1,width:115,defaultUnit:"cm",value:"10 cm",maxValue:55.88,minValue:0}),this.nfPrefWidth.on("change",_.bind(function(t,e,i,n){this._changedProps&&this._changedProps.put_CellsWidth(this.cmbPrefWidthUnit.getValue()?-t.getNumberValue():Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))},this)),this.cmbPrefWidthUnit=new Common.UI.ComboBox({el:$("#tableadv-combo-prefwidth-unit"),style:"width: 115px;",menuStyle:"min-width: 115px;",editable:!1,cls:"input-group-nr",data:[{value:0,displayValue:e==Common.Utils.Metric.c_MetricUnits.pt?this.txtPt:e==Common.Utils.Metric.c_MetricUnits.inch?this.txtInch:this.txtCm},{value:1,displayValue:this.txtPercent}],takeFocusOnClose:!0}),this.cmbPrefWidthUnit.on("selected",_.bind(function(t,e){if(this._changedProps){var i=e.value?"%":Common.Utils.Metric.getCurrentMetricName();if(this.nfPrefWidth.getUnitValue()!==i){var n=Common.Utils.Metric.fnRecalcFromMM(558);this.nfPrefWidth.setDefaultUnit(i),this.nfPrefWidth.setMaxValue(e.value?parseFloat((100*n/this.pageWidth).toFixed(2)):n),this.nfPrefWidth.setStep(e.value||Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1),this.nfPrefWidth.setValue(e.value?100*this.nfPrefWidth.getNumberValue()/this.pageWidth:this.pageWidth*this.nfPrefWidth.getNumberValue()/100),this._changedProps.put_CellsWidth(e.value?-this.nfPrefWidth.getNumberValue():Common.Utils.Metric.fnRecalcToMM(this.nfPrefWidth.getNumberValue()))}}
},this)),this.chWrapText=new Common.UI.CheckBox({el:$("#tableadv-checkbox-wrap"),value:!1,labelText:this.textWrapText}),this.chWrapText.on("change",_.bind(function(t,e,i,n){this._changedProps&&this._changedProps.put_CellsNoWrap("checked"!=t.getValue())},this)),this.btnWrapNone=new Common.UI.Button({parentEl:$("#tableadv-button-wrap-none"),cls:"btn-options huge-1",iconCls:"options__icon options__icon-huge table-align-center",posId:c_tableWrap.TABLE_WRAP_NONE,hint:this.textWrapNoneTooltip,enableToggle:!0,allowDepress:!1,toggleGroup:"advtablewrapGroup"}),this.btnWrapNone.on("click",_.bind(this.onBtnInlineWrapClick,this)),this.btnWrapParallel=new Common.UI.Button({parentEl:$("#tableadv-button-wrap-parallel"),cls:"btn-options huge-1",iconCls:"options__icon options__icon-huge table-flow",posId:c_tableWrap.TABLE_WRAP_PARALLEL,hint:this.textWrapParallelTooltip,enableToggle:!0,allowDepress:!1,toggleGroup:"advtablewrapGroup"}),this.btnWrapParallel.on("click",_.bind(this.onBtnFlowWrapClick,this)),this.btnAlignLeft=new Common.UI.Button({parentEl:$("#tableadv-button-align-left"),cls:"btn-options huge-1",iconCls:"options__icon options__icon-huge table-align-left",posId:c_tableAlign.TABLE_ALIGN_LEFT,hint:this.textLeftTooltip,enableToggle:!0,allowDepress:!1,toggleGroup:"advtablealignGroup"}),this.btnAlignLeft.on("click",_.bind(function(t){this._changedProps&&t.pressed&&(this._changedProps.put_TableAlignment(t.options.posId),this._changedProps.put_TableIndent(Common.Utils.Metric.fnRecalcToMM(this.spnIndentLeft.getNumberValue())),this.spnIndentLeft.setDisabled(!t.pressed),this._state.alignChanged=!0)},this)),this.btnAlignCenter=new Common.UI.Button({parentEl:$("#tableadv-button-align-center"),cls:"btn-options huge-1",iconCls:"options__icon options__icon-huge table-align-center",posId:c_tableAlign.TABLE_ALIGN_CENTER,hint:this.textCenterTooltip,enableToggle:!0,allowDepress:!1,toggleGroup:"advtablealignGroup"}),this.btnAlignCenter.on("click",_.bind(function(t){this._changedProps&&t.pressed&&(this._changedProps.put_TableAlignment(t.options.posId),this._changedProps.put_TableIndent(0),this.spnIndentLeft.setDisabled(t.pressed),this._state.alignChanged=!0)},this)),this.btnAlignRight=new Common.UI.Button({parentEl:$("#tableadv-button-align-right"),cls:"btn-options huge-1",iconCls:"options__icon options__icon-huge table-align-right",posId:c_tableAlign.TABLE_ALIGN_RIGHT,hint:this.textRightTooltip,enableToggle:!0,allowDepress:!1,toggleGroup:"advtablealignGroup"}),this.btnAlignRight.on("click",_.bind(function(t){this._changedProps&&t.pressed&&(this._changedProps.put_TableAlignment(t.options.posId),this._changedProps.put_TableIndent(0),this.spnIndentLeft.setDisabled(t.pressed),this._state.alignChanged=!0)},this)),this.spnIndentLeft=new Common.UI.MetricSpinner({el:$("#tableadv-number-indent"),step:.1,width:85,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:38.09,minValue:-38.09}),this.spnIndentLeft.on("change",_.bind(function(t,e,i,n){this._changedProps&&this._changedProps.put_TableIndent(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))},this)),this.spinners.push(this.spnIndentLeft),this.spnDistanceTop=new Common.UI.MetricSpinner({el:$("#tableadv-number-distance-top"),step:.1,width:85,defaultUnit:"cm",value:"1 cm",maxValue:55.87,minValue:0}),this.spnDistanceTop.on("change",_.bind(function(t,e,i,n){this._changedProps&&(void 0===this._changedProps.get_TablePaddings()&&this._changedProps.put_TablePaddings(new Asc.asc_CPaddings),this._changedProps.get_TablePaddings().put_Top(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},this)),this.spinners.push(this.spnDistanceTop),this.spnDistanceBottom=new Common.UI.MetricSpinner({el:$("#tableadv-number-distance-bottom"),step:.1,width:85,defaultUnit:"cm",value:"1 cm",maxValue:55.87,minValue:0}),this.spnDistanceBottom.on("change",_.bind(function(t,e,i,n){this._changedProps&&(void 0===this._changedProps.get_TablePaddings()&&this._changedProps.put_TablePaddings(new Asc.asc_CPaddings),this._changedProps.get_TablePaddings().put_Bottom(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},this)),this.spinners.push(this.spnDistanceBottom),this.spnDistanceLeft=new Common.UI.MetricSpinner({el:$("#tableadv-number-distance-left"),step:.1,width:85,defaultUnit:"cm",value:"1 cm",maxValue:9.34,minValue:0}),this.spnDistanceLeft.on("change",_.bind(function(t,e,i,n){this._changedProps&&(void 0===this._changedProps.get_TablePaddings()&&this._changedProps.put_TablePaddings(new Asc.asc_CPaddings),this._changedProps.get_TablePaddings().put_Left(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},this)),this.spinners.push(this.spnDistanceLeft),this.spnDistanceRight=new Common.UI.MetricSpinner({el:$("#tableadv-number-distance-right"),step:.1,width:85,defaultUnit:"cm",value:"0.19 cm",maxValue:9.34,minValue:0}),this.spnDistanceRight.on("change",_.bind(function(t,e,i,n){this._changedProps&&(void 0===this._changedProps.get_TablePaddings()&&this._changedProps.put_TablePaddings(new Asc.asc_CPaddings),this._changedProps.get_TablePaddings().put_Right(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},this)),this.spinners.push(this.spnDistanceRight),this.spnX=new Common.UI.MetricSpinner({el:$("#tableadv-spin-x"),step:.1,width:115,disabled:!0,defaultUnit:"cm",defaultValue:0,value:"1 cm",maxValue:55.87,minValue:-55.87}),this.spnX.on("change",_.bind(function(t,e,i,n){this._changedProps&&(null!==this._changedProps.get_PositionH()&&void 0!==this._changedProps.get_PositionH()||this._changedProps.put_PositionH(new Asc.CTablePositionH),this._changedProps.get_PositionH().put_UseAlign(!1),this._changedProps.get_PositionH().put_RelativeFrom(this._state.HPositionFrom),this._changedProps.get_PositionH().put_Value(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this._state.spnXChanged=!0)},this)),this.spinners.push(this.spnX),this.spnY=new Common.UI.MetricSpinner({el:$("#tableadv-spin-y"),step:.1,width:115,disabled:!0,defaultUnit:"cm",defaultValue:0,value:"1 cm",maxValue:55.87,minValue:-55.87}),this.spnY.on("change",_.bind(function(t,e,i,n){this._changedProps&&(null!==this._changedProps.get_PositionV()&&void 0!==this._changedProps.get_PositionV()||this._changedProps.put_PositionV(new Asc.CTablePositionV),this._changedProps.get_PositionV().put_UseAlign(!1),this._changedProps.get_PositionV().put_RelativeFrom(this._state.VPositionFrom),this._changedProps.get_PositionV().put_Value(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this._state.spnYChanged=!0)},this)),this.spinners.push(this.spnY),this._arrHAlign=[{displayValue:this.textLeft,value:Asc.c_oAscXAlign.Left},{displayValue:this.textCenter,value:Asc.c_oAscXAlign.Center},{displayValue:this.textRight,value:Asc.c_oAscXAlign.Right}],this.cmbHAlign=new Common.UI.ComboBox({el:$("#tableadv-combo-halign"),cls:"input-group-nr",menuStyle:"min-width: 115px;",editable:!1,data:this._arrHAlign,takeFocusOnClose:!0}),this.cmbHAlign.setValue(this._state.HAlignType),this.cmbHAlign.on("selected",_.bind(this.onHAlignSelect,this)),this._arrHRelative=[{displayValue:this.textMargin,value:Asc.c_oAscHAnchor.Margin},{displayValue:this.textPage,value:Asc.c_oAscHAnchor.Page},{displayValue:this.textAnchorText,value:Asc.c_oAscHAnchor.Text}],this.cmbHRelative=new Common.UI.ComboBox({el:$("#tableadv-combo-hrelative"),cls:"input-group-nr",menuStyle:"min-width: 115px;",editable:!1,data:this._arrHRelative,takeFocusOnClose:!0}),this.cmbHRelative.setValue(this._state.HAlignFrom),this.cmbHRelative.on("selected",_.bind(this.onHRelativeSelect,this)),this.cmbHPosition=new Common.UI.ComboBox({el:$("#tableadv-combo-hposition"),cls:"input-group-nr",menuStyle:"min-width: 115px;",editable:!1,data:this._arrHRelative,takeFocusOnClose:!0}),this.cmbHPosition.setDisabled(!0),this.cmbHPosition.setValue(this._state.HPositionFrom),this.cmbHPosition.on("selected",_.bind(this.onHPositionSelect,this)),this._arrVAlign=[{displayValue:this.textTop,value:Asc.c_oAscYAlign.Top},{displayValue:this.textCenter,value:Asc.c_oAscYAlign.Center},{displayValue:this.textBottom,value:Asc.c_oAscYAlign.Bottom}],this.cmbVAlign=new Common.UI.ComboBox({el:$("#tableadv-combo-valign"),cls:"input-group-nr",menuStyle:"min-width: 115px;",editable:!1,data:this._arrVAlign,takeFocusOnClose:!0}),this.cmbVAlign.setValue(this._state.VAlignType),this.cmbVAlign.on("selected",_.bind(this.onVAlignSelect,this)),this._arrVRelative=[{displayValue:this.textMargin,value:Asc.c_oAscVAnchor.Margin},{displayValue:this.textPage,value:Asc.c_oAscVAnchor.Page},{displayValue:this.textAnchorText,value:Asc.c_oAscVAnchor.Text}],this.cmbVRelative=new Common.UI.ComboBox({el:$("#tableadv-combo-vrelative"),cls:"input-group-nr",menuStyle:"min-width: 115px;",editable:!1,data:this._arrVRelative,takeFocusOnClose:!0}),this.cmbVRelative.setValue(this._state.VAlignFrom),this.cmbVRelative.on("selected",_.bind(this.onVRelativeSelect,this)),this.cmbVPosition=new Common.UI.ComboBox({el:$("#tableadv-combo-vposition"),cls:"input-group-nr",menuStyle:"min-width: 115px;",editable:!1,data:this._arrVRelative,takeFocusOnClose:!0}),this.cmbVPosition.setDisabled(!0),this.cmbVPosition.setValue(this._state.VPositionFrom),this.cmbVPosition.on("selected",_.bind(this.onVPositionSelect,this)),this.radioHAlign=new Common.UI.RadioBox({el:$("#tableadv-radio-halign"),name:"asc-radio-horizontal",checked:!0}),this.radioHAlign.on("change",_.bind(this.onRadioHAlignChange,this)),this.radioHPosition=new Common.UI.RadioBox({el:$("#tableadv-radio-hposition"),name:"asc-radio-horizontal"}),this.radioHPosition.on("change",_.bind(this.onRadioHPositionChange,this)),this.radioVAlign=new Common.UI.RadioBox({el:$("#tableadv-radio-valign"),name:"asc-radio-vertical",checked:!0}),this.radioVAlign.on("change",_.bind(this.onRadioVAlignChange,this)),this.radioVPosition=new Common.UI.RadioBox({el:$("#tableadv-radio-vposition"),name:"asc-radio-vertical"}),this.radioVPosition.on("change",_.bind(this.onRadioVPositionChange,this)),this.chMove=new Common.UI.CheckBox({el:$("#tableadv-checkbox-move"),labelText:this.textMove}),this.chMove.on("change",_.bind(function(t,e,i,n){if(this._changedProps){var o=this._arrVRelative["checked"==t.getValue()?2:1].value;if(this.cmbVRelative.isDisabled()){this.cmbVPosition.setValue(o);var s=this.cmbVPosition.getSelectedRecord();s&&this.onVPositionSelect(this.cmbVPosition,s)}else{this.cmbVRelative.setValue(o);var s=this.cmbVRelative.getSelectedRecord();s&&this.onVRelativeSelect(this.cmbVRelative,s)}}},this)),this.chOverlap=new Common.UI.CheckBox({el:$("#tableadv-checkbox-overlap"),labelText:this.textOverlap}),this.chOverlap.on("change",_.bind(function(t,e,i,n){this._changedProps&&this._changedProps.put_AllowOverlap("checked"==t.getValue())},this)),this.cmbBorderSize=new Common.UI.ComboBorderSize({el:$("#tableadv-combo-border-size"),style:"width: 93px;"});var n=this.cmbBorderSize.store.at(1);this.BorderSize={ptValue:n.get("value"),pxValue:n.get("pxValue")},this.cmbBorderSize.setValue(this.BorderSize.ptValue),this.cmbBorderSize.on("selected",_.bind(this.onBorderSizeSelect,this)),this.btnBorderColor=new Common.UI.ColorButton({parentEl:$("#tableadv-border-color-btn"),additionalAlign:this.menuAddAlign,color:"auto",auto:!0}),this.btnBorderColor.on("color:select",_.bind(t.onColorsBorderSelect,t)),this.btnBorderColor.on("auto:select",_.bind(t.onColorsBorderSelect,t)),this.colorsBorder=this.btnBorderColor.getPicker(),this.btnBackColor=new Common.UI.ColorButton({parentEl:$("#tableadv-button-back-color"),additionalAlign:this.menuAddAlign,transparent:!0}),this.btnBackColor.on("color:select",_.bind(this.onColorsBackSelect,this)),this.colorsBack=this.btnBackColor.getPicker(),this.btnTableBackColor=new Common.UI.ColorButton({parentEl:$("#tableadv-button-table-back-color"),additionalAlign:this.menuAddAlign,transparent:!0}),this.btnTableBackColor.on("color:select",_.bind(this.onColorsTableBackSelect,this)),this.colorsTableBack=this.btnTableBackColor.getPicker(),this.tableBordersImageSpacing=new Common.UI.TableStyler({el:$("#id-detablestyler-spacing"),width:200,height:200,rows:this.tableStylerRows,columns:this.tableStylerColumns,spacingMode:!0}),this.tableBordersImage=new Common.UI.TableStyler({el:$("#id-detablestyler"),width:200,height:200,rows:this.tableStylerRows,columns:this.tableStylerColumns,spacingMode:!1});var o=[["cm","btn-borders-large toolbar__icon toolbar__icon-big borders-inner-only","tableadv-button-border-inner",this.tipInner],["lrtb","btn-borders-large toolbar__icon toolbar__icon-big borders-outer-only","tableadv-button-border-outer",this.tipOuter],["lrtbcm","btn-borders-large toolbar__icon toolbar__icon-big borders-all","tableadv-button-border-all",this.tipAll],["","btn-borders-large toolbar__icon toolbar__icon-big borders-none","tableadv-button-border-none",this.tipNone]];this._btnsBorderPosition=[],_.each(o,function(t,e,i){var n=new Common.UI.Button({parentEl:$("#"+t[2]),style:"margin-left: 5px; margin-bottom: 4px;",cls:"btn-options large",iconCls:t[1],strId:t[0],hint:t[3]});n.on("click",_.bind(this._ApplyBorderPreset,this)),this._btnsBorderPosition.push(n)},this);var s=[["cm","","btn-borders-large toolbar__icon toolbar__icon-big borders-twin-none-inner","tableadv-button-border-inner-none",this.tipCellInner],["lrtb","","btn-borders-large toolbar__icon toolbar__icon-big borders-twin-none-outer","tableadv-button-border-outer-none",this.tipCellOuter],["lrtbcm","","btn-borders-large toolbar__icon toolbar__icon-big borders-twin-none-all","tableadv-button-border-all-none",this.tipCellAll],["","","btn-borders-large toolbar__icon toolbar__icon-big borders-twin-none","tableadv-button-border-none-none",this.tipNone],["lrtbcm","lrtb","btn-borders-large toolbar__icon toolbar__icon-big borders-twin-all","tableadv-button-border-all-table",this.tipTableOuterCellAll],["","lrtb","btn-borders-large toolbar__icon toolbar__icon-big borders-twin-outer-none","tableadv-button-border-none-table",this.tipOuter],["cm","lrtb","btn-borders-large toolbar__icon toolbar__icon-big borders-twin-outer-inner","tableadv-button-border-inner-table",this.tipTableOuterCellInner],["lrtb","lrtb","btn-borders-large toolbar__icon toolbar__icon-big borders-twin-outer-outer","tableadv-button-border-outer-table",this.tipTableOuterCellOuter]];this._btnsTableBorderPosition=[],_.each(s,function(t,e,i){var n=new Common.UI.Button({parentEl:$("#"+t[3]),style:"margin-left: 5px; margin-bottom: 4px;",cls:"btn-options large",iconCls:t[2],strCellId:t[0],strTableId:t[1],hint:t[4]});n.on("click",_.bind(this._ApplyBorderPreset,this)),this._btnsTableBorderPosition.push(n)},this),this.inputAltTitle=new Common.UI.InputField({el:$("#table-advanced-alt-title"),allowBlank:!0,validateOnBlur:!1,style:"width: 100%;"}).on("changed:after",function(){t.isAltTitleChanged=!0}),this.textareaAltDescription=this.$window.find("textarea"),this.textareaAltDescription.keydown(function(e){e.keyCode==Common.UI.Keys.RETURN&&e.stopPropagation(),t.isAltDescChanged=!0}),this.AlignContainer=$("#tableadv-panel-align"),this.DistanceContainer=$("#tableadv-panel-distance"),this.BordersContainer=$("#tableadv-panel-borders"),this.BordersSpacingContainer=$("#tableadv-panel-borders-spacing"),this.CellBackContainer=$("#tableadv-panel-cell-back"),this.TableBackContainer=$("#tableadv-panel-table-back"),this.afterRender()},getFocusedComponents:function(){return[this.chWidth,this.nfWidth,this.cmbUnit,this.chAutofit,this.spnTableMarginTop,this.spnTableMarginLeft,this.spnTableMarginBottom,this.spnTableMarginRight,this.chAllowSpacing,this.nfSpacing,this.chPrefWidth,this.nfPrefWidth,this.cmbPrefWidthUnit,this.chCellMargins,this.spnMarginTop,this.spnMarginLeft,this.spnMarginBottom,this.spnMarginRight,this.chWrapText,this.radioHAlign,this.cmbHAlign,this.radioHPosition,this.cmbHRelative,this.spnX,this.cmbHPosition,this.radioVAlign,this.cmbVAlign,this.radioVPosition,this.cmbVRelative,this.spnY,this.cmbVPosition,this.chMove,this.chOverlap,this.spnIndentLeft,this.spnDistanceTop,this.spnDistanceLeft,this.spnDistanceBottom,this.spnDistanceRight,this.inputAltTitle,this.textareaAltDescription]},onCategoryClick:function(t,e){Common.Views.AdvancedSettingsWindow.prototype.onCategoryClick.call(this,t,e);var i=this;setTimeout(function(){switch(e){case 0:i.nfWidth.isDisabled()?i.spnTableMarginTop.focus():i.nfWidth.focus();break;case 1:i.onCellCategoryClick(t),i.nfPrefWidth.isDisabled()?i.chPrefWidth.focus():i.nfPrefWidth.focus();break;case 3:i.cmbHAlign.isDisabled()?i.spnX.focus():i.cmbHAlign.focus();break;case 4:i.spnIndentLeft.isVisible()?i.spnIndentLeft.focus():i.spnDistanceTop.focus();break;case 5:i.inputAltTitle.focus()}},10)},afterRender:function(){if(this.updateMetricUnit(),this.updateThemeColors(),this._setDefaults(this._originalProps),void 0!==this.borderProps){this.btnBorderColor.setColor(this.borderProps.borderColor),this.btnBorderColor.setAutoColor("auto"==this.borderProps.borderColor);var t="object"==typeof this.btnBorderColor.color?this.btnBorderColor.color.color:this.btnBorderColor.color;this.tableBordersImageSpacing.setVirtualBorderColor(t),this.tableBordersImage.setVirtualBorderColor(t),"auto"==this.borderProps.borderColor?this.colorsBorder.clearSelection():this.colorsBorder.select(this.borderProps.borderColor,!0),this.cmbBorderSize.setValue(this.borderProps.borderSize.ptValue);var e=this.cmbBorderSize.getSelectedRecord();e&&this.onBorderSizeSelect(this.cmbBorderSize,e)}for(var i=0;i<this.tableBordersImageSpacing.rows;i++)for(var n=0;n<this.tableBordersImageSpacing.columns;n++)this.tableBordersImageSpacing.getCell(n,i).on("borderclick",function(t,e,i,n){void 0===this.ChangedCellBorders&&(this.ChangedCellBorders=new Asc.CBorders),this._UpdateCellBordersStyle(t,e,i,n,this.CellBorders,this.ChangedCellBorders)},this);for(this.tableBordersImageSpacing.on("borderclick",function(t,e,i,n){void 0===this.ChangedTableBorders&&(this.ChangedTableBorders=new Asc.CBorders),this._UpdateTableBordersStyle(t,e,i,n,this.TableBorders,this.ChangedTableBorders)},this),i=0;i<this.tableBordersImage.rows;i++)for(n=0;n<this.tableBordersImage.columns;n++)this.tableBordersImage.getCell(n,i).on("borderclick",function(t,e,i,n){this._allTable?void 0===this.ChangedTableBorders&&(this.ChangedTableBorders=new Asc.CBorders):void 0===this.ChangedCellBorders&&(this.ChangedCellBorders=new Asc.CBorders),this._UpdateCellBordersStyle(t,e,i,n,this._allTable?this.TableBorders:this.CellBorders,this._allTable?this.ChangedTableBorders:this.ChangedCellBorders)},this);this.tableBordersImage.on("borderclick",function(t,e,i,n){this._allTable?void 0===this.ChangedTableBorders&&(this.ChangedTableBorders=new Asc.CBorders):void 0===this.ChangedCellBorders&&(this.ChangedCellBorders=new Asc.CBorders),this._UpdateTableBordersStyle(t,e,i,n,this._allTable?this.TableBorders:this.CellBorders,this._allTable?this.ChangedTableBorders:this.ChangedCellBorders)},this);var o="object"==typeof this.CellColor.Color?this.CellColor.Color.color:this.CellColor.Color,s="object"==typeof this.TableColor.Color?this.TableColor.Color.color:this.TableColor.Color;if(this.tableBordersImageSpacing.setTableColor(s),this.tableBordersImage.setTableColor(s),this.tableBordersImageSpacing.setCellsColor(o),this.tableBordersImage.setCellsColor(this._allTable?s:o),this.storageName){var a=Common.localStorage.getItem(this.storageName);this.setActiveCategory(null!==a?parseInt(a):0)}},getSettings:function(){return this._cellBackground&&(this._allTable&&(null===this._changedProps.get_Spacing()||void 0===this._changedProps.get_Spacing()&&null===this._originalProps.get_Spacing())?this._changedProps.put_CellsBackground(null):this._changedProps.put_CellsBackground(this._cellBackground)),null===this.ChangedTableBorders?this._changedProps.put_TableBorders(this.TableBorders):void 0!==this.ChangedTableBorders&&this._changedProps.put_TableBorders(this.ChangedTableBorders),null===this.ChangedCellBorders?this._changedProps.put_CellBorders(this.CellBorders):void 0!==this.ChangedCellBorders&&this._changedProps.put_CellBorders(this.ChangedCellBorders),this.isAltTitleChanged&&this._changedProps.put_TableCaption(this.inputAltTitle.getValue()),this.isAltDescChanged&&this._changedProps.put_TableDescription(this.textareaAltDescription.val()),{tableProps:this._changedProps,borderProps:{borderSize:this.BorderSize,borderColor:this.btnBorderColor.isAutoColor()?"auto":this.btnBorderColor.color}}},_setDefaults:function(t){if(t){this._allTable=!t.get_CellSelect(),this.pageWidth=Common.Utils.Metric.fnRecalcFromMM(t.get_PercentFullWidth());var e,i=t.get_Width(),n=Common.Utils.Metric.getCurrentMetric();this.cmbUnit.store.at(0).set("displayValue",n==Common.Utils.Metric.c_MetricUnits.pt?this.txtPt:n==Common.Utils.Metric.c_MetricUnits.inch?this.txtInch:this.txtCm),this.cmbUnit.setValue(i<0?1:0),this.nfWidth.setDefaultUnit(i<0?"%":Common.Utils.Metric.getCurrentMetricName()),i<0&&this.nfWidth.setMaxValue(parseFloat((100*Common.Utils.Metric.fnRecalcFromMM(558)/this.pageWidth).toFixed(2))),this.nfWidth.setStep(i<0||Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1),null!==i&&this.nfWidth.setValue(i>0?Common.Utils.Metric.fnRecalcFromMM(i):-i,!0),this.chWidth.setValue(null!==i,!0),e="checked"!==this.chWidth.getValue(),this.nfWidth.setDisabled(e),this.cmbUnit.setDisabled(e);var o=t.get_Spacing();null!==o&&this.nfSpacing.setValue(Common.Utils.Metric.fnRecalcFromMM(o),!0),this.chAllowSpacing.setValue(null!==o,!0),this.nfSpacing.setDisabled("checked"!==this.chAllowSpacing.getValue());var s=t.get_TableLayout();this.chAutofit.setDisabled(void 0===s),this.chAutofit.setValue(s===Asc.c_oAscTableLayout.AutoFit,!0);var a=t.get_DefaultMargins();a&&(this.TableMargins={Left:null!==a.get_Left()?Common.Utils.Metric.fnRecalcFromMM(a.get_Left()):null,Right:null!==a.get_Right()?Common.Utils.Metric.fnRecalcFromMM(a.get_Right()):null,Top:null!==a.get_Top()?Common.Utils.Metric.fnRecalcFromMM(a.get_Top()):null,Bottom:null!==a.get_Bottom()?Common.Utils.Metric.fnRecalcFromMM(a.get_Bottom()):null}),a=t.get_CellMargins();var r=void 0;a&&(this.CellMargins={Left:null!==a.get_Left()?Common.Utils.Metric.fnRecalcFromMM(a.get_Left()):null,Right:null!==a.get_Right()?Common.Utils.Metric.fnRecalcFromMM(a.get_Right()):null,Top:null!==a.get_Top()?Common.Utils.Metric.fnRecalcFromMM(a.get_Top()):null,Bottom:null!==a.get_Bottom()?Common.Utils.Metric.fnRecalcFromMM(a.get_Bottom()):null},r=a.get_Flag(),this.CellMargins.Flag=1==r?"indeterminate":0==r?"checked":"unchecked",this.chCellMargins.setValue(this.CellMargins.Flag,!0)),0===r&&(null===this.CellMargins.Left&&(this.CellMargins.Left=this.TableMargins.Left),null===this.CellMargins.Top&&(this.CellMargins.Top=this.TableMargins.Top),null===this.CellMargins.Right&&(this.CellMargins.Right=this.TableMargins.Right),null===this.CellMargins.Bottom&&(this.CellMargins.Bottom=this.TableMargins.Bottom)),this.fillMargins(this.CellMargins.Flag);var l=t.get_CellsWidth();this.cmbPrefWidthUnit.store.at(0).set("displayValue",n==Common.Utils.Metric.c_MetricUnits.pt?this.txtPt:n==Common.Utils.Metric.c_MetricUnits.inch?this.txtInch:this.txtCm),this.cmbPrefWidthUnit.setValue(l<0?1:0),this.nfPrefWidth.setDefaultUnit(l<0?"%":Common.Utils.Metric.getCurrentMetricName()),l<0&&this.nfPrefWidth.setMaxValue(parseFloat((100*Common.Utils.Metric.fnRecalcFromMM(558)/this.pageWidth).toFixed(2))),this.nfPrefWidth.setStep(l<0||Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1),null!==l&&this.nfPrefWidth.setValue(l>0?Common.Utils.Metric.fnRecalcFromMM(l):-l,!0),this.chPrefWidth.setValue(t.get_CellsWidthNotEqual()?"indeterminate":null!==l,!0),e="checked"!==this.chPrefWidth.getValue(),this.nfPrefWidth.setDisabled(e),this.cmbPrefWidthUnit.setDisabled(e);var c=!t.get_CellsNoWrap();this.chWrapText.setValue(c,!0),this._TblWrapStyleChanged(t.get_TableWrap()),this.ShowHideWrap(t.get_TableWrap()===c_tableWrap.TABLE_WRAP_NONE),this.btnWrapParallel.setDisabled(!t.get_CanBeFlow());var d=t.get_TableAlignment();null!==d&&(this._TblAlignChanged(d),this.spnIndentLeft.setValue(d!==c_tableAlign.TABLE_ALIGN_LEFT?0:Common.Utils.Metric.fnRecalcFromMM(t.get_TableIndent()),!0),this.spnIndentLeft.setDisabled(d!==c_tableAlign.TABLE_ALIGN_LEFT)),this._state.alignChanged=!1;var h=t.get_TablePaddings();h&&(this.spnDistanceTop.setValue(Common.Utils.Metric.fnRecalcFromMM(h.get_Top()),!0),this.spnDistanceLeft.setValue(Common.Utils.Metric.fnRecalcFromMM(h.get_Left()),!0),this.spnDistanceBottom.setValue(Common.Utils.Metric.fnRecalcFromMM(h.get_Bottom()),!0),this.spnDistanceRight.setValue(Common.Utils.Metric.fnRecalcFromMM(h.get_Right()),!0));var p=t.get_PositionH();if(p){e=p.get_RelativeFrom();for(var m=0;m<this._arrHRelative.length;m++)if(e==this._arrHRelative[m].value){this.cmbHRelative.setValue(e),this.cmbHPosition.setValue(e),this._state.HPositionFrom=e,this._state.HAlignFrom=e;break}if(p.get_UseAlign()){e=p.get_Align();for(var m=0;m<this._arrHAlign.length;m++)if(e==this._arrHAlign[m].value){this.cmbHAlign.setValue(e),this._state.HAlignType=e;break}e=this._originalProps.get_Value_X(this._state.HPositionFrom),this.spnX.setValue(Common.Utils.Metric.fnRecalcFromMM(e))}else this.radioHPosition.setValue(!0),e=p.get_Value(),this.spnX.setValue(Common.Utils.Metric.fnRecalcFromMM(e))}else e=this._originalProps.get_Value_X(this._state.HPositionFrom),this.spnX.setValue(Common.Utils.Metric.fnRecalcFromMM(e));if(p=t.get_PositionV()){for(e=p.get_RelativeFrom(),m=0;m<this._arrVRelative.length;m++)if(e==this._arrVRelative[m].value){this.cmbVRelative.setValue(e),this.cmbVPosition.setValue(e),this._state.VAlignFrom=e,this._state.VPositionFrom=e;break}if(e==Asc.c_oAscVAnchor.Text&&this.chMove.setValue(!0,!0),p.get_UseAlign()){for(e=p.get_Align(),m=0;m<this._arrVAlign.length;m++)if(e==this._arrVAlign[m].value){this.cmbVAlign.setValue(e),this._state.VAlignType=e;break}e=t.get_Value_Y(this._state.VPositionFrom),this.spnY.setValue(Common.Utils.Metric.fnRecalcFromMM(e))}else this.radioVPosition.setValue(!0),e=p.get_Value(),this.spnY.setValue(Common.Utils.Metric.fnRecalcFromMM(e))}else e=t.get_Value_Y(this._state.VPositionFrom),this.spnY.setValue(Common.Utils.Metric.fnRecalcFromMM(e));this.chOverlap.setValue(null!==t.get_AllowOverlap()?t.get_AllowOverlap():"indeterminate",!0),this._state.verticalPropChanged=!1,this._state.horizontalPropChanged=!1,this.TableBorders=new Asc.CBorders(t.get_TableBorders()),this.CellBorders=new Asc.CBorders(t.get_CellBorders()),this._UpdateBordersNoSpacing_(),this._UpdateBordersSpacing_();var u=null===this.CellBorders.get_InsideV()&&null===this.CellBorders.get_InsideH();this._btnsBorderPosition[0].setDisabled(u&&!this._allTable),this._btnsTableBorderPosition[0].setDisabled(u&&!this._allTable),this._btnsTableBorderPosition[6].setDisabled(u&&!this._allTable);var g=t.get_TableBackground();if(g&&0==g.get_Value()){var b=g.get_Color();b?b.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.TableColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(b.get_r(),b.get_g(),b.get_b()),effectValue:b.get_value()}}:this.TableColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(b.get_r(),b.get_g(),b.get_b())}:this.TableColor={Value:1,Color:"transparent"}}else this.TableColor={Value:0,Color:"transparent"};if(g=t.get_CellsBackground())if(0==g.get_Value()){var b=g.get_Color();b?b.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.CellColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(b.get_r(),b.get_g(),b.get_b()),effectValue:b.get_value()}}:this.CellColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(b.get_r(),b.get_g(),b.get_b())}:this.CellColor={Value:1,Color:"transparent"}}else this.CellColor={Value:1,Color:"transparent"};else this.CellColor={Value:0,Color:"transparent"};if(this.btnBackColor.setColor(this.CellColor.Color),"object"==typeof this.CellColor.Color){for(var f=!1,m=0;m<10;m++)if(Common.Utils.ThemeColor.ThemeValues[m]==this.CellColor.Color.effectValue){this.colorsBack.select(this.CellColor.Color,!0),f=!0;break}f||this.colorsBack.clearSelection()}else this.colorsBack.select(this.CellColor.Color,!0);if(this.btnTableBackColor.setColor(this.TableColor.Color),"object"==typeof this.TableColor.Color){for(var f=!1,m=0;m<10;m++)if(Common.Utils.ThemeColor.ThemeValues[m]==this.TableColor.Color.effectValue){this.colorsTableBack.select(this.TableColor.Color,!0),f=!0;break}f||this.colorsTableBack.clearSelection()}else this.colorsTableBack.select(this.TableColor.Color,!0);this.ShowHideSpacing("checked"===this.chAllowSpacing.getValue()),e=t.get_TableCaption(),this.inputAltTitle.setValue(e||""),e=t.get_TableDescription(),this.textareaAltDescription.val(e||"")}this._changedProps=new Asc.CTableProp,this._changedProps.put_CellSelect(!this._allTable),this._cellBackground=null,this.ChangedTableBorders=void 0,this.ChangedCellBorders=void 0},fillMargins:function(t){this.spnMarginLeft.setValue(null!==this.CellMargins.Left?this.CellMargins.Left:"",!0),this.spnMarginTop.setValue(null!==this.CellMargins.Top?this.CellMargins.Top:"",!0),this.spnMarginRight.setValue(null!==this.CellMargins.Right?this.CellMargins.Right:"",!0),this.spnMarginBottom.setValue(null!==this.CellMargins.Bottom?this.CellMargins.Bottom:"",!0);var e="checked"==t;this.spnMarginTop.setDisabled(e),this.spnMarginBottom.setDisabled(e),this.spnMarginLeft.setDisabled(e),this.spnMarginRight.setDisabled(e),this.spnTableMarginLeft.setValue(null!==this.TableMargins.Left?this.TableMargins.Left:"",!0),this.spnTableMarginTop.setValue(null!==this.TableMargins.Top?this.TableMargins.Top:"",!0),this.spnTableMarginRight.setValue(null!==this.TableMargins.Right?this.TableMargins.Right:"",!0),this.spnTableMarginBottom.setValue(null!==this.TableMargins.Bottom?this.TableMargins.Bottom:"",!0)},_TblWrapStyleChanged:function(t){t==c_tableWrap.TABLE_WRAP_NONE?this.btnWrapNone.toggle(!0):this.btnWrapParallel.toggle(!0),this._state.fromWrapInline=t==c_tableWrap.TABLE_WRAP_NONE},_TblAlignChanged:function(t){t==c_tableAlign.TABLE_ALIGN_LEFT?this.btnAlignLeft.toggle(!0,!0):t==c_tableAlign.TABLE_ALIGN_CENTER?this.btnAlignCenter.toggle(!0,!0):this.btnAlignRight.toggle(!0,!0)},onBtnInlineWrapClick:function(t,e){this.ShowHideWrap(!0),this._changedProps&&t.pressed&&(this._state.alignChanged&&(this._state.HAlignType===Asc.c_oAscXAlign.Left?this.btnAlignLeft.toggle(!0):this._state.HAlignType==Asc.c_oAscXAlign.Center?this.btnAlignCenter.toggle(!0):this._state.HAlignType==Asc.c_oAscXAlign.Right&&this.btnAlignRight.toggle(!0),this._state.alignChanged=!1),this._changedProps.put_TableWrap(t.options.posId),this.btnAlignLeft.pressed?this._changedProps.put_TableAlignment(c_tableAlign.TABLE_ALIGN_LEFT):this.btnAlignCenter.pressed?this._changedProps.put_TableAlignment(c_tableAlign.TABLE_ALIGN_CENTER):this._changedProps.put_TableAlignment(c_tableAlign.TABLE_ALIGN_RIGHT),this.spnIndentLeft.setDisabled(!this.btnAlignLeft.pressed),this._changedProps.put_TableIndent(Common.Utils.Metric.fnRecalcToMM(this.spnIndentLeft.getNumberValue()))),!this.spnIndentLeft.isDisabled()&&this.spnIndentLeft.focus()},onBtnFlowWrapClick:function(t,e){this.ShowHideWrap(!1),this._changedProps&&t.pressed&&(this._changedProps.put_TableWrap(t.options.posId),this._changedProps.put_TableAlignment(null),this._changedProps.put_TableIndent(null),this._state.fromWrapInline&&!this._state.verticalPropChanged&&this.radioVPosition.setValue(!0),this._state.alignChanged?(this.btnAlignLeft.pressed?this._state.HAlignType=Asc.c_oAscXAlign.Left:this.btnAlignCenter.pressed?this._state.HAlignType=Asc.c_oAscXAlign.Center:this._state.HAlignType=Asc.c_oAscXAlign.Right,this.cmbHAlign.setValue(this._state.HAlignType),this.radioHAlign.setValue(!0),null!==this._changedProps.get_PositionH()&&void 0!==this._changedProps.get_PositionH()||this._changedProps.put_PositionH(new Asc.CTablePositionH),this._changedProps.get_PositionH().put_UseAlign(!0),this._changedProps.get_PositionH().put_Align(this._state.HAlignType),this._changedProps.get_PositionH().put_RelativeFrom(this._state.HAlignFrom),this._state.alignChanged=!1,
this._state.horizontalPropChanged=!0):this._state.fromWrapInline&&!this._state.horizontalPropChanged&&this.radioHPosition.setValue(!0)),this.spnDistanceTop.focus()},onHAlignSelect:function(t,e){this._changedProps&&(null!==this._changedProps.get_PositionH()&&void 0!==this._changedProps.get_PositionH()||this._changedProps.put_PositionH(new Asc.CTablePositionH),this._state.HAlignType=e.value,this._changedProps.get_PositionH().put_UseAlign(!0),this._changedProps.get_PositionH().put_RelativeFrom(this._state.HAlignFrom),this._changedProps.get_PositionH().put_Align(this._state.HAlignType),this._state.alignChanged=!0)},onHRelativeSelect:function(t,e){this._changedProps&&(null!==this._changedProps.get_PositionH()&&void 0!==this._changedProps.get_PositionH()||this._changedProps.put_PositionH(new Asc.CTablePositionH),this._state.HAlignFrom=e.value,this._changedProps.get_PositionH().put_UseAlign(!0),this._changedProps.get_PositionH().put_RelativeFrom(this._state.HAlignFrom),this._changedProps.get_PositionH().put_Align(this._state.HAlignType))},onHPositionSelect:function(t,e){if(this._changedProps){if(null!==this._changedProps.get_PositionH()&&void 0!==this._changedProps.get_PositionH()||this._changedProps.put_PositionH(new Asc.CTablePositionH),this._state.HPositionFrom=e.value,this._changedProps.get_PositionH().put_UseAlign(!1),this._changedProps.get_PositionH().put_RelativeFrom(this._state.HPositionFrom),!this._state.spnXChanged){var i=this._originalProps.get_Value_X(this._state.HPositionFrom);this.spnX.setValue(Common.Utils.Metric.fnRecalcFromMM(i),!0)}this._changedProps.get_PositionH().put_Value(Common.Utils.Metric.fnRecalcToMM(this.spnX.getNumberValue()))}},onVAlignSelect:function(t,e){this._changedProps&&(null!==this._changedProps.get_PositionV()&&void 0!==this._changedProps.get_PositionV()||this._changedProps.put_PositionV(new Asc.CTablePositionV),this._state.VAlignType=e.value,this._changedProps.get_PositionV().put_UseAlign(!0),this._changedProps.get_PositionV().put_RelativeFrom(this._state.VAlignFrom),this._changedProps.get_PositionV().put_Align(this._state.VAlignType))},onVRelativeSelect:function(t,e){this._changedProps&&(null!==this._changedProps.get_PositionV()&&void 0!==this._changedProps.get_PositionV()||this._changedProps.put_PositionV(new Asc.CTablePositionV),this._state.VAlignFrom=e.value,this._changedProps.get_PositionV().put_UseAlign(!0),this._changedProps.get_PositionV().put_RelativeFrom(this._state.VAlignFrom),this._changedProps.get_PositionV().put_Align(this._state.VAlignType),this.chMove.setValue(this._state.VAlignFrom==Asc.c_oAscVAnchor.Text,!0))},onVPositionSelect:function(t,e){if(this._changedProps){if(null!==this._changedProps.get_PositionV()&&void 0!==this._changedProps.get_PositionV()||this._changedProps.put_PositionV(new Asc.CTablePositionV),this._state.VPositionFrom=e.value,this._changedProps.get_PositionV().put_UseAlign(!1),this._changedProps.get_PositionV().put_RelativeFrom(this._state.VPositionFrom),!this._state.spnYChanged){var i=this._originalProps.get_Value_Y(this._state.VPositionFrom);this.spnY.setValue(Common.Utils.Metric.fnRecalcFromMM(i),!0)}this._changedProps.get_PositionV().put_Value(Common.Utils.Metric.fnRecalcToMM(this.spnY.getNumberValue())),this.chMove.setValue(this._state.VPositionFrom==Asc.c_oAscVAnchor.Text,!0)}},onRadioHAlignChange:function(t,e,i){this._changedProps&&(null!==this._changedProps.get_PositionH()&&void 0!==this._changedProps.get_PositionH()||this._changedProps.put_PositionH(new Asc.CTablePositionH),this._changedProps.get_PositionH().put_UseAlign(e),e&&(this._changedProps.get_PositionH().put_Align(this._state.HAlignType),this._changedProps.get_PositionH().put_RelativeFrom(this._state.HAlignFrom))),e&&(this.cmbHAlign.setDisabled(!1),this.cmbHAlign.focus(),this.cmbHRelative.setDisabled(!1),this.spnX.setDisabled(!0),this.cmbHPosition.setDisabled(!0),this._state.horizontalPropChanged=!0,this._state.alignChanged=!0)},onRadioHPositionChange:function(t,e,i){if(this._changedProps&&(null!==this._changedProps.get_PositionH()&&void 0!==this._changedProps.get_PositionH()||this._changedProps.put_PositionH(new Asc.CTablePositionH),this._changedProps.get_PositionH().put_UseAlign(!e),e)){if(!this._state.spnXChanged){var n=this._originalProps.get_Value_X(this._state.HPositionFrom);this.spnX.setValue(Common.Utils.Metric.fnRecalcFromMM(n))}this._changedProps.get_PositionH().put_Value(Common.Utils.Metric.fnRecalcToMM(this.spnX.getNumberValue())),this._changedProps.get_PositionH().put_RelativeFrom(this._state.HPositionFrom)}e&&(this.cmbHAlign.setDisabled(!0),this.cmbHRelative.setDisabled(!0),this.spnX.setDisabled(!1),this.spnX.focus(),this.cmbHPosition.setDisabled(!1),this._state.alignChanged=!1)},onRadioVAlignChange:function(t,e,i){this._changedProps&&(null!==this._changedProps.get_PositionV()&&void 0!==this._changedProps.get_PositionV()||this._changedProps.put_PositionV(new Asc.CTablePositionV),this._changedProps.get_PositionV().put_UseAlign(e),e&&(this._changedProps.get_PositionV().put_Align(this._state.VAlignType),this._changedProps.get_PositionV().put_RelativeFrom(this._state.VAlignFrom),this._state.verticalPropChanged=!0)),e&&(this.cmbVAlign.setDisabled(!1),this.cmbVAlign.focus(),this.cmbVRelative.setDisabled(!1),this.spnY.setDisabled(!0),this.cmbVPosition.setDisabled(!0),this.chMove.setValue(this._state.VAlignFrom==Asc.c_oAscVAnchor.Text,!0))},onRadioVPositionChange:function(t,e,i){if(this._changedProps&&(null!==this._changedProps.get_PositionV()&&void 0!==this._changedProps.get_PositionV()||this._changedProps.put_PositionV(new Asc.CTablePositionV),this._changedProps.get_PositionV().put_UseAlign(!e),e)){if(!this._state.spnYChanged){var n=this._originalProps.get_Value_Y(this._state.VPositionFrom);this.spnY.setValue(Common.Utils.Metric.fnRecalcFromMM(n))}this._changedProps.get_PositionV().put_Value(Common.Utils.Metric.fnRecalcToMM(this.spnY.getNumberValue())),this._changedProps.get_PositionV().put_RelativeFrom(this._state.VPositionFrom)}e&&(this.cmbVAlign.setDisabled(!0),this.cmbVRelative.setDisabled(!0),this.spnY.setDisabled(!1),this.spnY.focus(),this.cmbVPosition.setDisabled(!1),this.chMove.setValue(this._state.VPositionFrom==Asc.c_oAscVAnchor.Text,!0))},onBorderSizeSelect:function(t,e){this.BorderSize={ptValue:e.value,pxValue:e.pxValue},this.tableBordersImage.setVirtualBorderSize(this.BorderSize.pxValue),this.tableBordersImageSpacing.setVirtualBorderSize(this.BorderSize.pxValue)},onColorsBorderSelect:function(t,e){var i="object"==typeof e?e.color:e;this.tableBordersImage.setVirtualBorderColor(i),this.tableBordersImageSpacing.setVirtualBorderColor(i)},onColorsBackSelect:function(t,e){this.CellColor={Value:1,Color:e},null===this._cellBackground&&(this._cellBackground=new Asc.CBackground),"transparent"==this.CellColor.Color?(this._cellBackground.put_Value(1),this._cellBackground.put_Color(new Asc.asc_CColor(0,0,0))):(this._cellBackground.put_Value(0),this._cellBackground.put_Color(Common.Utils.ThemeColor.getRgbColor(this.CellColor.Color)));var i="object"==typeof e?e.color:e;this.tableBordersImageSpacing.setCellsColor(i),this._allTable||this.tableBordersImage.setCellsColor(i)},onColorsTableBackSelect:function(t,e){if(this.TableColor.Color=e,this._changedProps){var i=this._changedProps.get_TableBackground();void 0===i&&(i=new Asc.CBackground,this._changedProps.put_TableBackground(i)),"transparent"==this.TableColor.Color?(i.put_Value(1),i.put_Color(new Asc.asc_CColor(0,0,0))):(i.put_Value(0),i.put_Color(Common.Utils.ThemeColor.getRgbColor(this.TableColor.Color)))}var n="object"==typeof e?e.color:e;this.tableBordersImageSpacing.setTableColor(n),this.tableBordersImage.setTableColor(n),this._allTable&&this.tableBordersImage.setCellsColor(n)},_UpdateBordersSpacing_:function(){var t=this.TableBorders,e=this.BorderSize,i=this.btnBorderColor.color;this._UpdateTableBorderSpacing_(t.get_Left(),"l"),this._UpdateTableBorderSpacing_(t.get_Top(),"t"),this._UpdateTableBorderSpacing_(t.get_Right(),"r"),this._UpdateTableBorderSpacing_(t.get_Bottom(),"b"),t=this.CellBorders;for(var n=0;n<this.tableBordersImageSpacing.rows;n++)this._UpdateCellBorderSpacing_(t.get_Left(),"l",this.tableBordersImageSpacing.getCell(0,n));for(n=0;n<this.tableBordersImageSpacing.rows;n++)this._UpdateCellBorderSpacing_(t.get_Right(),"r",this.tableBordersImageSpacing.getCell(this.tableBordersImageSpacing.columns-1,n));for(n=0;n<this.tableBordersImageSpacing.columns;n++)this._UpdateCellBorderSpacing_(t.get_Top(),"t",this.tableBordersImageSpacing.getCell(n,0));for(n=0;n<this.tableBordersImageSpacing.columns;n++)this._UpdateCellBorderSpacing_(t.get_Bottom(),"b",this.tableBordersImageSpacing.getCell(n,this.tableBordersImageSpacing.rows-1));if(this._allTable&&null===t.get_InsideV()&&t.put_InsideV(new Asc.asc_CTextBorder),null!==t.get_InsideV())for(n=0;n<this.tableBordersImageSpacing.rows;n++)this._UpdateCellBorderSpacing_(t.get_InsideV(),"r",this.tableBordersImageSpacing.getCell(0,n)),this._UpdateCellBorderSpacing_(t.get_InsideV(),"l",this.tableBordersImageSpacing.getCell(1,n));if(this._allTable&&null===t.get_InsideH()&&t.put_InsideH(new Asc.asc_CTextBorder),null!==t.get_InsideH())for(n=0;n<this.tableBordersImageSpacing.columns;n++)this._UpdateCellBorderSpacing_(t.get_InsideH(),"b",this.tableBordersImageSpacing.getCell(n,0)),this._UpdateCellBorderSpacing_(t.get_InsideH(),"t",this.tableBordersImageSpacing.getCell(n,1));this.tableBordersImageSpacing.setVirtualBorderSize(e.pxValue),this.tableBordersImageSpacing.setVirtualBorderColor("object"==typeof i?i.color:i)},_UpdateCellBorderSpacing_:function(t,e,i){null!==t&&void 0!==t&&null!==t.get_Value()&&null!==t.get_Size()&&null!==t.get_Color()?1==t.get_Value()?(i.setBordersSize(e,this._BorderPt2Px(72*t.get_Size()/25.4)),i.setBordersColor(e,"rgb("+t.get_Color().get_r()+","+t.get_Color().get_g()+","+t.get_Color().get_b()+")")):i.setBordersSize(e,0):(i.setBordersSize(e,this.IndeterminateSize),i.setBordersColor(e,this.IndeterminateColor))},_UpdateTableBorderSpacing_:function(t,e){null!==t&&void 0!==t&&null!==t.get_Value()&&null!==t.get_Size()&&null!==t.get_Color()?1==t.get_Value()?(this.tableBordersImageSpacing.setBordersSize(e,this._BorderPt2Px(72*t.get_Size()/25.4)),this.tableBordersImageSpacing.setBordersColor(e,"rgb("+t.get_Color().get_r()+","+t.get_Color().get_g()+","+t.get_Color().get_b()+")")):this.tableBordersImageSpacing.setBordersSize(e,0):(this.tableBordersImageSpacing.setBordersSize(e,this.IndeterminateSize),this.tableBordersImageSpacing.setBordersColor(e,this.IndeterminateColor))},_UpdateBordersNoSpacing_:function(){var t=this._allTable?this.TableBorders:this.CellBorders,e=this.BorderSize,i=this.btnBorderColor.color;if(this._UpdateTableBorderNoSpacing_(t.get_Left(),"l"),this._UpdateTableBorderNoSpacing_(t.get_Top(),"t"),this._UpdateTableBorderNoSpacing_(t.get_Right(),"r"),this._UpdateTableBorderNoSpacing_(t.get_Bottom(),"b"),this._allTable&&null==t.get_InsideV()&&t.put_InsideV(new Asc.asc_CTextBorder),null!==t.get_InsideV())for(var n=0;n<this.tableBordersImage.rows;n++)this._UpdateCellBorderNoSpacing_(t.get_InsideV(),"r",this.tableBordersImage.getCell(0,n)),this._UpdateCellBorderNoSpacing_(t.get_InsideV(),"l",this.tableBordersImage.getCell(1,n));if(this._allTable&&null==t.get_InsideH()&&t.put_InsideH(new Asc.asc_CTextBorder),null!==t.get_InsideH())for(n=0;n<this.tableBordersImage.columns;n++)this._UpdateCellBorderNoSpacing_(t.get_InsideH(),"b",this.tableBordersImage.getCell(n,0)),this._UpdateCellBorderNoSpacing_(t.get_InsideH(),"t",this.tableBordersImage.getCell(n,1));this.tableBordersImage.setVirtualBorderSize(e.pxValue),this.tableBordersImage.setVirtualBorderColor("object"==typeof i?i.color:i)},_UpdateCellBorderNoSpacing_:function(t,e,i){null!==t&&void 0!==t&&null!==t.get_Value()&&null!==t.get_Size()&&null!==t.get_Color()?1==t.get_Value()?(i.setBordersSize(e,this._BorderPt2Px(72*t.get_Size()/25.4)),i.setBordersColor(e,"rgb("+t.get_Color().get_r()+","+t.get_Color().get_g()+","+t.get_Color().get_b()+")")):i.setBordersSize(e,0):(i.setBordersSize(e,this.IndeterminateSize),i.setBordersColor(e,this.IndeterminateColor))},_UpdateTableBorderNoSpacing_:function(t,e){null!==t&&void 0!==t&&null!==t.get_Value()&&null!==t.get_Size()&&null!==t.get_Color()?1==t.get_Value()?(this.tableBordersImage.setBordersSize(e,this._BorderPt2Px(72*t.get_Size()/25.4)),this.tableBordersImage.setBordersColor(e,"rgb("+t.get_Color().get_r()+","+t.get_Color().get_g()+","+t.get_Color().get_b()+")")):this.tableBordersImage.setBordersSize(e,0):(this.tableBordersImage.setBordersSize(e,this.IndeterminateSize),this.tableBordersImage.setBordersColor(e,this.IndeterminateColor))},_BorderPt2Px:function(t){return 0==t?0:t<.6?.5:t<=1?1:t<=1.5?2:t<=2.25?3:t<=3?4:t<=4.5?5:6},_ApplyBorderPreset:function(t){var e,i=void 0!==t.options.strId?t.options.strId:t.options.strCellId,n=t.options.strTableId;if(this._allTable&&void 0===n?(e=this.TableBorders,this.ChangedTableBorders=null):(e=this.CellBorders,this.ChangedCellBorders=null),this._UpdateBorderStyle(e.get_Left(),i.indexOf("l")>-1),this._UpdateBorderStyle(e.get_Top(),i.indexOf("t")>-1),this._UpdateBorderStyle(e.get_Right(),i.indexOf("r")>-1),this._UpdateBorderStyle(e.get_Bottom(),i.indexOf("b")>-1),this._UpdateBorderStyle(e.get_InsideV(),i.indexOf("c")>-1),this._UpdateBorderStyle(e.get_InsideH(),i.indexOf("m")>-1),void 0===n)return this._UpdateBordersNoSpacing_(),void(this._allTable&&(e=this.CellBorders,this.ChangedCellBorders=null,this._UpdateBorderStyle(e.get_Left(),i.indexOf("l")>-1),this._UpdateBorderStyle(e.get_Top(),i.indexOf("t")>-1),this._UpdateBorderStyle(e.get_Right(),i.indexOf("r")>-1),this._UpdateBorderStyle(e.get_Bottom(),i.indexOf("b")>-1),this._UpdateBorderStyle(e.get_InsideV(),i.indexOf("c")>-1),this._UpdateBorderStyle(e.get_InsideH(),i.indexOf("m")>-1)));e=this.TableBorders,this.ChangedTableBorders=null,this._UpdateBorderStyle(e.get_Left(),n.indexOf("l")>-1),this._UpdateBorderStyle(e.get_Top(),n.indexOf("t")>-1),this._UpdateBorderStyle(e.get_Right(),n.indexOf("r")>-1),this._UpdateBorderStyle(e.get_Bottom(),n.indexOf("b")>-1),this._UpdateBordersSpacing_()},_UpdateCellBordersStyle:function(t,e,i,n,o,s){var a=o;0==t.col&&e.indexOf("l")>-1&&(this._UpdateBorderStyle(a.get_Left(),i>0),s&&s.put_Left(new Asc.asc_CTextBorder(a.get_Left()))),t.col==this.tableStylerColumns-1&&e.indexOf("r")>-1&&(this._UpdateBorderStyle(a.get_Right(),i>0),s&&s.put_Right(new Asc.asc_CTextBorder(a.get_Right()))),0==t.row&&e.indexOf("t")>-1&&(this._UpdateBorderStyle(a.get_Top(),i>0),s&&s.put_Top(new Asc.asc_CTextBorder(a.get_Top()))),t.row==this.tableStylerRows-1&&e.indexOf("b")>-1&&(this._UpdateBorderStyle(a.get_Bottom(),i>0),s&&s.put_Bottom(new Asc.asc_CTextBorder(a.get_Bottom()))),(0==t.col&&e.indexOf("r")>-1||t.col==this.tableStylerColumns-1&&e.indexOf("l")>-1)&&(this._UpdateBorderStyle(a.get_InsideV(),i>0),s&&s.put_InsideV(new Asc.asc_CTextBorder(a.get_InsideV()))),(0==t.row&&e.indexOf("b")>-1||t.row==this.tableStylerRows-1&&e.indexOf("t")>-1)&&(this._UpdateBorderStyle(a.get_InsideH(),i>0),s&&s.put_InsideH(new Asc.asc_CTextBorder(a.get_InsideH())))},_UpdateTableBordersStyle:function(t,e,i,n,o,s){var a=o;e.indexOf("l")>-1&&(this._UpdateBorderStyle(a.get_Left(),i>0),s&&s.put_Left(new Asc.asc_CTextBorder(a.get_Left()))),e.indexOf("t")>-1&&(this._UpdateBorderStyle(a.get_Top(),i>0),s&&s.put_Top(new Asc.asc_CTextBorder(a.get_Top()))),e.indexOf("r")>-1&&(this._UpdateBorderStyle(a.get_Right(),i>0),s&&s.put_Right(new Asc.asc_CTextBorder(a.get_Right()))),e.indexOf("b")>-1&&(this._UpdateBorderStyle(a.get_Bottom(),i>0),s&&s.put_Bottom(new Asc.asc_CTextBorder(a.get_Bottom())))},_UpdateBorderStyle:function(t,e){if(null==t)return 0;if(e&&this.BorderSize.ptValue>0){var i=parseFloat(this.BorderSize.ptValue);t.put_Value(1),t.put_Size(25.4*i/72);var n;this.btnBorderColor.isAutoColor()?(n=new Asc.asc_CColor,n.put_auto(!0)):n=Common.Utils.ThemeColor.getRgbColor(this.btnBorderColor.color),t.put_Color(n)}else t.put_Color(new Asc.asc_CColor),t.put_Value(0);return t.get_Value()},onCellCategoryClick:function(t){"checked"==this.CellMargins.Flag&&this.TableMargins.isChanged&&(this.CellMargins.Left=this.TableMargins.Left,this.CellMargins.Top=this.TableMargins.Top,this.CellMargins.Right=this.TableMargins.Right,this.CellMargins.Bottom=this.TableMargins.Bottom,this.spnMarginRight.setValue(this.CellMargins.Right,!0),this.spnMarginLeft.setValue(this.CellMargins.Left,!0),this.spnMarginBottom.setValue(this.CellMargins.Bottom,!0),this.spnMarginTop.setValue(this.CellMargins.Top,!0)),this.TableMargins.isChanged=!1},updateMetricUnit:function(){if(this.spinners)for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}},updateThemeColors:function(){this.colorsBorder.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBack.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsTableBack.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors())},ShowHideWrap:function(t){this.AlignContainer.toggleClass("settings-hidden",!t),this.DistanceContainer.toggleClass("settings-hidden",t),this.btnsCategory[3].setDisabled(t)},ShowHideSpacing:function(t){this.BordersContainer.toggleClass("settings-hidden",t),this.BordersSpacingContainer.toggleClass("settings-hidden",!t),this.TableBackContainer.css("display",t||this._allTable?"inline-block":"none"),this.CellBackContainer.css("display",!t&&this._allTable?"none":"inline-block"),this.TableBackContainer.css("float",!t&&this._allTable?"none":"right"),t?this._UpdateBordersSpacing_():this._UpdateBordersNoSpacing_()},textWidth:"Width",textAllowSpacing:"Spacing between cells",textAlign:"Alignment",textIndLeft:"Indent from Left",textWidthSpaces:"Width & Spaces",textWrap:"Text Wrapping",textMargins:"Cell Margins",textTop:"Top",textLeft:"Left",textBottom:"Bottom",textRight:"Right",textDistance:"Distance From Text",textPosition:"Position",textWrapParallelTooltip:"Flow table",textWrapNoneTooltip:"Inline table",textLeftTooltip:"Left",textRightTooltip:"Right",textCenterTooltip:"Center",textTitle:"Table - Advanced Settings",textDefaultMargins:"Default Cell Margins",textCheckMargins:"Use default margins",textBordersBackgroung:"Borders & Background",textOnlyCells:"For selected cells only",textBorderWidth:"Border Size",textBorderColor:"Border Color",textBackColor:"Cell Background",textPreview:"Preview",textBorderDesc:"Click on diagramm or use buttons to select borders",textTableBackColor:"Table Background",txtNoBorders:"No borders",textCenter:"Center",textMargin:"Margin",textPage:"Page",textHorizontal:"Horizontal",textVertical:"Vertical",textAlignment:"Alignment",textRelative:"relative to",textRightOf:"to the right Of",textBelow:"below",textOverlap:"Allow overlap",textMove:"Move object with text",textOptions:"Options",textAnchorText:"Text",textAutofit:"Automatically resize to fit contents",textCellProps:"Cell",tipAll:"Set Outer Border and All Inner Lines",tipNone:"Set No Borders",tipInner:"Set Inner Lines Only",tipOuter:"Set Outer Border Only",tipCellAll:"Set Borders for Inner Cells Only",tipTableOuterCellAll:"Set Outer Border and Borders for All Inner Cells",tipCellInner:"Set Vertical and Horizontal Lines for Inner Cells Only",tipTableOuterCellInner:"Set Outer Border and Vertical and Horizontal Lines for Inner Cells",tipCellOuter:"Set Outer Borders for Inner Cells Only",tipTableOuterCellOuter:"Set Table Outer Border and Outer Borders for Inner Cells",txtPercent:"Percent",txtCm:"Centimeter",txtPt:"Point",txtInch:"Inch",textCellSize:"Cell Size",textPrefWidth:"Preferred width",textMeasure:"Measure in",textCellOptions:"Cell Options",textWrapText:"Wrap text",textTable:"Table",textTableSize:"Table Size",textTablePosition:"Table Position",textWrappingStyle:"Wrapping Style",textAlt:"Alternative Text",textAltTitle:"Title",textAltDescription:"Description",textAltTip:"The alternative text-based representation of the visual object information, which will be read to the people with vision or cognitive impairments to help them better understand what information there is in the image, autoshape, chart or table."},DE.Views.TableSettingsAdvanced||{}))}),define("text!documenteditor/main/app/template/ControlSettingsDialog.template",[],function(){return'<div id="id-adv-control-settings-general" class="settings-panel active">\n    <div class="inner-content">\n        <table cols="1" style="width: 100%;">\n            <tr>\n                <td class="padding-small">\n                    <label class="input-label"><%= scope.textName %></label>\n                    <div id="control-settings-txt-name"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <label class="input-label"><%= scope.textPlaceholder %></label>\n                    <div id="control-settings-txt-pholder"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-large">\n                    <label class="input-label"><%= scope.textTag %></label>\n                    <div id="control-settings-txt-tag"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-large">\n                    <div class="separator horizontal"></div>\n                </td>\n            </tr>\n        </table>\n        <table cols="2" style="width: auto;">\n            <tr>\n                <td class="padding-small" colspan="2">\n                    <label class="header"><%= scope.textAppearance %></label>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <label class="input-label" style="margin-right: 10px;"><%= scope.textShowAs %></label>\n                </td>\n                <td class="padding-small">\n                    <div id="control-settings-combo-show" class="input-group-nr" style="display: inline-block; width:120px;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <label class="input-label" style="margin-right: 10px;"><%= scope.textColor %></label>\n                </td>\n                <td class="padding-small">\n                    <div id="control-settings-color-btn" style="display: inline-block;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-large" colspan="2">\n                    <button type="button" class="btn btn-text-default auto" id="control-settings-btn-all" style="min-width: 98px;"><%= scope.textApplyAll %></button>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-adv-control-settings-lock" class="settings-panel active">\n    <div class="inner-content">\n        <table cols="1" style="width: 100%;">\n            <tr>\n                <td class="padding-small">\n                    <div id="control-settings-chb-lock-delete"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="control-settings-chb-lock-edit"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-adv-control-settings-list" class="settings-panel active">\n    <div class="inner-content">\n        <table cols="2" style="width: 100%;">\n            <tr>\n                <td>\n                    <label class="header" style="width: 99px;"><%= scope.textDisplayName %></label>\n                    <label class="header" style=""><%= scope.textValue %></label>\n                </td>\n                <td></td>\n            </tr>\n            <tr style="vertical-align: top;">\n                <td class="padding-small">\n                    <div id="control-settings-list" style="width:200px; height: 214px;margin-right: 10px;"></div>\n                </td>\n                <td class="padding-small">\n                    <button type="button" class="btn btn-text-default" id="control-settings-btn-add" style="min-width: 86px;margin-bottom: 5px;"><%= scope.textAdd %></button>\n                    <button type="button" class="btn btn-text-default" id="control-settings-btn-change" style="min-width: 86px;margin-bottom: 5px;"><%= scope.textChange %></button>\n                    <button type="button" class="btn btn-text-default" id="control-settings-btn-delete" style="min-width: 86px;margin-bottom: 5px;"><%= scope.textDelete %></button>\n                    <button type="button" class="btn btn-text-default" id="control-settings-btn-up" style="min-width: 86px;margin-bottom: 5px;"><%= scope.textUp %></button>\n                    <button type="button" class="btn btn-text-default" id="control-settings-btn-down" style="min-width: 86px;margin-bottom: 5px;"><%= scope.textDown %></button>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-adv-control-settings-date" class="settings-panel active">\n    <div class="inner-content">\n        <table cols="1" style="width: 100%;">\n            <tr>\n                <td>\n                    <label><%= scope.textFormat %></label>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="control-settings-txt-format" style="width: 100%;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="control-settings-format" style="width: 100%; height: 162px;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <label><%= scope.textLang %></label>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="control-settings-lang"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-adv-control-settings-checkbox" class="settings-panel">\n    <div class="inner-content">\n        <table cols="2" style="width: auto;">\n            <tr>\n                <td class="padding-small">\n                    <label class="input-label" style="margin-right: 10px;"><%= scope.textChecked %></label>\n                </td>\n                <td class="padding-small">\n                    <button type="button" class="btn btn-text-default" id="control-settings-btn-checked-edit" style="width:53px"></button>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <label class="input-label" style="margin-right: 10px;"><%= scope.textUnchecked %></label>\n                </td>\n                <td class="padding-small">\n                    <button type="button" class="btn btn-text-default" id="control-settings-btn-unchecked-edit" style="width:53px"></button>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-adv-control-settings-additional" class="settings-panel">\n    <div class="inner-content">\n        <table cols="1" style="width: 100%;">\n            <tr class="group-key">\n                <td class="padding-small">\n                    <label class="input-label"><%= scope.textGroupKey %></label>\n                    <div id="control-settings-txt-groupkey"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <label class="input-label"><%= scope.textKey %></label>\n                    <div id="control-settings-txt-key"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <label class="input-label"><%= scope.textLabel %></label>\n                    <div id="control-settings-txt-label"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-large">\n                    <label class="input-label"><%= scope.textHelp %></label>\n                    <textarea id="control-settings-txt-help" class="form-control" style="width: 100%; height: 90px;"></textarea>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-large">\n                    <div id="control-settings-chb-required"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-adv-control-settings-field" class="settings-panel">\n    <div class="inner-content">\n        <table cols="2" style="width: auto;">\n            <tr>\n                <td class="padding-small" colspan="2">\n                    <div id="control-settings-chb-max-chars" style="display: inline-block;margin-right: 10px;"></div>\n                    <div id="control-settings-spin-max-chars" style="display: inline-block;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small" colspan="2">\n                    <div id="control-settings-chb-comb"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <label class="input-label" style="margin-right: 10px;"><%= scope.textPlaceholderSymbol %></label>\n                </td>\n                <td class="padding-small">\n                    <button type="button" class="btn btn-text-default" id="control-settings-btn-placeholder-edit" style="width:53px"></button>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small" colspan="2">\n                    <label class="input-label" style="margin-right: 10px;"><%= scope.textWidth %></label>\n                    <div id="control-settings-spin-width" style=""></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n'}),function(t,e){function i(t,e,i,n,o){this.Start=t,this.End=e,this.Name=i,this.Lid=n,this.Param=o}function n(t,e){var i=0,n=e.length-1,o=0,s=null;if(i>=n)return null;for(;i<n;){var o=i+n>>1,s=e[o];if(s.Start>t)n=o-1;else{if(!(s.End<t))return e[o];i=o+1}}return i>n?null:(s=e[i],s.Start>t||s.End<t?null:e[i])}var o={Unknown:0,Basic_Latin:1,Latin_1_Supplement:2,Latin_Extended_A:3,Latin_Extended_B:4,IPA_Extensions:5,Spacing_Modifier_Letters:6,Combining_Diacritical_Marks:7,Greek_and_Coptic:8,Cyrillic:9,Cyrillic_Supplement:10,Armenian:11,Hebrew:12,Arabic:13,Syriac:14,Arabic_Supplement:15,Thaana:16,NKo:17,Samaritan:18,Mandaic:19,Arabic_Extended_A:20,Devanagari:21,Bengali:22,Gurmukhi:23,Gujarati:24,Oriya:25,Tamil:26,Telugu:27,Kannada:28,Malayalam:29,Sinhala:30,Thai:31,Lao:32,Tibetan:33,Myanmar:34,Georgian:35,Hangul_Jamo:36,Ethiopic:37,Ethiopic_Supplement:38,Cherokee:39,Unified_Canadian_Aboriginal_Syllabics:40,Ogham:41,Runic:42,Tagalog:43,Hanunoo:44,Buhid:45,Tagbanwa:46,Khmer:47,Mongolian:48,Unified_Canadian_Aboriginal_Syllabics_Extended:49,Limbu:50,Tai_Le:51,New_Tai_Lue:52,Khmer_Symbols:53,Buginese:54,Tai_Tham:55,Combining_Diacritical_Marks_Extended:56,Balinese:57,Sundanese:58,Batak:59,Lepcha:60,Ol_Chiki:61,Cyrillic_Extended_C:62,Sundanese_Supplement:63,Vedic_Extensions:64,Phonetic_Extensions:65,Phonetic_Extensions_Supplement:66,Combining_Diacritical_Marks_Supplement:67,Latin_Extended_Additional:68,Greek_Extended:69,General_Punctuation:70,Superscripts_and_Subscripts:71,Currency_Symbols:72,Combining_Diacritical_Marks_for_Symbols:73,Letterlike_Symbols:74,Number_Forms:75,Arrows:76,Mathematical_Operators:77,Miscellaneous_Technical:78,Control_Pictures:79,Optical_Character_Recognition:80,Enclosed_Alphanumerics:81,Box_Drawing:82,Block_Elements:83,Geometric_Shapes:84,Miscellaneous_Symbols:85,Dingbats:86,Miscellaneous_Mathematical_Symbols_A:87,Supplemental_Arrows_A:88,Braille_Patterns:89,Supplemental_Arrows_B:90,Miscellaneous_Mathematical_Symbols_B:91,
Supplemental_Mathematical_Operators:92,Miscellaneous_Symbols_and_Arrows:93,Glagolitic:94,Latin_Extended_C:95,Coptic:96,Georgian_Supplement:97,Tifinagh:98,Ethiopic_Extended:99,Cyrillic_Extended_A:100,Supplemental_Punctuation:101,CJK_Radicals_Supplement:102,Kangxi_Radicals:103,Ideographic_Description_Characters:104,CJK_Symbols_and_Punctuation:105,Hiragana:106,Katakana:107,Bopomofo:108,Hangul_Compatibility_Jamo:109,Kanbun:110,Bopomofo_Extended:111,CJK_Strokes:112,Katakana_Phonetic_Extensions:113,Enclosed_CJK_Letters_and_Months:114,CJK_Compatibility:115,CJK_Unified_Ideographs_Extension:116,Yijing_Hexagram_Symbols:117,CJK_Unified_Ideographs:118,Yi_Syllables:119,Yi_Radicals:120,Lisu:121,Vai:122,Cyrillic_Extended_B:123,Bamum:124,Modifier_Tone_Letters:125,Latin_Extended_D:126,Syloti_Nagri:127,Common_Indic_Number_Forms:128,Phags_pa:129,Saurashtra:130,Devanagari_Extended:131,Kayah_Li:132,Rejang:133,Hangul_Jamo_Extended_A:134,Javanese:135,Myanmar_Extended_B:136,Cham:137,Myanmar_Extended_A:138,Tai_Viet:139,Meetei_Mayek_Extensions:140,Ethiopic_Extended_A:141,Latin_Extended_E:142,Cherokee_Supplement:143,Meetei_Mayek:144,Hangul_Syllables:145,Hangul_Jamo_Extended_B:146,High_Surrogates:147,High_Private_Use_Surrogates:148,Low_Surrogates:149,Private_Use_Area:150,CJK_Compatibility_Ideographs:151,Alphabetic_Presentation_Forms:152,Arabic_Presentation_Forms_A:153,Variation_Selectors:154,Vertical_Forms:155,Combining_Half_Marks:156,CJK_Compatibility_Forms:157,Small_Form_Variants:158,Arabic_Presentation_Forms_B:159,Halfwidth_and_Fullwidth_Forms:160,Specials:161,Linear_B_Syllabary:162,Linear_B_Ideograms:163,Aegean_Numbers:164,Ancient_Greek_Numbers:165,Ancient_Symbols:166,Phaistos_Disc:167,Lycian:168,Carian:169,Coptic_Epact_Numbers:170,Old_Italic:171,Gothic:172,Old_Permic:173,Ugaritic:174,Old_Persian:175,Deseret:176,Shavian:177,Osmanya:178,Osage:179,Elbasan:180,Caucasian_Albanian:181,Linear_A:182,Cypriot_Syllabary:183,Imperial_Aramaic:184,Palmyrene:185,Nabataean:186,Hatran:187,Phoenician:188,Lydian:189,Meroitic_Hieroglyphs:190,Meroitic_Cursive:191,Kharoshthi:192,Old_South_Arabian:193,Old_North_Arabian:194,Manichaean:195,Avestan:196,Inscriptional_Parthian:197,Inscriptional_Pahlavi:198,Psalter_Pahlavi:199,Old_Turkic:200,Old_Hungarian:201,Rumi_Numeral_Symbols:202,Brahmi:203,Kaithi:204,Sora_Sompeng:205,Chakma:206,Mahajani:207,Sharada:208,Sinhala_Archaic_Numbers:209,Khojki:210,Multani:211,Khudawadi:212,Grantha:213,Newa:214,Tirhuta:215,Siddham:216,Modi:217,Mongolian_Supplement:218,Takri:219,Ahom:220,Warang_Citi:221,Pau_Cin_Hau:222,Bhaiksuki:223,Marchen:224,Cuneiform:225,Cuneiform_Numbers_and_Punctuation:226,Early_Dynastic_Cuneiform:227,Egyptian_Hieroglyphs:228,Anatolian_Hieroglyphs:229,Bamum_Supplement:230,Mro:231,Bassa_Vah:232,Pahawh_Hmong:233,Miao:234,Ideographic_Symbols_and_Punctuation:235,Tangut:236,Tangut_Components:237,Kana_Supplement:238,Duployan:239,Shorthand_Format_Controls:240,Byzantine_Musical_Symbols:241,Musical_Symbols:242,Ancient_Greek_Musical_Notation:243,Tai_Xuan_Jing_Symbols:244,Counting_Rod_Numerals:245,Mathematical_Alphanumeric_Symbols:246,Sutton_SignWriting:247,Glagolitic_Supplement:248,Mende_Kikakui:249,Adlam:250,Arabic_Mathematical_Alphabetic_Symbols:251,Mahjong_Tiles:252,Domino_Tiles:253,Playing_Cards:254,Enclosed_Alphanumeric_Supplement:255,Enclosed_Ideographic_Supplement:256,Miscellaneous_Symbols_and_Pictographs:257,Emoticons:258,Ornamental_Dingbats:259,Transport_and_Map_Symbols:260,Alchemical_Symbols:261,Geometric_Shapes_Extended:262,Supplemental_Arrows_C:263,Supplemental_Symbols_and_Pictographs:264,CJK_Unified_Ideographs_Extension_B:265,CJK_Unified_Ideographs_Extension_C:266,CJK_Unified_Ideographs_Extension_D:267,CJK_Unified_Ideographs_Extension_E:268,CJK_Compatibility_Ideographs_Supplement:269,Tags:270,Variation_Selectors_Supplement:271,Supplementary_Private_Use_Area_A:272,Supplementary_Private_Use_Area_B:273},s={Latin_1:0,Latin_2:1,Cyrillic:2,Greek:3,Turkish:4,Hebrew:5,Arabic:6,Windows_Baltic:7,Vietnamese:8,Thai:16,JIS_Japan:17,Chinese_Simplified:18,Korean_Wansung:19,Chinese_Traditional:20,Korean_Johab:21,Macintosh_Character_Set_US_Roman:29,OEM_Character_Set:30,Symbol_Character_Set:31},a={IBM_Greek:16,MS_DOS_Russian:17,MS_DOS_Nordic:18,Arabic:19,MS_DOS_Canadian_French:20,Hebrew:21,MS_DOS_Icelandic:22,MS_DOS_Portuguese:23,IBM_Turkish:24,IBM_Cyrillic:25,Latin_2:26,MS_DOS_Baltic:27,Greek_437:28,Arabic_708:29,WE_Latin_1:30,US:31},r={Basic_Latin:0,Latin_1_Supplement:1,Latin_Extended_A:2,Latin_Extended_B:3,IPA_Extensions:4,Spacing_Modifier_Letters:5,Combining_Diacritical_Marks:6,Greek_and_Coptic:7,Coptic:8,Cyrillic:9,Armenian:10,Hebrew:11,Vai:12,Arabic:13,NKo:14,Devanagari:15,Bengali:16,Gurmukhi:17,Gujarati:18,Oriya:19,Tamil:20,Telugu:21,Kannada:22,Malayalam:23,Thai:24,Lao:25,Georgian:26,Balinese:27,Hangul_Jamo:28,Latin_Extended_Additional:29,Greek_Extended:30,General_Punctuation:31},l={Superscripts_And_Subscripts:0,Currency_Symbols:1,Combining_Diacritical_Marks_For_Symbols:2,Letterlike_Symbols:3,Number_Forms:4,Arrows:5,Mathematical_Operators:6,Miscellaneous_Technical:7,Control_Pictures:8,Optical_Character_Recognition:9,Enclosed_Alphanumerics:10,Box_Drawing:11,Block_Elements:12,Geometric_Shapes:13,Miscellaneous_Symbols:14,Dingbats:15,CJK_Symbols_And_Punctuation:16,Hiragana:17,Katakana:18,Bopomofo:19,Hangul_Compatibility_Jamo:20,Phags_pa:21,Enclosed_CJK_Letters_And_Months:22,CJK_Compatibility:23,Hangul_Syllables:24,Non_Plane:25,Phoenician:26,CJK_Unified_Ideographs:27,Private_Use_Area_plane_0:28,CJK_Strokes:29,Alphabetic_Presentation_Forms:30,Arabic_Presentation_Forms_A:31},c={Combining_Half_Marks:0,Vertical_Forms:1,Small_Form_Variants:2,Arabic_Presentation_Forms_B:3,Halfwidth_And_Fullwidth_Forms:4,Specials:5,Tibetan:6,Syriac:7,Thaana:8,Sinhala:9,Myanmar:10,Ethiopic:11,Cherokee:12,Unified_Canadian_Aboriginal_Syllabics:13,Ogham:14,Runic:15,Khmer:16,Mongolian:17,Braille_Patterns:18,Yi_Syllables:19,Tagalog:20,Old_Italic:21,Gothic:22,Deseret:23,Byzantine_Musical_Symbols:24,Mathematical_Alphanumeric_Symbols:25,Private_Use_plane_15:26,Variation_Selectors:27,Tags:28,Limbu:29,Tai_Le:30,New_Tai_Lue:31},d={Buginese:0,Glagolitic:1,Tifinagh:2,Yijing_Hexagram_Symbols:3,Syloti_Nagri:4,Linear_B_Syllabary:5,Ancient_Greek_Numbers:6,Ugaritic:7,Old_Persian:8,Shavian:9,Osmanya:10,Cypriot_Syllabary:11,Kharoshthi:12,Tai_Xuan_Jing_Symbols:13,Cuneiform:14,Counting_Rod_Numerals:15,Sundanese:16,Lepcha:17,Ol_Chiki:18,Saurashtra:19,Kayah_Li:20,Rejang:21,Cham:22,Ancient_Symbols:23,Phaistos_Disc:24,Carian:25,Domino_Tiles:26},h=[new i(32,126,o.Basic_Latin,1033,[1<<r.Basic_Latin,0,0,0,1<<s.Latin_1,0]),new i(160,255,o.Latin_1_Supplement,0,[1<<r.Basic_Latin|1<<r.Latin_1_Supplement,0,0,0,1<<s.Latin_1,0]),new i(256,383,o.Latin_Extended_A,0,[1<<r.Basic_Latin|1<<r.Latin_Extended_A,0,0,0,1<<s.Latin_1|1<<s.Latin_2|1<<s.Turkish|1<<s.Windows_Baltic,0]),new i(384,591,o.Latin_Extended_B,0,[1<<r.Basic_Latin|1<<r.Latin_Extended_B,0,0,0,1<<s.Latin_1|1<<s.Latin_2|1<<s.Turkish|1<<s.Windows_Baltic,0]),new i(592,687,o.IPA_Extensions,0,[1<<r.IPA_Extensions,0,0,0,0,0]),new i(688,767,o.Spacing_Modifier_Letters,0,[1<<r.Spacing_Modifier_Letters,0,0,0,0,0]),new i(768,879,o.Combining_Diacritical_Marks,0,[1<<r.Combining_Diacritical_Marks,0,0,0,0,0]),new i(880,1023,o.Greek_and_Coptic,1032,[1<<r.Greek_and_Coptic,0,0,0,1<<s.Greek,0]),new i(1024,1279,o.Cyrillic,1049,[1<<r.Cyrillic,0,0,0,1<<s.Cyrillic,0]),new i(1280,1327,o.Cyrillic_Supplement,0,[1<<r.Cyrillic,0,0,0,1<<s.Cyrillic,0]),new i(1328,1423,o.Armenian,1067,[1<<r.Armenian,0,0,0,0,0]),new i(1424,1535,o.Hebrew,1037,[1<<r.Hebrew,0,0,0,1<<s.Hebrew,1<<a.Hebrew]),new i(1536,1791,o.Arabic,1,[1<<r.Arabic,0,0,0,1<<s.Arabic,1<<a.Arabic|1<<a.Arabic_708]),new i(1792,1871,o.Syriac,1114,[1<<r.Arabic,0,0,0,1<<s.Arabic,1<<a.Arabic|1<<a.Arabic_708]),new i(1872,1919,o.Arabic_Supplement,1,[1<<r.Arabic,0,0,0,1<<s.Arabic,1<<a.Arabic|1<<a.Arabic_708]),new i(1920,1983,o.Thaana,1125,[1<<r.Arabic,0,0,0,1<<s.Arabic,1<<a.Arabic|1<<a.Arabic_708]),new i(1984,2047,o.NKo,0,[1<<r.NKo,0,0,0,0,0]),new i(2048,2111,o.Samaritan,0,[1<<r.Hebrew,0,0,0,1<<s.Hebrew,0]),new i(2112,2143,o.Mandaic,0,[1<<r.Arabic,0,0,0,1<<s.Arabic,1<<a.Arabic|1<<a.Arabic_708]),new i(2208,2303,o.Arabic_Extended_A,1,[1<<r.Arabic,0,0,0,1<<s.Arabic,1<<a.Arabic|1<<a.Arabic_708]),new i(2304,2431,o.Devanagari,1081,[1<<r.Devanagari,0,0,0,0,0]),new i(2432,2559,o.Bengali,1093,[1<<r.Bengali,0,0,0,0,0]),new i(2560,2687,o.Gurmukhi,1094,[1<<r.Gurmukhi,0,0,0,0,0]),new i(2688,2815,o.Gujarati,1095,[1<<r.Gujarati,0,0,0,0,0]),new i(2816,2943,o.Oriya,1096,[1<<r.Oriya,0,0,0,0,0]),new i(2944,3071,o.Tamil,1097,[1<<r.Tamil,0,0,0,0,0]),new i(3072,3199,o.Telugu,1098,[1<<r.Telugu,0,0,0,0,0]),new i(3200,3327,o.Kannada,1099,[1<<r.Kannada,0,0,0,0,0]),new i(3328,3455,o.Malayalam,1100,[1<<r.Malayalam,0,0,0,0,0]),new i(3456,3583,o.Sinhala,1115,[0,0,1<<c.Sinhala,0,0,0]),new i(3584,3711,o.Thai,1054,[1<<r.Thai,0,0,0,1<<s.Thai,0]),new i(3712,3839,o.Lao,1108,[1<<r.Lao,0,0,0,0,0]),new i(3840,4095,o.Tibetan,2129,[0,0,1<<c.Tibetan,0,0,0]),new i(4096,4255,o.Myanmar,1109,[0,0,1<<c.Myanmar,0,0,0]),new i(4256,4351,o.Georgian,1079,[1<<r.Georgian,0,0,0,0,0]),new i(4352,4607,o.Hangul_Jamo,1042,[1<<r.Hangul_Jamo,0,0,0,1<<s.Korean_Wansung,0]),new i(4608,4991,o.Ethiopic,1138,[0,0,1<<c.Ethiopic,0,0,0]),new i(4992,5023,o.Ethiopic_Supplement,0,[0,0,1<<c.Ethiopic,0,0,0]),new i(5024,5119,o.Cherokee,1116,[0,0,1<<c.Cherokee,0,0,0]),new i(5120,5759,o.Unified_Canadian_Aboriginal_Syllabics,1117,[0,0,1<<c.Unified_Canadian_Aboriginal_Syllabics,0,0,0]),new i(5760,5791,o.Ogham,0,[0,0,1<<c.Ogham,0,0,0]),new i(5792,5887,o.Runic,0,[0,0,1<<c.Runic,0,0,0]),new i(5888,5919,o.Tagalog,1124,[0,0,1<<c.Tagalog,0,0,0]),new i(5920,5951,o.Hanunoo,1124,[0,0,1<<c.Tagalog,0,0,0]),new i(5952,5983,o.Buhid,1124,[0,0,1<<c.Tagalog,0,0,0]),new i(5984,6015,o.Tagbanwa,1124,[0,0,1<<c.Tagalog,0,0,0]),new i(6016,6143,o.Khmer,1107,[0,0,1<<c.Khmer,0,0,0]),new i(6144,6319,o.Mongolian,1104,[0,0,1<<c.Mongolian,0,0,0]),new i(6320,6399,o.Unified_Canadian_Aboriginal_Syllabics_Extended,1117,[0,0,1<<c.Unified_Canadian_Aboriginal_Syllabics,0,0,0]),new i(6400,6479,o.Limbu,0,[0,0,1<<c.Limbu,0,0,0]),new i(6480,6527,o.Tai_Le,0,[0,0,1<<c.Tai_Le,0,0,0]),new i(6528,6623,o.New_Tai_Lue,0,[0,0,1<<c.New_Tai_Lue,0,0,0]),new i(6624,6655,o.Khmer_Symbols,1107,[0,0,1<<c.Khmer,0,0,0]),new i(6656,6687,o.Buginese,0,[0,0,1<<c.Buginese,0,0,0]),new i(6688,6831,o.Tai_Tham,1054,[0,0,1<<c.Tai_Le,0,0,0]),new i(6832,6911,o.Combining_Diacritical_Marks_Extended,0,[1<<r.Combining_Diacritical_Marks,0,0,0,0,0]),new i(6912,7039,o.Balinese,1057,[1<<r.Balinese,0,0,0,0,0]),new i(7040,7103,o.Sundanese,1057,[0,0,0,1<<d.Sundanese,0,0]),new i(7104,7167,o.Batak,1057,[]),new i(7168,7247,o.Lepcha,0,[0,0,0,1<<d.Lepcha,0,0]),new i(7248,7295,o.Ol_Chiki,0,[0,0,0,1<<d.Ol_Chiki,0,0]),new i(7296,7311,o.Cyrillic_Extended_C,0,[1<<r.Cyrillic,0,0,0,0,0]),new i(7360,7375,o.Sundanese_Supplement,0,[0,0,0,1<<d.Sundanese,0,0]),new i(7376,7423,o.Vedic_Extensions,0,[]),new i(7424,7551,o.Phonetic_Extensions,0,[1<<r.IPA_Extensions,0,0,0,0,0]),new i(7552,7615,o.Phonetic_Extensions_Supplement,0,[1<<r.IPA_Extensions,0,0,0,0,0]),new i(7616,7679,o.Combining_Diacritical_Marks_Supplement,0,[1<<r.Combining_Diacritical_Marks,0,0,0,0,0]),new i(7680,7935,o.Latin_Extended_Additional,0,[1<<r.Latin_Extended_Additional,0,0,0,1<<s.Vietnamese,0]),new i(7936,8191,o.Greek_Extended,0,[1<<r.Greek_Extended,0,0,0,0,0]),new i(8192,8303,o.General_Punctuation,0,[1<<r.Punctuation,0,0,0,0,0]),new i(8304,8351,o.Superscripts_and_Subscripts,0,[0,1<<l.Superscripts_And_Subscripts,0,0,0,0]),new i(8352,8399,o.Currency_Symbols,0,[0,1<<l.Currency_Symbols,0,0,0,0]),new i(8400,8447,o.Combining_Diacritical_Marks_for_Symbols,0,[0,1<<l.Combining_Diacritical_Marks_For_Symbols,0,0,0,0]),new i(8448,8527,o.Letterlike_Symbols,0,[0,1<<l.Letterlike_Symbols,0,0,0,0]),new i(8528,8591,o.Number_Forms,0,[0,1<<l.Number_Forms,0,0,0,0]),new i(8592,8703,o.Arrows,0,[0,1<<l.Arrows,0,0,0,0]),new i(8704,8959,o.Mathematical_Operators,0,[0,1<<l.Mathematical_Operators,0,0,0,0]),new i(8960,9215,o.Miscellaneous_Technical,0,[0,1<<l.Miscellaneous_Technical,0,0,0,0]),new i(9216,9279,o.Control_Pictures,0,[0,1<<l.Control_Pictures,0,0,0,0]),new i(9280,9311,o.Optical_Character_Recognition,0,[0,1<<l.Optical_Character_Recognition,0,0,0,0]),new i(9312,9471,o.Enclosed_Alphanumerics,0,[0,1<<l.Enclosed_Alphanumerics,0,0,0,0]),new i(9472,9599,o.Box_Drawing,0,[0,1<<l.Box_Drawing,0,0,0,0]),new i(9600,9631,o.Block_Elements,0,[0,1<<l.Block_Elements,0,0,0,0]),new i(9632,9727,o.Geometric_Shapes,0,[0,1<<l.Geometric_Shapes,0,0,0,0]),new i(9728,9983,o.Miscellaneous_Symbols,0,[0,1<<l.Miscellaneous_Symbols,0,0,0,0]),new i(9984,10175,o.Dingbats,0,[0,1<<l.Dingbats,0,0,0,0]),new i(10176,10223,o.Miscellaneous_Mathematical_Symbols_A,0,[0,1<<l.Mathematical_Operators,0,0,0,0]),new i(10224,10239,o.Supplemental_Arrows_A,0,[0,1<<l.Arrows,0,0,0,0]),new i(10240,10495,o.Braille_Patterns,0,[0,0,1<<c.Braille_Patterns,0,0,0]),new i(10496,10623,o.Supplemental_Arrows_B,0,[0,1<<l.Arrows,0,0,0,0]),new i(10624,10751,o.Miscellaneous_Mathematical_Symbols_B,0,[0,1<<l.Mathematical_Operators,0,0,0,0]),new i(10752,11007,o.Supplemental_Mathematical_Operators,0,[0,1<<l.Mathematical_Operators,0,0,0,0]),new i(11008,11263,o.Miscellaneous_Symbols_and_Arrows,0,[0,1<<l.Arrows,0,0,0,0]),new i(11264,11359,o.Glagolitic,0,[0,0,0,1<<l.Glagolitic,0,0]),new i(11360,11391,o.Latin_Extended_C,0,[1<<r.Latin_Extended_Additional,0,0,0,0,0]),new i(11392,11519,o.Coptic,0,[1<<r.Coptic,0,0,0,0,0]),new i(11520,11567,o.Georgian_Supplement,0,[1<<r.Georgian,0,0,0,0,0]),new i(11568,11647,o.Tifinagh,0,[0,0,0,1<<d.Tifinagh,0,0]),new i(11648,11743,o.Ethiopic_Extended,0,[0,0,1<<c.Ethiopic,0,0,0]),new i(11744,11775,o.Cyrillic_Extended_A,0,[1<<r.Cyrillic,0,0,0,1<<s.Cyrillic,0]),new i(11776,11903,o.Supplemental_Punctuation,0,[1<<r.General_Punctuation,0,0,0,0,0]),new i(11904,12031,o.CJK_Radicals_Supplement,0,[0,1<<l.CJK_Unified_Ideographs,0,0,0,0]),new i(12032,12255,o.Kangxi_Radicals,0,[0,1<<l.CJK_Unified_Ideographs,0,0,0,0]),new i(12272,12287,o.Ideographic_Description_Characters,0,[0,1<<l.CJK_Unified_Ideographs,0,0,0,0]),new i(12288,12351,o.CJK_Symbols_and_Punctuation,0,[0,1<<l.CJK_Symbols_And_Punctuation,0,0,1<<s.JIS_Japan|1<<s.OEM_Character_Set,0]),new i(12352,12447,o.Hiragana,1041,[0,1<<l.Hiragana,0,0,0,0]),new i(12448,12543,o.Katakana,1041,[0,1<<l.Katakana,0,0,0,0]),new i(12544,12591,o.Bopomofo,0,[0,1<<l.Bopomofo,0,0,0,0]),new i(12592,12687,o.Hangul_Compatibility_Jamo,0,[0,1<<l.Hangul_Compatibility_Jamo,0,0,1<<s.Korean_Wansung,0]),new i(12688,12703,o.Kanbun,2052,[0,1<<l.CJK_Unified_Ideographs,0,0,0,0]),new i(12704,12735,o.Bopomofo_Extended,0,[0,1<<l.Bopomofo,0,0,0,0]),new i(12736,12783,o.CJK_Strokes,0,[0,1<<l.CJK_Strokes,0,0,0,0]),new i(12784,12799,o.Katakana_Phonetic_Extensions,0,[0,1<<l.Katakana,0,0,0,0]),new i(12800,13055,o.Enclosed_CJK_Letters_and_Months,0,[0,1<<l.Enclosed_CJK_Letters_And_Months,0,0,0,0]),new i(13056,13311,o.CJK_Compatibility,0,[0,1<<l.CJK_Compatibility,0,0,0,0]),new i(13312,19903,o.CJK_Unified_Ideographs_Extension,0,[0,1<<l.CJK_Unified_Ideographs,0,0,1<<s.Chinese_Simplified|1<<s.Chinese_Traditional,0]),new i(19904,19967,o.Yijing_Hexagram_Symbols,0,[0,0,0,1<<d.Yijing_Hexagram_Symbols,1<<s.Chinese_Simplified|1<<s.Chinese_Traditional,0]),new i(19968,40959,o.CJK_Unified_Ideographs,0,[0,1<<l.CJK_Unified_Ideographs,0,0,1<<s.Chinese_Simplified|1<<s.Chinese_Traditional|1<<s.JIS_Japan|1<<s.OEM_Character_Set,0]),new i(40960,42127,o.Yi_Syllables,0,[0,0,1<<c.Yi_Syllables,0,0,0]),new i(42128,42191,o.Yi_Radicals,0,[0,0,1<<c.Yi_Radicals,0,0,0]),new i(42192,42239,o.Lisu,0,[]),new i(42240,42559,o.Vai,0,[1<<r.Vai,0,0,0,0,0]),new i(42560,42655,o.Cyrillic_Extended_B,0,[1<<r.Cyrillic,0,0,0,1<<s.Cyrillic,0]),new i(42656,42751,o.Bamum,0,[]),new i(42752,42783,o.Modifier_Tone_Letters,0,[1<<r.Spacing_Modifier_Letters,0,0,0,0,0]),new i(42784,43007,o.Latin_Extended_D,0,[1<<r.Latin_Extended_Additional,0,0,0,0,0]),new i(43008,43055,o.Syloti_Nagri,0,[0,0,0,1<<d.Syloti_Nagri,0,0]),new i(43056,43071,o.Common_Indic_Number_Forms,0,[]),new i(43072,43135,o.Phags_pa,0,[0,1<<l.Phags_pa,0,0,0,0]),new i(43136,43231,o.Saurashtra,0,[0,0,0,1<<d.Saurashtra,0,0]),new i(43232,43263,o.Devanagari_Extended,0,[1<<r.Devanagari,0,0,0,0,0]),new i(43264,43311,o.Kayah_Li,0,[0,0,0,1<<d.Kayah_Li,0,0]),new i(43312,43359,o.Rejang,0,[0,0,0,1<<d.Rejang,0,0]),new i(43360,43391,o.Hangul_Jamo_Extended_A,0,[1<<r.Hangul_Jamo,0,0,0,0,0]),new i(43392,43487,o.Javanese,1057,[]),new i(43488,43519,o.Myanmar_Extended_B,0,[0,0,1<<c.Myanmar,0,0,0]),new i(43520,43615,o.Cham,0,[0,0,0,1<<d.Cham,0,0]),new i(43616,43647,o.Myanmar_Extended_A,0,[0,0,1<<c.Myanmar,0,0,0]),new i(43648,43743,o.Tai_Viet,0,[]),new i(43744,43775,o.Meetei_Mayek_Extensions,0,[]),new i(43776,43823,o.Ethiopic_Extended_A,0,[]),new i(43824,43887,o.Latin_Extended_E,0,[1<<r.Latin_Extended_Additional,0,0,0,0,0]),new i(43888,43967,o.Cherokee_Supplement,0,[]),new i(43968,44031,o.Meetei_Mayek,0,[]),new i(44032,55215,o.Hangul_Syllables,0,[0,1<<l.Hangul_Syllables,0,0,1<<s.Korean_Wansung,0]),new i(55216,55295,o.Hangul_Jamo_Extended_B,0,[1<<r.Hangul_Jamo,0,0,0,0,0]),new i(55296,56191,o.High_Surrogates,0,[]),new i(56192,56319,o.High_Private_Use_Surrogates,0,[]),new i(56320,57343,o.Low_Surrogates,0,[]),new i(57344,63743,o.Private_Use_Area,0,[0,1<<l.Private_Use_Area_plane_0,0,0,0,0]),new i(63744,64255,o.CJK_Compatibility_Ideographs,0,[0,1<<l.CJK_Compatibility_Ideographs,0,0,1<<s.Chinese_Simplified|1<<s.Chinese_Traditional,0]),new i(64256,64335,o.Alphabetic_Presentation_Forms,0,[0,1<<l.Alphabetic_Presentation_Forms,0,0,0,0]),new i(64336,65023,o.Arabic_Presentation_Forms_A,0,[0,1<<l.Arabic_Presentation_Forms_A,0,0,1<<s.Arabic,1<<a.Arabic|1<<a.Arabic_708]),new i(65024,65039,o.Variation_Selectors,0,[0,0,1<<c.Variation_Selectors,0,0,0]),new i(65040,65055,o.Vertical_Forms,0,[0,0,1<<c.Vertical_Forms,0,0,0]),new i(65056,65071,o.Combining_Half_Marks,0,[0,0,1<<c.Combining_Half_Marks,0,0,0]),new i(65072,65103,o.CJK_Compatibility_Forms,0,[0,0,1<<c.Vertical_Forms,0,0,0]),new i(65104,65135,o.Small_Form_Variants,0,[0,0,1<<c.Small_Form_Variants,0,0,0]),new i(65136,65279,o.Arabic_Presentation_Forms_B,0,[0,0,1<<c.Arabic_Presentation_Forms_B,0,1<<s.Arabic,1<<a.Arabic|1<<a.Arabic_708]),new i(65280,65519,o.Halfwidth_and_Fullwidth_Forms,0,[0,0,1<<c.Halfwidth_And_Fullwidth_Forms,0,1<<s.Korean_Wansung|1<<s.Chinese_Simplified|1<<s.Chinese_Traditional|1<<s.JIS_Japan|1<<s.OEM_Character_Set,0]),new i(65520,65535,o.Specials,0,[0,0,1<<c.Specials,0,0,0]),new i(65536,65663,o.Linear_B_Syllabary,0,[0,0,0,1<<d.Linear_B_Syllabary,0,0]),new i(65664,65791,o.Linear_B_Ideograms,0,[0,0,0,1<<d.Linear_B_Syllabary,0,0]),new i(65792,65855,o.Aegean_Numbers,0,[0,0,0,1<<d.Linear_B_Syllabary,0,0]),new i(65856,65935,o.Ancient_Greek_Numbers,0,[0,0,0,1<<d.Ancient_Greek_Numbers,0,0]),new i(65936,65999,o.Ancient_Symbols,0,[0,0,0,1<<d.Ancient_Symbols,0,0]),new i(66e3,66047,o.Phaistos_Disc,0,[0,0,0,1<<d.Phaistos_Disc,0,0]),new i(66176,66207,o.Lycian,0,[0,0,0,1<<d.Carian,0,0]),new i(66208,66271,o.Carian,0,[0,0,0,1<<d.Carian,0,0]),new i(66272,66303,o.Coptic_Epact_Numbers,0,[1<<r.Coptic,0,0,0,0,0]),new i(66304,66351,o.Old_Italic,0,[0,0,1<<c.Old_Italic,0,0,0]),new i(66352,66383,o.Gothic,0,[0,0,1<<c.Gothic,0,0,0]),new i(66384,66431,o.Old_Permic,0,[]),new i(66432,66463,o.Ugaritic,0,[0,0,0,1<<d.Ugaritic,0,0]),new i(66464,66527,o.Old_Persian,0,[0,0,0,1<<d.Old_Persian,0,0]),new i(66560,66639,o.Deseret,0,[0,0,1<<c.Deseret,0,0,0]),new i(66640,66687,o.Shavian,0,[0,0,0,1<<d.Shavian,0,0]),new i(66688,66735,o.Osmanya,0,[0,0,0,1<<d.Osmanya,0,0]),new i(66736,66815,o.Osage,0,[]),new i(66816,66863,o.Elbasan,0,[]),new i(66864,66927,o.Caucasian_Albanian,0,[]),new i(67072,67455,o.Linear_A,0,[]),new i(67584,67647,o.Cypriot_Syllabary,0,[0,0,0,1<<d.Cypriot_Syllabary,0,0]),new i(67648,67679,o.Imperial_Aramaic,0,[]),new i(67680,67711,o.Palmyrene,0,[]),new i(67712,67759,o.Nabataean,0,[]),new i(67808,67839,o.Hatran,0,[]),new i(67840,67871,o.Phoenician,0,[0,1<<l.Phoenician,0,0,0,0]),new i(67872,67903,o.Lydian,0,[0,0,0,1<<d.Carian,0,0]),new i(67968,67999,o.Meroitic_Hieroglyphs,0,[]),new i(68e3,68095,o.Meroitic_Cursive,0,[]),new i(68096,68191,o.Kharoshthi,0,[0,0,0,1<<d.Kharoshthi,0,0]),new i(68192,68223,o.Old_South_Arabian,0,[]),new i(68224,68255,o.Old_North_Arabian,0,[]),new i(68288,68351,o.Manichaean,0,[]),new i(68352,68415,o.Avestan,0,[]),new i(68416,68447,o.Inscriptional_Parthian,0,[]),new i(68448,68479,o.Inscriptional_Pahlavi,0,[]),new i(68480,68527,o.Psalter_Pahlavi,0,[]),new i(68608,68687,o.Old_Turkic,0,[]),new i(68736,68863,o.Old_Hungarian,0,[]),new i(69216,69247,o.Rumi_Numeral_Symbols,0,[]),new i(69632,69759,o.Brahmi,0,[]),new i(69760,69839,o.Kaithi,0,[]),new i(69840,69887,o.Sora_Sompeng,0,[]),new i(69888,69967,o.Chakma,0,[]),new i(69968,70015,o.Mahajani,0,[]),new i(70016,70111,o.Sharada,0,[]),new i(70112,70143,o.Sinhala_Archaic_Numbers,0,[0,0,1<<c.Sinhala,0,0,0]),new i(70144,70223,o.Khojki,0,[]),new i(70272,70319,o.Multani,0,[]),new i(70320,70399,o.Khudawadi,0,[]),new i(70400,70527,o.Grantha,0,[]),new i(70656,70783,o.Newa,0,[]),new i(70784,70879,o.Tirhuta,0,[]),new i(71040,71167,o.Siddham,0,[]),new i(71168,71263,o.Modi,0,[]),new i(71264,71295,o.Mongolian_Supplement,0,[0,0,1<<c.Mongolian,0,0,0]),new i(71296,71375,o.Takri,0,[]),new i(71424,71487,o.Ahom,0,[]),new i(71840,71935,o.Warang_Citi,0,[]),new i(72384,72447,o.Pau_Cin_Hau,0,[]),new i(72704,72815,o.Bhaiksuki,0,[]),new i(72816,72895,o.Marchen,0,[]),new i(73728,74751,o.Cuneiform,0,[0,0,0,1<<d.Cuneiform,0,0]),new i(74752,74879,o.Cuneiform_Numbers_and_Punctuation,0,[0,0,0,1<<d.Cuneiform,0,0]),new i(74880,75087,o.Early_Dynastic_Cuneiform,0,[]),new i(77824,78895,o.Egyptian_Hieroglyphs,0,[]),new i(82944,83583,o.Anatolian_Hieroglyphs,0,[]),new i(92160,92735,o.Bamum_Supplement,0,[]),new i(92736,92783,o.Mro,0,[]),new i(92880,92927,o.Bassa_Vah,0,[]),new i(92928,93071,o.Pahawh_Hmong,0,[]),new i(93952,94111,o.Miao,2052,[]),new i(94176,94207,o.Ideographic_Symbols_and_Punctuation,0,[]),new i(94208,100351,o.Tangut,0,[]),new i(100352,101119,o.Tangut_Components,0,[]),new i(110592,110847,o.Kana_Supplement,0,[]),new i(113664,113823,o.Duployan,0,[]),new i(113824,113839,o.Shorthand_Format_Controls,0,[]),new i(118784,119039,o.Byzantine_Musical_Symbols,0,[0,0,1<<c.Byzantine_Musical_Symbols,0,0,0]),new i(119040,119295,o.Musical_Symbols,0,[0,0,1<<c.Byzantine_Musical_Symbols,0,0,0]),new i(119296,119375,o.Ancient_Greek_Musical_Notation,0,[0,0,1<<c.Byzantine_Musical_Symbols,0,0,0]),new i(119552,119647,o.Tai_Xuan_Jing_Symbols,0,[]),new i(119648,119679,o.Counting_Rod_Numerals,0,[]),new i(119808,120831,o.Mathematical_Alphanumeric_Symbols,0,[0,0,1<<c.Mathematical_Alphanumeric_Symbols,0,0,0]),new i(120832,121519,o.Sutton_SignWriting,0,[]),new i(122880,122927,o.Glagolitic_Supplement,0,[0,0,0,1<<d.Glagolitic,0,0]),new i(124928,125151,o.Mende_Kikakui,0,[]),new i(125184,125279,o.Adlam,0,[]),new i(126464,126719,o.Arabic_Mathematical_Alphabetic_Symbols,0,[]),new i(126976,127023,o.Mahjong_Tiles,0,[0,0,0,1<<d.Domino_Tiles,0,0]),new i(127024,127135,o.Domino_Tiles,0,[0,0,0,1<<d.Domino_Tiles,0,0]),new i(127136,127231,o.Playing_Cards,0,[]),new i(127232,127487,o.Enclosed_Alphanumeric_Supplement,0,[]),new i(127488,127743,o.Enclosed_Ideographic_Supplement,0,[]),new i(127744,128511,o.Miscellaneous_Symbols_and_Pictographs,0,[]),new i(128512,128591,o.Emoticons,0,[]),new i(128592,128639,o.Ornamental_Dingbats,0,[]),new i(128640,128767,o.Transport_and_Map_Symbols,0,[]),new i(128768,128895,o.Alchemical_Symbols,0,[]),new i(128896,129023,o.Geometric_Shapes_Extended,0,[0,1<<l.Geometric_Shapes,0,0,0,0]),new i(129024,129279,o.Supplemental_Arrows_C,0,[0,1<<l.Arrows,0,0,0,0]),new i(129280,129535,o.Supplemental_Symbols_and_Pictographs,0,[]),new i(131072,173791,o.CJK_Unified_Ideographs_Extension_B,0,[0,0,1<<c.CJK_Unified_Ideographs,0,1<<s.Chinese_Simplified|1<<s.Chinese_Traditional,0]),new i(173824,177983,o.CJK_Unified_Ideographs_Extension_C,0,[0,0,1<<c.CJK_Unified_Ideographs,0,1<<s.Chinese_Simplified|1<<s.Chinese_Traditional,0]),new i(177984,178207,o.CJK_Unified_Ideographs_Extension_D,0,[0,0,1<<c.CJK_Unified_Ideographs,0,1<<s.Chinese_Simplified|1<<s.Chinese_Traditional,0]),new i(178208,183983,o.CJK_Unified_Ideographs_Extension_E,0,[0,0,1<<c.CJK_Unified_Ideographs,0,1<<s.Chinese_Simplified|1<<s.Chinese_Traditional,0]),new i(194560,195103,o.CJK_Compatibility_Ideographs_Supplement,0,[0,0,1<<c.CJK_Strokes,0,1<<s.Chinese_Simplified|1<<s.Chinese_Traditional,0]),new i(917504,917631,o.Tags,0,[0,0,1<<c.Tags,0,0,0]),new i(917760,917999,o.Variation_Selectors_Supplement,0,[0,0,1<<c.Variation_Selectors,0,0,0]),new i(983040,1048575,o.Supplementary_Private_Use_Area_A,0,[0,0,1<<c.Private_Use_plane_15,0,0,0]),new i(1048576,1114111,o.Supplementary_Private_Use_Area_B,0,[0,0,1<<c.Private_Use_plane_15,0,0,0])];t.getSupportedFonts=function(e){var i=n(e,h);return t.getSupportedFontsByRange(i)},t.getSupportedFontsByRange=function(t){if(null==t)return[];for(var e=AscFonts.g_fontApplication.g_fontSelections.List,i=e.length,n=[],s=0;s<i;s++){var a=e[s],r=t.Param;if(r[0]==(a.m_ulUnicodeRange1&r[0])&&(r[1]==(a.m_ulUnicodeRange2&r[1])&&r[2]==(a.m_ulUnicodeRange3&r[2])&&r[3]==(a.m_ulUnicodeRange4&r[3]))){if(t.Name==o.CJK_Unified_Ideographs){if(0==(a.m_ulCodePageRange1&r[4]))continue}else if(r[4]!=(a.m_ulCodePageRange1&r[4]))continue;r[5]==(a.m_ulCodePageRange2&r[5])&&n.push(a.m_wsFontName)}}return n},t.getSupportedRangesByFont=function(t){for(var e=[],n=0;n<h.length;++n){var a=h[n],l=a.Param;l[0]==(t.m_ulUnicodeRange1&l[0])&&(l[1]==(t.m_ulUnicodeRange2&l[1])&&l[2]==(t.m_ulUnicodeRange3&l[2])&&l[3]==(t.m_ulUnicodeRange4&l[3])&&l[4]==(t.m_ulCodePageRange1&l[4])&&l[5]==(t.m_ulCodePageRange2&l[5])&&e.push(a))}return 0===e.length&&(e.push(new i(32,126,o.Basic_Latin,1033,[1<<r.Basic_Latin,0,0,0,1<<s.Latin_1,0])),e.push(new i(160,255,o.Latin_1_Supplement,0,[1<<r.Basic_Latin|1<<r.Latin_1_Supplement,0,0,0,1<<s.Latin_1,0]))),e}}(window),define("common/main/lib/util/character",function(){}),void 0===Common)var Common={};define("common/main/lib/view/SymbolTableDialog",["common/main/lib/util/utils","common/main/lib/util/character","common/main/lib/component/InputField","common/main/lib/component/Window"],function(){"use strict";var t={};t[1]="Basic Latin",t[2]="Latin 1 Supplement",t[3]="Latin Extended A",t[4]="Latin Extended B",t[5]="IPA Extensions",t[6]="Spacing Modifier Letters",t[7]="Combining Diacritical Marks",t[8]="Greek and Coptic",t[9]="Cyrillic",t[10]="Cyrillic Supplement",t[11]="Armenian",t[12]="Hebrew",t[13]="Arabic",t[14]="Syriac",t[15]="Arabic Supplement",t[16]="Thaana",t[17]="NKo",t[18]="Samaritan",t[19]="Mandaic",t[20]="Arabic Extended A",t[21]="Devanagari",t[22]="Bengali",t[23]="Gurmukhi",t[24]="Gujarati",t[25]="Oriya",t[26]="Tamil",t[27]="Telugu",t[28]="Kannada",t[29]="Malayalam",t[30]="Sinhala",t[31]="Thai",t[32]="Lao",t[33]="Tibetan",t[34]="Myanmar",t[35]="Georgian",t[36]="Hangul Jamo",t[37]="Ethiopic",t[38]="Ethiopic Supplement",t[39]="Cherokee",t[40]="Unified Canadian Aboriginal Syllabics",t[41]="Ogham",t[42]="Runic",t[43]="Tagalog",t[44]="Hanunoo",t[45]="Buhid",t[46]="Tagbanwa",t[47]="Khmer",t[48]="Mongolian",t[49]="Unified Canadian Aboriginal Syllabics Extended",t[50]="Limbu",t[51]="Tai Le",t[52]="New Tai Lue",t[53]="Khmer Symbols",t[54]="Buginese",t[55]="Tai Tham",t[56]="Combining Diacritical Marks Extended",t[57]="Balinese",t[58]="Sundanese",t[59]="Batak",t[60]="Lepcha",t[61]="Ol Chiki",t[62]="Cyrillic Extended C",t[63]="Sundanese Supplement",t[64]="Vedic Extensions",t[65]="Phonetic Extensions",t[66]="Phonetic Extensions Supplement",t[67]="Combining Diacritical Marks Supplement",t[68]="Latin Extended Additional",t[69]="Greek Extended",t[70]="General Punctuation",t[71]="Superscripts and Subscripts",t[72]="Currency Symbols",t[73]="Combining Diacritical Marks for Symbols",t[74]="Letterlike Symbols",t[75]="Number Forms",t[76]="Arrows",t[77]="Mathematical Operators",t[78]="Miscellaneous Technical",t[79]="Control Pictures",t[80]="Optical Character Recognition",t[81]="Enclosed Alphanumerics",t[82]="Box Drawing",t[83]="Block Elements",t[84]="Geometric Shapes",t[85]="Miscellaneous Symbols",t[86]="Dingbats",t[87]="Miscellaneous Mathematical Symbols A",t[88]="Supplemental Arrows A",t[89]="Braille Patterns",t[90]="Supplemental Arrows B",t[91]="Miscellaneous Mathematical Symbols B",t[92]="Supplemental Mathematical Operators",t[93]="Miscellaneous Symbols and Arrows",t[94]="Glagolitic",t[95]="Latin Extended C",t[96]="Coptic",t[97]="Georgian Supplement",t[98]="Tifinagh",t[99]="Ethiopic Extended",t[100]="Cyrillic Extended A",t[101]="Supplemental Punctuation",t[102]="CJK Radicals Supplement",t[103]="Kangxi Radicals",t[104]="Ideographic Description Characters",t[105]="CJK Symbols and Punctuation",t[106]="Hiragana",t[107]="Katakana",t[108]="Bopomofo",t[109]="Hangul Compatibility Jamo",t[110]="Kanbun",t[111]="Bopomofo Extended",t[112]="CJK Strokes",t[113]="Katakana Phonetic Extensions",t[114]="Enclosed CJK Letters and Months",t[115]="CJK Compatibility",t[116]="CJK Unified Ideographs Extension",t[117]="Yijing Hexagram Symbols",t[118]="CJK Unified Ideographs",t[119]="Yi Syllables",t[120]="Yi Radicals",t[121]="Lisu",t[122]="Vai",t[123]="Cyrillic Extended B",t[124]="Bamum",t[125]="Modifier Tone Letters",t[126]="Latin Extended D",t[127]="Syloti Nagri",t[128]="Common Indic Number Forms",t[129]="Phags pa",t[130]="Saurashtra",t[131]="Devanagari Extended",t[132]="Kayah Li",t[133]="Rejang",t[134]="Hangul Jamo Extended A",t[135]="Javanese",t[136]="Myanmar Extended B",t[137]="Cham",t[138]="Myanmar Extended A",t[139]="Tai Viet",t[140]="Meetei Mayek Extensions",t[141]="Ethiopic Extended A",t[142]="Latin Extended E",t[143]="Cherokee Supplement",t[144]="Meetei Mayek",t[145]="Hangul Syllables",t[146]="Hangul Jamo Extended B",t[147]="High Surrogates",t[148]="High Private Use Surrogates",t[149]="Low Surrogates",t[150]="Private Use Area",t[151]="CJK Compatibility Ideographs",t[152]="Alphabetic Presentation Forms",t[153]="Arabic Presentation Forms A",t[154]="Variation Selectors",t[155]="Vertical Forms",t[156]="Combining Half Marks",t[157]="CJK Compatibility Forms",t[158]="Small Form Variants",t[159]="Arabic Presentation Forms B",t[160]="Halfwidth and Fullwidth Forms",t[161]="Specials",t[162]="Linear B Syllabary",t[163]="Linear B Ideograms",t[164]="Aegean Numbers",t[165]="Ancient Greek Numbers",t[166]="Ancient Symbols",t[167]="Phaistos Disc",t[168]="Lycian",t[169]="Carian",t[170]="Coptic Epact Numbers",t[171]="Old Italic",t[172]="Gothic",t[173]="Old Permic",t[174]="Ugaritic",t[175]="Old Persian",t[176]="Deseret",t[177]="Shavian",t[178]="Osmanya",t[179]="Osage",t[180]="Elbasan",t[181]="Caucasian Albanian",t[182]="Linear A",t[183]="Cypriot Syllabary",t[184]="Imperial Aramaic",t[185]="Palmyrene",t[186]="Nabataean",t[187]="Hatran",t[188]="Phoenician",t[189]="Lydian",t[190]="Meroitic Hieroglyphs",t[191]="Meroitic Cursive",t[192]="Kharoshthi",t[193]="Old South Arabian",t[194]="Old North Arabian",t[195]="Manichaean",t[196]="Avestan",t[197]="Inscriptional Parthian",t[198]="Inscriptional Pahlavi",t[199]="Psalter Pahlavi",t[200]="Old Turkic";t[201]="Old Hungarian",t[202]="Rumi Numeral Symbols",t[203]="Brahmi",t[204]="Kaithi",t[205]="Sora Sompeng",t[206]="Chakma",t[207]="Mahajani",t[208]="Sharada",t[209]="Sinhala Archaic Numbers",t[210]="Khojki",t[211]="Multani",t[212]="Khudawadi",t[213]="Grantha",t[214]="Newa",t[215]="Tirhuta",t[216]="Siddham",t[217]="Modi",t[218]="Mongolian Supplement",t[219]="Takri",t[220]="Ahom",t[221]="Warang Citi",t[222]="Pau Cin Hau",t[223]="Bhaiksuki",t[224]="Marchen",t[225]="Cuneiform",t[226]="Cuneiform Numbers and Punctuation",t[227]="Early Dynastic Cuneiform",t[228]="Egyptian Hieroglyphs",t[229]="Anatolian Hieroglyphs",t[230]="Bamum Supplement",t[231]="Mro",t[232]="Bassa Vah",t[233]="Pahawh Hmong",t[234]="Miao",t[235]="Ideographic Symbols and Punctuation",t[236]="Tangut",t[237]="Tangut Components",t[238]="Kana Supplement",t[239]="Duployan",t[240]="Shorthand Format Controls",
t[241]="Byzantine Musical Symbols",t[242]="Musical Symbols",t[243]="Ancient Greek Musical Notation",t[244]="Tai Xuan Jing Symbols",t[245]="Counting Rod Numerals",t[246]="Mathematical Alphanumeric Symbols",t[247]="Sutton SignWriting",t[248]="Glagolitic Supplement",t[249]="Mende Kikakui",t[250]="Adlam",t[251]="Arabic Mathematical Alphabetic Symbols",t[252]="Mahjong Tiles",t[253]="Domino Tiles",t[254]="Playing Cards",t[255]="Enclosed Alphanumeric Supplement",t[256]="Enclosed Ideographic Supplement",t[257]="Miscellaneous Symbols and Pictographs",t[258]="Emoticons",t[259]="Ornamental Dingbats",t[260]="Transport and Map Symbols",t[261]="Alchemical Symbols",t[262]="Geometric Shapes Extended",t[263]="Supplemental Arrows C",t[264]="Supplemental Symbols and Pictographs",t[265]="CJK Unified Ideographs Extension B",t[266]="CJK Unified Ideographs Extension C",t[267]="CJK Unified Ideographs Extension D",t[268]="CJK Unified Ideographs Extension E",t[269]="CJK Compatibility Ideographs Supplement",t[270]="Tags",t[271]="Variation Selectors Supplement",t[272]="Supplementary Private Use Area A",t[273]="Supplementary Private Use Area B";var e=[],i=[],n=[],o=-1,s=-1,a=!0,r=-1,l=!1,c="",d=-1e3,h="",p=-1e3,m=-1,u=-1,g=20,b=20,f=function(e,i){e=e.split(/[\-_]/)[0].toLocaleLowerCase(),Common.Utils.loadConfig("resources/symboltable/"+e+".json",function(e){for(var n=1;n<274;n++){var o=t[n];t[n]=e[o]||o}i&&i()})};Common.Views.SymbolTableDialog=Common.UI.Window.extend(_.extend({options:{resizable:!0,minwidth:448,minheight:434,width:448,height:434,cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){var r={resizable:!0,minwidth:448,minheight:434,width:448,height:434,cls:"modal-dlg",buttons:["ok","cancel"]},l=Common.localStorage.getKeysFilter();this.appPrefix=l&&l.length?l.split(",")[0]:"";var c=this.appPrefix+"settings-size-symbol-table",d=Common.Utils.InternalSettings.get(c);null!=d&&void 0!=d||(d=Common.localStorage.getItem(c)||"",Common.Utils.InternalSettings.set(c,d)),d=d?JSON.parse(d):[],this.options=_.extend(r,{title:this.textTitle,width:d[0]||448,height:d[1]||434},t||{}),this.api=this.options.api,this.type=this.options.type||0,this.special=this.options.special||!1,this.showShortcutKey=this.options.showShortcutKey||!1,!this.special&&(this.options.height-=38),!this.special&&(this.options.minheight-=38),this.template=['<div class="box">','<div style="margin-bottom: 16px;" class="'+(this.special?"":"hidden")+'">','<button type="button" class="btn btn-text-default auto" id="symbol-table-symbols" style="border-top-right-radius: 0;border-bottom-right-radius: 0;">',this.textSymbols,"</button>",'<button type="button" class="btn btn-text-default auto" id="symbol-table-special" style="border-top-left-radius: 0;border-bottom-left-radius: 0;border-left-width: 0;margin-left: -1px;">',this.textSpecial,"</button>","</div>",'<div id="symbol-table-pnl-symbols">','<table cols="2" style="width: 100%;max-width: 497px;">',"<tr>",'<td style="padding-right: 5px;padding-bottom: 8px;width: 50%;">','<label class="input-label">'+this.textFont+"</label>",'<div id="symbol-table-cmb-fonts"></div>',"</td>",'<td style="padding-left: 5px;padding-bottom: 8px;">','<label class="input-label">'+this.textRange+"</label>",'<div id="symbol-table-cmb-range"></div>',"</td>","</tr>","</table>",'<table cols="1" style="width: 100%;">',"<tr>",'<td style="padding-bottom: 16px;">','<div id="symbol-table-scrollable-div" style="position: relative;height:'+(this.options.height-302+38*(this.special?0:1))+'px;">','<div style="width: 100%;">','<div id="id-preview">',"<div>",'<div style="position: absolute; top: 0;"><div id="id-preview-data" tabindex="0" oo_editor_input="true"></div></div>',"</div>","</div>","</div>","</div>","</td>","</tr>","<tr>",'<td style="padding-bottom: 16px;">','<label class="input-label">'+this.textRecent+"</label>",'<div id="symbol-table-recent" tabindex="0" oo_editor_input="true" style="width: 100%;"></div>',"</td>","</tr>","</table>",'<table cols="2" style="width: 100%;max-width: 497px;">',"<tr>",'<td style="padding-right: 5px; width: 50%;">','<label class="input-label">'+this.textCode+"</label>","</td>",'<td style="padding-left: 5px;">',"</td>","</tr>","<tr>",'<td style="padding-right: 5px;">','<div id="symbol-table-text-code" oo_editor_input="true"></div>',"</td>",'<td style="padding-left: 5px;">','<div id="symbol-table-label-font" style="overflow: hidden; text-overflow: ellipsis;white-space: nowrap;max-width: 160px;"></div>',"</td>","</tr>","</table>","</div>",'<div id="symbol-table-pnl-special">','<table cols="1" style="width: 100%;">',"<tr>","<td>","<label>"+this.textCharacter+"</label>",'<label id="symbol-table-lbl-shortcut" style="float: right; width: 107px;">'+this.textShortcut+"</label>","</td>","</tr>","<tr>","<td>",'<div id="symbol-table-special-list" class="no-borders" style="width:100%; height: '+(this.options.height-156+38*(this.special?0:1))+'px;"></div>',"</td>","</tr>","</table>","</div>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options);var h=e.length<1;h&&this.initFonts(),this.fillRecentSymbols();var p;if(t.font?p=t.font:n.length>0&&(p=n[0].font),p)for(var m=0;m<e.length;++m)if(e[m].displayValue===p){o=m;break}o<0&&(o=0),i=this.getArrRangesByFont(o);var m;if(-1===s&&(s=i[0].Start),t.code?s=t.code:t.symbol?s=this.fixedCharCodeAt(t.symbol,0):n.length>0&&(s=n[0].symbol),h&&this.options.lang&&"en"!=this.options.lang){var u=this;f(this.options.lang,function(){u.updateRangeSelector()})}Common.UI.Window.prototype.initialize.call(this,this.options),this.on("resizing",_.bind(this.onWindowResizing,this)),this.on("resize",_.bind(this.onWindowResize,this)),a=!0},initFonts:function(){var t=this.api.pluginMethod_GetFontList();t.sort(function(t,e){return t.m_wsFontName<e.m_wsFontName?-1:t.m_wsFontName>e.m_wsFontName?1:0});for(var i,n,s,a=[],r={},l=0;l<t.length;++l)i=t[l],s=i.m_wsFontName,n=r[s],n?n.m_bBold&&n.m_bItalic?r[s]=i:n.m_bBold&&!i.m_bBold?r[s]=i:!n.m_bItalic||i.m_bBold||i.m_bItalic||(r[s]=i):r[s]=i;delete r.ASCW3;var l=0;for(var d in r)r.hasOwnProperty(d)&&(a.push(r[d]),a[a.length-1].displayValue=r[d].m_wsFontName);for(e=a,e.sort(function(t,e){return t.displayValue.toLowerCase()>e.displayValue.toLowerCase()?1:-1}),l=0;l<e.length;++l)e[l].value=l;if(r[c]||(r["Cambria Math"]?c="Cambria Math":r["Asana-Math"]&&(c="Asana-Math")),r[c])for(l=0;l<e.length;++l)if(e[l].displayValue===c){o=l;break}},render:function(){Common.UI.Window.prototype.render.call(this);var t=this,n=this.getChild();n.find(".resize-border").css({background:"none",border:"none"}),this.btnSymbols=new Common.UI.Button({el:n.find("#symbol-table-symbols"),enableToggle:!0,toggleGroup:"hyperlink-type",allowDepress:!1,pressed:!0}),this.btnSymbols.on("click",_.bind(this.onModeClick,this,!1)),this.btnSpecial=new Common.UI.Button({el:n.find("#symbol-table-special"),enableToggle:!0,toggleGroup:"hyperlink-type",allowDepress:!1}),this.btnSpecial.on("click",_.bind(this.onModeClick,this,!0)),this.cmbFonts=new Common.UI.ComboBox({el:n.find("#symbol-table-cmb-fonts"),cls:"input-group-nr",data:e,editable:!1,search:!0,menuStyle:"min-width: 100%; max-height: 209px;"}).on("selected",function(e,n){var r=t.getRangeBySymbol(i,s);if(o=n.value,i=t.getArrRangesByFont(o),r){for(var l=0;l<i.length&&r.Name!==i[l].Name;++l);l===i.length&&(s=i[0].Start)}else s=i[0].Start;a=!0,t.updateView(),setTimeout(function(){t.previewPanel.focus()},1)}),this.cmbFonts.setValue(o),this.cmbRange=new Common.UI.ComboBox({el:n.find("#symbol-table-cmb-range"),cls:"input-group-nr",editable:!1,search:!0,menuStyle:"min-width: 100%; max-height: 209px;"}).on("selected",function(e,n){var o=t.getRangeByName(i,parseInt(n.value));s=o.Start,a=!0,t.updateView(void 0,void 0,void 0,void 0,!1),setTimeout(function(){t.previewPanel.focus()},1)}),this.updateRangeSelector(),t.inputCode=new Common.UI.InputField({el:n.find("#symbol-table-text-code"),allowBlank:!1,blankError:t.txtEmpty,style:"width: 100%;",validateOnBlur:!1,validateOnChange:!0}).on("changing",function(e,o,r){var l=parseInt(o,16);if(!isNaN(l)&&l>31&&t.getRangeBySymbol(i,l)){var c=0===n.find("#c"+l).length;s=l,a=!0,t.updateView(c,void 0,!1)}}).on("change:after",function(e,i,n){t.updateInput()}),this.symbolTablePanel=n.find("#symbol-table-scrollable-div"),this.previewPanel=n.find("#id-preview-data"),this.previewParent=this.previewPanel.parent(),this.previewScrolled=n.find("#id-preview"),this.previewInner=this.previewScrolled.find("div:first-child"),this.recentPanel=n.find("#symbol-table-recent"),this.fontLabel=n.find("#symbol-table-label-font"),this.boxPanel=n.find(".box"),this.updateView(void 0,void 0,void 0,!0);var r=[{symbol:"â",description:this.textEmDash,shortcutKey:"Alt+Ctrl+Num -",code:"2014"},{symbol:"â",description:this.textEnDash,shortcutKey:"",code:"2013"},{symbol:"â",description:this.textNBHyphen,shortcutKey:"Ctrl+Shift+_",code:"002D",special:{NonBreakingHyphen:!0}},{symbol:"",description:this.textEmSpace,shortcutKey:"",code:"2003"},{symbol:"",description:this.textEnSpace,shortcutKey:"",code:"2002"},{symbol:"",description:this.textQEmSpace,shortcutKey:"",code:"2005"},{symbol:"Â°",description:this.textNBSpace,shortcutKey:"Ctrl+Shift+Space",code:"00A0"},{symbol:"Â©",description:this.textCopyright,shortcutKey:"",code:"00A9"},{symbol:"Â®",description:this.textRegistered,shortcutKey:"",code:"00AE"},{symbol:"â¢",description:this.textTradeMark,shortcutKey:"",code:"2122"},{symbol:"Â§",description:this.textSection,shortcutKey:"",code:"00A7"},{symbol:"Â¶",description:this.textPilcrow,shortcutKey:"",code:"00B6"},{symbol:"â¦",description:this.textEllipsis,shortcutKey:"",code:"2026"},{symbol:"â",description:this.textSOQuote,shortcutKey:"",code:"2018"},{symbol:"â",description:this.textSCQuote,shortcutKey:"",code:"2019"},{symbol:"â",description:this.textDOQuote,shortcutKey:"",code:"201C"},{symbol:"â",description:this.textDCQuote,shortcutKey:"",code:"201D"}];this.specialList=new Common.UI.ListView({el:n.find("#symbol-table-special-list"),store:new Common.UI.DataViewStore(r),simpleAddMode:!0,cls:"dbl-clickable",itemTemplate:_.template(['<div id="<%= id %>" class="list-item" style="width: 100%;display:flex;">','<div style="width:70px;text-align: center; padding-right: 5px;"><%= symbol %></div>','<div style="flex-grow:1;padding-right: 5px;"><%= description %></div>',"<% if ("+this.showShortcutKey+") { %>",'<div style="width:100px;"><%= shortcutKey %></div>',"<% } %>","</div>"].join(""))}),this.specialList.on("item:dblclick",_.bind(this.onDblClickSpecialItem,this)).on("entervalue",_.bind(this.onDblClickSpecialItem,this)),this.specialList.selectByIndex(0),this.lblShortCut=n.find("#symbol-table-lbl-shortcut"),this.lblShortCut.toggleClass("hidden",!this.showShortcutKey),n.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.symbolsPanel=n.find("#symbol-table-pnl-symbols"),this.specialPanel=n.find("#symbol-table-pnl-special")},show:function(){Common.UI.Window.prototype.show.apply(this,arguments),this.binding||(this.binding={}),this.binding.keydownSymbols=_.bind(this.onKeyDown,this),this.binding.keypressSymbols=_.bind(this.onKeyPress,this),$(document).on("keydown."+this.cid,"#symbol-table-scrollable-div #id-preview-data, #symbol-table-recent",this.binding.keydownSymbols),$(document).on("keypress."+this.cid,"#symbol-table-scrollable-div #id-preview-data, #symbol-table-recent",this.binding.keypressSymbols);var t=this.special&&!!Common.Utils.InternalSettings.get(this.appPrefix+"symbol-table-special");t?this.btnSpecial.toggle(!0):this.btnSymbols.toggle(!0),this.ShowHideElem(t)},close:function(t){$(document).off("keydown."+this.cid,this.binding.keydownSymbols),$(document).off("keypress."+this.cid,this.binding.keypressSymbols),this.special&&Common.Utils.InternalSettings.set(this.appPrefix+"symbol-table-special",this.btnSpecial.isActive()),Common.UI.Window.prototype.close.apply(this,arguments)},getPasteSymbol:function(t){var i,n=!1;if(t&&t.length>0)if(n="c"===t[0])i=e[o].displayValue;else{var a=parseInt(t.split("_")[2]);i=e[a].displayValue}return{font:i,symbol:this.encodeSurrogateChar(s),code:s,updateRecents:n}},getSpecialSymbol:function(){var t=this.specialList.getSelectedRec();return{font:void 0,symbol:this.encodeSurrogateChar(t.get("code")),code:parseInt(t.get("code"),16),special:t.get("special")}},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value,!0)},onPrimary:function(t){return this._handleInput("ok"),!1},_handleInput:function(t,e){if(e||!document.activeElement||"textarea"!=document.activeElement.localName||!/area_id/.test(document.activeElement.id)){var i=this.btnSpecial.isActive(),n="ok"==t?i?this.getSpecialSymbol():this.getPasteSymbol(this.$window.find(".cell-selected").attr("id")):{};this.options.handler&&this.options.handler.call(this,this,t,n),"ok"==t&&(!i&&this.checkRecent(s,n.font),!i&&n.updateRecents&&this.updateRecents(),this.type)||this.close()}},encodeSurrogateChar:function(t){if(t<65536)return String.fromCharCode(t);t-=65536;var e=55296|t>>10,i=56320|1023&t;return String.fromCharCode(e)+String.fromCharCode(i)},fixedCharCodeAt:function(t,e){e=e||0;var i,n,o=t.charCodeAt(e);if(55296<=o&&o<=56319){if(i=o,n=t.charCodeAt(e+1),isNaN(n))throw"Ð¡ÑÐ°ÑÑÐ°Ñ ÑÐ°ÑÑÑ ÑÑÑÑÐ¾Ð³Ð°ÑÐ½Ð¾Ð¹ Ð¿Ð°ÑÑ Ð±ÐµÐ· ÑÐ»ÐµÐ´ÑÑÑÐµÐ¹ Ð¼Ð»Ð°Ð´ÑÐµÐ¹ Ð² fixedCharCodeAt()";return 1024*(i-55296)+(n-56320)+65536}return!(56320<=o&&o<=57343)&&o},getArrRangesByFont:function(t){var i=getSupportedRangesByFont(e[t]);return 0===i.length&&i.push({Start:32,End:255}),i[0].Start<32&&(i[0].Start=32),i},getRangeBySymbol:function(t,e){for(var i=0;i<t.length;++i)if(t[i].Start<=e&&t[i].End>=e)return t[i];return null},getRangeByName:function(t,e){for(var i=0;i<t.length;++i)if(t[i].Name===e)return t[i];return null},getLinearIndexByCode:function(t,e){for(var i,n=0,o=0;o<t.length;++o){if(i=t[o],i.Start>e)return-1;if(i.Start<=e&&i.End>=e)return n+(e-i.Start);n+=i.End-i.Start+1}return-1},getCodeByLinearIndex:function(t,e){if(e<0)return-1;for(var i,n=0,o=t[0],s=0;s<t.length;++s){if(o=t[s],i=o.End-o.Start+1,n+i>e)return o.Start+e-n;n+=i}return-1},createTable:function(t,e,i){for(var n,o,s=e*i,a=0,r="",l=0;l<s;++l)o=l/i>>0==e-1?"style='border-bottom: none'":"",l<t.length?(n="c"+t[l],r+='<div class="cell" '+o+' id="'+n+'">&#'+t[l].toString(10)+"</div>"):r+='<div class="cell"'+o+"></div>",++a>=i&&(r+='<br class="noselect">',a=0);this.previewPanel.html(r)},fillRecentSymbols:function(){var t,e=Common.localStorage.getItem(this.appPrefix+"recentSymbols");""!=e&&(t=JSON.parse(e)),_.isArray(t)&&(n=t)},saveRecent:function(){var t=JSON.stringify(n);Common.localStorage.setItem(this.appPrefix+"recentSymbols",t)},checkRecent:function(t,e){if(0===n.length)return void n.push({symbol:t,font:e});for(var i=0;i<n.length;++i)if(n[i].symbol===t&&n[i].font===e){n.splice(i,1);break}n.splice(0,0,{symbol:t,font:e}),n.length>36&&n.splice(36,n.length-36),this.saveRecent()},createCell:function(t,i){var n="",o="";if(i){for(var s=0,a=0;a<e.length;++a)if(e[a].displayValue===i){s=a;break}n="r_"+t+"_"+s,o="&#"+t.toString()}else void 0!==t&&(n="r"+t,o="&#"+t.toString());var r=$('<div id="'+n+'">'+o+"</div>");return r.addClass("cell"),r.addClass("noselect"),r.mousedown(_.bind(this.cellClickHandler,this)),i&&r.css("font-family","'"+i+"'"),r},cellClickHandler:function(t){var e=$(t.target).attr("id");if(e){var i=(new Date).getTime();if(e===h&&i-p<300)this.cellDblClickHandler(t);else{if("c"===e[0])s=parseInt(e.slice(1,e.length)),a=!0;else{var n=e.split("_");s=parseInt(n[1]),r=parseInt(n[2]),a=!1}this.updateView(!1)}h=t.target.id,p=i}},cellDblClickHandler:function(t){if(this.type){var e=this.getPasteSymbol($(t.target).attr("id"));this.checkRecent(s,e.font),e.updateRecents&&this.updateView(!1,void 0,void 0,!0),this.fireEvent("symbol:dblclick",this,"ok",e)}else this._handleInput("ok")},onDblClickSpecialItem:function(t){if(this.type){var e=this.getSpecialSymbol();this.fireEvent("symbol:dblclick",this,"ok",e)}else this._handleInput("ok")},updateRecents:function(){var t=this.recentPanel;t.empty();var e=this.getColsCount(),i=n.length;t.width(31*e);for(var o=0;o<e;++o){var s=o<i?this.createCell(n[o].symbol,n[o].font):this.createCell();s.css("border-bottom","none"),t.append(s),o===e-1&&s.css("border-right","none")}},getColsCount:function(){return(this.boxPanel.innerWidth()-13)/31>>0},getMaxHeight:function(){return this.symbolTablePanel.innerHeight()},getRowsCount:function(){return Math.max(1,this.getMaxHeight()/33>>0)},getAllSymbolsCount:function(t){for(var e,i=0,n=0;n<t.length;++n)e=t[n],i+=e.End-e.Start+1;return i},setTable:function(t){for(var n,s=this.getColsCount(),a=this.getRowsCount(),r=this.getLinearIndexByCode(i,t),l=this.getAllSymbolsCount(i),c=Math.ceil(l/s),d=Math.max(0,Math.min(c-a,r/s>>0)),h=d*s,p=a*s,m=[],u=0;u<p&&-1!==(n=this.getCodeByLinearIndex(i,h+u));++u)m.push(n);return this.previewPanel.css("font-family","'"+e[o].displayValue+"'"),this.createTable(m,a,s),d},updateView:function(t,n,c,d,h){a&&!1!==h&&this.updateRangeSelector(),a?this.fontLabel.text(e[o]?e[o].displayValue:""):this.fontLabel.text(e[r]?e[r].displayValue:""),!1!==t&&this.cmbFonts.setValue(o);var p=this.getRowsCount(),m=33*p;if(l=!1,!1!==t){var u=null!==n&&void 0!==n?n:s,f=this.setTable(u),C=this.getAllSymbolsCount(i),v=Math.ceil(C/this.getColsCount()),y=33*v;this.previewInner.height(y),this.previewPanel.height(m),this.previewScrolled.height(m),this.scrollerY||(g=Math.max(22,m/8+.5>>0),b=Math.min(33*Math.floor(this.previewPanel.height()/33)/10,20),this.scrollerY=new Common.UI.Scroller({el:this.previewScrolled,minScrollbarLength:g,alwaysVisibleY:!0,wheelSpeed:b,useKeyboard:!1,onChange:_.bind(function(){this.scrollerY&&(this._preventUpdateScroll=!0,this.onScrollEnd(),this._preventUpdateScroll=!1,this.previewParent.height(m),this.previewParent.css({top:this.scrollerY.getScrollTop()}))},this)})),this._preventUpdateScroll||(this.scrollerY.update({minScrollbarLength:g,wheelSpeed:b}),this.scrollerY.scrollTop(33*f));var x=this.previewPanel.find(".cell");x.off("mousedown"),x.mousedown(_.bind(this.cellClickHandler,this))}d&&this.updateRecents(),this.$window.find(".cell").removeClass("cell-selected"),a?this.$window.find("#c"+s).addClass("cell-selected"):this.$window.find("#r_"+s+"_"+r).addClass("cell-selected"),!1!==c&&this.updateInput()},onScrollEnd:function(){if(this.scrollerY.getScrollTop()!==d){var t=this.getAllSymbolsCount(i),e=this.getColsCount(),n=this.getRowsCount(),o=Math.ceil(t/e),r=33*o,l=Math.max(0,Math.min(o-n,o*this.scrollerY.getScrollTop()/r+.5>>0));if(d=this.scrollerY.getScrollTop(),a){var c=this.previewPanel.children()[0];if(c){var h=c.id;if(h){var p=parseInt(h.slice(1,h.length)),m=this.getLinearIndexByCode(i,p),u=this.getLinearIndexByCode(i,s),g=u-m,b=l*e+g;s=this.getCodeByLinearIndex(i,b);var f=l*e;for(b-=e;-1===s&&b>=f;)s=this.getCodeByLinearIndex(i,b),b-=e;-1===s&&(s=this.getCodeByLinearIndex(i,f))}else s=this.getCodeByLinearIndex(i,l*e)}}else s=this.getCodeByLinearIndex(i,l*e),a=!0;this.updateView(!0,this.getCodeByLinearIndex(i,l*e))}},updateInput:function(){for(var t=s.toString(16).toUpperCase(),e=t.length,i=e;i<5;++i)t="0"+t;this.inputCode.setValue(t)},updateRangeSelector:function(){var e=this.getRangeBySymbol(i,s);if(e&&e.Name){this.cmbRange.setDisabled(!1);var n,o=[];for(n=0;n<i.length;++n)o.push({value:i[n].Name,displayValue:t[i[n].Name]});this.cmbRange.setData(o),this.cmbRange.setValue(e.Name)}else this.cmbRange.setDisabled(!0),this.cmbRange.setValue("")},onKeyDown:function(t){if(!document.activeElement||!document.activeElement.nodeName||"span"!==document.activeElement.nodeName.toLowerCase()){var e=t.which||t.charCode||t.keyCode||0,n=!0;if(a){var o=-1;if(e===Common.UI.Keys.LEFT?o=this.getCodeByLinearIndex(i,this.getLinearIndexByCode(i,s)-1):e===Common.UI.Keys.UP?o=this.getCodeByLinearIndex(i,this.getLinearIndexByCode(i,s)-this.getColsCount()):e===Common.UI.Keys.RIGHT?o=this.getCodeByLinearIndex(i,this.getLinearIndexByCode(i,s)+1):e===Common.UI.Keys.DOWN?o=this.getCodeByLinearIndex(i,this.getLinearIndexByCode(i,s)+this.getColsCount()):e===Common.UI.Keys.HOME?i.length>0&&(o=i[0].Start):e===Common.UI.Keys.END?i.length>0&&(o=i[i.length-1].End):n=!1,o>-1){s=o;var l=0===this.$window.find("#c"+s).length;this.updateView(l)}}else{var c,d;if(e===Common.UI.Keys.LEFT){if((c=this.$window.find(".cell-selected")[0])&&"r"===c.id[0]){var h=this.$window.find(c).prev();h.length>0&&(d=this.$window.find(h).attr("id").split("_"),s=parseInt(d[1]),r=parseInt(d[2]),this.updateView(!1))}}else if(e===Common.UI.Keys.RIGHT){if((c=this.$window.find(".cell-selected")[0])&&"r"===c.id[0]){var p=this.$window.find(c).next();p.length>0&&(d=this.$window.find(p).attr("id").split("_"),s=parseInt(d[1]),r=parseInt(d[2]),this.updateView(!1))}}else if(e===Common.UI.Keys.HOME){var g=this.$window.find("#recent-table").children()[0];g&&(d=g.id.split("_"),s=parseInt(d[1]),r=parseInt(d[2]),this.updateView(!1))}else if(e===Common.UI.Keys.END){var b=this.recentPanel.children(),f=b[b.length-1];f&&(d=f.id.split("_"),s=parseInt(d[1]),r=parseInt(d[2]),this.updateView(!1))}else n=!1}n&&(u=e,m=(new Date).getTime())}},onKeyPress:function(t){if(!document.activeElement||!document.activeElement.nodeName||"span"!==document.activeElement.nodeName.toLowerCase()){var e=t.which||t.charCode||t.keyCode||0;if(!(u===e&&Math.abs(m-(new Date).getTime())<1e3)){if(!isNaN(e)&&e>31){if(this.getRangeBySymbol(i,e)){var n=0===this.$window.find("#c"+e).length;s=e,a=!0,this.updateView(n,void 0,!0)}}t.preventDefault&&t.preventDefault()}}},onWindowResize:function(t){var e=this.getSize();if(t&&"start"==t[1])this._preventUpdateScroll=!0,this.curSize={resize:!1,width:e[0],height:e[1]};else if(this.curSize.resize){this._preventUpdateScroll=!1,this.curSize.height=e[1]-302+38*(this.special?0:1);var i=Math.max(1,this.curSize.height/33>>0),n=33*i;this.symbolTablePanel.css({height:this.curSize.height+"px"}),this.previewPanel.css({height:n+"px"}),this.previewScrolled.css({height:n+"px"}),this.scrollerY=null,this.updateView(void 0,void 0,void 0,!0),this.specialList.cmpEl.height(e[1]-156+38*(this.special?0:1)),!this.special&&(e[1]+=38);var o=JSON.stringify(e);Common.localStorage.setItem(this.appPrefix+"settings-size-symbol-table",o),Common.Utils.InternalSettings.set(this.appPrefix+"settings-size-symbol-table",o)}},onWindowResizing:function(){if(this.curSize){var t=this.getSize();if(t[0]!==this.curSize.width||t[1]!==this.curSize.height){this.curSize.resize||(this.curSize.resize=!0),this.curSize.width=t[0],this.curSize.height=t[1]-302+38*(this.special?0:1);var e=Math.max(1,this.curSize.height/33>>0),i=33*e;this.symbolTablePanel.css({height:this.curSize.height+"px"}),this.previewPanel.css({height:i+"px"}),this.previewScrolled.css({height:i+"px"}),this.specialList.cmpEl.height(t[1]-156+38*(this.special?0:1)),this.updateView(void 0,void 0,void 0,!0)}}},onModeClick:function(t,e,i){this.ShowHideElem(t)},ShowHideElem:function(t){this.symbolsPanel.toggleClass("hidden",t),this.specialPanel.toggleClass("hidden",!t);var e=this;_.delay(function(){t?e.specialList.focus():e.previewPanel.focus()},50)},textTitle:"Symbol",textFont:"Font",textRange:"Range",textRecent:"Recently used symbols",textCode:"Unicode HEX value",textSymbols:"Symbols",textSpecial:"Special characters",textCharacter:"Character",textShortcut:"Shortcut key",textEmDash:"Em Dash",textEnDash:"En Dash",textNBHyphen:"Non-breaking Hyphen",textSHyphen:"Soft Hyphen",textEmSpace:"Em Space",textEnSpace:"En Space",textQEmSpace:"1/4 Em Space",textNBSpace:"No-break Space",textCopyright:"Copyright Sign",textRegistered:"Registered Sign",textTradeMark:"Trade Mark Sign",textSection:"Section Sign",textPilcrow:"Pilcrow Sign",textEllipsis:"Horizontal Ellipsis",textSOQuote:"Single Opening Quote",textSCQuote:"Single Closing Quote",textDOQuote:"Double Opening Quote",textDCQuote:"Double Closing Quote"},Common.Views.SymbolTableDialog||{}))}),define("documenteditor/main/app/view/EditListItemDialog",["common/main/lib/component/Window","common/main/lib/component/InputField"],function(){"use strict";DE.Views.EditListItemDialog=Common.UI.Window.extend(_.extend({options:{width:330,header:!1,cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,t||{}),this.template=['<div class="box">','<div class="input-row">',"<label>"+this.textDisplayName+"</label>","</div>",'<div id="id-dlg-label-name" class="input-row" style="margin-bottom: 8px;"></div>','<div class="input-row">',"<label>"+this.textValue+"</label>","</div>",'<div id="id-dlg-label-value" class="input-row"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this;t.inputName=new Common.UI.InputField({el:$("#id-dlg-label-name"),allowBlank:!1,blankError:t.textNameError,style:"width: 100%;",maxLength:256,validateOnBlur:!1,validation:function(t){return!!t||""}}),t.inputName._input.on("input",function(e){void 0==t.copyvalue&&t.inputValue.getValue()==t.inputName.getValue()&&(t.copyvalue=1),1==t.copyvalue?t.inputValue.setValue($(e.target).val()):2==t.copyvalue&&(t.copyvalue=0)}),t.inputValue=new Common.UI.InputField({el:$("#id-dlg-label-value"),style:"width: 100%;",maxLength:256,validateOnBlur:!1,validation:function(e){if(""!==e&&t.options.store){if(t.options.store.findWhere({value:e}))return t.textValueError}return!0}}),t.inputValue._input.on("input",function(e){void 0==t.copyvalue&&t.inputValue.getValue()==t.inputName.getValue()&&(t.copyvalue=2),2==t.copyvalue?t.inputName.setValue($(e.target).val()):1==t.copyvalue&&(t.copyvalue=0)}),this.getChild().find(".btn").on("click",_.bind(this.onBtnClick,this))},getFocusedComponents:function(){return[this.inputName,this.inputValue]},getDefaultFocusableComponent:function(){return this.inputName},onPrimary:function(t){return this._handleInput("ok"),!1},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},_handleInput:function(t){if(this.options.handler){if("ok"==t){if(!0!==this.inputName.checkValidate())return void this.inputName.focus();if(!0!==this.inputValue.checkValidate())return void this.inputValue.focus()}this.options.handler.call(this,t,this.inputName.getValue(),this.inputValue.getValue())}this.close()},setSettings:function(t){t&&(this.inputName.setValue(t.name||""),this.inputValue.setValue(t.value||""))},textDisplayName:"Display name",textValue:"Value",textNameError:"Display name must not be empty.",textValueError:"An item with the same value already exists."},DE.Views.EditListItemDialog||{}))}),define("documenteditor/main/app/view/ControlSettingsDialog",["text!documenteditor/main/app/template/ControlSettingsDialog.template","common/main/lib/util/utils","common/main/lib/component/CheckBox","common/main/lib/component/InputField","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/view/SymbolTableDialog","documenteditor/main/app/view/EditListItemDialog"],function(t){"use strict";DE.Views.ControlSettingsDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:310,height:392,toggleGroup:"control-adv-settings-group",storageName:"de-control-settings-adv-category"},initialize:function(e){_.extend(this.options,{title:this.textTitle,items:[{panelId:"id-adv-control-settings-general",panelCaption:this.strGeneral},{panelId:"id-adv-control-settings-lock",panelCaption:this.textLock},{panelId:"id-adv-control-settings-list",panelCaption:this.textCombobox},{panelId:"id-adv-control-settings-date",panelCaption:this.textDate},{panelId:"id-adv-control-settings-checkbox",panelCaption:this.textCheckbox},{panelId:"id-adv-control-settings-field",panelCaption:this.textField},{panelId:"id-adv-control-settings-additional",panelCaption:this.textAdditional}],contentTemplate:_.template(t)({scope:this})},e),this.handler=e.handler,this.props=e.props,this.api=e.api,Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.txtName=new Common.UI.InputField({el:$("#control-settings-txt-name"),allowBlank:!0,validateOnChange:!1,validateOnBlur:!1,style:"width: 100%;",maxLength:64,value:""}),this.txtTag=new Common.UI.InputField({el:$("#control-settings-txt-tag"),allowBlank:!0,validateOnChange:!1,validateOnBlur:!1,style:"width: 100%;",maxLength:64,value:""}),this.txtPlaceholder=new Common.UI.InputField({el:$("#control-settings-txt-pholder"),allowBlank:!0,validateOnChange:!1,validateOnBlur:!1,style:"width: 100%;",value:""}),this.cmbShow=new Common.UI.ComboBox({el:$("#control-settings-combo-show"),cls:"input-group-nr",menuStyle:"min-width: 120px;",editable:!1,takeFocusOnClose:!0,data:[{displayValue:this.textBox,value:Asc.c_oAscSdtAppearance.Frame},{displayValue:this.textNone,value:Asc.c_oAscSdtAppearance.Hidden}]}),this.cmbShow.setValue(Asc.c_oAscSdtAppearance.Frame),this.btnColor=new Common.UI.ColorButton({parentEl:$("#control-settings-color-btn"),auto:{caption:this.textSystemColor,color:Common.Utils.ThemeColor.getHexColor(220,220,220)},additionalAlign:this.menuAddAlign,color:"auto",colors:["000000","993300","333300","003300","003366","000080","333399","333333","800000","FF6600","808000","00FF00","008080","0000FF","666699","808080","FF0000","FF9900","99CC00","339966","33CCCC","3366FF","800080","999999","FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0","FF99CC","FFCC99","FFFF99","CCFFCC","CCFFFF","C9C8FF","CC99FF","FFFFFF"],paletteHeight:94}),this.colors=this.btnColor.getPicker(),this.btnApplyAll=new Common.UI.Button({el:$("#control-settings-btn-all")}),this.btnApplyAll.on("click",_.bind(this.applyAllClick,this)),this.chLockDelete=new Common.UI.CheckBox({el:$("#control-settings-chb-lock-delete"),labelText:this.txtLockDelete}),this.chLockEdit=new Common.UI.CheckBox({el:$("#control-settings-chb-lock-edit"),labelText:this.txtLockEdit}),this.list=new Common.UI.ListView({el:$("#control-settings-list",this.$window),store:new Common.UI.DataViewStore,emptyText:"",template:_.template(['<div class="listview inner" style=""></div>'].join("")),itemTemplate:_.template(['<div id="<%= id %>" class="list-item" style="width: 100%;display:inline-block;">','<div style="width:90px;display: inline-block;vertical-align: middle; overflow: hidden; text-overflow: ellipsis;white-space: pre;margin-right: 5px;"><%= Common.Utils.String.htmlEncode(name) %></div>','<div style="width:90px;display: inline-block;vertical-align: middle; overflow: hidden; text-overflow: ellipsis;white-space: pre;"><%= Common.Utils.String.htmlEncode(value) %></div>',"</div>"].join("")),tabindex:1}),this.list.on("item:select",_.bind(this.onSelectItem,this)),this.btnAdd=new Common.UI.Button({el:$("#control-settings-btn-add")}),this.btnAdd.on("click",_.bind(this.onAddItem,this)),this.btnChange=new Common.UI.Button({el:$("#control-settings-btn-change")}),this.btnChange.on("click",_.bind(this.onChangeItem,this)),this.btnDelete=new Common.UI.Button({el:$("#control-settings-btn-delete")}),this.btnDelete.on("click",_.bind(this.onDeleteItem,this)),this.btnUp=new Common.UI.Button({el:$("#control-settings-btn-up")}),this.btnUp.on("click",_.bind(this.onMoveItem,this,!0)),this.btnDown=new Common.UI.Button({el:$("#control-settings-btn-down")}),this.btnDown.on("click",_.bind(this.onMoveItem,this,!1));var e=[{value:1068},{value:1026},{value:1029},{value:3079},{value:1031},{value:2055},{value:1032},{value:3081},{value:2057},{value:1033},{value:3082},{value:2058},{value:1035},{value:1036},{value:1040},{value:1041},{value:1042},{value:1062},{value:1038},{value:1043},{value:1045},{value:1046},{value:2070},{value:1049},{value:1051},{value:1060},{value:2077},{value:1053},{value:1055},{value:1058},{value:1066},{value:2052}];e.forEach(function(t){var e=Common.util.LanguageInfo.getLocalLanguageName(t.value);t.displayValue=e[1],t.langName=e[0]}),this.cmbLang=new Common.UI.ComboBox({el:$("#control-settings-lang"),menuStyle:"min-width: 100%; max-height: 185px;",cls:"input-group-nr",editable:!1,takeFocusOnClose:!0,data:e,search:!0,
scrollAlwaysVisible:!0}),this.cmbLang.setValue(1033),this.cmbLang.on("selected",function(e,i){t.updateFormats(i.value)}),this.listFormats=new Common.UI.ListView({el:$("#control-settings-format"),store:new Common.UI.DataViewStore,scrollAlwaysVisible:!0,tabindex:1}),this.listFormats.on("item:select",_.bind(this.onSelectFormat,this)),this.txtDate=new Common.UI.InputField({el:$("#control-settings-txt-format"),allowBlank:!0,validateOnChange:!1,validateOnBlur:!1,style:"width: 100%;",value:""}),this.btnEditChecked=new Common.UI.Button({el:$("#control-settings-btn-checked-edit"),hint:this.tipChange}),this.btnEditChecked.cmpEl.css({"font-size":"16px","line-height":"16px"}),this.btnEditChecked.on("click",_.bind(this.onEditCheckbox,this,!0)),this.btnEditUnchecked=new Common.UI.Button({el:$("#control-settings-btn-unchecked-edit"),hint:this.tipChange}),this.btnEditUnchecked.cmpEl.css({"font-size":"16px","line-height":"16px"}),this.btnEditUnchecked.on("click",_.bind(this.onEditCheckbox,this,!1)),this.txtGroupKey=new Common.UI.InputField({el:$("#control-settings-txt-groupkey"),allowBlank:!0,validateOnChange:!1,validateOnBlur:!1,style:"width: 100%;",value:""}),this.txtKey=new Common.UI.InputField({el:$("#control-settings-txt-key"),allowBlank:!0,validateOnChange:!1,validateOnBlur:!1,style:"width: 100%;",value:""}),this.txtLabel=new Common.UI.InputField({el:$("#control-settings-txt-label"),allowBlank:!0,validateOnChange:!1,validateOnBlur:!1,style:"width: 100%;",value:""}),this.textareaHelp=this.$window.find("#control-settings-txt-help"),this.textareaHelp.keydown(function(e){e.keyCode==Common.UI.Keys.RETURN&&e.stopPropagation(),t.isHelpChanged=!0}),this.chRequired=new Common.UI.CheckBox({el:$("#control-settings-chb-required"),labelText:this.textRequired}),this.btnEditPlaceholder=new Common.UI.Button({el:$("#control-settings-btn-placeholder-edit"),hint:this.tipChange}),this.btnEditPlaceholder.cmpEl.css({"font-size":"16px","line-height":"16px"}),this.btnEditPlaceholder.on("click",_.bind(this.onEditPlaceholder,this)),this.spnWidth=new Common.UI.MetricSpinner({el:$("#control-settings-spin-width"),step:.1,width:80,defaultUnit:"cm",value:"Auto",allowAuto:!0,maxValue:55.88,minValue:.1}),this.spnMaxChars=new Common.UI.MetricSpinner({el:$("#control-settings-spin-max-chars"),step:1,width:53,defaultUnit:"",value:"10",maxValue:1e6,minValue:1}),this.chMaxChars=new Common.UI.CheckBox({el:$("#control-settings-chb-max-chars"),labelText:this.textMaxChars}),this.chMaxChars.on("change",_.bind(function(t,e,i,n){this.spnMaxChars.setDisabled("checked"!=t.getValue())},this)),this.chComb=new Common.UI.CheckBox({el:$("#control-settings-chb-comb"),labelText:this.textComb}),this.chComb.on("change",_.bind(function(t,e,i,n){var o="checked"==t.getValue();o&&this.chMaxChars.setValue(!0),this.btnEditPlaceholder.setDisabled(!o),this.spnWidth.setDisabled(!o)},this)),this.afterRender()},getFocusedComponents:function(){return[this.txtName,this.txtTag,this.txtPlaceholder,this.cmbShow,this.btnApplyAll,this.chLockDelete,this.chLockEdit,this.list,this.txtDate,this.listFormats,this.cmbLang]},onCategoryClick:function(t,e){Common.Views.AdvancedSettingsWindow.prototype.onCategoryClick.call(this,t,e);var i=this;setTimeout(function(){0==e?i.txtName.focus():1==e?i.chLockDelete.focus():2==e?i.list.focus():3==e&&i.txtDate.focus()},100)},afterRender:function(){if(this.updateMetricUnit(),this._setDefaults(this.props),this.storageName){var t=Common.localStorage.getItem(this.storageName);this.setActiveCategory(null!==t?parseInt(t):0)}},show:function(){Common.Views.AdvancedSettingsWindow.prototype.show.apply(this,arguments)},_setDefaults:function(t){if(t){var e=t.get_Alias();this.txtName.setValue(e||""),e=t.get_Tag(),this.txtTag.setValue(e||""),e=t.get_PlaceholderText(),this.txtPlaceholder.setValue(e||""),e=t.get_Appearance(),null!==e&&void 0!==e&&this.cmbShow.setValue(e),e=t.get_Color(),e?(e=Common.Utils.ThemeColor.getHexColor(e.get_r(),e.get_g(),e.get_b()),this.colors.selectByRGB(e,!0)):(this.colors.clearSelection(),e="auto"),this.btnColor.setAutoColor("auto"==e),this.btnColor.setColor(e),e=t.get_Lock(),void 0===e&&(e=Asc.c_oAscSdtLockType.Unlocked),this.chLockDelete.setValue(e==Asc.c_oAscSdtLockType.SdtContentLocked||e==Asc.c_oAscSdtLockType.SdtLocked),this.chLockEdit.setValue(e==Asc.c_oAscSdtLockType.SdtContentLocked||e==Asc.c_oAscSdtLockType.ContentLocked);var i,n=t.get_SpecificType();if(this.btnsCategory[2].setVisible(n==Asc.c_oAscContentControlSpecificType.ComboBox||n==Asc.c_oAscContentControlSpecificType.DropDownList),n==Asc.c_oAscContentControlSpecificType.ComboBox||n==Asc.c_oAscContentControlSpecificType.DropDownList){if(this.btnsCategory[2].setCaption(n==Asc.c_oAscContentControlSpecificType.ComboBox?this.textCombobox:this.textDropDown),i=n==Asc.c_oAscContentControlSpecificType.ComboBox?t.get_ComboBoxPr():t.get_DropDownListPr()){for(var o=i.get_ItemsCount(),s=[],a=0;a<o;a++)s.push({value:i.get_ItemValue(a),name:i.get_ItemDisplayText(a)});this.list.store.reset(s)}this.disableListButtons()}if(this.btnsCategory[3].setVisible(n==Asc.c_oAscContentControlSpecificType.DateTime),n==Asc.c_oAscContentControlSpecificType.DateTime&&(i=t.get_DateTimePr())){this.datetime=i;var r=i.get_LangId()||this.options.controlLang;if(r){var l=this.cmbLang.store.findWhere({value:r});l=l?l.get("value"):1033,this.cmbLang.setValue(l)}this.updateFormats(this.cmbLang.getValue());var c=i.get_DateFormat(),d=this.listFormats.store.findWhere({format:c});this.listFormats.selectRecord(d),this.listFormats.scrollToRecord(d),this.txtDate.setValue(c)}if(this.btnsCategory[4].setVisible(n==Asc.c_oAscContentControlSpecificType.CheckBox),n==Asc.c_oAscContentControlSpecificType.CheckBox&&(i=t.get_CheckBoxPr())){var h=i.get_CheckedSymbol(),p=i.get_CheckedFont();p&&this.btnEditChecked.cmpEl.css("font-family",p),h&&this.btnEditChecked.setCaption(String.fromCharCode(h)),this.checkedBox={code:h,font:p},h=i.get_UncheckedSymbol(),p=i.get_UncheckedFont(),p&&this.btnEditUnchecked.cmpEl.css("font-family",p),h&&this.btnEditUnchecked.setCaption(String.fromCharCode(h)),this.uncheckedBox={code:h,font:p}}this.type=n;var m=t.get_FormPr();if(this.btnsCategory[6].setVisible(!!m),m){e=m.get_Key(),this.txtKey.setValue(e||""),e=m.get_Label(),this.txtLabel.setValue(e||""),e=m.get_HelpText(),this.textareaHelp.val(e||""),e=m.get_Required(),this.chRequired.setValue(!!e);var u=!0;n==Asc.c_oAscContentControlSpecificType.CheckBox&&i&&(e=i.get_GroupKey(),this.txtGroupKey.setValue(e||""),!(u="string"!=typeof e)&&this.btnsCategory[4].setCaption(this.textRadiobox)),this.$window.find(".group-key").toggleClass("hidden",u)}var g=t.get_TextFormPr();if(this.btnsCategory[5].setVisible(!!g),g){var h=g.get_PlaceHolderSymbol(),p=g.get_PlaceHolderFont();p&&this.btnEditPlaceholder.cmpEl.css("font-family",p),h&&this.btnEditPlaceholder.setCaption(String.fromCharCode(h)),this.placeholder={code:h,font:p},e=g.get_Comb(),this.chComb.setValue(!!e,!0),this.btnEditPlaceholder.setDisabled(!e),this.spnWidth.setDisabled(!e),e=g.get_MaxCharacters(),this.chMaxChars.setValue(e&&e>=0,!0),this.spnMaxChars.setDisabled(!e||e<0),this.spnMaxChars.setValue(e&&e>=0?e:10),e=g.get_Width(),this.spnWidth.setValue(0!==e&&void 0!==e?Common.Utils.Metric.fnRecalcFromMM(25.4*e/20/72):-1,!0)}n!=Asc.c_oAscContentControlSpecificType.CheckBox&&n!=Asc.c_oAscContentControlSpecificType.Picture||m||this.txtPlaceholder.cmpEl&&this.txtPlaceholder.cmpEl.closest("tr").hide()}},getSettings:function(){var t=new AscCommon.CContentControlPr;if(t.put_Alias(this.txtName.getValue()),t.put_Tag(this.txtTag.getValue()),t.put_PlaceholderText(this.txtPlaceholder.getValue()||"    "),t.put_Appearance(this.cmbShow.getValue()),this.btnColor.isAutoColor())t.put_Color(null);else{var e=Common.Utils.ThemeColor.getRgbColor(this.colors.getColor());t.put_Color(e.get_r(),e.get_g(),e.get_b())}var i=Asc.c_oAscSdtLockType.Unlocked;"checked"==this.chLockDelete.getValue()&&"checked"==this.chLockEdit.getValue()?i=Asc.c_oAscSdtLockType.SdtContentLocked:"checked"==this.chLockDelete.getValue()?i=Asc.c_oAscSdtLockType.SdtLocked:"checked"==this.chLockEdit.getValue()&&(i=Asc.c_oAscSdtLockType.ContentLocked),t.put_Lock(i);var n;if(this.type!=Asc.c_oAscContentControlSpecificType.ComboBox&&this.type!=Asc.c_oAscContentControlSpecificType.DropDownList||(n=this.type==Asc.c_oAscContentControlSpecificType.ComboBox?this.props.get_ComboBoxPr():this.props.get_DropDownListPr(),n.clear(),this.list.store.each(function(t,e){n.add_Item(t.get("name"),t.get("value"))}),this.type==Asc.c_oAscContentControlSpecificType.ComboBox?t.put_ComboBoxPr(n):t.put_DropDownListPr(n)),this.type==Asc.c_oAscContentControlSpecificType.DateTime&&(n=this.props.get_DateTimePr(),n.put_DateFormat(this.txtDate.getValue()),n.put_LangId(this.cmbLang.getValue()),t.put_DateTimePr(n)),this.type==Asc.c_oAscContentControlSpecificType.CheckBox&&(this.checkedBox&&this.checkedBox.changed||this.uncheckedBox&&this.uncheckedBox.changed)&&(n=this.props.get_CheckBoxPr(),this.checkedBox&&(n.put_CheckedSymbol(this.checkedBox.code),n.put_CheckedFont(this.checkedBox.font)),this.uncheckedBox&&(n.put_UncheckedSymbol(this.uncheckedBox.code),n.put_UncheckedFont(this.uncheckedBox.font)),t.put_CheckBoxPr(n)),this.btnsCategory[6].isVisible()){var o=new AscCommon.CSdtFormPr;o.put_Key(this.txtKey.getValue()),o.put_Label(this.txtLabel.getValue()),o.put_Required("checked"==this.chRequired.getValue()),this.isHelpChanged&&o.put_HelpText(this.textareaHelp.val()),this.type!=Asc.c_oAscContentControlSpecificType.CheckBox||this.$window.find(".group-key").hasClass("hidden")||(n=this.props.get_CheckBoxPr())&&(n.put_GroupKey(this.txtGroupKey.getValue()),t.put_CheckBoxPr(n)),t.put_FormPr(o)}if(this.btnsCategory[5].isVisible()){var s=new AscCommon.CSdtTextFormPr;if(this.spnWidth.getValue()){var a=this.spnWidth.getNumberValue();s.put_Width(a<=0?0:parseInt(72*Common.Utils.Metric.fnRecalcToMM(a)*20/25.4))}else s.put_Width(0);this.placeholder&&this.placeholder.changed&&(s.put_PlaceHolderSymbol(this.placeholder.code),s.put_PlaceHolderFont(this.placeholder.font)),s.put_Comb("checked"==this.chComb.getValue());var r="checked"==this.chMaxChars.getValue()||"checked"==this.chComb.getValue();s.put_MaxCharacters(r),r&&s.put_MaxCharacters(this.spnMaxChars.getNumberValue()||10),t.put_TextFormPr(s)}return t},onDlgBtnClick:function(t){var e="object"==typeof t?t.currentTarget.attributes.result.value:t;"ok"==e&&this.handler&&this.handler.call(this,e,this.getSettings()),this.close()},applyAllClick:function(t,e){if(this.api){var i=new AscCommon.CContentControlPr;if(i.put_Appearance(this.cmbShow.getValue()),this.btnColor.isAutoColor())i.put_Color(null);else{var n=Common.Utils.ThemeColor.getRgbColor(this.colors.getColor());i.put_Color(n.get_r(),n.get_g(),n.get_b())}this.api.asc_SetContentControlProperties(i,null,!0)}},onSelectItem:function(t,e,i){this.disableListButtons(!1)},disableListButtons:function(t){void 0===t&&(t=!this.list.getSelectedRec()),this.btnChange.setDisabled(t),this.btnDelete.setDisabled(t),this.btnUp.setDisabled(t),this.btnDown.setDisabled(t)},onAddItem:function(){var t=this;new DE.Views.EditListItemDialog({store:t.list.store,handler:function(e,i,n){if("ok"==e){var o=t.list.store.add({value:n,name:i});o&&(t.list.selectRecord(o),t.list.scrollToRecord(o),t.disableListButtons())}t.list.focus()}}).show()},onChangeItem:function(){var t=this,e=this.list.getSelectedRec(),i=new DE.Views.EditListItemDialog({store:t.list.store,handler:function(i,n,o){"ok"==i&&e&&e.set({value:o,name:n}),t.list.focus()}});e&&i.show(),e&&i.setSettings({name:e.get("name"),value:e.get("value")})},onDeleteItem:function(t,e){var i=this.list.getSelectedRec();if(i){var n=this.list.store,o=_.indexOf(n.models,i);n.remove(i),o>n.length-1&&(o=n.length-1),n.length>0&&(this.list.selectByIndex(o),this.list.scrollToRecord(n.at(o)))}this.disableListButtons(),this.list.focus()},onMoveItem:function(t){var e=this.list.store,i=e.length,n=this.list.getSelectedRec();if(n){var o=e.indexOf(n);e.add(e.remove(n),{at:t?Math.max(0,o-1):Math.min(i-1,o+1)}),this.list.selectRecord(n),this.list.scrollToRecord(n)}this.list.focus()},updateFormats:function(t){if(this.datetime){for(var e=this.datetime,i=e.get_FormatsExamples(),n=[],o=0,s=i.length;o<s;o++){e.get_String(i[o],void 0,t);var a=new Common.UI.DataViewModel;a.set({format:i[o],value:e.get_String(i[o],void 0,t)}),n.push(a)}this.listFormats.store.reset(n),this.listFormats.selectByIndex(0);var a=this.listFormats.getSelectedRec();this.listFormats.scrollToRecord(a),this.txtDate.setValue(a.get("format"))}},onEditCheckbox:function(t){if(this.api){var e=this,i=t?e.checkedBox:e.uncheckedBox,n=t?e.btnEditChecked:e.btnEditUnchecked,o=function(t,e,o){"ok"==e&&(i.changed=!0,i.code=o.code,i.font=o.font,i.font&&n.cmpEl.css("font-family",i.font),o.symbol&&n.setCaption(o.symbol))},s=new Common.Views.SymbolTableDialog({api:e.api,lang:e.options.interfaceLang,modal:!0,type:0,font:i.font,code:i.code,handler:o});s.show(),s.on("symbol:dblclick",o)}},onEditPlaceholder:function(){if(this.api){var t=this,e=t.placeholder,i=t.btnEditPlaceholder,n=function(t,n,o){"ok"==n&&(e.changed=!0,e.code=o.code,e.font=o.font,e.font&&i.cmpEl.css("font-family",e.font),o.symbol&&i.setCaption(o.symbol))},o=new Common.Views.SymbolTableDialog({api:t.api,lang:t.options.interfaceLang,modal:!0,type:0,font:e.font,code:e.code,handler:n});o.show(),o.on("symbol:dblclick",n)}},onSelectFormat:function(t,e,i){i&&this.txtDate.setValue(i.get("format"))},updateMetricUnit:function(){this.spnWidth.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),this.spnWidth.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)},textTitle:"Content Control Settings",textName:"Title",textTag:"Tag",txtLockDelete:"Content control cannot be deleted",txtLockEdit:"Contents cannot be edited",textLock:"Locking",textShowAs:"Show as",textColor:"Color",textBox:"Bounding box",textNone:"None",textApplyAll:"Apply to All",textAppearance:"Appearance",textSystemColor:"System",strGeneral:"General",textAdd:"Add",textChange:"Edit",textDelete:"Delete",textUp:"Up",textDown:"Down",textCombobox:"Combo box",textDropDown:"Drop-down list",textDisplayName:"Display name",textValue:"Value",textDate:"Date format",textLang:"Language",textFormat:"Display the date like this",textCheckbox:"Check box",textChecked:"Checked symbol",textUnchecked:"Unchecked symbol",tipChange:"Change symbol",textPlaceholder:"Placeholder",textAdditional:"Additional",textField:"Text field",textKey:"Key",textLabel:"Label",textHelp:"Help text",textRequired:"Required",textGroupKey:"Group key",textRadiobox:"Radio box",textWidth:"Width",textPlaceholderSymbol:"Placeholder symbol",textMaxChars:"Characters limit",textComb:"Comb of characters"},DE.Views.ControlSettingsDialog||{}))}),define("documenteditor/main/app/view/NumberingValueDialog",["common/main/lib/component/Window","common/main/lib/component/MetricSpinner"],function(){"use strict";DE.Views.NumberingValueDialog=Common.UI.Window.extend(_.extend({options:{width:214,header:!0,style:"min-width: 214px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box">','<div class="input-row">','<div id="id-spin-set-value"></div>',"</div>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.props=this.options.props,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.spnStart=new Common.UI.CustomSpinner({el:$("#id-spin-set-value"),step:1,width:182,defaultUnit:"",value:1,maxValue:16383,minValue:0,allowDecimal:!1,maskExp:/[0-9]/}),this.getChild().find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.spnStart.on("entervalue",_.bind(this.onPrimary,this)),this.spnStart.$el.find("input").focus(),this.afterRender()},afterRender:function(){this._setDefaults(this.props)},_setDefaults:function(t){t&&(this.spnStart.setValue(t.start),this.onFormatSelect(t.format))},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,t,this.getSettings()),this.close()},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},getSettings:function(){return this.spnStart.getNumberValue()},onPrimary:function(){return this._handleInput("ok"),!1},onFormatSelect:function(t){var e=/[0-9]/,i=this;switch(t){case Asc.c_oAscNumberingFormat.UpperRoman:this.spnStart.options.toCustomFormat=this._10toRome,this.spnStart.options.fromCustomFormat=this._Rometo10,e=/[IVXLCDM]/;break;case Asc.c_oAscNumberingFormat.LowerRoman:this.spnStart.options.toCustomFormat=function(t){return i._10toRome(t).toLocaleLowerCase()},this.spnStart.options.fromCustomFormat=function(t){return i._Rometo10(t.toLocaleUpperCase())},e=/[ivxlcdm]/;break;case Asc.c_oAscNumberingFormat.UpperLetter:this.spnStart.options.toCustomFormat=this._10toS,this.spnStart.options.fromCustomFormat=this._Sto10,e=/[A-Z]/;break;case Asc.c_oAscNumberingFormat.LowerLetter:this.spnStart.options.toCustomFormat=function(t){return i._10toS(t).toLocaleLowerCase()},this.spnStart.options.fromCustomFormat=function(t){return i._Sto10(t.toLocaleUpperCase())},e=/[a-z]/;break;default:this.spnStart.options.toCustomFormat=function(t){return t},this.spnStart.options.fromCustomFormat=function(t){return t}}this.spnStart.setMask(e),this.spnStart.setValue(this.spnStart.getValue())},_10toS:function(t){t=parseInt(t);for(var e=Math.ceil(t/26),i=String.fromCharCode((t-1)%26+"A".charCodeAt(0)),n="",o=0;o<e;o++)n+=i;return n},_Sto10:function(t){if(t.length<1||new RegExp("[^"+t.charAt(0)+"]").test(t)||!/[A-Z]/.test(t))return 1;var e=t.length-1,i=t.charCodeAt(0)-"A".charCodeAt(0)+1;return i+=26*e},_10toRome:function(t){t=parseInt(t);for(var e="",i=[["M",1e3],["CM",900],["D",500],["CD",400],["C",100],["XC",90],["L",50],["XL",40],["X",10],["IX",9],["V",5],["IV",4],["I",1]],n=i[0][1],o=Math.floor(t/n),s=0,a=0;a<o;a++)e+=i[s][0];for(t-=o*n,s++;t>0;)n=i[s][1],o=t-n,o>=0?(e+=i[s][0],t=o):s++;return e},_Rometo10:function(t){if(!/[IVXLCDM]/.test(t)||t.length<1)return 1;for(var e={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3},i=t.length-1,n=e[t.charAt(i)],o=n,s=i-1;s>=0;s--){var a=e[t.charAt(s)];if(a<o){if(o/a>10)return 1;a*=-1}n+=a,o=Math.abs(a)}return n}},DE.Views.NumberingValueDialog||{}))}),define("documenteditor/main/app/view/CellsAddDialog",["common/main/lib/component/Window","common/main/lib/component/ComboBox","common/main/lib/component/MetricSpinner","common/main/lib/component/RadioBox"],function(){"use strict";DE.Views.CellsAddDialog=Common.UI.Window.extend(_.extend({options:{width:214,header:!0,style:"min-width: 214px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box">','<div style="margin-bottom: 10px;">','<div id="table-combo-row-col" class="input-group-nr" style="display: inline-block; margin-right: 5px;"></div>','<div id="table-spin-row-col" style="display: inline-block;"></div>',"</div>",'<div id="table-radio-before" style="padding-bottom: 8px;"></div>','<div id="table-radio-after" style="padding-bottom: 8px;"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.cmbRowCol=new Common.UI.ComboBox({el:$("#table-combo-row-col"),cls:"input-group-nr",style:"width: 110px;",menuStyle:"min-width: 110px;",editable:!1,takeFocusOnClose:!0,scrollAlwaysVisible:!0,data:[{value:0,displayValue:this.textRow},{value:1,displayValue:this.textCol}]}),this.cmbRowCol.setValue(0),this.cmbRowCol.on("selected",_.bind(function(t,e){var i=0==e.value;this.spnCount.setMaxValue(i?100:64),this.spnCount.setValue(this.spnCount.getNumberValue()),this.radioBefore.setCaption(i?this.textUp:this.textLeft),this.radioAfter.setCaption(i?this.textDown:this.textRight)},this)),this.spnCount=new Common.UI.MetricSpinner({el:$("#table-spin-row-col"),step:1,width:65,value:1,defaultUnit:"",maxValue:100,minValue:1,allowDecimal:!1}),this.radioBefore=new Common.UI.RadioBox({el:$("#table-radio-before"),labelText:this.textUp,name:"asc-radio-table-cells-add",checked:!0}),this.radioAfter=new Common.UI.RadioBox({el:$("#table-radio-after"),labelText:this.textDown,name:"asc-radio-table-cells-add"}),this.getChild().find(".dlg-btn").on("click",_.bind(this.onBtnClick,this))},getFocusedComponents:function(){return[this.cmbRowCol,this.spnCount,this.radioBefore,this.radioAfter]},getDefaultFocusableComponent:function(){return this.spnCount},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,t,this.getSettings()),this.close()},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},getSettings:function(){return{row:0==this.cmbRowCol.getValue(),before:this.radioBefore.getValue(),count:this.spnCount.getNumberValue()}},onPrimary:function(){return this._handleInput("ok"),!1},textTitle:"Insert Several",textLeft:"To the left",textRight:"To the right",textUp:"Above the cursor",textDown:"Below the cursor",textRow:"Rows",textCol:"Columns"},DE.Views.CellsAddDialog||{}))}),define("documenteditor/main/app/view/DocumentHolder",["jquery","underscore","backbone","gateway","common/main/lib/util/utils","common/main/lib/component/Menu","common/main/lib/component/Calendar","common/main/lib/view/InsertTableDialog","common/main/lib/view/CopyWarningDialog","common/main/lib/view/OptionsDialog","documenteditor/main/app/view/DropcapSettingsAdvanced","documenteditor/main/app/view/HyperlinkSettingsDialog","documenteditor/main/app/view/ParagraphSettingsAdvanced","documenteditor/main/app/view/TableSettingsAdvanced","documenteditor/main/app/view/ControlSettingsDialog","documenteditor/main/app/view/NumberingValueDialog","documenteditor/main/app/view/CellsAddDialog"],function(t,e,i,n){"use strict";DE.Views.DocumentHolder=i.View.extend(e.extend({el:"#editor_sdk",template:null,events:{},initialize:function(){var i=this,n=DE.getCollection("Common.Collections.Users");i._TtHeight=20,i._currentSpellObj=void 0,i._currLang={},i.usertips=[],i.fastcoauthtips=[],i._currentMathObj=void 0,i._currentParaObjDisabled=!1,i._isDisabled=!1,i._state={};var o=function(n,o,s,a,r){if(!e.isUndefined(n)&&null!==n){Common.UI.Menu.Manager.hideAll();var l=[s.get_X(),s.get_Y()],c=t(i.el).find(Common.Utils.String.format("#menu-container-{0}",n.id));n.rendered||(c.length<1&&(c=t(Common.Utils.String.format('<div id="menu-container-{0}" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',n.id)),t(i.el).append(c)),n.render(c),n.cmpEl.attr({tabindex:"-1"})),c.css({left:l[0],top:l[1]}),n.show(),e.isFunction(n.options.initMenu)&&(n.options.initMenu(o),n.alignPosition()),e.delay(function(){n.cmpEl.focus()},10),i.currentMenu=n}},s=function(t){if(t&&e.isArray(t)){for(var n={},o=i.textMenu,s=!0,a=0;a<t.length;a++){var r=t[a].get_ObjectType(),l=t[a].get_ObjectValue();if(Asc.c_oAscTypeSelectElement.Image==r){o=i.pictureMenu,void 0===n.imgProps&&(n.imgProps={});var c=l.get_ShapeProperties(),d=l.get_ChartProperties();if(c?c.get_FromChart()?n.imgProps.isChart=!0:c.get_FromImage()?n.imgProps.isOnlyImg=!0:n.imgProps.isShape=!0:d?n.imgProps.isChart=!0:n.imgProps.isImg=!0,n.imgProps.value=l,n.imgProps.locked=!!l&&l.get_Locked(),s=!1,!(void 0!==c&&null!==c||void 0!==d&&null!==d))break}else Asc.c_oAscTypeSelectElement.Table==r?(o=i.tableMenu,n.tableProps={},n.tableProps.value=l,n.tableProps.locked=!!l&&l.get_Locked(),s=!1):Asc.c_oAscTypeSelectElement.Paragraph==r?(n.paraProps={},n.paraProps.value=l,n.paraProps.locked=!!l&&l.get_Locked(),n.imgProps&&(n.imgProps.isChart||n.imgProps.isShape)&&void 0===n.tableProps&&(o=i.textMenu),s=!1):Asc.c_oAscTypeSelectElement.Hyperlink==r?(n.hyperProps?n.hyperProps.isSeveralLinks=!0:n.hyperProps={},n.hyperProps.value=l):Asc.c_oAscTypeSelectElement.Header==r?(n.headerProps={},n.headerProps.locked=!!l&&l.get_Locked()):Asc.c_oAscTypeSelectElement.SpellCheck==r?(n.spellProps={},n.spellProps.value=l,i._currentSpellObj=l):Asc.c_oAscTypeSelectElement.Math==r&&(n.mathProps={},n.mathProps.value=l,i._currentMathObj=l)}return s?null:{menu_to_show:o,menu_props:n}}},a=function(t){if(t&&e.isArray(t)){i.viewModeMenu||i.createDelayedElementsViewer();for(var n={},o=i.viewModeMenu,s=!0,a=0;a<t.length;a++){var r=t[a].get_ObjectType(),l=t[a].get_ObjectValue();Asc.c_oAscTypeSelectElement.Image==r?(n.imgProps={},n.imgProps.value=l,s=!1):Asc.c_oAscTypeSelectElement.Paragraph==r&&(n.paraProps={},n.paraProps.value=l,n.paraProps.locked=!!l&&l.get_Locked(),s=!1)}return s?null:{menu_to_show:o,menu_props:n}}},r=function(t,e,n){if(i.api){var r=i.mode.isEdit&&!i._isDisabled?s(i.api.getSelectedElements()):a(i.api.getSelectedElements());r&&o(r.menu_to_show,r.menu_props,t)}},l=function(t){e.delay(function(){0==t.get_Type()?r.call(i,t):o.call(i,i.hdrMenu,{Header:t.is_Header(),PageNum:t.get_PageNum()},t)},10)},c=function(t){if(i.currentMenu&&i.currentMenu.isVisible()&&i.currentMenu!==i.hdrMenu){var e=i.mode.isEdit&&!i._isDisabled?s(t):a(t);e&&e.menu_to_show===i.currentMenu&&(i.currentMenu.options.initMenu(e.menu_props),i.currentMenu.alignPosition())}},d=function(t){if(i.api){var n=e.isUndefined(t.originalEvent)?t.wheelDelta:t.originalEvent.wheelDelta;e.isUndefined(n)&&(n=t.deltaY),!t.ctrlKey&&!t.metaKey||t.altKey||(n<0?i.api.zoomOut():n>0&&i.api.zoomIn(),t.preventDefault(),t.stopPropagation())}},h=function(e){if(i.api){var n=e.keyCode;if((e.ctrlKey||e.metaKey)&&!e.shiftKey&&!e.altKey){if(n===Common.UI.Keys.NUM_PLUS||n===Common.UI.Keys.EQUALITY||Common.Utils.isGecko&&n===Common.UI.Keys.EQUALITY_FF||Common.Utils.isOpera&&43==n)return i.api.zoomIn(),e.preventDefault(),e.stopPropagation(),!1;if(n===Common.UI.Keys.NUM_MINUS||n===Common.UI.Keys.MINUS||Common.Utils.isGecko&&n===Common.UI.Keys.MINUS_FF||Common.Utils.isOpera&&45==n)return i.api.zoomOut(),e.preventDefault(),e.stopPropagation(),!1;if(48===n||96===n)return i.api.zoom(100),e.preventDefault(),e.stopPropagation(),!1}i.currentMenu&&i.currentMenu.isVisible()&&(n!=Common.UI.Keys.UP&&n!=Common.UI.Keys.DOWN||t("ul.dropdown-menu",i.currentMenu.el).focus()),n==Common.UI.Keys.ESC&&(Common.UI.Menu.Manager.hideAll(),Common.NotificationCenter.trigger("leftmenu:change","hide"))}},p=function(e){i._XY=[i.cmpEl.offset().left-t(window).scrollLeft(),i.cmpEl.offset().top-t(window).scrollTop()],i._Height=i.cmpEl.height(),i._BodyWidth=t("body").width()},m=function(e){var n=i.cmpEl;if(n){n.on("contextmenu",function(t){return t.preventDefault(),t.stopPropagation(),!1}),n.on("click",function(t){"canvas"==t.target.localName&&(i._preventClick?i._preventClick=!1:n.focus())}),n.on("mousedown",function(t){"canvas"==t.target.localName&&Common.UI.Menu.Manager.hideAll()});var o=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";!function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)}(i.el,o,d)}t(document).on("mousewheel",d),t(document).on("keydown",h),t(window).on("resize",p),DE.getController("Viewport").getView("Viewport").hlayout.on("layout:resizedrag",p)},u=function(t){if(n){var e=n.findUser(t);if(e)return AscCommon.UserInfoParser.getParsedName(e.get("username"));if("string"==typeof t){var o,s=t.slice(0,-1);if(n.models.some(function(t){if(t.attributes&&t.attributes.idOriginal===s)return o=t,!0}),o&&o.attributes.username)return o.attributes.username}}return i.guestText},g={toolTip:new Common.UI.Tooltip({owner:this,html:!0,title:"<br><b>Press Ctrl and click link</b>",cls:"link-tooltip"}),strTip:"",isHidden:!0,isVisible:!1},b=!0,f=function(t,e,n){!0===b&&(b=new Common.UI.Tooltip({owner:t.currentTarget,title:i.tipIsLocked}),b.show())},C=function(){if("object"==typeof b){b.hide(),b=void 0;for(var t=0;t<i.usertips.length;t++)i.usertips[t].off("mouseover",f),i.usertips[t].off("mouseout",v)}},v=function(t,e,i){"object"==typeof b&&b.$element&&t.currentTarget===b.$element[0]&&C()};Common.NotificationCenter.on({"window:show":function(t){g.toolTip.hide(),g.isVisible=!1,C(),i.mode&&i.mode.isDesktopApp&&i.api&&i.api.asc_onShowPopupWindow()},"modal:show":function(t){i.hideTips()},"layout:changed":function(t){g.toolTip.hide(),g.isVisible=!1,C(),i.hideTips(),p()}});var _=function(t){t&&window.open(t)},y=function(){g.isHidden=!0,i.usertips.length>0&&("object"==typeof b&&(b.hide(),b=!0),e.each(i.usertips,function(t){t.remove()})),i.usertips=[],i.usertipcount=0},x=null,w=!1,S=function(){g.isHidden&&g.isVisible&&(g.isVisible=!1,w=!0,g.toolTip.hide(function(){w=!1,x&&A(x),x=null}))},A=function(n){if(void 0===i._XY&&(i._XY=[i.cmpEl.offset().left-t(window).scrollLeft(),i.cmpEl.offset().top-t(window).scrollTop()],i._Height=i.cmpEl.height(),i._BodyWidth=t("body").width()),n){var o,s,a=n.get_Type();if(a==Asc.c_oAscMouseMoveDataTypes.Hyperlink||a==Asc.c_oAscMouseMoveDataTypes.Footnote||a==Asc.c_oAscMouseMoveDataTypes.Form||a==Asc.c_oAscMouseMoveDataTypes.Review&&i.mode.reviewHoverMode){if(w)return void(x=n);if(a==Asc.c_oAscMouseMoveDataTypes.Hyperlink){var r=n.get_Hyperlink();if(!r)return;s=e.isEmpty(r.get_ToolTip())?r.get_Value():r.get_ToolTip(),s.length>256&&(s=s.substr(0,256)+"...")}else if(a==Asc.c_oAscMouseMoveDataTypes.Footnote)s=n.get_FootnoteText(),s.length>1e3&&(s=s.substr(0,1e3)+"...");else if(a==Asc.c_oAscMouseMoveDataTypes.Form)s=n.get_FormHelpText(),s.length>1e3&&(s=s.substr(0,1e3)+"...");else if(a==Asc.c_oAscMouseMoveDataTypes.Review&&n.get_ReviewChange()){var l=DE.getController("Common.Controllers.ReviewChanges").readSDKChange([n.get_ReviewChange()]);l&&l.length>0&&(l=l[0]),l&&(s="<b>"+Common.Utils.String.htmlEncode(AscCommon.UserInfoParser.getParsedName(l.get("username")))+"  </b>",s+='<span style="font-size:10px; opacity: 0.7;">'+l.get("date")+"</span><br>",s+=l.get("changetext"))}var c=!1;g.isHidden=!1,a!==Asc.c_oAscMouseMoveDataTypes.Review&&(s=Common.Utils.String.htmlEncode(s)),(g.tipType!==a||g.tipLength!==s.length||g.strTip.indexOf(s)<0)&&(g.toolTip.setTitle(a==Asc.c_oAscMouseMoveDataTypes.Hyperlink?s+"<br><b>"+i.txtPressLink+"</b>":s),g.tipLength=s.length,g.strTip=s,g.tipType=a,c=!0),o=[n.get_X(),n.get_Y()],o[1]+=i._XY[1]-15,o[0]+=i._XY[0]+5,g.isVisible&&!c||(g.isVisible=!0,g.toolTip.show([-1e4,-1e4])),c&&(g.tipHeight=g.toolTip.getBSTip().$tip.height(),g.tipWidth=g.toolTip.getBSTip().$tip.width()),c=!1,o[0]+g.tipWidth>i._BodyWidth&&(o[0]=i._BodyWidth-g.tipWidth,c=!0),o[1]-g.tipHeight<0?o[1]=c?o[1]+30:0:o[1]-=g.tipHeight,g.toolTip.getBSTip().$tip.css({top:o[1]+"px",left:o[0]+"px"})}else if(n.get_Type()==Asc.c_oAscMouseMoveDataTypes.LockedObject&&i.mode.isEdit){var d;i.usertipcount>=i.usertips.length&&(d=t(document.createElement("div")),d.addClass("username-tip"),d.css({height:i._TtHeight+"px",position:"absolute",zIndex:"900",visibility:"visible"}),t(document.body).append(d),b&&(d.on("mouseover",f),d.on("mouseout",v)),i.usertips.push(d)),d=i.usertips[i.usertipcount],i.usertipcount++,s=u(n.get_UserId()),o=[n.get_X()+i._XY[0],n.get_Y()+i._XY[1]];var h=o[0];o[0]=i._BodyWidth-o[0],o[1]-=2==n.get_LockedObjectType()?i._TtHeight:0,o[1]>i._XY[1]&&o[1]+i._TtHeight<i._XY[1]+i._Height?(d.text(s),d.css({visibility:"visible",top:o[1]+"px",right:o[0]+"px","max-width":h+"px"})):d.css({visibility:"hidden"})}}},k=function(e,n,o,s){for(var a,r=0;r<i.fastcoauthtips.length;r++)if(i.fastcoauthtips[r].attr("userid")==e){a=i.fastcoauthtips[r];break}a||(a=t(document.createElement("div")),a.addClass("username-tip"),a.attr("userid",e),a.css({height:i._TtHeight+"px",position:"absolute",zIndex:"900",display:"none","pointer-events":"none","background-color":"#"+Common.Utils.ThemeColor.getHexColor(s.get_r(),s.get_g(),s.get_b())}),a.text(u(e)),t("#id_main_view").append(a),i.fastcoauthtips.push(a),a.fadeIn(150)),a.css({top:o-i._TtHeight+"px",left:n+"px"})},T=function(t){for(var e=0;e<i.fastcoauthtips.length;e++)if(i.fastcoauthtips[e].attr("userid")==t){var n=i.fastcoauthtips[e];i.fastcoauthtips[e].fadeOut(150,function(){n.remove()}),i.fastcoauthtips.splice(e,1);break}
},I=function(n){var o=n.asc_getCellCoord(),s=i.cmpEl.find("#special-paste-container"),a=n.asc_getOptions();if(a){if(s.length<1&&(i._arrSpecialPaste=[],i._arrSpecialPaste[Asc.c_oSpecialPasteProps.paste]=i.textPaste,i._arrSpecialPaste[Asc.c_oSpecialPasteProps.sourceformatting]=i.txtPasteSourceFormat,i._arrSpecialPaste[Asc.c_oSpecialPasteProps.keepTextOnly]=i.txtKeepTextOnly,i._arrSpecialPaste[Asc.c_oSpecialPasteProps.insertAsNestedTable]=i.textNest,i._arrSpecialPaste[Asc.c_oSpecialPasteProps.overwriteCells]=i.txtOverwriteCells,s=t('<div id="special-paste-container" style="position: absolute;"><div id="id-document-holder-btn-special-paste"></div></div>'),i.cmpEl.append(s),i.btnSpecialPaste=new Common.UI.Button({parentEl:t("#id-document-holder-btn-special-paste"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-paste",menu:new Common.UI.Menu({items:[]})})),a.length>0){for(var r=i.btnSpecialPaste.menu,l=0;l<r.items.length;l++)r.removeItem(r.items[l]),l--;e.each(a,function(t,e){var n=new Common.UI.MenuItem({caption:i._arrSpecialPaste[t],value:t,checkable:!0,toggleGroup:"specialPasteGroup"}).on("click",function(t,e){i.api.asc_SpecialPaste(t.value),setTimeout(function(){r.hide()},100)});r.addItem(n)}),r.items.length>0&&r.items[0].setChecked(!0,!0)}if(o.asc_getX()<0||o.asc_getY()<0)s.is(":visible")&&s.hide();else{var c=[o.asc_getX()+o.asc_getWidth()+3,o.asc_getY()+o.asc_getHeight()+3];s.css({left:c[0],top:c[1]}),s.show()}}},P=function(){var t=i.cmpEl.find("#special-paste-container");t.is(":visible")&&t.hide()},M=function(){var t,n,o;if(i.api&&i.mode.isEdit&&!i._isDisabled&&!DE.getController("LeftMenu").leftMenu.menuFile.isVisible()){var s=function(t,e){"ok"==e&&(n=t.getSettings(),!1!==o?i.api.add_Hyperlink(n):i.api.change_Hyperlink(n)),i.fireEvent("editcomplete",i)};if(!1!==(o=i.api.can_AddHyperlink()))t=new DE.Views.HyperlinkSettingsDialog({api:i.api,handler:s}),n=new Asc.CHyperlinkProperty,n.put_Text(o),t.show(),t.setSettings(n);else{var a=i.api.getSelectedElements();a&&e.isArray(a)&&e.each(a,function(t,e){a[e].get_ObjectType()==Asc.c_oAscTypeSelectElement.Hyperlink&&(n=a[e].get_ObjectValue())}),n&&(t=new DE.Views.HyperlinkSettingsDialog({api:i.api,handler:s}),t.show(),t.setSettings(n))}Common.component.Analytics.trackEvent("DocumentHolder","Add Hyperlink")}},U=function(t){if(i.mode.isEdit&&!i._isDisabled){var e=DE.getController("Common.Controllers.ExternalDiagramEditor").getView("Common.Views.ExternalDiagramEditor");e&&t&&(e.setEditMode(!0),e.show(),e.setChartData(new Asc.asc_CChartBinary(t)))}},B=function(){i.mode.isEdit=!1},D=function(t){i._currLang.id=t};this.changeLanguageMenu=function(t){if(null===i._currLang.id||void 0===i._currLang.id)t.clearAll();else{var n=e.findIndex(t.items,{langid:i._currLang.id});n>-1&&!t.items[n].checked&&t.setChecked(n,!0)}};var E=function(){var t,n=i.api.getSelectedElements(!0);if(n&&e.isArray(n))for(var o=0;o<n.length;o++)if(n[o].get_ObjectType()==Asc.c_oAscTypeSelectElement.SpellCheck){t=n[o].get_ObjectValue(),i._currentSpellObj=t;break}t&&!1===t.get_Checked()&&null!==t.get_Variants()&&void 0!==t.get_Variants()&&(i.addWordVariants(),i.textMenu&&i.textMenu.isVisible()&&i.textMenu.alignPosition())};this.addWordVariants=function(t){if(i.textMenu&&(i.textMenu.isVisible()||i.tableMenu.isVisible())){e.isUndefined(t)&&(t=i.textMenu.isVisible()),i.clearWordVariants(t);var n=t?i.menuSpellMorePara:i.menuSpellMoreTable,o=t?i.menuSpellPara:i.menuSpellTable,s=[],a=[],r=i._currentSpellObj.get_Variants();r.length>0?(n.setVisible(r.length>3),n.setDisabled(i._currentParaObjDisabled),e.each(r,function(t,e){var n=new Common.UI.MenuItem({caption:t,spellword:!0,disabled:i._currentParaObjDisabled}).on("click",function(t,e){i.api&&(i.api.asc_replaceMisspelledWord(t.caption,i._currentSpellObj),i.fireEvent("editcomplete",i))});e<3?s.push(n):a.push(n)}),s.length>0&&(t?e.each(s,function(t,e){i.textMenu.insertItem(e,t)}):e.each(s,function(t,e){i.menuSpellCheckTable.menu.insertItem(e,t)})),a.length>0&&e.each(a,function(t,e){n.menu.addItem(t)}),o.setVisible(!1)):(n.setVisible(!1),o.setVisible(!0),o.setCaption(i.noSpellVariantsText,!0))}},this.clearWordVariants=function(t){for(var e=t?i.textMenu:i.menuSpellCheckTable.menu,n=0;n<e.items.length;n++)e.items[n].options.spellword&&(e.checkeditem==e.items[n]&&(e.checkeditem=void 0,e.activeItem=void 0),e.removeItem(e.items[n]),n--);t?i.menuSpellMorePara.menu.removeAll():i.menuSpellMoreTable.menu.removeAll(),i.menuSpellMorePara.menu.checkeditem=void 0,i.menuSpellMorePara.menu.activeItem=void 0,i.menuSpellMoreTable.menu.checkeditem=void 0,i.menuSpellMoreTable.menu.activeItem=void 0},this.initEquationMenu=function(){if(i._currentMathObj){var t,e=i._currentMathObj.get_Type(),n=i._currentMathObj,o=[];switch(e){case Asc.c_oAscMathInterfaceType.Accent:t=new Common.UI.MenuItem({caption:i.txtRemoveAccentChar,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"remove_AccentCharacter"}}),o.push(t);break;case Asc.c_oAscMathInterfaceType.BorderBox:t=new Common.UI.MenuItem({caption:i.txtBorderProps,equation:!0,disabled:i._currentParaObjDisabled,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:n.get_HideTop()?i.txtAddTop:i.txtHideTop,equationProps:{type:e,callback:"put_HideTop",value:!n.get_HideTop()}},{caption:n.get_HideBottom()?i.txtAddBottom:i.txtHideBottom,equationProps:{type:e,callback:"put_HideBottom",value:!n.get_HideBottom()}},{caption:n.get_HideLeft()?i.txtAddLeft:i.txtHideLeft,equationProps:{type:e,callback:"put_HideLeft",value:!n.get_HideLeft()}},{caption:n.get_HideRight()?i.txtAddRight:i.txtHideRight,equationProps:{type:e,callback:"put_HideRight",value:!n.get_HideRight()}},{caption:n.get_HideHor()?i.txtAddHor:i.txtHideHor,equationProps:{type:e,callback:"put_HideHor",value:!n.get_HideHor()}},{caption:n.get_HideVer()?i.txtAddVer:i.txtHideVer,equationProps:{type:e,callback:"put_HideVer",value:!n.get_HideVer()}},{caption:n.get_HideTopLTR()?i.txtAddLT:i.txtHideLT,equationProps:{type:e,callback:"put_HideTopLTR",value:!n.get_HideTopLTR()}},{caption:n.get_HideTopRTL()?i.txtAddLB:i.txtHideLB,equationProps:{type:e,callback:"put_HideTopRTL",value:!n.get_HideTopRTL()}}]})}),o.push(t);break;case Asc.c_oAscMathInterfaceType.Bar:t=new Common.UI.MenuItem({caption:i.txtRemoveBar,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"remove_Bar"}}),o.push(t),t=new Common.UI.MenuItem({caption:n.get_Pos()==Asc.c_oAscMathInterfaceBarPos.Top?i.txtUnderbar:i.txtOverbar,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_Pos",value:n.get_Pos()==Asc.c_oAscMathInterfaceBarPos.Top?Asc.c_oAscMathInterfaceBarPos.Bottom:Asc.c_oAscMathInterfaceBarPos.Top}}),o.push(t);break;case Asc.c_oAscMathInterfaceType.Script:var s=n.get_ScriptType();s==Asc.c_oAscMathInterfaceScript.PreSubSup?(t=new Common.UI.MenuItem({caption:i.txtScriptsAfter,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_ScriptType",value:Asc.c_oAscMathInterfaceScript.SubSup}}),o.push(t),t=new Common.UI.MenuItem({caption:i.txtRemScripts,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_ScriptType",value:Asc.c_oAscMathInterfaceScript.None}}),o.push(t)):(s==Asc.c_oAscMathInterfaceScript.SubSup&&(t=new Common.UI.MenuItem({caption:i.txtScriptsBefore,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_ScriptType",value:Asc.c_oAscMathInterfaceScript.PreSubSup}}),o.push(t)),s!=Asc.c_oAscMathInterfaceScript.SubSup&&s!=Asc.c_oAscMathInterfaceScript.Sub||(t=new Common.UI.MenuItem({caption:i.txtRemSubscript,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_ScriptType",value:s==Asc.c_oAscMathInterfaceScript.SubSup?Asc.c_oAscMathInterfaceScript.Sup:Asc.c_oAscMathInterfaceScript.None}}),o.push(t)),s!=Asc.c_oAscMathInterfaceScript.SubSup&&s!=Asc.c_oAscMathInterfaceScript.Sup||(t=new Common.UI.MenuItem({caption:i.txtRemSuperscript,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_ScriptType",value:s==Asc.c_oAscMathInterfaceScript.SubSup?Asc.c_oAscMathInterfaceScript.Sub:Asc.c_oAscMathInterfaceScript.None}}),o.push(t)));break;case Asc.c_oAscMathInterfaceType.Fraction:var a=n.get_FractionType();a!=Asc.c_oAscMathInterfaceFraction.Skewed&&a!=Asc.c_oAscMathInterfaceFraction.Linear||(t=new Common.UI.MenuItem({caption:i.txtFractionStacked,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_FractionType",value:Asc.c_oAscMathInterfaceFraction.Bar}}),o.push(t)),a!=Asc.c_oAscMathInterfaceFraction.Bar&&a!=Asc.c_oAscMathInterfaceFraction.Linear||(t=new Common.UI.MenuItem({caption:i.txtFractionSkewed,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_FractionType",value:Asc.c_oAscMathInterfaceFraction.Skewed}}),o.push(t)),a!=Asc.c_oAscMathInterfaceFraction.Bar&&a!=Asc.c_oAscMathInterfaceFraction.Skewed||(t=new Common.UI.MenuItem({caption:i.txtFractionLinear,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_FractionType",value:Asc.c_oAscMathInterfaceFraction.Linear}}),o.push(t)),a!=Asc.c_oAscMathInterfaceFraction.Bar&&a!=Asc.c_oAscMathInterfaceFraction.NoBar||(t=new Common.UI.MenuItem({caption:a==Asc.c_oAscMathInterfaceFraction.Bar?i.txtRemFractionBar:i.txtAddFractionBar,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_FractionType",value:a==Asc.c_oAscMathInterfaceFraction.Bar?Asc.c_oAscMathInterfaceFraction.NoBar:Asc.c_oAscMathInterfaceFraction.Bar}}),o.push(t));break;case Asc.c_oAscMathInterfaceType.Limit:t=new Common.UI.MenuItem({caption:n.get_Pos()==Asc.c_oAscMathInterfaceLimitPos.Top?i.txtLimitUnder:i.txtLimitOver,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_Pos",value:n.get_Pos()==Asc.c_oAscMathInterfaceLimitPos.Top?Asc.c_oAscMathInterfaceLimitPos.Bottom:Asc.c_oAscMathInterfaceLimitPos.Top}}),o.push(t),t=new Common.UI.MenuItem({caption:i.txtRemLimit,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_Pos",value:Asc.c_oAscMathInterfaceLimitPos.None}}),o.push(t);break;case Asc.c_oAscMathInterfaceType.Matrix:t=new Common.UI.MenuItem({caption:n.get_HidePlaceholder()?i.txtShowPlaceholder:i.txtHidePlaceholder,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_HidePlaceholder",value:!n.get_HidePlaceholder()}}),o.push(t),t=new Common.UI.MenuItem({caption:i.insertText,equation:!0,disabled:i._currentParaObjDisabled,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:i.insertRowAboveText,equationProps:{type:e,callback:"insert_MatrixRow",value:!0}},{caption:i.insertRowBelowText,equationProps:{type:e,callback:"insert_MatrixRow",value:!1}},{caption:i.insertColumnLeftText,equationProps:{type:e,callback:"insert_MatrixColumn",value:!0}},{caption:i.insertColumnRightText,equationProps:{type:e,callback:"insert_MatrixColumn",value:!1}}]})}),o.push(t),t=new Common.UI.MenuItem({caption:i.deleteText,equation:!0,disabled:i._currentParaObjDisabled,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:i.deleteRowText,equationProps:{type:e,callback:"delete_MatrixRow"}},{caption:i.deleteColumnText,equationProps:{type:e,callback:"delete_MatrixColumn"}}]})}),o.push(t),t=new Common.UI.MenuItem({caption:i.txtMatrixAlign,equation:!0,disabled:i._currentParaObjDisabled,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:i.txtTop,checkable:!0,checked:n.get_MatrixAlign()==Asc.c_oAscMathInterfaceMatrixMatrixAlign.Top,equationProps:{type:e,callback:"put_MatrixAlign",value:Asc.c_oAscMathInterfaceMatrixMatrixAlign.Top}},{caption:i.centerText,checkable:!0,checked:n.get_MatrixAlign()==Asc.c_oAscMathInterfaceMatrixMatrixAlign.Center,equationProps:{type:e,callback:"put_MatrixAlign",value:Asc.c_oAscMathInterfaceMatrixMatrixAlign.Center}},{caption:i.txtBottom,checkable:!0,checked:n.get_MatrixAlign()==Asc.c_oAscMathInterfaceMatrixMatrixAlign.Bottom,equationProps:{type:e,callback:"put_MatrixAlign",value:Asc.c_oAscMathInterfaceMatrixMatrixAlign.Bottom}}]})}),o.push(t),t=new Common.UI.MenuItem({caption:i.txtColumnAlign,equation:!0,disabled:i._currentParaObjDisabled,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:i.leftText,checkable:!0,checked:n.get_ColumnAlign()==Asc.c_oAscMathInterfaceMatrixColumnAlign.Left,equationProps:{type:e,callback:"put_ColumnAlign",value:Asc.c_oAscMathInterfaceMatrixColumnAlign.Left}},{caption:i.centerText,checkable:!0,checked:n.get_ColumnAlign()==Asc.c_oAscMathInterfaceMatrixColumnAlign.Center,equationProps:{type:e,callback:"put_ColumnAlign",value:Asc.c_oAscMathInterfaceMatrixColumnAlign.Center}},{caption:i.rightText,checkable:!0,checked:n.get_ColumnAlign()==Asc.c_oAscMathInterfaceMatrixColumnAlign.Right,equationProps:{type:e,callback:"put_ColumnAlign",value:Asc.c_oAscMathInterfaceMatrixColumnAlign.Right}}]})}),o.push(t);break;case Asc.c_oAscMathInterfaceType.EqArray:t=new Common.UI.MenuItem({caption:i.txtInsertEqBefore,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"insert_Equation",value:!0}}),o.push(t),t=new Common.UI.MenuItem({caption:i.txtInsertEqAfter,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"insert_Equation",value:!1}}),o.push(t),t=new Common.UI.MenuItem({caption:i.txtDeleteEq,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"delete_Equation"}}),o.push(t),t=new Common.UI.MenuItem({caption:i.alignmentText,equation:!0,disabled:i._currentParaObjDisabled,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:i.txtTop,checkable:!0,checked:n.get_Align()==Asc.c_oAscMathInterfaceEqArrayAlign.Top,equationProps:{type:e,callback:"put_Align",value:Asc.c_oAscMathInterfaceEqArrayAlign.Top}},{caption:i.centerText,checkable:!0,checked:n.get_Align()==Asc.c_oAscMathInterfaceEqArrayAlign.Center,equationProps:{type:e,callback:"put_Align",value:Asc.c_oAscMathInterfaceEqArrayAlign.Center}},{caption:i.txtBottom,checkable:!0,checked:n.get_Align()==Asc.c_oAscMathInterfaceEqArrayAlign.Bottom,equationProps:{type:e,callback:"put_Align",value:Asc.c_oAscMathInterfaceEqArrayAlign.Bottom}}]})}),o.push(t);break;case Asc.c_oAscMathInterfaceType.LargeOperator:t=new Common.UI.MenuItem({caption:i.txtLimitChange,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_LimitLocation",value:n.get_LimitLocation()==Asc.c_oAscMathInterfaceNaryLimitLocation.UndOvr?Asc.c_oAscMathInterfaceNaryLimitLocation.SubSup:Asc.c_oAscMathInterfaceNaryLimitLocation.UndOvr}}),o.push(t),void 0!==n.get_HideUpper()&&(t=new Common.UI.MenuItem({caption:n.get_HideUpper()?i.txtShowTopLimit:i.txtHideTopLimit,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_HideUpper",value:!n.get_HideUpper()}}),o.push(t)),void 0!==n.get_HideLower()&&(t=new Common.UI.MenuItem({caption:n.get_HideLower()?i.txtShowBottomLimit:i.txtHideBottomLimit,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_HideLower",value:!n.get_HideLower()}}),o.push(t));break;case Asc.c_oAscMathInterfaceType.Delimiter:t=new Common.UI.MenuItem({caption:i.txtInsertArgBefore,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"insert_DelimiterArgument",value:!0}}),o.push(t),t=new Common.UI.MenuItem({caption:i.txtInsertArgAfter,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"insert_DelimiterArgument",value:!1}}),o.push(t),n.can_DeleteArgument()&&(t=new Common.UI.MenuItem({caption:i.txtDeleteArg,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"delete_DelimiterArgument"}}),o.push(t)),t=new Common.UI.MenuItem({caption:n.has_Separators()?i.txtDeleteCharsAndSeparators:i.txtDeleteChars,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"remove_DelimiterCharacters"}}),o.push(t),t=new Common.UI.MenuItem({caption:n.get_HideOpeningBracket()?i.txtShowOpenBracket:i.txtHideOpenBracket,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_HideOpeningBracket",value:!n.get_HideOpeningBracket()}}),o.push(t),t=new Common.UI.MenuItem({caption:n.get_HideClosingBracket()?i.txtShowCloseBracket:i.txtHideCloseBracket,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_HideClosingBracket",value:!n.get_HideClosingBracket()}}),o.push(t),t=new Common.UI.MenuItem({caption:i.txtStretchBrackets,equation:!0,disabled:i._currentParaObjDisabled,checkable:!0,checked:n.get_StretchBrackets(),equationProps:{type:e,callback:"put_StretchBrackets",value:!n.get_StretchBrackets()}}),o.push(t),t=new Common.UI.MenuItem({caption:i.txtMatchBrackets,equation:!0,disabled:!n.get_StretchBrackets()||i._currentParaObjDisabled,checkable:!0,checked:n.get_StretchBrackets()&&n.get_MatchBrackets(),equationProps:{type:e,callback:"put_MatchBrackets",value:!n.get_MatchBrackets()}}),o.push(t);break;case Asc.c_oAscMathInterfaceType.GroupChar:n.can_ChangePos()&&(t=new Common.UI.MenuItem({caption:n.get_Pos()==Asc.c_oAscMathInterfaceGroupCharPos.Top?i.txtGroupCharUnder:i.txtGroupCharOver,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_Pos",value:n.get_Pos()==Asc.c_oAscMathInterfaceGroupCharPos.Top?Asc.c_oAscMathInterfaceGroupCharPos.Bottom:Asc.c_oAscMathInterfaceGroupCharPos.Top}}),o.push(t),t=new Common.UI.MenuItem({caption:i.txtDeleteGroupChar,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_Pos",value:Asc.c_oAscMathInterfaceGroupCharPos.None}}),o.push(t));break;case Asc.c_oAscMathInterfaceType.Radical:void 0!==n.get_HideDegree()&&(t=new Common.UI.MenuItem({caption:n.get_HideDegree()?i.txtShowDegree:i.txtHideDegree,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"put_HideDegree",value:!n.get_HideDegree()}}),o.push(t)),t=new Common.UI.MenuItem({caption:i.txtDeleteRadical,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"remove_Radical"}}),o.push(t)}return n.can_IncreaseArgumentSize()&&(t=new Common.UI.MenuItem({caption:i.txtIncreaseArg,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"increase_ArgumentSize"}}),o.push(t)),n.can_DecreaseArgumentSize()&&(t=new Common.UI.MenuItem({caption:i.txtDecreaseArg,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"decrease_ArgumentSize"}}),o.push(t)),n.can_InsertManualBreak()&&(t=new Common.UI.MenuItem({caption:i.txtInsertBreak,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"insert_ManualBreak"}}),o.push(t)),n.can_DeleteManualBreak()&&(t=new Common.UI.MenuItem({caption:i.txtDeleteBreak,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"delete_ManualBreak"}}),o.push(t)),n.can_AlignToCharacter()&&(t=new Common.UI.MenuItem({caption:i.txtAlignToChar,equation:!0,disabled:i._currentParaObjDisabled,equationProps:{type:e,callback:"align_ToCharacter"}}),o.push(t)),o}},this.addEquationMenu=function(t,n){e.isUndefined(t)&&(t=i.textMenu.isVisible()),i.clearEquationMenu(t,n);var o=t?i.textMenu:i.tableMenu,s=i.initEquationMenu();return s.length>0&&e.each(s,function(t,s){t.menu?e.each(t.menu.items,function(t){t.on("click",e.bind(i.equationCallback,i,t.options.equationProps))}):t.on("click",e.bind(i.equationCallback,i,t.options.equationProps)),o.insertItem(n,t),n++}),s.length},this.clearEquationMenu=function(t,n){for(var o=t?i.textMenu:i.tableMenu,s=n;s<o.items.length&&o.items[s].options.equation;s++)o.items[s].menu?e.each(o.items[s].menu.items,function(t){t.off("click")}):o.items[s].off("click"),o.removeItem(o.items[s]),s--},this.equationCallback=function(t){if(t){var e;switch(t.type){case Asc.c_oAscMathInterfaceType.Accent:e=new CMathMenuAccent;break;case Asc.c_oAscMathInterfaceType.BorderBox:e=new CMathMenuBorderBox;break;case Asc.c_oAscMathInterfaceType.Box:e=new CMathMenuBox;break;case Asc.c_oAscMathInterfaceType.Bar:e=new CMathMenuBar;break;case Asc.c_oAscMathInterfaceType.Script:e=new CMathMenuScript;break;case Asc.c_oAscMathInterfaceType.Fraction:e=new CMathMenuFraction;break;case Asc.c_oAscMathInterfaceType.Limit:e=new CMathMenuLimit;break;case Asc.c_oAscMathInterfaceType.Matrix:e=new CMathMenuMatrix;break;case Asc.c_oAscMathInterfaceType.EqArray:e=new CMathMenuEqArray;break;case Asc.c_oAscMathInterfaceType.LargeOperator:e=new CMathMenuNary;break;case Asc.c_oAscMathInterfaceType.Delimiter:e=new CMathMenuDelimiter;break;case Asc.c_oAscMathInterfaceType.GroupChar:e=new CMathMenuGroupCharacter;break;case Asc.c_oAscMathInterfaceType.Radical:e=new CMathMenuRadical;break;case Asc.c_oAscMathInterfaceType.Common:e=new CMathMenuBase}e&&(e[t.callback](t.value),i.api.asc_SetMathProps(e))}i.fireEvent("editcomplete",i)},this.changePosition=function(){i._XY=[i.cmpEl.offset().left-t(window).scrollLeft(),i.cmpEl.offset().top-t(window).scrollTop()],i._Height=i.cmpEl.height(),i._BodyWidth=t("body").width(),y()},this.hideTips=function(){"object"==typeof b&&(b.hide(),b=!0),e.each(i.usertips,function(t){t.remove()}),i.usertips=[],i.usertipcount=0};var V={};V["alt+h"]=function(){!1!==i.api.can_AddQuotedComment()&&i.addComment()},Common.util.Shortcuts.delegateShortcuts({shortcuts:V}),this.setApi=function(t){return this.api=t,this.api&&(this.api.asc_registerCallback("asc_onContextMenu",e.bind(l,this)),this.api.asc_registerCallback("asc_onMouseMoveStart",e.bind(y,this)),this.api.asc_registerCallback("asc_onMouseMoveEnd",e.bind(S,this)),this.api.asc_registerCallback("asc_onHyperlinkClick",e.bind(_,this)),this.api.asc_registerCallback("asc_onMouseMove",e.bind(A,this)),!0===this.mode.isEdit&&(this.api.asc_registerCallback("asc_onImgWrapStyleChanged",e.bind(this.onImgWrapStyleChanged,this)),this.api.asc_registerCallback("asc_onDialogAddHyperlink",M),this.api.asc_registerCallback("asc_doubleClickOnChart",U),this.api.asc_registerCallback("asc_onSpellCheckVariantsFound",e.bind(E,this)),this.api.asc_registerCallback("asc_onRulerDblClick",e.bind(this.onRulerDblClick,this)),this.api.asc_registerCallback("asc_ChangeCropState",e.bind(this.onChangeCropState,this)),this.api.asc_registerCallback("asc_onLockDocumentProps",e.bind(this.onApiLockDocumentProps,this)),this.api.asc_registerCallback("asc_onUnLockDocumentProps",e.bind(this.onApiUnLockDocumentProps,this))),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",e.bind(B,this)),Common.NotificationCenter.on("api:disconnect",e.bind(B,this)),this.api.asc_registerCallback("asc_onTextLanguage",e.bind(D,this)),this.api.asc_registerCallback("asc_onParaStyleName",e.bind(this.onApiParagraphStyleChange,this)),this.api.asc_registerCallback("asc_onShowForeignCursorLabel",e.bind(k,this)),this.api.asc_registerCallback("asc_onHideForeignCursorLabel",e.bind(T,this)),this.api.asc_registerCallback("asc_onFocusObject",e.bind(c,this)),this.api.asc_registerCallback("asc_onShowSpecialPasteOptions",e.bind(I,this)),this.api.asc_registerCallback("asc_onHideSpecialPasteOptions",e.bind(P,this)),(this.mode.isEdit||this.mode.isRestrictedEdit&&this.mode.canFillForms)&&(this.api.asc_registerCallback("asc_onShowContentControlsActions",e.bind(this.onShowContentControlsActions,this)),this.api.asc_registerCallback("asc_onHideContentControlsActions",e.bind(this.onHideContentControlsActions,this)))),this},this.mode={},this.setMode=function(t){this.mode=t,this.mode.canCoAuthoring&&this.mode.canComments?Common.util.Shortcuts.resumeEvents("alt+h"):Common.util.Shortcuts.suspendEvents("alt+h"),this.editorConfig={user:t.user}},i.on("render:after",m,i)},render:function(){return this.fireEvent("render:before",this),this.cmpEl=t(this.el),this.fireEvent("render:after",this),this},onImgWrapStyleChanged:function(t){switch(t){case Asc.c_oAscWrapStyle2.Inline:this.menuImageWrap.menu.items[0].setChecked(!0);break;case Asc.c_oAscWrapStyle2.Square:this.menuImageWrap.menu.items[1].setChecked(!0);break;case Asc.c_oAscWrapStyle2.Tight:this.menuImageWrap.menu.items[2].setChecked(!0);break;case Asc.c_oAscWrapStyle2.Through:this.menuImageWrap.menu.items[3].setChecked(!0);break;case Asc.c_oAscWrapStyle2.TopAndBottom:this.menuImageWrap.menu.items[4].setChecked(!0);break;case Asc.c_oAscWrapStyle2.Behind:this.menuImageWrap.menu.items[6].setChecked(!0);break;case Asc.c_oAscWrapStyle2.InFront:this.menuImageWrap.menu.items[5].setChecked(!0)}},onChangeCropState:function(t){this.menuImgCrop.menu.items[0].setChecked(t,!0)},onApiParagraphStyleChange:function(t){window.currentStyleName=t},advancedParagraphClick:function(t,i,n){var o,s=this;if(s.api){var a=s.api.getSelectedElements();if(a&&e.isArray(a))for(var r=a.length-1;r>=0;r--){var l,c;if(l=a[r].get_ObjectType(),c=a[r].get_ObjectValue(),Asc.c_oAscTypeSelectElement.Paragraph==l){o=new DE.Views.ParagraphSettingsAdvanced({tableStylerRows:2,tableStylerColumns:1,paragraphProps:c,borderProps:s.borderAdvancedProps,isChart:!0===t.isChart,api:s.api,handler:function(t,e){"ok"==t&&s.api&&(s.borderAdvancedProps=e.borderProps,s.api.paraApply(e.paragraphProps)),s.fireEvent("editcomplete",s)}});break}}}if(o)return o.show(),o},advancedFrameClick:function(t,e,i,n){Common.NotificationCenter.trigger("dropcap:settings",t)},advancedTableClick:function(t,i,n){var o,s=this;if(s.api){var a=s.api.getSelectedElements();if(a&&e.isArray(a))for(var r=a.length-1;r>=0;r--){var l,c;if(l=a[r].get_ObjectType(),c=a[r].get_ObjectValue(),Asc.c_oAscTypeSelectElement.Table==l){o=new DE.Views.TableSettingsAdvanced({tableStylerRows:null===c.get_CellBorders().get_InsideH()&&1==c.get_CellSelect()?1:2,tableStylerColumns:null===c.get_CellBorders().get_InsideV()&&1==c.get_CellSelect()?1:2,tableProps:c,borderProps:s.borderAdvancedProps,sectionProps:s.api.asc_GetSectionProps(),handler:function(t,e){"ok"==t&&s.api&&(s.borderAdvancedProps=e.borderProps,s.api.tblApply(e.tableProps)),s.fireEvent("editcomplete",s)}});break}}}if(o)return o.show(),o},onRulerDblClick:function(e){Common.UI.Menu.Manager.hideAll();var i,n=this;if("tables"==e)(i=this.advancedTableClick())&&i.setActiveCategory(4);else if("indents"==e||"tabs"==e)(i=this.advancedParagraphClick({isChart:!1}))&&i.setActiveCategory("indents"==e?0:4);else if("margins"==e){if(n._state.lock_doc)return;i=new DE.Views.PageMarginsDialog({api:n.api,handler:function(e,i){if("ok"==i){var o=e.getSettings(),s=DE.getController("Toolbar").toolbar.btnPageMargins.menu.items[0];s.setVisible(!0),s.setChecked(!0),s.options.value=s.value=[o.get_TopMargin(),o.get_LeftMargin(),o.get_BottomMargin(),o.get_RightMargin()],t(s.el).html(s.template({id:Common.UI.getId(),caption:s.caption,options:s.options})),Common.localStorage.setItem("de-pgmargins-top",o.get_TopMargin()),Common.localStorage.setItem("de-pgmargins-left",o.get_LeftMargin()),Common.localStorage.setItem("de-pgmargins-bottom",o.get_BottomMargin()),Common.localStorage.setItem("de-pgmargins-right",o.get_RightMargin()),n.api.asc_SetSectionProps(o),n.fireEvent("editcomplete",n)}}}),i.show(),i.setSettings(n.api.asc_GetSectionProps())}else"columns"==e&&(i=new DE.Views.CustomColumnsDialog({handler:function(t,e){"ok"==e&&(n.api.asc_SetColumnsProps(t.getSettings()),n.fireEvent("editcomplete",n))}}),i.show(),i.setSettings(n.api.asc_GetColumnsProps()))},editHyperlink:function(t,e,i){var n,o=this;o.api&&(n=new DE.Views.HyperlinkSettingsDialog({api:o.api,handler:function(t,e){"ok"==e&&o.api.change_Hyperlink(n.getSettings()),o.fireEvent("editcomplete",o)}}),n.show(),n.setSettings(t.hyperProps.value))},onMenuSaveStyle:function(t,e,i){var n=this;n.api&&Common.NotificationCenter.trigger("style:commitsave",n.api.asc_GetStyleFromFormatting())},onMenuUpdateStyle:function(t,e,i){var n=this;n.api&&Common.NotificationCenter.trigger("style:commitchange",n.api.asc_GetStyleFromFormatting())},addComment:function(t,e,i){if(this.api&&this.mode.canCoAuthoring&&this.mode.canComments){this.suppressEditComplete=!0;var n=DE.getController("Common.Controllers.Comments");n&&n.addDummyComment()}},addHyperlink:function(t,e,i){var n,o=this;o.api&&(n=new DE.Views.HyperlinkSettingsDialog({api:o.api,handler:function(t,e){"ok"==e&&o.api.add_Hyperlink(t.getSettings()),o.fireEvent("editcomplete",o)}}),n.show(),n.setSettings(t.hyperProps.value),Common.component.Analytics.trackEvent("DocumentHolder","Add Hyperlink"))},editChartClick:function(){var t=DE.getController("Common.Controllers.ExternalDiagramEditor").getView("Common.Views.ExternalDiagramEditor");if(t){t.setEditMode(!0),t.show();var e=this.api.asc_getChartObject();e&&t.setChartData(new Asc.asc_CChartBinary(e))}},onCutCopyPaste:function(t,e){var i=this;if(i.api){("cut"==t.value?i.api.Cut():"copy"==t.value?i.api.Copy():i.api.Paste())||Common.localStorage.getBool("de-hide-copywarning")||new Common.Views.CopyWarningDialog({handler:function(t){t&&Common.localStorage.setItem("de-hide-copywarning",1),i.fireEvent("editcomplete",i)}}).show()}i.fireEvent("editcomplete",i)},onPrintSelection:function(t){if(this.api){var e=new Asc.asc_CAdjustPrint;e.asc_setPrintType(Asc.c_oAscPrintType.Selection);var i=new Asc.asc_CDownloadOptions(null,Common.Utils.isChrome||Common.Utils.isSafari||Common.Utils.isOpera||Common.Utils.isGecko&&Common.Utils.firefoxVersion>86);i.asc_setAdvancedOptions(e),this.api.asc_Print(i),this.fireEvent("editcomplete",this),Common.component.Analytics.trackEvent("DocumentHolder","Print Selection")}},onControlsSelect:function(t,e){var i=this,n=this.api.asc_GetContentControlProperties();n&&("settings"==t.value?new DE.Views.ControlSettingsDialog({props:n,api:i.api,handler:function(t,e){"ok"==t&&i.api.asc_SetContentControlProperties(e,n.get_InternalId()),i.fireEvent("editcomplete",i)}}).show():"remove"==t.value&&(n.get_FormPr()?this.api.asc_RemoveContentControl(n.get_InternalId()):this.api.asc_RemoveContentControlWrapper(n.get_InternalId()))),i.fireEvent("editcomplete",i)},onInsertCaption:function(){this.fireEvent("links:caption")},onContinueNumbering:function(t,e){this.api.asc_ContinueNumbering(),this.fireEvent("editcomplete",this)},onStartNumbering:function(t,e,i){if(1==t)this.api.asc_RestartNumbering(e.value.start);else{var n=this;new DE.Views.NumberingValueDialog({title:n.textNumberingValue,props:e.value,handler:function(t,e){"ok"==t&&n.api.asc_RestartNumbering(e),n.fireEvent("editcomplete",n)}}).show()}this.fireEvent("editcomplete",this)},onCellsRemove:function(){var t=this;new Common.Views.OptionsDialog({title:t.textTitleCellsRemove,items:[{caption:this.textLeft,value:"left"},{caption:this.textRow,value:"row"},{caption:this.textCol,value:"col"}],handler:function(e,i){if("ok"==i){var n=e.getSettings();"row"==n?t.api.remRow():"col"==n?t.api.remColumn():t.api.asc_RemoveTableCells()}t.fireEvent("editcomplete",t)}}).show(),this.fireEvent("editcomplete",this)},onCellsAdd:function(){var t=this;new DE.Views.CellsAddDialog({handler:function(e,i){"ok"==e&&(i.row?i.before?t.api.addRowAbove(i.count):t.api.addRowBelow(i.count):i.before?t.api.addColumnLeft(i.count):t.api.addColumnRight(i.count)),t.fireEvent("editcomplete",t)}}).show(),this.fireEvent("editcomplete",this)},createDelayedElementsViewer:function(){var t=this,i=new Common.UI.MenuItem({iconCls:"menu__icon btn-copy",caption:t.textCopy,value:"copy"}).on("click",e.bind(t.onCutCopyPaste,t)),n=new Common.UI.MenuItem({iconCls:"menu__icon btn-undo",caption:t.textUndo}).on("click",function(){t.api.Undo()}),o=new Common.UI.MenuItem({caption:"--"}),s=new Common.UI.MenuItem({iconCls:"menu__icon btn-menu-comments",caption:t.addCommentText}).on("click",e.bind(t.addComment,t)),a=new Common.UI.MenuItem({caption:this.strSign,value:0}).on("click",e.bind(t.onSignatureClick,t)),r=new Common.UI.MenuItem({caption:this.strDetails,value:1}).on("click",e.bind(t.onSignatureClick,t)),l=new Common.UI.MenuItem({caption:this.strSetup,value:2}).on("click",e.bind(t.onSignatureClick,t)),c=new Common.UI.MenuItem({caption:this.strDelete,value:3}).on("click",e.bind(t.onSignatureClick,t)),d=new Common.UI.MenuItem({
caption:"--"}),h=new Common.UI.MenuItem({iconCls:"menu__icon btn-print",caption:t.txtPrintSelection}).on("click",e.bind(t.onPrintSelection,t));this.viewModeMenu=new Common.UI.Menu({cls:"shifted-right",initMenu:function(p){var m=p.imgProps&&p.imgProps.value&&!e.isNull(p.imgProps.value.get_ChartProperties()),u=p.imgProps&&p.imgProps.value&&!e.isNull(p.imgProps.value.get_ShapeProperties()),g=p.imgProps&&p.imgProps.value&&t.mode.isSignatureSupport?p.imgProps.value.asc_getSignatureId():void 0,b=g?t.api.asc_getSignatureSetup(g):null,f=!!b&&t._canProtect,C=!!p.paraProps&&!(p.paraProps.value.can_DeleteBlockContentControl()&&p.paraProps.value.can_EditBlockContentControl()&&p.paraProps.value.can_DeleteInlineContentControl()&&p.paraProps.value.can_EditInlineContentControl()),v=!m&&!1!==t.api.can_AddQuotedComment()&&t.mode.canCoAuthoring&&t.mode.canComments&&!t._isDisabled&&!C;if(t.mode.compatibleFeatures&&(v=v&&!u),t.api.asc_IsContentControl()){var _=t.api.asc_GetContentControlProperties(),y=_?_.get_SpecificType():Asc.c_oAscContentControlSpecificType.None;v=v&&!(y==Asc.c_oAscContentControlSpecificType.CheckBox||y==Asc.c_oAscContentControlSpecificType.Picture||y==Asc.c_oAscContentControlSpecificType.ComboBox||y==Asc.c_oAscContentControlSpecificType.DropDownList||y==Asc.c_oAscContentControlSpecificType.DateTime)}n.setVisible(t.mode.canCoAuthoring&&t.mode.canComments&&!t._isDisabled),n.setDisabled(!t.api.asc_getCanUndo()&&!t._isDisabled),o.setVisible(f);var x=!!b&&b.asc_getRequested();a.setVisible(f&&x),r.setVisible(f&&!x),l.setVisible(f),c.setVisible(f&&!x),d.setVisible(v),f&&(a.cmpEl.attr("data-value",g),r.cmpEl.attr("data-value",b.asc_getId()),l.cmpEl.attr("data-value",g),c.cmpEl.attr("data-value",g)),s.setVisible(v),s.setDisabled(p.paraProps&&!0===p.paraProps.locked);var w=t.api&&t.api.can_CopyCut();i.setDisabled(!w),h.setVisible(t.mode.canPrint),h.setDisabled(!w)},items:[i,n,h,o,a,r,l,c,d,s]}).on("hide:after",function(e,i,n){if(t.suppressEditComplete)return void(t.suppressEditComplete=!1);n||t.fireEvent("editcomplete",t),t.currentMenu=null})},createDelayedElements:function(){var i=this,n=new Common.UI.MenuItem({caption:i.txtInsertCaption}).on("click",e.bind(i.onInsertCaption,i)),o=new Common.UI.MenuItem({caption:"--"}),s=new Common.UI.MenuItem({caption:i.txtInsertCaption}).on("click",e.bind(i.onInsertCaption,i)),a=new Common.UI.MenuItem({caption:"--"}),r=new Common.UI.MenuItem({caption:i.textAlign,menu:function(){function t(t,e){if(i.api){var n=Common.Utils.InternalSettings.get("de-img-align-to"),o=1==n?Asc.c_oAscObjectsAlignType.Page:i.api.asc_getSelectedDrawingObjectsCount()<2&&!n||2==n?Asc.c_oAscObjectsAlignType.Margin:Asc.c_oAscObjectsAlignType.Selected;t.value<6?(i.api.put_ShapesAlign(t.value,o),Common.component.Analytics.trackEvent("DocumentHolder","Shape Align")):6==t.value?(i.api.DistributeHorizontally(o),Common.component.Analytics.trackEvent("DocumentHolder","Distribute Horizontally")):7==t.value&&(i.api.DistributeVertically(o),Common.component.Analytics.trackEvent("DocumentHolder","Distribute Vertically"))}i.fireEvent("editcomplete",i)}return new Common.UI.Menu({cls:"ppm-toolbar shifted-right",menuAlign:"tl-tr",items:[new Common.UI.MenuItem({caption:i.textShapeAlignLeft,iconCls:"menu__icon shape-align-left",value:Asc.c_oAscAlignShapeType.ALIGN_LEFT}).on("click",t),new Common.UI.MenuItem({caption:i.textShapeAlignCenter,iconCls:"menu__icon shape-align-center",value:Asc.c_oAscAlignShapeType.ALIGN_CENTER}).on("click",t),new Common.UI.MenuItem({caption:i.textShapeAlignRight,iconCls:"menu__icon shape-align-right",value:Asc.c_oAscAlignShapeType.ALIGN_RIGHT}).on("click",t),new Common.UI.MenuItem({caption:i.textShapeAlignTop,iconCls:"menu__icon shape-align-top",value:Asc.c_oAscAlignShapeType.ALIGN_TOP}).on("click",t),new Common.UI.MenuItem({caption:i.textShapeAlignMiddle,iconCls:"menu__icon shape-align-middle",value:Asc.c_oAscAlignShapeType.ALIGN_MIDDLE}).on("click",t),new Common.UI.MenuItem({caption:i.textShapeAlignBottom,iconCls:"menu__icon shape-align-bottom",value:Asc.c_oAscAlignShapeType.ALIGN_BOTTOM}).on("click",t),{caption:"--"},new Common.UI.MenuItem({caption:i.txtDistribHor,iconCls:"menu__icon shape-distribute-hor",value:6}).on("click",t),new Common.UI.MenuItem({caption:i.txtDistribVert,iconCls:"menu__icon shape-distribute-vert",value:7}).on("click",t)]})}()}),l=new Common.UI.MenuItem({caption:this.txtGroup,iconCls:"menu__icon shape-group"}).on("click",function(t,e){if(i.api){var n=new Asc.asc_CImgProperty;n.put_Group(1),i.api.ImgApply(n)}i.fireEvent("editcomplete",this)}),c=new Common.UI.MenuItem({iconCls:"menu__icon shape-ungroup",caption:this.txtUngroup}).on("click",function(t,e){if(i.api){var n=new Asc.asc_CImgProperty;n.put_Group(-1),i.api.ImgApply(n)}i.fireEvent("editcomplete",this)}),d=new Common.UI.MenuItem({caption:i.textArrange,menu:function(){function t(t,e){if(i.api){var n=new Asc.asc_CImgProperty;n.put_ChangeLevel(t.options.valign),i.api.ImgApply(n)}i.fireEvent("editcomplete",i)}return new Common.UI.Menu({cls:"ppm-toolbar shifted-right",menuAlign:"tl-tr",items:[new Common.UI.MenuItem({caption:i.textArrangeFront,iconCls:"menu__icon arrange-front",valign:Asc.c_oAscChangeLevel.BringToFront}).on("click",t),new Common.UI.MenuItem({caption:i.textArrangeBack,iconCls:"menu__icon arrange-back",valign:Asc.c_oAscChangeLevel.SendToBack}).on("click",t),new Common.UI.MenuItem({caption:i.textArrangeForward,iconCls:"menu__icon arrange-forward",valign:Asc.c_oAscChangeLevel.BringForward}).on("click",t),new Common.UI.MenuItem({caption:i.textArrangeBackward,iconCls:"menu__icon arrange-backward",valign:Asc.c_oAscChangeLevel.BringBackward}).on("click",t),{caption:"--"},l,c]})}()}),h=new Common.UI.MenuItem({caption:i.textEditWrapBoundary,cls:"no-icon-wrap-item"}).on("click",function(t,e){i.api&&i.api.StartChangeWrapPolygon(),i.fireEvent("editcomplete",i)});this.menuImageWrap=new Common.UI.MenuItem({iconCls:"menu__icon wrap-inline",caption:i.textWrap,menu:function(){function t(t,e){if(i.api){var n=new Asc.asc_CImgProperty;if(n.put_WrappingStyle(t.options.wrapType),i.menuImageWrap._originalProps.get_WrappingStyle()===Asc.c_oAscWrapStyle2.Inline&&t.wrapType!==Asc.c_oAscWrapStyle2.Inline){n.put_PositionH(new Asc.CImagePositionH),n.get_PositionH().put_UseAlign(!1),n.get_PositionH().put_RelativeFrom(Asc.c_oAscRelativeFromH.Column);var o=i.menuImageWrap._originalProps.get_Value_X(Asc.c_oAscRelativeFromH.Column);n.get_PositionH().put_Value(o),n.put_PositionV(new Asc.CImagePositionV),n.get_PositionV().put_UseAlign(!1),n.get_PositionV().put_RelativeFrom(Asc.c_oAscRelativeFromV.Paragraph),o=i.menuImageWrap._originalProps.get_Value_Y(Asc.c_oAscRelativeFromV.Paragraph),n.get_PositionV().put_Value(o)}i.api.ImgApply(n)}i.fireEvent("editcomplete",i)}return new Common.UI.Menu({cls:"ppm-toolbar shifted-right",menuAlign:"tl-tr",items:[new Common.UI.MenuItem({caption:i.txtInline,iconCls:"menu__icon wrap-inline",toggleGroup:"popuppicturewrapping",wrapType:Asc.c_oAscWrapStyle2.Inline,checkmark:!1,checkable:!0}).on("click",t),new Common.UI.MenuItem({caption:i.txtSquare,iconCls:"menu__icon wrap-square",toggleGroup:"popuppicturewrapping",wrapType:Asc.c_oAscWrapStyle2.Square,checkmark:!1,checkable:!0}).on("click",t),new Common.UI.MenuItem({caption:i.txtTight,iconCls:"menu__icon wrap-tight",toggleGroup:"popuppicturewrapping",wrapType:Asc.c_oAscWrapStyle2.Tight,checkmark:!1,checkable:!0}).on("click",t),new Common.UI.MenuItem({caption:i.txtThrough,iconCls:"menu__icon wrap-through",toggleGroup:"popuppicturewrapping",wrapType:Asc.c_oAscWrapStyle2.Through,checkmark:!1,checkable:!0}).on("click",t),new Common.UI.MenuItem({caption:i.txtTopAndBottom,iconCls:"menu__icon wrap-topandbottom",toggleGroup:"popuppicturewrapping",wrapType:Asc.c_oAscWrapStyle2.TopAndBottom,checkmark:!1,checkable:!0}).on("click",t),new Common.UI.MenuItem({caption:i.txtInFront,iconCls:"menu__icon wrap-infront",toggleGroup:"popuppicturewrapping",wrapType:Asc.c_oAscWrapStyle2.InFront,checkmark:!1,checkable:!0}).on("click",t),new Common.UI.MenuItem({caption:i.txtBehind,iconCls:"menu__icon wrap-behind",toggleGroup:"popuppicturewrapping",wrapType:Asc.c_oAscWrapStyle2.Behind,checkmark:!1,checkable:!0}).on("click",t),{caption:"--"},h]})}()});var p=new Common.UI.MenuItem({iconCls:"menu__icon btn-menu-image",caption:i.advancedText}).on("click",function(t,n){var o,s;if(i.api){var a=i.api.getSelectedElements();if(a&&e.isArray(a))for(var r=a.length-1;r>=0;r--)if(o=a[r].get_ObjectType(),s=a[r].get_ObjectValue(),Asc.c_oAscTypeSelectElement.Image==o){var l;s.get_ChartProperties()||s.get_ShapeProperties()||i.menuOriginalSize.isDisabled()||!i.menuOriginalSize.isVisible()||(l=i.api.get_OriginalSizeImage())&&(l={width:l.get_ImageWidth(),height:l.get_ImageHeight()});var c=new DE.Views.ImageSettingsAdvanced({imageProps:s,sizeOriginal:l,api:i.api,sectionProps:i.api.asc_GetSectionProps(),handler:function(t,e){"ok"==t&&i.api&&i.api.ImgApply(e.imageProps),i.fireEvent("editcomplete",i)}});c.show(),c.btnOriginalSize.setVisible(i.menuOriginalSize.isVisible());break}}}),m=new Common.UI.MenuItem({caption:i.editChartText}).on("click",e.bind(i.editChartClick,i));this.menuOriginalSize=new Common.UI.MenuItem({caption:i.originalSizeText}).on("click",function(t,e){if(i.api){var n=i.api.get_OriginalSizeImage(),o=new Asc.asc_CImgProperty;o.put_Width(n.get_ImageWidth()),o.put_Height(n.get_ImageHeight()),o.put_ResetCrop(!0),o.put_Rot(0),i.api.ImgApply(o),i.fireEvent("editcomplete",this)}});var u=new Common.UI.MenuItem({caption:i.textReplace,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[new Common.UI.MenuItem({caption:this.textFromFile}).on("click",function(t){setTimeout(function(){i.api&&i.api.ChangeImageFromFile(),i.fireEvent("editcomplete",i)},10)}),new Common.UI.MenuItem({caption:this.textFromUrl,cls:"cp-from-url"}).on("click",function(t){new Common.Views.ImageFromUrlDialog({handler:function(t,n){if("ok"==t&&i.api){var o=n.replace(/ /g,"");if(!e.isEmpty(o)){var s=new Asc.asc_CImgProperty;s.put_ImageUrl(o),i.api.ImgApply(s)}}i.fireEvent("editcomplete",i)}}).show()}),new Common.UI.MenuItem({caption:this.textFromStorage}).on("click",function(t){Common.NotificationCenter.trigger("storage:image-load","change")})]})}),g=new Common.UI.MenuItem({iconCls:"menu__icon btn-copy",caption:i.textCopy,value:"copy"}).on("click",e.bind(i.onCutCopyPaste,i)),b=new Common.UI.MenuItem({iconCls:"menu__icon btn-paste",caption:i.textPaste,value:"paste"}).on("click",e.bind(i.onCutCopyPaste,i)),f=new Common.UI.MenuItem({iconCls:"menu__icon btn-cut",caption:i.textCut,value:"cut"}).on("click",e.bind(i.onCutCopyPaste,i)),C=new Common.UI.MenuItem({iconCls:"menu__icon btn-print",caption:i.txtPrintSelection}).on("click",e.bind(i.onPrintSelection,i)),v=new Common.UI.MenuItem({caption:this.strSign,value:0}).on("click",e.bind(i.onSignatureClick,i)),_=new Common.UI.MenuItem({caption:this.strSetup,value:2}).on("click",e.bind(i.onSignatureClick,i)),y=new Common.UI.MenuItem({caption:"--"}),x=new Common.UI.MenuItem({caption:i.textRotate,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[new Common.UI.MenuItem({iconCls:"menu__icon btn-rotate-90",caption:this.textRotate90,value:1}).on("click",e.bind(i.onImgRotate,i)),new Common.UI.MenuItem({iconCls:"menu__icon btn-rotate-270",caption:this.textRotate270,value:0}).on("click",e.bind(i.onImgRotate,i)),{caption:"--"},new Common.UI.MenuItem({iconCls:"menu__icon btn-flip-hor",caption:this.textFlipH,value:1}).on("click",e.bind(i.onImgFlip,i)),new Common.UI.MenuItem({iconCls:"menu__icon btn-flip-vert",caption:this.textFlipV,value:0}).on("click",e.bind(i.onImgFlip,i))]})});i.menuImgCrop=new Common.UI.MenuItem({caption:i.textCrop,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[new Common.UI.MenuItem({caption:i.textCrop,checkable:!0,allowDepress:!0,value:0}).on("click",e.bind(i.onImgCrop,i)),new Common.UI.MenuItem({caption:i.textCropFill,value:1}).on("click",e.bind(i.onImgCrop,i)),new Common.UI.MenuItem({caption:i.textCropFit,value:2}).on("click",e.bind(i.onImgCrop,i))]})});var w=new Common.UI.MenuItem({iconCls:"menu__icon cc-remove",caption:i.textRemoveControl,value:"remove"}).on("click",e.bind(i.onControlsSelect,i)),S=new Common.UI.MenuItem({caption:i.textEditControls,value:"settings"}).on("click",e.bind(i.onControlsSelect,i)),A=new Common.UI.MenuItem({caption:"--"});this.pictureMenu=new Common.UI.Menu({cls:"shifted-right",initMenu:function(t){if(!e.isUndefined(t.imgProps)){var n=!t.imgProps.value.get_CanBeFlow(),o=t.imgProps.value.get_WrappingStyle();i.menuImageWrap._originalProps=t.imgProps.value;var s="menu__icon ";if(n){for(var a=0;a<6;a++)i.menuImageWrap.menu.items[a].setChecked(!1);s+="wrap-inline"}else switch(o){case Asc.c_oAscWrapStyle2.Inline:i.menuImageWrap.menu.items[0].setChecked(!0),s+="wrap-inline";break;case Asc.c_oAscWrapStyle2.Square:i.menuImageWrap.menu.items[1].setChecked(!0),s+="wrap-square";break;case Asc.c_oAscWrapStyle2.Tight:i.menuImageWrap.menu.items[2].setChecked(!0),s+="wrap-tight";break;case Asc.c_oAscWrapStyle2.Through:i.menuImageWrap.menu.items[3].setChecked(!0),s+="wrap-through";break;case Asc.c_oAscWrapStyle2.TopAndBottom:i.menuImageWrap.menu.items[4].setChecked(!0),s+="wrap-topandbottom";break;case Asc.c_oAscWrapStyle2.Behind:i.menuImageWrap.menu.items[6].setChecked(!0),s+="wrap-behind";break;case Asc.c_oAscWrapStyle2.InFront:i.menuImageWrap.menu.items[5].setChecked(!0),s+="wrap-infront";break;default:for(var a=0;a<6;a++)i.menuImageWrap.menu.items[a].setChecked(!1);s+="wrap-infront"}i.menuImageWrap.setIconCls(s),e.each(i.menuImageWrap.menu.items,function(t){t.setDisabled(n)});var k=t.imgProps.isImg&&t.imgProps.isChart||t.imgProps.isImg&&t.imgProps.isShape||t.imgProps.isShape&&t.imgProps.isChart;k?(p.setCaption(i.advancedText,!0),p.setIconCls("menu__icon btn-menu-image")):(p.setCaption(t.imgProps.isImg?i.imageText:t.imgProps.isChart?i.chartText:i.shapeText,!0),p.setIconCls("menu__icon "+(t.imgProps.isImg?"btn-menu-image":t.imgProps.isChart?"btn-menu-chart":"btn-menu-shape"))),m.setVisible(!e.isNull(t.imgProps.value.get_ChartProperties())&&!k),i.menuOriginalSize.setVisible(t.imgProps.isOnlyImg||!t.imgProps.isChart&&!t.imgProps.isShape);var T=i.api.asc_IsContentControl(),I=T?i.api.asc_GetContentControlProperties():null,P=I?I.get_Lock():Asc.c_oAscSdtLockType.Unlocked,M=P==Asc.c_oAscSdtLockType.SdtContentLocked||P==Asc.c_oAscSdtLockType.ContentLocked,U=I&&I.get_FormPr();w.setVisible(T),S.setVisible(T&&i.mode.canEditContentControl&&!U),A.setVisible(T),T&&(w.setDisabled(P==Asc.c_oAscSdtLockType.SdtContentLocked||P==Asc.c_oAscSdtLockType.SdtLocked),w.setCaption(U?i.getControlLabel(I):i.textRemoveControl));var B=t.imgProps.locked||void 0!==t.headerProps&&t.headerProps.locked||M,D=t.imgProps.value.asc_getPluginGuid();if(u.setVisible(t.imgProps.isOnlyImg&&(null===D||void 0===D)),u.isVisible()&&u.setDisabled(B||null===D),u.menu.items[2].setVisible(i.mode.canRequestInsertImage||i.mode.fileChoiceUrl&&i.mode.fileChoiceUrl.indexOf("{documentType}")>-1),x.setVisible(!t.imgProps.isChart&&(null===D||void 0===D)),x.isVisible()&&x.setDisabled(B),i.menuImgCrop.setVisible(i.api.asc_canEditCrop()),i.menuImgCrop.isVisible()&&i.menuImgCrop.setDisabled(B),m.isVisible()&&m.setDisabled(B||t.imgProps.value.get_SeveralCharts()),i.pictureMenu.items[22].setVisible(m.isVisible()),i.menuOriginalSize.setDisabled(B||null===t.imgProps.value.get_ImageUrl()||void 0===t.imgProps.value.get_ImageUrl()),p.setDisabled(B),r.setDisabled(B||o==Asc.c_oAscWrapStyle2.Inline),!B&&o!=Asc.c_oAscWrapStyle2.Inline){var E=i.api.asc_getSelectedDrawingObjectsCount(),V=Common.Utils.InternalSettings.get("de-img-align-to");r.menu.items[7].setDisabled(2==E&&(!V||3==V)),r.menu.items[8].setDisabled(2==E&&(!V||3==V))}d.setDisabled(o==Asc.c_oAscWrapStyle2.Inline&&!t.imgProps.value.get_FromGroup()||M),i.api&&(c.setDisabled(B||!i.api.CanUnGroup()),l.setDisabled(B||!i.api.CanGroup()),h.setDisabled(B||!i.api.CanChangeWrapPolygon())),i.menuImageWrap.setDisabled(B||t.imgProps.value.get_FromGroup()||n&&h.isDisabled()||!!I&&I.get_SpecificType()==Asc.c_oAscContentControlSpecificType.Picture);var F=i.api&&i.api.can_CopyCut();g.setDisabled(!F),f.setDisabled(B||!F),b.setDisabled(B),C.setVisible(i.mode.canPrint),C.setDisabled(!F);var R=t.imgProps&&t.imgProps.value&&i.mode.isSignatureSupport?t.imgProps.value.asc_getSignatureId():void 0,L=!!R;v.setVisible(L),_.setVisible(L),y.setVisible(L),L&&(v.cmpEl.attr("data-value",R),_.cmpEl.attr("data-value",R))}},items:[f,g,b,C,{caption:"--"},v,_,y,w,S,A,d,r,i.menuImageWrap,x,{caption:"--"},n,o,i.menuImgCrop,i.menuOriginalSize,u,m,{caption:"--"},p]}).on("hide:after",function(t,e,n){n||i.fireEvent("editcomplete",i),i.currentMenu=null});var k=new Common.UI.MenuItem({caption:i.txtInsertCaption}).on("click",e.bind(i.onInsertCaption,i)),T=new Common.UI.MenuItem({iconCls:"menu__icon btn-merge-cells",caption:i.mergeCellsText}).on("click",function(t){i.api&&i.api.MergeCells()}),I=new Common.UI.MenuItem({caption:i.splitCellsText}).on("click",function(t){i.api&&new Common.Views.InsertTableDialog({split:!0,handler:function(t,e){"ok"==t&&(i.api&&i.api.SplitCell(e.columns,e.rows),Common.component.Analytics.trackEvent("DocumentHolder","Table")),i.fireEvent("editcomplete",i)}}).show()}),P=function(t,e){if(i.api){var n=new Asc.CTableProp;n.put_CellsVAlign(t.options.valign),i.api.tblApply(n)}},M=new Common.UI.MenuItem({iconCls:"menu__icon btn-align-top",caption:i.cellAlignText,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[i.menuTableCellTop=new Common.UI.MenuItem({iconCls:"menu__icon btn-align-top",caption:i.textShapeAlignTop,toggleGroup:"popuptablecellalign",checkmark:!1,checkable:!0,checked:!1,valign:Asc.c_oAscVertAlignJc.Top}).on("click",e.bind(P,i)),i.menuTableCellCenter=new Common.UI.MenuItem({iconCls:"menu__icon btn-align-middle",caption:i.textShapeAlignMiddle,toggleGroup:"popuptablecellalign",checkmark:!1,checkable:!0,checked:!1,valign:Asc.c_oAscVertAlignJc.Center}).on("click",e.bind(P,i)),i.menuTableCellBottom=new Common.UI.MenuItem({iconCls:"menu__icon btn-align-bottom",caption:i.textShapeAlignBottom,toggleGroup:"popuptablecellalign",checkmark:!1,checkable:!0,checked:!1,valign:Asc.c_oAscVertAlignJc.Bottom}).on("click",e.bind(P,i))]})}),U=new Common.UI.MenuItem({iconCls:"menu__icon btn-menu-table",caption:i.advancedTableText}).on("click",e.bind(i.advancedTableClick,i)),B=new Common.UI.MenuItem({iconCls:"menu__icon btn-paragraph",caption:i.advancedParagraphText}).on("click",e.bind(i.advancedParagraphClick,i)),D=new Common.UI.MenuItem({caption:"--"}),E=new Common.UI.MenuItem({caption:i.editHyperlinkText}).on("click",e.bind(i.editHyperlink,i)),V=new Common.UI.MenuItem({caption:i.removeHyperlinkText}).on("click",function(t,e){i.api&&i.api.remove_Hyperlink(t.hyperProps.value),i.fireEvent("editcomplete",i)}),F=new Common.UI.MenuItem({iconCls:"menu__icon btn-inserthyperlink",caption:i.hyperlinkText,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[E,V]})}),R=new Common.UI.MenuItem({iconCls:"menu__icon cc-remove",caption:i.textRemove,value:"remove"}).on("click",e.bind(i.onControlsSelect,i)),L=new Common.UI.MenuItem({caption:i.textSettings,value:"settings"}).on("click",e.bind(i.onControlsSelect,i)),N=new Common.UI.MenuItem({caption:i.textContentControls,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[R,L]})}),O=new Common.UI.MenuItem({caption:i.textTOC,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:i.textSettings,value:"settings"},{caption:i.textUpdateAll,value:"all"},{caption:i.textUpdatePages,value:"pages"}]})});O.menu.on("item:click",function(t,e,n){i.fireEvent("settings"==e.value?"links:contents":"links:update",[e.value,!0])});var H=new Common.UI.MenuItem({iconCls:"menu__icon btn-menu-comments",caption:i.addCommentText}).on("click",e.bind(i.addComment,i)),z=new Common.UI.MenuItem({iconCls:"menu__icon btn-inserthyperlink",caption:i.hyperlinkText}).on("click",e.bind(i.addHyperlink,i)),$=new Common.UI.MenuItem({caption:i.textFollow}).on("click",e.bind(i.onFollowMove,i));i.menuSpellTable=new Common.UI.MenuItem({caption:i.loadSpellText,disabled:!0}),i.menuSpellMoreTable=new Common.UI.MenuItem({caption:i.moreText,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",restoreHeight:!0,items:[]})});var G=e.template(['<a id="<%= id %>" tabindex="-1" type="menuitem" style="padding-left: 28px !important;" langval="<%= value %>" class="<% if (checked) { %> checked <% } %>">','<i class="icon <% if (spellcheck) { %> toolbar__icon btn-ic-docspell spellcheck-lang <% } %>"></i>',"<%= caption %>","</a>"].join(""));i.langTableMenu=new Common.UI.MenuItem({iconCls:"menu__icon btn-ic-doclang",caption:i.langText,menu:new Common.UI.MenuSimple({cls:"lang-menu",menuAlign:"tl-tr",restoreHeight:285,items:[],itemTemplate:G,search:!0})});var W=new Common.UI.MenuItem({caption:i.ignoreSpellText}).on("click",function(t){i.api&&(i.api.asc_ignoreMisspelledWord(i._currentSpellObj,!1),i.fireEvent("editcomplete",i))}),j=new Common.UI.MenuItem({caption:i.ignoreAllSpellText}).on("click",function(t){i.api&&(i.api.asc_ignoreMisspelledWord(i._currentSpellObj,!0),i.fireEvent("editcomplete",i))}),q=new Common.UI.MenuItem({caption:i.toDictionaryText}).on("click",function(t,e){i.api.asc_spellCheckAddToDictionary(i._currentSpellObj),i.fireEvent("editcomplete",i)}),K=new Common.UI.MenuItem({caption:"--"}),Y=new Common.UI.MenuItem({caption:"--"});i.menuSpellCheckTable=new Common.UI.MenuItem({iconCls:"menu__icon btn-ic-docspell",caption:i.spellcheckText,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[i.menuSpellTable,i.menuSpellMoreTable,K,W,j,q,{caption:"--"},i.langTableMenu]})});var X=new Common.UI.MenuItem({iconCls:"menu__icon btn-copy",caption:i.textCopy,value:"copy"}).on("click",e.bind(i.onCutCopyPaste,i)),J=new Common.UI.MenuItem({iconCls:"menu__icon btn-paste",caption:i.textPaste,value:"paste"}).on("click",e.bind(i.onCutCopyPaste,i)),Z=new Common.UI.MenuItem({iconCls:"menu__icon btn-cut",caption:i.textCut,value:"cut"}).on("click",e.bind(i.onCutCopyPaste,i)),Q=new Common.UI.MenuItem({iconCls:"menu__icon btn-print",caption:i.txtPrintSelection}).on("click",e.bind(i.onPrintSelection,i)),tt=new Common.UI.MenuItem({caption:"--"}),et=new Common.UI.MenuItem({caption:i.textDistributeRows}).on("click",e.bind(function(){i.api&&i.api.asc_DistributeTableCells(!1),i.fireEvent("editcomplete",i)},i)),it=new Common.UI.MenuItem({caption:i.textDistributeCols}).on("click",e.bind(function(){i.api&&i.api.asc_DistributeTableCells(!0),i.fireEvent("editcomplete",i)},i)),nt=function(t,e){if(i.api){var n=new Asc.CTableProp;n.put_CellsTextDirection(t.options.direction),i.api.tblApply(n)}},ot=new Common.UI.MenuItem({iconCls:"menu__icon text-orient-hor",caption:i.directionText,menu:new Common.UI.Menu({cls:"ppm-toolbar shifted-right",menuAlign:"tl-tr",items:[i.menuTableDirectH=new Common.UI.MenuItem({caption:i.directHText,iconCls:"menu__icon text-orient-hor",checkable:!0,checkmark:!1,checked:!1,toggleGroup:"popuptabledirect",direction:Asc.c_oAscCellTextDirection.LRTB}).on("click",e.bind(nt,i)),i.menuTableDirect90=new Common.UI.MenuItem({caption:i.direct90Text,iconCls:"menu__icon text-orient-rdown",checkable:!0,checkmark:!1,checked:!1,toggleGroup:"popuptabledirect",direction:Asc.c_oAscCellTextDirection.TBRL}).on("click",e.bind(nt,i)),i.menuTableDirect270=new Common.UI.MenuItem({caption:i.direct270Text,iconCls:"menu__icon text-orient-rup",checkable:!0,checkmark:!1,checked:!1,toggleGroup:"popuptabledirect",direction:Asc.c_oAscCellTextDirection.BTLR}).on("click",e.bind(nt,i))]})}),st=new Common.UI.MenuItem({caption:i.textStartNewList}).on("click",e.bind(i.onStartNumbering,i,1)),at=new Common.UI.MenuItem({caption:i.textStartNumberingFrom}).on("click",e.bind(i.onStartNumbering,i,"advanced")),rt=new Common.UI.MenuItem({caption:i.textContinueNumbering}).on("click",e.bind(i.onContinueNumbering,i)),lt=new Common.UI.MenuItem({caption:i.bulletsText,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[st,at,rt]})}),ct=new Common.UI.MenuItem({caption:i.textRefreshField}).on("click",function(t,e){i.api.asc_UpdateComplexField(t.options.fieldProps),i.fireEvent("editcomplete",i)}),dt=new Common.UI.MenuItem({caption:"--"});this.tableMenu=new Common.UI.Menu({cls:"shifted-right",initMenu:function(t){if(!e.isUndefined(t.tableProps)){for(var n=t.mathProps&&t.mathProps.value,o=8;o<27;o++)i.tableMenu.items[o].setVisible(!n);var s=t.tableProps.value.get_CellsVAlign(),a="";switch(s){case Asc.c_oAscVertAlignJc.Top:a="menu__icon btn-align-top";break;case Asc.c_oAscVertAlignJc.Center:a="menu__icon btn-align-middle";break;case Asc.c_oAscVertAlignJc.Bottom:a="menu__icon btn-align-bottom"}M.setIconCls(a),i.menuTableCellTop.setChecked(s==Asc.c_oAscVertAlignJc.Top),i.menuTableCellCenter.setChecked(s==Asc.c_oAscVertAlignJc.Center),i.menuTableCellBottom.setChecked(s==Asc.c_oAscVertAlignJc.Bottom);var r=t.tableProps.value.get_CellsTextDirection();switch(a="",r){case Asc.c_oAscCellTextDirection.LRTB:a="menu__icon text-orient-hor";break;case Asc.c_oAscCellTextDirection.TBRL:a="menu__icon text-orient-rdown";break;case Asc.c_oAscCellTextDirection.BTLR:a="menu__icon text-orient-rup"}ot.setIconCls(a),i.menuTableDirectH.setChecked(r==Asc.c_oAscCellTextDirection.LRTB),i.menuTableDirect90.setChecked(r==Asc.c_oAscCellTextDirection.TBRL),i.menuTableDirect270.setChecked(r==Asc.c_oAscCellTextDirection.BTLR);var l=t.tableProps.locked||void 0!==t.headerProps&&t.headerProps.locked;i.tableMenu.items[11].setDisabled(l),i.tableMenu.items[12].setDisabled(l),i.api&&(T.setDisabled(l||!i.api.CheckBeforeMergeCells()),I.setDisabled(l||!i.api.CheckBeforeSplitCells())),et.setDisabled(l),it.setDisabled(l),M.setDisabled(l),ot.setDisabled(l),U.setDisabled(l);var c=i.api&&i.api.can_CopyCut();X.setDisabled(!c),Z.setDisabled(l||!c),J.setDisabled(l),Q.setVisible(i.mode.canPrint),Q.setDisabled(!c);var d=i.api.asc_GetCurrentNumberingId(),h=null!==d;if(lt.setVisible(h),h){var p=i.api.asc_GetNumberingPr(d).get_Lvl(i.api.asc_GetCurrentNumberingLvl()),m=p.get_Format(),u=i.api.asc_GetCalculatedNumberingValue();st.setVisible(p.get_Start()!=u),st.value={start:p.get_Start()},at.setVisible(m!=Asc.c_oAscNumberingFormat.Bullet),at.value={format:m,start:u},st.setCaption(m==Asc.c_oAscNumberingFormat.Bullet?i.textSeparateList:i.textStartNewList),rt.setCaption(m==Asc.c_oAscNumberingFormat.Bullet?i.textJoinList:i.textContinueNumbering)}var g=null;i.api&&(g=i.api.can_AddHyperlink()),z.setVisible(void 0===t.hyperProps&&!1!==g),F.setVisible(void 0!==t.hyperProps),E.hyperProps=t.hyperProps,V.hyperProps=t.hyperProps,!1!==g&&(z.hyperProps={},z.hyperProps.value=new Asc.CHyperlinkProperty,z.hyperProps.value.put_Text(g));var b=i.api.asc_GetRevisionsChangesStack(),f=!1;$.value=null,e.each(b,function(t){t.get_Type()!=Asc.c_oAscRevisionsChangeType.TextAdd&&t.get_Type()!=Asc.c_oAscRevisionsChangeType.TextRem||t.get_MoveType()==Asc.c_oAscRevisionsMove.NoMove||($.value=t,f=!0)}),$.setVisible(f),D.setVisible(z.isVisible()||F.isVisible()||lt.isVisible()||$.isVisible()),B.setVisible(void 0!==t.paraProps),i._currentParaObjDisabled=l=t.paraProps.locked||void 0!==t.headerProps&&t.headerProps.locked,z.setDisabled(l),F.setDisabled(l||void 0!==t.hyperProps&&!0===t.hyperProps.isSeveralLinks),B.setDisabled(l),i.menuSpellCheckTable.setVisible(void 0!==t.spellProps&&!1===t.spellProps.value.get_Checked()),q.setVisible(i.mode.isDesktopApp),Y.setVisible(void 0!==t.spellProps&&!1===t.spellProps.value.get_Checked()),i.langTableMenu.setDisabled(l),void 0!==t.spellProps&&!1===t.spellProps.value.get_Checked()&&null!==t.spellProps.value.get_Variants()&&void 0!==t.spellProps.value.get_Variants()?i.addWordVariants(!1):(i.menuSpellTable.setCaption(i.loadSpellText,!0),i.clearWordVariants(!1),i.menuSpellMoreTable.setVisible(!1)),i.menuSpellCheckTable.isVisible()&&i._currLang.id!==i._currLang.tableid&&(i.changeLanguageMenu(i.langTableMenu.menu),i._currLang.tableid=i._currLang.id);var C=0;n?C=i.addEquationMenu(!1,7):i.clearEquationMenu(!1,7),tt.setVisible(n&&C>0);var v=!!t.paraProps&&!(t.paraProps.value.can_DeleteBlockContentControl()&&t.paraProps.value.can_EditBlockContentControl()&&t.paraProps.value.can_DeleteInlineContentControl()&&t.paraProps.value.can_EditInlineContentControl()),_=i.api.asc_GetTableOfContentsPr(!0),y=!_&&i.api.asc_IsContentControl();if(N.setVisible(y),y){var x=i.api.asc_GetContentControlProperties(),w=x?x.get_Lock():Asc.c_oAscSdtLockType.Unlocked,S=x&&x.get_FormPr();R.setDisabled(w==Asc.c_oAscSdtLockType.SdtContentLocked||w==Asc.c_oAscSdtLockType.SdtLocked),R.setCaption(S?i.getControlLabel(x):i.textRemoveControl),L.setVisible(i.mode.canEditContentControl&&!S);var A=x?x.get_SpecificType():Asc.c_oAscContentControlSpecificType.None;v=v||A==Asc.c_oAscContentControlSpecificType.CheckBox||A==Asc.c_oAscContentControlSpecificType.Picture||A==Asc.c_oAscContentControlSpecificType.ComboBox||A==Asc.c_oAscContentControlSpecificType.DropDownList||A==Asc.c_oAscContentControlSpecificType.DateTime}O.setVisible(_),H.setVisible(!1!==i.api.can_AddQuotedComment()&&i.mode.canCoAuthoring&&i.mode.canComments&&!v),H.setDisabled(void 0!==t.paraProps&&!0===t.paraProps.locked);var k=i.api.asc_GetCurrentComplexField();ct.setVisible(!!k),ct.setDisabled(l),dt.setVisible(!!k),k&&(ct.options.fieldProps=k)}},items:[i.menuSpellCheckTable,Y,Z,X,J,Q,{caption:"--"},tt,ct,dt,{caption:i.selectText,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",style:"width: 100px",items:[new Common.UI.MenuItem({caption:i.rowText}).on("click",function(t){i.api&&i.api.selectRow()}),new Common.UI.MenuItem({caption:i.columnText}).on("click",function(t){i.api&&i.api.selectColumn()}),new Common.UI.MenuItem({caption:i.cellText}).on("click",function(t){i.api&&i.api.selectCell()}),new Common.UI.MenuItem({caption:i.tableText}).on("click",function(t){i.api&&i.api.selectTable()})]})},{iconCls:"menu__icon btn-addcell",caption:i.insertText,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[new Common.UI.MenuItem({caption:i.insertColumnLeftText}).on("click",function(t){i.api&&i.api.addColumnLeft()}),new Common.UI.MenuItem({caption:i.insertColumnRightText}).on("click",function(t){i.api&&i.api.addColumnRight()}),new Common.UI.MenuItem({caption:i.insertRowAboveText}).on("click",function(t){i.api&&i.api.addRowAbove()}),new Common.UI.MenuItem({caption:i.insertRowBelowText}).on("click",function(t){i.api&&i.api.addRowBelow()}),new Common.UI.MenuItem({caption:i.textSeveral}).on("click",function(t){i.onCellsAdd()})]})},{iconCls:"menu__icon btn-delcell",caption:i.deleteText,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",style:"width: 100px",items:[new Common.UI.MenuItem({caption:i.rowText}).on("click",function(t){i.api&&i.api.remRow()}),new Common.UI.MenuItem({caption:i.columnText}).on("click",function(t){i.api&&i.api.remColumn()}),new Common.UI.MenuItem({caption:i.tableText}).on("click",function(t){i.api&&i.api.remTable()}),new Common.UI.MenuItem({caption:i.textCells}).on("click",function(t){i.onCellsRemove()})]})},{caption:"--"},T,I,{caption:"--"},et,it,{caption:"--"},M,ot,{caption:"--"},k,{caption:"--"},U,{caption:"--"},H,lt,z,F,$,D,N,O,B]}).on("hide:after",function(t,e,n){if(i.suppressEditComplete)return void(i.suppressEditComplete=!1);n||i.fireEvent("editcomplete",i),i.currentMenu=null});var ht=new Common.UI.MenuItem({caption:i.breakBeforeText,checkable:!0}).on("click",function(t,e){i.api.put_PageBreak(t.checked)}),pt=new Common.UI.MenuItem({caption:i.keepLinesText,checkable:!0}).on("click",function(t,e){i.api.put_KeepLines(t.checked)}),mt=function(t,e){if(i.api){var n=new Asc.asc_CImgProperty;n.put_VerticalTextAlign(t.options.valign),i.api.ImgApply(n)}},ut=new Common.UI.MenuItem({iconCls:"menu__icon btn-align-top",caption:i.vertAlignText,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[i.menuParagraphTop=new Common.UI.MenuItem({iconCls:"menu__icon btn-align-top",caption:i.textShapeAlignTop,
checkmark:!1,checkable:!0,checked:!1,toggleGroup:"popupparagraphvalign",valign:Asc.c_oAscVAlign.Top}).on("click",e.bind(mt,i)),i.menuParagraphCenter=new Common.UI.MenuItem({iconCls:"menu__icon btn-align-middle",caption:i.textShapeAlignMiddle,checkmark:!1,checkable:!0,checked:!1,toggleGroup:"popupparagraphvalign",valign:Asc.c_oAscVAlign.Center}).on("click",e.bind(mt,i)),i.menuParagraphBottom=new Common.UI.MenuItem({iconCls:"menu__icon btn-align-bottom",caption:i.textShapeAlignBottom,checkmark:!1,checkable:!0,checked:!1,toggleGroup:"popupparagraphvalign",valign:Asc.c_oAscVAlign.Bottom}).on("click",e.bind(mt,i))]})}),gt=function(t,e){if(i.api){var n=new Asc.asc_CImgProperty;n.put_Vert(t.options.direction),i.api.ImgApply(n)}},bt=new Common.UI.MenuItem({iconCls:"menu__icon text-orient-hor",caption:i.directionText,menu:new Common.UI.Menu({cls:"ppm-toolbar shifted-right",menuAlign:"tl-tr",items:[i.menuParagraphDirectH=new Common.UI.MenuItem({caption:i.directHText,iconCls:"menu__icon text-orient-hor",checkable:!0,checkmark:!1,checked:!1,toggleGroup:"popupparagraphdirect",direction:Asc.c_oAscVertDrawingText.normal}).on("click",e.bind(gt,i)),i.menuParagraphDirect90=new Common.UI.MenuItem({caption:i.direct90Text,iconCls:"menu__icon text-orient-rdown",checkable:!0,checkmark:!1,checked:!1,toggleGroup:"popupparagraphdirect",direction:Asc.c_oAscVertDrawingText.vert}).on("click",e.bind(gt,i)),i.menuParagraphDirect270=new Common.UI.MenuItem({caption:i.direct270Text,iconCls:"menu__icon text-orient-rup",checkable:!0,checkmark:!1,checked:!1,toggleGroup:"popupparagraphdirect",direction:Asc.c_oAscVertDrawingText.vert270}).on("click",e.bind(gt,i))]})}),ft=new Common.UI.MenuItem({iconCls:"menu__icon btn-paragraph",caption:i.advancedParagraphText}).on("click",e.bind(i.advancedParagraphClick,i)),Ct=new Common.UI.MenuItem({caption:i.advancedFrameText}).on("click",e.bind(i.advancedFrameClick,i,!0)),vt=new Common.UI.MenuItem({iconCls:"menu__icon dropcap-intext",caption:i.advancedDropCapText}).on("click",e.bind(i.advancedFrameClick,i,!1)),_t=new Common.UI.MenuItem({caption:"--"}),yt=new Common.UI.MenuItem({iconCls:"menu__icon btn-menu-comments",caption:i.addCommentText}).on("click",e.bind(i.addComment,i)),xt=new Common.UI.MenuItem({caption:"--"}),wt=new Common.UI.MenuItem({iconCls:"menu__icon btn-inserthyperlink",caption:i.hyperlinkText}).on("click",e.bind(i.addHyperlink,i)),St=new Common.UI.MenuItem({caption:i.editHyperlinkText}).on("click",e.bind(i.editHyperlink,i)),At=new Common.UI.MenuItem({caption:i.removeHyperlinkText}).on("click",function(t,e){i.api.remove_Hyperlink(t.hyperProps.value),i.fireEvent("editcomplete",i)}),kt=new Common.UI.MenuItem({iconCls:"menu__icon btn-inserthyperlink",caption:i.hyperlinkText,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[St,At]})}),Tt=new Common.UI.MenuItemSeparator,It=new Common.UI.MenuItem({caption:i.styleText,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[i.menuStyleSave=new Common.UI.MenuItem({caption:i.saveStyleText}).on("click",e.bind(i.onMenuSaveStyle,i)),i.menuStyleUpdate=new Common.UI.MenuItem({caption:i.updateStyleText.replace("%1",window.currentStyleName)}).on("click",e.bind(i.onMenuUpdateStyle,i))]})});i.menuSpellPara=new Common.UI.MenuItem({caption:i.loadSpellText,disabled:!0}),i.menuSpellMorePara=new Common.UI.MenuItem({caption:i.moreText,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",restoreHeight:!0,items:[]})}),i.langParaMenu=new Common.UI.MenuItem({iconCls:"menu__icon btn-ic-doclang",caption:i.langText,menu:new Common.UI.MenuSimple({cls:"lang-menu",menuAlign:"tl-tr",restoreHeight:285,items:[],itemTemplate:G,search:!0})});var Pt=new Common.UI.MenuItem({caption:i.ignoreSpellText}).on("click",function(t,e){i.api.asc_ignoreMisspelledWord(i._currentSpellObj,!1),i.fireEvent("editcomplete",i)}),Mt=new Common.UI.MenuItem({caption:i.ignoreAllSpellText}).on("click",function(t,e){i.api.asc_ignoreMisspelledWord(i._currentSpellObj,!0),i.fireEvent("editcomplete",i)}),Ut=new Common.UI.MenuItem({caption:i.toDictionaryText}).on("click",function(t,e){i.api.asc_spellCheckAddToDictionary(i._currentSpellObj),i.fireEvent("editcomplete",i)}),Bt=new Common.UI.MenuItem({caption:"--"}),Dt=new Common.UI.MenuItem({caption:"--"}),Et=new Common.UI.MenuItem({iconCls:"menu__icon btn-copy",caption:i.textCopy,value:"copy"}).on("click",e.bind(i.onCutCopyPaste,i)),Vt=new Common.UI.MenuItem({iconCls:"menu__icon btn-paste",caption:i.textPaste,value:"paste"}).on("click",e.bind(i.onCutCopyPaste,i)),Ft=new Common.UI.MenuItem({iconCls:"menu__icon btn-cut",caption:i.textCut,value:"cut"}).on("click",e.bind(i.onCutCopyPaste,i)),Rt=new Common.UI.MenuItem({iconCls:"menu__icon btn-print",caption:i.txtPrintSelection}).on("click",e.bind(i.onPrintSelection,i)),Lt=new Common.UI.MenuItem({caption:"--"}),Nt=new Common.UI.MenuItem({iconCls:"menu__icon cc-remove",caption:i.textRemoveControl,value:"remove"}).on("click",e.bind(i.onControlsSelect,i)),Ot=new Common.UI.MenuItem({caption:i.textEditControls,value:"settings"}).on("click",e.bind(i.onControlsSelect,i)),Ht=new Common.UI.MenuItem({caption:"--"}),zt=new Common.UI.MenuItem({caption:i.textTOCSettings,value:"settings"}).on("click",function(t,e){i.fireEvent("links:contents",[t.value,!0])}),$t=new Common.UI.MenuItem({caption:i.textUpdateTOC,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:i.textUpdateAll,value:"all"},{caption:i.textUpdatePages,value:"pages"}]})});$t.menu.on("item:click",function(t,e,n){i.fireEvent("links:update",[e.value,!0])});var Gt=new Common.UI.MenuItem({caption:"--"}),Wt=new Common.UI.MenuItem({caption:i.textRefreshField}).on("click",function(t,e){i.api.asc_UpdateComplexField(t.options.fieldProps),i.fireEvent("editcomplete",i)}),jt=new Common.UI.MenuItem({caption:"--"}),qt=new Common.UI.MenuItem({caption:i.textStartNewList}).on("click",e.bind(i.onStartNumbering,i,1)),Kt=new Common.UI.MenuItem({caption:i.textStartNumberingFrom}).on("click",e.bind(i.onStartNumbering,i,"advanced")),Yt=new Common.UI.MenuItem({caption:i.textContinueNumbering}).on("click",e.bind(i.onContinueNumbering,i)),Xt=new Common.UI.MenuItem({caption:"--"}),Jt=new Common.UI.MenuItem({caption:i.textFollow}).on("click",e.bind(i.onFollowMove,i)),Zt=new Common.UI.MenuItem({caption:"--"});this.textMenu=new Common.UI.Menu({cls:"shifted-right",initMenu:function(t){var n=t.imgProps&&t.imgProps.value&&!e.isNull(t.imgProps.value.get_ShapeProperties()),o=t.imgProps&&t.imgProps.value&&!e.isNull(t.imgProps.value.get_ChartProperties()),r=t.mathProps&&t.mathProps.value;if(ut.setVisible(n&&!o&&!r),bt.setVisible(n&&!o&&!r),n||o){var l=t.imgProps.value.get_VerticalTextAlign(),c="";switch(l){case Asc.c_oAscVAlign.Top:c="menu__icon btn-align-top";break;case Asc.c_oAscVAlign.Center:c="menu__icon btn-align-middle";break;case Asc.c_oAscVAlign.Bottom:c="menu__icon btn-align-bottom"}ut.setIconCls(c),i.menuParagraphTop.setChecked(l==Asc.c_oAscVAlign.Top),i.menuParagraphCenter.setChecked(l==Asc.c_oAscVAlign.Center),i.menuParagraphBottom.setChecked(l==Asc.c_oAscVAlign.Bottom);var d=t.imgProps.value.get_Vert();switch(c="",d){case Asc.c_oAscVertDrawingText.normal:c="menu__icon text-orient-hor";break;case Asc.c_oAscVertDrawingText.vert:c="menu__icon text-orient-rdown";break;case Asc.c_oAscVertDrawingText.vert270:c="menu__icon text-orient-rup"}bt.setIconCls(c),i.menuParagraphDirectH.setChecked(d==Asc.c_oAscVertDrawingText.normal),i.menuParagraphDirect90.setChecked(d==Asc.c_oAscVertDrawingText.vert),i.menuParagraphDirect270.setChecked(d==Asc.c_oAscVertDrawingText.vert270)}ft.isChart=t.imgProps&&t.imgProps.isChart,ht.setVisible(!n&&!o&&!r),pt.setVisible(!n&&!o&&!r),t.paraProps&&(ht.setChecked(t.paraProps.value.get_PageBreakBefore()),pt.setChecked(t.paraProps.value.get_KeepLines()));var h=null;i.api&&(h=i.api.can_AddHyperlink()),wt.setVisible(void 0===t.hyperProps&&!1!==h),kt.setVisible(void 0!==t.hyperProps),xt.setVisible(wt.isVisible()||kt.isVisible()),St.hyperProps=t.hyperProps,At.hyperProps=t.hyperProps,!1!==h&&(wt.hyperProps={},wt.hyperProps.value=new Asc.CHyperlinkProperty,wt.hyperProps.value.put_Text(h));var p=t.paraProps.locked||void 0!==t.headerProps&&t.headerProps.locked;i._currentParaObjDisabled=p,wt.setDisabled(p),kt.setDisabled(p||void 0!==t.hyperProps&&!0===t.hyperProps.isSeveralLinks);var m=i.api.asc_GetRevisionsChangesStack(),u=!1;Jt.value=null,e.each(m,function(t){t.get_Type()!=Asc.c_oAscRevisionsChangeType.TextAdd&&t.get_Type()!=Asc.c_oAscRevisionsChangeType.TextRem||t.get_MoveType()==Asc.c_oAscRevisionsMove.NoMove||(Jt.value=t,u=!0)}),Jt.setVisible(u),Zt.setVisible(u),ht.setDisabled(p||!e.isUndefined(t.headerProps)||!e.isUndefined(t.imgProps)),pt.setDisabled(p),ft.setDisabled(p),Ct.setDisabled(p),vt.setDisabled(p),ut.setDisabled(p),bt.setDisabled(p);var g=i.api&&i.api.can_CopyCut();Et.setDisabled(!g),Ft.setDisabled(p||!g),Vt.setDisabled(p),Rt.setVisible(i.mode.canPrint),Rt.setDisabled(!g);var b=void 0!==t.spellProps&&!1===t.spellProps.value.get_Checked();i.menuSpellPara.setVisible(b),Dt.setVisible(b),Pt.setVisible(b),Mt.setVisible(b),Ut.setVisible(b&&i.mode.isDesktopApp),i.langParaMenu.setVisible(b),i.langParaMenu.setDisabled(p),Bt.setVisible(b),b&&null!==t.spellProps.value.get_Variants()&&void 0!==t.spellProps.value.get_Variants()?i.addWordVariants(!0):(i.menuSpellPara.setCaption(i.loadSpellText,!0),i.clearWordVariants(!0),i.menuSpellMorePara.setVisible(!1)),i.langParaMenu.isVisible()&&i._currLang.id!==i._currLang.paraid&&(i.changeLanguageMenu(i.langParaMenu.menu),i._currLang.paraid=i._currLang.id);var f=0;r?f=i.addEquationMenu(!0,15):i.clearEquationMenu(!0,15),Lt.setVisible(r&&f>0),s.setVisible(r),a.setVisible(r);var C=t.paraProps.value.get_FramePr();Ct.setVisible(void 0!==C),vt.setVisible(void 0!==C),C&&vt.setIconCls(C.get_DropCap()===Asc.c_oAscDropCap.Drop?"menu__icon dropcap-intext":"menu__icon dropcap-inmargin"),Tt.setVisible(i.mode.canEditStyles&&!o),It.setVisible(i.mode.canEditStyles&&!o),i.mode.canEditStyles&&!o&&i.menuStyleUpdate.setCaption(i.updateStyleText.replace("%1",DE.getController("Main").translationTable[window.currentStyleName]||window.currentStyleName));var v=!!t.paraProps&&!(t.paraProps.value.can_DeleteBlockContentControl()&&t.paraProps.value.can_EditBlockContentControl()&&t.paraProps.value.can_DeleteInlineContentControl()&&t.paraProps.value.can_EditInlineContentControl()),_=i.api.asc_GetTableOfContentsPr(!0),y=!_&&i.api.asc_IsContentControl(),x=y?i.api.asc_GetContentControlProperties():null,w=x&&x.get_FormPr();if(Nt.setVisible(y),Ot.setVisible(y&&i.mode.canEditContentControl&&!w),Ht.setVisible(y),y){var S=x?x.get_Lock():Asc.c_oAscSdtLockType.Unlocked;Nt.setDisabled(S==Asc.c_oAscSdtLockType.SdtContentLocked||S==Asc.c_oAscSdtLockType.SdtLocked),Nt.setCaption(w?i.getControlLabel(x):i.textRemoveControl);var A=x?x.get_SpecificType():Asc.c_oAscContentControlSpecificType.None;v=v||A==Asc.c_oAscContentControlSpecificType.CheckBox||A==Asc.c_oAscContentControlSpecificType.Picture||A==Asc.c_oAscContentControlSpecificType.ComboBox||A==Asc.c_oAscContentControlSpecificType.DropDownList||A==Asc.c_oAscContentControlSpecificType.DateTime}zt.setVisible(_),$t.setVisible(_),Gt.setVisible(_);var k=!o&&!1!==i.api.can_AddQuotedComment()&&i.mode.canCoAuthoring&&i.mode.canComments&&!v;i.mode.compatibleFeatures&&(k=k&&!n),_t.setVisible(k),yt.setVisible(k),yt.setDisabled(t.paraProps&&!0===t.paraProps.locked);var T=i.api.asc_GetCurrentComplexField();Wt.setVisible(!!T),Wt.setDisabled(p),jt.setVisible(!!T),T&&(Wt.options.fieldProps=T);var I=i.api.asc_GetCurrentNumberingId(),P=null!==I;if(Xt.setVisible(P),qt.setVisible(P),Kt.setVisible(P),Yt.setVisible(P),P){var M=i.api.asc_GetNumberingPr(I).get_Lvl(i.api.asc_GetCurrentNumberingLvl()),U=M.get_Format(),B=i.api.asc_GetCalculatedNumberingValue();qt.setVisible(M.get_Start()!=B),qt.value={start:M.get_Start()},Kt.setVisible(U!=Asc.c_oAscNumberingFormat.Bullet),Kt.value={format:U,start:B},qt.setCaption(U==Asc.c_oAscNumberingFormat.Bullet?i.textSeparateList:i.textStartNewList),Yt.setCaption(U==Asc.c_oAscNumberingFormat.Bullet?i.textJoinList:i.textContinueNumbering)}},items:[i.menuSpellPara,i.menuSpellMorePara,Dt,Pt,Mt,Ut,i.langParaMenu,Bt,Ft,Et,Vt,Rt,a,s,{caption:"--"},Lt,Nt,Ot,Ht,Wt,jt,zt,$t,Gt,ht,pt,ut,bt,ft,Ct,vt,_t,yt,xt,wt,kt,Zt,Jt,Xt,qt,Kt,Yt,Tt,It]}).on("hide:after",function(t,e,n){if(i.suppressEditComplete)return void(i.suppressEditComplete=!1);n||i.fireEvent("editcomplete",i),i.currentMenu=null});var Qt=new Common.UI.MenuItem({caption:i.editHeaderText});this.hdrMenu=new Common.UI.Menu({cls:"shifted-right",initMenu:function(t){Qt.setCaption(t.Header?i.editHeaderText:i.editFooterText,!0),Qt.off("click").on("click",function(e){i.api&&(t.Header?i.api.GoToHeader(t.PageNum):i.api.GoToFooter(t.PageNum),i.fireEvent("editcomplete",i))})},items:[Qt]}).on("hide:after",function(t,e,n){n||i.fireEvent("editcomplete",i),i.currentMenu=null});var te=t("#id_buttonNextPage");te.attr("data-toggle","tooltip"),te.tooltip({title:i.textNextPage+Common.Utils.String.platformKey("Alt+PgDn"),placement:"top-right"});var ee=t("#id_buttonPrevPage");ee.attr("data-toggle","tooltip"),ee.tooltip({title:i.textPrevPage+Common.Utils.String.platformKey("Alt+PgUp"),placement:"top-right"})},setLanguages:function(t){var i=this;if(t&&t.length>0&&i.langParaMenu&&i.langTableMenu){var n=[],o=[];e.each(t,function(t){var i={caption:t.displayValue,value:t.value,checkable:!0,langid:t.code,spellcheck:t.spellcheck};n.push(i),o.push(e.clone(i))}),i.langParaMenu.menu.resetItems(n),i.langTableMenu.menu.resetItems(o),i.langParaMenu.menu.on("item:click",function(t,n){i.api&&(e.isUndefined(n.langid)||i.api.put_TextPrLang(n.langid),i._currLang.paraid=n.langid,i.fireEvent("editcomplete",i))}),i.langTableMenu.menu.on("item:click",function(t,n,o){i.api&&(e.isUndefined(n.langid)||i.api.put_TextPrLang(n.langid),i._currLang.tableid=n.langid,i.fireEvent("editcomplete",i))})}},onSignatureClick:function(t){var e=t.cmpEl.attr("data-value");switch(t.value){case 0:Common.NotificationCenter.trigger("protect:sign",e);break;case 1:this.api.asc_ViewCertificate(e);break;case 2:Common.NotificationCenter.trigger("protect:signature","visible",this._isDisabled,e);break;case 3:var i=this;Common.UI.warning({title:this.notcriticalErrorTitle,msg:this.txtRemoveWarning,buttons:["ok","cancel"],primary:"ok",callback:function(t){"ok"==t&&i.api.asc_RemoveSignature(e)}})}},onImgRotate:function(t){var e=new Asc.asc_CImgProperty;e.asc_putRotAdd(3.14159265358979*(1==t.value?90:270)/180),this.api.ImgApply(e),this.fireEvent("editcomplete",this)},onImgFlip:function(t){var e=new Asc.asc_CImgProperty;1==t.value?e.asc_putFlipHInvert(!0):e.asc_putFlipVInvert(!0),this.api.ImgApply(e),this.fireEvent("editcomplete",this)},onImgCrop:function(t){1==t.value?this.api.asc_cropFill():2==t.value?this.api.asc_cropFit():t.checked?this.api.asc_startEditCrop():this.api.asc_endEditCrop(),this.fireEvent("editcomplete",this)},onFollowMove:function(t){this.api&&this.api.asc_FollowRevisionMove(t.value),this.fireEvent("editcomplete",this)},onHideContentControlsActions:function(){this.listControlMenu&&this.listControlMenu.isVisible()&&this.listControlMenu.hide();var t=this.cmpEl.find("#calendar-control-container");t.is(":visible")&&t.hide()},onShowDateActions:function(e,i,n){var o=e.pr,s=o.get_DateTimePr(),a=this.cmpEl.find("#calendar-control-container"),r=this;this._dateObj=o,a.length<1&&(a=t('<div id="calendar-control-container" style="position: absolute;z-index: 1000;"><div id="id-document-calendar-control" style="position: fixed; left: -1000px; top: -1000px;"></div></div>'),this.cmpEl.append(a)),Common.UI.Menu.Manager.hideAll(),a.css({left:i,top:n}),a.show(),this.cmpCalendar||(this.cmpCalendar=new Common.UI.Calendar({el:this.cmpEl.find("#id-document-calendar-control"),enableKeyEvents:!0,firstday:1}),this.cmpCalendar.on("date:click",function(t,e){var i=r._dateObj.get_DateTimePr();i.put_FullDate(new Date(e)),r.api.asc_SetContentControlDatePickerDate(i),a.hide(),r.api.asc_UncheckContentControlButtons(),r.fireEvent("editcomplete",r)}),this.cmpCalendar.on("calendar:keydown",function(t,e){e.keyCode==Common.UI.Keys.ESC&&(a.hide(),r.api.asc_UncheckContentControlButtons())}),t(document).on("mousedown",function(t){"canvas"!==t.target.localName&&a.is(":visible")&&0==a.find(t.target).length&&(a.hide(),r.api.asc_UncheckContentControlButtons())})),this.cmpCalendar.setDate(new Date(s?s.get_FullDate():void 0));var l=a.offset(),c=Common.Utils.innerWidth(),d=Common.Utils.innerHeight()-10,h=this.cmpCalendar.cmpEl.outerWidth(),p=this.cmpCalendar.cmpEl.outerHeight(),m=l.left-h,u=l.top;u+p>d&&(u=d-p,m-=22),u<0&&(u=0),m+h>c&&(m=c-h),this.cmpCalendar.cmpEl.css({left:m,top:u}),this._preventClick=!0},onShowListActions:function(i,n,o){var s=i.type,a=i.pr,r=s==Asc.c_oAscContentControlSpecificType.ComboBox?a.get_ComboBoxPr():a.get_DropDownListPr(),l=!!a.get_FormPr(),c=this.listControlMenu,d=c?this.cmpEl.find(Common.Utils.String.format("#menu-container-{0}",c.id)):null,h=this;if(this._listObj=a,this._fromShowContentControls=!0,Common.UI.Menu.Manager.hideAll(),c||(this.listControlMenu=c=new Common.UI.Menu({maxHeight:207,menuAlign:"tr-bl",items:[]}),c.on("item:click",function(t,e){setTimeout(function(){-1!==e.value&&h.api.asc_SelectContentControlListItem(e.value,h._listObj.get_InternalId())},1)}),(!d||d.length<1)&&(d=t(Common.Utils.String.format('<div id="menu-container-{0}" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',c.id)),this.cmpEl.append(d)),c.render(d),c.cmpEl.attr({tabindex:"-1"}),c.on("hide:after",function(){h.listControlMenu.removeAll(),h._fromShowContentControls||h.api.asc_UncheckContentControlButtons()})),r){if(l){var p=a.get_PlaceholderText();c.addItem(new Common.UI.MenuItem({caption:""!==p.trim()?p:this.txtEmpty,value:"",template:e.template(['<a id="<%= id %>" tabindex="-1" type="menuitem" style="<% if (options.value=="") { %> opacity: 0.6 <% } %>">',"<%= caption %>","</a>"].join(""))}))}for(var m=r.get_ItemsCount(),u=0;u<m;u++)(""!==r.get_ItemValue(u)||!l)&&c.addItem(new Common.UI.MenuItem({caption:r.get_ItemDisplayText(u),value:r.get_ItemValue(u),template:e.template(['<a id="<%= id %>" style="<%= style %>" tabindex="-1" type="menuitem">',"<%= Common.Utils.String.htmlEncode(caption) %>","</a>"].join(""))}));!l&&c.items.length<1&&c.addItem(new Common.UI.MenuItem({caption:this.txtEmpty,value:-1}))}d.css({left:n,top:o}),d.attr("data-value","prevent-canvas-click"),this._preventClick=!0,c.show(),e.delay(function(){c.cmpEl.focus()},10),this._fromShowContentControls=!1},onShowContentControlsActions:function(t,e,i){switch(t.type){case Asc.c_oAscContentControlSpecificType.DateTime:this.onShowDateActions(t,e,i);break;case Asc.c_oAscContentControlSpecificType.Picture:if(t.pr&&t.pr.get_Lock){var n=t.pr.get_Lock();if(n==Asc.c_oAscSdtLockType.SdtContentLocked||n==Asc.c_oAscSdtLockType.ContentLocked)return}this.api.asc_addImage(t);var o=this;setTimeout(function(){o.api.asc_UncheckContentControlButtons()},500);break;case Asc.c_oAscContentControlSpecificType.DropDownList:case Asc.c_oAscContentControlSpecificType.ComboBox:this.onShowListActions(t,e,i)}},onApiLockDocumentProps:function(){this._state.lock_doc=!0},onApiUnLockDocumentProps:function(){this._state.lock_doc=!1},getControlLabel:function(t){switch(t?t.get_SpecificType():Asc.c_oAscContentControlSpecificType.None){case Asc.c_oAscContentControlSpecificType.CheckBox:return"string"!=typeof t.get_CheckBoxPr().get_GroupKey()?this.textRemCheckBox:this.textRemRadioBox;case Asc.c_oAscContentControlSpecificType.ComboBox:return this.textRemComboBox;case Asc.c_oAscContentControlSpecificType.DropDownList:return this.textRemDropdown;case Asc.c_oAscContentControlSpecificType.Picture:return this.textRemPicture;default:return this.textRemField}},focus:function(){var t=this;e.defer(function(){t.cmpEl.focus()},50)},SetDisabled:function(t,e){this._isDisabled=t,this._canProtect=e},alignmentText:"Alignment",leftText:"Left",rightText:"Right",centerText:"Center",selectRowText:"Select Row",selectColumnText:"Select Column",selectCellText:"Select Cell",selectTableText:"Select Table",insertRowAboveText:"Row Above",insertRowBelowText:"Row Below",insertColumnLeftText:"Column Left",insertColumnRightText:"Column Right",deleteText:"Delete",deleteRowText:"Delete Row",deleteColumnText:"Delete Column",deleteTableText:"Delete Table",mergeCellsText:"Merge Cells",splitCellsText:"Split Cell...",splitCellTitleText:"Split Cell",originalSizeText:"Actual Size",advancedText:"Advanced Settings",breakBeforeText:"Page break before",keepLinesText:"Keep lines together",editHeaderText:"Edit header",editFooterText:"Edit footer",hyperlinkText:"Hyperlink",editHyperlinkText:"Edit Hyperlink",removeHyperlinkText:"Remove Hyperlink",styleText:"Formatting as Style",saveStyleText:"Create new style",updateStyleText:"Update %1 style",txtPressLink:"Press CTRL and click link",selectText:"Select",insertRowText:"Insert Row",insertColumnText:"Insert Column",rowText:"Row",columnText:"Column",cellText:"Cell",tableText:"Table",aboveText:"Above",belowText:"Below",advancedTableText:"Table Advanced Settings",advancedParagraphText:"Paragraph Advanced Settings",paragraphText:"Paragraph",guestText:"Guest",editChartText:"Edit Data",addCommentText:"Add Comment",cellAlignText:"Cell Vertical Alignment",txtInline:"Inline",txtSquare:"Square",txtTight:"Tight",txtThrough:"Through",txtTopAndBottom:"Top and bottom",txtBehind:"Behind",txtInFront:"In front",textWrap:"Wrapping Style",textAlign:"Align",textArrange:"Arrange",textShapeAlignLeft:"Align Left",textShapeAlignRight:"Align Right",textShapeAlignCenter:"Align Center",textShapeAlignTop:"Align Top",textShapeAlignBottom:"Align Bottom",textShapeAlignMiddle:"Align Middle",textArrangeFront:"Bring To Front",textArrangeBack:"Send To Back",textArrangeForward:"Bring Forward",textArrangeBackward:"Send Backward",txtGroup:"Group",txtUngroup:"Ungroup",textEditWrapBoundary:"Edit Wrap Boundary",vertAlignText:"Vertical Alignment",loadSpellText:"Loading variants...",ignoreAllSpellText:"Ignore All",ignoreSpellText:"Ignore",noSpellVariantsText:"No variants",moreText:"More variants...",spellcheckText:"Spellcheck",langText:"Select Language",advancedFrameText:"Frame Advanced Settings",tipIsLocked:"This element is being edited by another user.",textNextPage:"Next Page",textPrevPage:"Previous Page",imageText:"Image Advanced Settings",shapeText:"Shape Advanced Settings",chartText:"Chart Advanced Settings",insertText:"Insert",textCopy:"Copy",textPaste:"Paste",textCut:"Cut",directionText:"Text Direction",directHText:"Horizontal",direct90Text:"Rotate Text Down",direct270Text:"Rotate Text UpÂ°",txtRemoveAccentChar:"Remove accent character",txtBorderProps:"Borders property",txtHideTop:"Hide top border",txtHideBottom:"Hide bottom border",txtHideLeft:"Hide left border",txtHideRight:"Hide right border",txtHideHor:"Hide horizontal line",txtHideVer:"Hide vertical line",txtHideLT:"Hide left top line",txtHideLB:"Hide left bottom line",txtAddTop:"Add top border",txtAddBottom:"Add bottom border",txtAddLeft:"Add left border",txtAddRight:"Add right border",txtAddHor:"Add horizontal line",txtAddVer:"Add vertical line",txtAddLT:"Add left top line",txtAddLB:"Add left bottom line",txtRemoveBar:"Remove bar",txtOverbar:"Bar over text",txtUnderbar:"Bar under text",txtRemScripts:"Remove scripts",txtRemSubscript:"Remove subscript",txtRemSuperscript:"Remove superscript",txtScriptsAfter:"Scripts after text",txtScriptsBefore:"Scripts before text",txtFractionStacked:"Change to stacked fraction",txtFractionSkewed:"Change to skewed fraction",txtFractionLinear:"Change to linear fraction",txtRemFractionBar:"Remove fraction bar",txtAddFractionBar:"Add fraction bar",txtRemLimit:"Remove limit",txtLimitOver:"Limit over text",txtLimitUnder:"Limit under text",txtHidePlaceholder:"Hide placeholder",txtShowPlaceholder:"Show placeholder",txtMatrixAlign:"Matrix alignment",txtColumnAlign:"Column alignment",txtTop:"Top",txtBottom:"Bottom",txtInsertEqBefore:"Insert equation before",txtInsertEqAfter:"Insert equation after",txtDeleteEq:"Delete equation",txtLimitChange:"Change limits location",txtHideTopLimit:"Hide top limit",txtShowTopLimit:"Show top limit",txtHideBottomLimit:"Hide bottom limit",txtShowBottomLimit:"Show bottom limit",txtInsertArgBefore:"Insert argument before",txtInsertArgAfter:"Insert argument after",txtDeleteArg:"Delete argument",txtHideOpenBracket:"Hide opening bracket",txtShowOpenBracket:"Show opening bracket",txtHideCloseBracket:"Hide closing bracket",txtShowCloseBracket:"Show closing bracket",txtStretchBrackets:"Stretch brackets",txtMatchBrackets:"Match brackets to argument height",txtGroupCharOver:"Char over text",txtGroupCharUnder:"Char under text",txtDeleteGroupChar:"Delete char",txtHideDegree:"Hide degree",txtShowDegree:"Show degree",txtIncreaseArg:"Increase argument size",txtDecreaseArg:"Decrease argument size",txtInsertBreak:"Insert manual break",txtDeleteBreak:"Delete manual break",txtAlignToChar:"Align to character",txtDeleteRadical:"Delete radical",txtDeleteChars:"Delete enclosing characters",txtDeleteCharsAndSeparators:"Delete enclosing characters and separators",txtKeepTextOnly:"Keep text only",textUndo:"Undo",strSign:"Sign",strDetails:"Signature Details",strSetup:"Signature Setup",strDelete:"Remove Signature",txtOverwriteCells:"Overwrite cells",textNest:"Nest table",textContentControls:"Content control",textRemove:"Remove",textSettings:"Settings",textRemoveControl:"Remove content control",textEditControls:"Content control settings",textDistributeRows:"Distribute rows",textDistributeCols:"Distribute columns",textUpdateTOC:"Refresh table of contents",textUpdateAll:"Refresh entire table",textUpdatePages:"Refresh page numbers only",textTOCSettings:"Table of contents settings",textTOC:"Table of contents",textRefreshField:"Refresh field",txtPasteSourceFormat:"Keep source formatting",textReplace:"Replace image",textFromUrl:"From URL",textFromFile:"From File",textStartNumberingFrom:"Set numbering value",textStartNewList:"Start new list",textContinueNumbering:"Continue numbering",textSeparateList:"Separate list",textJoinList:"Join to previous list",textNumberingValue:"Numbering Value",bulletsText:"Bullets and Numbering",txtDistribHor:"Distribute Horizontally",txtDistribVert:"Distribute Vertically",textRotate270:"Rotate 90Â° Counterclockwise",textRotate90:"Rotate 90Â° Clockwise",textFlipV:"Flip Vertically",textFlipH:"Flip Horizontally",textRotate:"Rotate",textCrop:"Crop",textCropFill:"Fill",textCropFit:"Fit",textFollow:"Follow move",toDictionaryText:"Add to Dictionary",txtPrintSelection:"Print Selection",textCells:"Cells",textSeveral:"Several Rows/Columns",txtInsertCaption:"Insert Caption",txtEmpty:"(Empty)",textFromStorage:"From Storage",advancedDropCapText:"Drop Cap Settings",textTitleCellsRemove:"Delete Cells",textLeft:"Shift cells left",textRow:"Delete entire row",textCol:"Delete entire column",textRemCheckBox:"Remove Checkbox",textRemRadioBox:"Remove Radio Button",textRemComboBox:"Remove Combo Box",textRemDropdown:"Remove Dropdown",textRemPicture:"Remove Image",textRemField:"Remove Text Field",txtRemoveWarning:"Do you want to remove this signature?<br>It can't be undone.",notcriticalErrorTitle:"Warning"},DE.Views.DocumentHolder||{}))});var c_paragraphLinerule={LINERULE_LEAST:0,LINERULE_AUTO:1,LINERULE_EXACT:2},c_paragraphSpecial={NONE_SPECIAL:0,FIRST_LINE:1,HANGING:2},c_paragraphTextAlignment={RIGHT:0,LEFT:1,CENTERED:2,JUSTIFIED:3},c_pageNumPosition={PAGE_NUM_POSITION_TOP:1,PAGE_NUM_POSITION_BOTTOM:2,PAGE_NUM_POSITION_RIGHT:0,PAGE_NUM_POSITION_LEFT:1,PAGE_NUM_POSITION_CENTER:2},c_tableWrap={TABLE_WRAP_NONE:0,TABLE_WRAP_PARALLEL:1},c_tableAlign={TABLE_ALIGN_LEFT:0,TABLE_ALIGN_CENTER:1,TABLE_ALIGN_RIGHT:2},c_tableBorder={BORDER_VERTICAL_LEFT:0,BORDER_HORIZONTAL_TOP:1,BORDER_VERTICAL_RIGHT:2,BORDER_HORIZONTAL_BOTTOM:3,BORDER_VERTICAL_CENTER:4,BORDER_HORIZONTAL_CENTER:5,BORDER_INNER:6,BORDER_OUTER:7,BORDER_ALL:8,BORDER_NONE:9,BORDER_ALL_TABLE:10,BORDER_NONE_TABLE:11,BORDER_INNER_TABLE:12,BORDER_OUTER_TABLE:13};if(define("documenteditor/main/app/controller/DocumentHolder",["core","documenteditor/main/app/view/DocumentHolder"],function(){"use strict";DE.Controllers.DocumentHolder=Backbone.Controller.extend({models:[],collections:[],views:["DocumentHolder"],initialize:function(){},onLaunch:function(){this.documentHolder=this.createView("DocumentHolder").render(),this.documentHolder.el.tabIndex=-1},setApi:function(t){this.api=t},createDelayedElements:function(){var t=this.getApplication().getController("Common.Controllers.ExternalDiagramEditor").getView("Common.Views.ExternalDiagramEditor");t&&(t.on("internalmessage",_.bind(function(e,i){var n=(i.data.command,i.data.data);this.api&&(t.isEditMode()?this.api.asc_editChartDrawingObject(n):this.api.asc_addChartDrawingObject(n))},this)),t.on("hide",_.bind(function(t,e){this.api&&(this.api.asc_onCloseChartFrame(),this.api.asc_enableKeyEvents(!0));var i=this;setTimeout(function(){i.documentHolder.fireEvent("editcomplete",i.documentHolder)},10)},this)));var e=this.getApplication().getController("Common.Controllers.ExternalMergeEditor").getView("Common.Views.ExternalMergeEditor");e&&(e.on("internalmessage",_.bind(function(t,e){var i=(e.data.command,e.data.data);this.api&&this.api.asc_setMailMergeData(i)},this)),e.on("hide",_.bind(function(t,e){this.api&&this.api.asc_enableKeyEvents(!0);var i=this;setTimeout(function(){i.documentHolder.fireEvent("editcomplete",i.documentHolder)},10)},this)))},getView:function(t){return t?Backbone.Controller.prototype.getView.call():this.documentHolder}})}),define("common/main/lib/view/ImageFromUrlDialog",["common/main/lib/component/Window"],function(){"use strict";Common.Views.ImageFromUrlDialog=Common.UI.Window.extend(_.extend({options:{width:330,header:!1,cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,t||{}),this.template=['<div class="box">','<div class="input-row">',"<label>"+(this.options.title||this.textUrl)+"</label>","</div>",'<div id="id-dlg-url" class="input-row"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this;t.inputUrl=new Common.UI.InputField({el:$("#id-dlg-url"),allowBlank:!1,blankError:t.txtEmpty,style:"width: 100%;",validateOnBlur:!1,validation:function(e){return!!/((^https?)|(^ftp)):\/\/.+/i.test(e)||t.txtNotUrl}}),this.getChild().find(".btn").on("click",_.bind(this.onBtnClick,this))},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var t=this;_.delay(function(){t.getChild("input").focus()},100)},onPrimary:function(t){return this._handleInput("ok"),!1},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},_handleInput:function(t){if(this.options.handler){if("ok"==t&&!0!==this.inputUrl.checkValidate())return void this.inputUrl.cmpEl.find("input").focus();this.options.handler.call(this,t,this.inputUrl.getValue())}this.close()},textUrl:"Paste an image URL:",txtEmpty:"This field is required",txtNotUrl:'This field should be a URL in the format "http://www.example.com"'},Common.Views.ImageFromUrlDialog||{}))}),void 0===Common)var Common={};if(define("common/main/lib/component/LoadMask",["common/main/lib/component/BaseView"],function(){"use strict";Common.UI.LoadMask=Common.UI.BaseView.extend(function(){return{options:{cls:"",style:"",title:"Loading...",owner:document.body},template:_.template(['<div id="<%= id %>" class="asc-loadmask-body <%= cls %>" role="presentation" tabindex="-1">','<i id="loadmask-spinner" class="asc-loadmask-image"></i>','<div class="asc-loadmask-title"><%= title %></div>',"</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.template=this.options.template||this.template,this.title=this.options.title,
this.ownerEl=this.options.owner instanceof Common.UI.BaseView?$(this.options.owner.el):$(this.options.owner),this.loaderEl=$(this.template({id:this.id,cls:this.options.cls,style:this.options.style,title:this.title})),this.maskeEl=$('<div class="asc-loadmask"></div>'),this.timerId=0},render:function(){return this},internalShowLoader:function(){this.ownerEl.append(this.loaderEl),this.loaderEl.css("min-width",$(".asc-loadmask-title",this.loaderEl).width()+105),this.ownerEl&&0==this.ownerEl.closest(".asc-window.modal").length&&Common.util.Shortcuts.suspendEvents()},internalShowMask:function(){this.ownerEl.ismasked||(this.ownerEl.ismasked=!0,this.ownerEl.append(this.maskeEl))},show:function(t){if(this.internalShowMask(),this.ownerEl.hasloader)return this;this.ownerEl.hasloader=!0;var e=this;return e.title!=e.options.title&&(e.options.title=e.title,$(".asc-loadmask-title",this.loaderEl).html(e.title)),t?e.internalShowLoader():e.timerId||(e.timerId=setTimeout(function(){e.internalShowLoader()},500)),this},hide:function(){var t=this.ownerEl;this.timerId&&(clearTimeout(this.timerId),this.timerId=0),t&&t.ismasked&&this.maskeEl&&this.maskeEl.remove(),delete t.ismasked,t&&t.hasloader&&(0!=t.closest(".asc-window.modal").length||Common.Utils.ModalWindow.isVisible()||Common.util.Shortcuts.resumeEvents(),this.loaderEl&&this.loaderEl.remove()),delete t.hasloader},setTitle:function(t){if(this.title=t,this.ownerEl&&this.ownerEl.hasloader&&this.loaderEl){var e=$(".asc-loadmask-title",this.loaderEl);e.html(t),this.loaderEl.css("min-width",e.width()+105)}},isVisible:function(){return!!this.ownerEl.ismasked},updatePosition:function(){var t=this.ownerEl,e=this.loaderEl;t&&t.hasloader&&e&&(e.css({top:Math.round(t.height()/2-(e.height()+parseInt(e.css("padding-top"))+parseInt(e.css("padding-bottom")))/2)+"px",left:Math.round(t.width()/2-(e.width()+parseInt(e.css("padding-left"))+parseInt(e.css("padding-right")))/2)+"px"}),e.css({visibility:"visible"}))}}}())}),define("common/main/lib/view/SelectFileDlg",["common/main/lib/component/Window","common/main/lib/component/LoadMask"],function(){"use strict";Common.Views.SelectFileDlg=Common.UI.Window.extend(_.extend({initialize:function(t){var e={};_.extend(e,{title:this.textTitle,width:1024,height:621,header:!0},t),this.template=['<div id="id-select-file-placeholder"></div>'].join(""),e.tpl=_.template(this.template)(e),this.fileChoiceUrl=t.fileChoiceUrl||"",Common.UI.Window.prototype.initialize.call(this,e)},render:function(){Common.UI.Window.prototype.render.call(this),this.$window.find("> .body").css({height:"auto",overflow:"hidden"});var t=document.createElement("iframe");t.width="100%",t.height=585,t.align="top",t.frameBorder=0,t.scrolling="no",t.onload=_.bind(this._onLoad,this),$("#id-select-file-placeholder").append(t),this.loadMask=new Common.UI.LoadMask({owner:$("#id-select-file-placeholder")}),this.loadMask.setTitle(this.textLoading),this.loadMask.show(),t.src=this.fileChoiceUrl;var e=this;this._eventfunc=function(t){e._onWindowMessage(t)},this._bindWindowEvents.call(this),this.on("close",function(t){e._unbindWindowEvents()})},_bindWindowEvents:function(){window.addEventListener?window.addEventListener("message",this._eventfunc,!1):window.attachEvent&&window.attachEvent("onmessage",this._eventfunc)},_unbindWindowEvents:function(){window.removeEventListener?window.removeEventListener("message",this._eventfunc):window.detachEvent&&window.detachEvent("onmessage",this._eventfunc)},_onWindowMessage:function(t){if(t&&window.JSON)try{this._onMessage.call(this,window.JSON.parse(t.data))}catch(t){}},_onMessage:function(t){if(t&&"onlyoffice"==t.Referer&&void 0!==t.file){Common.NotificationCenter.trigger("window:close",this);var e=this;setTimeout(function(){_.isEmpty(t.file)||e.trigger("selectfile",e,t.file)},50)}},_onLoad:function(){this.loadMask&&this.loadMask.hide()},textTitle:"Select Data Source",textLoading:"Loading"},Common.Views.SelectFileDlg||{}))}),void 0===Common)var Common={};if(void 0===Common.define&&(Common.define={}),define("common/main/lib/util/define",[],function(){"use strict";Common.define.c_oAscMathMainType={Symbol:0,Fraction:1,Script:2,Radical:3,Integral:4,LargeOperator:5,Bracket:6,Function:7,Accent:8,LimitLog:9,Operator:10,Matrix:11},Common.define.c_oAscMathType={Symbol_pm:0,Symbol_infinity:1,Symbol_equals:2,Symbol_neq:3,Symbol_about:4,Symbol_times:5,Symbol_div:6,Symbol_factorial:7,Symbol_propto:8,Symbol_less:9,Symbol_ll:10,Symbol_greater:11,Symbol_gg:12,Symbol_leq:13,Symbol_geq:14,Symbol_mp:15,Symbol_cong:16,Symbol_approx:17,Symbol_equiv:18,Symbol_forall:19,Symbol_additional:20,Symbol_partial:21,Symbol_sqrt:22,Symbol_cbrt:23,Symbol_qdrt:24,Symbol_cup:25,Symbol_cap:26,Symbol_emptyset:27,Symbol_percent:28,Symbol_degree:29,Symbol_fahrenheit:30,Symbol_celsius:31,Symbol_inc:32,Symbol_nabla:33,Symbol_exists:34,Symbol_notexists:35,Symbol_in:36,Symbol_ni:37,Symbol_leftarrow:38,Symbol_uparrow:39,Symbol_rightarrow:40,Symbol_downarrow:41,Symbol_leftrightarrow:42,Symbol_therefore:43,Symbol_plus:44,Symbol_minus:45,Symbol_not:46,Symbol_ast:47,Symbol_bullet:48,Symbol_vdots:49,Symbol_cdots:50,Symbol_rddots:51,Symbol_ddots:52,Symbol_aleph:53,Symbol_beth:54,Symbol_QED:55,Symbol_alpha:65536,Symbol_beta:65537,Symbol_gamma:65538,Symbol_delta:65539,Symbol_varepsilon:65540,Symbol_epsilon:65541,Symbol_zeta:65542,Symbol_eta:65543,Symbol_theta:65544,Symbol_vartheta:65545,Symbol_iota:65546,Symbol_kappa:65547,Symbol_lambda:65548,Symbol_mu:65549,Symbol_nu:65550,Symbol_xsi:65551,Symbol_o:65552,Symbol_pi:65553,Symbol_varpi:65554,Symbol_rho:65555,Symbol_varrho:65556,Symbol_sigma:65557,Symbol_varsigma:65558,Symbol_tau:65559,Symbol_upsilon:65560,Symbol_varphi:65561,Symbol_phi:65562,Symbol_chi:65563,Symbol_psi:65564,Symbol_omega:65565,Symbol_Alpha:131072,Symbol_Beta:131073,Symbol_Gamma:131074,Symbol_Delta:131075,Symbol_Epsilon:131076,Symbol_Zeta:131077,Symbol_Eta:131078,Symbol_Theta:131079,Symbol_Iota:131080,Symbol_Kappa:131081,Symbol_Lambda:131082,Symbol_Mu:131083,Symbol_Nu:131084,Symbol_Xsi:131085,Symbol_O:131086,Symbol_Pi:131087,Symbol_Rho:131088,Symbol_Sigma:131089,Symbol_Tau:131090,Symbol_Upsilon:131091,Symbol_Phi:131092,Symbol_Chi:131093,Symbol_Psi:131094,Symbol_Omega:131095,FractionVertical:16777216,FractionDiagonal:16777217,FractionHorizontal:16777218,FractionSmall:16777219,FractionDifferential_1:16842752,FractionDifferential_2:16842753,FractionDifferential_3:16842754,FractionDifferential_4:16842755,FractionPi_2:16842756,ScriptSup:33554432,ScriptSub:33554433,ScriptSubSup:33554434,ScriptSubSupLeft:33554435,ScriptCustom_1:33619968,ScriptCustom_2:33619969,ScriptCustom_3:33619970,ScriptCustom_4:33619971,RadicalSqrt:50331648,RadicalRoot_n:50331649,RadicalRoot_2:50331650,RadicalRoot_3:50331651,RadicalCustom_1:50397184,RadicalCustom_2:50397185,Integral:67108864,IntegralSubSup:67108865,IntegralCenterSubSup:67108866,IntegralDouble:67108867,IntegralDoubleSubSup:67108868,IntegralDoubleCenterSubSup:67108869,IntegralTriple:67108870,IntegralTripleSubSup:67108871,IntegralTripleCenterSubSup:67108872,IntegralOriented:67174400,IntegralOrientedSubSup:67174401,IntegralOrientedCenterSubSup:67174402,IntegralOrientedDouble:67174403,IntegralOrientedDoubleSubSup:67174404,IntegralOrientedDoubleCenterSubSup:67174405,IntegralOrientedTriple:67174406,IntegralOrientedTripleSubSup:67174407,IntegralOrientedTripleCenterSubSup:67174408,Integral_dx:67239936,Integral_dy:67239937,Integral_dtheta:67239938,LargeOperator_Sum:83886080,LargeOperator_Sum_CenterSubSup:83886081,LargeOperator_Sum_SubSup:83886082,LargeOperator_Sum_CenterSub:83886083,LargeOperator_Sum_Sub:83886084,LargeOperator_Prod:83951616,LargeOperator_Prod_CenterSubSup:83951617,LargeOperator_Prod_SubSup:83951618,LargeOperator_Prod_CenterSub:83951619,LargeOperator_Prod_Sub:83951620,LargeOperator_CoProd:83951621,LargeOperator_CoProd_CenterSubSup:83951622,LargeOperator_CoProd_SubSup:83951623,LargeOperator_CoProd_CenterSub:83951624,LargeOperator_CoProd_Sub:83951625,LargeOperator_Union:84017152,LargeOperator_Union_CenterSubSup:84017153,LargeOperator_Union_SubSup:84017154,LargeOperator_Union_CenterSub:84017155,LargeOperator_Union_Sub:84017156,LargeOperator_Intersection:84017157,LargeOperator_Intersection_CenterSubSup:84017158,LargeOperator_Intersection_SubSup:84017159,LargeOperator_Intersection_CenterSub:84017160,LargeOperator_Intersection_Sub:84017161,LargeOperator_Disjunction:84082688,LargeOperator_Disjunction_CenterSubSup:84082689,LargeOperator_Disjunction_SubSup:84082690,LargeOperator_Disjunction_CenterSub:84082691,LargeOperator_Disjunction_Sub:84082692,LargeOperator_Conjunction:84082693,LargeOperator_Conjunction_CenterSubSup:84082694,LargeOperator_Conjunction_SubSup:84082695,LargeOperator_Conjunction_CenterSub:84082696,LargeOperator_Conjunction_Sub:84082697,LargeOperator_Custom_1:84148224,LargeOperator_Custom_2:84148225,LargeOperator_Custom_3:84148226,LargeOperator_Custom_4:84148227,LargeOperator_Custom_5:84148228,Bracket_Round:100663296,Bracket_Square:100663297,Bracket_Curve:100663298,Bracket_Angle:100663299,Bracket_LowLim:100663300,Bracket_UppLim:100663301,Bracket_Line:100663302,Bracket_LineDouble:100663303,Bracket_Square_OpenOpen:100663304,Bracket_Square_CloseClose:100663305,Bracket_Square_CloseOpen:100663306,Bracket_SquareDouble:100663307,Bracket_Round_Delimiter_2:100728832,Bracket_Curve_Delimiter_2:100728833,Bracket_Angle_Delimiter_2:100728834,Bracket_Angle_Delimiter_3:100728835,Bracket_Round_OpenNone:100794368,Bracket_Round_NoneOpen:100794369,Bracket_Square_OpenNone:100794370,Bracket_Square_NoneOpen:100794371,Bracket_Curve_OpenNone:100794372,Bracket_Curve_NoneOpen:100794373,Bracket_Angle_OpenNone:100794374,Bracket_Angle_NoneOpen:100794375,Bracket_LowLim_OpenNone:100794376,Bracket_LowLim_NoneNone:100794377,Bracket_UppLim_OpenNone:100794378,Bracket_UppLim_NoneOpen:100794379,Bracket_Line_OpenNone:100794380,Bracket_Line_NoneOpen:100794381,Bracket_LineDouble_OpenNone:100794382,Bracket_LineDouble_NoneOpen:100794383,Bracket_SquareDouble_OpenNone:100794384,Bracket_SquareDouble_NoneOpen:100794385,Bracket_Custom_1:100859904,Bracket_Custom_2:100859905,Bracket_Custom_3:100859906,Bracket_Custom_4:100859907,Bracket_Custom_5:100925440,Bracket_Custom_6:100925441,Bracket_Custom_7:100925442,Function_Sin:117440512,Function_Cos:117440513,Function_Tan:117440514,Function_Csc:117440515,Function_Sec:117440516,Function_Cot:117440517,Function_1_Sin:117506048,Function_1_Cos:117506049,Function_1_Tan:117506050,Function_1_Csc:117506051,Function_1_Sec:117506052,Function_1_Cot:117506053,Function_Sinh:117571584,Function_Cosh:117571585,Function_Tanh:117571586,Function_Csch:117571587,Function_Sech:117571588,Function_Coth:117571589,Function_1_Sinh:117637120,Function_1_Cosh:117637121,Function_1_Tanh:117637122,Function_1_Csch:117637123,Function_1_Sech:117637124,Function_1_Coth:117637125,Function_Custom_1:117702656,Function_Custom_2:117702657,Function_Custom_3:117702658,Accent_Dot:134217728,Accent_DDot:134217729,Accent_DDDot:134217730,Accent_Hat:134217731,Accent_Check:134217732,Accent_Accent:134217733,Accent_Grave:134217734,Accent_Smile:134217735,Accent_Tilde:134217736,Accent_Bar:134217737,Accent_DoubleBar:134217738,Accent_CurveBracketTop:134217739,Accent_CurveBracketBot:134217740,Accent_GroupTop:134217741,Accent_GroupBot:134217742,Accent_ArrowL:134217743,Accent_ArrowR:134217744,Accent_ArrowD:134217745,Accent_HarpoonL:134217746,Accent_HarpoonR:134217747,Accent_BorderBox:134283264,Accent_BorderBoxCustom:134283265,Accent_BarTop:134348800,Accent_BarBot:134348801,Accent_Custom_1:134414336,Accent_Custom_2:134414337,Accent_Custom_3:134414338,LimitLog_LogBase:150994944,LimitLog_Log:150994945,LimitLog_Lim:150994946,LimitLog_Min:150994947,LimitLog_Max:150994948,LimitLog_Ln:150994949,LimitLog_Custom_1:151060480,LimitLog_Custom_2:151060481,Operator_ColonEquals:167772160,Operator_EqualsEquals:167772161,Operator_PlusEquals:167772162,Operator_MinusEquals:167772163,Operator_Definition:167772164,Operator_UnitOfMeasure:167772165,Operator_DeltaEquals:167772166,Operator_ArrowL_Top:167837696,Operator_ArrowR_Top:167837697,Operator_ArrowL_Bot:167837698,Operator_ArrowR_Bot:167837699,Operator_DoubleArrowL_Top:167837700,Operator_DoubleArrowR_Top:167837701,Operator_DoubleArrowL_Bot:167837702,Operator_DoubleArrowR_Bot:167837703,Operator_ArrowD_Top:167837704,Operator_ArrowD_Bot:167837705,Operator_DoubleArrowD_Top:167837706,Operator_DoubleArrowD_Bot:167837707,Operator_Custom_1:167903232,Operator_Custom_2:167903233,Matrix_1_2:184549376,Matrix_2_1:184549377,Matrix_1_3:184549378,Matrix_3_1:184549379,Matrix_2_2:184549380,Matrix_2_3:184549381,Matrix_3_2:184549382,Matrix_3_3:184549383,Matrix_Dots_Center:184614912,Matrix_Dots_Baseline:184614913,Matrix_Dots_Vertical:184614914,Matrix_Dots_Diagonal:184614915,Matrix_Identity_2:184680448,Matrix_Identity_2_NoZeros:184680449,Matrix_Identity_3:184680450,Matrix_Identity_3_NoZeros:184680451,Matrix_2_2_RoundBracket:184745984,Matrix_2_2_SquareBracket:184745985,Matrix_2_2_LineBracket:184745986,Matrix_2_2_DLineBracket:184745987,Matrix_Flat_Round:184811520,Matrix_Flat_Square:184811521},Common.define.chartData=_.extend(new function(){return{textLine:"Line",textColumn:"Column",textBar:"Bar",textArea:"Area",textPie:"Pie",textPoint:"XY (Scatter)",textStock:"Stock",textSurface:"Surface",textCharts:"Charts",textSparks:"Sparklines",textLineSpark:"Line",textColumnSpark:"Column",textWinLossSpark:"Win/Loss",textCombo:"Combo",textBarNormal:"Clustered column",textBarStacked:"Stacked column",textBarStackedPer:"100% Stacked column",textBarNormal3d:"3-D Clustered column",textBarStacked3d:"3-D Stacked column",textBarStackedPer3d:"3-D 100% Stacked column",textBarNormal3dPerspective:"3-D column",textLineStacked:"Stacked line",textLineStackedPer:"100% Stacked line",textLineMarker:"Line with markers",textLineStackedMarker:"Stacked line with markers",textLineStackedPerMarker:"100% Stacked line with markers",textLine3d:"3-D line",textDoughnut:"Doughnut",textPie3d:"3-D pie",textHBarNormal:"Clustered bar",textHBarStacked:"Stacked bar",textHBarStackedPer:"100% Stacked bar",textHBarNormal3d:"3-D Clustered bar",textHBarStacked3d:"3-D Stacked bar",textHBarStackedPer3d:"3-D 100% Stacked bar",textAreaStacked:"Stacked area",textAreaStackedPer:"100% Stacked area",textScatter:"Scatter",textScatterSmoothMarker:"Scatter with smooth lines and markers",textScatterSmooth:"Scatter with smooth lines",textScatterLineMarker:"Scatter with straight lines and markers",textScatterLine:"Scatter with straight lines",textComboBarLine:"Clustered column - line",textComboBarLineSecondary:"Clustered column - line on secondary axis",textComboAreaBar:"Stacked area - clustered column",textComboCustom:"Custom combination",getChartGroupData:function(t){return[{id:"menu-chart-group-bar",caption:this.textColumn,headername:t?this.textCharts:void 0},{id:"menu-chart-group-line",caption:this.textLine},{id:"menu-chart-group-pie",caption:this.textPie},{id:"menu-chart-group-hbar",caption:this.textBar},{id:"menu-chart-group-area",caption:this.textArea,inline:!0},{id:"menu-chart-group-stock",caption:this.textStock,inline:!0},{id:"menu-chart-group-scatter",caption:this.textPoint},{id:"menu-chart-group-combo",caption:this.textCombo}]},getChartData:function(){return[{group:"menu-chart-group-bar",type:Asc.c_oAscChartTypeSettings.barNormal,iconCls:"column-normal",tip:this.textBarNormal},{group:"menu-chart-group-bar",type:Asc.c_oAscChartTypeSettings.barStacked,iconCls:"column-stack",tip:this.textBarStacked},{group:"menu-chart-group-bar",type:Asc.c_oAscChartTypeSettings.barStackedPer,iconCls:"column-pstack",tip:this.textBarStackedPer},{group:"menu-chart-group-bar",type:Asc.c_oAscChartTypeSettings.barNormal3d,iconCls:"column-3d-normal",tip:this.textBarNormal3d,is3d:!0},{group:"menu-chart-group-bar",type:Asc.c_oAscChartTypeSettings.barStacked3d,iconCls:"column-3d-stack",tip:this.textBarStacked3d,is3d:!0},{group:"menu-chart-group-bar",type:Asc.c_oAscChartTypeSettings.barStackedPer3d,iconCls:"column-3d-pstack",tip:this.textBarStackedPer3d,is3d:!0},{group:"menu-chart-group-bar",type:Asc.c_oAscChartTypeSettings.barNormal3dPerspective,iconCls:"column-3d-normal-per",tip:this.textBarNormal3dPerspective,is3d:!0},{group:"menu-chart-group-line",type:Asc.c_oAscChartTypeSettings.lineNormal,iconCls:"line-normal",tip:this.textLine},{group:"menu-chart-group-line",type:Asc.c_oAscChartTypeSettings.lineStacked,iconCls:"line-stack",tip:this.textLineStacked},{group:"menu-chart-group-line",type:Asc.c_oAscChartTypeSettings.lineStackedPer,iconCls:"line-pstack",tip:this.textLineStackedPer},{group:"menu-chart-group-line",type:Asc.c_oAscChartTypeSettings.lineNormalMarker,iconCls:"line-normal-marker",tip:this.textLineMarker},{group:"menu-chart-group-line",type:Asc.c_oAscChartTypeSettings.lineStackedMarker,iconCls:"line-stack-marker",tip:this.textLineStackedMarker},{group:"menu-chart-group-line",type:Asc.c_oAscChartTypeSettings.lineStackedPerMarker,iconCls:"line-pstack-marker",tip:this.textLineStackedPerMarker},{group:"menu-chart-group-line",type:Asc.c_oAscChartTypeSettings.line3d,iconCls:"line-3d",tip:this.textLine3d,is3d:!0},{group:"menu-chart-group-pie",type:Asc.c_oAscChartTypeSettings.pie,iconCls:"pie-normal",tip:this.textPie},{group:"menu-chart-group-pie",type:Asc.c_oAscChartTypeSettings.doughnut,iconCls:"pie-doughnut",tip:this.textDoughnut},{group:"menu-chart-group-pie",type:Asc.c_oAscChartTypeSettings.pie3d,iconCls:"pie-3d-normal",tip:this.textPie3d,is3d:!0},{group:"menu-chart-group-hbar",type:Asc.c_oAscChartTypeSettings.hBarNormal,iconCls:"bar-normal",tip:this.textHBarNormal},{group:"menu-chart-group-hbar",type:Asc.c_oAscChartTypeSettings.hBarStacked,iconCls:"bar-stack",tip:this.textHBarStacked},{group:"menu-chart-group-hbar",type:Asc.c_oAscChartTypeSettings.hBarStackedPer,iconCls:"bar-pstack",tip:this.textHBarStackedPer},{group:"menu-chart-group-hbar",type:Asc.c_oAscChartTypeSettings.hBarNormal3d,iconCls:"bar-3d-normal",tip:this.textHBarNormal3d,is3d:!0},{group:"menu-chart-group-hbar",type:Asc.c_oAscChartTypeSettings.hBarStacked3d,iconCls:"bar-3d-stack",tip:this.textHBarStacked3d,is3d:!0},{group:"menu-chart-group-hbar",type:Asc.c_oAscChartTypeSettings.hBarStackedPer3d,iconCls:"bar-3d-pstack",tip:this.textHBarStackedPer3d,is3d:!0},{group:"menu-chart-group-area",type:Asc.c_oAscChartTypeSettings.areaNormal,iconCls:"area-normal",tip:this.textArea},{group:"menu-chart-group-area",type:Asc.c_oAscChartTypeSettings.areaStacked,iconCls:"area-stack",tip:this.textAreaStacked},{group:"menu-chart-group-area",type:Asc.c_oAscChartTypeSettings.areaStackedPer,iconCls:"area-pstack",tip:this.textAreaStackedPer},{group:"menu-chart-group-scatter",type:Asc.c_oAscChartTypeSettings.scatter,iconCls:"point-normal",tip:this.textScatter},{group:"menu-chart-group-scatter",type:Asc.c_oAscChartTypeSettings.scatterSmoothMarker,iconCls:"point-smooth-marker",tip:this.textScatterSmoothMarker},{group:"menu-chart-group-scatter",type:Asc.c_oAscChartTypeSettings.scatterSmooth,iconCls:"point-smooth",tip:this.textScatterSmooth},{group:"menu-chart-group-scatter",type:Asc.c_oAscChartTypeSettings.scatterLineMarker,iconCls:"point-line-marker",tip:this.textScatterLineMarker},{group:"menu-chart-group-scatter",type:Asc.c_oAscChartTypeSettings.scatterLine,iconCls:"point-line",tip:this.textScatterLine},{group:"menu-chart-group-stock",type:Asc.c_oAscChartTypeSettings.stock,iconCls:"stock-normal",tip:this.textStock},{group:"menu-chart-group-combo",type:Asc.c_oAscChartTypeSettings.comboBarLine,iconCls:"combo-bar-line",tip:this.textComboBarLine},{group:"menu-chart-group-combo",type:Asc.c_oAscChartTypeSettings.comboBarLineSecondary,iconCls:"combo-bar-line-sec",tip:this.textComboBarLineSecondary},{group:"menu-chart-group-combo",type:Asc.c_oAscChartTypeSettings.comboAreaBar,iconCls:"combo-area-bar",tip:this.textComboAreaBar},{group:"menu-chart-group-combo",type:Asc.c_oAscChartTypeSettings.comboCustom,iconCls:"combo-custom",tip:this.textComboCustom}]},getSparkGroupData:function(t){return[{id:"menu-chart-group-sparkcolumn",inline:!0,headername:t?this.textSparks:void 0},{id:"menu-chart-group-sparkline",inline:!0},{id:"menu-chart-group-sparkwin",inline:!0}]},getSparkData:function(){return[{group:"menu-chart-group-sparkcolumn",type:Asc.c_oAscSparklineType.Column,allowSelected:!0,iconCls:"spark-column",tip:this.textColumnSpark},{group:"menu-chart-group-sparkline",type:Asc.c_oAscSparklineType.Line,allowSelected:!0,iconCls:"spark-line",tip:this.textLineSpark},{group:"menu-chart-group-sparkwin",type:Asc.c_oAscSparklineType.Stacked,allowSelected:!0,iconCls:"spark-win",tip:this.textWinLossSpark}]}}},Common.define.chartData||{}),Common.define.conditionalData=_.extend(new function(){return{textDate:"Date",textYesterday:"Yesterday",textToday:"Today",textTomorrow:"Tomorrow",textLast7days:"In the last 7 days",textLastWeek:"Last week",textThisWeek:"This week",textNextWeek:"Next week",textLastMonth:"Last month",textThisMonth:"This month",textNextMonth:"Next month",textText:"Text",textContains:"Contains",textNotContains:"Does not contain",textBegins:"Begins with",textEnds:"Ends with",textAverage:"Average",textAbove:"Above",textBelow:"Below",textEqAbove:"Equal to or above",textEqBelow:"Equal to or below",text1Above:"1 std dev above",text1Below:"1 std dev below",text2Above:"2 std dev above",text2Below:"2 std dev below",text3Above:"3 std dev above",text3Below:"3 std dev below",textGreater:"Greater than",textGreaterEq:"Greater than or equal to",textLess:"Less than",textLessEq:"Less than or equal to",textEqual:"Equal to",textNotEqual:"Not equal to",textBetween:"Between",textNotBetween:"Not between",textTop:"Top",textBottom:"Bottom",textBlank:"Blank",textError:"Error",textBlanks:"Contains blanks",textNotBlanks:"Does not contain blanks",textErrors:"Contains errors",textNotErrors:"Does not contain errors",textDuplicate:"Duplicate",textUnique:"Unique",textDataBar:"Data bar",textIconSets:"Icon sets",textFormula:"Formula",exampleText:"AaBbCcYyZz",noFormatText:"No format set",textValue:"Value is"}},Common.define.conditionalData||{})}),define("text!documenteditor/main/app/template/Toolbar.template",[],function(){return'<div class="toolbar">\n    <div class="box-tabs">\n        <div class="extra left"></div>\n        <%= tabsmarkup %>\n        <div class="extra right"></div>\n    </div>\n    <section class="box-controls">\n        <section class="panel static">\n            <div class="group no-mask small">\n                <div class="elset">\n                    <span class="btn-slot" id="slot-btn-print"></span>\n                </div>\n                <div class="elset">\n                    <span class="btn-slot" id="slot-btn-save"></span>\n                </div>\n            </div>\n            <div class="separator long"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-copy"></span>\n                    <span class="btn-slot" id="slot-btn-paste"></span>\n                </div>\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-undo"></span>\n                    <span class="btn-slot" id="slot-btn-redo"></span>\n                </div>\n            </div>\n            <div class="separator long"></div>\n        </section>\n        <section class="box-panels">\n            <section class="panel" data-tab="home">\n                <div class="group small">\n                    <div class="elset" style="width:208px;">\n                        <span class="btn-slot" id="slot-field-fontname"></span>\n                        <span class="btn-slot" id="slot-field-fontsize"></span>\n                        <span class="btn-slot" id="slot-btn-incfont"></span>\n                        <span class="btn-slot" id="slot-btn-decfont"></span>\n                        <span class="btn-slot split" id="slot-btn-changecase"></span>\n                    </div>\n                    <div class="elset font-attr">\n                        <span class="btn-slot" id="slot-btn-bold"></span>\n                        <span class="btn-slot" id="slot-btn-italic"></span>\n                        <span class="btn-slot" id="slot-btn-underline"></span>\n                        <span class="btn-slot" id="slot-btn-strikeout"></span>\n                        <span class="btn-slot" id="slot-btn-superscript"></span>\n                        <span class="btn-slot" id="slot-btn-subscript"></span>\n                        <span class="btn-slot split" id="slot-btn-highlight"></span>\n                        <span class="btn-slot split" id="slot-btn-fontcolor"></span>\n                    </div>\n                </div>\n                <div class="separator long"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-markers"></span>\n                        <span class="btn-slot split" id="slot-btn-numbering"></span>\n                        <span class="btn-slot split" id="slot-btn-multilevels"></span>\n                        <span class="btn-slot split" id="slot-btn-decoffset"></span>\n                        <span class="btn-slot split" id="slot-btn-incoffset"></span>\n                        <span class="btn-slot split" id="slot-btn-linespace"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-align-left"></span>\n                        <span class="btn-slot split" id="slot-btn-align-center"></span>\n                        <span class="btn-slot split" id="slot-btn-align-right"></span>\n                        <span class="btn-slot split" id="slot-btn-align-just"></span>\n                        <span class="btn-slot split" id="slot-btn-hidenchars"></span>\n                        <span class="btn-slot split" id="slot-btn-paracolor"></span>\n                    </div>\n                </div>\n                <div class="separator long"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-clearstyle"></span>\n                        <span class="btn-slot split" id="slot-btn-colorschemas"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-copystyle"></span>\n                        <span class="btn-slot" id="slot-btn-mailrecepients"></span>\n                    </div>\n                </div>\n                <div class="group small" id="slot-field-styles"></div>\n            </section>\n            <section class="panel" data-tab="ins">\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-blankpage"></span>\n                    <span class="btn-slot text x-huge btn-pagebreak"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-instable"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-insimage"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-inschart"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-insshape"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge slot-comment"></span>\n                    <span class="btn-slot text x-huge slot-inshyperlink"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-editheader"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-datetime"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-instext"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-instextart"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-insequation"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-inssymbol"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-dropcap"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-controls"></span>\n                </div>\n            </section>\n            <section class="panel" data-tab="layout">\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-pagemargins"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-pageorient"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-pagesize"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-columns"></span>\n                    <span class="btn-slot text x-huge btn-pagebreak"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-line-numbers"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-img-align"></span>\n                    <span class="btn-slot text x-huge" id="slot-img-group"></span>\n                    <span class="btn-slot text x-huge" id="slot-img-movefrwd"></span>\n                    <span class="btn-slot text x-huge" id="slot-img-movebkwd"></span>\n                    <span class="btn-slot text x-huge" id="slot-img-wrapping"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-watermark"></span>\n                </div>\n            </section>\n            <section class="panel" data-tab="links">\n                <div class="group">\n                    <span class="btn-slot text x-huge btn-contents"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-contents-update"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge slot-notes"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge slot-inshyperlink"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-bookmarks"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-caption"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-crossref"></span>\n                </div>\n                <div class="group sheet-views small">\n                    <div class="elset">\n                        <span class="btn-slot text" id="slot-btn-tof"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot text" id="slot-btn-tof-update"></span>\n                    </div>\n                </div>\n            </section>\n        </section>\n    </section>\n</div>'}),
define("text!documenteditor/main/app/template/ToolbarView.template",[],function(){return'<div class="toolbar toolbar-view">\n    <div class="box-tabs">\n        <div class="extra left"></div>\n        <%= tabsmarkup %>\n        <div class="extra right">\n        </div>\n    </div>\n    <section class="box-controls">\n        <section class="box-panels">\n        </section>\n    </section>\n</div>'}),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/Font",["backbone"],function(t){"use strict";Common.Models.Font=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),name:null,cloneid:null,imgidx:0,type:0}}})}),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/Fonts",["backbone","common/main/lib/model/Font"],function(t){"use strict";Common.Collections.Fonts=t.Collection.extend({model:Common.Models.Font})}),void 0===Common)var Common={};if(define("common/main/lib/component/ColorPalette",["common/main/lib/component/BaseView"],function(){"use strict";Common.UI.ColorPalette=Common.UI.BaseView.extend({options:{allowReselect:!0,cls:"",style:""},template:_.template(['<div class="palette-color">',"<% _.each(colors, function(color, index) { %>",'<span class="color-item" data-color="<%= color %>" style="background-color: #<%= color %>;"></span>',"<% }) %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=e.options.id,this.cls=e.options.cls,this.style=e.options.style,this.colors=e.options.colors||[],this.value=e.options.value,e.options.el&&e.render()},render:function(t){var e=this;return e.rendered?this.cmpEl=e.$el||$(this.el):(this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,colors:this.colors})),t?(this.setElement(t,!1),t.html(this.cmpEl)):e.$el.html(this.cmpEl)),e.rendered||e.cmpEl.on("click","span.color-item",e.itemClick.bind(e)),e.rendered=!0,this},itemClick:function(t){var e=$(t.target);this.select(e.attr("data-color"))},select:function(t,e){if(this.value!=t){var i=this;$("span.color-item",this.cmpEl).removeClass("selected"),this.value=t,t&&/#?[a-fA-F0-9]{6}/.test(t)&&(t=/#?([a-fA-F0-9]{6})/.exec(t)[1].toUpperCase(),$("span[data-color="+t+"]",this.cmpEl).addClass("selected"),e||i.trigger("select",i,this.value))}}})}),void 0===Common)var Common={};if(define("common/main/lib/component/DimensionPicker",["common/main/lib/component/BaseView"],function(){"use strict";Common.UI.DimensionPicker=Common.UI.BaseView.extend(function(){return{options:{itemSize:18,minRows:5,minColumns:5,maxRows:20,maxColumns:20},template:_.template(['<div style="width: 100%; height: 100%;">','<div class="dimension-picker-status">0x0</div>','<div class="dimension-picker-observecontainer">','<div class="dimension-picker-mousecatcher"></div>','<div class="dimension-picker-unhighlighted"></div>','<div class="dimension-picker-highlighted"></div>',"</div>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.render(),this.cmpEl=e.$el||$(this.el);var i=this.cmpEl;e.itemSize=e.options.itemSize,e.minRows=e.options.minRows,e.minColumns=e.options.minColumns,e.maxRows=e.options.maxRows,e.maxColumns=e.options.maxColumns,e.curColumns=0,e.curRows=0;var n=function(t){e.setTableSize(Math.ceil((void 0===t.offsetX?t.originalEvent.layerX:t.offsetX*Common.Utils.zoom())/e.itemSize),Math.ceil((void 0===t.offsetY?t.originalEvent.layerY:t.offsetY*Common.Utils.zoom())/e.itemSize),t)},o=function(t){e.setTableSize(0,0,t)},s=function(t){e.trigger("select",e,e.curColumns,e.curRows,t)};if(i){var a=i.find(".dimension-picker-mousecatcher");e.areaUnHighLighted=i.find(".dimension-picker-unhighlighted"),e.areaHighLighted=i.find(".dimension-picker-highlighted"),e.areaStatus=i.find(".dimension-picker-status"),i.css({width:e.minColumns+"em"}),a.css("z-index",1),a.width(e.maxColumns+"em").height(e.maxRows+"em"),e.areaUnHighLighted.width(e.minColumns+"em").height(e.minRows+"em"),e.areaStatus.html(e.curColumns+" x "+e.curRows),e.areaStatus.width(e.areaUnHighLighted.width()),a.on("mousemove",n),e.areaHighLighted.on("mousemove",n),e.areaUnHighLighted.on("mousemove",n),a.on("mouseleave",o),e.areaHighLighted.on("mouseleave",o),e.areaUnHighLighted.on("mouseleave",o),a.on("click",s),e.areaHighLighted.on("click",s),e.areaUnHighLighted.on("click",s)}},render:function(){return(this.$el||$(this.el)).html(this.template()),this},setTableSize:function(t,e,i){t>this.maxColumns&&(t=this.maxColumns),e>this.maxRows&&(e=this.maxRows),this.curColumns==t&&this.curRows==e||(this.curColumns=t,this.curRows=e,this.areaHighLighted.width(this.curColumns+"em").height(this.curRows+"em"),this.areaUnHighLighted.width((this.curColumns<this.minColumns?this.minColumns:this.curColumns+1>this.maxColumns?this.maxColumns:this.curColumns+1)+"em").height((this.curRows<this.minRows?this.minRows:this.curRows+1>this.maxRows?this.maxRows:this.curRows+1)+"em"),this.cmpEl.width(this.areaUnHighLighted.width()),this.areaStatus.html(this.curColumns+" x "+this.curRows),this.areaStatus.width(this.areaUnHighLighted.width()),this.trigger("change",this,this.curColumns,this.curRows,i))},getColumnsCount:function(){return this.curColumns},getRowsCount:function(){return this.curRows}}}())}),void 0===Common)var Common={};if(define("common/main/lib/component/ComboDataView",["common/main/lib/component/BaseView","common/main/lib/component/DataView"],function(){"use strict";Common.UI.ComboDataView=Common.UI.BaseView.extend({options:{id:null,cls:"",style:"",hint:!1,itemWidth:80,itemHeight:40,menuMaxHeight:300,enableKeyEvents:!1,beforeOpenHandler:null,additionalMenuItems:null,showLast:!0,minWidth:-1},template:_.template(['<div id="<%= id %>" class="combo-dataview <%= cls %>" style="<%= style %>">','<div class="view"></div> ','<div class="button"></div> ',"</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.id=this.options.id||Common.UI.getId(),this.cls=this.options.cls,this.style=this.options.style,this.hint=this.options.hint,this.store=this.options.store||new Common.UI.DataViewStore,this.itemWidth=this.options.itemWidth,this.itemHeight=this.options.itemHeight,this.menuMaxHeight=this.options.menuMaxHeight,this.beforeOpenHandler=this.options.beforeOpenHandler,this.showLast=this.options.showLast,this.rootWidth=0,this.rootHeight=0,this.rendered=!1,this.needFillComboView=!1,this.minWidth=this.options.minWidth,this.fieldPicker=new Common.UI.DataView({cls:"field-picker",allowScrollbar:!1,itemTemplate:_.template(['<div class="style" id="<%= id %>">','<img src="<%= imageUrl %>" width="'+this.itemWidth+'" height="'+this.itemHeight+'"/>','<% if (typeof title !== "undefined") {%>','<span class="title"><%= title %></span>',"<% } %>","</div>"].join(""))}),this.openButton=new Common.UI.Button({cls:"open-menu",menu:new Common.UI.Menu({menuAlign:"tl-tl",offset:[0,3],items:[{template:_.template('<div class="menu-picker-container"></div>')}]})}),null!=this.options.additionalMenuItems&&(this.openButton.menu.items=this.openButton.menu.items.concat(this.options.additionalMenuItems)),this.menuPicker=new Common.UI.DataView({cls:"menu-picker",parentMenu:this.openButton.menu,restoreHeight:this.menuMaxHeight,style:"max-height: "+this.menuMaxHeight+"px;",enableKeyEvents:this.options.enableKeyEvents,store:this.store,itemTemplate:_.template(['<div class="style" id="<%= id %>">','<img src="<%= imageUrl %>" width="'+this.itemWidth+'" height="'+this.itemHeight+'"/>','<% if (typeof title !== "undefined") {%>','<span class="title"><%= title %></span>',"<% } %>","</div>"].join(""))}),setInterval(_.bind(this.checkSize,this),500),this.options.el&&this.render()},render:function(t){if(!this.rendered){var e=this;e.trigger("render:before",e),e.cmpEl=e.$el||$(e.el);var i=e.template({id:e.id,cls:e.cls,style:e.style});t?(e.setElement(t,!1),e.cmpEl=$(i),t.html(e.cmpEl)):e.cmpEl.html(i),e.rootWidth=e.cmpEl.width(),e.rootHeight=e.cmpEl.height(),e.fieldPicker.render($(".view",e.cmpEl)),e.openButton.render($(".button",e.cmpEl)),e.menuPicker.render($(".menu-picker-container",e.cmpEl)),e.openButton.menu.cmpEl&&e.openButton.menu.cmpEl&&(e.openButton.menu.menuAlignEl=e.cmpEl,e.openButton.menu.cmpEl.css("min-width",e.itemWidth),e.openButton.menu.on("show:before",_.bind(e.onBeforeShowMenu,e)),e.openButton.menu.on("show:after",_.bind(e.onAfterShowMenu,e)),e.openButton.cmpEl.on("hide.bs.dropdown",_.bind(e.onBeforeHideMenu,e)),e.openButton.cmpEl.on("hidden.bs.dropdown",_.bind(e.onAfterHideMenu,e))),e.options.hint&&(e.cmpEl.attr("data-toggle","tooltip"),e.cmpEl.tooltip({title:e.options.hint,placement:e.options.hintAnchor||"cursor"})),e.fieldPicker.on("item:select",_.bind(e.onFieldPickerSelect,e)),e.menuPicker.on("item:select",_.bind(e.onMenuPickerSelect,e)),e.fieldPicker.on("item:click",_.bind(e.onFieldPickerClick,e)),e.menuPicker.on("item:click",_.bind(e.onMenuPickerClick,e)),e.fieldPicker.on("item:contextmenu",_.bind(e.onPickerItemContextMenu,e)),e.menuPicker.on("item:contextmenu",_.bind(e.onPickerItemContextMenu,e)),e.fieldPicker.el.addEventListener("contextmenu",_.bind(e.onPickerComboContextMenu,e),!1),e.menuPicker.el.addEventListener("contextmenu",_.bind(e.onPickerComboContextMenu,e),!1),e.onResize(),e.rendered=!0,e.trigger("render:after",e)}return this},checkSize:function(){if(this.cmpEl&&this.cmpEl.is(":visible")){var t=this,e=this.cmpEl.width(),i=this.cmpEl.height();if(e<this.minWidth)return;this.rootWidth==e&&this.rootHeight==i||(this.rootWidth=e,this.rootHeight=i,setTimeout(function(){t.openButton.menu.cmpEl.outerWidth(),t.rootWidth=t.cmpEl.width()},10),this.onResize())}},onResize:function(){if(this.openButton){var t=$("button",this.openButton.cmpEl),e=$(".button",this.cmpEl);t&&e.width()>0&&t.css({width:e.width(),height:e.height()}),this.openButton.menu.hide();var i=this.menuPicker;if(i){var n=i.getSelectedRec();this.fillComboView(n||i.store.at(0),!!n,!0),i.onResize()}}this.isSuspendEvents||this.trigger("resize",this)},onBeforeShowMenu:function(t){var e=this;if(_.isFunction(e.beforeOpenHandler))e.beforeOpenHandler(e,t);else if(e.openButton.menu.cmpEl){var i=0;try{var n=$($(".dropdown-menu .dataview.inner .style",e.cmpEl)[0]);i=n?parseInt(n.css("margin-left"))+parseInt(n.css("margin-right")):0}catch(t){}e.openButton.menu.cmpEl.css({width:Math.round((e.cmpEl.width()+i*e.fieldPicker.store.length)/e.itemWidth-.2)*(e.itemWidth+i),"min-height":this.cmpEl.height()})}if(e.options.hint){var o=e.cmpEl.data("bs.tooltip");o&&(void 0===o.dontShow&&(o.dontShow=!0),o.hide())}this.menuPicker.selectedBeforeHideRec=null},onBeforeHideMenu:function(t){if(this.trigger("hide:before",this,t),Common.UI.Scroller.isMouseCapture()&&t.preventDefault(),this.isStylesNotClosable)return!1},onAfterShowMenu:function(t){var e=this;e.menuPicker.scroller&&e.menuPicker.scroller.update({includePadding:!0,suppressScrollX:!0,alwaysVisibleY:!0})},onAfterHideMenu:function(t,e){this.menuPicker.selectedBeforeHideRec=this.menuPicker.getSelectedRec(),this.showLast?this.menuPicker.showLastSelected():this.menuPicker.deselectAll(),this.trigger("hide:after",this,t,e)},onFieldPickerSelect:function(t,e,i){},onMenuPickerSelect:function(t,e,i,n){this.needFillComboView=this.disabled,this.disabled||!0===n||(this.fillComboView(i,!1),i&&!this.isSuspendEvents&&this.trigger("select",this,i))},onFieldPickerClick:function(t,e,i){if(!this.disabled){if(this.isSuspendEvents||this.trigger("click",this,i),this.options.hint){var n=this.cmpEl.data("bs.tooltip");n&&(void 0===n.dontShow&&(n.dontShow=!0),n.hide())}this.showLast||this.fieldPicker.deselectAll()}},onMenuPickerClick:function(t,e,i){this.disabled||this.isSuspendEvents||this.trigger("click",this,i)},onPickerItemContextMenu:function(t,e,i,n){if(!this.disabled)return this.isSuspendEvents||this.trigger("contextmenu",this,i,n),n.preventDefault(),n.stopPropagation(),!1},onPickerComboContextMenu:function(t){this.disabled||this.isSuspendEvents||this.trigger("contextmenu",this,void 0,t)},setDisabled:function(t){if(this.disabled=t,this.rendered&&(this.cmpEl.toggleClass("disabled",t),$("button",this.openButton.cmpEl).toggleClass("disabled",t),this.fieldPicker.setDisabled(t),this.needFillComboView&&!t)){var e=this.menuPicker;if(e){var i=e.getSelectedRec();this.fillComboView(i||e.store.at(0),!1)}}},isDisabled:function(){return this.disabled},fillComboView:function(t,e,i){if(!_.isUndefined(t)&&t instanceof Backbone.Model){this.needFillComboView=!this.isVisible();var n=this,o=n.menuPicker.store,s=$(n.fieldPicker.el);if(o){if(i||!n.fieldPicker.store.findWhere({id:t.get("id")})){if(void 0===n.itemMarginLeft){var a=$($(this.menuPicker.el).find(".inner > div:not(.grouped-data):not(.ps-scrollbar-x-rail):not(.ps-scrollbar-y-rail)")[0]);a.length>0&&(n.itemMarginLeft=parseInt(a.css("margin-left")),n.itemMarginRight=parseInt(a.css("margin-right")),n.itemPaddingLeft=parseInt(a.css("padding-left")),n.itemPaddingRight=parseInt(a.css("padding-right")),n.itemBorderLeft=parseInt(a.css("border-left-width")),n.itemBorderRight=parseInt(a.css("border-right-width")))}var r=o.indexOf(t);if(r<0)return;var l=o.length,c=Math.floor(Math.max(s.width(),n.minWidth)/(n.itemWidth+(n.itemMarginLeft||0)+(n.itemMarginRight||0)+(n.itemPaddingLeft||0)+(n.itemPaddingRight||0)+(n.itemBorderLeft||0)+(n.itemBorderRight||0))),d=[];s.height()/n.itemHeight>2&&(c*=Math.floor(s.height()/n.itemHeight)),r=Math.floor(r/c)*c,l-r<c&&(r=Math.max(l-c,0));for(var h=r,p=0;h<l&&p<c;h++,p++)d.push(o.at(h));n.fieldPicker.store.reset(d)}if(e){var m=n.fieldPicker.store.findWhere({id:t.get("id")});m&&(n.suspendEvents(),n.fieldPicker.selectRecord(m,!0),n.resumeEvents())}}}},clearComboView:function(){this.fieldPicker.store.reset([])},selectByIndex:function(t){t<0&&this.fieldPicker.deselectAll(),this.menuPicker.selectByIndex(t)},selectRecord:function(t){t||this.fieldPicker.deselectAll(),this.menuPicker.selectRecord(t)},setItemWidth:function(t){this.itemWidth!=t&&(this.itemWidth=Common.Utils.applicationPixelRatio()>1?t/2:t)},setItemHeight:function(t){this.itemHeight!=t&&(this.itemHeight=Common.Utils.applicationPixelRatio()>1?t/2:t)},removeTips:function(){var t=this.menuPicker;_.each(t.dataViewItems,function(t){var e=t.$el.data("bs.tooltip");e&&e.tip().remove()},t)}})}),void 0===Common)var Common={};if(define("common/main/lib/component/SynchronizeTip",["common/main/lib/component/BaseView"],function(){"use strict";Common.UI.SynchronizeTip=Common.UI.BaseView.extend(_.extend(function(){return{options:{target:$(document.body),text:"",placement:"right-bottom",showLink:!0},template:_.template(['<div class="synch-tip-root <% if (!!scope.options.extCls) {print(scope.options.extCls + " ");} %><%= scope.placement %>">','<div class="asc-synchronizetip">','<div class="tip-arrow <%= scope.placement %>"></div>',"<div>",'<div class="tip-text"><%= scope.text %></div>','<div class="close"></div>',"</div>","<% if ( scope.showLink ) { %>",'<div class="show-link"><label><%= scope.textLink %></label></div>',"<% } %>","</div>","</div>"].join("")),initialize:function(t){this.textSynchronize+=Common.Utils.String.platformKey("Ctrl+S"),Common.UI.BaseView.prototype.initialize.call(this,t),this.target=this.options.target,this.text=_.isEmpty(this.options.text)?this.textSynchronize:this.options.text,this.textLink=_.isEmpty(this.options.textLink)?this.textDontShow:this.options.textLink,this.placement=this.options.placement,this.showLink=this.options.showLink},render:function(){return this.cmpEl||(this.cmpEl=$(this.template({scope:this})),$(document.body).append(this.cmpEl),this.cmpEl.find(".close").on("click",_.bind(function(){this.trigger("closeclick")},this)),this.cmpEl.find(".show-link label").on("click",_.bind(function(){this.trigger("dontshowclick")},this))),this.applyPlacement(),this},show:function(){this.cmpEl?(this.applyPlacement(),this.cmpEl.show()):this.render()},hide:function(){this.cmpEl&&this.cmpEl.hide(),this.trigger("hide")},close:function(){this.cmpEl&&this.cmpEl.remove()},applyPlacement:function(){var t=this.target.offset();if("target"==this.placement)return void this.cmpEl.css({top:t.top+5+"px",left:t.left+5+"px"});var e=this.placement.split("-");if(e.length>0){var i,n,o,s,a=e[0];if("top"==a?o=Common.Utils.innerHeight()-t.top:"bottom"==a?i=t.top+this.target.height():"left"==a?s=Common.Utils.innerWidth()-t.left:"right"==a&&(n=t.left+this.target.width()),"top"==(a=e[1]))o=Common.Utils.innerHeight()-t.top-this.target.height()/2;else if("bottom"==a){i=t.top+this.target.height()/2;var r=this.cmpEl.height();i+r>Common.Utils.innerHeight()&&(i=Common.Utils.innerHeight()-r-10)}else"left"==a?s=Common.Utils.innerWidth()-t.left-this.target.width()/2:"right"==a?n=t.left+this.target.width()/2:void 0!==o||void 0!==i?n=t.left+(this.target.width()-this.cmpEl.width())/2:i=t.top+(this.target.height()-this.cmpEl.height())/2;i=void 0!==i?i+"px":"auto",o=void 0!==o?o+"px":"auto",n=void 0!==n?n+"px":"auto",s=void 0!==s?s+"px":"auto",this.cmpEl.css({top:i,left:n,right:s,bottom:o})}},isVisible:function(){return this.cmpEl&&this.cmpEl.is(":visible")},textDontShow:"Don't show this message again",textSynchronize:"The document has been changed by another user.<br>Please click to save your changes and reload the updates."}}(),Common.UI.SynchronizeTip||{}))}),define("common/main/lib/component/Mixtbar",["backbone","common/main/lib/component/BaseView"],function(t){"use strict";Common.UI.Mixtbar=Common.UI.BaseView.extend(function(){function t(t){var e=$(t.currentTarget).find("> a[data-tab]").data("tab");this.dblclick_el==e&&(this.fireEvent("change:compact",[e]),this.dblclick_el=void 0)}function e(t){this.isFolded&&($(t.target).parents(".toolbar, #file-menu-panel").length||o.$bar&&o.$bar.hasClass("expanded")&&this.collapse())}var i,n,o={timeout:2e3},s={},a=function(t,e){var n=i.scrollLeft();(n||"right"==t)&&i.animate({scrollLeft:"left"==t?n-100:n+100},200)};return{$tabs:void 0,$panels:void 0,isFolded:!1,initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);this.$layout=$(t.template({tabsmarkup:_.template('<section class="tabs"><a class="scroll left"></a><ul><% for(var i in items) { %><% if (typeof items[i] == "object") { %><li class="ribtab<% if (items[i].haspanel===false) print(" x-lone") %><% if (items[i].extcls) print(\' \' + items[i].extcls) %>"><a data-tab="<%= items[i].action %>" data-title="<%= items[i].caption %>"><%= items[i].caption %></a></li><% } %><% } %></ul><a class="scroll right"></a></section>')({items:t.tabs})})),s.tabs=t.tabs,$(document.body).on("click",e.bind(this)),Common.NotificationCenter.on("tab:visible",_.bind(function(t,e){this.setVisible(t,e)},this))},afterRender:function(){var e=this;i=e.$(".tabs > ul"),e.$tabs=i.find("> li"),e.$panels=e.$(".box-panels > .panel"),o.$bar=e.$(".toolbar");var s=e.$(".tabs .scroll.right");n=e.$(".tabs .scroll.left"),n.on("click",a.bind(this,"left")),s.on("click",a.bind(this,"right")),i.on("dblclick","> .ribtab",t.bind(this)),i.on("click","> .ribtab",e.onTabClick.bind(this))},isTabActive:function(t){var e=this.$tabs.filter(".active").find("> a");return e.length&&e.data("tab")==t},setFolded:function(t){this.isFolded=t;var e=this;if(this.isFolded)o.$box||(o.$box=e.$el.find(".box-controls")),o.$bar.addClass("folded z-clear").toggleClass("expanded",!1),o.$bar.find(".tabs .ribtab").removeClass("active"),o.$bar.on($.support.transition.end,function(t){o.$bar.hasClass("folded")&&!o.$bar.hasClass("expanded")&&o.$bar.toggleClass("z-clear",!0)}),o.$box.on({mouseleave:function(t){},mouseenter:function(t){}});else{o.$bar.removeClass("folded z-clear"),o.$box.off();var i=o.$box.find(".panel.active");if(i.length){var n=i.data("tab");e.$tabs.find("> a[data-tab="+n+"]").parent().toggleClass("active",!0)}else n=e.$tabs.siblings(":not(.x-lone):visible").first().find("> a[data-tab]").data("tab"),e.setTab(n)}},collapse:function(){Common.UI.Menu.Manager.hideAll(),this.isFolded&&o.$bar&&(o.$bar.removeClass("expanded"),o.$bar.find(".tabs .ribtab").removeClass("active"))},expand:function(){o.$bar.removeClass("z-clear"),o.$bar.addClass("expanded")},onResize:function(t){this.hasTabInvisible()?i.parent().hasClass("short")||i.parent().addClass("short"):i.parent().hasClass("short")&&i.parent().removeClass("short"),this.processPanelVisible()},onTabClick:function(t){var e=this,i=$(t.currentTarget),n=i.find("> a[data-tab]").data("tab");i.hasClass("x-lone")?e.isFolded&&e.collapse():i.hasClass("active")?e._timerSetTab||(e.dblclick_el=n,e.isFolded&&(e.collapse(),setTimeout(function(){e.dblclick_el=void 0},500))):(e._timerSetTab=!0,setTimeout(function(){e._timerSetTab=!1},500),e.setTab(n),e.processPanelVisible(null,!0),e.isFolded?e.dblclick_el=n:(e.dblclick_timer&&clearTimeout(e.dblclick_timer),e.dblclick_timer=setTimeout(function(){e.dblclick_el=n,delete e.dblclick_timer},500)))},setTab:function(t){var e=this;if(t||(this.isFolded?this.collapse():t=this.lastPanel),t){e.$tabs.removeClass("active"),e.$panels.removeClass("active");var i=this.$panels.filter("[data-tab="+t+"]");i.length&&(this.lastPanel=t,i.addClass("active")),i.length?e.isFolded&&e.expand():e.isFolded&&e.collapse();var n=this.$tabs.find("> a[data-tab="+t+"]").parent();n.length&&n.addClass("active"),this.fireEvent("tab:active",[t])}},addTab:function(t,e,n){function o(t){return s.tabs[t]?s.tabs[t].action:o(--t)}var a=_.template('<li class="ribtab" style="display: none;"><a data-tab="<%= action %>" data-title="<%= caption %>"><%= caption %></a></li>');s.tabs[n+1]=t;var r=o(n),l=this.$tabs||this.$layout.find(".tabs"),c=l.find("a[data-tab="+r+"]");c.length&&(c.parent().after(a(t)),e&&(l=this.$panels||this.$layout.find(".box-panels > .panel"),c=l.filter("[data-tab="+r+"]"),c.length?c.after(e):e.appendTo(this.$layout.find(".box-panels"))),this.$tabs&&(this.$tabs=i.find("> li")),this.$panels&&(this.$panels=this.$el.find(".box-panels > .panel")))},isCompact:function(){return this.isFolded},hasTabInvisible:function(){if(i.length<1)return!1;var t=Math.round(i.offset().left),e=Math.round(t+i.width()),n=this.$tabs.filter(":visible:first").get(0);if(!n)return!1;var o=n.getBoundingClientRect();return Math.round(o.left)<t||(n=this.$tabs.filter(":visible:last").get(0),o=n.getBoundingClientRect(),Math.round(o.right)>e)},processPanelVisible:function(t,e){function i(){var e=t||n.$panels.filter(".active");if(e&&e.length){var i=e.parents(".box-controls").width(),o=e.data(),s=o.rightedge,a=o.buttons,r=o.flex;if(s||(s=e.get(0).getBoundingClientRect().right),a||(a=[],_.each(e.find(".btn-slot .x-huge"),function(t){a.push($(t).closest(".btn-slot"))}),o.buttons=a),r||(r=[],_.each(e.find(".group.flex"),function(t){var e=$(t);r.push({el:e,width:e.attr("data-group-width")||e.attr("max-width")})}),o.flex=r),s>i){if(r.length>0)for(var l=0;l<r.length;l++){var c=r[l].el;if(c.outerWidth()>parseInt(c.css("min-width")))return;c.css("width",c.css("min-width"))}for(var l=a.length-1;l>=0;l--){var d=a[l];if(!d.hasClass("compactwidth")&&(d.addClass("compactwidth"),(s=e.get(0).getBoundingClientRect().right)<=i))break}o.rightedge=s}else{for(var l=0;l<a.length;l++){var d=a[l];if(d.hasClass("compactwidth")&&(d.removeClass("compactwidth"),(s=e.get(0).getBoundingClientRect().right)>i)){d.addClass("compactwidth"),s=e.get(0).getBoundingClientRect().right;break}}if(o.rightedge=s,r.length>0&&e.find(".btn-slot.compactwidth").length<1)for(var l=0;l<r.length;l++){var c=r[l];c.el.css("width",c.width)}}}}var n=this;n._timer_id&&clearTimeout(n._timer_id),!0===e?i():n._timer_id=setTimeout(function(){delete n._timer_id,i()},100)},setExtra:function(t,e){e&&(this.$tabs||("right"==t?this.$layout.find(".extra.right").html(e):"left"==t&&this.$layout.find(".extra.left").html(e)))},setVisible:function(t,e){t&&this.$tabs&&(this.$tabs.find("> a[data-tab="+t+"]").parent().css("display",e?"":"none"),this.onResize())}}}())}),define("documenteditor/main/app/view/Toolbar",["jquery","underscore","backbone","text!documenteditor/main/app/template/Toolbar.template","text!documenteditor/main/app/template/ToolbarView.template","common/main/lib/collection/Fonts","common/main/lib/component/Button","common/main/lib/component/ComboBox","common/main/lib/component/DataView","common/main/lib/component/ColorPalette","common/main/lib/component/ThemeColorPalette","common/main/lib/component/Menu","common/main/lib/component/DimensionPicker","common/main/lib/component/Window","common/main/lib/component/ComboBoxFonts","common/main/lib/component/ComboDataView","common/main/lib/component/SynchronizeTip","common/main/lib/component/Mixtbar"],function(t,e,i,n,o){"use strict";DE.Views.Toolbar=Common.UI.Mixtbar.extend(e.extend(function(){return{el:"#toolbar",events:{},initialize:function(){var t=this;return this.SchemeNames=[this.txtScheme22,this.txtScheme1,this.txtScheme2,this.txtScheme3,this.txtScheme4,this.txtScheme5,this.txtScheme6,this.txtScheme7,this.txtScheme8,this.txtScheme9,this.txtScheme10,this.txtScheme11,this.txtScheme12,this.txtScheme13,this.txtScheme14,this.txtScheme15,this.txtScheme16,this.txtScheme17,this.txtScheme18,this.txtScheme19,this.txtScheme20,this.txtScheme21],this.paragraphControls=[],this.toolbarControls=[],this.textOnlyControls=[],this._state={hasCollaborativeChanges:void 0,previewmode:!1},Common.NotificationCenter.on("app:ready",t.onAppReady.bind(this)),this},applyLayout:function(i){var s=this;if(i.isEdit){Common.UI.Mixtbar.prototype.initialize.call(this,{template:e.template(n),tabs:[{caption:s.textTabFile,action:"file",extcls:"canedit",haspanel:!1},{caption:s.textTabHome,action:"home",extcls:"canedit"},{caption:s.textTabInsert,action:"ins",extcls:"canedit"},{caption:s.textTabLayout,action:"layout",extcls:"canedit"},{caption:s.textTabLinks,action:"links",extcls:"canedit"}]}),this.btnSaveCls="btn-save",this.btnSaveTip=this.tipSave+Common.Utils.String.platformKey("Ctrl+S"),this.btnPrint=new Common.UI.Button({id:"id-toolbar-btn-print",cls:"btn-toolbar",iconCls:"toolbar__icon btn-print no-mask",signals:["disabled"]}),this.toolbarControls.push(this.btnPrint),this.btnSave=new Common.UI.Button({id:"id-toolbar-btn-save",cls:"btn-toolbar",iconCls:"toolbar__icon no-mask "+this.btnSaveCls,signals:["disabled"]}),this.toolbarControls.push(this.btnSave),this.btnCollabChanges=this.btnSave,this.btnUndo=new Common.UI.Button({id:"id-toolbar-btn-undo",cls:"btn-toolbar",iconCls:"toolbar__icon btn-undo",signals:["disabled"]}),this.toolbarControls.push(this.btnUndo),this.btnRedo=new Common.UI.Button({id:"id-toolbar-btn-redo",cls:"btn-toolbar",iconCls:"toolbar__icon btn-redo",signals:["disabled"]}),this.toolbarControls.push(this.btnRedo),this.btnCopy=new Common.UI.Button({id:"id-toolbar-btn-copy",cls:"btn-toolbar",iconCls:"toolbar__icon btn-copy"}),this.toolbarControls.push(this.btnCopy),this.btnPaste=new Common.UI.Button({id:"id-toolbar-btn-paste",cls:"btn-toolbar",iconCls:"toolbar__icon btn-paste"}),this.paragraphControls.push(this.btnPaste),this.btnIncFontSize=new Common.UI.Button({id:"id-toolbar-btn-incfont",cls:"btn-toolbar",iconCls:"toolbar__icon btn-incfont"}),this.paragraphControls.push(this.btnIncFontSize),this.btnDecFontSize=new Common.UI.Button({id:"id-toolbar-btn-decfont",cls:"btn-toolbar",iconCls:"toolbar__icon btn-decfont"}),this.paragraphControls.push(this.btnDecFontSize),this.btnBold=new Common.UI.Button({id:"id-toolbar-btn-bold",cls:"btn-toolbar",iconCls:"toolbar__icon btn-bold",enableToggle:!0}),this.paragraphControls.push(this.btnBold),this.btnItalic=new Common.UI.Button({id:"id-toolbar-btn-italic",cls:"btn-toolbar",iconCls:"toolbar__icon btn-italic",enableToggle:!0}),this.paragraphControls.push(this.btnItalic),this.btnUnderline=new Common.UI.Button({id:"id-toolbar-btn-underline",cls:"btn-toolbar",iconCls:"toolbar__icon btn-underline",enableToggle:!0}),this.paragraphControls.push(this.btnUnderline),this.btnStrikeout=new Common.UI.Button({id:"id-toolbar-btn-strikeout",cls:"btn-toolbar",iconCls:"toolbar__icon btn-strikeout",enableToggle:!0}),this.paragraphControls.push(this.btnStrikeout),this.btnSuperscript=new Common.UI.Button({id:"id-toolbar-btn-superscript",cls:"btn-toolbar",iconCls:"toolbar__icon btn-superscript",enableToggle:!0,toggleGroup:"superscriptGroup"}),this.paragraphControls.push(this.btnSuperscript),this.btnSubscript=new Common.UI.Button({id:"id-toolbar-btn-subscript",cls:"btn-toolbar",iconCls:"toolbar__icon btn-subscript",enableToggle:!0,toggleGroup:"superscriptGroup"}),this.paragraphControls.push(this.btnSubscript),this.btnHighlightColor=new Common.UI.ButtonColored({id:"id-toolbar-btn-highlight",cls:"btn-toolbar",iconCls:"toolbar__icon btn-highlight",enableToggle:!0,allowDepress:!0,split:!0,menu:new Common.UI.Menu({style:"min-width: 100px;",items:[{template:e.template('<div id="id-toolbar-menu-highlight" style="width: 120px; height: 120px; margin: 10px;"></div>')},{caption:"--"},this.mnuHighlightTransparent=new Common.UI.MenuItem({caption:this.strMenuNoFill,checkable:!0})]})}),this.paragraphControls.push(this.btnHighlightColor),this.textOnlyControls.push(this.btnHighlightColor),this.btnFontColor=new Common.UI.ButtonColored({id:"id-toolbar-btn-fontcolor",cls:"btn-toolbar",iconCls:"toolbar__icon btn-fontcolor",split:!0,menu:new Common.UI.Menu({cls:"shifted-left",items:[{id:"id-toolbar-menu-auto-fontcolor",caption:this.textAutoColor,template:e.template('<a tabindex="-1" type="menuitem"><span class="menu-item-icon color-auto" style="background-image: none; width: 12px; height: 12px; margin: 1px 7px 0 1px; background-color: #000;"></span><%= caption %></a>')},{caption:"--"},{template:e.template('<div id="id-toolbar-menu-fontcolor" style="width: 169px; height: 216px; margin: 10px;"></div>')},{template:e.template('<a id="id-toolbar-menu-new-fontcolor" style="">'+this.textNewColor+"</a>")}]})}),this.paragraphControls.push(this.btnFontColor),this.btnParagraphColor=new Common.UI.ButtonColored({id:"id-toolbar-btn-paracolor",cls:"btn-toolbar",iconCls:"toolbar__icon btn-paracolor",split:!0,menu:new Common.UI.Menu({items:[{template:e.template('<div id="id-toolbar-menu-paracolor" style="width: 169px; height: 216px; margin: 10px;"></div>')},{template:e.template('<a id="id-toolbar-menu-new-paracolor" style="padding-left:12px;">'+this.textNewColor+"</a>")}]})}),this.paragraphControls.push(this.btnParagraphColor),this.textOnlyControls.push(this.btnParagraphColor),this.btnChangeCase=new Common.UI.Button({id:"id-toolbar-btn-case",cls:"btn-toolbar",iconCls:"toolbar__icon btn-change-case",menu:new Common.UI.Menu({items:[{caption:this.mniSentenceCase,value:Asc.c_oAscChangeTextCaseType.SentenceCase},{caption:this.mniLowerCase,value:Asc.c_oAscChangeTextCaseType.LowerCase},{caption:this.mniUpperCase,value:Asc.c_oAscChangeTextCaseType.UpperCase},{caption:this.mniCapitalizeWords,value:Asc.c_oAscChangeTextCaseType.CapitalizeWords},{caption:this.mniToggleCase,value:Asc.c_oAscChangeTextCaseType.ToggleCase}]})}),this.paragraphControls.push(this.btnChangeCase),this.btnAlignLeft=new Common.UI.Button({id:"id-toolbar-btn-align-left",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-left",enableToggle:!0,toggleGroup:"alignGroup"}),this.paragraphControls.push(this.btnAlignLeft),this.btnAlignCenter=new Common.UI.Button({id:"id-toolbar-btn-align-center",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-center",enableToggle:!0,toggleGroup:"alignGroup"}),this.paragraphControls.push(this.btnAlignCenter),this.btnAlignRight=new Common.UI.Button({id:"id-toolbar-btn-align-right",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-right",enableToggle:!0,toggleGroup:"alignGroup"}),this.paragraphControls.push(this.btnAlignRight),this.btnAlignJust=new Common.UI.Button({id:"id-toolbar-btn-align-just",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-just",enableToggle:!0,toggleGroup:"alignGroup"}),this.paragraphControls.push(this.btnAlignJust),this.btnDecLeftOffset=new Common.UI.Button({id:"id-toolbar-btn-decoffset",cls:"btn-toolbar",iconCls:"toolbar__icon btn-decoffset"}),this.paragraphControls.push(this.btnDecLeftOffset),this.btnIncLeftOffset=new Common.UI.Button({id:"id-toolbar-btn-incoffset",
cls:"btn-toolbar",iconCls:"toolbar__icon btn-incoffset"}),this.paragraphControls.push(this.btnIncLeftOffset),this.btnLineSpace=new Common.UI.Button({id:"id-toolbar-btn-linespace",cls:"btn-toolbar",iconCls:"toolbar__icon btn-linespace",menu:new Common.UI.Menu({style:"min-width: 60px;",items:[{caption:"1.0",value:1,checkable:!0,toggleGroup:"linesize"},{caption:"1.15",value:1.15,checkable:!0,toggleGroup:"linesize"},{caption:"1.5",value:1.5,checkable:!0,toggleGroup:"linesize"},{caption:"2.0",value:2,checkable:!0,toggleGroup:"linesize"},{caption:"2.5",value:2.5,checkable:!0,toggleGroup:"linesize"},{caption:"3.0",value:3,checkable:!0,toggleGroup:"linesize"}]})}),this.paragraphControls.push(this.btnLineSpace),this.btnShowHidenChars=new Common.UI.Button({id:"id-toolbar-btn-hidenchars",cls:"btn-toolbar",iconCls:"toolbar__icon btn-paragraph",enableToggle:!0,split:!0,menu:new Common.UI.Menu({style:"min-width: 60px;",items:[{caption:this.mniHiddenChars,value:"characters",checkable:!0},{caption:this.mniHiddenBorders,value:"table",checkable:!0}]})}),this.toolbarControls.push(this.btnShowHidenChars),this.btnMarkers=new Common.UI.Button({id:"id-toolbar-btn-markers",cls:"btn-toolbar",iconCls:"toolbar__icon btn-setmarkers",enableToggle:!0,toggleGroup:"markersGroup",split:!0,menu:!0}),this.paragraphControls.push(this.btnMarkers),this.textOnlyControls.push(this.btnMarkers),this.btnNumbers=new Common.UI.Button({id:"id-toolbar-btn-numbering",cls:"btn-toolbar",iconCls:"toolbar__icon btn-numbering",enableToggle:!0,toggleGroup:"markersGroup",split:!0,menu:!0}),this.paragraphControls.push(this.btnNumbers),this.textOnlyControls.push(this.btnNumbers),this.btnMultilevels=new Common.UI.Button({id:"id-toolbar-btn-multilevels",cls:"btn-toolbar",iconCls:"toolbar__icon btn-multilevels",menu:!0}),this.paragraphControls.push(this.btnMultilevels),this.textOnlyControls.push(this.btnMultilevels);var a=function(t){var e={};for(var i in t)e[i]="object"==typeof t[i]?a(t[i]):t[i];return e};this.mnuMarkersPicker={conf:{index:0},selectByIndex:function(t){this.conf.index=t},deselectAll:function(){this.conf.index=-1}},this.mnuNumbersPicker=a(this.mnuMarkersPicker),this.mnuMultilevelPicker=a(this.mnuMarkersPicker),this.btnInsertTable=new Common.UI.Button({id:"tlbtn-inserttable",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-inserttable",caption:s.capBtnInsTable,menu:new Common.UI.Menu({items:[{template:e.template('<div id="id-toolbar-menu-tablepicker" class="dimension-picker" style="margin: 5px 10px;"></div>')},{caption:this.mniCustomTable,value:"custom"},{caption:this.mniDrawTable,value:"draw",checkable:!0},{caption:this.mniEraseTable,value:"erase",checkable:!0},{caption:this.mniTextToTable,value:"convert"}]})}),this.paragraphControls.push(this.btnInsertTable),this.btnInsertImage=new Common.UI.Button({id:"tlbtn-insertimage",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-insertimage",caption:s.capBtnInsImage,menu:new Common.UI.Menu({items:[{caption:this.mniImageFromFile,value:"file"},{cls:"cp-from-url",caption:this.mniImageFromUrl,value:"url"},{caption:this.mniImageFromStorage,value:"storage"}]})}),this.paragraphControls.push(this.btnInsertImage),this.btnInsertChart=new Common.UI.Button({id:"tlbtn-insertchart",cls:"btn-toolbar x-huge icon-top",caption:s.capBtnInsChart,iconCls:"toolbar__icon btn-insertchart",menu:!0}),this.paragraphControls.push(this.btnInsertChart),this.btnInsertText=new Common.UI.Button({id:"tlbtn-inserttext",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-text",caption:s.capBtnInsTextbox,enableToggle:!0}),this.paragraphControls.push(this.btnInsertText),this.btnInsertTextArt=new Common.UI.Button({id:"tlbtn-inserttextart",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-textart",caption:s.capBtnInsTextart,menu:new Common.UI.Menu({cls:"menu-shapes",items:[{template:e.template('<div id="id-toolbar-menu-insart" style="width: 239px; margin-left: 5px;"></div>')}]})}),this.paragraphControls.push(this.btnInsertTextArt),this.btnEditHeader=new Common.UI.Button({id:"id-toolbar-btn-editheader",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-editheader",caption:s.capBtnInsHeader,menu:!0}),this.mnuPageNumberPosPicker={conf:{disabled:!1},isDisabled:function(){return this.conf.disabled},setDisabled:function(t){this.conf.disabled=t}},this.mnuPageNumCurrentPos=a(this.mnuPageNumberPosPicker),this.mnuInsertPageNum=a(this.mnuPageNumberPosPicker),this.mnuInsertPageCount=a(this.mnuPageNumberPosPicker),this.paragraphControls.push(this.mnuPageNumCurrentPos),this.paragraphControls.push(this.mnuInsertPageCount),this.toolbarControls.push(this.btnEditHeader),this.btnInsDateTime=new Common.UI.Button({id:"id-toolbar-btn-datetime",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-datetime",caption:s.capBtnDateTime}),this.paragraphControls.push(this.btnInsDateTime),this.btnBlankPage=new Common.UI.Button({id:"id-toolbar-btn-blankpage",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-blankpage",caption:s.capBtnBlankPage}),this.paragraphControls.push(this.btnBlankPage),this.btnInsertShape=new Common.UI.Button({id:"tlbtn-insertshape",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-insertshape",caption:s.capBtnInsShape,enableToggle:!0,menu:new Common.UI.Menu({cls:"menu-shapes"})}),this.paragraphControls.push(this.btnInsertShape),this.btnInsertEquation=new Common.UI.Button({id:"tlbtn-insertequation",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-insertequation",caption:s.capBtnInsEquation,split:!0,menu:new Common.UI.Menu({cls:"menu-shapes"})}),this.paragraphControls.push(this.btnInsertEquation),this.btnInsertSymbol=new Common.UI.Button({id:"tlbtn-insertsymbol",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-symbol",caption:s.capBtnInsSymbol}),this.paragraphControls.push(this.btnInsertSymbol),this.btnDropCap=new Common.UI.Button({id:"tlbtn-dropcap",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-dropcap",caption:s.capBtnInsDropcap,menu:new Common.UI.Menu({cls:"ppm-toolbar shifted-right",items:[{caption:this.textNone,iconCls:"menu__icon columns-one",checkable:!0,checkmark:!1,toggleGroup:"menuDropCap",value:Asc.c_oAscDropCap.None,checked:!0},{caption:this.textInText,iconCls:"menu__icon dropcap-intext",checkable:!0,checkmark:!1,toggleGroup:"menuDropCap",value:Asc.c_oAscDropCap.Drop},{caption:this.textInMargin,iconCls:"menu__icon dropcap-inmargin",checkable:!0,checkmark:!1,toggleGroup:"menuDropCap",value:Asc.c_oAscDropCap.Margin},{caption:"--"},this.mnuDropCapAdvanced=new Common.UI.MenuItem({caption:this.mniEditDropCap})]})}),this.paragraphControls.push(this.btnDropCap),this.btnContentControls=new Common.UI.Button({id:"tlbtn-controls",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-controls",caption:s.capBtnInsControls,menu:new Common.UI.Menu({cls:"ppm-toolbar shifted-right",items:[{caption:this.textPlainControl,iconCls:"menu__icon cc-plaintext",value:"plain"},{caption:this.textRichControl,iconCls:"menu__icon cc-richtext",value:"rich"},{caption:this.textPictureControl,iconCls:"menu__icon btn-menu-image",value:"picture"},{caption:this.textComboboxControl,value:"combobox"},{caption:this.textDropdownControl,value:"dropdown"},{caption:this.textDateControl,value:"date"},{caption:this.textCheckboxControl,value:"checkbox"},{caption:"--"},{caption:this.textRemoveControl,iconCls:"menu__icon cc-remove",value:"remove"},{caption:"--"},{caption:this.mniEditControls,value:"settings"},{caption:this.mniHighlightControls,value:"highlight",menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[this.mnuNoControlsColor=new Common.UI.MenuItem({id:"id-toolbar-menu-no-highlight-controls",caption:this.textNoHighlight,checkable:!0}),{caption:"--"},{template:e.template('<div id="id-toolbar-menu-controls-color" style="width: 169px; height: 94px; margin: 10px;"></div>')},{template:e.template('<a id="id-toolbar-menu-new-control-color" style="padding-left:12px;">'+this.textNewColor+"</a>")}]})}]})}),this.btnColumns=new Common.UI.Button({id:"tlbtn-columns",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-columns",caption:s.capBtnColumns,menu:new Common.UI.Menu({cls:"ppm-toolbar shifted-right",items:[{caption:this.textColumnsOne,iconCls:"menu__icon columns-one",checkable:!0,checkmark:!1,toggleGroup:"menuColumns",value:0},{caption:this.textColumnsTwo,iconCls:"menu__icon columns-two",checkable:!0,checkmark:!1,toggleGroup:"menuColumns",value:1},{caption:this.textColumnsThree,iconCls:"menu__icon columns-three",checkable:!0,checkmark:!1,toggleGroup:"menuColumns",value:2},{caption:this.textColumnsLeft,iconCls:"menu__icon columns-left",checkmark:!1,checkable:!0,toggleGroup:"menuColumns",value:3},{caption:this.textColumnsRight,iconCls:"menu__icon columns-right",checkmark:!1,checkable:!0,toggleGroup:"menuColumns",value:4},{caption:"--"},{caption:this.textColumnsCustom,value:"advanced"}]})}),this.paragraphControls.push(this.btnColumns),this.btnPageOrient=new Common.UI.Button({id:"tlbtn-pageorient",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-pageorient",caption:s.capBtnPageOrient,menu:new Common.UI.Menu({cls:"ppm-toolbar",items:[{caption:this.textPortrait,iconCls:"menu__icon page-portrait",checkable:!0,checkmark:!1,toggleGroup:"menuOrient",value:!0},{caption:this.textLandscape,iconCls:"menu__icon page-landscape",checkable:!0,checkmark:!1,toggleGroup:"menuOrient",value:!1}]})}),this.toolbarControls.push(this.btnPageOrient);var r=e.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div><b><%= caption %></b></div><% if (options.value !== null) { %><div style="display: inline-block;margin-right: 20px;min-width: 80px;"><label style="display: block;">'+this.textTop+'<%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[0]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %></label><label style="display: block;">'+this.textLeft+'<%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[1]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %></label></div><div style="display: inline-block;"><label style="display: block;">'+this.textBottom+'<%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[2]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %></label><label style="display: block;">'+this.textRight+"<%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[3]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %></label></div><% } %></a>");this.btnPageMargins=new Common.UI.Button({id:"tlbtn-pagemargins",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-pagemargins",caption:s.capBtnMargins,menu:new Common.UI.Menu({items:[{caption:this.textMarginsLast,checkable:!0,template:r,toggleGroup:"menuPageMargins"},{caption:this.textMarginsNormal,checkable:!0,template:r,toggleGroup:"menuPageMargins",value:[20,30,20,15]},{caption:this.textMarginsUsNormal,checkable:!0,template:r,toggleGroup:"menuPageMargins",value:[25.4,25.4,25.4,25.4]},{caption:this.textMarginsNarrow,checkable:!0,template:r,toggleGroup:"menuPageMargins",value:[12.7,12.7,12.7,12.7]},{caption:this.textMarginsModerate,checkable:!0,template:r,toggleGroup:"menuPageMargins",value:[25.4,19.1,25.4,19.1]},{caption:this.textMarginsWide,checkable:!0,template:r,toggleGroup:"menuPageMargins",value:[25.4,50.8,25.4,50.8]},{caption:"--"},{caption:this.textPageMarginsCustom,value:"advanced"}]})}),this.toolbarControls.push(this.btnPageMargins);var l=e.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div><b><%= caption %></b></div><div><%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[0]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %> x <%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[1]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %></div></a>');this.btnPageSize=new Common.UI.Button({id:"tlbtn-pagesize",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-pagesize",caption:s.capBtnPageSize,menu:new Common.UI.Menu({restoreHeight:!0,items:[{caption:"US Letter",subtitle:"21,59cm x 27,94cm",template:l,checkable:!0,toggleGroup:"menuPageSize",value:[215.9,279.4]},{caption:"US Legal",subtitle:"21,59cm x 35,56cm",template:l,checkable:!0,toggleGroup:"menuPageSize",value:[215.9,355.6]},{caption:"A4",subtitle:"21cm x 29,7cm",template:l,checkable:!0,toggleGroup:"menuPageSize",value:[210,297],checked:!0},{caption:"A5",subtitle:"14,81cm x 20,99cm",template:l,checkable:!0,toggleGroup:"menuPageSize",value:[148,210]},{caption:"B5",subtitle:"17,6cm x 25,01cm",template:l,checkable:!0,toggleGroup:"menuPageSize",value:[176,250]},{caption:"Envelope #10",subtitle:"10,48cm x 24,13cm",template:l,checkable:!0,toggleGroup:"menuPageSize",value:[104.8,241.3]},{caption:"Envelope DL",subtitle:"11,01cm x 22,01cm",template:l,checkable:!0,toggleGroup:"menuPageSize",value:[110,220]},{caption:"Tabloid",subtitle:"27,94cm x 43,17cm",template:l,checkable:!0,toggleGroup:"menuPageSize",value:[279.4,431.8]},{caption:"A3",subtitle:"29,7cm x 42,01cm",template:l,checkable:!0,toggleGroup:"menuPageSize",value:[297,420]},{caption:"Tabloid Oversize",subtitle:"30,48cm x 45,71cm",template:l,checkable:!0,toggleGroup:"menuPageSize",value:[304.8,457.1]},{caption:"ROC 16K",subtitle:"19,68cm x 27,3cm",template:l,checkable:!0,toggleGroup:"menuPageSize",value:[196.8,273]},{caption:"Envelope Choukei 3",subtitle:"11,99cm x 23,49cm",template:l,checkable:!0,toggleGroup:"menuPageSize",value:[119.9,234.9]},{caption:"Super B/A3",subtitle:"33,02cm x 48,25cm",template:l,checkable:!0,toggleGroup:"menuPageSize",value:[330.2,482.5]},{caption:"--"},{caption:this.textPageSizeCustom,value:"advanced"}]})}),this.toolbarControls.push(this.btnPageSize),this.btnLineNumbers=new Common.UI.Button({id:"tlbtn-line-numbers",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-line-numbering",caption:s.capBtnLineNumbers,menu:new Common.UI.Menu({cls:"ppm-toolbar",items:[{caption:this.textNone,checkable:!0,toggleGroup:"menuLineNumbers",value:0},{caption:this.textContinuous,checkable:!0,toggleGroup:"menuLineNumbers",value:1},{caption:this.textRestartEachPage,checkable:!0,toggleGroup:"menuLineNumbers",value:2},{caption:this.textRestartEachSection,checkable:!0,toggleGroup:"menuLineNumbers",value:3},{caption:this.textSuppressForCurrentParagraph,checkable:!0,allowDepress:!0,value:4},{caption:"--"},{caption:this.textCustomLineNumbers,value:5}]})}),this.toolbarControls.push(this.btnLineNumbers),this.btnClearStyle=new Common.UI.Button({id:"id-toolbar-btn-clearstyle",cls:"btn-toolbar",iconCls:"toolbar__icon btn-clearstyle"}),this.toolbarControls.push(this.btnClearStyle),this.btnCopyStyle=new Common.UI.Button({id:"id-toolbar-btn-copystyle",cls:"btn-toolbar",iconCls:"toolbar__icon btn-copystyle",enableToggle:!0}),this.toolbarControls.push(this.btnCopyStyle),this.btnColorSchemas=new Common.UI.Button({id:"id-toolbar-btn-colorschemas",cls:"btn-toolbar",iconCls:"toolbar__icon btn-colorschemas",menu:new Common.UI.Menu({cls:"shifted-left",items:[],restoreHeight:!0})}),this.toolbarControls.push(this.btnColorSchemas),this.btnMailRecepients=new Common.UI.Button({id:"id-toolbar-btn-mailrecepients",cls:"btn-toolbar",iconCls:"toolbar__icon btn-mailmerge"}),s.btnImgAlign=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-img-align",caption:s.capImgAlign,menu:!0}),s.btnImgGroup=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-img-group",caption:s.capImgGroup,menu:!0}),s.btnImgForward=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-img-frwd",caption:s.capImgForward,split:!0,menu:!0}),s.btnImgBackward=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-img-bkwd",caption:s.capImgBackward,split:!0,menu:!0}),s.btnImgWrapping=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-img-wrap",caption:s.capImgWrapping,menu:!0}),s.btnWatermark=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-watermark",caption:s.capBtnWatermark,menu:new Common.UI.Menu({cls:"ppm-toolbar",items:[{caption:this.textEditWatermark,value:"edit"},{caption:this.textRemWatermark,value:"remove"}]})}),s.toolbarControls.push(s.btnImgAlign,s.btnImgGroup,s.btnImgForward,s.btnImgBackward,s.btnImgWrapping,s.btnWatermark),this.mnuLineSpace=this.btnLineSpace.menu,this.mnuNonPrinting=this.btnShowHidenChars.menu,this.mnuInsertTable=this.btnInsertTable.menu,this.mnuInsertImage=this.btnInsertImage.menu,this.mnuPageSize=this.btnPageSize.menu,this.mnuColorSchema=this.btnColorSchemas.menu,this.mnuChangeCase=this.btnChangeCase.menu,this.cmbFontSize=new Common.UI.ComboBox({cls:"input-group-nr",menuStyle:"min-width: 55px;",hint:this.tipFontSize,data:[{value:8,displayValue:"8"},{value:9,displayValue:"9"},{value:10,displayValue:"10"},{value:11,displayValue:"11"},{value:12,displayValue:"12"},{value:14,displayValue:"14"},{value:16,displayValue:"16"},{value:18,displayValue:"18"},{value:20,displayValue:"20"},{value:22,displayValue:"22"},{value:24,displayValue:"24"},{value:26,displayValue:"26"},{value:28,displayValue:"28"},{value:36,displayValue:"36"},{value:48,displayValue:"48"},{value:72,displayValue:"72"},{value:96,displayValue:"96"}]}),this.paragraphControls.push(this.cmbFontSize),this.cmbFontName=new Common.UI.ComboBoxFonts({cls:"input-group-nr",menuCls:"scrollable-menu",menuStyle:"min-width: 325px;",hint:this.tipFontName,store:new Common.Collections.Fonts}),this.paragraphControls.push(this.cmbFontName),this.listStylesAdditionalMenuItem=new Common.UI.MenuItem({template:e.template('<div id="id-save-style-container" class = "save-style-container"><span id="id-save-style-plus" class="add-style-icon toolbar__icon btn-zoomup"  ></span><label id="id-save-style-link" class="save-style-link" >'+s.textStyleMenuNew+"</label></div>")}),this.listStyles=new Common.UI.ComboDataView({cls:"combo-styles",itemWidth:104,itemHeight:40,enableKeyEvents:!0,additionalMenuItems:[this.listStylesAdditionalMenuItem],beforeOpenHandler:function(e){var i=this,n=i.openButton.menu;if(n.cmpEl){var o=t(i.cmpEl.find(".dataview.inner .style").get(0)).parent(),s=-1;Common.Utils.applicationPixelRatio()>1&&Common.Utils.applicationPixelRatio()<2&&(s+=1/Common.Utils.applicationPixelRatio());var a=o.is(":visible")?parseInt(o.css("width")):i.itemWidth+parseInt(o.css("padding-left"))+parseInt(o.css("padding-right"))+parseInt(o.css("border-left-width"))+parseInt(o.css("border-right-width")),r=i.menuPicker.store.length>=6?6:i.menuPicker.store.length,l=Math.min(i.menuPicker.store.length,Math.round(t(".dataview",t(i.fieldPicker.el)).width()/(s+a)+.5));l=l<r?r:l,n.menuAlignEl=i.cmpEl,n.menuAlign="tl-tl";var c=i.cmpEl.width()-i.openButton.$el.width()-l*(s+a)-1;n.setOffset(Math.min(c,0)),n.cmpEl.css({width:l*(a+s),"min-height":i.cmpEl.height()})}i.menuPicker.scroller&&i.menuPicker.scroller.update({includePadding:!0,suppressScrollX:!0}),i.removeTips()}}),this.listStyles.fieldPicker.itemTemplate=e.template(['<div class="style" id="<%= id %>">','<div style="background-image: url(<%= imageUrl %>); width: '+this.listStyles.itemWidth+"px; height: "+this.listStyles.itemHeight+'px;"></div>',"</div>"].join("")),this.listStyles.menuPicker.itemTemplate=e.template(['<div class="style" id="<%= id %>">','<div style="background-image: url(<%= imageUrl %>); width: '+this.listStyles.itemWidth+"px; height: "+this.listStyles.itemHeight+'px;"></div>',"</div>"].join("")),this.paragraphControls.push(this.listStyles),this.textOnlyControls.push(this.listStyles),e.each(this.toolbarControls.concat(this.paragraphControls),function(t){e.isFunction(t.setDisabled)&&t.setDisabled(!0)}),this.btnMailRecepients.setDisabled(!0);var c=new Common.UI.MenuItem({caption:s.textStyleMenuUpdate}).on("click",e.bind(s.onStyleMenuUpdate,s)),d=new Common.UI.MenuItem({caption:s.textStyleMenuDelete}).on("click",e.bind(s.onStyleMenuDelete,s)),h=new Common.UI.MenuItem({caption:s.textStyleMenuRestore}).on("click",e.bind(s.onStyleMenuDelete,s)),p=new Common.UI.MenuItem({caption:s.textStyleMenuRestoreAll}).on("click",e.bind(s.onStyleMenuRestoreAll,s)),m=new Common.UI.MenuItem({caption:s.textStyleMenuDeleteAll}).on("click",e.bind(s.onStyleMenuDeleteAll,s));null==this.styleMenu&&(this.styleMenu=new Common.UI.Menu({items:[c,d,h,p,m]})),this.on("render:after",e.bind(this.onToolbarAfterRender,this))}else Common.UI.Mixtbar.prototype.initialize.call(this,{template:e.template(o),tabs:[{caption:s.textTabFile,action:"file",haspanel:!1}]});return this},render:function(e){var i=this;if(this.fireEvent("render:before",[this]),i.isCompactView=e.isCompactView,e.isEdit?i.$el.html(i.rendererComponents(i.$layout)):(i.$layout.find(".canedit").hide(),i.isCompactView&&i.$layout.addClass("folded"),i.$el.html(i.$layout)),this.fireEvent("render:after",[this]),Common.UI.Mixtbar.prototype.afterRender.call(this),Common.NotificationCenter.on({"window:resize":function(){Common.UI.Mixtbar.prototype.onResize.apply(i,arguments)}}),e.isEdit){this.showSynchTip=!Common.localStorage.getBool("de-hide-synch"),this.needShowSynchTip=!1,i.setTab("home");var n=Common.localStorage.getItem("de-pgmargins-top"),o=Common.localStorage.getItem("de-pgmargins-left"),s=Common.localStorage.getItem("de-pgmargins-bottom"),a=Common.localStorage.getItem("de-pgmargins-right");if(null!==n&&null!==o&&null!==s&&null!==a){var r=this.btnPageMargins.menu.items[0];r.options.value=r.value=[parseFloat(n),parseFloat(o),parseFloat(s),parseFloat(a)],r.setVisible(!0),t(r.el).html(r.template({id:Common.UI.getId(),caption:r.caption,options:r.options}))}else this.btnPageMargins.menu.items[0].setVisible(!1)}return i.isCompactView&&i.setFolded(!0),this},onTabClick:function(e){var i=this,n=t(e.currentTarget).find("> a[data-tab]").data("tab"),o=i.isTabActive("file");Common.UI.Mixtbar.prototype.onTabClick.apply(i,arguments),o?i.fireEvent("file:close"):"file"==n&&(i.fireEvent("file:open"),i.setTab(n)),i.isTabActive("home")&&i.fireEvent("home:open")},rendererComponents:function(e){var i=t(e),n=function(t,e){Common.Utils.injectComponent(i.findById(t),e)};return n("#slot-field-fontname",this.cmbFontName),n("#slot-field-fontsize",this.cmbFontSize),n("#slot-btn-print",this.btnPrint),n("#slot-btn-save",this.btnSave),n("#slot-btn-undo",this.btnUndo),n("#slot-btn-redo",this.btnRedo),n("#slot-btn-copy",this.btnCopy),n("#slot-btn-paste",this.btnPaste),n("#slot-btn-incfont",this.btnIncFontSize),n("#slot-btn-decfont",this.btnDecFontSize),n("#slot-btn-bold",this.btnBold),n("#slot-btn-italic",this.btnItalic),n("#slot-btn-underline",this.btnUnderline),n("#slot-btn-strikeout",this.btnStrikeout),n("#slot-btn-superscript",this.btnSuperscript),n("#slot-btn-subscript",this.btnSubscript),n("#slot-btn-highlight",this.btnHighlightColor),n("#slot-btn-fontcolor",this.btnFontColor),n("#slot-btn-changecase",this.btnChangeCase),n("#slot-btn-align-left",this.btnAlignLeft),n("#slot-btn-align-center",this.btnAlignCenter),n("#slot-btn-align-right",this.btnAlignRight),n("#slot-btn-align-just",this.btnAlignJust),n("#slot-btn-incoffset",this.btnIncLeftOffset),n("#slot-btn-decoffset",this.btnDecLeftOffset),n("#slot-btn-linespace",this.btnLineSpace),n("#slot-btn-hidenchars",this.btnShowHidenChars),n("#slot-btn-markers",this.btnMarkers),n("#slot-btn-numbering",this.btnNumbers),n("#slot-btn-multilevels",this.btnMultilevels),n("#slot-btn-instable",this.btnInsertTable),n("#slot-btn-insimage",this.btnInsertImage),n("#slot-btn-inschart",this.btnInsertChart),n("#slot-btn-instext",this.btnInsertText),n("#slot-btn-instextart",this.btnInsertTextArt),n("#slot-btn-dropcap",this.btnDropCap),n("#slot-btn-controls",this.btnContentControls),n("#slot-btn-columns",this.btnColumns),n("#slot-btn-line-numbers",this.btnLineNumbers),n("#slot-btn-editheader",this.btnEditHeader),n("#slot-btn-datetime",this.btnInsDateTime),n("#slot-btn-blankpage",this.btnBlankPage),n("#slot-btn-insshape",this.btnInsertShape),n("#slot-btn-insequation",this.btnInsertEquation),n("#slot-btn-inssymbol",this.btnInsertSymbol),n("#slot-btn-pageorient",this.btnPageOrient),n("#slot-btn-pagemargins",this.btnPageMargins),n("#slot-btn-pagesize",this.btnPageSize),n("#slot-btn-clearstyle",this.btnClearStyle),n("#slot-btn-copystyle",this.btnCopyStyle),n("#slot-btn-colorschemas",this.btnColorSchemas),n("#slot-btn-paracolor",this.btnParagraphColor),n("#slot-field-styles",this.listStyles),n("#slot-btn-mailrecepients",this.btnMailRecepients),n("#slot-img-align",this.btnImgAlign),n("#slot-img-group",this.btnImgGroup),n("#slot-img-movefrwd",this.btnImgForward),n("#slot-img-movebkwd",this.btnImgBackward),n("#slot-img-wrapping",this.btnImgWrapping),n("#slot-btn-watermark",this.btnWatermark),this.btnsPageBreak=Common.Utils.injectButtons(i.find(".btn-slot.btn-pagebreak"),"","toolbar__icon btn-pagebreak",this.capBtnInsPagebreak,void 0,!0,!0),Array.prototype.push.apply(this.paragraphControls,this.btnsPageBreak),i},onAppReady:function(t){var e=this;new Promise(function(t,e){t()}).then(function(){if(t.isEdit){e.btnsPageBreak.forEach(function(t){t.updateHint([e.textInsPageBreak,e.tipPageBreak]);var i=new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:e.textNextPage,value:Asc.c_oAscSectionBreakType.NextPage},{caption:e.textContPage,value:Asc.c_oAscSectionBreakType.Continuous},{caption:e.textEvenPage,value:Asc.c_oAscSectionBreakType.EvenPage},{caption:e.textOddPage,value:Asc.c_oAscSectionBreakType.OddPage}]}),n=new Common.UI.Menu({items:[{caption:e.textInsPageBreak,value:"page"},{caption:e.textInsColumnBreak,value:"column"},{caption:e.textInsSectionBreak,value:"section",menu:i}]});t.setMenu(n)});var i=DE.getController("DocumentHolder").getView();e.btnImgForward.updateHint(e.tipSendForward),e.btnImgForward.setMenu(new Common.UI.Menu({items:[{caption:i.textArrangeFront,iconCls:"menu__icon arrange-front",valign:Asc.c_oAscChangeLevel.BringToFront},{caption:i.textArrangeForward,iconCls:"menu__icon arrange-forward",valign:Asc.c_oAscChangeLevel.BringForward}]})),e.btnImgBackward.updateHint(e.tipSendBackward),e.btnImgBackward.setMenu(new Common.UI.Menu({items:[{caption:i.textArrangeBack,iconCls:"menu__icon arrange-back",valign:Asc.c_oAscChangeLevel.SendToBack},{caption:i.textArrangeBackward,iconCls:"menu__icon arrange-backward",valign:Asc.c_oAscChangeLevel.BringBackward}]})),e.btnImgAlign.updateHint(e.tipImgAlign),e.mniAlignToPage=new Common.UI.MenuItem({caption:e.txtPageAlign,checkable:!0,toggleGroup:"imgalign",value:-1}).on("click",function(t){Common.Utils.InternalSettings.set("de-img-align-to",1)}),e.mniAlignToMargin=new Common.UI.MenuItem({caption:e.txtMarginAlign,checkable:!0,toggleGroup:"imgalign",value:-1}).on("click",function(t){Common.Utils.InternalSettings.set("de-img-align-to",2)}),e.mniAlignObjects=new Common.UI.MenuItem({caption:e.txtObjectsAlign,checkable:!0,toggleGroup:"imgalign",value:-1}).on("click",function(t){Common.Utils.InternalSettings.set("de-img-align-to",3)}),e.mniDistribHor=new Common.UI.MenuItem({caption:e.txtDistribHor,iconCls:"menu__icon shape-distribute-hor",value:6}),e.mniDistribVert=new Common.UI.MenuItem({caption:e.txtDistribVert,iconCls:"menu__icon shape-distribute-vert",value:7}),e.btnImgAlign.setMenu(new Common.UI.Menu({cls:"shifted-right",items:[{caption:i.textShapeAlignLeft,iconCls:"menu__icon shape-align-left",value:Asc.c_oAscAlignShapeType.ALIGN_LEFT},{caption:i.textShapeAlignCenter,iconCls:"menu__icon shape-align-center",value:Asc.c_oAscAlignShapeType.ALIGN_CENTER},{caption:i.textShapeAlignRight,iconCls:"menu__icon shape-align-right",value:Asc.c_oAscAlignShapeType.ALIGN_RIGHT},{caption:i.textShapeAlignTop,iconCls:"menu__icon shape-align-top",value:Asc.c_oAscAlignShapeType.ALIGN_TOP},{caption:i.textShapeAlignMiddle,iconCls:"menu__icon shape-align-middle",value:Asc.c_oAscAlignShapeType.ALIGN_MIDDLE},{caption:i.textShapeAlignBottom,iconCls:"menu__icon shape-align-bottom",value:Asc.c_oAscAlignShapeType.ALIGN_BOTTOM},{caption:"--"},e.mniDistribHor,e.mniDistribVert,{caption:"--"},e.mniAlignToPage,e.mniAlignToMargin,e.mniAlignObjects]})),e.btnImgGroup.updateHint(e.tipImgGroup),e.btnImgGroup.setMenu(new Common.UI.Menu({items:[{caption:i.txtGroup,iconCls:"menu__icon shape-group",groupval:1},{caption:i.txtUngroup,iconCls:"menu__icon shape-ungroup",groupval:-1}]})),e.btnImgWrapping.updateHint(e.tipImgWrapping),e.btnImgWrapping.setMenu(new Common.UI.Menu({cls:"ppm-toolbar shifted-right",items:[{caption:i.txtInline,iconCls:"menu__icon wrap-inline",toggleGroup:"imgwrapping",wrapType:Asc.c_oAscWrapStyle2.Inline,checkmark:!1,checkable:!0},{caption:i.txtSquare,iconCls:"menu__icon wrap-square",toggleGroup:"imgwrapping",wrapType:Asc.c_oAscWrapStyle2.Square,checkmark:!1,checkable:!0},{caption:i.txtTight,iconCls:"menu__icon wrap-tight",toggleGroup:"imgwrapping",wrapType:Asc.c_oAscWrapStyle2.Tight,checkmark:!1,checkable:!0},{caption:i.txtThrough,iconCls:"menu__icon wrap-through",toggleGroup:"imgwrapping",wrapType:Asc.c_oAscWrapStyle2.Through,checkmark:!1,checkable:!0},{caption:i.txtTopAndBottom,iconCls:"menu__icon wrap-topandbottom",toggleGroup:"imgwrapping",wrapType:Asc.c_oAscWrapStyle2.TopAndBottom,checkmark:!1,checkable:!0},{caption:i.txtInFront,iconCls:"menu__icon wrap-infront",toggleGroup:"imgwrapping",wrapType:Asc.c_oAscWrapStyle2.InFront,checkmark:!1,checkable:!0},{caption:i.txtBehind,iconCls:"menu__icon wrap-behind",toggleGroup:"imgwrapping",wrapType:Asc.c_oAscWrapStyle2.Behind,checkmark:!1,checkable:!0},{caption:"--"},{caption:i.textEditWrapBoundary,wrapType:"edit"}]})),e.btnWatermark.updateHint(e.tipWatermark),!t.canFeatureContentControl&&e.btnContentControls.cmpEl&&e.btnContentControls.cmpEl.parents(".group").hide().prev(".separator").hide()}})},createDelayedElements:function(){this.api&&(this.mnuNonPrinting.items[0].setChecked(this.api.get_ShowParaMarks(),!0),this.mnuNonPrinting.items[1].setChecked(this.api.get_ShowTableEmptyLine(),!0),this.btnShowHidenChars.toggle(this.mnuNonPrinting.items[0].checked,!0),this.updateMetricUnit()),this.btnPrint.updateHint(this.tipPrint+Common.Utils.String.platformKey("Ctrl+P")),this.btnSave.updateHint(this.btnSaveTip),this.btnUndo.updateHint(this.tipUndo+Common.Utils.String.platformKey("Ctrl+Z")),this.btnRedo.updateHint(this.tipRedo+Common.Utils.String.platformKey("Ctrl+Y")),this.btnCopy.updateHint(this.tipCopy+Common.Utils.String.platformKey("Ctrl+C")),this.btnPaste.updateHint(this.tipPaste+Common.Utils.String.platformKey("Ctrl+V")),this.btnIncFontSize.updateHint(this.tipIncFont+Common.Utils.String.platformKey("Ctrl+]")),this.btnDecFontSize.updateHint(this.tipDecFont+Common.Utils.String.platformKey("Ctrl+[")),this.btnBold.updateHint(this.textBold+Common.Utils.String.platformKey("Ctrl+B")),this.btnItalic.updateHint(this.textItalic+Common.Utils.String.platformKey("Ctrl+I")),this.btnUnderline.updateHint(this.textUnderline+Common.Utils.String.platformKey("Ctrl+U")),this.btnStrikeout.updateHint(this.textStrikeout),this.btnSuperscript.updateHint(this.textSuperscript),this.btnSubscript.updateHint(this.textSubscript),this.btnHighlightColor.updateHint(this.tipHighlightColor),this.btnFontColor.updateHint(this.tipFontColor),this.btnParagraphColor.updateHint(this.tipPrColor),this.btnChangeCase.updateHint(this.tipChangeCase),this.btnAlignLeft.updateHint(this.tipAlignLeft+Common.Utils.String.platformKey("Ctrl+L")),this.btnAlignCenter.updateHint(this.tipAlignCenter+Common.Utils.String.platformKey("Ctrl+E")),this.btnAlignRight.updateHint(this.tipAlignRight+Common.Utils.String.platformKey("Ctrl+R")),this.btnAlignJust.updateHint(this.tipAlignJust+Common.Utils.String.platformKey("Ctrl+J")),this.btnDecLeftOffset.updateHint(this.tipDecPrLeft+Common.Utils.String.platformKey("Ctrl+Shift+M")),this.btnIncLeftOffset.updateHint(this.tipIncPrLeft+Common.Utils.String.platformKey("Ctrl+M")),this.btnLineSpace.updateHint(this.tipLineSpace),this.btnShowHidenChars.updateHint(this.tipShowHiddenChars+Common.Utils.String.platformKey("Ctrl+*")),this.btnMarkers.updateHint(this.tipMarkers),this.btnNumbers.updateHint(this.tipNumbers),
this.btnMultilevels.updateHint(this.tipMultilevels),this.btnInsertTable.updateHint(this.tipInsertTable),this.btnInsertImage.updateHint(this.tipInsertImage),this.btnInsertChart.updateHint(this.tipInsertChart),this.btnInsertText.updateHint(this.tipInsertText),this.btnInsertTextArt.updateHint(this.tipInsertTextArt),this.btnEditHeader.updateHint(this.tipEditHeader),this.btnInsDateTime.updateHint(this.tipDateTime),this.btnBlankPage.updateHint(this.tipBlankPage),this.btnInsertShape.updateHint(this.tipInsertShape),this.btnInsertEquation.updateHint(this.tipInsertEquation),this.btnInsertSymbol.updateHint(this.tipInsertSymbol),this.btnDropCap.updateHint(this.tipDropCap),this.btnContentControls.updateHint(this.tipControls),this.btnColumns.updateHint(this.tipColumns),this.btnPageOrient.updateHint(this.tipPageOrient),this.btnPageSize.updateHint(this.tipPageSize),this.btnPageMargins.updateHint(this.tipPageMargins),this.btnLineNumbers.updateHint(this.tipLineNumbers),this.btnClearStyle.updateHint(this.tipClearStyle),this.btnCopyStyle.updateHint(this.tipCopyStyle+Common.Utils.String.platformKey("Ctrl+Shift+C")),this.btnColorSchemas.updateHint(this.tipColorSchemas),this.btnMailRecepients.updateHint(this.tipMailRecepients);for(var i=this,n=e.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div id="<%= options.previewId %>" class="menu-list-preview" style="width: 200px; height: 30px;"></div></a>'),o=[],s=[],a=0;a<9;a++)s.push("id-toolbar-menu-markers-level-"+a),o.push({template:n,previewId:s[a],level:a,checkable:!0});this.btnMarkers.setMenu(new Common.UI.Menu({cls:"shifted-left",style:"min-width: 145px",items:[{template:e.template('<div id="id-toolbar-menu-markers" class="menu-markers" style="width: 145px; margin: 0 9px;"></div>')},{caption:"--"},this.mnuMarkerChangeLevel=new Common.UI.MenuItem({caption:this.textChangeLevel,style:"padding-right:20px;",disabled:0==(this.mnuMarkersPicker.conf.index||0),menu:new Common.UI.Menu({cls:"list-settings-level",menuAlign:"tl-tr",items:o,previewIds:s})}),this.mnuMarkerSettings=new Common.UI.MenuItem({caption:this.textListSettings,disabled:0==(this.mnuMarkersPicker.conf.index||0),value:"settings"})]})),o=[],s=[];for(var a=0;a<9;a++)s.push("id-toolbar-menu-numbering-level-"+a),o.push({template:n,previewId:s[a],level:a,checkable:!0});this.btnNumbers.setMenu(new Common.UI.Menu({cls:"shifted-left",items:[{template:e.template('<div id="id-toolbar-menu-numbering" class="menu-markers" style="width: 353px; margin: 0 9px;"></div>')},{caption:"--"},this.mnuNumberChangeLevel=new Common.UI.MenuItem({caption:this.textChangeLevel,style:"padding-right:20px;",disabled:0==(this.mnuNumbersPicker.conf.index||0),menu:new Common.UI.Menu({cls:"list-settings-level",menuAlign:"tl-tr",items:o,previewIds:s})}),this.mnuNumberSettings=new Common.UI.MenuItem({caption:this.textListSettings,disabled:0==(this.mnuNumbersPicker.conf.index||0),value:"settings"})]})),o=[],s=[];for(var a=0;a<9;a++)s.push("id-toolbar-menu-multilevels-level-"+a),o.push({template:n,previewId:s[a],level:a,checkable:!0});this.btnMultilevels.setMenu(new Common.UI.Menu({cls:"shifted-left",style:"min-width: 177px",items:[{template:e.template('<div id="id-toolbar-menu-multilevels" class="menu-markers" style="width: 185px; margin: 0 9px;"></div>')},{caption:"--"},this.mnuMultiChangeLevel=new Common.UI.MenuItem({caption:this.textChangeLevel,style:"padding-right:20px;",disabled:0==(this.mnuMultilevelPicker.conf.index||0),menu:new Common.UI.Menu({cls:"list-settings-level",menuAlign:"tl-tr",items:o,previewIds:s})}),this.mnuMultilevelSettings=new Common.UI.MenuItem({caption:this.textListSettings,disabled:0==(this.mnuMultilevelPicker.conf.index||0),value:"settings"})]})),this.btnEditHeader.setMenu(new Common.UI.Menu({items:[{caption:this.mniEditHeader,value:"header"},{caption:this.mniEditFooter,value:"footer"},{caption:"--"},this.mnuInsertPageNum=new Common.UI.MenuItem({caption:this.textInsertPageNumber,disabled:this.mnuInsertPageNum.isDisabled(),menu:new Common.UI.Menu({cls:"shifted-left",menuAlign:"tl-tr",style:"min-width: 90px;",items:[{template:e.template('<div id="id-toolbar-menu-pageposition" class="menu-pageposition"></div>')},this.mnuPageNumCurrentPos=new Common.UI.MenuItem({caption:this.textToCurrent,disabled:this.mnuPageNumCurrentPos.isDisabled(),value:"current"})]})}),this.mnuInsertPageCount=new Common.UI.MenuItem({caption:this.textInsertPageCount,disabled:this.mnuInsertPageCount.isDisabled()})]})),this.paragraphControls.push(this.mnuPageNumCurrentPos),this.paragraphControls.push(this.mnuInsertPageCount),this.btnInsertChart.setMenu(new Common.UI.Menu({style:"width: 364px;padding-top: 12px;",items:[{template:e.template('<div id="id-toolbar-menu-insertchart" class="menu-insertchart"></div>')}]}));var r=function(n){new Common.UI.DataView({el:t("#id-toolbar-menu-insertchart"),parentMenu:n,showLast:!1,restoreHeight:465,groups:new Common.UI.DataViewGroupStore(Common.define.chartData.getChartGroupData()),store:new Common.UI.DataViewStore(Common.define.chartData.getChartData()),itemTemplate:e.template('<div id="<%= id %>" class="item-chartlist"><svg width="40" height="40" class="icon"><use xlink:href="#chart-<%= iconCls %>"></use></svg></div>')}).on("item:click",function(t,e,n,o){n&&i.fireEvent("add:chart",[n.get("type")])}),n.off("show:before",r)};this.btnInsertChart.menu.on("show:before",r);var l=function(n){var o=DE.getCollection("Common.Collections.TextArt");o.length<1&&DE.getController("Main").fillTextArt(i.api.asc_getTextArtPreviews()),new Common.UI.DataView({el:t("#id-toolbar-menu-insart"),store:o,parentMenu:n,showLast:!1,itemTemplate:e.template('<div class="item-art"><img src="<%= imageUrl %>" id="<%= id %>" style="width:50px;height:50px;"></div>')}).on("item:click",function(t,e,o,s){o&&i.fireEvent("insert:textart",[o.get("data")]),"click"!==s.type&&n.hide()}),n.off("show:before",l)};this.btnInsertTextArt.menu.on("show:before",l);var c=this.mnuMarkersPicker.conf;this.mnuMarkersPicker=new Common.UI.DataView({el:t("#id-toolbar-menu-markers"),parentMenu:this.btnMarkers.menu,restoreHeight:138,allowScrollbar:!1,store:new Common.UI.DataViewStore([{id:"id-markers-"+Common.UI.getId(),data:{type:0,subtype:-1},skipRenderOnChange:!0},{id:"id-markers-"+Common.UI.getId(),data:{type:0,subtype:1},skipRenderOnChange:!0},{id:"id-markers-"+Common.UI.getId(),data:{type:0,subtype:2},skipRenderOnChange:!0},{id:"id-markers-"+Common.UI.getId(),data:{type:0,subtype:3},skipRenderOnChange:!0},{id:"id-markers-"+Common.UI.getId(),data:{type:0,subtype:4},skipRenderOnChange:!0},{id:"id-markers-"+Common.UI.getId(),data:{type:0,subtype:5},skipRenderOnChange:!0},{id:"id-markers-"+Common.UI.getId(),data:{type:0,subtype:6},skipRenderOnChange:!0},{id:"id-markers-"+Common.UI.getId(),data:{type:0,subtype:7},skipRenderOnChange:!0},{id:"id-markers-"+Common.UI.getId(),data:{type:0,subtype:8},skipRenderOnChange:!0}]),itemTemplate:e.template('<div id="<%= id %>" class="item-markerlist"></div>')}),c&&this.mnuMarkersPicker.selectByIndex(c.index,!0),c=this.mnuNumbersPicker.conf,this.mnuNumbersPicker=new Common.UI.DataView({el:t("#id-toolbar-menu-numbering"),parentMenu:this.btnNumbers.menu,restoreHeight:92,allowScrollbar:!1,store:new Common.UI.DataViewStore([{id:"id-numbers-"+Common.UI.getId(),data:{type:1,subtype:-1},skipRenderOnChange:!0},{id:"id-numbers-"+Common.UI.getId(),data:{type:1,subtype:4},skipRenderOnChange:!0},{id:"id-numbers-"+Common.UI.getId(),data:{type:1,subtype:5},skipRenderOnChange:!0},{id:"id-numbers-"+Common.UI.getId(),data:{type:1,subtype:6},skipRenderOnChange:!0},{id:"id-numbers-"+Common.UI.getId(),data:{type:1,subtype:1},skipRenderOnChange:!0},{id:"id-numbers-"+Common.UI.getId(),data:{type:1,subtype:2},skipRenderOnChange:!0},{id:"id-numbers-"+Common.UI.getId(),data:{type:1,subtype:3},skipRenderOnChange:!0},{id:"id-numbers-"+Common.UI.getId(),data:{type:1,subtype:7},skipRenderOnChange:!0}]),itemTemplate:e.template('<div id="<%= id %>" class="item-multilevellist"></div>')}),c&&this.mnuNumbersPicker.selectByIndex(c.index,!0),c=this.mnuMultilevelPicker.conf,this.mnuMultilevelPicker=new Common.UI.DataView({el:t("#id-toolbar-menu-multilevels"),parentMenu:this.btnMultilevels.menu,restoreHeight:92,allowScrollbar:!1,store:new Common.UI.DataViewStore([{id:"id-multilevels-"+Common.UI.getId(),data:{type:2,subtype:-1},skipRenderOnChange:!0},{id:"id-multilevels-"+Common.UI.getId(),data:{type:2,subtype:1},skipRenderOnChange:!0},{id:"id-multilevels-"+Common.UI.getId(),data:{type:2,subtype:2},skipRenderOnChange:!0},{id:"id-multilevels-"+Common.UI.getId(),data:{type:2,subtype:3},skipRenderOnChange:!0}]),itemTemplate:e.template('<div id="<%= id %>" class="item-multilevellist"></div>')}),c&&this.mnuMultilevelPicker.selectByIndex(c.index,!0),c=this.mnuPageNumberPosPicker?this.mnuPageNumberPosPicker.conf:void 0,this.mnuPageNumberPosPicker=new Common.UI.DataView({el:t("#id-toolbar-menu-pageposition"),allowScrollbar:!1,store:new Common.UI.DataViewStore([{allowSelected:!1,iconname:"page-number-top-left",data:{type:c_pageNumPosition.PAGE_NUM_POSITION_TOP,subtype:c_pageNumPosition.PAGE_NUM_POSITION_LEFT}},{allowSelected:!1,iconname:"page-number-top-center",data:{type:c_pageNumPosition.PAGE_NUM_POSITION_TOP,subtype:c_pageNumPosition.PAGE_NUM_POSITION_CENTER}},{allowSelected:!1,iconname:"page-number-top-right",data:{type:c_pageNumPosition.PAGE_NUM_POSITION_TOP,subtype:c_pageNumPosition.PAGE_NUM_POSITION_RIGHT}},{allowSelected:!1,iconname:"page-number-bottom-left",data:{type:c_pageNumPosition.PAGE_NUM_POSITION_BOTTOM,subtype:c_pageNumPosition.PAGE_NUM_POSITION_LEFT}},{allowSelected:!1,iconname:"page-number-bottom-center",data:{type:c_pageNumPosition.PAGE_NUM_POSITION_BOTTOM,subtype:c_pageNumPosition.PAGE_NUM_POSITION_CENTER}},{allowSelected:!1,iconname:"page-number-bottom-right",data:{type:c_pageNumPosition.PAGE_NUM_POSITION_BOTTOM,subtype:c_pageNumPosition.PAGE_NUM_POSITION_RIGHT}}]),itemTemplate:e.template('<div id="<%= id %>" class="item-pagenumber options__icon options__icon-huge <%= iconname %>"></div>')}),c&&this.mnuPageNumberPosPicker.setDisabled(c.disabled),this.mnuTablePicker=new Common.UI.DimensionPicker({el:t("#id-toolbar-menu-tablepicker"),minRows:8,minColumns:10,maxRows:8,maxColumns:10})},onToolbarAfterRender:function(e){this.btnHighlightColor.cmpEl&&(this.btnHighlightColor.currentColor="FFFF00",this.btnHighlightColor.setColor(this.btnHighlightColor.currentColor),this.mnuHighlightColorPicker=new Common.UI.ColorPalette({el:t("#id-toolbar-menu-highlight"),colors:["FFFF00","00FF00","00FFFF","FF00FF","0000FF","FF0000","00008B","008B8B","006400","800080","8B0000","808000","FFFFFF","D3D3D3","A9A9A9","000000"]}),this.mnuHighlightColorPicker.select("FFFF00")),this.btnFontColor.cmpEl&&(this.btnFontColor.setColor(this.btnFontColor.currentColor||"transparent"),this.mnuFontColorPicker=new Common.UI.ThemeColorPalette({el:t("#id-toolbar-menu-fontcolor")})),this.btnParagraphColor.cmpEl&&(this.btnParagraphColor.setColor(this.btnParagraphColor.currentColor||"transparent"),this.mnuParagraphColorPicker=new Common.UI.ThemeColorPalette({el:t("#id-toolbar-menu-paracolor"),transparent:!0})),this.btnContentControls.cmpEl&&(this.mnuControlsColorPicker=new Common.UI.ThemeColorPalette({el:t("#id-toolbar-menu-controls-color"),colors:["000000","993300","333300","003300","003366","000080","333399","333333","800000","FF6600","808000","00FF00","008080","0000FF","666699","808080","FF0000","FF9900","99CC00","339966","33CCCC","3366FF","800080","999999","FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0","FF99CC","FFCC99","FFFF99","CCFFCC","CCFFFF","C9C8FF","CC99FF","FFFFFF"]}))},updateMetricUnit:function(){for(var e=this.btnPageMargins.menu.items,i=0;i<e.length;i++){var n=e[i];if(n.checkable){var o=n.checked;t(n.el).html(n.template({id:Common.UI.getId(),caption:n.caption,options:n.options})),o&&n.setChecked(o)}}e=this.btnPageSize.menu.items;for(var i=0;i<e.length;i++){var n=e[i];if(n.checkable){var o=n.checked;t(n.el).html(n.template({id:Common.UI.getId(),caption:n.caption,options:n.options})),o&&n.setChecked(o)}}},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onSendThemeColorSchemes",e.bind(this.onSendThemeColorSchemes,this)),this.api.asc_registerCallback("asc_onCollaborativeChanges",e.bind(this.onCollaborativeChanges,this)),this.api.asc_registerCallback("asc_onAuthParticipantsChanged",e.bind(this.onApiUsersChanged,this)),this.api.asc_registerCallback("asc_onParticipantsChanged",e.bind(this.onApiUsersChanged,this)),this},setMode:function(t){t.isDisconnected&&(this.btnSave.setDisabled(!0),t.enableDownload||this.btnPrint.setDisabled(!0)),this.mode=t,this.btnMailRecepients.setVisible(1==t.canCoAuthoring&&t.canUseMailMerge),this.listStylesAdditionalMenuItem.setVisible(t.canEditStyles),this.btnContentControls.menu.items[10].setVisible(t.canEditContentControl),this.mnuInsertImage.items[2].setVisible(this.mode.canRequestInsertImage||this.mode.fileChoiceUrl&&this.mode.fileChoiceUrl.indexOf("{documentType}")>-1)},onSendThemeColorSchemes:function(t){var i=this;this.mnuColorSchema&&this.mnuColorSchema.items.length>0&&e.each(this.mnuColorSchema.items,function(t){t.remove()}),null==this.mnuColorSchema&&(this.mnuColorSchema=new Common.UI.Menu({cls:"shifted-left",restoreHeight:!0})),this.mnuColorSchema.items=[];var n=e.template(['<a id="<%= id %>"  tabindex="-1" type="menuitem" class="<%= options.cls %>">','<span class="colors">',"<% _.each(options.colors, function(color) { %>",'<span class="color" style="background: <%= color %>;"></span>',"<% }) %>","</span>",'<span class="text"><%= caption %></span>',"</a>"].join(""));e.each(t,function(t,e){for(var o=t.get_colors(),s=[],a=2;a<7;a++){var r="#"+Common.Utils.ThemeColor.getHexColor(o[a].get_r(),o[a].get_g(),o[a].get_b());s.push(r)}22==e&&this.mnuColorSchema.addItem({caption:"--"});var l=t.get_name();this.mnuColorSchema.addItem({template:n,cls:"color-schemas-menu",colors:s,caption:e<22?i.SchemeNames[e]||l:l,value:e,checkable:!0,toggleGroup:"menuSchema"})},this)},onCollaborativeChanges:function(){if(!this._state.hasCollaborativeChanges){if(!this.btnCollabChanges.rendered||this._state.previewmode)return void(this.needShowSynchTip=!0);this._state.hasCollaborativeChanges=!0,this.btnCollabChanges.cmpEl.addClass("notify"),this.showSynchTip?(this.btnCollabChanges.updateHint(""),void 0===this.synchTooltip&&this.createSynchTip(),this.synchTooltip.show()):this.btnCollabChanges.updateHint(this.tipSynchronize+Common.Utils.String.platformKey("Ctrl+S")),this.btnSave.setDisabled(!1),Common.Gateway.collaborativeChanges()}},createSynchTip:function(){this.synchTooltip=new Common.UI.SynchronizeTip({extCls:this.mode.customization&&this.mode.customization.compactHeader?void 0:"inc-index",placement:"right-bottom",target:this.btnCollabChanges.$el}),this.synchTooltip.on("dontshowclick",function(){this.showSynchTip=!1,this.synchTooltip.hide(),this.btnCollabChanges.updateHint(this.tipSynchronize+Common.Utils.String.platformKey("Ctrl+S")),Common.localStorage.setItem("de-hide-synch",1)},this),this.synchTooltip.on("closeclick",function(){this.synchTooltip.hide(),this.btnCollabChanges.updateHint(this.tipSynchronize+Common.Utils.String.platformKey("Ctrl+S"))},this)},synchronizeChanges:function(){if(!this._state.previewmode&&this.btnCollabChanges.rendered){var t=this;t.btnCollabChanges.cmpEl.hasClass("notify")&&(t.btnCollabChanges.cmpEl.removeClass("notify"),this.synchTooltip&&this.synchTooltip.hide(),this.btnCollabChanges.updateHint(this.btnSaveTip),this.btnSave.setDisabled(!t.mode.forcesave),this._state.hasCollaborativeChanges=!1)}},onApiUsersChanged:function(t){var i=[];e.each(t,function(t){t.asc_getView()||i.push(t)});var n=this,o=e.size(i),s=o>1?"btn-save-coauth":"btn-save";s!==n.btnSaveCls&&n.btnCollabChanges.rendered&&(n.btnSaveTip=(o>1?n.tipSaveCoauth:n.tipSave)+Common.Utils.String.platformKey("Ctrl+S"),n.btnCollabChanges.updateHint(n.btnSaveTip),n.btnCollabChanges.$icon.removeClass(n.btnSaveCls).addClass(s),n.btnSaveCls=s)},onStyleMenuUpdate:function(t,e,i){var n=this;if(n.api){var o=n.api.asc_GetStyleFromFormatting(),s=t.styleTitle,a=o.get_Link();o.put_Name(s),a.put_Name(s+"_character"),n.api.asc_AddNewStyle(o),setTimeout(function(){n.listStyles.openButton.menu.hide()},100)}},onStyleMenuDelete:function(t,e,i){this.api&&this.api.asc_RemoveStyle(t.styleTitle)},onStyleMenuRestoreAll:function(t,i,n){var o=this;o.api&&e.each(window.styles.get_MergedStyles(),function(t){o.api.asc_IsStyleDefault(t.get_Name())&&o.api.asc_RemoveStyle(t.get_Name())})},onStyleMenuDeleteAll:function(t,e,i){this.api&&this.api.asc_RemoveAllCustomStyles()},textBold:"Bold",textItalic:"Italic",textUnderline:"Underline",textStrikeout:"Strikeout",textSuperscript:"Superscript",textSubscript:"Subscript",strMenuNoFill:"No Fill",tipFontName:"Font Name",tipFontSize:"Font Size",tipParagraphStyle:"Paragraph Style",tipCopy:"Copy",tipPaste:"Paste",tipUndo:"Undo",tipRedo:"Redo",tipPrint:"Print",tipSave:"Save",tipIncFont:"Increment font size",tipDecFont:"Decrement font size",tipHighlightColor:"Highlight color",tipFontColor:"Font color",tipMarkers:"Bullets",tipNumbers:"Numbering",tipMultilevels:"Outline",tipAlignLeft:"Align Left",tipAlignRight:"Align Right",tipAlignCenter:"Align Center",tipAlignJust:"Justified",tipDecPrLeft:"Decrease Indent",tipIncPrLeft:"Increase Indent",tipShowHiddenChars:"Nonprinting Characters",tipLineSpace:"Paragraph Line Spacing",tipPrColor:"Background color",tipInsertTable:"Insert Table",tipInsertImage:"Insert Image",tipPageBreak:"Insert Page or Section break",tipInsertNum:"Insert Page Number",tipClearStyle:"Clear Style",tipCopyStyle:"Copy Style",tipPageSize:"Page Size",tipPageOrient:"Page Orientation",tipBack:"Back",tipInsertShape:"Insert Autoshape",tipInsertEquation:"Insert Equation",mniImageFromFile:"Image from File",mniImageFromUrl:"Image from URL",mniCustomTable:"Insert Custom Table",textTitleError:"Error",textInsertPageNumber:"Insert page number",textToCurrent:"To Current Position",tipEditHeader:"Edit header or footer",mniEditHeader:"Edit Document Header",mniEditFooter:"Edit Document Footer",mniHiddenChars:"Nonprinting Characters",mniHiddenBorders:"Hidden Table Borders",tipSynchronize:"The document has been changed by another user. Please click to save your changes and reload the updates.",textNewColor:"Add New Custom Color",textAutoColor:"Automatic",tipInsertChart:"Insert Chart",tipColorSchemas:"Change Color Scheme",tipInsertText:"Insert Text",tipInsertTextArt:"Insert Text Art",mniEditDropCap:"Drop Cap Settings",textNone:"None",textInText:"In Text",textInMargin:"In Margin",tipDropCap:"Insert drop cap",txtScheme1:"Office",txtScheme2:"Grayscale",txtScheme3:"Apex",txtScheme4:"Aspect",txtScheme5:"Civic",txtScheme6:"Concourse",txtScheme7:"Equity",txtScheme8:"Flow",txtScheme9:"Foundry",txtScheme10:"Median",txtScheme11:"Metro",txtScheme12:"Module",txtScheme13:"Opulent",txtScheme14:"Oriel",txtScheme15:"Origin",txtScheme16:"Paper",txtScheme17:"Solstice",txtScheme18:"Technic",txtScheme19:"Trek",txtScheme20:"Urban",txtScheme21:"Verve",textInsPageBreak:"Insert Page Break",textInsColumnBreak:"Insert Column Break",textInsSectionBreak:"Insert Section Break",textNextPage:"Next Page",textContPage:"Continuous Page",textEvenPage:"Even Page",textOddPage:"Odd Page",tipSaveCoauth:"Save your changes for the other users to see them.",tipMailRecepients:"Mail Merge",textStyleMenuUpdate:"Update from select",textStyleMenuRestore:"Restore to default",textStyleMenuDelete:"Delete style",textStyleMenuRestoreAll:"Restore all to default styles",textStyleMenuDeleteAll:"Delete all custom styles",textStyleMenuNew:"New style from selection",tipColumns:"Insert columns",textColumnsOne:"One",textColumnsTwo:"Two",textColumnsThree:"Three",textColumnsLeft:"Left",textColumnsRight:"Right",tipPageMargins:"Page Margins",textMarginsLast:"Last Custom",textMarginsNormal:"Normal",textMarginsUsNormal:"US Normal",textMarginsNarrow:"Narrow",textMarginsModerate:"Moderate",textMarginsWide:"Wide",textPageMarginsCustom:"Custom margins",textTop:"Top: ",textLeft:"Left: ",textBottom:"Bottom: ",textRight:"Right: ",textPageSizeCustom:"Custom Page Size",textPortrait:"Portrait",textLandscape:"Landscape",textInsertPageCount:"Insert number of pages",tipChangeChart:"Change Chart Type",capBtnInsPagebreak:"Page Break",capBtnInsImage:"Image",capBtnInsTable:"Table",capBtnInsChart:"Chart",textTabFile:"File",textTabHome:"Home",textTabInsert:"Insert",textTabLayout:"Layout",textTabReview:"Review",capBtnInsShape:"Shape",capBtnInsTextbox:"Text Box",capBtnInsTextart:"Text Art",capBtnInsDropcap:"Drop Cap",capBtnInsEquation:"Equation",capBtnInsHeader:"Header/Footer",capBtnColumns:"Columns",capBtnPageOrient:"Orientation",capBtnMargins:"Margins",capBtnPageSize:"Size",tipImgAlign:"Align objects",tipImgGroup:"Group objects",tipImgWrapping:"Wrap text",tipSendForward:"Bring forward",tipSendBackward:"Send backward",capImgAlign:"Align",capImgGroup:"Group",capImgForward:"Bring Forward",capImgBackward:"Send Backward",capImgWrapping:"Wrapping",capBtnComment:"Comment",textColumnsCustom:"Custom Columns",textTabCollaboration:"Collaboration",textTabProtect:"Protection",textTabLinks:"References",capBtnInsControls:"Content Control",textRichControl:"Rich text",textPlainControl:"Plain text",textRemoveControl:"Remove",mniEditControls:"Settings",tipControls:"Insert content control",mniHighlightControls:"Highlight settings",textNoHighlight:"No highlighting",mniImageFromStorage:"Image from Storage",capBtnBlankPage:"Blank Page",tipBlankPage:"Insert blank page",txtDistribHor:"Distribute Horizontally",txtDistribVert:"Distribute Vertically",txtPageAlign:"Align to Page",txtMarginAlign:"Align to Margin",txtObjectsAlign:"Align Selected Objects",capBtnWatermark:"Watermark",textEditWatermark:"Custom Watermark",textRemWatermark:"Remove Watermark",tipWatermark:"Edit watermark",textPictureControl:"Picture",textComboboxControl:"Combo box",textCheckboxControl:"Check box",textDropdownControl:"Drop-down list",textDateControl:"Date",capBtnAddComment:"Add Comment",capBtnInsSymbol:"Symbol",tipInsertSymbol:"Insert symbol",mniDrawTable:"Draw Table",mniEraseTable:"Erase Table",textListSettings:"List Settings",capBtnDateTime:"Date & Time",tipDateTime:"Insert current date and time",capBtnLineNumbers:"Line Numbers",textContinuous:"Continuous",textRestartEachPage:"Restart Each Page",textRestartEachSection:"Restart Each Section",textSuppressForCurrentParagraph:"Suppress for Current Paragraph",textCustomLineNumbers:"Line Numbering Options",tipLineNumbers:"Show line numbers",tipChangeCase:"Change case",mniSentenceCase:"Sentence case.",mniLowerCase:"lowercase",mniUpperCase:"UPPERCASE",mniCapitalizeWords:"Capitalize Each Word",mniToggleCase:"tOGGLE cASE",textChangeLevel:"Change List Level",mniTextToTable:"Convert Text to Table",txtScheme22:"New Office"}}(),DE.Views.Toolbar||{}))}),void 0===Common)var Common={};if(define("documenteditor/main/app/view/StyleTitleDialog",["common/main/lib/util/utils","common/main/lib/component/InputField","common/main/lib/component/Window"],function(){"use strict";DE.Views.StyleTitleDialog=Common.UI.Window.extend(_.extend({options:{width:350,height:196,style:"min-width: 230px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textHeader},t||{}),this.template=['<div class="box">','<label class="input-row" style="margin-bottom: -5px;">'+this.textTitle+" </label>",'<div id="id-dlg-style-title" class="input-row" style="margin-bottom: 5px;"></div>','<label class="input-row" style="margin-bottom: -5px; margin-top: 5px;">'+this.textNextStyle+"</label>",'<div id="id-dlg-style-next-par" class="input-group-nr" style="margin-bottom: 5px;" ></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.options.formats=this.options.formats||[],Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this,e=this.getChild();t.inputTitle=new Common.UI.InputField({el:$("#id-dlg-style-title"),allowBlank:!1,blankError:t.txtEmpty,style:"width: 100%;",validateOnBlur:!1,validation:function(e){return!(""==e)||t.txtNotEmpty}}),e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.options.formats.unshift({value:-1,displayValue:this.txtSameAs}),this.cmbNextStyle=new Common.UI.ComboBox({el:$("#id-dlg-style-next-par"),style:"width: 100%;",menuStyle:"width: 100%; max-height: 210px;",editable:!1,takeFocusOnClose:!0,cls:"input-group-nr",data:this.options.formats,disabled:0==this.options.formats.length}),this.cmbNextStyle.setValue(-1)},getFocusedComponents:function(){return[this.inputTitle,this.cmbNextStyle]},getDefaultFocusableComponent:function(){return this.inputTitle},getTitle:function(){return this.inputTitle.getValue()},getNextStyle:function(){var t=this.cmbNextStyle.getValue();return-1!=t?t:null},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(t){return this._handleInput("ok"),!1},_handleInput:function(t){if(this.options.handler){if("ok"==t){if(!0!==this.inputTitle.checkValidate())return void this.inputTitle.focus()}this.options.handler.call(this,this,t)}this.close()},textTitle:"Title",textHeader:"Create New Style",txtEmpty:"This field is required",txtNotEmpty:"Field must not be empty",textNextStyle:"Next paragraph style",txtSameAs:"Same as created new style"},DE.Views.StyleTitleDialog||{}))}),define("documenteditor/main/app/view/PageMarginsDialog",["common/main/lib/component/Window","common/main/lib/component/MetricSpinner"],function(){"use strict";DE.Views.PageMarginsDialog=Common.UI.Window.extend(_.extend({options:{width:404,header:!0,style:"min-width: 404px;",cls:"modal-dlg",id:"window-page-margins",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box" style="height: 245px;">','<div style="float: left;">','<label style="font-weight: bold;">'+this.textTitle+"</label>",'<div style="margin-top: 2px;">','<div style="display: inline-block;">','<label class="input-label">'+this.textTop+"</label>",'<div id="page-margins-spin-top"></div>',"</div>",'<div style="display: inline-block; margin-left: 8px;">','<label class="input-label">'+this.textBottom+"</label>",'<div id="page-margins-spin-bottom"></div>',"</div>","</div>",'<div style="margin-top: 4px;">','<div style="display: inline-block;">','<label class="input-label" id="margin-left-label">'+this.textLeft+"</label>",'<div id="page-margins-spin-left"></div>',"</div>",'<div style="display: inline-block; margin-left: 8px;">','<label class="input-label" id="margin-right-label">'+this.textRight+"</label>",'<div id="page-margins-spin-right"></div>',"</div>","</div>",'<div style="margin-top: 10px;">','<label style="font-weight: bold;">'+this.textGutterPosition+"</label>","<div>",'<div style="display: inline-block;" id="page-margins-spin-gutter"></div>','<div style="display: inline-block; margin-left: 8px;" id="page-margins-spin-gutter-position"></div>',"</div>","</div>",'<div style="margin-top: 10px;">','<label style="font-weight: bold;">'+this.textOrientation+"</label>",'<div id="page-margins-cmb-orientation"></div>',"</div>",'<div style="margin-top: 10px;">','<label style="font-weight: bold;">'+this.textMultiplePages+"</label>",'<div id="page-margins-cmb-multiple-pages"></div>',"</div>","</div>",'<div style="float: right;">','<label style="font-weight: bold;">'+this.textPreview+"</label>",'<div id="page-margins-preview" style="margin-top: 2px; height: 120px; width: 162px;"></div>',"</div>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.spinners=[],this._noApply=!1,this.maxMarginsW=this.maxMarginsH=0,this.api=this.options.api,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.spnTop=new Common.UI.MetricSpinner({el:$("#page-margins-spin-top"),step:.1,width:86,defaultUnit:"cm",value:"1 cm",maxValue:55.88,minValue:-55.87}),this.spnTop.on("change",_.bind(function(t,e,i){this.api&&(this.properties=this.properties?this.properties:new Asc.CDocumentSectionProps,this.properties.put_TopMargin(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api.SetDrawImagePreviewMargins("page-margins-preview",this.properties))},this)),this.spinners.push(this.spnTop),this.spnBottom=new Common.UI.MetricSpinner({el:$("#page-margins-spin-bottom"),step:.1,width:86,defaultUnit:"cm",value:"1 cm",maxValue:55.88,minValue:-55.87}),this.spnBottom.on("change",_.bind(function(t,e,i){this.api&&(this.properties=this.properties?this.properties:new Asc.CDocumentSectionProps,this.properties.put_BottomMargin(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api.SetDrawImagePreviewMargins("page-margins-preview",this.properties))},this)),this.spinners.push(this.spnBottom),this.spnLeft=new Common.UI.MetricSpinner({el:$("#page-margins-spin-left"),step:.1,width:86,defaultUnit:"cm",value:"1 cm",maxValue:55.88,minValue:0}),this.spnLeft.on("change",_.bind(function(t,e,i){this.api&&(this.properties=this.properties?this.properties:new Asc.CDocumentSectionProps,this.properties.put_LeftMargin(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api.SetDrawImagePreviewMargins("page-margins-preview",this.properties))},this)),this.spinners.push(this.spnLeft),this.spnRight=new Common.UI.MetricSpinner({el:$("#page-margins-spin-right"),step:.1,width:86,defaultUnit:"cm",value:"1 cm",maxValue:55.88,minValue:0}),this.spnRight.on("change",_.bind(function(t,e,i){this.api&&(this.properties=this.properties?this.properties:new Asc.CDocumentSectionProps,this.properties.put_RightMargin(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api.SetDrawImagePreviewMargins("page-margins-preview",this.properties))},this)),this.spinners.push(this.spnRight),this.spnGutter=new Common.UI.MetricSpinner({el:$("#page-margins-spin-gutter"),step:.1,width:86,defaultUnit:"cm",value:"1 cm",maxValue:55.88,minValue:0}),this.spnGutter.on("change",_.bind(function(t,e,i){this.api&&(this.properties=this.properties?this.properties:new Asc.CDocumentSectionProps,this.properties.put_Gutter(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api.SetDrawImagePreviewMargins("page-margins-preview",this.properties))},this)),this.spinners.push(this.spnGutter),this.cmbGutterPosition=new Common.UI.ComboBox({el:$("#page-margins-spin-gutter-position"),menuStyle:"min-width: 86px;",style:"width: 86px;",editable:!1,takeFocusOnClose:!0,cls:"input-group-nr",data:[{value:0,displayValue:this.textLeft},{value:1,displayValue:this.textTop}]}),this.cmbGutterPosition.on("selected",_.bind(function(t,e){this.api&&(this.properties=this.properties?this.properties:new Asc.CDocumentSectionProps,this.properties.put_GutterAtTop(e.value),this.api.SetDrawImagePreviewMargins("page-margins-preview",this.properties))},this)),this.cmbOrientation=new Common.UI.ComboBox({el:$("#page-margins-cmb-orientation"),menuStyle:"min-width: 180px;",style:"width: 180px;",editable:!1,takeFocusOnClose:!0,cls:"input-group-nr",data:[{value:0,displayValue:this.textPortrait},{value:1,displayValue:this.textLandscape}]}),this.cmbOrientation.on("selected",_.bind(function(t,e){if(this.api&&(this.properties=this.properties?this.properties:new Asc.CDocumentSectionProps,this.properties.get_Orientation()!==e.value)){this.properties.put_TopMargin(Common.Utils.Metric.fnRecalcToMM(e.value?this.spnLeft.getNumberValue():this.spnRight.getNumberValue())),this.properties.put_BottomMargin(Common.Utils.Metric.fnRecalcToMM(e.value?this.spnRight.getNumberValue():this.spnLeft.getNumberValue())),this.properties.put_LeftMargin(Common.Utils.Metric.fnRecalcToMM(e.value?this.spnBottom.getNumberValue():this.spnTop.getNumberValue())),this.properties.put_RightMargin(Common.Utils.Metric.fnRecalcToMM(e.value?this.spnTop.getNumberValue():this.spnBottom.getNumberValue()));var i=this.properties.get_H();this.properties.put_H(this.properties.get_W()),this.properties.put_W(i),
this.properties.put_Orientation(e.value),this.maxMarginsH=Common.Utils.Metric.fnRecalcFromMM(this.properties.get_H()-2.6),this.maxMarginsW=Common.Utils.Metric.fnRecalcFromMM(this.properties.get_W()-12.7),this.spnTop.setMaxValue(this.maxMarginsH),this.spnBottom.setMaxValue(this.maxMarginsH),this.spnLeft.setMaxValue(this.maxMarginsW),this.spnRight.setMaxValue(this.maxMarginsW),this.spnTop.setValue(Common.Utils.Metric.fnRecalcFromMM(this.properties.get_TopMargin()),!0),this.spnBottom.setValue(Common.Utils.Metric.fnRecalcFromMM(this.properties.get_BottomMargin()),!0),this.spnLeft.setValue(Common.Utils.Metric.fnRecalcFromMM(this.properties.get_LeftMargin()),!0),this.spnRight.setValue(Common.Utils.Metric.fnRecalcFromMM(this.properties.get_RightMargin()),!0),this.api.SetDrawImagePreviewMargins("page-margins-preview",this.properties)}},this)),this.cmbMultiplePages=new Common.UI.ComboBox({el:$("#page-margins-cmb-multiple-pages"),menuStyle:"min-width: 180px;",style:"width: 180px;",editable:!1,takeFocusOnClose:!0,cls:"input-group-nr",data:[{value:0,displayValue:this.textNormal},{value:1,displayValue:this.textMirrorMargins}]}),this.cmbMultiplePages.on("selected",_.bind(function(t,e){0===e.value?(this.window.find("#margin-left-label").html(this.textLeft),this.window.find("#margin-right-label").html(this.textRight),this.cmbGutterPosition.setDisabled(!1)):(this.window.find("#margin-left-label").html(this.textInside),this.window.find("#margin-right-label").html(this.textOutside),this.cmbGutterPosition.setValue(0),this.cmbGutterPosition.setDisabled(!0)),this.api&&(this.properties=this.properties?this.properties:new Asc.CDocumentSectionProps,this.properties.put_MirrorMargins(e.value),this.api.SetDrawImagePreviewMargins("page-margins-preview",this.properties))},this)),this.window=this.getChild(),this.window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.on("animate:after",_.bind(this.onAnimateAfter,this)),this.updateMetricUnit()},getFocusedComponents:function(){return[this.spnTop,this.spnBottom,this.spnLeft,this.spnRight,this.spnGutter,this.cmbGutterPosition,this.cmbOrientation,this.cmbMultiplePages]},getDefaultFocusableComponent:function(){return this.spnTop},onAnimateAfter:function(){this.api&&this.properties&&this.api.SetDrawImagePreviewMargins("page-margins-preview",this.properties)},_handleInput:function(t){if(this.options.handler){if("ok"==t){var e=null;if(this.spnLeft.getNumberValue()+this.spnRight.getNumberValue()+(this.cmbGutterPosition.getValue()?0:this.spnGutter.getNumberValue())>this.maxMarginsW?e=this.txtMarginsW:Math.abs(this.spnTop.getNumberValue()+this.spnBottom.getNumberValue()+(this.cmbGutterPosition.getValue()?this.spnGutter.getNumberValue():0))>this.maxMarginsH&&(e=this.txtMarginsH),e)return void Common.UI.warning({title:this.notcriticalErrorTitle,msg:e})}this.options.handler.call(this,this,t)}this.close()},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(t){return this._handleInput("ok"),!1},setSettings:function(t){if(t){this.properties=t,this.maxMarginsH=Common.Utils.Metric.fnRecalcFromMM(t.get_H()-2.6),this.maxMarginsW=Common.Utils.Metric.fnRecalcFromMM(t.get_W()-12.7),this.spnTop.setMaxValue(this.maxMarginsH),this.spnBottom.setMaxValue(this.maxMarginsH),this.spnLeft.setMaxValue(this.maxMarginsW),this.spnRight.setMaxValue(this.maxMarginsW),this.spnTop.setValue(Common.Utils.Metric.fnRecalcFromMM(t.get_TopMargin()),!0),this.spnBottom.setValue(Common.Utils.Metric.fnRecalcFromMM(t.get_BottomMargin()),!0),this.spnLeft.setValue(Common.Utils.Metric.fnRecalcFromMM(t.get_LeftMargin()),!0),this.spnRight.setValue(Common.Utils.Metric.fnRecalcFromMM(t.get_RightMargin()),!0),this.cmbOrientation.setValue(t.get_Orientation()),this.spnGutter.setValue(Common.Utils.Metric.fnRecalcFromMM(t.get_Gutter()),!0),this.cmbGutterPosition.setValue(t.get_GutterAtTop()?1:0);var e=t.get_MirrorMargins();this.cmbMultiplePages.setValue(e?1:0),e&&(this.window.find("#margin-left-label").html(this.textInside),this.window.find("#margin-right-label").html(this.textOutside),this.cmbGutterPosition.setValue(0)),this.cmbGutterPosition.setDisabled(e)}},getSettings:function(){var t=new Asc.CDocumentSectionProps;return t.put_TopMargin(Common.Utils.Metric.fnRecalcToMM(this.spnTop.getNumberValue())),t.put_BottomMargin(Common.Utils.Metric.fnRecalcToMM(this.spnBottom.getNumberValue())),t.put_LeftMargin(Common.Utils.Metric.fnRecalcToMM(this.spnLeft.getNumberValue())),t.put_RightMargin(Common.Utils.Metric.fnRecalcToMM(this.spnRight.getNumberValue())),t.put_Orientation(this.cmbOrientation.getValue()),t.put_Gutter(Common.Utils.Metric.fnRecalcToMM(this.spnGutter.getNumberValue())),t.put_GutterAtTop(!!this.cmbGutterPosition.getValue()),t.put_MirrorMargins(!!this.cmbMultiplePages.getValue()),t.put_H(this.properties.get_H()),t.put_W(this.properties.get_W()),t},updateMetricUnit:function(){if(this.spinners)for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}},textTitle:"Margins",textTop:"Top",textLeft:"Left",textBottom:"Bottom",textRight:"Right",notcriticalErrorTitle:"Warning",txtMarginsW:"Left and right margins are too high for a given page wight",txtMarginsH:"Top and bottom margins are too high for a given page height",textMultiplePages:"Multiple pages",textGutter:"Gutter",textGutterPosition:"Gutter position",textOrientation:"Orientation",textPreview:"Preview",textPortrait:"Portrait",textLandscape:"Landscape",textMirrorMargins:"Mirror margins",textNormal:"Normal",textInside:"Inside",textOutside:"Outside"},DE.Views.PageMarginsDialog||{}))}),define("documenteditor/main/app/view/PageSizeDialog",["common/main/lib/component/Window","common/main/lib/component/MetricSpinner"],function(){"use strict";DE.Views.PageSizeDialog=Common.UI.Window.extend(_.extend({options:{width:215,header:!0,style:"min-width: 216px;",cls:"modal-dlg",id:"window-page-size",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box" style="height: 85px;">','<table cols="2" style="width: 100%;">',"<tr>",'<td colspan="2">','<label class="input-label">'+this.textPreset+"</label>",'<div id="page-size-combo-preset" class="input-group-nr" style="margin-bottom: 10px;"></div>',"</td>","</tr>","<tr>",'<td style="padding-right: 10px;">','<label class="input-label">'+this.textWidth+"</label>",'<div id="page-size-spin-width"></div>',"</td>","<td>",'<label class="input-label">'+this.textHeight+"</label>",'<div id="page-size-spin-height"></div>',"</td>","</tr>","</table>","</div>",'<div class="separator horizontal"></div>'].join(""),this.options.tpl=_.template(this.template)(this.options),this.spinners=[],this._noApply=!1,this.isOrientPortrait=!0,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.spnWidth=new Common.UI.MetricSpinner({el:$("#page-size-spin-width"),step:.1,width:86,defaultUnit:"cm",value:"10 cm",maxValue:118.9,minValue:0}),this.spinners.push(this.spnWidth),this.spnWidth.on("change",_.bind(function(t,e,i,n){!this._noApply&&this.cmbPreset.getValue()>-1&&this.cmbPreset.setValue(-1)},this)),this.spnHeight=new Common.UI.MetricSpinner({el:$("#page-size-spin-height"),step:.1,width:86,defaultUnit:"cm",value:"20 cm",maxValue:118.9,minValue:0}),this.spinners.push(this.spnHeight),this.spnHeight.on("change",_.bind(function(t,e,i,n){!this._noApply&&this.cmbPreset.getValue()>-1&&this.cmbPreset.setValue(-1)},this)),this.cmbPreset=new Common.UI.ComboBox({el:$("#page-size-combo-preset"),cls:"input-group-nr",menuStyle:"min-width: 183px;max-height: 208px;",editable:!1,takeFocusOnClose:!0,scrollAlwaysVisible:!0,data:[{value:0,displayValue:"US Letter",size:[215.9,279.4]},{value:1,displayValue:"US Legal",size:[215.9,355.6]},{value:2,displayValue:"A4",size:[210,297]},{value:3,displayValue:"A5",size:[148,210]},{value:4,displayValue:"B5",size:[176,250]},{value:5,displayValue:"Envelope #10",size:[104.8,241.3]},{value:6,displayValue:"Envelope DL",size:[110,220]},{value:7,displayValue:"Tabloid",size:[279.4,431.8]},{value:8,displayValue:"A3",size:[297,420]},{value:9,displayValue:"Tabloid Oversize",size:[304.8,457.1]},{value:10,displayValue:"ROC 16K",size:[196.8,273]},{value:11,displayValue:"Envelope Choukei 3",size:[119.9,234.9]},{value:12,displayValue:"Super B/A3",size:[330.2,482.5]},{value:13,displayValue:"A0",size:[841,1189]},{value:14,displayValue:"A1",size:[594,841]},{value:16,displayValue:"A2",size:[420,594]},{value:17,displayValue:"A6",size:[105,148]},{value:-1,displayValue:this.txtCustom,size:[]}]}),this.cmbPreset.setValue(-1),this.cmbPreset.on("selected",_.bind(function(t,e){this._noApply=!0,e.value<0||(this.spnWidth.setValue(Common.Utils.Metric.fnRecalcFromMM(this.isOrientPortrait?e.size[0]:e.size[1]),!0),this.spnHeight.setValue(Common.Utils.Metric.fnRecalcFromMM(this.isOrientPortrait?e.size[1]:e.size[0]),!0)),this._noApply=!1},this)),this.getChild().find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.updateMetricUnit()},getFocusedComponents:function(){return[this.cmbPreset,this.spnWidth,this.spnHeight]},getDefaultFocusableComponent:function(){return this.cmbPreset},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,this,t),this.close()},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(t){return this._handleInput("ok"),!1},setSettings:function(t){if(t){this.isOrientPortrait=t.get_W()<t.get_H(),this.spnWidth.setMinValue(Common.Utils.Metric.fnRecalcFromMM(t.get_LeftMargin()+t.get_RightMargin()+12.7)),this.spnWidth.setValue(Common.Utils.Metric.fnRecalcFromMM(t.get_W()),!0),this.spnHeight.setMinValue(Common.Utils.Metric.fnRecalcFromMM(t.get_TopMargin()+t.get_BottomMargin()+2.6)),this.spnHeight.setValue(Common.Utils.Metric.fnRecalcFromMM(t.get_H()),!0);var e=this.isOrientPortrait?t.get_W():t.get_H(),i=this.isOrientPortrait?t.get_H():t.get_W(),n=this.cmbPreset.store.find(function(t){var n=t.get("size");return Math.abs(n[0]-e)<.1&&Math.abs(n[1]-i)<.1});this.cmbPreset.setValue(n?n.get("value"):-1)}},getSettings:function(){return[Common.Utils.Metric.fnRecalcToMM(this.spnWidth.getNumberValue()),Common.Utils.Metric.fnRecalcToMM(this.spnHeight.getNumberValue())]},updateMetricUnit:function(){if(this.spinners)for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}},textTitle:"Page Size",textWidth:"Width",textHeight:"Height",textPreset:"Preset",txtCustom:"Custom"},DE.Views.PageSizeDialog||{}))}),define("documenteditor/main/app/controller/PageLayout",["core"],function(){"use strict";DE.Controllers.PageLayout=Backbone.Controller.extend(function(){var t;return{initialize:function(){},onLaunch:function(t){return this.toolbar=t,this.editMode=!0,this},onAppReady:function(t){var e=this;e.toolbar.btnImgAlign.menu.on("item:click",e.onClickMenuAlign.bind(e)),e.toolbar.btnImgAlign.menu.on("show:before",e.onBeforeShapeAlign.bind(e)),e.toolbar.btnImgWrapping.menu.on("item:click",e.onClickMenuWrapping.bind(e)),e.toolbar.btnImgGroup.menu.on("item:click",e.onClickMenuGroup.bind(e)),e.toolbar.btnImgForward.menu.on("item:click",e.onClickMenuForward.bind(e)),e.toolbar.btnImgBackward.menu.on("item:click",e.onClickMenuForward.bind(e)),e.toolbar.btnImgForward.on("click",e.onClickMenuForward.bind(e,"forward")),e.toolbar.btnImgBackward.on("click",e.onClickMenuForward.bind(e,"backward")),e.toolbar.btnsPageBreak.forEach(function(t){t.menu.items[2].menu.on("item:click",function(t,i,n){e.toolbar.fireEvent("insert:break",[i.value])}),t.menu.on("item:click",function(t,i,n){"section"!=i.value&&e.toolbar.fireEvent("insert:break",[i.value])}),t.on("click",function(t){e.toolbar.fireEvent("insert:break",["page"])})})},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onImgWrapStyleChanged",this.onApiWrappingStyleChanged.bind(this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",this.onApiCoAuthoringDisconnect.bind(this)),this.api.asc_registerCallback("asc_onFocusObject",this.onApiFocusObject.bind(this)),this},onApiWrappingStyleChanged:function(t){var e=this.toolbar.btnImgWrapping.menu;switch(t){case Asc.c_oAscWrapStyle2.Inline:e.items[0].setChecked(!0);break;case Asc.c_oAscWrapStyle2.Square:e.items[1].setChecked(!0);break;case Asc.c_oAscWrapStyle2.Tight:e.items[2].setChecked(!0);break;case Asc.c_oAscWrapStyle2.Through:e.items[3].setChecked(!0);break;case Asc.c_oAscWrapStyle2.TopAndBottom:e.items[4].setChecked(!0);break;case Asc.c_oAscWrapStyle2.Behind:e.items[6].setChecked(!0);break;case Asc.c_oAscWrapStyle2.InFront:e.items[5].setChecked(!0);break;default:for(var i in e.items)e.items[i].setChecked(!1)}},onApiFocusObject:function(e){if(this.editMode){var i=this,n=[];for(var o in e)if(e[o].get_ObjectType()===Asc.c_oAscTypeSelectElement.Image){var s=e[o].get_ObjectValue(),a=s.get_Locked(),r=!s.get_CanBeFlow(),l=s.get_WrappingStyle();i.onApiWrappingStyleChanged(r?-1:l),_.each(i.toolbar.btnImgWrapping.menu.items,function(t){t.setDisabled(r)}),i.toolbar.btnImgWrapping.menu.items[8].setDisabled(!i.api.CanChangeWrapPolygon());var c=i.api.asc_IsContentControl()?this.api.asc_GetContentControlProperties():null,d=c?c.get_Lock():Asc.c_oAscSdtLockType.Unlocked,h=d==Asc.c_oAscSdtLockType.SdtContentLocked||d==Asc.c_oAscSdtLockType.ContentLocked;if(n.align=a||l==Asc.c_oAscWrapStyle2.Inline||h,n.group=a||l==Asc.c_oAscWrapStyle2.Inline||h,n.arrange=l==Asc.c_oAscWrapStyle2.Inline&&!s.get_FromGroup()||h,n.wrapping=a||s.get_FromGroup()||r&&!i.api.CanChangeWrapPolygon()||h||!!c&&c.get_SpecificType()==Asc.c_oAscContentControlSpecificType.Picture,!n.group)if(i.api.CanGroup()||i.api.CanUnGroup()){var p=i.toolbar.btnImgGroup.menu.items[0],m=i.toolbar.btnImgGroup.menu.items[1];p.setDisabled(!i.api.CanGroup()),m.setDisabled(!i.api.CanUnGroup())}else n.group=!0;t=s;break}i.toolbar.btnImgAlign.setDisabled(!1!==n.align),i.toolbar.btnImgGroup.setDisabled(!1!==n.group),i.toolbar.btnImgForward.setDisabled(!1!==n.arrange),i.toolbar.btnImgBackward.setDisabled(!1!==n.arrange),i.toolbar.btnImgWrapping.setDisabled(!1!==n.wrapping)}},onApiCoAuthoringDisconnect:function(){var t=this;t.editMode=!1,t.toolbar.btnImgAlign.setDisabled(!0),t.toolbar.btnImgGroup.setDisabled(!0),t.toolbar.btnImgForward.setDisabled(!0),t.toolbar.btnImgBackward.setDisabled(!0),t.toolbar.btnImgWrapping.setDisabled(!0)},onBeforeShapeAlign:function(){var t=this.api.asc_getSelectedDrawingObjectsCount(),e=Common.Utils.InternalSettings.get("de-img-align-to");this.toolbar.mniAlignObjects.setDisabled(t<2),this.toolbar.mniAlignObjects.setChecked(t>1&&(!e||3==e),!0),this.toolbar.mniAlignToMargin.setChecked(t<2&&!e||2==e,!0),this.toolbar.mniAlignToPage.setChecked(1==e,!0),this.toolbar.mniDistribHor.setDisabled(t<3&&this.toolbar.mniAlignObjects.isChecked()),this.toolbar.mniDistribVert.setDisabled(t<3&&this.toolbar.mniAlignObjects.isChecked())},onClickMenuAlign:function(t,e,i){var n=this.toolbar.mniAlignToPage.isChecked()?Asc.c_oAscObjectsAlignType.Page:this.toolbar.mniAlignToMargin.isChecked()?Asc.c_oAscObjectsAlignType.Margin:Asc.c_oAscObjectsAlignType.Selected;e.value>-1&&e.value<6?(this.api.put_ShapesAlign(e.value,n),Common.component.Analytics.trackEvent("ToolBar","Shape Align")):6==e.value?(this.api.DistributeHorizontally(n),Common.component.Analytics.trackEvent("ToolBar","Distribute")):7==e.value&&(this.api.DistributeVertically(n),Common.component.Analytics.trackEvent("ToolBar","Distribute")),this.toolbar.fireEvent("editcomplete",this.toolbar)},onClickMenuWrapping:function(e,i,n){if("edit"==i.options.wrapType)return this.api.StartChangeWrapPolygon(),void this.toolbar.fireEvent("editcomplete",this.toolbar);var o=new Asc.asc_CImgProperty;if(o.put_WrappingStyle(i.options.wrapType),t.get_WrappingStyle()===Asc.c_oAscWrapStyle2.Inline&&i.options.wrapType!==Asc.c_oAscWrapStyle2.Inline){o.put_PositionH(new Asc.CImagePositionH),o.get_PositionH().put_UseAlign(!1),o.get_PositionH().put_RelativeFrom(Asc.c_oAscRelativeFromH.Column);var s=t.get_Value_X(Asc.c_oAscRelativeFromH.Column);o.get_PositionH().put_Value(s),o.put_PositionV(new Asc.CImagePositionV),o.get_PositionV().put_UseAlign(!1),o.get_PositionV().put_RelativeFrom(Asc.c_oAscRelativeFromV.Paragraph),s=t.get_Value_Y(Asc.c_oAscRelativeFromV.Paragraph),o.get_PositionV().put_Value(s)}this.api.ImgApply(o),this.toolbar.fireEvent("editcomplete",this.toolbar)},onClickMenuGroup:function(t,e,i){var n=new Asc.asc_CImgProperty;n.put_Group(e.options.groupval),this.api.ImgApply(n),this.toolbar.fireEvent("editcomplete",this.toolbar)},onClickMenuForward:function(t,e,i){var n=new Asc.asc_CImgProperty;"forward"==t?n.put_ChangeLevel(Asc.c_oAscChangeLevel.BringForward):"backward"==t?n.put_ChangeLevel(Asc.c_oAscChangeLevel.BringBackward):n.put_ChangeLevel(e.options.valign),this.api.ImgApply(n),this.toolbar.fireEvent("editcomplete",this.toolbar)}}}())}),define("documenteditor/main/app/view/CustomColumnsDialog",["common/main/lib/component/Window","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox"],function(){"use strict";DE.Views.CustomColumnsDialog=Common.UI.Window.extend(_.extend({options:{width:300,header:!0,style:"min-width: 216px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box" style="height: 90px;">','<div class="input-row" style="margin: 10px 0;">','<label class="input-label">'+this.textColumns+'</label><div id="custom-columns-spin-num" style="float: right;"></div>',"</div>",'<div class="input-row" style="margin: 10px 0;">','<label class="input-label">'+this.textSpacing+'</label><div id="custom-columns-spin-spacing" style="float: right;"></div>',"</div>",'<div class="input-row" style="margin: 10px 0;">','<div id="custom-columns-separator"></div>',"</div>","</div>",'<div class="separator horizontal"></div>'].join(""),this.options.tpl=_.template(this.template)(this.options),this.spinners=[],this.totalWidth=558.7,this._noApply=!1,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this;this.spnColumns=new Common.UI.MetricSpinner({el:$("#custom-columns-spin-num"),step:1,allowDecimal:!1,width:100,defaultUnit:"",value:"1",maxValue:12,minValue:1}),this.spnColumns.on("change",function(e,i,n,o){var s=Common.Utils.Metric.fnRecalcToMM(t.spnSpacing.getNumberValue()),a=t.spnColumns.getNumberValue();t.chSeparator.setDisabled(a<2),t.spnSpacing.setDisabled(a<2),a<2&&(a=2);var r=parseFloat(((t.totalWidth-12.7*a)/(a-1)).toFixed(1));t.spnSpacing.setMaxValue(Common.Utils.Metric.fnRecalcFromMM(r)),s>r&&t.spnSpacing.setValue(Common.Utils.Metric.fnRecalcFromMM(r),!0)}),this.spnSpacing=new Common.UI.MetricSpinner({el:$("#custom-columns-spin-spacing"),step:.1,width:100,defaultUnit:"cm",value:"0 cm",maxValue:40.64,minValue:0}),this.spinners.push(this.spnSpacing),this.chSeparator=new Common.UI.CheckBox({el:$("#custom-columns-separator"),labelText:this.textSeparator}),this.getChild().find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.updateMetricUnit()},getFocusedComponents:function(){return[this.spnColumns,this.spnSpacing,this.chSeparator]},getDefaultFocusableComponent:function(){return this.spnColumns},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,this,t),this.close()},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(){return this._handleInput("ok"),!1},setSettings:function(t){if(t){var e=t.get_EqualWidth(),i=e?t.get_Num():t.get_ColsCount(),n=e?t.get_Space():i>1?t.get_Col(0).get_Space():12.5;this.chSeparator.setValue(t.get_Sep());var o=t.get_TotalWidth(),s=parseInt((o+.1)/(12.7+.1));this.spnColumns.setMaxValue(s),this.spnColumns.setValue(i,!0),this.chSeparator.setDisabled(i<2),this.spnSpacing.setDisabled(i<2),i<2&&(i=2),i>s&&(i=s);var a=parseFloat(((o-12.7*i)/(i-1)).toFixed(1));this.spnSpacing.setMaxValue(Common.Utils.Metric.fnRecalcFromMM(a)),this.spnSpacing.setValue(Common.Utils.Metric.fnRecalcFromMM(n),!0),this.totalWidth=o}},getSettings:function(){var t=new Asc.CDocumentColumnsProps;return t.put_EqualWidth(!0),t.put_Num(this.spnColumns.getNumberValue()),t.put_Space(Common.Utils.Metric.fnRecalcToMM(this.spnSpacing.getNumberValue())),t.put_Sep("checked"==this.chSeparator.getValue()),t},updateMetricUnit:function(){if(this.spinners)for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}},textTitle:"Columns",textSpacing:"Spacing between columns",textColumns:"Number of columns",textSeparator:"Column divider"},DE.Views.CustomColumnsDialog||{}))}),define("text!documenteditor/main/app/template/WatermarkSettings.template",[],function(){return'<table cols="1">\n    <tr><td class="padding-small">\n        <div id="watermark-radio-none"></div>\n    </td></tr>\n    <tr><td class="padding-small">\n        <div id="watermark-radio-text"></div>\n    </td></tr>\n    <tr><td class="padding-large">\n        <table id="watermark-tbl-text" cols="2" style="margin-left: 22px;">\n            <tr>\n                <td class="padding-small" style="width: 142px;">\n                    <label  style="display:block;" class="input-label"><%= scope.textLanguage %></label>\n                    <div id="watermark-combo-lang" style="width: 100%;"></div>\n                </td>\n                <td class="padding-small" style="width: 215px; padding-left: 5px;">\n                    <label  style="display:block;" class="input-label"><%= scope.textText %></label>\n                    <div id="watermark-combo-text" style="width: 100%;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-large" colspan="2">\n                    <label  style="display:block;" class="input-label"><%= scope.textFont %></label>\n                    <div id="watermark-fonts" class="input-row" style="display: inline-block; vertical-align: middle;"></div>\n                    <div id="watermark-font-size" class="input-row" style="display: inline-block; vertical-align: middle; margin-left: 2px;"></div>\n                    <div id="watermark-textcolor" style="display: inline-block;margin-left: 6px;"></div>\n                    <div id="watermark-bold" style="display: inline-block;margin-left: 2px;"></div><div id="watermark-italic" style="display: inline-block;margin-left: 6px;"></div>\n                    <div id="watermark-underline" style="display: inline-block;margin-left: 6px;"></div><div id="watermark-strikeout" style="display: inline-block;margin-left: 6px;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small" colspan="2">\n                    <div id="watermark-chb-transparency"></div>\n                </td>\n            </tr>\n            <tr>\n                <td colspan="2">\n                    <label style="display:block;margin-bottom: 3px;"><%= scope.textLayout %></label>\n                    <div id="watermark-radio-diag" style="display: inline-block;"></div>\n                    <div id="watermark-radio-hor" style="display: inline-block;margin-left: 15px;"></div>\n                </td>\n            </tr>\n        </table>\n    </td></tr>\n    <tr><td class="padding-small">\n        <div id="watermark-radio-image"></div>\n    </td></tr>\n    <tr><td class="padding-small">\n        <table id="watermark-tbl-image" cols="2" style="margin-left: 22px;">\n            <tr>\n                <td style="vertical-align: top;">\n                    <div id="watermark-select-image"></div>\n                </td>\n                <td rowspan="2">\n                    <div style="width: 80px; height: 70px; padding: 9px 14px; border: 1px solid #AFAFAF; border-radius: 2px; background: #ffffff;margin-left: 15px;">\n                        <div id="watermark-texture-img" style="width: 50px;height: 50px;"></div>\n                    </div>\n                </td>\n            </tr>\n            <tr>\n                <td style="vertical-align: bottom;">\n                    <label class="input-label" style=""><%= scope.textScale %></label>\n                    <div id="watermark-combo-scale" style="width: 142px;"></div>\n                </td>\n            </tr>\n            </table>\n    </td></tr>\n</table>\n'}),define("documenteditor/main/app/view/WatermarkSettingsDialog",["text!documenteditor/main/app/template/WatermarkSettings.template","common/main/lib/util/utils","common/main/lib/component/RadioBox","common/main/lib/component/InputField","common/main/lib/view/AdvancedSettingsWindow"],function(t){"use strict";DE.Views.WatermarkText=new function(){var t;return{get:function(){return t},load:function(e){t=[],Common.Utils.loadConfig("resources/watermark/wm-text.json",function(i){for(var n in i){var o=Common.util.LanguageInfo.getLocalLanguageCode(n);o&&t.push({code:o,name:Common.util.LanguageInfo.getLocalLanguageName(o)[1],shortname:Common.util.LanguageInfo.getLocalLanguageName(o)[0],text:i[n]})}t.sort(function(t,e){return t.shortname<e.shortname?-1:t.shortname>e.shortname?1:0}),e&&e(t)})}}},DE.Views.WatermarkSettingsDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:400,height:442},initialize:function(e){var i=this;_.extend(this.options,{title:this.textTitle,template:_.template(['<div class="box" style="height:'+(i.options.height-85)+'px;">','<div class="content-panel" style="padding: 10px 5px;"><div class="inner-content">','<div class="settings-panel active">',t,"</div></div>","</div>","</div>"].join(""))({scope:this})},e),this.handler=e.handler,this.props=e.props,this.fontStore=e.fontStore,this.api=e.api,this.storage=!!e.storage,this.textControls=[],this.imageControls=[],this.fontName="Arial",this.text="",this.isAutoColor=!1,this.isImageLoaded=!1;var n=e.lang||"en",o=Common.util.LanguageInfo.getLocalLanguageCode(n);this.lang=o?{value:n,displayValue:Common.util.LanguageInfo.getLocalLanguageName(o)[1],default:!0}:{value:"en",displayValue:"English",default:!0},Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.radioNone=new Common.UI.RadioBox({el:$("#watermark-radio-none"),name:"asc-radio-watermark-type",labelText:this.textNone,checked:!1}),this.radioNone.on("change",_.bind(function(t,e,i){e&&(this.props.put_Type(Asc.c_oAscWatermarkType.None),this.disableControls(Asc.c_oAscWatermarkType.None))},this)),this.radioImage=new Common.UI.RadioBox({el:$("#watermark-radio-image"),name:"asc-radio-watermark-type",labelText:this.textImageW,checked:!1}),this.radioImage.on("change",_.bind(function(t,e,i){e&&(this.props.put_Type(Asc.c_oAscWatermarkType.Image),this.disableControls(Asc.c_oAscWatermarkType.Image),this.focusControls())},this)),this.radioText=new Common.UI.RadioBox({el:$("#watermark-radio-text"),name:"asc-radio-watermark-type",labelText:this.textTextW,checked:!0}),this.radioText.on("change",_.bind(function(t,e,i){e&&(this.props.put_Type(Asc.c_oAscWatermarkType.Text),this.disableControls(Asc.c_oAscWatermarkType.Text),this.focusControls())},this)),this.btnSelectImage=new Common.UI.Button({parentEl:$("#watermark-select-image"),cls:"btn-text-menu-default",caption:this.textSelect,style:"width: 142px;",menu:new Common.UI.Menu({style:"min-width: 142px;",maxHeight:200,additionalAlign:this.menuAddAlign,items:[{caption:this.textFromFile,value:0},{cls:"cp-from-url",caption:this.textFromUrl,value:1},{caption:this.textFromStorage,value:2}]})}),this.imageControls.push(this.btnSelectImage),this.btnSelectImage.menu.on("item:click",_.bind(this.onImageSelect,this)),this.btnSelectImage.menu.items[2].setVisible(this.storage),this._arrScale=[{displayValue:this.textAuto,value:-1},{displayValue:"500%",value:500},{displayValue:"200%",value:200},{displayValue:"150%",value:150},{displayValue:"100%",value:100},{displayValue:"50%",value:50}],this.cmbScale=new Common.UI.ComboBox({el:$("#watermark-combo-scale"),cls:"input-group-nr",menuStyle:"min-width: 142px;",data:this._arrScale,takeFocusOnClose:!0}).on("selected",_.bind(function(t,e){},this)),this.cmbScale.setValue(this._arrScale[0].value),this.imageControls.push(this.cmbScale),this.cmbLang=new Common.UI.ComboBox({el:$("#watermark-combo-lang"),cls:"input-group-nr",editable:!1,menuStyle:"min-width: 100%;max-height: 210px;",scrollAlwaysVisible:!0,data:[],takeFocusOnClose:!0}).on("selected",_.bind(this.onSelectLang,this)),this.cmbLang.setValue(Common.util.LanguageInfo.getLocalLanguageName(9)[1]),this.textControls.push(this.cmbLang),this.cmbText=new Common.UI.ComboBox({el:$("#watermark-combo-text"),cls:"input-group-nr",menuStyle:"min-width: 100%;max-height: 210px;",scrollAlwaysVisible:!0,displayField:"value",data:[{value:"ASAP"},{value:"CONFIDENTIAL"},{value:"COPY"},{value:"DO NOT COPY"},{value:"DRAFT"},{value:"ORIGINAL"},{value:"PERSONAL"},{value:"SAMPLE"},{value:"TOP SECRET"},{value:"URGENT"}],takeFocusOnClose:!0}).on("selected",_.bind(function(t,e){},this)),this.cmbText.setValue(this.cmbText.options.data[0].value),this.textControls.push(this.cmbText),this.cmbFonts=new Common.UI.ComboBoxFonts({el:$("#watermark-fonts"),cls:"input-group-nr",style:"width: 142px;",menuCls:"scrollable-menu",menuStyle:"min-width: 100%;max-height: 270px;",store:new Common.Collections.Fonts,recent:0,hint:this.tipFontName,takeFocusOnClose:!0}).on("selected",_.bind(function(t,e){this.fontName=e.name},this)),this.textControls.push(this.cmbFonts);var e=[{value:-1,displayValue:this.textAuto},{value:36,displayValue:"36"},{value:40,displayValue:"40"},{value:44,displayValue:"44"},{value:48,displayValue:"48"},{value:54,displayValue:"54"},{value:60,displayValue:"60"},{value:66,displayValue:"66"},{value:72,displayValue:"72"},{value:80,displayValue:"80"},{value:90,displayValue:"90"},{value:96,displayValue:"96"},{value:105,displayValue:"105"},{value:120,displayValue:"120"},{value:144,displayValue:"144"}];this.cmbFontSize=new Common.UI.ComboBox({el:$("#watermark-font-size"),cls:"input-group-nr",style:"width: 55px;",menuCls:"scrollable-menu",menuStyle:"min-width: 55px;max-height: 270px;",hint:this.tipFontSize,data:e,takeFocusOnClose:!0}),this.cmbFontSize.setValue(-1),this.textControls.push(this.cmbFontSize),this.btnBold=new Common.UI.Button({parentEl:$("#watermark-bold"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-bold",enableToggle:!0,hint:this.textBold}),this.textControls.push(this.btnBold),this.btnItalic=new Common.UI.Button({parentEl:$("#watermark-italic"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-italic",enableToggle:!0,hint:this.textItalic}),this.textControls.push(this.btnItalic),this.btnUnderline=new Common.UI.Button({parentEl:$("#watermark-underline"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-underline",enableToggle:!0,hint:this.textUnderline}),this.textControls.push(this.btnUnderline),this.btnStrikeout=new Common.UI.Button({parentEl:$("#watermark-strikeout"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-strikeout",enableToggle:!0,hint:this.textStrikeout}),this.textControls.push(this.btnStrikeout);this.btnTextColor=new Common.UI.ButtonColored({parentEl:$("#watermark-textcolor"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-fontcolor",hint:this.textColor,menu:new Common.UI.Menu({cls:"shifted-left",additionalAlign:this.menuAddAlign,items:[{id:"watermark-auto-color",caption:this.textAuto,
template:_.template('<a tabindex="-1" type="menuitem"><span class="menu-item-icon color-auto" style="background-image: none; width: 12px; height: 12px; margin: 1px 7px 0 1px; background-color: #000;"></span><%= caption %></a>')},{caption:"--"},{template:_.template('<div id="watermark-menu-textcolor" style="width: 169px; height: 216px; margin: 10px;"></div>')},{template:_.template('<a id="watermark-menu-textcolor-new">'+this.textNewColor+"</a>")}]})}),this.mnuTextColorPicker=function(e,i){if(e&&e.cmpEl){e.currentColor="c0c0c0",e.setColor(e.currentColor);var n=new Common.UI.ThemeColorPalette({el:$(i)})}return e.menu.cmpEl.on("click",i+"-new",_.bind(function(){n.addNewColor("object"==typeof e.color?e.color.color:e.color)},t)),n.on("select",_.bind(t.onColorSelect,t)),n}(this.btnTextColor,"#watermark-menu-textcolor"),$("#watermark-auto-color").on("click",_.bind(this.onAutoColor,this)),this.textControls.push(this.btnTextColor),this.chTransparency=new Common.UI.CheckBox({el:$("#watermark-chb-transparency"),labelText:this.textTransparency,value:!0}),this.textControls.push(this.chTransparency),this.radioDiag=new Common.UI.RadioBox({el:$("#watermark-radio-diag"),name:"asc-radio-watermark-layout",labelText:this.textDiagonal,checked:!0}),this.textControls.push(this.radioDiag),this.radioHor=new Common.UI.RadioBox({el:$("#watermark-radio-hor"),name:"asc-radio-watermark-layout",labelText:this.textHor}),this.textControls.push(this.radioHor),this.btnOk=new Common.UI.Button({el:this.$window.find(".primary"),disabled:!0}),this.afterRender()},getFocusedComponents:function(){return[this.radioNone,this.radioText,this.cmbLang,this.cmbText,this.cmbFonts,this.chTransparency,this.radioDiag,this.radioHor,this.radioImage,this.cmbFontSize,this.cmbScale]},getDefaultFocusableComponent:function(){return this.cmbLang.isDisabled()?this.cmbScale.isDisabled()?this.radioNone:this.cmbScale:this.cmbLang},focusControls:function(){var t=this.getDefaultFocusableComponent();t&&setTimeout(function(){t.focus()},10)},onColorSelect:function(t,e){var i=this.btnTextColor.menu.$el.find("#watermark-auto-color > a");i.hasClass("selected")&&i.removeClass("selected"),this.isAutoColor=!1,this.btnTextColor.currentColor=e,this.btnTextColor.setColor(this.btnTextColor.currentColor)},updateThemeColors:function(){this.mnuTextColorPicker.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors())},addNewColor:function(t,e){t.addNewColor("object"==typeof e.color?e.color.color:e.color)},onAutoColor:function(t){var e=this.btnTextColor.menu.$el.find("#watermark-auto-color > a");!e.hasClass("selected")&&e.addClass("selected"),this.isAutoColor=!0,this.btnTextColor.currentColor="000",this.btnTextColor.setColor(this.btnTextColor.currentColor),this.mnuTextColorPicker.clearSelection()},afterRender:function(){this.cmbFonts.fillFonts(this.fontStore),this.cmbFonts.selectRecord(this.fontStore.findWhere({name:this.fontName})),this.updateThemeColors(),this._setDefaults(this.props);var t=this,e=function(){t.isImageLoaded=!0,t.btnOk.setDisabled(!1)};this.api.asc_registerCallback("asc_onWatermarkImageLoaded",e);var i=function(e){e&&e.url&&"watermark"==e.c&&t.props.put_ImageUrl(e.url,e.token)};Common.NotificationCenter.on("storage:image-insert",i),this.on("close",function(n){t.api.asc_unregisterCallback("asc_onWatermarkImageLoaded",e),Common.NotificationCenter.off("storage:image-insert",i)})},loadLanguages:function(){var t=this,e=!1,i=function(i){var n=[];if(t.languages=i,t.languages&&t.languages.forEach(function(t){n.push({displayValue:t.name,value:t.shortname,wmtext:t.text})}),n.length){t.cmbLang.setData(n);var o=t.loadWMText(t.lang.value);o&&t.lang.default?t.cmbLang.setValue(o):t.cmbLang.setValue(t.lang.displayValue),t.cmbLang.setDisabled(!t.radioText.getValue()),t.text&&t.cmbText.setValue(t.text)}else t.cmbLang.setDisabled(!0);e&&t.focusControls()},n=DE.Views.WatermarkText.get();e=!n,n?i(n):DE.Views.WatermarkText.load(i)},onSelectLang:function(t,e){if(e){var i=[];e.wmtext.forEach(function(t){i.push({value:t})}),this.lang=e,i.length>0&&(this.cmbText.setData(i),this.cmbText.setValue(i[0].value))}},loadWMText:function(t){if(t){var e=[],i=this.cmbLang.store.findWhere({value:t});return i||(i=this.cmbLang.store.findWhere({value:t.split(/[\-\_]/)[0]})),i||(i=this.cmbLang.store.findWhere({value:"en"})),i||(i=this.cmbLang.store.at(0)),i&&i.get("wmtext").forEach(function(t){e.push({value:t})}),e.length>0&&(this.cmbText.setData(e),this.cmbText.setValue(e[0].value)),i?i.get("displayValue"):null}},onImageSelect:function(t,e){if(1==e.value){var i=this;new Common.Views.ImageFromUrlDialog({handler:function(t,e){if("ok"==t){var n=e.replace(/ /g,"");_.isEmpty(n)||i.props.put_ImageUrl(n)}}}).show()}else 2==e.value?Common.NotificationCenter.trigger("storage:image-load","watermark"):this.props.showFileDialog()},_setDefaults:function(t){if(this.loadLanguages(),t){t.put_DivId("watermark-texture-img"),t.put_Api(this.api);var e,i=t.get_Type();if(i==Asc.c_oAscWatermarkType.None)this.radioNone.setValue(!0,!0);else if(i==Asc.c_oAscWatermarkType.Image)this.radioImage.setValue(!0,!0),this.isImageLoaded=!!t.get_ImageUrl(),e=t.get_Scale()||-1,this.cmbScale.setValue(e<0?-1:Math.round(100*e),Math.round(100*e)+" %");else{if(this.radioText.setValue(!0,!0),!t.get_IsDiagonal()&&this.radioHor.setValue(!0),this.chTransparency.setValue(t.get_Opacity()<255),e=t.get_TextPr()){var n=Common.util.LanguageInfo.getLocalLanguageName(e.get_Lang());this.lang={value:n[0],displayValue:n[1]},this.cmbLang.setValue(n[1]),this.loadWMText(n[0]);var o=e.get_FontFamily().get_Name();if(o){var s=this.cmbFonts.store.findWhere({name:o});this.fontName=s?s.get("name"):o,this.cmbFonts.setValue(this.fontName)}this.cmbFontSize.setValue(e.get_FontSize()),this.btnBold.toggle(e.get_Bold()),this.btnItalic.toggle(e.get_Italic()),this.btnUnderline.toggle(e.get_Underline()),this.btnStrikeout.toggle(e.get_Strikeout());var a=e.get_Color(),r=this.btnTextColor.menu.$el.find("#watermark-auto-color > a"),l="c0c0c0";if(a.get_auto())l="000",this.isAutoColor=!0,this.mnuTextColorPicker.clearSelection(),!r.hasClass("selected")&&r.addClass("selected");else if(r.hasClass("selected")&&r.removeClass("selected"),a&&(l=a.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(a.get_r(),a.get_g(),a.get_b()),effectValue:a.get_value()}:Common.Utils.ThemeColor.getHexColor(a.get_r(),a.get_g(),a.get_b())),"object"==typeof l){for(var c=!1,d=0;d<10;d++)if(Common.Utils.ThemeColor.ThemeValues[d]==l.effectValue){this.mnuTextColorPicker.select(l,!0),c=!0;break}c||this.mnuTextColorPicker.clearSelection()}else this.mnuTextColorPicker.select(l,!0);this.btnTextColor.currentColor=l,this.btnTextColor.setColor(this.btnTextColor.currentColor)}e=t.get_Text(),e&&this.cmbText.setValue(e),this.text=e||""}this.disableControls(i)}},getSettings:function(){var t=this.props,e=this.props.get_Type();if(e==Asc.c_oAscWatermarkType.Image)e=parseInt(this.cmbScale.getValue()),isNaN(e)&&(e=-1),t.put_Scale(e<0?e:e/100);else if(t.put_Text(this.cmbText.getValue()),t.put_IsDiagonal(this.radioDiag.getValue()),t.put_Opacity("checked"==this.chTransparency.getValue()?128:255),e=t.get_TextPr()||new Asc.CTextProp){e.put_FontSize(Math.min(this.cmbFontSize.getValue(),1638));var i=new AscCommon.asc_CTextFontFamily;i.put_Name(this.fontName),i.put_Index(-1),e.put_FontFamily(i),e.put_Bold(this.btnBold.pressed),e.put_Italic(this.btnItalic.pressed),e.put_Underline(this.btnUnderline.pressed),e.put_Strikeout(this.btnStrikeout.pressed),e.put_Lang(parseInt(Common.util.LanguageInfo.getLocalLanguageCode(this.lang.value)));var n=new Asc.asc_CColor;this.isAutoColor?n.put_auto(!0):n=Common.Utils.ThemeColor.getRgbColor(this.btnTextColor.currentColor),e.put_Color(n),t.put_TextPr(e)}return this.props},disableControls:function(t){var e=t!=Asc.c_oAscWatermarkType.Image;_.each(this.imageControls,function(t){t.setDisabled(e)}),e=t!=Asc.c_oAscWatermarkType.Text,_.each(this.textControls,function(t){t.setDisabled(e)}),this.cmbLang.setDisabled(e||!this.languages||this.languages.length<1),this.btnOk.setDisabled(t==Asc.c_oAscWatermarkType.Image&&!this.isImageLoaded)},onDlgBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(){return this._handleInput("ok"),!1},_handleInput:function(t){if(this.handler){if("ok"==t&&this.btnOk.isDisabled())return;this.handler.call(this,t,this.getSettings())}this.close()},textTitle:"Watermark Settings",textNone:"None",textImageW:"Image watermark",textTextW:"Text watermark",textFromUrl:"From URL",textFromFile:"From File",textScale:"Scale",textAuto:"Auto",textText:"Text",textFont:"Font",tipFontName:"Font Name",tipFontSize:"Font Size",textBold:"Bold",textItalic:"Italic",textUnderline:"Underline",textStrikeout:"Strikeout",textTransparency:"Semitransparent",textLayout:"Layout",textDiagonal:"Diagonal",textHor:"Horizontal",textColor:"Text color",textNewColor:"Add New Custom Color",textLanguage:"Language",textFromStorage:"From Storage",textSelect:"Select Image"},DE.Views.WatermarkSettingsDialog||{}))}),void 0===Common)var Common={};if(define("documenteditor/main/app/view/ListSettingsDialog",["common/main/lib/component/Window","common/main/lib/component/MetricSpinner","common/main/lib/component/ThemeColorPalette","common/main/lib/component/ColorButton","common/main/lib/component/ComboBox","common/main/lib/view/SymbolTableDialog"],function(){"use strict";DE.Views.ListSettingsDialog=Common.UI.Window.extend(_.extend({options:{type:0,width:300,height:422,style:"min-width: 240px;",cls:"modal-dlg",split:!1,buttons:["ok","cancel"]},initialize:function(t){this.type=t.type||0,_.extend(this.options,{title:this.txtTitle,height:2==this.type?376:422,width:2==this.type?430:300},t||{}),this.template=['<div class="box">',"<% if (type == 2) { %>",'<table cols="4" style="width: 100%;">',"<tr>",'<td style="padding-right: 5px;">','<label class="input-label">'+this.txtType+"</label>",'<div id="id-dlg-numbering-format" class="input-group-nr" style="width: 100%;margin-bottom: 10px;"></div>',"</td>",'<td style="padding-left: 5px;padding-right: 5px;">','<label class="input-label">'+this.txtAlign+"</label>",'<div id="id-dlg-bullet-align" class="input-group-nr" style="width: 100%;margin-bottom: 10px;"></div>',"</td>",'<td style="padding-left: 5px;padding-right: 5px;">','<label class="input-label">'+this.txtSize+"</label>",'<div id="id-dlg-bullet-size" class="input-group-nr" style="width: 100%;margin-bottom: 10px;"></div>',"</td>",'<td style="padding-left: 5px;">','<label class="input-label">'+this.txtColor+"</label>",'<div id="id-dlg-bullet-color" style="margin-bottom: 10px;"></div>',"</td>","</tr>","</table>","<% } else {%>",'<table cols="2" style="width: 100%;">',"<tr>",'<td style="padding-right: 5px;">',"<% if (type == 0) { %>",'<label class="input-label">'+this.txtBullet+"</label>",'<button type="button" class="btn btn-text-default" id="id-dlg-bullet-font" style="width: 100%;margin-bottom: 10px;">'+this.txtFont+"</button>","<% } else { %>",'<label class="input-label">'+this.txtType+"</label>",'<div id="id-dlg-numbering-format" class="input-group-nr" style="width: 100%;margin-bottom: 10px;"></div>',"<% } %>","</td>",'<td style="padding-left: 5px;">','<label class="input-label">'+this.txtAlign+"</label>",'<div id="id-dlg-bullet-align" class="input-group-nr" style="width: 100%;margin-bottom: 10px;"></div>',"</td>","</tr>","<tr>",'<td style="padding-right: 5px;">','<label class="input-label">'+this.txtSize+"</label>",'<div id="id-dlg-bullet-size" class="input-group-nr" style="width: 100%;margin-bottom: 10px;"></div>',"</td>",'<td style="padding-left: 5px;">','<label class="input-label">'+this.txtColor+"</label>",'<div id="id-dlg-bullet-color" style="margin-bottom: 10px;"></div>',"</td>","</tr>","</table>","<% } %>",'<table cols="2" style="width: 100%;">',"<tr>",'<td class="<% if (type != 2) { %> hidden <% } %>" style="width: 50px; padding-right: 10px;">',"<label>"+this.textLevel+"</label>",'<div id="levels-list" class="no-borders" style="width:100%; height:208px;margin-top: 2px; "></div>',"</td>","<td>","<label>"+this.textPreview+"</label>",'<div id="bulleted-list-preview"></div>',"</td>","</tr>","</table>","</div>"].join(""),this.props=t.props,this.level=t.level||0,this.api=t.api,this.options.tpl=_.template(this.template)(this.options),this.levels=[],Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this,e=this.getChild();e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.btnColor=new Common.UI.ColorButton({parentEl:e.find("#id-dlg-bullet-color"),additionalItems:[{id:"id-dlg-bullet-text-color",caption:this.txtLikeText,checkable:!0,toggleGroup:"list-settings-color",style:"padding-left: 20px;"},{id:"id-dlg-bullet-auto-color",caption:this.textAuto,checkable:!0,toggleGroup:"list-settings-color",style:"padding-left: 20px;"},{caption:"--"}],additionalAlign:this.menuAddAlign}),this.btnColor.on("color:select",_.bind(this.onColorsSelect,this)),this.btnColor.menu.items[0].on("toggle",_.bind(this.onLikeTextColor,this)),this.btnColor.menu.items[1].on("toggle",_.bind(this.onAutoColor,this)),this.colors=this.btnColor.getPicker(),this.btnEdit=new Common.UI.Button({el:e.find("#id-dlg-bullet-font")}),this.btnEdit.on("click",_.bind(this.onEditBullet,this));var i=["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem">','<%= item.displayValue %><% if (item.value === Asc.c_oAscNumberingFormat.Bullet) { %><span style="font-family:<%=item.font%>;"><%=item.symbol%></span><% } %>',"</a></li>","<% }); %>"],n=['<div class="input-group combobox input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<div class="form-control" style="padding-top:3px; line-height: 14px; cursor: pointer; <%= style %>"></div>','<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>','<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">'].concat(i).concat(["</ul>","</div>"]);this.cmbFormat=new Common.UI.ComboBoxCustom({el:e.find("#id-dlg-numbering-format"),menuStyle:"min-width: 100%;max-height: 183px;",style:2==this.type?"width: 107px;":"width: 129px;",editable:!1,template:_.template(n.join("")),itemsTemplate:_.template(i.join("")),takeFocusOnClose:!0,data:[{displayValue:this.txtNone,value:Asc.c_oAscNumberingFormat.None},{displayValue:"1, 2, 3,...",value:Asc.c_oAscNumberingFormat.Decimal},{displayValue:"a, b, c,...",value:Asc.c_oAscNumberingFormat.LowerLetter},{displayValue:"A, B, C,...",value:Asc.c_oAscNumberingFormat.UpperLetter},{displayValue:"i, ii, iii,...",value:Asc.c_oAscNumberingFormat.LowerRoman},{displayValue:"I, II, III,...",value:Asc.c_oAscNumberingFormat.UpperRoman}],updateFormControl:function(t){var e=$(this.el).find(".form-control");t?t.get("value")==Asc.c_oAscNumberingFormat.Bullet?e[0].innerHTML=t.get("displayValue")+'<span style="font-family:'+(t.get("font")||"Arial")+'">'+t.get("symbol")+"</span>":e[0].innerHTML=t.get("displayValue"):e[0].innerHTML=""}}),this.cmbFormat.on("selected",_.bind(function(e,i){if(this._changedProps)if(-1==i.value){var n=function(i){var n=t._changedProps.get_Format();if(n==Asc.c_oAscNumberingFormat.Bullet){var o=e.store;o.findWhere({value:Asc.c_oAscNumberingFormat.Bullet,symbol:t.bulletProps.symbol,font:t.bulletProps.font})||o.add({displayValue:t.txtSymbol+": ",value:Asc.c_oAscNumberingFormat.Bullet,symbol:t.bulletProps.symbol,font:t.bulletProps.font},{at:o.length-1}),e.setData(o.models),e.selectRecord(e.store.findWhere({value:Asc.c_oAscNumberingFormat.Bullet,symbol:t.bulletProps.symbol,font:t.bulletProps.font}))}else e.setValue(n||"")};this.addNewBullet(n)}else{var o=this._changedProps.get_Format();this._changedProps.put_Format(i.value),i.value==Asc.c_oAscNumberingFormat.Bullet?(this.bulletProps.font=i.font,this.bulletProps.symbol=i.symbol,this._changedProps.get_TextPr()||this._changedProps.put_TextPr(new AscCommonWord.CTextPr),this._changedProps.get_TextPr().put_FontFamily(this.bulletProps.font),this._changedProps.put_Text([new Asc.CAscNumberingLvlText]),this._changedProps.get_Text()[0].put_Value(this.bulletProps.symbol)):i.value!=Asc.c_oAscNumberingFormat.None&&o!=Asc.c_oAscNumberingFormat.Bullet||(this._changedProps.get_TextPr()||this._changedProps.put_TextPr(new AscCommonWord.CTextPr),this._changedProps.get_TextPr().put_FontFamily(void 0),this._changedProps.put_Text([new Asc.CAscNumberingLvlText]),this._changedProps.get_Text()[0].put_Type(Asc.c_oAscNumberingLvlTextType.Num),this._changedProps.get_Text()[0].put_Value(this.level))}this.api&&this.api.SetDrawImagePreviewBullet("bulleted-list-preview",this.props,this.level,2==this.type)},this)),this.cmbAlign=new Common.UI.ComboBox({el:e.find("#id-dlg-bullet-align"),menuStyle:"min-width: 100%;",editable:!1,cls:"input-group-nr",data:[{value:AscCommon.align_Left,displayValue:this.textLeft},{value:AscCommon.align_Center,displayValue:this.textCenter},{value:AscCommon.align_Right,displayValue:this.textRight}],takeFocusOnClose:!0}),this.cmbAlign.on("selected",_.bind(function(t,e){this._changedProps&&this._changedProps.put_Align(e.value),this.api&&this.api.SetDrawImagePreviewBullet("bulleted-list-preview",this.props,this.level,2==this.type)},this)),this.cmbSize=new Common.UI.ComboBox({el:e.find("#id-dlg-bullet-size"),menuStyle:"min-width: 100%;max-height: 183px;",editable:!1,cls:"input-group-nr",data:[{value:-1,displayValue:this.txtLikeText},{value:8,displayValue:"8"},{value:9,displayValue:"9"},{value:10,displayValue:"10"},{value:11,displayValue:"11"},{value:12,displayValue:"12"},{value:14,displayValue:"14"},{value:16,displayValue:"16"},{value:18,displayValue:"18"},{value:20,displayValue:"20"},{value:22,displayValue:"22"},{value:24,displayValue:"24"},{value:26,displayValue:"26"},{value:28,displayValue:"28"},{value:36,displayValue:"36"},{value:48,displayValue:"48"},{value:72,displayValue:"72"},{value:96,displayValue:"96"}],takeFocusOnClose:!0}),this.cmbSize.on("selected",_.bind(function(t,e){this._changedProps&&(this._changedProps.get_TextPr()||this._changedProps.put_TextPr(new AscCommonWord.CTextPr),this._changedProps.get_TextPr().put_FontSize(e.value>0?e.value:void 0)),this.api&&this.api.SetDrawImagePreviewBullet("bulleted-list-preview",this.props,this.level,2==this.type)},this));for(var o=[],s=0;s<9;s++)o.push({value:s});this.levelsList=new Common.UI.ListView({el:$("#levels-list",this.$window),store:new Common.UI.DataViewStore(o),tabindex:1,itemTemplate:_.template('<div id="<%= id %>" class="list-item" style="pointer-events:none;overflow: hidden; text-overflow: ellipsis;line-height: 15px;"><%= (value+1) %></div>')}),this.levelsList.on("item:select",_.bind(this.onSelectLevel,this)),this.on("animate:after",_.bind(this.onAnimateAfter,this)),this.afterRender()},getFocusedComponents:function(){return[this.btnEdit,this.cmbFormat,this.cmbAlign,this.cmbSize,this.levelsList]},getDefaultFocusableComponent:function(){return this.type>0?this.cmbFormat:this.cmbAlign},onAnimateAfter:function(){this.api&&this.api.SetDrawImagePreviewBullet("bulleted-list-preview",this.props,this.level,2==this.type)},afterRender:function(){this.updateThemeColors(),this._setDefaults(this.props);var t=this,e=function(e){t.levelsList.selectByIndex(e)};this.api.asc_registerCallback("asc_onPreviewLevelChange",e),this.on("close",function(i){t.api.asc_unregisterCallback("asc_onPreviewLevelChange",e)})},updateThemeColors:function(){this.colors.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors())},onAutoColor:function(t,e){if(e){var i=Common.Utils.ThemeColor.getHexColor(0,0,0);if(this.btnColor.setColor(i),this.colors.clearSelection(),this._changedProps){this._changedProps.get_TextPr()||this._changedProps.put_TextPr(new AscCommonWord.CTextPr);var i=new Asc.asc_CColor;i.put_auto(!0),this._changedProps.get_TextPr().put_Color(i)}this.api&&this.api.SetDrawImagePreviewBullet("bulleted-list-preview",this.props,this.level,2==this.type)}},onLikeTextColor:function(t,e){if(e){var i=Common.Utils.ThemeColor.getHexColor(0,0,0);this.btnColor.setColor(i),this.colors.clearSelection(),this._changedProps&&(this._changedProps.get_TextPr()||this._changedProps.put_TextPr(new AscCommonWord.CTextPr),this._changedProps.get_TextPr().put_Color(void 0)),this.api&&this.api.SetDrawImagePreviewBullet("bulleted-list-preview",this.props,this.level,2==this.type)}},onColorsSelect:function(t,e){this._changedProps&&(this._changedProps.get_TextPr()||this._changedProps.put_TextPr(new AscCommonWord.CTextPr),this._changedProps.get_TextPr().put_Color(Common.Utils.ThemeColor.getRgbColor(e))),this.btnColor.menu.items[0].setChecked(!1,!0),this.btnColor.menu.items[1].setChecked(!1,!0),this.api&&this.api.SetDrawImagePreviewBullet("bulleted-list-preview",this.props,this.level,2==this.type)},onEditBullet:function(t){this.addNewBullet()},addNewBullet:function(t){var e=this,i=e.bulletProps,n=function(n,o,s){"ok"==o&&(i.changed=!0,i.code=s.code,i.font=s.font,i.symbol=s.symbol,e._changedProps&&(e._changedProps.put_Format(Asc.c_oAscNumberingFormat.Bullet),e._changedProps.get_TextPr()||e._changedProps.put_TextPr(new AscCommonWord.CTextPr),e._changedProps.get_TextPr().put_FontFamily(i.font),e._changedProps.put_Text([new Asc.CAscNumberingLvlText]),e._changedProps.get_Text()[0].put_Value(i.symbol),e.api&&e.api.SetDrawImagePreviewBullet("bulleted-list-preview",e.props,e.level,2==e.type))),t&&t.call(e,o)},o=new Common.Views.SymbolTableDialog({api:e.options.api,lang:e.options.interfaceLang,modal:!0,type:0,font:i.font,symbol:i.symbol,handler:n});o.show(),o.on("symbol:dblclick",n)},_handleInput:function(t){if(this.options.handler){for(var e=[],i=[],n=0;n<9;n++)this.levels[n]&&(e.push(this.levels[n]),i.push(n));this.options.handler.call(this,t,{props:1==e.length?e[0]:e,num:1==i.length?i[0]:i})}this.close()},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(t){return this._handleInput("ok"),!1},_setDefaults:function(t){if(this.bulletProps={},t){var e=t.get_Lvl(this.level);if(this.level<0&&(this.level=0),this.levels[this.level]=e||new Asc.CAscNumberingLvl(this.level),2==this.type){var i=this.cmbFormat.store;i.push([{displayValue:this.txtSymbol+": ",value:Asc.c_oAscNumberingFormat.Bullet,symbol:"Â·",font:"Symbol"},{displayValue:this.txtSymbol+": ",value:Asc.c_oAscNumberingFormat.Bullet,symbol:"o",font:"Courier New"},{displayValue:this.txtSymbol+": ",value:Asc.c_oAscNumberingFormat.Bullet,symbol:"Â§",font:"Wingdings"},{displayValue:this.txtSymbol+": ",value:Asc.c_oAscNumberingFormat.Bullet,symbol:"v",font:"Wingdings"},{displayValue:this.txtSymbol+": ",value:Asc.c_oAscNumberingFormat.Bullet,symbol:"Ã",font:"Wingdings"},{displayValue:this.txtSymbol+": ",value:Asc.c_oAscNumberingFormat.Bullet,symbol:"Ã¼",font:"Wingdings"},{displayValue:this.txtSymbol+": ",value:Asc.c_oAscNumberingFormat.Bullet,symbol:"Â¨",font:"Symbol"},{displayValue:this.txtSymbol+": ",value:Asc.c_oAscNumberingFormat.Bullet,symbol:"â",font:"Arial"},{displayValue:this.txtNewBullet,value:-1}]),this.cmbFormat.setData(i.models),this.levelsList.selectByIndex(this.level)}else this.fillLevelProps(this.levels[this.level])}this._changedProps=this.levels[this.level]},onSelectLevel:function(t,e,i){this.level=i.get("value"),void 0===this.levels[this.level]&&(this.levels[this.level]=this.props.get_Lvl(this.level)),this.fillLevelProps(this.levels[this.level]),this._changedProps=this.levels[this.level]},fillLevelProps:function(t){if(t){this.cmbAlign.setValue(void 0!==t.get_Align()?t.get_Align():"");var e=t.get_Format(),i=t.get_TextPr(),n=t.get_Text();if(n&&e==Asc.c_oAscNumberingFormat.Bullet&&(this.bulletProps.symbol=n[0].get_Value()),i){this.cmbSize.setValue(i.get_FontSize()||-1),this.bulletProps.font=i.get_FontFamily();var o=i.get_Color();if(this.btnColor.menu.items[0].setChecked(void 0===o,!0),this.btnColor.menu.items[1].setChecked(!!o&&o.get_auto(),!0),o&&!o.get_auto())if("object"==typeof o){for(var s=!1,a=0;a<10;a++)if(Common.Utils.ThemeColor.ThemeValues[a]==o.effectValue){this.colors.select(o,!0),s=!0;break}s||this.colors.clearSelection(),o=Common.Utils.ThemeColor.getHexColor(o.get_r(),o.get_g(),o.get_b())}else this.colors.select(o,!0);else this.colors.clearSelection(),o="000000";this.btnColor.setColor(o)}this.type>0&&(e==Asc.c_oAscNumberingFormat.Bullet?(this.cmbFormat.store.findWhere({value:Asc.c_oAscNumberingFormat.Bullet,symbol:this.bulletProps.symbol,font:this.bulletProps.font})||this.cmbFormat.store.add({displayValue:this.txtSymbol+": ",value:Asc.c_oAscNumberingFormat.Bullet,symbol:this.bulletProps.symbol,font:this.bulletProps.font},{at:this.cmbFormat.store.length-1}),this.cmbFormat.setData(this.cmbFormat.store.models),this.cmbFormat.selectRecord(this.cmbFormat.store.findWhere({value:Asc.c_oAscNumberingFormat.Bullet,symbol:this.bulletProps.symbol,font:this.bulletProps.font}))):this.cmbFormat.setValue(void 0!==e?e:""))}},txtTitle:"List Settings",txtSize:"Size",txtColor:"Color",txtBullet:"Bullet",txtFont:"Font and Symbol",txtAlign:"Alignment",textLeft:"Left",textCenter:"Center",textRight:"Right",textAuto:"Automatic",textPreview:"Preview",txtType:"Type",txtLikeText:"Like a text",textLevel:"Level",txtNone:"None",txtNewBullet:"New bullet",txtSymbol:"Symbol"},DE.Views.ListSettingsDialog||{}))}),define("documenteditor/main/app/view/DateTimeDialog",["common/main/lib/component/Window","common/main/lib/component/ComboBox","common/main/lib/component/ListView"],function(){"use strict";DE.Views.DateTimeDialog=Common.UI.Window.extend(_.extend({options:{width:350,style:"min-width: 230px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.txtTitle},t||{}),this.template=['<div class="box" style="height: 272px;">','<div class="input-row">','<label style="font-weight: bold;">'+this.textLang+"</label>","</div>",'<div id="datetime-dlg-lang" class="input-row" style="margin-bottom: 8px;"></div>','<div class="input-row">','<label style="font-weight: bold;">'+this.textFormat+"</label>","</div>",'<div id="datetime-dlg-format" class="" style="margin-bottom: 10px;width: 100%; height: 162px; overflow: hidden;"></div>','<div class="input-row">','<div id="datetime-dlg-update" style="margin-top: 3px;"></div>','<button type="button" class="btn btn-text-default auto" id="datetime-dlg-default" style="float: right;">'+this.textDefault+"</button>","</div>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.api=this.options.api,this.lang=this.options.lang,this.handler=this.options.handler,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=[{value:1068},{value:1026},{value:1029},{value:3079},{value:1031},{value:2055},{value:1032},{value:3081},{value:2057},{value:1033},{value:3082},{value:2058},{value:1035},{value:1036},{value:1040},{value:1041},{value:1042},{value:1062},{value:1038},{value:1043},{value:1045},{value:1046},{value:2070},{value:1049},{value:1051},{value:1060},{value:2077},{value:1053},{value:1055},{value:1058},{value:1066},{value:2052}];t.forEach(function(t){var e=Common.util.LanguageInfo.getLocalLanguageName(t.value);t.displayValue=e[1],t.langName=e[0]}),this.cmbLang=new Common.UI.ComboBox({el:$("#datetime-dlg-lang"),menuStyle:"min-width: 100%; max-height: 185px;",cls:"input-group-nr",editable:!1,takeFocusOnClose:!0,data:t,search:!0,scrollAlwaysVisible:!0}),this.cmbLang.setValue(1033),this.cmbLang.on("selected",_.bind(function(t,e){this.updateFormats(e.value)},this)),this.chUpdate=new Common.UI.CheckBox({el:$("#datetime-dlg-update"),labelText:this.textUpdate}),this.chUpdate.on("change",_.bind(function(t,e,i,n){this.onSelectFormat(this.listFormats,null,this.listFormats.getSelectedRec())},this)),this.listFormats=new Common.UI.ListView({el:$("#datetime-dlg-format"),store:new Common.UI.DataViewStore,tabindex:1,scrollAlwaysVisible:!0,cls:"dbl-clickable"}),this.listFormats.on("item:select",_.bind(this.onSelectFormat,this)),this.listFormats.on("item:dblclick",_.bind(this.onDblClickFormat,this)),this.listFormats.on("entervalue",_.bind(this.onPrimary,this)),this.btnDefault=new Common.UI.Button({el:$("#datetime-dlg-default")}),this.btnDefault.on("click",_.bind(function(t,e){var i=this.listFormats.getSelectedRec();Common.UI.warning({msg:Common.Utils.String.format(this.confirmDefault,Common.util.LanguageInfo.getLocalLanguageName(this.cmbLang.getValue())[1],i?i.get("value"):""),buttons:["yes","no"],primary:"yes",callback:_.bind(function(t){if("yes"==t){this.defaultFormats[this.cmbLang.getValue()]=i?i.get("format"):"";var e=[];for(var n in this.defaultFormats)n&&e.push({lang:n,format:this.defaultFormats[n]});var o=JSON.stringify(e);Common.localStorage.setItem("de-settings-datetime-default",o),Common.Utils.InternalSettings.set("de-settings-datetime-default",o)}this.listFormats.focus()},this)})},this)),this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.afterRender()},afterRender:function(){var t=this,e=Common.Utils.InternalSettings.get("de-settings-datetime-default"),i=e?JSON.parse(e):[];this.defaultFormats=[],i.forEach(function(e){e.lang&&(t.defaultFormats[parseInt(e.lang)]=e.format)}),this._setDefaults()},getFocusedComponents:function(){return[this.cmbLang,this.listFormats,this.chUpdate,this.btnDefault]},getDefaultFocusableComponent:function(){return this.cmbLang},_setDefaults:function(){if(this.props=new Asc.CAscDateTime,this.lang){var t=this.cmbLang.store.findWhere({value:this.lang});t=t?t.get("value"):1033,this.cmbLang.setValue(t)}this.updateFormats(this.cmbLang.getValue())},getSettings:function(){return this.props},updateFormats:function(t){this.props.put_Lang(t);for(var e=this.props.get_FormatsExamples(),i=[],n=this.listFormats.store,o=0,s=e.length;o<s;o++){var a=new Common.UI.DataViewModel;a.set({format:e[o],value:this.props.get_String(e[o],void 0,t)}),i.push(a)}n.reset(i);var r=this.defaultFormats[t];r?this.listFormats.selectRecord(n.findWhere({format:r})):this.listFormats.selectByIndex(0);var a=this.listFormats.getSelectedRec();this.listFormats.scrollToRecord(a),this.onSelectFormat(this.listFormats,null,a)},onSelectFormat:function(t,e,i){i&&(this.props.put_Format(i.get("format")),this.props.put_Update("checked"==this.chUpdate.getValue()))},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onDblClickFormat:function(){this._handleInput("ok")},onPrimary:function(t){return this._handleInput("ok"),!1},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,t,this.getSettings()),this.close()},txtTitle:"Date & Time",textLang:"Language",textFormat:"Formats",textUpdate:"Update automatically",textDefault:"Set as default",confirmDefault:'Set default format for {0}: "{1}"'},DE.Views.DateTimeDialog||{}))}),define("documenteditor/main/app/view/LineNumbersDialog",["common/main/lib/component/Window","common/main/lib/component/CheckBox","common/main/lib/component/MetricSpinner"],function(){"use strict";DE.Views.LineNumbersDialog=Common.UI.Window.extend(_.extend({options:{width:290,height:320,header:!0,style:"min-width: 290px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),
this.template=['<div class="box" style="">','<div id="line-numbers-add-line-numbering" style="margin-bottom: 15px;"></div>','<div style="margin-bottom: 15px;">','<div style="display: inline-block; margin-right: 9px;"><label>'+this.textStartAt+'</label><div id="line-numbers-start-at"></div></div>','<div style="display: inline-block; margin-right: 9px;"><label>'+this.textFromText+'</label><div id="line-numbers-from-text"></div></div>','<div style="display: inline-block;"><label>'+this.textCountBy+'</label><div id="line-numbers-count-by"></div></div>',"</div>",'<div style="margin-bottom: 8px;"><label>'+this.textNumbering+"</label></div>",'<div id="line-numbers-restart-each-page" style="margin-bottom: 8px;"></div>','<div id="line-numbers-restart-each-section" style="margin-bottom: 8px;"></div>','<div id="line-numbers-continuous" style="margin-bottom: 15px;"></div>','<div style="margin-bottom: 5px;">',"<label>"+this.textApplyTo+'</label><div id="line-numbers-combo-apply" class="input-group-nr" style="width:150px;"></div>',"</div>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.spinners=[],this._noApply=!1,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.chAddLineNumbering=new Common.UI.CheckBox({el:$("#line-numbers-add-line-numbering"),labelText:this.textAddLineNumbering}).on("change",_.bind(function(t,e,i,n){var o="checked"!==t.getValue();this.spnStartAt.setDisabled(o),this.spnFromText.setDisabled(o),this.spnCountBy.setDisabled(o),this.rbRestartEachPage.setDisabled(o),this.rbRestartEachSection.setDisabled(o),this.rbContinuous.setDisabled(o)},this)),this.spnStartAt=new Common.UI.MetricSpinner({el:$("#line-numbers-start-at"),step:1,width:80,defaultUnit:"",value:1,maxValue:32767,minValue:1,disabled:!0}),this.spnFromText=new Common.UI.MetricSpinner({el:$("#line-numbers-from-text"),step:.1,width:80,defaultUnit:"cm",value:"Auto",autoText:this.txtAutoText,maxValue:55.87,minValue:.1,allowAuto:!0,disabled:!0}),this.spinners.push(this.spnFromText),this.spnCountBy=new Common.UI.MetricSpinner({el:$("#line-numbers-count-by"),step:1,width:80,defaultUnit:"",value:1,maxValue:100,minValue:1,disabled:!0}),this.rbRestartEachPage=new Common.UI.RadioBox({el:$("#line-numbers-restart-each-page"),labelText:this.textRestartEachPage,name:"asc-radio-line-numbers",disabled:!0,checked:!0}),this.rbRestartEachSection=new Common.UI.RadioBox({el:$("#line-numbers-restart-each-section"),labelText:this.textRestartEachSection,name:"asc-radio-line-numbers",disabled:!0}),this.rbContinuous=new Common.UI.RadioBox({el:$("#line-numbers-continuous"),labelText:this.textContinuous,name:"asc-radio-line-numbers",disabled:!0}),this.cmbApply=new Common.UI.ComboBox({el:$("#line-numbers-combo-apply"),cls:"input-group-nr",menuStyle:"min-width: 150px;",takeFocusOnClose:!0,editable:!1,data:[{displayValue:this.textSection,value:Asc.c_oAscSectionApplyType.Current},{displayValue:this.textForward,value:Asc.c_oAscSectionApplyType.ToEnd},{displayValue:this.textDocument,value:Asc.c_oAscSectionApplyType.All}]}),this.cmbApply.setValue(this.options.applyTo),this.getChild().find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.updateMetricUnit()},getFocusedComponents:function(){return[this.chAddLineNumbering,this.spnStartAt,this.spnFromText,this.spnCountBy,this.rbRestartEachPage,this.rbRestartEachSection,this.rbContinuous,this.cmbApply]},getDefaultFocusableComponent:function(){return this.chAddLineNumbering},afterRender:function(){},setSettings:function(t){if(t){var e=t.get_Restart();switch(this.chAddLineNumbering.setValue(!0),e){case Asc.c_oAscLineNumberRestartType.Continuous:this.rbContinuous.setValue(!0,!0);break;case Asc.c_oAscLineNumberRestartType.NewPage:this.rbRestartEachPage.setValue(!0,!0);break;case Asc.c_oAscLineNumberRestartType.NewSection:this.rbRestartEachSection.setValue(!0,!0)}this.spnStartAt.setValue(null!==t.get_Start()&&void 0!==t.get_Start()?t.get_Start():"",!0),this.spnFromText.setValue(null!==t.get_Distance()&&void 0!==t.get_Distance()?Common.Utils.Metric.fnRecalcFromMM(25.4*t.get_Distance()/20/72):-1,!0),this.spnCountBy.setValue(null!==t.get_CountBy()&&void 0!==t.get_CountBy()?t.get_CountBy():"",!0)}else this.chAddLineNumbering.setValue(!1)},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,this,t),this.close()},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(){return this._handleInput("ok"),!1},getSettings:function(){var t;if("checked"===this.chAddLineNumbering.getValue()){t=new Asc.CSectionLnNumType,this.rbContinuous.getValue()?t.put_Restart(Asc.c_oAscLineNumberRestartType.Continuous):this.rbRestartEachPage.getValue()?t.put_Restart(Asc.c_oAscLineNumberRestartType.NewPage):this.rbRestartEachSection.getValue()&&t.put_Restart(Asc.c_oAscLineNumberRestartType.NewSection),t.put_Start(""!==this.spnStartAt.getValue()?this.spnStartAt.getNumberValue():void 0);var e=this.spnFromText.getNumberValue();t.put_Distance(e<0?null:parseInt(72*Common.Utils.Metric.fnRecalcToMM(e)*20/25.4)),t.put_CountBy(""!==this.spnCountBy.getValue()?this.spnCountBy.getNumberValue():void 0)}return{props:t,type:this.cmbApply.getValue()}},updateMetricUnit:function(){if(this.spinners)for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}},textTitle:"Line Numbers",textAddLineNumbering:"Add line numbering",textStartAt:"Start at",textFromText:"From text",textCountBy:"Count by",textNumbering:"Numbering",textRestartEachPage:"Restart Each Page",textRestartEachSection:"Restart Each Section",textContinuous:"Continuous",textApplyTo:"Apply changes to",textDocument:"Whole document",textSection:"Current section",textForward:"This point forward",txtAutoText:"Auto"},DE.Views.LineNumbersDialog||{}))}),define("documenteditor/main/app/view/TextToTableDialog",["common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/CheckBox","common/main/lib/component/MetricSpinner"],function(){"use strict";DE.Views.TextToTableDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:300,height:405,buttons:["ok","cancel"]},initialize:function(t){var e=this;_.extend(this.options,{title:this.textTitle,template:['<div class="box" style="height:'+(e.options.height-85)+'px;">','<div class="content-panel" style="padding: 0 5px;"><div class="inner-content">','<div class="settings-panel active">','<table cols="2" style="width: auto;">',"<tr>",'<td colspan="2" class="padding-small">','<label class="header">',e.textTableSize,"</label>","</td>","</tr>","<tr>",'<td class="padding-small">','<label style="margin-right: 10px;">',e.textColumns,"</label>","</td>",'<td class="padding-small">','<div id="id-text-table-spn-columns"></div>',"</td>","</tr>","<tr>",'<td class="padding-large">','<label style="margin-right: 10px;">',e.textRows,"</label>","</td>",'<td class="padding-large">','<div id="id-text-table-spn-rows"></div>',"</td>","</tr>","</table>",'<table cols="1">',"<tr>",'<td  style="padding-bottom: 5px;">','<label class="header">',e.textAutofit,"</label>","</td>","</tr>","<tr>",'<td style="padding-bottom: 5px;">','<div id="id-text-table-radio-fixed" style="display: inline-block;margin-right: 10px;"></div>','<div id="id-text-table-spn-fixed" style="display: inline-block;"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<div id="id-text-table-radio-contents"></div>',"</td>","</tr>","<tr>",'<td class="padding-large">','<div id="id-text-table-radio-window"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<label class="header">',e.textSeparator,"</label>","</td>","</tr>","<tr>",'<td class="padding-small">','<div id="id-text-table-radio-para"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<div id="id-text-table-radio-tabs"></div>',"</td>","</tr>","<tr>",'<td style="padding-bottom: 5px;">','<div id="id-text-table-radio-semi"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<div id="id-text-table-radio-other" style="display: inline-block;margin-right: 10px;vertical-align: middle;"></div>','<div id="id-text-table-txt-other" style="display: inline-block;vertical-align: middle;"></div>',"</td>","</tr>","</table>","</div></div>","</div>","</div>"].join("")},t),this.handler=t.handler,this.props=t.props,this.spinners=[],Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this.getChild(),e=this;this.spnColumns=new Common.UI.MetricSpinner({el:t.find("#id-text-table-spn-columns"),step:1,width:80,value:2,defaultUnit:"",maxValue:63,minValue:1,allowDecimal:!1}).on("change",function(t,i,n,o){if(e.props){var s=e.props.put_ColsCount(t.getNumberValue(),!0);s&&e.spnRows.setValue(s[0],!0)}}),this.spnRows=new Common.UI.MetricSpinner({el:t.find("#id-text-table-spn-rows"),step:1,width:80,value:2,defaultUnit:"",maxValue:100,minValue:1,allowDecimal:!1,disabled:!0}),this.spnWidth=new Common.UI.MetricSpinner({el:t.find("#id-text-table-spn-fixed"),step:.1,width:80,defaultUnit:"cm",value:"Auto",autoText:this.txtAutoText,maxValue:55.87,minValue:.42,allowAuto:!0}),this.spinners.push(this.spnWidth),this.rbFixed=new Common.UI.RadioBox({el:t.find("#id-text-table-radio-fixed"),labelText:this.textFixed,name:"asc-radio-text-table-autofit",value:1,checked:!0}).on("change",_.bind(this.onRadioAutofitChange,this)),this.rbContents=new Common.UI.RadioBox({el:t.find("#id-text-table-radio-contents"),labelText:this.textContents,name:"asc-radio-text-table-autofit",value:2}).on("change",_.bind(this.onRadioAutofitChange,this)),this.rbWindow=new Common.UI.RadioBox({el:t.find("#id-text-table-radio-window"),labelText:this.textWindow,name:"asc-radio-text-table-autofit",value:3}).on("change",_.bind(this.onRadioAutofitChange,this)),this.rbPara=new Common.UI.RadioBox({el:t.find("#id-text-table-radio-para"),labelText:this.textPara,name:"asc-radio-text-table-separator",value:1,checked:!0}).on("change",_.bind(this.onRadioSeparatorChange,this)),this.rbTabs=new Common.UI.RadioBox({el:t.find("#id-text-table-radio-tabs"),labelText:this.textTab,name:"asc-radio-text-table-separator",value:2}).on("change",_.bind(this.onRadioSeparatorChange,this)),this.rbSemi=new Common.UI.RadioBox({el:t.find("#id-text-table-radio-semi"),labelText:this.textSemicolon,name:"asc-radio-text-table-separator",value:";"}).on("change",_.bind(this.onRadioSeparatorChange,this)),this.rbOther=new Common.UI.RadioBox({el:t.find("#id-text-table-radio-other"),labelText:this.textOther,name:"asc-radio-text-table-separator",value:3}).on("change",_.bind(this.onRadioSeparatorChange,this)),this.inputOther=new Common.UI.InputField({el:t.find("#id-text-table-txt-other"),style:"width: 30px;",maxLength:1,validateOnChange:!0,validateOnBlur:!1,value:Common.Utils.InternalSettings.get("de-text-to-table-separator")||"-"}).on("changing",function(t,i){if(e.props&&i){e.props.put_SeparatorType(3,!0);var n=e.props.put_Separator(i.charCodeAt(0),!0);n&&(e.spnColumns.setValue(n[1],!0),e.spnRows.setValue(n[0],!0))}}),this.afterRender()},getFocusedComponents:function(){return[this.spnColumns,this.spnStartAt,this.spnWidth,this.rbFixed,this.rbContents,this.rbWindow,this.rbPara,this.rbTabs,this.rbSemi,this.rbOther,this.inputOther]},getDefaultFocusableComponent:function(){return this.spnColumns},afterRender:function(){this.updateMetricUnit(),this._setDefaults(this.props)},_setDefaults:function(t){if(t){var e=t.get_Size();switch(this.spnColumns.setValue(e[1],!0),this.spnRows.setValue(e[0],!0),e=t.get_AutoFitType(),1===e?this.rbFixed.setValue(!0,!0):2===e?this.rbContents.setValue(!0,!0):this.rbWindow.setValue(!0,!0),1===e&&this.spnWidth.setValue(t.get_Fit()>-1?Common.Utils.Metric.fnRecalcFromMM(t.get_Fit()):-1,!0),this.spnWidth.setDisabled(1!==e),e=t.get_SeparatorType()){case 1:this.rbPara.setValue(!0,!0),this.inputOther.setDisabled(!0);break;case 2:this.rbTabs.setValue(!0,!0),this.inputOther.setDisabled(!0);break;case 3:e=String.fromCharCode(t.get_Separator()),";"==e?(this.rbSemi.setValue(!0,!0),this.inputOther.setDisabled(!0)):(this.rbOther.setValue(!0,!0),this.inputOther.setValue(e),this.inputOther.setDisabled(!1))}}},getSettings:function(){return this.props&&(this.props.put_AutoFitType(this.rbFixed.getValue()?1:this.rbContents.getValue()?2:3),this.rbFixed.getValue()&&this.props.put_Fit(Common.Utils.Metric.fnRecalcToMM(this.spnWidth.getNumberValue())),this.rbOther.getValue()&&Common.Utils.InternalSettings.set("de-text-to-table-separator",String.fromCharCode(this.props.get_Separator()))),this.props},onDlgBtnClick:function(t){var e="object"==typeof t?t.currentTarget.attributes.result.value:t;if("ok"==e){if(!this.isRangeValid())return;this.handler&&this.handler.call(this,e,"ok"==e?this.getSettings():void 0)}this.close()},onPrimary:function(){return this.onDlgBtnClick("ok"),!1},isRangeValid:function(){if(this.rbOther.getValue()&&""==this.inputOther.getValue()){var t=this;return Common.UI.warning({msg:this.textEmpty,maxwidth:600,callback:function(e){t.inputOther.focus()}}),!1}return!0},onRadioAutofitChange:function(t,e,i){var n=t.options.value,o=this;e&&this.props&&(o.spnWidth.setDisabled(1!==n),1==n&&setTimeout(function(){o.spnWidth.focus()},1))},onRadioSeparatorChange:function(t,e,i){var n,o=t.options.value,s=this;e&&this.props&&(this.inputOther.setDisabled(3!==o),"string"==typeof o?n=this.props.put_Separator(o.charCodeAt(0),!0):3==o?(this.inputOther.getValue()&&(n=this.props.put_Separator(this.inputOther.getValue().charCodeAt(0),!0)),setTimeout(function(){s.inputOther.focus()},1)):n=this.props.put_SeparatorType(o,!0),n&&(this.spnColumns.setValue(n[1],!0),this.spnRows.setValue(n[0],!0)))},updateMetricUnit:function(){if(this.spinners)for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}},textTitle:"Convert Text to Table",textTableSize:"Table Size",textColumns:"Columns",textRows:"Rows",textAutofit:"Autofit Behavior",textFixed:"Fixed column width",textContents:"Autofit to contents",textWindow:"Autofit to window",textSeparator:"Separate Text at",textPara:"Paragraphs",textTab:"Tabs",textSemicolon:"Semicolons",textOther:"Other",txtAutoText:"Auto",textEmpty:"You must type a character for the custom separator."},DE.Views.TextToTableDialog||{}))}),define("documenteditor/main/app/controller/Toolbar",["core","common/main/lib/component/Window","common/main/lib/view/CopyWarningDialog","common/main/lib/view/ImageFromUrlDialog","common/main/lib/view/InsertTableDialog","common/main/lib/view/SelectFileDlg","common/main/lib/view/SymbolTableDialog","common/main/lib/util/define","documenteditor/main/app/view/Toolbar","documenteditor/main/app/view/DropcapSettingsAdvanced","documenteditor/main/app/view/StyleTitleDialog","documenteditor/main/app/view/PageMarginsDialog","documenteditor/main/app/view/PageSizeDialog","documenteditor/main/app/controller/PageLayout","documenteditor/main/app/view/CustomColumnsDialog","documenteditor/main/app/view/ControlSettingsDialog","documenteditor/main/app/view/WatermarkSettingsDialog","documenteditor/main/app/view/ListSettingsDialog","documenteditor/main/app/view/DateTimeDialog","documenteditor/main/app/view/LineNumbersDialog","documenteditor/main/app/view/TextToTableDialog"],function(){"use strict";DE.Controllers.Toolbar=Backbone.Controller.extend(_.extend({models:[],collections:[],controllers:[],views:["Toolbar"],initialize:function(){this._state={activated:!1,bullets:{type:void 0,subtype:void 0},prstyle:void 0,prcontrolsdisable:void 0,dropcap:Asc.c_oAscDropCap.None,clrhighlight:void 0,clrtext:void 0,pgsize:[0,0],linespace:void 0,pralign:void 0,clrback:void 0,valign:void 0,can_undo:void 0,can_redo:void 0,bold:void 0,italic:void 0,strike:void 0,underline:void 0,pgorient:void 0,lock_doc:void 0,can_copycut:void 0,pgmargins:void 0,fontsize:void 0,in_equation:!1,in_chart:!1,linenum_apply:Asc.c_oAscSectionApplyType.All,suppress_num:void 0},this.flg={},this.diagramEditor=null,this._isAddingShape=!1,this.editMode=!0,this.binding={},this.addListeners({Toolbar:{"insert:break":this.onClickPageBreak,"change:compact":this.onClickChangeCompact,"home:open":this.onHomeOpen,"add:chart":this.onSelectChart,"insert:textart":this.onInsertTextart},FileMenu:{"menu:hide":this.onFileMenu.bind(this,"hide"),"menu:show":this.onFileMenu.bind(this,"show")},"Common.Views.Header":{"toolbar:setcompact":this.onChangeCompactView.bind(this),print:function(t){this.getApplication().getController("Main").onPrint()},save:function(t){this.api.asc_Save()},undo:this.onUndo,redo:this.onRedo,downloadas:function(t){var e,i=this.getApplication().getController("Main"),n=i.document.fileType;if(n){if(/^pdf|xps|oxps|djvu/i.test(n))return void i.api.asc_DownloadOrigin();e=Asc.c_oAscFileType[n.toUpperCase()]}var o=[Asc.c_oAscFileType.TXT,Asc.c_oAscFileType.RTF,Asc.c_oAscFileType.ODT,Asc.c_oAscFileType.DOCX,Asc.c_oAscFileType.HTML,Asc.c_oAscFileType.PDFA,Asc.c_oAscFileType.DOTX,Asc.c_oAscFileType.OTT,Asc.c_oAscFileType.FB2,Asc.c_oAscFileType.EPUB];(!e||o.indexOf(e)<0)&&(e=Asc.c_oAscFileType.PDF),i.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(e))},"go:editor":function(){Common.Gateway.requestEditRights()}}});var t=this,e=function(e){var i=$(e.target),n=i.closest("#editor_sdk"),o=i.closest("button").attr("id");void 0===o&&(o=i.closest(".btn-group").attr("id")),"editor_sdk"!=i.attr("id")&&n.length<=0&&(t.toolbar.btnInsertText.pressed&&o!=t.toolbar.btnInsertText.id||t.toolbar.btnInsertShape.pressed&&o!=t.toolbar.btnInsertShape.id?(t._isAddingShape=!1,t._addAutoshape(!1),t.toolbar.btnInsertShape.toggle(!1,!0),t.toolbar.btnInsertText.toggle(!1,!0),Common.NotificationCenter.trigger("edit:complete",t.toolbar)):t.toolbar.btnInsertShape.pressed&&o==t.toolbar.btnInsertShape.id&&_.defer(function(){t.api.StartAddShape("",!1),Common.NotificationCenter.trigger("edit:complete",t.toolbar)},100))};this.onApiEndAddShape=function(){this.toolbar.fireEvent("insertshape",this.toolbar),this.toolbar.btnInsertShape.pressed&&this.toolbar.btnInsertShape.toggle(!1,!0),this.toolbar.btnInsertText.pressed&&this.toolbar.btnInsertText.toggle(!1,!0),$(document.body).off("mouseup",e)},this._addAutoshape=function(t,i){this.api&&(t?(this.api.StartAddShape(i,!0),$(document.body).on("mouseup",e)):(this.api.StartAddShape("",!1),$(document.body).off("mouseup",e)))},Common.NotificationCenter.on("style:commitsave",_.bind(this.onSaveStyle,this)),Common.NotificationCenter.on("style:commitchange",_.bind(this.onUpdateStyle,this))},onLaunch:function(){var t=this;this.toolbar=this.createView("Toolbar"),t.toolbar.on("render:before",function(t){}),Common.NotificationCenter.on("app:ready",t.onAppReady.bind(t)),Common.NotificationCenter.on("app:face",t.onAppShowed.bind(t))},setMode:function(t){this.mode=t,this.toolbar.applyLayout(t)},attachUIEvents:function(t){t.btnPrint.on("click",_.bind(this.onPrint,this)),t.btnPrint.on("disabled",_.bind(this.onBtnChangeState,this,"print:disabled")),t.btnSave.on("click",_.bind(this.onSave,this)),t.btnUndo.on("click",_.bind(this.onUndo,this)),t.btnUndo.on("disabled",_.bind(this.onBtnChangeState,this,"undo:disabled")),t.btnRedo.on("click",_.bind(this.onRedo,this)),t.btnRedo.on("disabled",_.bind(this.onBtnChangeState,this,"redo:disabled")),t.btnCopy.on("click",_.bind(this.onCopyPaste,this,!0)),t.btnPaste.on("click",_.bind(this.onCopyPaste,this,!1)),t.btnIncFontSize.on("click",_.bind(this.onIncrease,this)),t.btnDecFontSize.on("click",_.bind(this.onDecrease,this)),t.mnuChangeCase.on("item:click",_.bind(this.onChangeCase,this)),t.btnBold.on("click",_.bind(this.onBold,this)),t.btnItalic.on("click",_.bind(this.onItalic,this)),t.btnUnderline.on("click",_.bind(this.onUnderline,this)),t.btnStrikeout.on("click",_.bind(this.onStrikeout,this)),t.btnSuperscript.on("click",_.bind(this.onSuperscript,this)),t.btnSubscript.on("click",_.bind(this.onSubscript,this)),t.btnAlignLeft.on("click",_.bind(this.onHorizontalAlign,this,1)),t.btnAlignCenter.on("click",_.bind(this.onHorizontalAlign,this,2)),t.btnAlignRight.on("click",_.bind(this.onHorizontalAlign,this,0)),t.btnAlignJust.on("click",_.bind(this.onHorizontalAlign,this,3)),t.btnDecLeftOffset.on("click",_.bind(this.onDecOffset,this)),t.btnIncLeftOffset.on("click",_.bind(this.onIncOffset,this)),t.btnMarkers.on("click",_.bind(this.onMarkers,this)),t.btnNumbers.on("click",_.bind(this.onNumbers,this)),t.cmbFontName.on("selected",_.bind(this.onFontNameSelect,this)),t.cmbFontName.on("show:after",_.bind(this.onComboOpen,this,!0)),t.cmbFontName.on("hide:after",_.bind(this.onHideMenus,this)),t.cmbFontName.on("combo:blur",_.bind(this.onComboBlur,this)),t.cmbFontName.on("combo:focusin",_.bind(this.onComboOpen,this,!1)),t.cmbFontSize.on("selected",_.bind(this.onFontSizeSelect,this)),t.cmbFontSize.on("changed:before",_.bind(this.onFontSizeChanged,this,!0)),t.cmbFontSize.on("changed:after",_.bind(this.onFontSizeChanged,this,!1)),t.cmbFontSize.on("combo:blur",_.bind(this.onComboBlur,this)),t.cmbFontSize.on("combo:focusin",_.bind(this.onComboOpen,this,!1)),t.cmbFontSize.on("show:after",_.bind(this.onComboOpen,this,!0)),t.cmbFontSize.on("hide:after",_.bind(this.onHideMenus,this)),t.mnuMarkersPicker.on("item:click",_.bind(this.onSelectBullets,this,t.btnMarkers)),t.mnuNumbersPicker.on("item:click",_.bind(this.onSelectBullets,this,t.btnNumbers)),t.mnuMultilevelPicker.on("item:click",_.bind(this.onSelectBullets,this,t.btnMultilevels)),t.btnMarkers.menu.on("show:after",_.bind(this.onListShowAfter,this,0,t.mnuMarkersPicker)),t.btnNumbers.menu.on("show:after",_.bind(this.onListShowAfter,this,1,t.mnuNumbersPicker)),t.btnMultilevels.menu.on("show:after",_.bind(this.onListShowAfter,this,2,t.mnuMultilevelPicker)),t.mnuMarkerSettings.on("click",_.bind(this.onMarkerSettingsClick,this,0)),t.mnuNumberSettings.on("click",_.bind(this.onMarkerSettingsClick,this,1)),t.mnuMultilevelSettings.on("click",_.bind(this.onMarkerSettingsClick,this,2)),t.mnuMarkerChangeLevel&&t.mnuMarkerChangeLevel.menu&&t.mnuMarkerChangeLevel.menu.on("show:after",_.bind(this.onChangeLevelShowAfter,this,0)),t.mnuMarkerChangeLevel.menu.on("item:click",_.bind(this.onChangeLevelClick,this,0)),t.mnuNumberChangeLevel&&t.mnuNumberChangeLevel.menu&&t.mnuNumberChangeLevel.menu.on("show:after",_.bind(this.onChangeLevelShowAfter,this,1)),t.mnuNumberChangeLevel.menu.on("item:click",_.bind(this.onChangeLevelClick,this,1)),t.mnuMultiChangeLevel&&t.mnuMultiChangeLevel.menu&&t.mnuMultiChangeLevel.menu.on("show:after",_.bind(this.onChangeLevelShowAfter,this,2)),t.mnuMultiChangeLevel.menu.on("item:click",_.bind(this.onChangeLevelClick,this,2)),t.btnHighlightColor.on("click",_.bind(this.onBtnHighlightColor,this)),t.btnFontColor.on("click",_.bind(this.onBtnFontColor,this)),t.btnParagraphColor.on("click",_.bind(this.onBtnParagraphColor,this)),t.mnuHighlightColorPicker.on("select",_.bind(this.onSelectHighlightColor,this)),t.mnuFontColorPicker.on("select",_.bind(this.onSelectFontColor,this)),t.mnuParagraphColorPicker.on("select",_.bind(this.onParagraphColorPickerSelect,this)),t.mnuHighlightTransparent.on("click",_.bind(this.onHighlightTransparentClick,this)),$("#id-toolbar-menu-auto-fontcolor").on("click",_.bind(this.onAutoFontColor,this)),$("#id-toolbar-menu-new-fontcolor").on("click",_.bind(this.onNewFontColor,this)),$("#id-toolbar-menu-new-paracolor").on("click",_.bind(this.onNewParagraphColor,this)),t.mnuLineSpace.on("item:toggle",_.bind(this.onLineSpaceToggle,this)),t.mnuNonPrinting.on("item:toggle",_.bind(this.onMenuNonPrintingToggle,this)),t.btnShowHidenChars.on("toggle",_.bind(this.onNonPrintingToggle,this)),t.mnuTablePicker.on("select",_.bind(this.onTablePickerSelect,this)),t.mnuInsertTable.on("item:click",_.bind(this.onInsertTableClick,this)),t.mnuInsertTable.on("show:after",_.bind(this.onInsertTableShow,this)),t.mnuInsertImage.on("item:click",_.bind(this.onInsertImageClick,this)),t.btnInsertText.on("click",_.bind(this.onBtnInsertTextClick,this)),t.btnInsertShape.menu.on("hide:after",_.bind(this.onInsertShapeHide,this)),t.btnDropCap.menu.on("item:click",_.bind(this.onDropCapSelect,this)),t.btnContentControls.menu.on("item:click",_.bind(this.onControlsSelect,this)),t.mnuDropCapAdvanced.on("click",_.bind(this.onDropCapAdvancedClick,this,!1)),t.btnColumns.menu.on("item:click",_.bind(this.onColumnsSelect,this)),t.btnPageOrient.menu.on("item:click",_.bind(this.onPageOrientSelect,this)),t.btnPageMargins.menu.on("item:click",_.bind(this.onPageMarginsSelect,this)),t.btnWatermark.menu.on("item:click",_.bind(this.onWatermarkSelect,this)),t.btnClearStyle.on("click",_.bind(this.onClearStyleClick,this)),t.btnCopyStyle.on("toggle",_.bind(this.onCopyStyleToggle,this)),t.mnuPageSize.on("item:click",_.bind(this.onPageSizeClick,this)),t.mnuColorSchema.on("item:click",_.bind(this.onColorSchemaClick,this)),t.mnuColorSchema.on("show:after",_.bind(this.onColorSchemaShow,this)),t.btnMailRecepients.on("click",_.bind(this.onSelectRecepientsClick,this)),t.mnuPageNumberPosPicker.on("item:click",_.bind(this.onInsertPageNumberClick,this)),t.btnEditHeader.menu.on("item:click",_.bind(this.onEditHeaderFooterClick,this)),t.btnInsDateTime.on("click",_.bind(this.onInsDateTimeClick,this)),t.mnuPageNumCurrentPos.on("click",_.bind(this.onPageNumCurrentPosClick,this)),t.mnuInsertPageCount.on("click",_.bind(this.onInsertPageCountClick,this)),t.btnBlankPage.on("click",_.bind(this.onBtnBlankPageClick,this)),t.listStyles.on("click",_.bind(this.onListStyleSelect,this)),t.listStyles.on("contextmenu",_.bind(this.onListStyleContextMenu,this)),t.styleMenu.on("hide:before",_.bind(this.onListStyleBeforeHide,this)),t.btnInsertEquation.on("click",_.bind(this.onInsertEquationClick,this)),t.btnInsertSymbol.on("click",_.bind(this.onInsertSymbolClick,this)),t.mnuNoControlsColor.on("click",_.bind(this.onNoControlsColor,this)),t.mnuControlsColorPicker.on("select",_.bind(this.onSelectControlsColor,this)),t.btnLineNumbers.menu.on("item:click",_.bind(this.onLineNumbersSelect,this)),t.btnLineNumbers.menu.on("show:after",_.bind(this.onLineNumbersShow,this)),Common.Gateway.on("insertimage",_.bind(this.insertImage,this)),Common.Gateway.on("setmailmergerecipients",_.bind(this.setMailMergeRecipients,this)),$("#id-toolbar-menu-new-control-color").on("click",_.bind(this.onNewControlsColor,this)),$("#id-save-style-plus, #id-save-style-link",t.$el).on("click",this.onMenuSaveStyle.bind(this)),this.onSetupCopyStyleButton(),this.onBtnChangeState("undo:disabled",t.btnUndo,t.btnUndo.isDisabled()),this.onBtnChangeState("redo:disabled",t.btnRedo,t.btnRedo.isDisabled())},setApi:function(t){this.api=t,this.mode.isEdit?(this.toolbar.setApi(t),this.api.asc_registerCallback("asc_onFontSize",_.bind(this.onApiFontSize,this)),this.api.asc_registerCallback("asc_onBold",_.bind(this.onApiBold,this)),this.api.asc_registerCallback("asc_onItalic",_.bind(this.onApiItalic,this)),this.api.asc_registerCallback("asc_onUnderline",_.bind(this.onApiUnderline,this)),this.api.asc_registerCallback("asc_onStrikeout",_.bind(this.onApiStrikeout,this)),this.api.asc_registerCallback("asc_onVerticalAlign",_.bind(this.onApiVerticalAlign,this)),this.api.asc_registerCallback("asc_onCanUndo",_.bind(this.onApiCanRevert,this,"undo")),this.api.asc_registerCallback("asc_onCanRedo",_.bind(this.onApiCanRevert,this,"redo")),this.api.asc_registerCallback("asc_onListType",_.bind(this.onApiBullets,this)),this.api.asc_registerCallback("asc_onPrAlign",_.bind(this.onApiParagraphAlign,this)),this.api.asc_registerCallback("asc_onTextColor",_.bind(this.onApiTextColor,this)),this.api.asc_registerCallback("asc_onParaSpacingLine",_.bind(this.onApiLineSpacing,this)),this.api.asc_registerCallback("asc_onFocusObject",_.bind(this.onApiFocusObject,this)),this.api.asc_registerCallback("asc_onDocSize",_.bind(this.onApiPageSize,this)),this.api.asc_registerCallback("asc_onPaintFormatChanged",_.bind(this.onApiStyleChange,this)),this.api.asc_registerCallback("asc_onParaStyleName",_.bind(this.onApiParagraphStyleChange,this)),this.api.asc_registerCallback("asc_onEndAddShape",_.bind(this.onApiEndAddShape,this)),this.api.asc_registerCallback("asc_onPageOrient",_.bind(this.onApiPageOrient,this)),this.api.asc_registerCallback("asc_onLockDocumentProps",_.bind(this.onApiLockDocumentProps,this)),this.api.asc_registerCallback("asc_onUnLockDocumentProps",_.bind(this.onApiUnLockDocumentProps,this)),this.api.asc_registerCallback("asc_onLockDocumentSchema",_.bind(this.onApiLockDocumentSchema,this)),this.api.asc_registerCallback("asc_onUnLockDocumentSchema",_.bind(this.onApiUnLockDocumentSchema,this)),this.api.asc_registerCallback("asc_onLockHeaderFooters",_.bind(this.onApiLockHeaderFooters,this)),this.api.asc_registerCallback("asc_onUnLockHeaderFooters",_.bind(this.onApiUnLockHeaderFooters,this)),this.api.asc_registerCallback("asc_onZoomChange",_.bind(this.onApiZoomChange,this)),this.api.asc_registerCallback("asc_onMarkerFormatChanged",_.bind(this.onApiStartHighlight,this)),this.api.asc_registerCallback("asc_onTextHighLight",_.bind(this.onApiHighlightColor,this)),this.api.asc_registerCallback("asc_onInitEditorStyles",_.bind(this.onApiInitEditorStyles,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onApiCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiCoAuthoringDisconnect,this)),this.api.asc_registerCallback("asc_onCanCopyCut",_.bind(this.onApiCanCopyCut,this)),this.api.asc_registerCallback("asc_onMathTypes",_.bind(this.onApiMathTypes,this)),this.api.asc_registerCallback("asc_onColumnsProps",_.bind(this.onColumnsProps,this)),this.api.asc_registerCallback("asc_onSectionProps",_.bind(this.onSectionProps,this)),this.api.asc_registerCallback("asc_onLineNumbersProps",_.bind(this.onLineNumbersProps,this)),this.api.asc_registerCallback("asc_onContextMenu",_.bind(this.onContextMenu,this)),this.api.asc_registerCallback("asc_onShowParaMarks",_.bind(this.onShowParaMarks,this)),this.api.asc_registerCallback("asc_onChangeSdtGlobalSettings",_.bind(this.onChangeSdtGlobalSettings,this)),this.api.asc_registerCallback("asc_onTextLanguage",_.bind(this.onTextLanguage,this)),Common.NotificationCenter.on("fonts:change",_.bind(this.onApiChangeFont,this)),this.api.asc_registerCallback("asc_onTableDrawModeChanged",_.bind(this.onTableDraw,this)),this.api.asc_registerCallback("asc_onTableEraseModeChanged",_.bind(this.onTableErase,this)),Common.NotificationCenter.on("storage:image-load",_.bind(this.openImageFromStorage,this)),Common.NotificationCenter.on("storage:image-insert",_.bind(this.insertImageFromStorage,this)),Common.NotificationCenter.on("dropcap:settings",_.bind(this.onDropCapAdvancedClick,this))):this.mode.isRestrictedEdit&&(this.api.asc_registerCallback("asc_onFocusObject",_.bind(this.onApiFocusObjectRestrictedEdit,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onApiCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiCoAuthoringDisconnect,this)))},onChangeCompactView:function(t,e){this.toolbar.setFolded(e),this.toolbar.fireEvent("view:compact",[this,e]),Common.localStorage.setBool("de-compact-toolbar",e),Common.NotificationCenter.trigger("layout:changed","toolbar"),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onClickChangeCompact:function(t){if("file"!=t){var e=this;setTimeout(function(){e.onChangeCompactView(null,!e.toolbar.isCompact())},0)}},onContextMenu:function(){this.toolbar.collapse()},onApiChangeFont:function(t){!Common.Utils.ModalWindow.isVisible()&&this.toolbar.cmbFontName.onApiChangeFont(t)},onApiFontSize:function(t){this._state.fontsize!==t&&(this.toolbar.cmbFontSize.setValue(t),this._state.fontsize=t)},onApiBold:function(t){this._state.bold!==t&&(this.toolbar.btnBold.toggle(!0===t,!0),this._state.bold=t)},
onApiItalic:function(t){this._state.italic!==t&&(this.toolbar.btnItalic.toggle(!0===t,!0),this._state.italic=t)},onApiUnderline:function(t){this._state.underline!==t&&(this.toolbar.btnUnderline.toggle(!0===t,!0),this._state.underline=t)},onApiStrikeout:function(t){this._state.strike!==t&&(this.toolbar.btnStrikeout.toggle(!0===t,!0),this._state.strike=t)},onApiVerticalAlign:function(t){this._state.valign!==t&&(this.toolbar.btnSuperscript.toggle(1==t,!0),this.toolbar.btnSubscript.toggle(2==t,!0),this._state.valign=t)},onApiCanRevert:function(t,e){"undo"==t?this._state.can_undo!==e&&(this.toolbar.btnUndo.setDisabled(!e),this._state.can_undo=e):this._state.can_redo!==e&&(this.toolbar.btnRedo.setDisabled(!e),this._state.can_redo=e)},onApiCanCopyCut:function(t){this._state.can_copycut!==t&&(this.toolbar.btnCopy.setDisabled(!t),this._state.can_copycut=t)},onApiBullets:function(t){var e=t.get_ListType();if(this._state.bullets.type!=e||this._state.bullets.subtype!=t.get_ListSubType()||this.toolbar.btnMarkers.pressed&&0!==e||this.toolbar.btnNumbers.pressed&&1!==e||this.toolbar.btnMultilevels.pressed&&2!==e)switch(this._state.bullets.type=e,this._state.bullets.subtype=t.get_ListSubType(),this._clearBullets(),this._state.bullets.type){case 0:this.toolbar.btnMarkers.toggle(!0,!0),this._state.bullets.subtype>0?this.toolbar.mnuMarkersPicker.selectByIndex(this._state.bullets.subtype,!0):this.toolbar.mnuMarkersPicker.deselectAll(!0),this.toolbar.mnuMultilevelPicker.deselectAll(!0),this.toolbar.mnuMarkerSettings&&this.toolbar.mnuMarkerSettings.setDisabled(this._state.bullets.subtype<0),this.toolbar.mnuMarkerChangeLevel&&this.toolbar.mnuMarkerChangeLevel.setDisabled(this._state.bullets.subtype<0),this.toolbar.mnuMultilevelSettings&&this.toolbar.mnuMultilevelSettings.setDisabled(this._state.bullets.subtype<0),this.toolbar.mnuMultiChangeLevel&&this.toolbar.mnuMultiChangeLevel.setDisabled(this._state.bullets.subtype<0);break;case 1:var i;switch(this._state.bullets.subtype){case 1:i=4;break;case 2:i=5;break;case 3:i=6;break;case 4:i=1;break;case 5:i=2;break;case 6:i=3;break;case 7:i=7}this.toolbar.btnNumbers.toggle(!0,!0),void 0!==i?this.toolbar.mnuNumbersPicker.selectByIndex(i,!0):this.toolbar.mnuNumbersPicker.deselectAll(!0),this.toolbar.mnuMultilevelPicker.deselectAll(!0),this.toolbar.mnuNumberSettings&&this.toolbar.mnuNumberSettings.setDisabled(0==i),this.toolbar.mnuNumberChangeLevel&&this.toolbar.mnuNumberChangeLevel.setDisabled(0==i),this.toolbar.mnuMultilevelSettings&&this.toolbar.mnuMultilevelSettings.setDisabled(0==i),this.toolbar.mnuMultiChangeLevel&&this.toolbar.mnuMultiChangeLevel.setDisabled(0==i);break;case 2:this.toolbar.btnMultilevels.toggle(!0,!0),this.toolbar.mnuMultilevelPicker.selectByIndex(this._state.bullets.subtype,!0)}},onApiParagraphAlign:function(t){if(this._state.pralign!==t){this._state.pralign=t;var e=this.toolbar;switch(t){case 0:2,"btn-align-right";break;case 1:0,"btn-align-left";break;case 2:1,"btn-align-center";break;case 3:3,"btn-align-just";break;default:-255,"btn-align-left"}if(null===t||void 0===t)return e.btnAlignRight.toggle(!1,!0),e.btnAlignLeft.toggle(!1,!0),e.btnAlignCenter.toggle(!1,!0),void e.btnAlignJust.toggle(!1,!0);e.btnAlignRight.toggle(0===t,!0),e.btnAlignLeft.toggle(1===t,!0),e.btnAlignCenter.toggle(2===t,!0),e.btnAlignJust.toggle(3===t,!0)}},onApiLineSpacing:function(t){var e=null===t.get_Line()||null===t.get_LineRule()||1!=t.get_LineRule()?-1:t.get_Line();if(this._state.linespace!==e){if(this._state.linespace=e,_.each(this.toolbar.mnuLineSpace.items,function(t){t.setChecked(!1,!0)}),e<0)return;Math.abs(e-1)<1e-4?this.toolbar.mnuLineSpace.items[0].setChecked(!0,!0):Math.abs(e-1.15)<1e-4?this.toolbar.mnuLineSpace.items[1].setChecked(!0,!0):Math.abs(e-1.5)<1e-4?this.toolbar.mnuLineSpace.items[2].setChecked(!0,!0):Math.abs(e-2)<1e-4?this.toolbar.mnuLineSpace.items[3].setChecked(!0,!0):Math.abs(e-2.5)<1e-4?this.toolbar.mnuLineSpace.items[4].setChecked(!0,!0):Math.abs(e-3)<1e-4&&this.toolbar.mnuLineSpace.items[5].setChecked(!0,!0)}},onApiPageSize:function(t,e){if(void 0!==this._state.pgorient){var i=this._state.pgorient?t:e,n=this._state.pgorient?e:t;(Math.abs(this._state.pgsize[0]-t)>.1||Math.abs(this._state.pgsize[1]-e)>.1)&&(this._state.pgsize=[t,e],this.toolbar.mnuPageSize&&(this.toolbar.mnuPageSize.clearAll(),_.each(this.toolbar.mnuPageSize.items,function(t){if(t.value&&"object"==typeof t.value&&Math.abs(t.value[0]-i)<.1&&Math.abs(t.value[1]-n)<.1)return t.setChecked(!0),!1},this)))}},onSectionProps:function(t){if(t){var e=t.get_LeftMargin(),i=t.get_TopMargin(),n=t.get_RightMargin(),o=t.get_BottomMargin();(!this._state.pgmargins||Math.abs(this._state.pgmargins[0]-i)>.1||Math.abs(this._state.pgmargins[1]-e)>.1||Math.abs(this._state.pgmargins[2]-o)>.1||Math.abs(this._state.pgmargins[3]-n)>.1)&&(this._state.pgmargins=[i,e,o,n],this.toolbar.btnPageMargins.menu&&(this.toolbar.btnPageMargins.menu.clearAll(),_.each(this.toolbar.btnPageMargins.menu.items,function(t){if(t.value&&"object"==typeof t.value&&Math.abs(t.value[0]-i)<.1&&Math.abs(t.value[1]-e)<.1&&Math.abs(t.value[2]-o)<.1&&Math.abs(t.value[3]-n)<.1)return t.setChecked(!0),!1},this)))}},onShowParaMarks:function(t){this.toolbar.mnuNonPrinting.items[0].setChecked(t,!0),this.toolbar.btnShowHidenChars.toggle(t,!0),Common.localStorage.setItem("de-show-hiddenchars",t)},onApiFocusObjectRestrictedEdit:function(t){if(this.editMode){for(var e,i=-1,n=!1,o=!1,s=!1,a=!1,r=void 0;++i<t.length;)e=t[i].get_ObjectType(),e===Asc.c_oAscTypeSelectElement.Paragraph?(r=t[i].get_ObjectValue(),n=t[i].get_ObjectValue().get_Locked()):e===Asc.c_oAscTypeSelectElement.Header?o=t[i].get_ObjectValue().get_Locked():e===Asc.c_oAscTypeSelectElement.Image&&(a=!0,s=t[i].get_ObjectValue().get_Locked());var l=!!r&&!r.can_DeleteBlockContentControl(),c=!!r&&!r.can_EditBlockContentControl(),d=!!r&&!r.can_DeleteInlineContentControl(),h=!!r&&!r.can_EditInlineContentControl(),p=!this.api.can_AddQuotedComment()||n||o||s||l||c||d||h;if(this.mode.compatibleFeatures&&(p=p||a),this.api.asc_IsContentControl()){var m=this.api.asc_GetContentControlProperties(),u=m?m.get_SpecificType():Asc.c_oAscContentControlSpecificType.None;p=p||u==Asc.c_oAscContentControlSpecificType.CheckBox||u==Asc.c_oAscContentControlSpecificType.Picture||u==Asc.c_oAscContentControlSpecificType.ComboBox||u==Asc.c_oAscContentControlSpecificType.DropDownList||u==Asc.c_oAscContentControlSpecificType.DateTime}this.btnsComment&&this.btnsComment.length>0&&this.btnsComment.setDisabled(p)}},onApiFocusObject:function(t){if(this.editMode){for(var e,i,n,o=-1,s=!1,a=!1,r=!1,l=!1,c=!1,d=void 0,h=!0,p=void 0,m=this.toolbar,u=!1,g=!1,b=!1,f=!1,C=!1,v=!1,y=!1;++o<t.length;)n=t[o].get_ObjectType(),e=t[o].get_ObjectValue(),n===Asc.c_oAscTypeSelectElement.Paragraph?(s=e.get_Locked(),l=e.get_CanAddTable(),c=e.get_CanAddImage(),p=e,i=e.get_Shade(),y=!0):n===Asc.c_oAscTypeSelectElement.Header?(a=e.get_Locked(),u=!0):n===Asc.c_oAscTypeSelectElement.Image?(C=!0,r=e.get_Locked(),e&&e.get_ChartProperties()&&(g=!0)):n===Asc.c_oAscTypeSelectElement.Math&&(b=!0,Asc.c_oAscMathInterfaceType.Common===e.get_Type()&&(f=!0)),n!==Asc.c_oAscTypeSelectElement.Table&&n!==Asc.c_oAscTypeSelectElement.Header&&n!==Asc.c_oAscTypeSelectElement.Image||(d=!1),!1!==d&&n==Asc.c_oAscTypeSelectElement.Paragraph&&(d=!0);i&&this.onParagraphColor(i);var x=!!p&&!p.can_DeleteBlockContentControl(),w=!!p&&!p.can_EditBlockContentControl(),S=!!p&&!p.can_DeleteInlineContentControl(),A=!!p&&!p.can_EditInlineContentControl(),k=s||a||w||A;this._state.prcontrolsdisable!=k&&(this._state.activated&&(this._state.prcontrolsdisable=k),_.each(m.paragraphControls,function(t){t.setDisabled(k)},this)),v=this.api.asc_IsContentControl();var T=v?this.api.asc_GetContentControlProperties():null,I=v&&T?T.get_Lock():Asc.c_oAscSdtLockType.Unlocked,P=!(!v||!T)&&T.get_ContentControlType()==Asc.c_oAscSdtLevelType.Inline;void 0===I&&(I=Asc.c_oAscSdtLockType.Unlocked);var M=I==Asc.c_oAscSdtLockType.SdtContentLocked||I==Asc.c_oAscSdtLockType.ContentLocked;if(m.btnContentControls.setDisabled(s||a),!s&&!a){for(var U=P||M,B=T&&T.get_FormPr(),o=0;o<7;o++)m.btnContentControls.menu.items[o].setDisabled(U);m.btnContentControls.menu.items[8].setDisabled(!v||I==Asc.c_oAscSdtLockType.SdtContentLocked||I==Asc.c_oAscSdtLockType.SdtLocked||B),m.btnContentControls.menu.items[10].setDisabled(!v||B)}var D=s||a||g||w||A;if(this._state.textonlycontrolsdisable!=D&&(this._state.activated&&(this._state.textonlycontrolsdisable=D),k||_.each(m.textOnlyControls,function(t){t.setDisabled(D)},this),m.btnClearStyle.setDisabled(D)),d&&p){var E=p.get_FramePr(),V=Asc.c_oAscDropCap.None;void 0!==E?(V=E.get_DropCap(),d=V===Asc.c_oAscDropCap.Drop||V===Asc.c_oAscDropCap.Margin,h=!1):d=p.get_CanAddDropCap(),d&&this.onDropCap(V)}k=k||!d||b||P,m.btnDropCap.setDisabled(k),m.btnDropCap.isDisabled()||m.mnuDropCapAdvanced.setDisabled(h),k=!l||a||b||P||w||A||x||S,m.btnInsertTable.setDisabled(k),k=m.mnuPageNumCurrentPos.isDisabled()&&m.mnuPageNumberPosPicker.isDisabled()||P,m.mnuInsertPageNum.setDisabled(k);var F=this.api.asc_IsCursorInFootnote()||this.api.asc_IsCursorInEndnote();if(k=s||a||u||C||b&&!f||F||v||w||A||x||S,m.btnsPageBreak.setDisabled(k),m.btnBlankPage.setDisabled(k),k=s||a||b||P||M||F,m.btnInsertShape.setDisabled(k),m.btnInsertText.setDisabled(k),k=s||a||y&&!c||b||P||x||S||M,m.btnInsertImage.setDisabled(k),m.btnInsertTextArt.setDisabled(k||F),g!==this._state.in_chart&&(m.btnInsertChart.updateHint(g?m.tipChangeChart:m.tipInsertChart),this._state.in_chart=g),k=g&&r||!g&&k||P||x||S||M,m.btnInsertChart.setDisabled(k),k=s||a||g||!c&&!b||P||w||A||x||S,m.btnInsertEquation.setDisabled(k),m.btnInsertSymbol.setDisabled(!y||s||a||w||A||x||S),m.btnInsDateTime.setDisabled(!y||s||a||w||A||x||S),k=s||a||b||w||A,m.btnSuperscript.setDisabled(k),m.btnSubscript.setDisabled(k),m.btnEditHeader.setDisabled(b),k=s||a||C||P||w||A||this._state.lock_doc,k!=m.btnColumns.isDisabled()&&m.btnColumns.setDisabled(k),m.btnLineNumbers.setDisabled(C&&y||this._state.lock_doc),m.listStylesAdditionalMenuItem&&void 0===p!==m.listStylesAdditionalMenuItem.isDisabled()&&m.listStylesAdditionalMenuItem.setDisabled(void 0===p),k=!this.api.can_AddQuotedComment()||s||a||r||x||w||S||A,this.mode.compatibleFeatures&&(k=k||C),T){var R=T.get_SpecificType();k=k||R==Asc.c_oAscContentControlSpecificType.CheckBox||R==Asc.c_oAscContentControlSpecificType.Picture||R==Asc.c_oAscContentControlSpecificType.ComboBox||R==Asc.c_oAscContentControlSpecificType.DropDownList||R==Asc.c_oAscContentControlSpecificType.DateTime}this.btnsComment&&this.btnsComment.length>0&&this.btnsComment.setDisabled(k),m.btnWatermark.setDisabled(a),p&&(this._state.suppress_num=!!p.get_SuppressLineNumbers()),this._state.in_equation=b}},onApiStyleChange:function(t){this.toolbar.btnCopyStyle.toggle(t,!0),this.modeAlwaysSetStyle=!1},onTableDraw:function(t){this.toolbar.mnuInsertTable&&this.toolbar.mnuInsertTable.items[2].setChecked(!!t,!0)},onTableErase:function(t){this.toolbar.mnuInsertTable&&this.toolbar.mnuInsertTable.items[3].setChecked(!!t,!0)},onApiParagraphStyleChange:function(t){if(this._state.prstyle!=t){var e=this.toolbar.listStyles;if(e.rendered){e.suspendEvents();var i=e.menuPicker.store.findWhere({title:t});this._state.prstyle=e.menuPicker.store.length>0||window.styles_loaded?t:void 0,e.menuPicker.selectRecord(i),e.resumeEvents()}}},onApiPageOrient:function(t){this._state.pgorient!==t&&(this.toolbar.btnPageOrient.menu.items[t?0:1].setChecked(!0),this._state.pgorient=t)},onApiLockDocumentProps:function(){!0!==this._state.lock_doc&&(this.toolbar.btnPageOrient.setDisabled(!0),this.toolbar.btnPageSize.setDisabled(!0),this.toolbar.btnPageMargins.setDisabled(!0),this._state.activated&&(this._state.lock_doc=!0))},onApiUnLockDocumentProps:function(){!1!==this._state.lock_doc&&(this.toolbar.btnPageOrient.setDisabled(!1),this.toolbar.btnPageSize.setDisabled(!1),this.toolbar.btnPageMargins.setDisabled(!1),this._state.activated&&(this._state.lock_doc=!1))},onApiLockDocumentSchema:function(){this.toolbar.btnColorSchemas.setDisabled(!0)},onApiUnLockDocumentSchema:function(){this.toolbar.btnColorSchemas.setDisabled(!1)},onApiLockHeaderFooters:function(){this.toolbar.mnuPageNumberPosPicker.setDisabled(!0),this.toolbar.mnuInsertPageNum.setDisabled(this.toolbar.mnuPageNumCurrentPos.isDisabled())},onApiUnLockHeaderFooters:function(){this.toolbar.mnuPageNumberPosPicker.setDisabled(!1),this.toolbar.mnuInsertPageNum.setDisabled(!1)},onApiZoomChange:function(t,e){},onApiStartHighlight:function(t){this.toolbar.btnHighlightColor.toggle(t,!0)},onApiHighlightColor:function(t){var e=this.api.get_TextProps().get_TextPr();e&&(t=e.get_HighLight(),-1==t?-1!=this._state.clrhighlight&&(this.toolbar.mnuHighlightTransparent.setChecked(!0,!0),this.toolbar.mnuHighlightColorPicker.cmpEl&&(this._state.clrhighlight=-1,this.toolbar.mnuHighlightColorPicker.select(null,!0))):null!==t?this._state.clrhighlight!=t.get_hex().toUpperCase()&&(this.toolbar.mnuHighlightTransparent.setChecked(!1),this._state.clrhighlight=t.get_hex().toUpperCase(),_.contains(this.toolbar.mnuHighlightColorPicker.colors,this._state.clrhighlight)&&this.toolbar.mnuHighlightColorPicker.select(this._state.clrhighlight,!0)):this._state.clrhighlight!==t&&(this.toolbar.mnuHighlightTransparent.setChecked(!1,!0),this.toolbar.mnuHighlightColorPicker.select(null,!0),this._state.clrhighlight=t))},onApiInitEditorStyles:function(t){this._onInitEditorStyles(t)},onChangeSdtGlobalSettings:function(){var t=this.api.asc_GetGlobalContentControlShowHighlight();if(this.toolbar.mnuNoControlsColor&&this.toolbar.mnuNoControlsColor.setChecked(!t,!0),this.toolbar.mnuControlsColorPicker&&this.toolbar.mnuControlsColorPicker.clearSelection(),t){var e=this.api.asc_GetGlobalContentControlHighlightColor();e&&(e=Common.Utils.ThemeColor.getHexColor(e.get_r(),e.get_g(),e.get_b()),this.toolbar.mnuControlsColorPicker&&this.toolbar.mnuControlsColorPicker.selectByRGB(e,!0))}},onNewDocument:function(t,e){this.api&&this.api.OpenNewDocument(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","New Document")},onOpenDocument:function(t,e){this.api&&this.api.LoadDocumentFromDisk(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Open Document")},onPrint:function(t){this.api&&this.api.asc_Print(new Asc.asc_CDownloadOptions(null,Common.Utils.isChrome||Common.Utils.isSafari||Common.Utils.isOpera||Common.Utils.isGecko&&Common.Utils.firefoxVersion>86)),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("Print"),Common.component.Analytics.trackEvent("ToolBar","Print")},onSave:function(t){var e=this.toolbar;if(this.api){var i=this.api.asc_isDocumentCanSave(),n=e.btnCollabChanges&&e.btnCollabChanges.cmpEl.hasClass("notify");if(!i&&!n&&!e.mode.forcesave)return;this.api.asc_Save()}e.btnSave.setDisabled(!e.mode.forcesave),Common.NotificationCenter.trigger("edit:complete",e),Common.component.Analytics.trackEvent("Save"),Common.component.Analytics.trackEvent("ToolBar","Save")},onBtnChangeState:function(t){if(/\:disabled$/.test(t)){var e=arguments[2];this.toolbar.fireEvent(t,[e])}},onUndo:function(t,e){this.api&&this.api.Undo(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Undo")},onRedo:function(t,e){this.api&&this.api.Redo(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Redo")},onCopyPaste:function(t,e){var i=this;if(i.api){(t?i.api.Copy():i.api.Paste())?Common.component.Analytics.trackEvent("ToolBar","Copy Warning"):Common.localStorage.getBool("de-hide-copywarning")||new Common.Views.CopyWarningDialog({handler:function(t){t&&Common.localStorage.setItem("de-hide-copywarning",1),Common.NotificationCenter.trigger("edit:complete",i.toolbar)}}).show()}Common.NotificationCenter.trigger("edit:complete",i.toolbar)},onIncrease:function(t){this.api&&this.api.FontSizeIn(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Font Size")},onDecrease:function(t){this.api&&this.api.FontSizeOut(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Font Size")},onBold:function(t,e){this._state.bold=void 0,this.api&&this.api.put_TextPrBold(t.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Bold")},onItalic:function(t,e){this._state.italic=void 0,this.api&&this.api.put_TextPrItalic(t.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Italic")},onUnderline:function(t,e){this._state.underline=void 0,this.api&&this.api.put_TextPrUnderline(t.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Underline")},onStrikeout:function(t,e){this._state.strike=void 0,this.api&&this.api.put_TextPrStrikeout(t.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Strikeout")},onSuperscript:function(t,e){this.toolbar.btnSubscript.pressed||(this._state.valign=void 0,this.api&&this.api.put_TextPrBaseline(t.pressed?1:0),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Superscript"))},onSubscript:function(t,e){this.toolbar.btnSuperscript.pressed||(this._state.valign=void 0,this.api&&this.api.put_TextPrBaseline(t.pressed?2:0),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Subscript"))},onDecOffset:function(t,e){this.api&&this.api.DecreaseIndent(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Indent")},onIncOffset:function(t,e){this.api&&this.api.IncreaseIndent(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Indent")},onHorizontalAlign:function(t,e,i){this._state.pralign=void 0,this.api&&(e.pressed||(t=1==t?3:1),this.api.put_PrAlign(t)),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Align")},onMarkers:function(t,e){var i={data:{type:0,subtype:t.pressed?0:-1}};this.onSelectBullets(null,null,null,i),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onNumbers:function(t,e){var i={data:{type:1,subtype:t.pressed?0:-1}};this.onSelectBullets(null,null,null,i),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onComboBlur:function(){Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onFontNameSelect:function(t,e){this.api&&(e.isNewFont?!Common.Utils.ModalWindow.isVisible()&&Common.UI.warning({width:500,closable:!1,msg:this.confirmAddFontName,buttons:["yes","no"],primary:"yes",callback:_.bind(function(t){"yes"==t?(this.api.put_TextPrFontName(e.name),Common.component.Analytics.trackEvent("ToolBar","Font Name")):this.toolbar.cmbFontName.setValue(this.api.get_TextProps().get_TextPr().get_FontFamily().get_Name()),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},this)}):(this.api.put_TextPrFontName(e.name),Common.component.Analytics.trackEvent("ToolBar","Font Name"))),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onComboOpen:function(t,e){_.delay(function(){var i=$("input",e.cmpEl).select();t?i.focus():e.isMenuOpen()||i.one("mouseup",function(t){t.preventDefault()})},10)},onFontSizeSelect:function(t,e){this._state.fontsize=void 0,this.api&&this.api.put_TextPrFontSize(e.value),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Font Size")},onFontSizeChanged:function(t,e,i,n){var o;if(t){if(!e.store.findWhere({displayValue:i.value})&&!(o=/^\+?(\d*(\.|,)?\d+)$|^\+?(\d+(\.|,)?\d*)$/.exec(i.value)))return o=this._getApiTextSize(),Common.UI.warning({msg:this.textFontSizeErr,callback:function(){_.defer(function(t){$("input",e.cmpEl).focus()})}}),e.setRawValue(o),n.preventDefault(),!1}else o=Common.Utils.String.parseFloat(i.value),o=o>300?300:o<1?1:Math.floor(2*(o+.4))/2,e.setRawValue(o),this._state.fontsize=void 0,this.api&&this.api.put_TextPrFontSize(o),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onChangeCase:function(t,e,i){this.api&&this.api.asc_ChangeTextCase(e.value),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onListShowAfter:function(t,e){var i=e.store,n=[];i.each(function(t){n.push(t.get("id"))}),this.api&&this.api.SetDrawImagePreviewBulletForMenu(n,t)},onSelectBullets:function(t,e,i,n){var o={};if(_.isFunction(n.toJSON)){if(!n.get("selected"))return;o=n.toJSON()}else o=n;t&&t.toggle(o.data.subtype>-1,!0),this._state.bullets.type=void 0,this._state.bullets.subtype=void 0,this.api&&this.api.put_ListType(o.data.type,o.data.subtype),Common.component.Analytics.trackEvent("ToolBar","List Type"),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onMarkerSettingsClick:function(t){var e=this,i=e.api.asc_GetCurrentNumberingId(),n=e.api.asc_GetCurrentNumberingLvl(),o=null!==i?e.api.asc_GetNumberingPr(i):null;o&&new DE.Views.ListSettingsDialog({api:e.api,props:o,level:n,type:t,interfaceLang:e.mode.lang,handler:function(t,n){"ok"==t&&e.api&&e.api.asc_ChangeNumberingLvl(i,n.props,n.num),Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}).show()},onChangeLevelShowAfter:function(t,e){var i=this,n=i.api.asc_GetCurrentNumberingId(),o=i.api.asc_GetCurrentNumberingLvl(),s=null!==n?i.api.asc_GetNumberingPr(n):null,a=_.find(e.items,function(t){return t.options.level==o});e.clearAll(),a&&a.setChecked(!0),s&&this.api.SetDrawImagePreviewBulletChangeListLevel(e.options.previewIds,s)},onChangeLevelClick:function(t,e,i){this.api&&this.api.asc_SetNumberingLvl(i.options.level),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onLineSpaceToggle:function(t,e,i,n){i&&(this._state.linespace=void 0,this.api&&this.api.put_PrLineSpacing(c_paragraphLinerule.LINERULE_AUTO,e.value),Common.component.Analytics.trackEvent("ToolBar","Line Spacing"),Common.NotificationCenter.trigger("edit:complete",this.toolbar))},onMenuNonPrintingToggle:function(t,e,i,n){var o=this;"characters"===e.value?(Common.localStorage.setItem("de-show-hiddenchars",i),o.toolbar.btnShowHidenChars.toggle(i,!0),o.api&&o.api.put_ShowParaMarks(i),Common.NotificationCenter.trigger("edit:complete",o),Common.component.Analytics.trackEvent("ToolBar","Hidden Characters")):"table"===e.value&&(Common.localStorage.setItem("de-show-tableline",i),o.api&&o.api.put_ShowTableEmptyLine(i),Common.NotificationCenter.trigger("edit:complete",o))},onNonPrintingToggle:function(t,e){var i=this;e?(i.toolbar.mnuNonPrinting.items[0].setChecked(!0,!0),Common.component.Analytics.trackEvent("ToolBar","Hidden Characters")):i.toolbar.mnuNonPrinting.items[0].setChecked(!1,!0),i.api&&i.api.put_ShowParaMarks(e),Common.localStorage.setItem("de-show-hiddenchars",e),Common.NotificationCenter.trigger("edit:complete",i)},onClickPageBreak:function(t,e){"column"===t?(this.api.put_AddColumnBreak(),Common.component.Analytics.trackEvent("ToolBar","Column Break")):"page"==t?(this.api.put_AddPageBreak(),Common.component.Analytics.trackEvent("ToolBar","Page Break")):(this.api.add_SectionBreak(t),Common.component.Analytics.trackEvent("ToolBar","Section Break")),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onTablePickerSelect:function(t,e,i,n){this.api&&(this.toolbar.fireEvent("inserttable",this.toolbar),this.api.put_Table(e,i)),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Table")},onInsertTableShow:function(t){var e=this.api.asc_GetSelectedText();t.items[4].setDisabled(!e||e.length<1)},onInsertTableClick:function(t,e,i){var n=this;"custom"===e.value?new Common.Views.InsertTableDialog({handler:function(t,e){"ok"==t&&(n.api&&(n.toolbar.fireEvent("inserttable",n.toolbar),n.api.put_Table(e.columns,e.rows)),Common.component.Analytics.trackEvent("ToolBar","Table")),Common.NotificationCenter.trigger("edit:complete",n.toolbar)}}).show():"draw"==e.value?(e.isChecked()&&t.items[3].setChecked(!1,!0),this.api.SetTableDrawMode(e.isChecked())):"erase"==e.value?(e.isChecked()&&t.items[2].setChecked(!1,!0),this.api.SetTableEraseMode(e.isChecked())):"convert"==e.value&&new DE.Views.TextToTableDialog({props:this.api.asc_PreConvertTextToTable(),handler:function(t,e){"ok"==t&&n.api&&n.api.asc_ConvertTextToTable(e),Common.NotificationCenter.trigger("edit:complete",n.toolbar)}}).show()},onInsertImageClick:function(t,e,i){var n=this;"file"===e.value?(this.toolbar.fireEvent("insertimage",this.toolbar),this.api&&setTimeout(function(){n.api.asc_addImage()},1),Common.NotificationCenter.trigger("edit:complete",n.toolbar),Common.component.Analytics.trackEvent("ToolBar","Image")):"url"===e.value?new Common.Views.ImageFromUrlDialog({handler:function(t,e){if("ok"==t){if(n.api){var i=e.replace(/ /g,"");_.isEmpty(i)?Common.UI.warning({msg:this.textEmptyImgUrl}):(n.toolbar.fireEvent("insertimage",n.toolbar),n.api.AddImageUrl(i),Common.component.Analytics.trackEvent("ToolBar","Image"))}Common.NotificationCenter.trigger("edit:complete",n.toolbar)}}}).show():"storage"===e.value&&Common.NotificationCenter.trigger("storage:image-load","add")},openImageFromStorage:function(t){var e=this;this.toolbar.mode.canRequestInsertImage?Common.Gateway.requestInsertImage(t):new Common.Views.SelectFileDlg({fileChoiceUrl:this.toolbar.mode.fileChoiceUrl.replace("{fileExt}","").replace("{documentType}","ImagesOnly")}).on("selectfile",function(i,n){n&&(n.c=t),e.insertImage(n)}).show()},insertImageFromStorage:function(t){!t||!t.url||t.c&&"add"!=t.c||(this.toolbar.fireEvent("insertimage",this.toolbar),this.api.AddImageUrl(t.url,void 0,t.token),Common.component.Analytics.trackEvent("ToolBar","Image"))},insertImage:function(t){Common.NotificationCenter.trigger("storage:image-insert",t)},onBtnInsertTextClick:function(t,e){this.api&&this._addAutoshape(t.pressed,"textRect"),this.toolbar.btnInsertShape.pressed&&this.toolbar.btnInsertShape.toggle(!1,!0),Common.NotificationCenter.trigger("edit:complete",this.toolbar,this.toolbar.btnInsertShape),Common.component.Analytics.trackEvent("ToolBar","Add Text")},onInsertShapeHide:function(t,e){this.toolbar.btnInsertShape.pressed&&!this._isAddingShape&&this.toolbar.btnInsertShape.toggle(!1,!0),this._isAddingShape=!1,Common.NotificationCenter.trigger("edit:complete",this.toolbar,this.toolbar.btnInsertShape)},onPageOrientSelect:function(t,e){this._state.pgorient=void 0,this.api&&e.checked&&this.api.change_PageOrient(e.value),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Page Orientation")},onClearStyleClick:function(t,e){this.api&&this.api.ClearFormating(),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onCopyStyleToggle:function(t,e,i){this.api&&this.api.SetPaintFormat(e?1:0),Common.NotificationCenter.trigger("edit:complete",this.toolbar),this.modeAlwaysSetStyle=e},onPageSizeClick:function(t,e,i){if(this.api&&i){if(this._state.pgsize=[0,0],"advanced"!==e.value)this.api.change_DocSize(e.value[0],e.value[1]);else{var n,o,s=this;n=new DE.Views.PageSizeDialog({handler:function(t,e){"ok"==e&&(o=t.getSettings(),s.api.change_DocSize(o[0],o[1]),Common.NotificationCenter.trigger("edit:complete",s.toolbar))}}),n.show(),n.setSettings(s.api.asc_GetSectionProps())}Common.component.Analytics.trackEvent("ToolBar","Page Size")}Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onPageMarginsSelect:function(t,e){if(this.api){if(this._state.pgmargins=void 0,"advanced"!==e.value){var i=this.api.asc_GetSectionProps(),n=null,o=this;if(e.value[1]+e.value[3]>parseFloat(i.get_W().toFixed(4))-12.7?n=this.txtMarginsW:e.value[0]+e.value[2]>parseFloat(i.get_H().toFixed(4))-2.6&&(n=this.txtMarginsH),n)return Common.UI.warning({title:this.notcriticalErrorTitle,msg:n,callback:function(){Common.NotificationCenter.trigger("edit:complete",o.toolbar)}}),void this.onSectionProps(i);var s=new Asc.CDocumentSectionProps;s.put_TopMargin(e.value[0]),s.put_LeftMargin(e.value[1]),s.put_BottomMargin(e.value[2]),s.put_RightMargin(e.value[3]),this.api.asc_SetSectionProps(s)}else{var a,s,o=this;a=new DE.Views.PageMarginsDialog({api:o.api,handler:function(t,e){if("ok"==e){s=t.getSettings();var i=o.toolbar.btnPageMargins.menu.items[0];i.setVisible(!0),i.setChecked(!0),i.options.value=i.value=[s.get_TopMargin(),s.get_LeftMargin(),s.get_BottomMargin(),s.get_RightMargin()],$(i.el).html(i.template({id:Common.UI.getId(),caption:i.caption,options:i.options})),Common.localStorage.setItem("de-pgmargins-top",s.get_TopMargin()),Common.localStorage.setItem("de-pgmargins-left",s.get_LeftMargin()),Common.localStorage.setItem("de-pgmargins-bottom",s.get_BottomMargin()),Common.localStorage.setItem("de-pgmargins-right",s.get_RightMargin()),o.api.asc_SetSectionProps(s),Common.NotificationCenter.trigger("edit:complete",o.toolbar)}}}),a.show(),a.setSettings(o.api.asc_GetSectionProps())}Common.component.Analytics.trackEvent("ToolBar","Page Margins")}Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onLineNumbersSelect:function(t,e){if(!_.isUndefined(e.value)){switch(e.value){case 0:this._state.linenum=void 0,this.api.asc_SetLineNumbersProps(Asc.c_oAscSectionApplyType.Current,null);break;case 1:case 2:case 3:if(this._state.linenum=void 0,this.api&&e.checked){var i=new Asc.CSectionLnNumType;i.put_Restart(1==e.value?Asc.c_oAscLineNumberRestartType.Continuous:2==e.value?Asc.c_oAscLineNumberRestartType.NewPage:Asc.c_oAscLineNumberRestartType.NewSection),!!this.api.asc_GetLineNumbersProps()&&i.put_CountBy(void 0),this.api.asc_SetLineNumbersProps(Asc.c_oAscSectionApplyType.Current,i)}break;case 4:this.api&&this.api.asc_SetParagraphSuppressLineNumbers(e.checked);break;case 5:var n,o=this;n=new DE.Views.LineNumbersDialog({applyTo:o._state.linenum_apply,handler:function(t,e){if("ok"==e){var i=t.getSettings();o.api.asc_SetLineNumbersProps(i.type,i.props),o._state.linenum_apply=i.type,Common.NotificationCenter.trigger("edit:complete",o.toolbar)}}}),n.show(),n.setSettings(o.api.asc_GetLineNumbersProps())}Common.NotificationCenter.trigger("edit:complete",this.toolbar)}},onLineNumbersProps:function(t){var e=0;if(t)switch(t.get_Restart()){case Asc.c_oAscLineNumberRestartType.Continuous:e=1;break;case Asc.c_oAscLineNumberRestartType.NewPage:e=2;break;case Asc.c_oAscLineNumberRestartType.NewSection:e=3}this._state.linenum!==e&&(this.toolbar.btnLineNumbers.menu.items[e].setChecked(!0),this._state.linenum=e)},onLineNumbersShow:function(t){t.items[4].setChecked(this._state.suppress_num)},onColorSchemaClick:function(t,e){this.api&&(this.api.asc_ChangeColorSchemeByIdx(e.value),Common.component.Analytics.trackEvent("ToolBar","Color Scheme")),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onColorSchemaShow:function(t){if(this.api){var e=this.api.asc_GetCurrentColorSchemeIndex(),i=_.find(t.items,function(t){return t.value==e});i?i.setChecked(!0):t.clearAll()}},onDropCapSelect:function(t,e){if(!_.isUndefined(e.value)){if(this._state.dropcap=void 0,this.api&&e.checked)if(e.value===Asc.c_oAscDropCap.None)this.api.removeDropcap(!0);else for(var i=this.api.getSelectedElements(),n=-1;++n<i.length;)if(i[n].get_ObjectType()==Asc.c_oAscTypeSelectElement.Paragraph){var o=i[n].get_ObjectValue(),s=o.get_FramePr();_.isUndefined(s)?this.api.asc_addDropCap(e.value===Asc.c_oAscDropCap.Drop):(s=new Asc.asc_CParagraphFrame,s.put_FromDropCapMenu(!0),s.put_DropCap(e.value),this.api.put_FramePr(s));break}Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Drop Cap")}},onDropCap:function(t){
if(this._state.dropcap!==t){var e=-1;switch(t){case Asc.c_oAscDropCap.None:e=0;break;case Asc.c_oAscDropCap.Drop:e=1;break;case Asc.c_oAscDropCap.Margin:e=2}e<0?this.toolbar.btnDropCap.menu.clearAll():this.toolbar.btnDropCap.menu.items[e].setChecked(!0),this._state.dropcap=t}},onDropCapAdvancedClick:function(t){var e,i=this;if(!t&&_.isUndefined(i.fontstore)){i.fontstore=new Common.Collections.Fonts;var n=i.toolbar.cmbFontName.store.toJSON(),o=[];_.each(n,function(t,e){t.cloneid||o.push(_.clone(t))}),i.fontstore.add(o)}if(i.api){var s=i.api.getSelectedElements(),a=s.length;if(s&&_.isArray(s))for(var r=0;r<a;r++)if(s[r].get_ObjectType()==Asc.c_oAscTypeSelectElement.Paragraph){e=s[r].get_ObjectValue();break}e&&new DE.Views.DropcapSettingsAdvanced({tableStylerRows:2,tableStylerColumns:1,fontStore:t?null:i.fontstore,paragraphProps:e,borderProps:i.borderAdvancedProps,api:i.api,isFrame:!!t,handler:function(e,n){"ok"==e&&(i.borderAdvancedProps=n.borderProps,n.paragraphProps&&(!t&&n.paragraphProps.get_DropCap()===Asc.c_oAscDropCap.None||t&&n.paragraphProps.get_Wrap()===c_oAscFrameWrap.None)?i.api.removeDropcap(!t):i.api.put_FramePr(n.paragraphProps)),Common.NotificationCenter.trigger("edit:complete",i.toolbar)}}).show()}},onControlsSelect:function(t,e){if(this.mode&&this.mode.canFeatureContentControl){if("settings"==e.value||"remove"==e.value){if(this.api.asc_IsContentControl()){var i=this.api.asc_GetContentControlProperties();if(i){var n=i.get_InternalId();if("settings"==e.value){var o=this;new DE.Views.ControlSettingsDialog({props:i,api:o.api,controlLang:o._state.lang,interfaceLang:o.mode.lang,handler:function(t,e){"ok"==t&&o.api.asc_SetContentControlProperties(e,n),Common.NotificationCenter.trigger("edit:complete",o.toolbar)}}).show()}else this.api.asc_RemoveContentControlWrapper(n),Common.component.Analytics.trackEvent("ToolBar","Remove Content Control")}}}else{var s,a,r=0==e.value.indexOf("new-");r&&(a=new AscCommon.CSdtFormPr,this.toolbar.fireEvent("insertcontrol",this.toolbar)),"plain"==e.value||"rich"==e.value?this.api.asc_AddContentControl("plain"==e.value?Asc.c_oAscSdtLevelType.Inline:Asc.c_oAscSdtLevelType.Block):e.value.indexOf("picture")>=0?this.api.asc_AddContentControlPicture(a):e.value.indexOf("checkbox")>=0||e.value.indexOf("radiobox")>=0?(r&&(s=new AscCommon.CSdtCheckBoxPr,e.value.indexOf("radiobox")>=0&&s.put_GroupKey(this.textGroup+" 1")),this.api.asc_AddContentControlCheckBox(s,a)):"date"==e.value?this.api.asc_AddContentControlDatePicker():e.value.indexOf("combobox")>=0||e.value.indexOf("dropdown")>=0?this.api.asc_AddContentControlList(e.value.indexOf("combobox")>=0,s,a):"new-field"==e.value&&(s=new AscCommon.CSdtTextFormPr,this.api.asc_AddContentControlTextForm(s,a)),Common.component.Analytics.trackEvent("ToolBar","Add Content Control")}Common.NotificationCenter.trigger("edit:complete",this.toolbar)}},onNewControlsColor:function(t,e){this.toolbar.mnuControlsColorPicker.addNewColor()},onNoControlsColor:function(t){t.isChecked()?this.api.asc_SetGlobalContentControlShowHighlight(!1):this.api.asc_SetGlobalContentControlShowHighlight(!0,220,220,220)},onSelectControlsColor:function(t,e){var i=Common.Utils.ThemeColor.getRgbColor(e);this.api&&this.api.asc_SetGlobalContentControlShowHighlight(!0,i.get_r(),i.get_g(),i.get_b()),Common.component.Analytics.trackEvent("ToolBar","Content Controls Color")},onColumnsSelect:function(t,e){if(!_.isUndefined(e.value)){if(this._state.columns=void 0,this.api)if("advanced"==e.value){var i,n=this;i=new DE.Views.CustomColumnsDialog({handler:function(t,e){"ok"==e&&(o=t.getSettings(),n.api.asc_SetColumnsProps(o),Common.NotificationCenter.trigger("edit:complete",n.toolbar))}}),i.show(),i.setSettings(n.api.asc_GetColumnsProps())}else if(e.checked){var o=new Asc.CDocumentColumnsProps,s=e.value;if(o.put_EqualWidth(s<3),s<3)o.put_Num(s+1),o.put_Space(12.5);else{var a=this.api.asc_GetColumnsProps().get_TotalWidth(),r=(a-25)/3,l=a-12.5-r;o.put_ColByValue(0,3==s?r:l,12.5),o.put_ColByValue(1,3==s?l:r,0)}this.api.asc_SetColumnsProps(o)}Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Insert Columns")}},onColumnsProps:function(t){if(t){var e=t.get_EqualWidth(),i=e?t.get_Num():t.get_ColsCount(),n=-1;if(e&&i<4&&(1==i||Math.abs(t.get_Space()-12.5)<.1))n=i-1;else if(!e&&2==i){var o=t.get_Col(0).get_W(),s=t.get_Col(0).get_Space(),a=t.get_Col(1).get_W(),r=t.get_TotalWidth();if(Math.abs(s-12.5)<.1){var l=(r-2*s)/3;o<a&&Math.abs(o-l)<.1?n=3:o>a&&Math.abs(a-l)<.1&&(n=4)}}if(this._state.columns===n)return;n<0?this.toolbar.btnColumns.menu.clearAll():this.toolbar.btnColumns.menu.items[n].setChecked(!0),this._state.columns=n}},onSelectChart:function(t){var e=this,i=!1,n=e.api.getSelectedElements();if(n&&_.isArray(n))for(var o=0;o<n.length;o++)if(Asc.c_oAscTypeSelectElement.Image==n[o].get_ObjectType()){var s=n[o].get_ObjectValue().get_ChartProperties();if(s){i=s;break}}if(i){(t==Asc.c_oAscChartTypeSettings.comboBarLine||t==Asc.c_oAscChartTypeSettings.comboBarLineSecondary||t==Asc.c_oAscChartTypeSettings.comboAreaBar||t==Asc.c_oAscChartTypeSettings.comboCustom)&&i.getSeries().length<2?Common.NotificationCenter.trigger("showerror",Asc.c_oAscError.ID.ComboSeriesError,Asc.c_oAscError.Level.NoCritical):i.changeType(t),Common.NotificationCenter.trigger("edit:complete",this.toolbar)}else{var a=this.getApplication().getController("Common.Controllers.ExternalDiagramEditor");this.diagramEditor||(this.diagramEditor=a.getView("Common.Views.ExternalDiagramEditor")),this.diagramEditor&&e.api&&(this.diagramEditor.setEditMode(!1),a.showExternalEditor(),i=e.api.asc_getChartObject(t),i&&this.diagramEditor.setChartData(new Asc.asc_CChartBinary(i)),e.toolbar.fireEvent("insertchart",e.toolbar))}},onInsertTextart:function(t){this.api&&(this.toolbar.fireEvent("inserttextart",this.toolbar),this.api.AddTextArt(t),this.toolbar.btnInsertShape.pressed&&this.toolbar.btnInsertShape.toggle(!1,!0),Common.NotificationCenter.trigger("edit:complete",this.toolbar,this.toolbar.btnInsertTextArt),Common.component.Analytics.trackEvent("ToolBar","Add Text Art"))},onInsertPageNumberClick:function(t,e,i){this.api&&this.api.put_PageNum(i.get("data").type,i.get("data").subtype),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Page Number")},onInsertPageCountClick:function(t,e){this.api&&this.api.asc_AddPageCount(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Pages Count")},onEditHeaderFooterClick:function(t,e){if(this.api){if("header"==e.value)this.api.GoToHeader(this.api.getCurrentPage());else{if("footer"!=e.value)return;this.api.GoToFooter(this.api.getCurrentPage())}Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Edit "+e.value)}},onPageNumCurrentPosClick:function(t,e){this.api&&this.api.put_PageNum(-1),"click"!==e.type&&this.toolbar.btnEditHeader.menu.hide(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Page Number")},onBtnBlankPageClick:function(t){this.api&&this.api.asc_AddBlankPage(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Blank Page")},onWatermarkSelect:function(t,e){if(this.api){if("remove"==e.value)this.api.asc_WatermarkRemove();else{var i=this;if(_.isUndefined(i.fontstore)){i.fontstore=new Common.Collections.Fonts;var n=i.toolbar.cmbFontName.store.toJSON(),o=[];_.each(n,function(t,e){t.cloneid||o.push(_.clone(t))}),i.fontstore.add(o)}new DE.Views.WatermarkSettingsDialog({props:i.api.asc_GetWatermarkProps(),api:i.api,lang:i.mode.lang,storage:i.mode.canRequestInsertImage||i.mode.fileChoiceUrl&&i.mode.fileChoiceUrl.indexOf("{documentType}")>-1,fontStore:i.fontstore,handler:function(t,e){"ok"==t&&i.api.asc_SetWatermarkProps(e),Common.NotificationCenter.trigger("edit:complete",i.toolbar)}}).show()}Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Edit "+e.value)}},onListStyleSelect:function(t,e){this._state.prstyle=void 0,this.api&&this.api.put_Style(e.get("title")),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Style")},onListStyleBeforeHide:function(t,e){this.toolbar.listStyles.isStylesNotClosable=!1},onListStyleContextMenu:function(t,e,i){if(this.toolbar.mode.canEditStyles){var n,o=this.toolbar.styleMenu,s=this.api,a=!0,r=!0;_.each(window.styles.get_MergedStyles(),function(t){s.asc_IsStyleDefault(t.get_Name())?s.asc_IsDefaultStyleChanged(t.get_Name())&&(r=!1):a=!1}),o.items[3].setDisabled(r),o.items[4].setDisabled(a);var l=this.toolbar.$el.offset(),c=i.clientY*Common.Utils.zoom();if($("#header-container").is(":visible")&&(c-=$("#header-container").height()),n=[i.clientX*Common.Utils.zoom(),c-l.top],void 0!=e){var d=this.api.asc_IsStyleDefault(e.get("title"));o.items[0].setVisible(!0),o.items[1].setVisible(!d),o.items[2].setVisible(d),o.items[3].setVisible(d),o.items[4].setVisible(!d),o.items[2].setDisabled(!this.api.asc_IsDefaultStyleChanged(e.get("title")));for(var h in o.items)o.items[h].styleTitle=e.get("title");var p=s.getSelectedElements(),m=!1;if(p&&_.isArray(p))for(var h=0;h<p.length;h++)if(Asc.c_oAscTypeSelectElement.Paragraph==p[h].get_ObjectType()){m=!0;break}o.items[0].setDisabled(!m)}else o.items[0].setVisible(!1),o.items[1].setVisible(!1),o.items[2].setVisible(!1),o.items[3].setVisible(!0),o.items[4].setVisible(!0);if(void 0!=n){var u=this.toolbar.$el.find("#menu-style-container");o.rendered||(u.length<1&&(u=$('<div id="menu-style-container" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',o.id),$(this.toolbar.el).append(u)),o.render(u),o.cmpEl.attr({tabindex:"-1"})),u.css({left:n[0],top:n[1]});var g=$(o.el);g.trigger($.Event("show.bs.dropdown")),g.trigger($.Event("hide.bs.dropdown")),o.isVisible()&&$(o).toggleClass("open").trigger("shown.bs.dropdown"),this.toolbar.listStyles.isStylesNotClosable=!0,o.show()}}},onSaveStyle:function(t){window.styles_loaded=!1;var e,i=this;if(i.api){var n=function(e,n){if("ok"==n){var o=e.getTitle(),s=e.getNextStyle(),a=t.get_Link();i._state.prstyle=o,t.put_Name(o),a.put_Name(o+"_character"),t.put_Next(s?s.asc_getName():null),i.api.asc_AddNewStyle(t)}Common.NotificationCenter.trigger("edit:complete",i.toolbar)},o=[],s=i.getApplication().getController("Main");_.each(window.styles.get_MergedStyles(),function(t){o.push({value:t,displayValue:s.translationTable[t.get_Name()]||t.get_Name()})}),e=new DE.Views.StyleTitleDialog({handler:n,formats:o}),e.show()}Common.component.Analytics.trackEvent("ToolBar","Save as Style")},onMenuSaveStyle:function(t,e){var i=this;i.api&&!i.toolbar.listStylesAdditionalMenuItem.isDisabled()&&i.onSaveStyle(i.api.asc_GetStyleFromFormatting())},onUpdateStyle:function(t){this.api&&(t.put_Name(this._state.prstyle),this.api.asc_AddNewStyle(t))},_clearBullets:function(){this.toolbar.btnMarkers.toggle(!1,!0),this.toolbar.btnNumbers.toggle(!1,!0),this.toolbar.btnMultilevels.toggle(!1,!0),this.toolbar.mnuMarkersPicker.selectByIndex(0,!0),this.toolbar.mnuNumbersPicker.selectByIndex(0,!0),this.toolbar.mnuMultilevelPicker.selectByIndex(0,!0),this.toolbar.mnuMarkerSettings&&this.toolbar.mnuMarkerSettings.setDisabled(!0),this.toolbar.mnuNumberSettings&&this.toolbar.mnuNumberSettings.setDisabled(!0),this.toolbar.mnuMultilevelSettings&&this.toolbar.mnuMultilevelSettings.setDisabled(!0),this.toolbar.mnuMarkerChangeLevel&&this.toolbar.mnuMarkerChangeLevel.setDisabled(!0),this.toolbar.mnuNumberChangeLevel&&this.toolbar.mnuNumberChangeLevel.setDisabled(!0),this.toolbar.mnuMultiChangeLevel&&this.toolbar.mnuMultiChangeLevel.setDisabled(!0)},_getApiTextSize:function(){var t=12,e=this.api.get_TextProps();return e&&e.get_TextPr&&(t=e.get_TextPr().get_FontSize()),t},onNewFontColor:function(t,e){this.toolbar.mnuFontColorPicker.addNewColor()},onAutoFontColor:function(t){this._state.clrtext=this._state.clrtext_asccolor=void 0;var e=new Asc.asc_CColor;e.put_auto(!0),this.api.put_TextColor(e),this.toolbar.btnFontColor.currentColor={color:e,isAuto:!0},this.toolbar.btnFontColor.setColor("000"),this.toolbar.mnuFontColorPicker.clearSelection(),this.toolbar.mnuFontColorPicker.currentColor={color:e,isAuto:!0}},onNewParagraphColor:function(t,e){this.toolbar.mnuParagraphColorPicker.addNewColor()},onSelectHighlightColor:function(t,e){this._setMarkerColor(e,"menu")},onSelectFontColor:function(t,e){this._state.clrtext=this._state.clrtext_asccolor=void 0,this.toolbar.btnFontColor.currentColor=e,this.toolbar.btnFontColor.setColor("object"==typeof e?e.isAuto?"000":e.color:e),this.toolbar.mnuFontColorPicker.currentColor=e,this.api&&this.api.put_TextColor(e.isAuto?e.color:Common.Utils.ThemeColor.getRgbColor(e)),Common.component.Analytics.trackEvent("ToolBar","Text Color")},onParagraphColorPickerSelect:function(t,e){this._state.clrback=this._state.clrshd_asccolor=void 0,this.toolbar.btnParagraphColor.currentColor=e,this.toolbar.btnParagraphColor.setColor(e),this.toolbar.mnuParagraphColorPicker.currentColor=e,this.api&&("transparent"==e?this.api.put_ParagraphShade(!1):this.api.put_ParagraphShade(!0,Common.Utils.ThemeColor.getRgbColor(e))),Common.NotificationCenter.trigger("edit:complete",this)},onBtnHighlightColor:function(t){t.pressed?(this._setMarkerColor(t.currentColor),Common.component.Analytics.trackEvent("ToolBar","Highlight Color")):this.api.SetMarkerFormat(!1)},onBtnFontColor:function(){this.toolbar.mnuFontColorPicker.trigger("select",this.toolbar.mnuFontColorPicker,this.toolbar.mnuFontColorPicker.currentColor)},onBtnParagraphColor:function(){this.toolbar.mnuParagraphColorPicker.trigger("select",this.toolbar.mnuParagraphColorPicker,this.toolbar.mnuParagraphColorPicker.currentColor)},onHighlightTransparentClick:function(t,e){this._setMarkerColor("transparent","menu"),t.setChecked(!0,!0),this.toolbar.btnHighlightColor.currentColor="transparent",this.toolbar.btnHighlightColor.setColor(this.toolbar.btnHighlightColor.currentColor)},onParagraphColor:function(t){var e,i=this.toolbar.mnuParagraphColorPicker;if(null!==t&&void 0!==t&&t.get_Value()===Asc.c_oAscShdClear){var n=t.get_Color();e=n?n.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(n.get_r(),n.get_g(),n.get_b()),effectValue:n.get_value()}:Common.Utils.ThemeColor.getHexColor(n.get_r(),n.get_g(),n.get_b()):"transparent"}else e="transparent";var o=typeof e;if(o!==typeof this._state.clrback||"object"==o&&(e.effectValue!==this._state.clrback.effectValue||this._state.clrback.color.indexOf(e.color)<0)||"object"!=o&&this._state.clrback.indexOf(e)<0){if("object"==typeof e){for(var s=!1,a=0;a<10;a++)if(Common.Utils.ThemeColor.ThemeValues[a]==e.effectValue){i.select(e,!0),s=!0;break}s||i.clearSelection()}else i.select(e,!0);this._state.clrback=e}this._state.clrshd_asccolor=t},onApiTextColor:function(t){if(t.get_auto()){if("auto"!==this._state.clrtext){this.toolbar.mnuFontColorPicker.clearSelection();var e=this.toolbar.btnFontColor.menu.$el.find("#id-toolbar-menu-auto-fontcolor > a");!e.hasClass("selected")&&e.addClass("selected"),this._state.clrtext="auto"}}else{var i,n=this.toolbar.mnuFontColorPicker;t&&(i=t.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(t.get_r(),t.get_g(),t.get_b()),effectValue:t.get_value()}:Common.Utils.ThemeColor.getHexColor(t.get_r(),t.get_g(),t.get_b()));var o=typeof i,s=typeof this._state.clrtext;if("auto"==this._state.clrtext||o!==s||"object"==o&&(i.effectValue!==this._state.clrtext.effectValue||this._state.clrtext.color.indexOf(i.color)<0)||"object"!=o&&this._state.clrtext.indexOf(i)<0){var e=this.toolbar.btnFontColor.menu.$el.find("#id-toolbar-menu-auto-fontcolor > a");if(e.hasClass("selected")&&e.removeClass("selected"),"object"==typeof i){for(var a=!1,r=0;r<10;r++)if(Common.Utils.ThemeColor.ThemeValues[r]==i.effectValue){n.select(i,!0),a=!0;break}a||n.clearSelection()}else n.select(i,!0);this._state.clrtext=i}}this._state.clrtext_asccolor=t},onApiAutoShapes:function(){var t=this,e=function(i){t.fillAutoShapes(),i.off("show:before",e)};t.toolbar.btnInsertShape.menu.on("show:before",e)},fillAutoShapes:function(){var t=this,e=this.getApplication().getCollection("ShapeGroups"),i=function(n){for(var o=0;o<e.length;o++){new Common.UI.DataViewSimple({el:$("#id-toolbar-menu-shapegroup"+o,n.items[o].$el),store:e.at(o).get("groupStore"),parentMenu:n.items[o].menu,itemTemplate:_.template('<div class="item-shape" id="<%= id %>"><svg width="20" height="20" class="icon"><use xlink:href="#svg-icon-<%= data.shapeType %>"></use></svg></div>')}).on("item:click",function(e,i,n,o){t.api&&(n&&(t._addAutoshape(!0,n.get("data").shapeType),t._isAddingShape=!0),t.toolbar.btnInsertText.pressed&&t.toolbar.btnInsertText.toggle(!1,!0),"click"!==o.type&&t.toolbar.btnInsertShape.menu.hide(),Common.NotificationCenter.trigger("edit:complete",t.toolbar,t.toolbar.btnInsertShape),Common.component.Analytics.trackEvent("ToolBar","Add Shape"))})}n.off("show:after",i)};t.toolbar.btnInsertShape.menu.on("show:after",i);for(var n=0;n<e.length;n++){var o=e.at(n),s=new Common.UI.MenuItem({caption:o.get("groupName"),menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{template:_.template('<div id="id-toolbar-menu-shapegroup'+n+'" class="menu-shape" style="width: '+(o.get("groupWidth")-8)+'px; margin-left: 5px;"></div>')}]})});t.toolbar.btnInsertShape.menu.addItem(s)}},fillEquations:function(){if(this.toolbar.btnInsertEquation.rendered&&!(this.toolbar.btnInsertEquation.menu.items.length>0)){var t=this,e=this.getApplication().getCollection("EquationGroups");t.toolbar.btnInsertEquation.menu.removeAll();var i=function(n){for(var o=0;o<e.length;++o){new Common.UI.DataViewSimple({el:$("#id-toolbar-menu-equationgroup"+o,n.items[o].$el),parentMenu:n.items[o].menu,store:e.at(o).get("groupStore"),scrollAlwaysVisible:!0,itemTemplate:_.template('<div class="item-equation" style="" ><div class="equation-icon" style="background-position:<%= posX %>px <%= posY %>px;width:<%= width %>px;height:<%= height %>px;" id="<%= id %>"></div></div>')}).on("item:click",function(e,i,n,o){t.api&&(n&&t.api.asc_AddMath(n.get("data").equationType),t.toolbar.btnInsertText.pressed&&t.toolbar.btnInsertText.toggle(!1,!0),t.toolbar.btnInsertShape.pressed&&t.toolbar.btnInsertShape.toggle(!1,!0),"click"!==o.type&&t.toolbar.btnInsertEquation.menu.hide(),Common.NotificationCenter.trigger("edit:complete",t.toolbar,t.toolbar.btnInsertEquation),Common.component.Analytics.trackEvent("ToolBar","Add Equation"))})}n.off("show:after",i)};t.toolbar.btnInsertEquation.menu.on("show:after",i);for(var n=0;n<e.length;++n){var o=e.at(n),s=new Common.UI.MenuItem({caption:o.get("groupName"),menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{template:_.template('<div id="id-toolbar-menu-equationgroup'+n+'" class="menu-shape" style="width:'+(o.get("groupWidth")+8)+"px; "+o.get("groupHeight")+'margin-left:5px;"></div>')}]})});t.toolbar.btnInsertEquation.menu.addItem(s)}}},onInsertEquationClick:function(){this.api&&!this._state.in_equation&&(this.api.asc_AddMath(),Common.component.Analytics.trackEvent("ToolBar","Add Equation")),Common.NotificationCenter.trigger("edit:complete",this.toolbar,this.toolbar.btnInsertEquation)},onInsertSymbolClick:function(){if((!this.dlgSymbolTable||!this.dlgSymbolTable.isVisible())&&this.api){var t=this,e=t.api.asc_GetSelectedText();t.dlgSymbolTable=new Common.Views.SymbolTableDialog({api:t.api,lang:t.mode.lang,modal:!1,type:1,special:!0,showShortcutKey:!0,font:e&&e.length>0?this.api.get_TextProps().get_TextPr().get_FontFamily().get_Name():void 0,symbol:e&&e.length>0?e.charAt(0):void 0,buttons:[{value:"ok",caption:this.textInsert},"close"],handler:function(e,i,n){"ok"==i?t.api.asc_insertSymbol(n.font?n.font:t.api.get_TextProps().get_TextPr().get_FontFamily().get_Name(),n.code,n.special):Common.NotificationCenter.trigger("edit:complete",t.toolbar)}}),t.dlgSymbolTable.show(),t.dlgSymbolTable.on("symbol:dblclick",function(e,i,n){t.api.asc_insertSymbol(n.font?n.font:t.api.get_TextProps().get_TextPr().get_FontFamily().get_Name(),n.code,n.special)})}},onApiMathTypes:function(t){this._equationTemp=t;var e=this,i=function(t){e.onMathTypes(e._equationTemp),e.toolbar.btnInsertEquation.menu.off("show:before",i)};e.toolbar.btnInsertEquation.menu.on("show:before",i)},onMathTypes:function(t){var e=[],i=this.getCollection("EquationGroups");i.reset();var n={};n[Common.define.c_oAscMathMainType.Symbol]=[this.textSymbols,11],n[Common.define.c_oAscMathMainType.Fraction]=[this.textFraction,4],n[Common.define.c_oAscMathMainType.Script]=[this.textScript,4],n[Common.define.c_oAscMathMainType.Radical]=[this.textRadical,4],n[Common.define.c_oAscMathMainType.Integral]=[this.textIntegral,3,!0],n[Common.define.c_oAscMathMainType.LargeOperator]=[this.textLargeOperator,5,!0],n[Common.define.c_oAscMathMainType.Bracket]=[this.textBracket,4,!0],n[Common.define.c_oAscMathMainType.Function]=[this.textFunction,3,!0],n[Common.define.c_oAscMathMainType.Accent]=[this.textAccent,4],n[Common.define.c_oAscMathMainType.LimitLog]=[this.textLimitAndLog,3],n[Common.define.c_oAscMathMainType.Operator]=[this.textOperator,4],n[Common.define.c_oAscMathMainType.Matrix]=[this.textMatrix,4,!0];var o={},s="",a="";for(s in Common.define.c_oAscMathType)if(Common.define.c_oAscMathType.hasOwnProperty(s)){var r=s.split("_");a=2==r.length&&"Symbol"==r[0]?"txt"+r[0]+"_"+r[1].toLocaleLowerCase():"txt"+s,o[Common.define.c_oAscMathType[s]]=this[a]}var l,c,d=0,h=0,p=0,m=0,u=0,g=null,b=null,f=null;if(t&&(c=t.get_Data(),h=c.length)){for(var C=0;C<h;++C){var v=c[C];if(d=v.get_Id(),m=v.get_W(),u=v.get_H(),g=new Backbone.Collection([],{model:DE.Models.EquationModel})){var _=0,y=0,x=0,r=[];for(p=v.get_Data().length,l=0;l<p;++l){b=v.get_Data()[l],y=b.get_Data().length;for(var w=0;w<y;++w)f=b.get_Data()[w],x=f.get_Id(),a="",o.hasOwnProperty(x)&&(a=o[x]),r.push({data:{equationType:x},tip:a,allowSelected:!0,selected:!1,width:b.get_W(),height:b.get_H(),posX:-f.get_X(),posY:-f.get_Y()});_+=y}g.add(r),m=n[d][1]*(m+10);var S=parseInt(370/(u+10))*(u+10);e.push({groupName:n[d][0],groupStore:g,groupWidth:m,groupHeight:n[d][2]?" height:"+S+"px!important; ":""})}}i.add(e),this.fillEquations()}},activateControls:function(){_.each(this.toolbar.toolbarControls,function(t){t.setDisabled(!1)},this),this.toolbar.btnUndo.setDisabled(!0!==this._state.can_undo),this.toolbar.btnRedo.setDisabled(!0!==this._state.can_redo),this.toolbar.btnCopy.setDisabled(!0!==this._state.can_copycut),this.toolbar.btnPrint.setDisabled(!this.toolbar.mode.canPrint),this._state.mmdisable||!this.toolbar.mode.fileChoiceUrl&&!this.toolbar.mode.canRequestMailMergeRecipients||this.toolbar.btnMailRecepients.setDisabled(!1),this._state.activated=!0;var t=this.api.asc_GetSectionProps();this.onApiPageSize(t.get_W(),t.get_H())},DisableMailMerge:function(){this._state.mmdisable=!0,this.toolbar&&this.toolbar.btnMailRecepients&&this.toolbar.btnMailRecepients.setDisabled(!0)},updateThemeColors:function(){var t=function(t,e){if(t){for(var i,n=Common.Utils.ThemeColor.getEffectColors(),o=0;o<n.length;o++)"object"==typeof t.currentColor&&void 0===i&&t.currentColor.effectId==n[o].effectId&&(i=n[o]);t.updateColors(n,Common.Utils.ThemeColor.getStandartColors()),void 0===t.currentColor?t.currentColor=n[e]:void 0!==i&&(t.currentColor=i)}};t(this.toolbar.mnuFontColorPicker,1),void 0!==this.toolbar.btnFontColor.currentColor&&this.toolbar.btnFontColor.currentColor.isAuto||(this.toolbar.btnFontColor.currentColor=this.toolbar.mnuFontColorPicker.currentColor.color||this.toolbar.mnuFontColorPicker.currentColor,this.toolbar.btnFontColor.setColor(this.toolbar.btnFontColor.currentColor)),void 0!==this._state.clrtext_asccolor&&(this._state.clrtext=void 0,this.onApiTextColor(this._state.clrtext_asccolor)),this._state.clrtext_asccolor=void 0,t(this.toolbar.mnuParagraphColorPicker,0),this.toolbar.btnParagraphColor.currentColor=this.toolbar.mnuParagraphColorPicker.currentColor.color||this.toolbar.mnuParagraphColorPicker.currentColor,this.toolbar.btnParagraphColor.setColor(this.toolbar.btnParagraphColor.currentColor),void 0!==this._state.clrshd_asccolor&&(this._state.clrback=void 0,this.onParagraphColor(this._state.clrshd_asccolor)),this._state.clrshd_asccolor=void 0},_onInitEditorStyles:function(t){window.styles_loaded=!1;var e=this,i=e.toolbar.listStyles;if(window.styles=t,!i)return void(e.styles=t);var n=[],o=this.getApplication().getController("Main");if(_.each(t.get_MergedStyles(),function(t){n.push({imageUrl:t.asc_getImage(),title:t.get_Name(),tip:o.translationTable[t.get_Name()]||t.get_Name(),id:Common.UI.getId()})}),i.menuPicker.store.reset(n),i.menuPicker.store.length>0&&i.rendered){var s;e._state.prstyle&&(s=i.menuPicker.store.findWhere({title:e._state.prstyle})),i.fillComboView(s||i.menuPicker.store.at(0),!0),Common.NotificationCenter.trigger("edit:complete",this)}else i.rendered&&i.clearComboView();window.styles_loaded=!0},onHomeOpen:function(){var t=this.toolbar.listStyles;if(t&&t.needFillComboView&&t.menuPicker.store.length>0&&t.rendered){var e;this._state.prstyle&&(e=t.menuPicker.store.findWhere({title:this._state.prstyle})),t.fillComboView(e||t.menuPicker.store.at(0),!0)}},_setMarkerColor:function(t,e){var i=this;if("menu"===e&&(i.toolbar.mnuHighlightTransparent.setChecked(!1),i.toolbar.btnHighlightColor.currentColor=t,i.toolbar.btnHighlightColor.setColor(i.toolbar.btnHighlightColor.currentColor),i.toolbar.btnHighlightColor.toggle(!0,!0)),"transparent"==(t=t||"transparent"))i.api.SetMarkerFormat(!0,!1);else{var n=t[0]+t[1],o=t[2]+t[3],s=t[4]+t[5];i.api.SetMarkerFormat(!0,!0,parseInt(n,16),parseInt(o,16),parseInt(s,16))}Common.NotificationCenter.trigger("edit:complete",i.toolbar,i.toolbar.btnHighlightColor),Common.component.Analytics.trackEvent("ToolBar","Highlight Color")},onHideMenus:function(t){Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onSetupCopyStyleButton:function(){this.modeAlwaysSetStyle=!1;var t=this;Common.NotificationCenter.on({"edit:complete":function(){t.api&&t.modeAlwaysSetStyle&&(t.api.SetPaintFormat(AscCommon.c_oAscFormatPainterState.kOff),t.toolbar.btnCopyStyle.toggle(!1,!0),t.modeAlwaysSetStyle=!1)}}),$(t.toolbar.btnCopyStyle.cmpEl).dblclick(function(){t.api&&(t.modeAlwaysSetStyle=!0,t.toolbar.btnCopyStyle.toggle(!0,!0),t.api.SetPaintFormat(AscCommon.c_oAscFormatPainterState.kMultiple))})},onApiCoAuthoringDisconnect:function(t){this.mode.isEdit&&this.toolbar.setMode({isDisconnected:!0,enableDownload:!!t}),this.editMode=!1,this.DisableToolbar(!0,!0)},DisableToolbar:function(t,e,i,n){void 0!==e&&(this.editMode=!e),t=t||!this.editMode;var o=$(".toolbar-mask"),s=$(".toolbar-group-mask"),a=i||n?s:o;if(!(t&&a.length>0||!t&&0==a.length)){var r=this.toolbar;t?i?(a=$("<div class='toolbar-group-mask'>").appendTo(r.$el.find(".toolbar section.panel .group:not(.no-mask):not(.no-group-mask.review):not(.no-group-mask.inner-elset)")),a=$("<div class='toolbar-group-mask'>").appendTo(r.$el.find(".toolbar section.panel .group.no-group-mask.inner-elset .elset"))):n?(a=$("<div class='toolbar-group-mask'>").appendTo(r.$el.find(".toolbar section.panel .group:not(.no-mask):not(.no-group-mask.form-view):not(.no-group-mask.inner-elset)")),a=$("<div class='toolbar-group-mask'>").appendTo(r.$el.find(".toolbar section.panel .group.no-group-mask.inner-elset .elset:not(.no-group-mask.form-view)"))):a=$("<div class='toolbar-mask'>").appendTo(r.$el.find(".toolbar")):a.remove(),$(".no-group-mask").each(function(e,o){var s=$(o);s.find("> .toolbar-group-mask").length>0?s.css("opacity",.4):(s.css("opacity",i||n||!t?1:.4),s.find(".elset").each(function(e,o){var a=$(o);a.find("> .toolbar-group-mask").length>0?a.css("opacity",.4):a.css("opacity",i||n||!t?1:.4),s.css("opacity",1)}))}),t=t||(i||n?o.length>0:s.length>0),r.$el.find(".toolbar").toggleClass("masked",t),r.synchTooltip&&r.synchTooltip.hide(),r._state.previewmode=i&&t,i&&(r._state.previewmode&&r.btnSave&&r.btnSave.setDisabled(!0),r.needShowSynchTip&&(r.needShowSynchTip=!1,r.onCollaborativeChanges())),t?Common.util.Shortcuts.suspendEvents("alt+h"):Common.util.Shortcuts.resumeEvents("alt+h")}},onSelectRecepientsClick:function(){if(!this._mailMergeDlg)if(this.toolbar.mode.canRequestMailMergeRecipients)Common.Gateway.requestMailMergeRecipients();else{var t=this;t._mailMergeDlg=new Common.Views.SelectFileDlg({fileChoiceUrl:this.toolbar.mode.fileChoiceUrl.replace("{fileExt}","xlsx").replace("{documentType}","")}),t._mailMergeDlg.on("selectfile",function(e,i){t.setMailMergeRecipients(i)}).on("close",function(e){t._mailMergeDlg=void 0}),t._mailMergeDlg.show()}},setMailMergeRecipients:function(t){this.api.asc_StartMailMerge(t),this.mergeEditor||(this.mergeEditor=this.getApplication().getController("Common.Controllers.ExternalMergeEditor").getView("Common.Views.ExternalMergeEditor")),this.mergeEditor&&this.mergeEditor.setEditMode(!1)},createDelayedElements:function(){this.toolbar.createDelayedElements(),this.attachUIEvents(this.toolbar)},onAppShowed:function(t){var e=this,i=!(t.isEdit||t.isRestrictedEdit&&t.canFillForms&&t.canFeatureForms);(t.isEdit||t.isRestrictedEdit&&t.canFillForms&&t.canFeatureForms)&&(Common.localStorage.itemExists("de-compact-toolbar")?i=Common.localStorage.getBool("de-compact-toolbar"):t.customization&&t.customization.compactToolbar&&(i=!0)),e.toolbar.render(_.extend({isCompactView:i},t));var n={action:"review",caption:e.toolbar.textTabCollaboration},o=e.application.getController("Common.Controllers.ReviewChanges").createToolbarPanel();if(o&&(e.toolbar.addTab(n,o,5),e.toolbar.setVisible("review",t.isEdit||t.canCoAuthoring&&t.canComments)),t.isEdit){if(e.toolbar.setMode(t),e.toolbar.btnSave.on("disabled",_.bind(e.onBtnChangeState,e,"save:disabled")),!t.customization||!t.customization.compactHeader){e.toolbar.btnPrint.$el.parents(".group").hide().next().hide();var s=e.toolbar.btnUndo.$el.hide().next().hide().parent();e.toolbar.btnPaste.$el.detach().appendTo(s),e.toolbar.btnCopy.$el.removeClass("split")}t.isDesktopApp&&t.canProtect&&(n={action:"protect",caption:e.toolbar.textTabProtect},(o=e.getApplication().getController("Common.Controllers.Protection").createToolbarPanel())&&e.toolbar.addTab(n,o,6));var a=e.getApplication().getController("Links");a.setApi(e.api).setConfig({toolbar:e}),Array.prototype.push.apply(e.toolbar.toolbarControls,a.getView("Links").getButtons())}if((t.isEdit&&t.canFeatureContentControl||t.isRestrictedEdit&&t.canFillForms)&&t.canFeatureForms){n={caption:e.textTabForms,action:"forms"};var r=e.getApplication().getController("FormsTab");r.setApi(e.api).setConfig({toolbar:e,config:t}),o=r.createToolbarPanel(),o&&(e.toolbar.addTab(n,o,4),e.toolbar.setVisible("forms",!0),t.isEdit&&t.canFeatureContentControl?Array.prototype.push.apply(e.toolbar.toolbarControls,r.getView("FormsTab").getButtons()):i||e.toolbar.setTab("forms"))}t.isEdit&&t.canFeatureContentControl&&e.onChangeSdtGlobalSettings()},onAppReady:function(t){var e=this;if(e.appOptions=t,t.canCoAuthoring&&t.canComments&&(this.btnsComment=Common.Utils.injectButtons(this.toolbar.$el.find(".slot-comment"),"tlbtn-addcomment-","toolbar__icon btn-menu-comments",this.toolbar.capBtnComment),this.btnsComment.length)){var i=DE.getController("Common.Controllers.Comments").getView();this.btnsComment.forEach(function(t){t.updateHint(i.textHintAddComment),t.on("click",function(t,e){Common.NotificationCenter.trigger("app:comment:add","toolbar")}),t.cmpEl.closest("#review-changes-panel").length>0&&t.setCaption(e.toolbar.capBtnAddComment)},this)}new Promise(function(t){t()}).then(function(){t.isEdit&&(e.controllers.pageLayout=new DE.Controllers.PageLayout({id:"ImageLayout",application:e.getApplication()}),e.controllers.pageLayout.onLaunch(e.toolbar).setApi(e.api).onAppReady(t))})},getView:function(t){
return t?Backbone.Controller.prototype.getView.apply(this,arguments):this.toolbar},onFileMenu:function(t){"show"==t?this.toolbar.isTabActive("file")||this.toolbar.setTab("file"):this.toolbar.isTabActive("file")&&this.toolbar.setTab()},onTextLanguage:function(t){this._state.lang=t},onInsDateTimeClick:function(){var t=this;new DE.Views.DateTimeDialog({api:this.api,lang:this._state.lang,handler:function(e,i){"ok"==e&&t.api&&t.api.asc_addDateTime(i),Common.NotificationCenter.trigger("edit:complete",t.toolbar)}}).show()},textEmptyImgUrl:"You need to specify image URL.",textWarning:"Warning",textFontSizeErr:"The entered value is incorrect.<br>Please enter a numeric value between 1 and 300",textSymbols:"Symbols",textFraction:"Fraction",textScript:"Script",textRadical:"Radical",textIntegral:"Integral",textLargeOperator:"Large Operator",textBracket:"Bracket",textFunction:"Function",textAccent:"Accent",textLimitAndLog:"Limit And Log",textOperator:"Operator",textMatrix:"Matrix",txtSymbol_pm:"Plus Minus",txtSymbol_infinity:"Infinity",txtSymbol_equals:"Equal",txtSymbol_neq:"Not Equal To",txtSymbol_about:"Approximately",txtSymbol_times:"Multiplication Sign",txtSymbol_div:"Division Sign",txtSymbol_factorial:"Factorial",txtSymbol_propto:"Proportional To",txtSymbol_less:"Less Than",txtSymbol_ll:"Much Less Than",txtSymbol_greater:"Greater Than",txtSymbol_gg:"Much Greater Than",txtSymbol_leq:"Less Than or Equal To",txtSymbol_geq:"Greater Than or Equal To",txtSymbol_mp:"Minus Plus",txtSymbol_cong:"Approximately Equal To",txtSymbol_approx:"Almost Equal To",txtSymbol_equiv:"Identical To",txtSymbol_forall:"For All",txtSymbol_additional:"Complement",txtSymbol_partial:"Partial Differential",txtSymbol_sqrt:"Radical Sign",txtSymbol_cbrt:"Cube Root",txtSymbol_qdrt:"Fourth Root",txtSymbol_cup:"Union",txtSymbol_cap:"Intersection",txtSymbol_emptyset:"Empty Set",txtSymbol_percent:"Percentage",txtSymbol_degree:"Degrees",txtSymbol_fahrenheit:"Degrees Fahrenheit",txtSymbol_celsius:"Degrees Celsius",txtSymbol_inc:"Increment",txtSymbol_nabla:"Nabla",txtSymbol_exists:"There Exist",txtSymbol_notexists:"There Does Not Exist",txtSymbol_in:"Element Of",txtSymbol_ni:"Contains as Member",txtSymbol_leftarrow:"Left Arrow",txtSymbol_uparrow:"Up Arrow",txtSymbol_rightarrow:"Right Arrow",txtSymbol_downarrow:"Down Arrow",txtSymbol_leftrightarrow:"Left-Right Arrow",txtSymbol_therefore:"Therefore",txtSymbol_plus:"Plus",txtSymbol_minus:"Minus",txtSymbol_not:"Not Sign",txtSymbol_ast:"Asterisk Operator",txtSymbol_bullet:"Bulet Operator",txtSymbol_vdots:"Vertical Ellipsis",txtSymbol_cdots:"Midline Horizontal Ellipsis",txtSymbol_rddots:"Up Right Diagonal Ellipsis",txtSymbol_ddots:"Down Right Diagonal Ellipsis",txtSymbol_aleph:"Alef",txtSymbol_beth:"Bet",txtSymbol_qed:"End of Proof",txtSymbol_alpha:"Alpha",txtSymbol_beta:"Beta",txtSymbol_gamma:"Gamma",txtSymbol_delta:"Delta",txtSymbol_varepsilon:"Epsilon Variant",txtSymbol_epsilon:"Epsilon",txtSymbol_zeta:"Zeta",txtSymbol_eta:"Eta",txtSymbol_theta:"Theta",txtSymbol_vartheta:"Theta Variant",txtSymbol_iota:"Iota",txtSymbol_kappa:"Kappa",txtSymbol_lambda:"Lambda",txtSymbol_mu:"Mu",txtSymbol_nu:"Nu",txtSymbol_xsi:"Xi",txtSymbol_o:"Omicron",txtSymbol_pi:"Pi",txtSymbol_varpi:"Pi Variant",txtSymbol_rho:"Rho",txtSymbol_varrho:"Rho Variant",txtSymbol_sigma:"Sigma",txtSymbol_varsigma:"Sigma Variant",txtSymbol_tau:"Tau",txtSymbol_upsilon:"Upsilon",txtSymbol_varphi:"Phi Variant",txtSymbol_phi:"Phi",txtSymbol_chi:"Chi",txtSymbol_psi:"Psi",txtSymbol_omega:"Omega",txtFractionVertical:"Stacked Fraction",txtFractionDiagonal:"Skewed Fraction",txtFractionHorizontal:"Linear Fraction",txtFractionSmall:"Small Fraction",txtFractionDifferential_1:"Differential",txtFractionDifferential_2:"Differential",txtFractionDifferential_3:"Differential",txtFractionDifferential_4:"Differential",txtFractionPi_2:"Pi Over 2",txtScriptSup:"Superscript",txtScriptSub:"Subscript",txtScriptSubSup:"Subscript-Superscript",txtScriptSubSupLeft:"Left Subscript-Superscript",txtScriptCustom_1:"Script",txtScriptCustom_2:"Script",txtScriptCustom_3:"Script",txtScriptCustom_4:"Script",txtRadicalSqrt:"Square Root",txtRadicalRoot_n:"Radical With Degree",txtRadicalRoot_2:"Square Root With Degree",txtRadicalRoot_3:"Cubic Root",txtRadicalCustom_1:"Radical",txtRadicalCustom_2:"Radical",txtIntegral:"Integral",txtIntegralSubSup:"Integral",txtIntegralCenterSubSup:"Integral",txtIntegralDouble:"Double Integral",txtIntegralDoubleSubSup:"Double Integral",txtIntegralDoubleCenterSubSup:"Double Integral",txtIntegralTriple:"Triple Integral",txtIntegralTripleSubSup:"Triple Integral",txtIntegralTripleCenterSubSup:"Triple Integral",txtIntegralOriented:"Contour Integral",txtIntegralOrientedSubSup:"Contour Integral",txtIntegralOrientedCenterSubSup:"Contour Integral",txtIntegralOrientedDouble:"Surface Integral",txtIntegralOrientedDoubleSubSup:"Surface Integral",txtIntegralOrientedDoubleCenterSubSup:"Surface Integral",txtIntegralOrientedTriple:"Volume Integral",txtIntegralOrientedTripleSubSup:"Volume Integral",txtIntegralOrientedTripleCenterSubSup:"Volume Integral",txtIntegral_dx:"Differential x",txtIntegral_dy:"Differential y",txtIntegral_dtheta:"Differential theta",txtLargeOperator_Sum:"Summation",txtLargeOperator_Sum_CenterSubSup:"Summation",txtLargeOperator_Sum_SubSup:"Summation",txtLargeOperator_Sum_CenterSub:"Summation",txtLargeOperator_Sum_Sub:"Summation",txtLargeOperator_Prod:"Product",txtLargeOperator_Prod_CenterSubSup:"Product",txtLargeOperator_Prod_SubSup:"Product",txtLargeOperator_Prod_CenterSub:"Product",txtLargeOperator_Prod_Sub:"Product",txtLargeOperator_CoProd:"Co-Product",txtLargeOperator_CoProd_CenterSubSup:"Co-Product",txtLargeOperator_CoProd_SubSup:"Co-Product",txtLargeOperator_CoProd_CenterSub:"Co-Product",txtLargeOperator_CoProd_Sub:"Co-Product",txtLargeOperator_Union:"Union",txtLargeOperator_Union_CenterSubSup:"Union",txtLargeOperator_Union_SubSup:"Union",txtLargeOperator_Union_CenterSub:"Union",txtLargeOperator_Union_Sub:"Union",txtLargeOperator_Intersection:"Intersection",txtLargeOperator_Intersection_CenterSubSup:"Intersection",txtLargeOperator_Intersection_SubSup:"Intersection",txtLargeOperator_Intersection_CenterSub:"Intersection",txtLargeOperator_Intersection_Sub:"Intersection",txtLargeOperator_Disjunction:"Vee",txtLargeOperator_Disjunction_CenterSubSup:"Vee",txtLargeOperator_Disjunction_SubSup:"Vee",txtLargeOperator_Disjunction_CenterSub:"Vee",txtLargeOperator_Disjunction_Sub:"Vee",txtLargeOperator_Conjunction:"Wedge",txtLargeOperator_Conjunction_CenterSubSup:"Wedge",txtLargeOperator_Conjunction_SubSup:"Wedge",txtLargeOperator_Conjunction_CenterSub:"Wedge",txtLargeOperator_Conjunction_Sub:"Wedge",txtLargeOperator_Custom_1:"Summation",txtLargeOperator_Custom_2:"Summation",txtLargeOperator_Custom_3:"Summation",txtLargeOperator_Custom_4:"Product",txtLargeOperator_Custom_5:"Union",txtBracket_Round:"Brackets",txtBracket_Square:"Brackets",txtBracket_Curve:"Brackets",txtBracket_Angle:"Brackets",txtBracket_LowLim:"Brackets",txtBracket_UppLim:"Brackets",txtBracket_Line:"Brackets",txtBracket_LineDouble:"Brackets",txtBracket_Square_OpenOpen:"Brackets",txtBracket_Square_CloseClose:"Brackets",txtBracket_Square_CloseOpen:"Brackets",txtBracket_SquareDouble:"Brackets",txtBracket_Round_Delimiter_2:"Brackets with Separators",txtBracket_Curve_Delimiter_2:"Brackets with Separators",txtBracket_Angle_Delimiter_2:"Brackets with Separators",txtBracket_Angle_Delimiter_3:"Brackets with Separators",txtBracket_Round_OpenNone:"Single Bracket",txtBracket_Round_NoneOpen:"Single Bracket",txtBracket_Square_OpenNone:"Single Bracket",txtBracket_Square_NoneOpen:"Single Bracket",txtBracket_Curve_OpenNone:"Single Bracket",txtBracket_Curve_NoneOpen:"Single Bracket",txtBracket_Angle_OpenNone:"Single Bracket",txtBracket_Angle_NoneOpen:"Single Bracket",txtBracket_LowLim_OpenNone:"Single Bracket",txtBracket_LowLim_NoneNone:"Single Bracket",txtBracket_UppLim_OpenNone:"Single Bracket",txtBracket_UppLim_NoneOpen:"Single Bracket",txtBracket_Line_OpenNone:"Single Bracket",txtBracket_Line_NoneOpen:"Single Bracket",txtBracket_LineDouble_OpenNone:"Single Bracket",txtBracket_LineDouble_NoneOpen:"Single Bracket",txtBracket_SquareDouble_OpenNone:"Single Bracket",txtBracket_SquareDouble_NoneOpen:"Single Bracket",txtBracket_Custom_1:"Case (Two Conditions)",txtBracket_Custom_2:"Cases (Three Conditions)",txtBracket_Custom_3:"Stack Object",txtBracket_Custom_4:"Stack Object",txtBracket_Custom_5:"Cases Example",txtBracket_Custom_6:"Binomial Coefficient",txtBracket_Custom_7:"Binomial Coefficient",txtFunction_Sin:"Sine Function",txtFunction_Cos:"Cosine Function",txtFunction_Tan:"Tangent Function",txtFunction_Csc:"Cosecant Function",txtFunction_Sec:"Secant Function",txtFunction_Cot:"Cotangent Function",txtFunction_1_Sin:"Inverse Sine Function",txtFunction_1_Cos:"Inverse Cosine Function",txtFunction_1_Tan:"Inverse Tangent Function",txtFunction_1_Csc:"Inverse Cosecant Function",txtFunction_1_Sec:"Inverse Secant Function",txtFunction_1_Cot:"Inverse Cotangent Function",txtFunction_Sinh:"Hyperbolic Sine Function",txtFunction_Cosh:"Hyperbolic Cosine Function",txtFunction_Tanh:"Hyperbolic Tangent Function",txtFunction_Csch:"Hyperbolic Cosecant Function",txtFunction_Sech:"Hyperbolic Secant Function",txtFunction_Coth:"Hyperbolic Cotangent Function",txtFunction_1_Sinh:"Hyperbolic Inverse Sine Function",txtFunction_1_Cosh:"Hyperbolic Inverse Cosine Function",txtFunction_1_Tanh:"Hyperbolic Inverse Tangent Function",txtFunction_1_Csch:"Hyperbolic Inverse Cosecant Function",txtFunction_1_Sech:"Hyperbolic Inverse Secant Function",txtFunction_1_Coth:"Hyperbolic Inverse Cotangent Function",txtFunction_Custom_1:"Sine theta",txtFunction_Custom_2:"Cos 2x",txtFunction_Custom_3:"Tangent formula",txtAccent_Dot:"Dot",txtAccent_DDot:"Double Dot",txtAccent_DDDot:"Triple Dot",txtAccent_Hat:"Hat",txtAccent_Check:"Check",txtAccent_Accent:"Acute",txtAccent_Grave:"Grave",txtAccent_Smile:"Breve",txtAccent_Tilde:"Tilde",txtAccent_Bar:"Bar",txtAccent_DoubleBar:"Double Overbar",txtAccent_CurveBracketTop:"Overbrace",txtAccent_CurveBracketBot:"Underbrace",txtAccent_GroupTop:"Grouping Character Above",txtAccent_GroupBot:"Grouping Character Below",txtAccent_ArrowL:"Leftwards Arrow Above",txtAccent_ArrowR:"Rightwards Arrow Above",txtAccent_ArrowD:"Right-Left Arrow Above",txtAccent_HarpoonL:"Leftwards Harpoon Above",txtAccent_HarpoonR:"Rightwards Harpoon Above",txtAccent_BorderBox:"Boxed Formula (With Placeholder)",txtAccent_BorderBoxCustom:"Boxed Formula (Example)",txtAccent_BarTop:"Overbar",txtAccent_BarBot:"Underbar",txtAccent_Custom_1:"Vector A",txtAccent_Custom_2:"ABC With Overbar",txtAccent_Custom_3:"x XOR y With Overbar",txtLimitLog_LogBase:"Logarithm",txtLimitLog_Log:"Logarithm",txtLimitLog_Lim:"Limit",txtLimitLog_Min:"Minimum",txtLimitLog_Max:"Maximum",txtLimitLog_Ln:"Natural Logarithm",txtLimitLog_Custom_1:"Limit Example",txtLimitLog_Custom_2:"Maximum Example",txtOperator_ColonEquals:"Colon Equal",txtOperator_EqualsEquals:"Equal Equal",txtOperator_PlusEquals:"Plus Equal",txtOperator_MinusEquals:"Minus Equal",txtOperator_Definition:"Equal to By Definition",txtOperator_UnitOfMeasure:"Measured By",txtOperator_DeltaEquals:"Delta Equal To",txtOperator_ArrowL_Top:"Leftwards Arrow Above",txtOperator_ArrowR_Top:"Rightwards Arrow Above",txtOperator_ArrowL_Bot:"Leftwards Arrow Below",txtOperator_ArrowR_Bot:"Rightwards Arrow Below",txtOperator_DoubleArrowL_Top:"Leftwards Arrow Above",txtOperator_DoubleArrowR_Top:"Rightwards Arrow Above",txtOperator_DoubleArrowL_Bot:"Leftwards Arrow Below",txtOperator_DoubleArrowR_Bot:"Rightwards Arrow Below",txtOperator_ArrowD_Top:"Right-Left Arrow Above",txtOperator_ArrowD_Bot:"Right-Left Arrow Above",txtOperator_DoubleArrowD_Top:"Right-Left Arrow Below",txtOperator_DoubleArrowD_Bot:"Right-Left Arrow Below",txtOperator_Custom_1:"Yileds",txtOperator_Custom_2:"Delta Yields",txtMatrix_1_2:"1x2 Empty Matrix",txtMatrix_2_1:"2x1 Empty Matrix",txtMatrix_1_3:"1x3 Empty Matrix",txtMatrix_3_1:"3x1 Empty Matrix",txtMatrix_2_2:"2x2 Empty Matrix",txtMatrix_2_3:"2x3 Empty Matrix",txtMatrix_3_2:"3x2 Empty Matrix",txtMatrix_3_3:"3x3 Empty Matrix",txtMatrix_Dots_Center:"Midline Dots",txtMatrix_Dots_Baseline:"Baseline Dots",txtMatrix_Dots_Vertical:"Vertical Dots",txtMatrix_Dots_Diagonal:"Diagonal Dots",txtMatrix_Identity_2:"2x2 Identity Matrix",txtMatrix_Identity_2_NoZeros:"3x3 Identity Matrix",txtMatrix_Identity_3:"3x3 Identity Matrix",txtMatrix_Identity_3_NoZeros:"3x3 Identity Matrix",txtMatrix_2_2_RoundBracket:"Empty Matrix with Brackets",txtMatrix_2_2_SquareBracket:"Empty Matrix with Brackets",txtMatrix_2_2_LineBracket:"Empty Matrix with Brackets",txtMatrix_2_2_DLineBracket:"Empty Matrix with Brackets",txtMatrix_Flat_Round:"Sparse Matrix",txtMatrix_Flat_Square:"Sparse Matrix",confirmAddFontName:"The font you are going to save is not available on the current device.<br>The text style will be displayed using one of the device fonts, the saved font will be used when it is available.<br>Do you want to continue?",notcriticalErrorTitle:"Warning",txtMarginsW:"Left and right margins are too high for a given page wight",txtMarginsH:"Top and bottom margins are too high for a given page height",textInsert:"Insert",textTabForms:"Forms",textGroup:"Group"},DE.Controllers.Toolbar||{}))}),define("text!documenteditor/main/app/template/StatusBar.template",[],function(){return'\r\n<div class="statusbar" style="display:table;">\r\n    <div class="status-group dropup">\r\n        <label id="label-pages" class="status-label dropdown-toggle" style="margin-left: 40px;" data-toggle="dropdown"><%= textPageNumber %></label>\r\n        <div id="status-goto-box" class="dropdown-menu">\r\n            <label style="float:left;line-height:22px;"><%= textGotoPage %></label>\r\n            <div id="status-goto-page" style="display:inline-block;"></div>\r\n        </div>\r\n    </div>\r\n    <div class="status-group" style="width:100%; text-align:center;">\r\n        <label id="label-action" class="status-label"></label>\r\n    </div>\r\n    <div class="status-group" style="">\r\n        <div class="separator short el-edit"></div>\r\n        <div class="cnt-lang el-edit">\r\n            <div class="dropdown-toggle" data-toggle="dropdown">\r\n                <label id="status-label-lang" class="status-label">English (United States)</label>\r\n                <div class="caret"></div>\r\n            </div>\r\n        </div>\r\n        <span id="btn-doc-lang" class="el-edit"></span>\r\n        <span id="btn-doc-spell" class="el-edit"></span>\r\n        <div class="separator short el-edit"></div>\r\n        <div id="btn-doc-review" class="el-edit el-review" style="display: inline-block;"></div>\r\n        <div class="separator short el-edit el-review"></div>\r\n        <button id="btn-zoom-topage" type="button" class="btn small btn-toolbar"><span class="icon toolbar__icon btn-ic-zoomtopage">&nbsp;</span></button>\r\n        <button id="btn-zoom-towidth" type="button" class="btn small btn-toolbar"><span class="icon toolbar__icon btn-ic-zoomtowidth">&nbsp;</span></button>\r\n        <button id="btn-zoom-down" type="button" class="btn small btn-toolbar"><span class="icon toolbar__icon btn-zoomdown">&nbsp;</span></button>\r\n        <div class="cnt-zoom">\r\n            <div class="dropdown-toggle" data-toggle="dropdown">\r\n                <label id="label-zoom" class="status-label">Zoom 100%</label>\r\n            </div>\r\n        </div>\r\n        <button id="btn-zoom-up" type="button" class="btn small btn-toolbar" style="margin-right:40px;"><span class="icon toolbar__icon btn-zoomup">&nbsp;</span></button>\r\n    </div>\r\n</div>\r\n'}),define("documenteditor/main/app/model/Pages",["underscore","backbone"],function(t,e){"use strict";DE.Models=DE.Models||{},DE.Models.Pages=e.Model.extend({defaults:{current:0,count:0}})}),define("documenteditor/main/app/view/Statusbar",["text!documenteditor/main/app/template/StatusBar.template","jquery","underscore","backbone","tip","common/main/lib/component/Menu","common/main/lib/component/Window","documenteditor/main/app/model/Pages"],function(t,e,i,n){"use strict";function o(t){this.pages.set("count",t)}function s(t){this.pages.set("current",t+1)}function a(t,i,n){e(".statusbar #label-pages",this.$el).text(Common.Utils.String.format(this.pageIndexText,t.get("current"),t.get("count")))}function r(t,e){t.$el.parent().find("#status-label-lang").text(e.caption),this.langMenu.prevTip=e.value.value,this.fireEvent("langchanged",[this,e.value.code,e.caption])}function l(t){var e=this;e.btnZoomToPage.updateHint(e.tipFitPage),e.btnZoomToWidth.updateHint(e.tipFitWidth),e.btnZoomDown.updateHint(e.tipZoomOut+Common.Utils.String.platformKey("Ctrl+-")),e.btnZoomUp.updateHint(e.tipZoomIn+Common.Utils.String.platformKey("Ctrl++")),e.btnLanguage&&e.btnLanguage.cmpEl&&(e.btnLanguage.updateHint(e.tipSetLang),e.btnLanguage.cmpEl.on({"show.bs.dropdown":function(){i.defer(function(){e.btnLanguage.cmpEl.find("ul").focus()},100)},"hide.bs.dropdown":function(){i.defer(function(){e.api.asc_enableKeyEvents(!0)},100)},click:function(t){if(e.btnLanguage.isDisabled())return!1}}),e.langMenu.on("item:click",i.bind(r,this))),e.cntZoom.updateHint(e.tipZoomFactor),e.cntZoom.cmpEl.on({"show.bs.dropdown":function(){i.defer(function(){e.cntZoom.cmpEl.find("ul").focus()},100)},"hide.bs.dropdown":function(){i.defer(function(){e.api.asc_enableKeyEvents(!0)},100)}}),e.txtGoToPage.on({"keypress:after":function(t,i){if(i.keyCode===Common.UI.Keys.RETURN){var n=e.$el.find("#status-goto-box"),o=n.find("input[type=text]"),s=parseInt(o.val());return!s||s-- >e.pages.get("count")||s<0?(o.select(),!1):(n.focus(),n.parent().removeClass("open"),e.api.goToPage(s),e.api.asc_enableKeyEvents(!0),!1)}},"keyup:after":function(t,i){if(i.keyCode===Common.UI.Keys.ESC){var n=e.$el.find("#status-goto-box");return n.focus(),n.parent().removeClass("open"),e.api.asc_enableKeyEvents(!0),!1}}});var n=e.$el.find("#status-goto-box");n.on("click",function(){return!1}),n.parent().on({"show.bs.dropdown":function(){e.txtGoToPage.setValue(e.api.getCurrentPage()+1),e.txtGoToPage.checkValidate();var t=e.txtGoToPage.$el.find("input");i.defer(function(){t.focus().select()},100)},"hide.bs.dropdown":function(){var t=e.$el.find("#status-goto-box");e.api&&t&&(t.focus(),t.parent().removeClass("open"),e.api.asc_enableKeyEvents(!0))}}),e.zoomMenu.on("item:click",function(t,i){e.fireEvent("zoom:value",[i.value])})}i.template("Page <%= current %> of <%= count %>");DE.Views.Statusbar=n.View.extend(i.extend({el:"#statusbar",template:i.template(t),events:{},api:void 0,pages:void 0,initialize:function(t){i.extend(this,t),this.pages=new DE.Models.Pages({current:1,count:1}),this.pages.on("change",i.bind(a,this)),this.state={};var n=this;this.$layout=e(this.template({textGotoPage:this.goToPageText,textPageNumber:Common.Utils.String.format(this.pageIndexText,1,1)})),this.btnZoomToPage=new Common.UI.Button({hintAnchor:"top",toggleGroup:"status-zoom",enableToggle:!0}),this.btnZoomToWidth=new Common.UI.Button({hintAnchor:"top",toggleGroup:"status-zoom",enableToggle:!0}),this.cntZoom=new Common.UI.Button({hintAnchor:"top"}),this.btnZoomDown=new Common.UI.Button({hintAnchor:"top"}),this.btnZoomUp=new Common.UI.Button({hintAnchor:"top-right"}),this.btnLanguage=new Common.UI.Button({hintAnchor:"top-left",disabled:!0}),this.langMenu=new Common.UI.MenuSimple({cls:"lang-menu",style:"margin-top:-5px;",restoreHeight:285,itemTemplate:i.template(['<a id="<%= id %>" tabindex="-1" type="menuitem" style="padding-left: 28px !important;" langval="<%= value.value %>" class="<% if (checked) { %> checked <% } %>">','<i class="icon <% if (spellcheck) { %> toolbar__icon btn-ic-docspell spellcheck-lang <% } %>"></i>',"<%= caption %>","</a>"].join("")),menuAlign:"bl-tl",search:!0}),this.zoomMenu=new Common.UI.Menu({style:"margin-top:-5px;",menuAlign:"bl-tl",items:[{caption:"50%",value:50},{caption:"75%",value:75},{caption:"100%",value:100},{caption:"125%",value:125},{caption:"150%",value:150},{caption:"175%",value:175},{caption:"200%",value:200}]}),this.txtGoToPage=new Common.UI.InputField({allowBlank:!0,validateOnChange:!0,style:"width: 60px;",maskExp:/[0-9]/,validation:function(t){return!!(/(^[0-9]+$)/.test(t)&&void 0!==(t=parseInt(t))&&t>0&&t<=n.pages.get("count"))||n.txtPageNumInvalid}});var o=new Promise(function(t,e){t()});Common.NotificationCenter.on("app:ready",function(t){o.then(l.bind(this,t))}.bind(this))},render:function(t){function i(t,e){t.setElement(e,!1),t.render()}var n=this;if(this.fireEvent("render:before",[this.$layout]),i(n.btnZoomToPage,e("#btn-zoom-topage",n.$layout)),i(n.btnZoomToWidth,e("#btn-zoom-towidth",n.$layout)),i(n.cntZoom,e(".cnt-zoom",n.$layout)),i(n.btnZoomDown,e("#btn-zoom-down",n.$layout)),i(n.btnZoomUp,e("#btn-zoom-up",n.$layout)),i(n.txtGoToPage,e("#status-goto-page",n.$layout)),!t||t.isEdit){var o=e(".cnt-lang",n.$layout);i(n.btnLanguage,o),n.langMenu.render(o),n.langMenu.cmpEl.attr({tabindex:-1}),n.langMenu.prevTip="en"}return n.zoomMenu.render(e(".cnt-zoom",n.$layout)),n.zoomMenu.cmpEl.attr({tabindex:-1}),this.$el.html(n.$layout),this.fireEvent("render:after",[this]),this},setApi:function(t){return this.api=t,this.api&&(this.api.asc_registerCallback("asc_onCountPages",i.bind(o,this)),this.api.asc_registerCallback("asc_onCurrentPage",i.bind(s,this)),Common.NotificationCenter.on("api:disconnect",i.bind(this.onApiCoAuthoringDisconnect,this))),this},setMode:function(t){this.mode=t},setVisible:function(t){t?this.show():this.hide()},reloadLanguages:function(t){var e=[],n=this.langMenu.saved;i.each(t,function(t){e.push({caption:t.displayValue,value:{value:t.value,code:t.code},checkable:!0,checked:n==t.displayValue,spellcheck:t.spellcheck})}),this.langMenu.resetItems(e),this.langMenu.items.length>0&&this.btnLanguage.setDisabled(!!this.mode.isDisconnected)},setLanguage:function(t){if(this.langMenu.prevTip!=t.value&&void 0!==t.code){e(this.langMenu.el.parentNode,this.$el).find("#status-label-lang").text(t.displayValue),this.langMenu.prevTip=t.value;var n=i.find(this.langMenu.items,function(e){return e.caption==t.displayValue});n?this.langMenu.setChecked(this.langMenu.items.indexOf(n),!0):(this.langMenu.saved=t.displayValue,this.langMenu.clearAll())}},showStatusMessage:function(t){e(".statusbar #label-action").text(t)},clearStatusMessage:function(){e(".statusbar #label-action").text("")},SetDisabled:function(t){var e=this.langMenu.items.length>0;this.btnLanguage.setDisabled(t||!e)},onApiCoAuthoringDisconnect:function(){this.setMode({isDisconnected:!0}),this.SetDisabled(!0)},pageIndexText:"Page {0} of {1}",goToPageText:"Go to Page",tipFitPage:"Fit to Page",tipFitWidth:"Fit to Width",tipZoomIn:"Zoom In",tipZoomOut:"Zoom Out",tipZoomFactor:"Magnification",tipSetLang:"Set Text Language",txtPageNumInvalid:"Page number invalid",textTrackChanges:"Track Changes",textChangesPanel:"Changes panel"},DE.Views.Statusbar||{}))}),void 0===window.Common&&(window.Common={}),Common.util=Common.util||{},Common.util.LanguageInfo=new function(){var t={54:["af","Afrikaans"],1078:["af-ZA","Afrikaans (Suid Afrika)","Afrikaans (South Africa)"],28:["sq","Shqipe"],1052:["sq-AL","Shqipe (ShqipÃ«ria)","Albanian (Albania)"],132:["gsw","ElsÃ¤ssisch"],1156:["gsw-FR","ElsÃ¤ssisch (FrÃ nkrisch)","Alsatian (France)"],94:["am","á áá­á"],1118:["am-ET","á áá­á (á¢áµá®áµá«)","Amharic (Ethiopia)"],1:["ar","Ø§ÙØ¹Ø±Ø¨ÙØ©â"],5121:["ar-DZ","Ø§ÙØ¹Ø±Ø¨ÙØ© (Ø§ÙØ¬Ø²Ø§Ø¦Ø±)â","Arabic (Algeria)"],15361:["ar-BH","Ø§ÙØ¹Ø±Ø¨ÙØ© (Ø§ÙØ¨Ø­Ø±ÙÙ)â","Arabic (Bahrain)"],3073:["ar-EG","Ø§ÙØ¹Ø±Ø¨ÙØ© (ÙØµØ±)â","Arabic (Egypt)"],2049:["ar-IQ","Ø§ÙØ¹Ø±Ø¨ÙØ© (Ø§ÙØ¹Ø±Ø§Ù)â","Arabic (Iraq)"],11265:["ar-JO","Ø§ÙØ¹Ø±Ø¨ÙØ© (Ø§ÙØ£Ø±Ø¯Ù)â","Arabic (Jordan)"],13313:["ar-KW","Ø§ÙØ¹Ø±Ø¨ÙØ© (Ø§ÙÙÙÙØª)â","Arabic (Kuwait)"],12289:["ar-LB","Ø§ÙØ¹Ø±Ø¨ÙØ© (ÙØ¨ÙØ§Ù)â","Arabic (Lebanon)"],4097:["ar-LY","Ø§ÙØ¹Ø±Ø¨ÙØ© (ÙÙØ¨ÙØ§)â","Arabic (Libya)"],6145:["ar-MA","Ø§ÙØ¹Ø±Ø¨ÙØ© (Ø§ÙÙÙÙÙØ© Ø§ÙÙØºØ±Ø¨ÙØ©)â","Arabic (Morocco)"],8193:["ar-OM","Ø§ÙØ¹Ø±Ø¨ÙØ© (Ø¹ÙØ§Ù)â","Arabic (Oman)"],16385:["ar-QA","Ø§ÙØ¹Ø±Ø¨ÙØ© (ÙØ·Ø±)â","Arabic (Qatar)"],1025:["ar-SA","Ø§ÙØ¹Ø±Ø¨ÙØ© (Ø§ÙÙÙÙÙØ© Ø§ÙØ¹Ø±Ø¨ÙØ© Ø§ÙØ³Ø¹ÙØ¯ÙØ©)â","Arabic (Saudi Arabia)"],10241:["ar-SY","Ø§ÙØ¹Ø±Ø¨ÙØ© (Ø³ÙØ±ÙØ§)â","Arabic (Syria)"],7169:["ar-TN","Ø§ÙØ¹Ø±Ø¨ÙØ© (ØªÙÙØ³)â","Arabic (Tunisia)"],14337:["ar-AE","Ø§ÙØ¹Ø±Ø¨ÙØ© (Ø§ÙØ¥ÙØ§Ø±Ø§Øª Ø§ÙØ¹Ø±Ø¨ÙØ© Ø§ÙÙØªØ­Ø¯Ø©)â","Arabic (U.A.E.)"],9217:["ar-YE","Ø§ÙØ¹Ø±Ø¨ÙØ© (Ø§ÙÙÙÙ)â","Arabic (Yemen)"],43:["hy","ÕÕ¡ÕµÕ¥ÖÕ¥Õ¶"],1067:["hy-AM","ÕÕ¡ÕµÕ¥ÖÕ¥Õ¶ (ÕÕ¡ÕµÕ¡Õ½Õ¿Õ¡Õ¶)","Armenian (Armenia)"],77:["as","à¦à¦¸à¦®à§à§à¦¾"],1101:["as-IN","à¦à¦¸à¦®à§à§à¦¾ (à¦­à¦¾à§°à¦¤)","Assamese (India)"],44:["az","AzÉrbaycanÂ­Ä±lÄ±"],29740:["az-Cyrl","ÐÐ·ÓÑÐ±Ð°ÑÒ¹Ð°Ð½Â Ð´Ð¸Ð»Ð¸"],2092:["az-Cyrl-AZ","ÐÐ·ÓÑÐ±Ð°ÑÒ¹Ð°Ð½ (ÐÐ·ÓÑÐ±Ð°ÑÒ¹Ð°Ð½)","Azeri (Cyrillic, Azerbaijan)"],30764:["az-Latn","AzÉrbaycanÂ­Ä±lÄ±"],1068:["az-Latn-AZ","AzÉrbaycanÂ­Ä±lÄ± (AzÉrbaycan)","Azeri (Latin, Azerbaijan)"],109:["ba","ÐÐ°ÑÒ¡Ð¾ÑÑ"],1133:["ba-RU","ÐÐ°ÑÒ¡Ð¾ÑÑ (Ð Ð¾ÑÑÐ¸Ñ)","Bashkir (Russia)"],45:["eu","Euskara"],1069:["eu-ES","Euskara (Euskara)","Basque (Basque)"],35:["be","ÐÐµÐ»Ð°ÑÑÑÐºÑ"],1059:["be-BY","ÐÐµÐ»Ð°ÑÑÑÐºÑ (ÐÐµÐ»Ð°ÑÑÑÑ)","Belarusian (Belarus)"],69:["bn","à¦¬à¦¾à¦à¦²à¦¾"],2117:["bn-BD","à¦¬à¦¾à¦à¦²à¦¾ (à¦¬à¦¾à¦à¦²à¦¾à¦¦à§à¦¶)","Bengali (Bangladesh)"],1093:["bn-IN","à¦¬à¦¾à¦à¦²à¦¾ (à¦­à¦¾à¦°à¦¤)","Bengali (India)"],30746:["bs","bosanski"],25626:["bs-Cyrl","ÐÐ¾ÑÐ°Ð½ÑÐºÐ¸ (ÐÐ¸ÑÐ¸Ð»Ð¸ÑÐ°)"],8218:["bs-Cyrl-BA","ÐÐ¾ÑÐ°Ð½ÑÐºÐ¸ (ÐÐ¾ÑÐ½Ð° Ð¸ Ð¥ÐµÑÑÐµÐ³Ð¾Ð²Ð¸Ð½Ð°)","Bosnian (Cyrillic) (Bosnia and Herzegovina)"],26650:["bs-Latn","Bosanski (Latinica)"],5146:["bs-Latn-BA","Bosanski (Bosna i Hercegovina)","Bosnian (Latin) (Bosnia and Herzegovina)"],126:["br","Brezhoneg"],1150:["br-FR","Brezhoneg (FraÃ±s)","Breton (France)"],2:["bg","ÐÑÐ»Ð³Ð°ÑÑÐºÐ¸"],1026:["bg-BG","ÐÑÐ»Ð³Ð°ÑÑÐºÐ¸ (ÐÑÐ»Ð³Ð°ÑÐ¸Ñ)","Bulgarian (Bulgaria)"],3:["ca","CatalÃ "],1027:["ca-ES","CatalÃ  (CatalÃ )","Catalan (Catalan)"],2051:["ca-ES-valencia","CatalÃ  (ValenciÃ )","Catalan (Valencia)"],30724:["zh","ä¸­æ"],4:["zh-Hans","ä¸­æ(ç®ä½)","Chinese (Simplified)"],2052:["zh-CN","ä¸­æ(ä¸­åäººæ°å±åå½)","Chinese (People's Republic of China)"],4100:["zh-SG","ä¸­æ(æ°å å¡)","Chinese (Simplified, Singapore)"],31748:["zh-Hant","ä¸­æ(ç¹é«)","Chinese (Traditional)"],3076:["zh-HK","ä¸­æ(é¦æ¸¯ç¹å¥è¡æ¿å)","Chinese (Traditional, Hong Kong S.A.R.)"],5124:["zh-MO","ä¸­æ(æ¾³éç¹å¥è¡æ¿å)","Chinese (Traditional, Macao S.A.R.)"],1028:["zh-TW","ä¸­æ(å°ç£)","Chinese (Traditional, Taiwan)"],131:["co","Corsu"],1155:["co-FR","Corsu (France)","Corsican (France)"],26:["hr","Hrvatski"],1050:["hr-HR","Hrvatski (Hrvatska)","Croatian (Croatia)"],4122:["hr-BA","Hrvatski (Bosna i Hercegovina)","Croatian (Bosnia and Herzegovina)"],5:["cs","ÄeÅ¡tina"],1029:["cs-CZ","ÄeÅ¡tina (ÄeskÃ¡Â republika)","Czech (Czech Republic)"],6:["da","Dansk"],1030:["da-DK","Dansk (Danmark)","Danish (Denmark)"],140:["prs","Ø¯Ø±Ùâ"],1164:["prs-AF","Ø¯Ø±Ù (Ø§ÙØºØ§ÙØ³ØªØ§Ù)â","Dari (Afghanistan)"],101:["dv","ÞÞ¨ÞÞ¬ÞÞ¨ÞÞ¦ÞÞ°â"],1125:["dv-MV","ÞÞ¨ÞÞ¬ÞÞ¨ÞÞ¦ÞÞ° (ÞÞ¨ÞÞ¬ÞÞ¨ ÞÞ§ÞÞ°ÞÞ¬)â","Divehi (Maldives)"],19:["nl","Nederlands"],2067:["nl-BE","Nederlands (BelgiÃ«)","Dutch (Belgium)"],1043:["nl-NL","Nederlands (Nederland)","Dutch (Netherlands)"],9:["en","English"],3081:["en-AU","English (Australia)","English (Australia)"],10249:["en-BZ","English (Belize)","English (Belize)"],4105:["en-CA","English (Canada)","English (Canada)"],9225:["en-029","English (Caribbean)","English (Caribbean)"],16393:["en-IN","English (India)","English (India)"],6153:["en-IE","English (Ireland)","English (Ireland)"],8201:["en-JM","English (Jamaica)","English (Jamaica)"],17417:["en-MY","English (Malaysia)","English (Malaysia)"],5129:["en-NZ","English (New Zealand)","English (New Zealand)"],13321:["en-PH","English (Philippines)","English (Philippines)"],18441:["en-SG","English (Singapore)","English (Singapore)"],7177:["en-ZA","English (South Africa)","English (South Africa)"],11273:["en-TT","English (Trinidad y Tobago)","English (Trinidad y Tobago)"],2057:["en-GB","English (United Kingdom)","English (United Kingdom)"],1033:["en-US","English (United States)","English (United States)"],12297:["en-ZW","English (Zimbabwe)","English (Zimbabwe)"],15369:["en-HK","English (Hong Kong)","English (Hong Kong)"],14345:["en-ID","English (Indonesia)","English (Indonesia)"],37:["et","Eesti"],1061:["et-EE","Eesti (Eesti)","Estonian (Estonia)"],56:["fo","FÃ¸royskt"],1080:["fo-FO","FÃ¸royskt (FÃ¸royar)","Faroese (Faroe Islands)"],100:["fil","Filipino"],1124:["fil-PH","Filipino (Pilipinas)","Filipino (Philippines)"],11:["fi","Suomi"],1035:["fi-FI","Suomi (Suomi)","Finnish (Finland)"],12:["fr","FranÃ§ais"],2060:["fr-BE","FranÃ§ais (Belgique)","French (Belgium)"],3084:["fr-CA","FranÃ§ais (Canada)","French (Canada)"],1036:["fr-FR","FranÃ§ais (France)","French (France)"],5132:["fr-LU","FranÃ§ais (Luxembourg)","French (Luxembourg)"],6156:["fr-MC","FranÃ§ais (PrincipautÃ© de Monaco)","French (Principality of Monaco)"],4108:["fr-CH","FranÃ§ais (Suisse)","French (Switzerland)"],15372:["fr-HT","FranÃ§ais (HaÃ¯ti)","French (Haiti)"],9228:["fr-CG","FranÃ§ais (Congo-Brazzaville)","French (Congo)"],12300:["fr-CI","FranÃ§ais (CÃ´te dâIvoire)","French (Cote d'Ivoire)"],11276:["fr-CM","FranÃ§ais (Cameroun)","French (Cameroon)"],14348:["fr-MA","FranÃ§ais (Maroc)","French (Morocco)"],13324:["fr-ML","FranÃ§ais (Mali)","French (Mali)"],8204:["fr-RE","FranÃ§ais (La RÃ©union)","French (Reunion)"],10252:["fr-SN","FranÃ§ais (SÃ©nÃ©gal)","French (Senegal)"],7180:["fr-West","French"],98:["fy","Frysk"],1122:["fy-NL","Frysk (NederlÃ¢n)","Frisian (Netherlands)"],86:["gl","Galego"],1110:["gl-ES","Galego (Galego)","Galician (Galician)"],55:["ka","á¥áá áá£áá"],1079:["ka-GE","á¥áá áá£áá (á¡áá¥áá ááááá)","Georgian (Georgia)"],7:["de","Deutsch"],3079:["de-AT","Deutsch (Ãsterreich)","German (Austria)"],1031:["de-DE","Deutsch (Deutschland)","German (Germany)"],5127:["de-LI","Deutsch (Liechtenstein)","German (Liechtenstein)"],4103:["de-LU","Deutsch (Luxemburg)","German (Luxembourg)"],2055:["de-CH","Deutsch (Schweiz)","German (Switzerland)"],8:["el","ÎÎ»Î»Î·Î½Î¹ÎºÎ¬"],1032:["el-GR","ÎÎ»Î»Î·Î½Î¹ÎºÎ¬ (ÎÎ»Î»Î¬Î´Î±)","Greek (Greece)"],111:["kl","Kalaallisut"],1135:["kl-GL","Kalaallisut (Kalaallit Nunaat)","Greenlandic (Greenland)"],71:["gu","àªà«àªàª°àª¾àª¤à«"],1095:["gu-IN","àªà«àªàª°àª¾àª¤à« (àª­àª¾àª°àª¤)","Gujarati (India)"],104:["ha","Hausa"],31848:["ha-Latn","Hausa (Latin)"],1128:["ha-Latn-NG","Hausa (Nigeria)","Hausa (Latin) (Nigeria)"],13:["he","×¢××¨××ªâ"],1037:["he-IL","×¢××¨××ª (××©×¨××)â","Hebrew (Israel)"],57:["hi","à¤¹à¤¿à¤à¤¦à¥"],1081:["hi-IN","à¤¹à¤¿à¤à¤¦à¥ (à¤­à¤¾à¤°à¤¤)","Hindi (India)"],14:["hu","Magyar"],1038:["hu-HU","Magyar (MagyarorszÃ¡g)","Hungarian (Hungary)"],15:["is","Ãslenska"],1039:["is-IS","Ãslenska (Ãsland)","Icelandic (Iceland)"],112:["ig","Igbo"],1136:["ig-NG","Igbo (Nigeria)","Igbo (Nigeria)"],33:["id","Bahasa Indonesia"],1057:["id-ID","Bahasa Indonesia (Indonesia)","Indonesian (Indonesia)"],93:["iu","Inuktitut"],31837:["iu-Latn","Inuktitut (Qaliujaaqpait)"],2141:["iu-Latn-CA","Inuktitut (Kanatami) (kanata)","Inuktitut (Latin) (Canada)"],30813:["iu-Cans","áááááá¦ (áááá®áá¸áá¦)"],1117:["iu-Cans-CA","áááááá¦ (á²ááá¥)","Inuktitut (Canada)"],60:["ga","Gaeilge"],2108:["ga-IE","Gaeilge (Ãire)","Irish (Ireland)"],52:["xh","isiXhosa"],1076:["xh-ZA","isiXhosa (uMzantsi Afrika)","isiXhosa (South Africa)"],53:["zu","isiZulu"],1077:["zu-ZA","isiZulu (iNingizimu Afrika)","isiZulu (South Africa)"],16:["it","Italiano"],1040:["it-IT","Italiano (Italia)","Italian (Italy)"],2064:["it-CH","Italiano (Svizzera)","Italian (Switzerland)"],17:["ja","æ¥æ¬èª"],1041:["ja-JP","æ¥æ¬èª (æ¥æ¬)","Japanese (Japan)"],75:["kn","à²à²¨à³à²¨à²¡"],1099:["kn-IN","à²à²¨à³à²¨à²¡ (à²­à²¾à²°à²¤)","Kannada (India)"],63:["kk","ÒÐ°Ð·Ð°Ò"],1087:["kk-KZ","ÒÐ°Ð·Ð°Ò (ÒÐ°Ð·Ð°ÒÑÑÐ°Ð½)","Kazakh (Kazakhstan)"],83:["km","ááááá"],1107:["km-KH","ááááá (ááááá»áá¶)","Khmer (Cambodia)"],134:["qut","K'iche"],1158:["qut-GT","K'iche (Guatemala)","K'iche (Guatemala)"],135:["rw","Kinyarwanda"],1159:["rw-RW","Kinyarwanda (Rwanda)","Kinyarwanda (Rwanda)"],65:["sw","Kiswahili"],1089:["sw-KE","Kiswahili (Kenya)","Kiswahili (Kenya)"],87:["kok","à¤à¥à¤à¤à¤£à¥"],1111:["kok-IN","à¤à¥à¤à¤à¤£à¥ (à¤­à¤¾à¤°à¤¤)","Konkani (India)"],18:["ko","íêµ­ì´"],1042:["ko-KR","íêµ­ì´ (ëíë¯¼êµ­)","Korean (Korea)"],64:["ky","ÐÑÑÐ³ÑÐ·"],1088:["ky-KG","ÐÑÑÐ³ÑÐ· (ÐÑÑÐ³ÑÐ·ÑÑÐ°Ð½)","Kyrgyz (Kyrgyzstan)"],84:["lo","àº¥àº²àº§"],1108:["lo-LA","àº¥àº²àº§ (àºª.àº.àº. àº¥àº²àº§)","Lao (Lao P.D.R.)"],38:["lv","LatvieÅ¡u"],1062:["lv-LV","LatvieÅ¡u (Latvija)","Latvian (Latvia)"],39:["lt","LietuviÅ³"],1063:["lt-LT","LietuviÅ³ (Lietuva)","Lithuanian (Lithuania)"],
31790:["dsb","DolnoserbÅ¡Äina"],2094:["dsb-DE","DolnoserbÅ¡Äina (Nimska)","Lower Sorbian (Germany)"],110:["lb","LÃ«tzebuergesch"],1134:["lb-LU","LÃ«tzebuergesch (Luxembourg)","Luxembourgish (Luxembourg)"],1071:["mk-MK","ÐÐ°ÐºÐµÐ´Ð¾Ð½ÑÐºÐ¸ ÑÐ°Ð·Ð¸Ðº (ÐÐ°ÐºÐµÐ´Ð¾Ð½Ð¸ÑÐ°)","Macedonian (Former Yugoslav Republic of Macedonia)"],47:["mk","ÐÐ°ÐºÐµÐ´Ð¾Ð½ÑÐºÐ¸ ÑÐ°Ð·Ð¸Ðº"],62:["ms","Bahasa Melayu"],2110:["ms-BN","Bahasa Melayu (Brunei Darussalam)","Malay (Brunei Darussalam)"],1086:["ms-MY","Bahasa Melayu (Malaysia)","Malay (Malaysia)"],76:["ml","à´®à´²à´¯à´¾à´³à´"],1100:["ml-IN","à´®à´²à´¯à´¾à´³à´ (à´­à´¾à´°à´¤à´)","Malayalam (India)"],58:["mt","Malti"],1082:["mt-MT","Malti (Malta)","Maltese (Malta)"],129:["mi","Reo MÄori"],1153:["mi-NZ","Reo MÄori (Aotearoa)","Maori (New Zealand)"],122:["arn","Mapudungun"],1146:["arn-CL","Mapudungun (Chile)","Mapudungun (Chile)"],78:["mr","à¤®à¤°à¤¾à¤ à¥"],1102:["mr-IN","à¤®à¤°à¤¾à¤ à¥ (à¤­à¤¾à¤°à¤¤)","Marathi (India)"],124:["moh","Kanien'kÃ©ha"],1148:["moh-CA","Kanien'kÃ©ha (Canada)","Mohawk (Canada)"],80:["mn","ÐÐ¾Ð½Ð³Ð¾Ð»Â ÑÑÐ»"],30800:["mn-Cyrl","ÐÐ¾Ð½Ð³Ð¾Ð»Â ÑÑÐ»"],1104:["mn-MN","ÐÐ¾Ð½Ð³Ð¾Ð»Â ÑÑÐ» (ÐÐ¾Ð½Ð³Ð¾Ð»Â ÑÐ»Ñ)","Mongolian (Cyrillic, Mongolia)"],31824:["mn-Mong","á ®á ¤á ¨á ­á ­á ¤á ¯ á ¬á ¡á ¯á ¡"],2128:["mn-Mong-CN","á ®á ¤á ¨á ­á ­á ¤á ¯ á ¬á ¡á ¯á ¡ (á ªá ¦á ­á ¦á ³á ¡ á ¨á  á ¢á ·á  á ®á ³á  á ¬á ¤ á ³á ¤á ®á ³á  á ³á ¤ á  á ·á  á ³ á £á ¯á £á °)","Mongolian (Traditional Mongolian) (People's Republic of China)"],97:["ne","à¤¨à¥à¤ªà¤¾à¤²à¥"],1121:["ne-NP","à¤¨à¥à¤ªà¤¾à¤²à¥ (à¤¨à¥à¤ªà¤¾à¤²)","Nepali (Nepal)"],2145:["ne-IN","à¤¨à¥à¤ªà¤¾à¤²à¥ (à¤­à¤¾à¤°à¤¤)","Nepali (India)"],20:["no","Norsk"],31764:["nb","Norsk (bokmÃ¥l)"],1044:["nb-NO","Norsk, bokmÃ¥l (Norge)","Norwegian, BokmÃ¥l (Norway)"],30740:["nn","Norsk (Nynorsk)"],2068:["nn-NO","Norsk, nynorsk (Noreg)","Norwegian, Nynorsk (Norway)"],130:["oc","Occitan"],1154:["oc-FR","Occitan (FranÃ§a)","Occitan (France)"],72:["or","à¬à­à¬¿à¬"],1096:["or-IN","à¬à­à¬¿à¬ (à¬­à¬¾à¬°à¬¤)","Oriya (India)"],99:["ps","Ù¾ÚØªÙâ"],1123:["ps-AF","Ù¾ÚØªÙ (Ø§ÙØºØ§ÙØ³ØªØ§Ù)â","Pashto (Afghanistan)"],41:["fa","ÙØ§Ø±Ø³Ùâ"],1065:["fa-IR","ÙØ§Ø±Ø³Ù (Ø§ÛØ±Ø§Ù)â","Persian (Iran)"],21:["pl","Polski"],1045:["pl-PL","Polski (Polska)","Polish (Poland)"],22:["pt","PortuguÃªs"],1046:["pt-BR","PortuguÃªs (Brasil)","Portuguese (Brazil)"],2070:["pt-PT","PortuguÃªs (Portugal)","Portuguese (Portugal)"],70:["pa","à¨ªà©°à¨à¨¾à¨¬à©"],1094:["pa-IN","à¨ªà©°à¨à¨¾à¨¬à© (à¨­à¨¾à¨°à¨¤)","Punjabi (India)"],107:["quz","Runasimi"],1131:["quz-BO","Runasimi (Qullasuyu)","Quechua (Bolivia)"],2155:["quz-EC","Runasimi (Ecuador)","Quechua (Ecuador)"],3179:["quz-PE","Runasimi (Piruw)","Quechua (Peru)"],24:["ro","RomÃ¢nÄ"],1048:["ro-RO","RomÃ¢nÄ (RomÃ¢nia)","Romanian (Romania)"],2072:["ro-MD","RomÃ¢nÄ (Moldova)","Romanian (Republic of Moldova)"],23:["rm","Rumantsch"],1047:["rm-CH","Rumantsch (Svizra)","Romansh (Switzerland)"],25:["ru","Ð ÑÑÑÐºÐ¸Ð¹"],1049:["ru-RU","Ð ÑÑÑÐºÐ¸Ð¹ (Ð Ð¾ÑÑÐ¸Ñ)","Russian (Russia)"],2073:["ru-MD","Ð ÑÑÑÐºÐ¸Ð¹ (ÐÐ¾Ð»Ð´Ð°Ð²Ð¸Ñ)","Russian (Republic of Moldova)"],28731:["smn","SÃ¤mikielÃ¢"],9275:["smn-FI","SÃ¤mikielÃ¢ (SuomÃ¢)","Sami (Inari) (Finland)"],31803:["smj","JulevusÃ¡megiella"],4155:["smj-NO","JulevusÃ¡megiella (Vuodna)","Sami (Lule) (Norway)"],5179:["smj-SE","JulevusÃ¡megiella (Svierik)","Sami (Lule) (Sweden)"],59:["se","DavvisÃ¡megiella"],3131:["se-FI","DavvisÃ¡megiella (Suopma)","Sami (Northern) (Finland)"],1083:["se-NO","DavvisÃ¡megiella (Norga)","Sami (Northern) (Norway)"],2107:["se-SE","DavvisÃ¡megiella (RuoÅ§Å§a)","Sami (Northern) (Sweden)"],29755:["sms","SÃ¤Ã¤mÂ´Ç©iÃµll"],8251:["sms-FI","SÃ¤Ã¤mÂ´Ç©iÃµll (LÃ¤Ã¤Â´ddjÃ¢nnam)","Sami (Skolt) (Finland)"],30779:["sma","Ã¥arjelsaemiengiele"],6203:["sma-NO","Ã¥arjelsaemiengiele (NÃ¶Ã¶rje)","Sami (Southern) (Norway)"],7227:["sma-SE","Ã¥arjelsaemiengiele (Sveerje)","Sami (Southern) (Sweden)"],79:["sa","à¤¸à¤à¤¸à¥à¤à¥à¤¤"],1103:["sa-IN","à¤¸à¤à¤¸à¥à¤à¥à¤¤ (à¤­à¤¾à¤°à¤¤à¤®à¥)","Sanskrit (India)"],145:["gd","GÃ idhlig"],1169:["gd-GB","GÃ idhlig (An RÃ¬oghachd Aonaichte)","Scottish Gaelic (United Kingdom)"],31770:["sr","Srpski"],27674:["sr-Cyrl","Ð¡ÑÐ¿ÑÐºÐ¸ (ÐÐ¸ÑÐ¸Ð»Ð¸ÑÐ°)"],7194:["sr-Cyrl-BA","Ð¡ÑÐ¿ÑÐºÐ¸ (ÐÐ¾ÑÐ½Ð° Ð¸ Ð¥ÐµÑÑÐµÐ³Ð¾Ð²Ð¸Ð½Ð°)","Serbian (Cyrillic) (Bosnia and Herzegovina)"],12314:["sr-Cyrl-ME","Ð¡ÑÐ¿ÑÐºÐ¸ (Ð¦ÑÐ½Ð° ÐÐ¾ÑÐ°)","Serbian (Cyrillic, Montenegro)"],3098:["sr-Cyrl-CS","Ð¡ÑÐ¿ÑÐºÐ¸ (Ð¡ÑÐ±Ð¸ÑÐ° Ð¸ Ð¦ÑÐ½Ð° ÐÐ¾ÑÐ° (ÐÑÐµÑÑÐ¾Ð´Ð½Ð¾))","Serbian (Cyrillic, Serbia and Montenegro (Former))"],10266:["sr-Cyrl-RS","Ð¡ÑÐ¿ÑÐºÐ¸ (Ð¡ÑÐ±Ð¸ÑÐ°)","Serbian (Cyrillic, Serbia)"],28698:["sr-Latn","Srpski (Latinica)"],6170:["sr-Latn-BA","Srpski (Bosna i Hercegovina)","Serbian (Latin, Bosnia and Herzegovina)"],11290:["sr-Latn-ME","Srpski (Crna Gora)","Serbian (Latin, Montenegro)"],2074:["sr-Latn-CS","Srpski (Srbija i Crna Gora (Prethodno))","Serbian (Latin, Serbia and Montenegro (Former))"],9242:["sr-Latn-RS","Srpski (Srbija, Latinica)","Serbian (Latin, Serbia)"],108:["nso","Sesotho sa Leboa"],1132:["nso-ZA","Sesotho sa Leboa (Afrika Borwa)","Sesotho sa Leboa (South Africa)"],50:["tn","Setswana"],1074:["tn-ZA","Setswana (Aforika Borwa)","Setswana (South Africa)"],91:["si","à·à·à¶à·"],1115:["si-LK","à·à·à¶à· (à·à·âà¶»à· à¶½à¶à¶à·)","Sinhala (Sri Lanka)"],27:["sk","SlovenÄina"],1051:["sk-SK","SlovenÄina (SlovenskÃ¡ republika)","Slovak (Slovakia)"],36:["sl","Slovenski"],1060:["sl-SI","Slovenski (Slovenija)","Slovenian (Slovenia)"],10:["es","EspaÃ±ol"],11274:["es-AR","EspaÃ±ol (Argentina)","Spanish (Argentina)"],16394:["es-BO","EspaÃ±ol (Bolivia)","Spanish (Bolivia)"],13322:["es-CL","EspaÃ±ol (Chile)","Spanish (Chile)"],9226:["es-CO","EspaÃ±ol (Colombia)","Spanish (Colombia)"],5130:["es-CR","EspaÃ±ol (Costa Rica)","Spanish (Costa Rica)"],7178:["es-DO","EspaÃ±ol (RepÃºblica Dominicana)","Spanish (Dominican Republic)"],12298:["es-EC","EspaÃ±ol (Ecuador)","Spanish (Ecuador)"],17418:["es-SV","EspaÃ±ol (El Salvador)","Spanish (El Salvador)"],4106:["es-GT","EspaÃ±ol (Guatemala)","Spanish (Guatemala)"],18442:["es-HN","EspaÃ±ol (Honduras)","Spanish (Honduras)"],2058:["es-MX","EspaÃ±ol (MÃ©xico)","Spanish (Mexico)"],19466:["es-NI","EspaÃ±ol (Nicaragua)","Spanish (Nicaragua)"],6154:["es-PA","EspaÃ±ol (PanamÃ¡)","Spanish (Panama)"],15370:["es-PY","EspaÃ±ol (Paraguay)","Spanish (Paraguay)"],10250:["es-PE","EspaÃ±ol (PerÃº)","Spanish (Peru)"],20490:["es-PR","EspaÃ±ol (Puerto Rico)","Spanish (Puerto Rico)"],3082:["es-ES","EspaÃ±ol (EspaÃ±a, alfabetizaciÃ³n internacional)","Spanish (Spain)"],21514:["es-US","EspaÃ±ol (Estados Unidos)","Spanish (United States)"],14346:["es-UY","EspaÃ±ol (Uruguay)","Spanish (Uruguay)"],8202:["es-VE","EspaÃ±ol (Republica Bolivariana de Venezuela)","Spanish (Venezuela)"],1034:["es-ES_tradnl","Spanish"],22538:["es-419","EspaÃ±ol (AmÃ©rica Latina y el Caribe)","Spanish (Latin America and the Caribbean)"],23562:["es-CU","EspaÃ±ol (Cuba)","Spanish (Cuba)"],29:["sv","Svenska"],2077:["sv-FI","Svenska (Finland)","Swedish (Finland)"],1053:["sv-SE","Svenska (Sverige)","Swedish (Sweden)"],90:["syr","Ü£ÜÜªÜÜÜâ"],1114:["syr-SY","Ü£ÜÜªÜÜÜ (Ø³ÙØ±ÙØ§)â","Syriac (Syria)"],40:["tg","Ð¢Ð¾Ò·Ð¸ÐºÓ£"],31784:["tg-Cyrl","Ð¢Ð¾Ò·Ð¸ÐºÓ£"],1064:["tg-Cyrl-TJ","Ð¢Ð¾Ò·Ð¸ÐºÓ£ (Ð¢Ð¾Ò·Ð¸ÐºÐ¸ÑÑÐ¾Ð½)","Tajik (Cyrillic) (Tajikistan)"],95:["tzm","Tamazight"],31839:["tzm-Latn","Tamazight (Latin)"],2143:["tzm-Latn-DZ","Tamazight (DjazaÃ¯r)","Tamazight (Latin) (Algeria)"],73:["ta","à®¤à®®à®¿à®´à¯"],1097:["ta-IN","à®¤à®®à®¿à®´à¯ (à®à®¨à¯à®¤à®¿à®¯à®¾)","Tamil (India)"],68:["tt","Ð¢Ð°ÑÐ°Ñ"],1092:["tt-RU","Ð¢Ð°ÑÐ°Ñ (Ð Ð¾ÑÑÐ¸Ñ)","Tatar (Russia)"],74:["te","à°¤à±à°²à±à°à±"],1098:["te-IN","à°¤à±à°²à±à°à± (à°­à°¾à°°à°¤Â à°¦à±à°¶à°)","Telugu (India)"],30:["th","à¹à¸à¸¢"],1054:["th-TH","à¹à¸à¸¢ (à¹à¸à¸¢)","Thai (Thailand)"],81:["bo","à½à½¼à½à¼à½¡à½²à½"],1105:["bo-CN","à½à½¼à½à¼à½¡à½²à½ (à½à¾²à½´à½à¼à½§à¾­à¼à½à½²à¼à½à½à½à½¦à¼à½¦à¾¤à¾±à½²à¼à½à½à½´à½à¼à½¢à¾à¾±à½£à¼à½à½à¼)","Tibetan (People's Republic of China)"],2129:["bo-BT","Tibetan (Bhutan)","Tibetan (Bhutan)"],31:["tr","TÃ¼rkÃ§e"],1055:["tr-TR","TÃ¼rkÃ§e (TÃ¼rkiye)","Turkish (Turkey)"],66:["tk","TÃ¼rkmenÃ§e"],1090:["tk-TM","TÃ¼rkmenÃ§e (TÃ¼rkmenistan)","Turkmen (Turkmenistan)"],34:["uk","Ð£ÐºÑÐ°ÑÐ½ÑÑÐºÐ°"],1058:["uk-UA","Ð£ÐºÑÐ°ÑÐ½ÑÑÐºÐ° (Ð£ÐºÑÐ°ÑÐ½Ð°)","Ukrainian (Ukraine)"],46:["hsb","HornjoserbÅ¡Äina"],1070:["hsb-DE","HornjoserbÅ¡Äina (NÄmska)","Upper Sorbian (Germany)"],32:["ur","Ø§ÙØ±Ø¯Ùâ"],1056:["ur-PK","Ø§ÙØ±Ø¯Ù (Ù¾Ø§Ú©Ø³ØªØ§Ù)â","Urdu (Islamic Republic of Pakistan)"],2080:["ur-IN","Ø§ÙØ±Ø¯Ù (Ø¨Ú¾Ø§Ø±Øª)â","Urdu (India)"],128:["ug","Ø¦ÛÙØºÛØ± ÙÛØ²ÙÙÙâ"],1152:["ug-CN","(Ø¦ÛÙØºÛØ± ÙÛØ²ÙÙÙ (Ø¬ÛÚ­Ø®ÛØ§ Ø®ÛÙÙ Ø¬ÛÙÚ¾ÛØ±ÙÙÙØªÙâ","Uighur (People's Republic of China)"],30787:["uz-Cyrl","ÐÐ·Ð±ÐµÐº"],2115:["uz-Cyrl-UZ","ÐÐ·Ð±ÐµÐº (ÐÐ·Ð±ÐµÐºÐ¸ÑÑÐ¾Ð½)","Uzbek (Cyrillic, Uzbekistan)"],67:["uz","U'zbek"],31811:["uz-Latn","U'zbek"],1091:["uz-Latn-UZ","U'zbek (U'zbekiston Respublikasi)","Uzbek (Latin, Uzbekistan)"],42:["vi","TiÃªÌng Viá»t"],1066:["vi-VN","TiÃªÌng Viá»t (Viá»t Nam)","Vietnamese (Vietnam)"],82:["cy","Cymraeg"],1106:["cy-GB","Cymraeg (y Deyrnas Unedig)","Welsh (United Kingdom)"],136:["wo","Wolof"],1160:["wo-SN","Wolof (SÃ©nÃ©gal)","Wolof (Senegal)"],133:["sah","Ð¡Ð°ÑÐ°"],1157:["sah-RU","Ð¡Ð°ÑÐ° (Ð Ð¾ÑÑÐ¸Ñ)","Yakut (Russia)"],120:["ii","êê ê±ê·"],1144:["ii-CN","êê ê±ê· (êê¸êê±ê­ê¼ê©)","Yi (People's Republic of China)"],106:["yo","Yoruba"],1130:["yo-NG","Yoruba (Nigeria)","Yoruba (Nigeria)"],1126:["bin-NG","Bini (Nigeria)","Bini (Nigeria)"],1116:["chr-US","á£á³á© (áá á¢á³á¾áµááá áá¦áá©)","Cherokee (United States)"],1127:["fuv-NG","Nigerian Fulfulde (Nigeria)","Nigerian Fulfulde (Nigeria)"],1138:["gaz-ET","West Central Oromo (Ethiopia)","West Central Oromo (Ethiopia)"],1140:["gn-PY","Guarani (Paraguay)","Guarani (Paraguay)"],1141:["haw-US","Ê»Ålelo HawaiÊ»i (Ê»Amelika Hui PÅ« Ê»Ia)","Hawaiian (United States)"],1129:["ibb-NG","Ibibio (Nigeria)","Ibibio (Nigeria)"],1137:["kr-NG","Kanuri (Nigeria)","Kanuri (Nigeria)"],1112:["mni","Manipuri","Manipuri"],1109:["my-MM","Burmese (Myanmar)","Burmese (Myanmar)"],1145:["pap-AN","Papiamento, Netherlands Antilles","Papiamento, Netherlands Antilles"],2118:["pa-PK","Panjabi (Pakistan)","Panjabi (Pakistan)"],1165:["plt-MG","Plateau Malagasy (Madagascar)","Plateau Malagasy (Madagascar)"],1113:["sd-IN","Sindhi (India)","Sindhi (India)"],2137:["sd-PK","Sindhi (Pakistan)","Sindhi (Pakistan)"],1143:["so-SO","Soomaali (Soomaaliya)","Somali (Somalia)"],1072:["st-ZA","Southern Sotho (South Africa)","Southern Sotho (South Africa)"],1139:["ti-ER","áµáá­á (á¤á­áµá«)","Tigrinya (Eritrea)"],2163:["ti-ET","áµáá­á (á¢áµá®áµá«)","Tigrinya (Ethiopia)"],1119:["tmz","Tamanaku"],3167:["tmz-MA","TamaziÉ£t n laá¹­laá¹£ (Meá¹á¹uk)","Tamanaku (Morocco)"],1073:["ts-ZA","Tsonga (South Africa)","Tsonga (South Africa)"],1075:["ven-ZA","South Africa","South Africa"]};return{getLocalLanguageName:function(e){return t[e]||["",e]},getLocalLanguageCode:function(e){if(e)for(var i in t)if(t[i][0].toLowerCase()===e.toLowerCase())return i;return null},getLanguages:function(){return t}}},define("common/main/lib/util/LanguageInfo",function(){}),define("documenteditor/main/app/controller/Statusbar",["core","documenteditor/main/app/view/Statusbar","common/main/lib/util/LanguageInfo"],function(){"use strict";DE.Controllers.Statusbar=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["Statusbar"],initialize:function(){var t=this;this.addListeners({Statusbar:{langchanged:this.onLangMenu,"zoom:value":function(t){this.api.zoom(t),Common.NotificationCenter.trigger("edit:complete",this.statusbar)}.bind(this)},"Common.Views.Header":{"statusbar:hide":function(e,i){t.statusbar.setVisible(!i),Common.localStorage.setBool("de-hidden-status",i),Common.NotificationCenter.trigger("layout:changed","status"),Common.NotificationCenter.trigger("edit:complete",t.statusbar)}}})},events:function(){return{"click #btn-zoom-down":_.bind(this.zoomDocument,this,"down"),"click #btn-zoom-up":_.bind(this.zoomDocument,this,"up"),"click #btn-zoom-topage":_.bind(this.onBtnZoomTo,this,"topage"),"click #btn-zoom-towidth":_.bind(this.onBtnZoomTo,this,"towidth")}},onLaunch:function(){this.statusbar=this.createView("Statusbar",{});var t=this;Common.NotificationCenter.on("app:face",function(e){if(t.statusbar.render(e),t.statusbar.$el.css("z-index",1),$(".statusbar #label-zoom").css("min-width",80),e.isEdit){var i=t.getApplication().getController("Common.Controllers.ReviewChanges").getView();e.canReview?(t.btnTurnReview=i.getButton("turn","statusbar"),t.btnTurnReview.render(t.statusbar.$layout.find("#btn-doc-review"))):t.statusbar.$el.find(".el-review").hide(),t.btnSpelling=i.getButton("spelling","statusbar"),t.btnSpelling.render(t.statusbar.$layout.find("#btn-doc-spell")),t.btnDocLang=i.getButton("doclang","statusbar"),t.btnDocLang.render(t.statusbar.$layout.find("#btn-doc-lang"))}else t.statusbar.$el.find(".el-edit, .el-review").hide()}),Common.NotificationCenter.on("app:ready",t.onAppReady.bind(t))},onAppReady:function(t){var e=this;new Promise(function(t){t()}).then(function(){e.bindViewEvents(e.statusbar,e.events);var i=Common.localStorage.getBool("de-hidden-status");if(t.canReview&&!i){var n=e.api.asc_IsTrackRevisions(),o="object"==typeof t.customization?t.customization.trackChanges:void 0;if(t.isReviewOnly||!0===o||!1!==o&&n)!function(){Common.localStorage.getBool("de-track-changes-tip")?e.btnTurnReview.updateHint(e.tipReview):(e.btnTurnReview.updateHint(""),void 0===e.changesTooltip&&(e.changesTooltip=e.createChangesTip(e.textTrackChanges,"de-track-changes-tip")),e.hideTips(),e.changesTooltip.show())}();else if(n){var s=!Common.localStorage.getBool("de-new-changes");e.api.asc_HaveRevisionsChanges()&&s?(e.btnTurnReview.updateHint(""),void 0===e.newChangesTooltip&&(e.newChangesTooltip=e.createChangesTip(e.textHasChanges,"de-new-changes")),e.hideTips(),e.newChangesTooltip.show()):e.btnTurnReview.updateHint(e.tipReview)}}})},onApiTrackRevisionsChange:function(t,e,i){var n=null===t,o=n?e:t;this.btnTurnReview&&(o?i&&o&&n&&(void 0===this.globalChangesTooltip&&(this.globalChangesTooltip=this.createChangesTip(this.textSetTrackChanges)),this.globalChangesTooltip.isVisible()||(this.hideTips(),this.globalChangesTooltip.show())):(this.hideTips(),this.btnTurnReview.updateHint(this.tipReview)))},setApi:function(t){this.api=t,this.api.asc_registerCallback("asc_onZoomChange",_.bind(this._onZoomChange,this)),this.api.asc_registerCallback("asc_onTextLanguage",_.bind(this._onTextLanguage,this)),this.api.asc_registerCallback("asc_onOnTrackRevisionsChange",_.bind(this.onApiTrackRevisionsChange,this)),this.statusbar.setApi(t)},onBtnZoomTo:function(t,e){var i,n;"topage"==t?(i="btnZoomToPage",n="zoomFitToPage"):(i="btnZoomToWidth",n="zoomFitToWidth"),this.statusbar[i].pressed?this.api[n]():this.api.zoomCustomMode(),Common.NotificationCenter.trigger("edit:complete",this.statusbar)},zoomDocument:function(t,e){switch(t){case"up":this.api.zoomIn();break;case"down":this.api.zoomOut()}Common.NotificationCenter.trigger("edit:complete",this.statusbar)},_onZoomChange:function(t,e){this.statusbar.btnZoomToPage.toggle(2==e,!0),this.statusbar.btnZoomToWidth.toggle(1==e,!0),$(".statusbar #label-zoom").text(Common.Utils.String.format(this.zoomText,t))},_onTextLanguage:function(t){var e=Common.util.LanguageInfo.getLocalLanguageName(t);this.statusbar.setLanguage({value:e[0],displayValue:e[1],code:t})},setLanguages:function(t){this.langs=t,this.statusbar.reloadLanguages(t)},setStatusCaption:function(t,e,i){this.timerCaption&&(new Date<this.timerCaption||0==t.length)&&!e||(this.timerCaption=void 0,t.length?(this.statusbar.showStatusMessage(t),i>0&&(this.timerCaption=(new Date).getTime()+i)):this.statusbar.clearStatusMessage())},createDelayedElements:function(){this.statusbar.$el.css("z-index","")},onLangMenu:function(t,e,i){this.api.put_TextPrLang(e)},synchronizeChanges:function(){this.setStatusCaption("")},hideTips:function(){this.changesTooltip&&this.changesTooltip.isVisible()&&this.changesTooltip.hide(),this.newChangesTooltip&&this.newChangesTooltip.isVisible()&&this.newChangesTooltip.hide(),this.globalChangesTooltip&&this.globalChangesTooltip.isVisible()&&this.globalChangesTooltip.hide()},createChangesTip:function(t,e){var i=this,n=new Common.UI.SynchronizeTip({target:i.btnTurnReview.$el,text:t,placement:"top-left",showLink:!!e});return n.on({dontshowclick:function(){Common.localStorage.setItem(e,1),n.hide(),i.btnTurnReview.updateHint(i.tipReview)},closeclick:function(){n.hide(),i.btnTurnReview.updateHint(i.tipReview)}}),n},zoomText:"Zoom {0}%",textHasChanges:"New changes have been tracked",textTrackChanges:"The document is opened with the Track Changes mode enabled",tipReview:"Review",textSetTrackChanges:"You are in Track Changes mode"},DE.Controllers.Statusbar||{}))}),define("documenteditor/main/app/view/FormsTab",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout"],function(){"use strict";DE.Views.FormsTab=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;this.btnTextField&&this.btnTextField.on("click",function(e,i){t.fireEvent("forms:insert",["text"])}),this.btnComboBox&&this.btnComboBox.on("click",function(e,i){t.fireEvent("forms:insert",["combobox"])}),this.btnDropDown&&this.btnDropDown.on("click",function(e,i){t.fireEvent("forms:insert",["dropdown"])}),this.btnCheckBox&&this.btnCheckBox.on("click",function(e,i){t.fireEvent("forms:insert",["checkbox"])}),this.btnRadioBox&&this.btnRadioBox.on("click",function(e,i){t.fireEvent("forms:insert",["radiobox"])}),this.btnImageField&&this.btnImageField.on("click",function(e,i){t.fireEvent("forms:insert",["picture"])}),this.btnViewForm&&this.btnViewForm.on("click",function(e,i){t.fireEvent("forms:mode",[e.pressed])}),this.btnClearFields&&this.btnClearFields.on("click",function(e,i){t.fireEvent("forms:clear")}),this.btnClear&&this.btnClear.on("click",function(e,i){t.fireEvent("forms:clear")}),this.mnuFormsColorPicker&&($("#id-toolbar-menu-new-form-color").on("click",function(e,i){t.fireEvent("forms:new-color")}),this.mnuNoFormsColor.on("click",function(e){t.fireEvent("forms:no-color",[e])}),this.mnuFormsColorPicker.on("select",function(e,i){t.fireEvent("forms:select-color",[i])}),this.btnHighlight.menu.on("show:after",function(e,i){t.fireEvent("forms:open-color",[i])})),this.btnPrevForm&&this.btnPrevForm.on("click",function(e,i){t.fireEvent("forms:goto",["prev"])}),this.btnNextForm&&this.btnNextForm.on("click",function(e,i){t.fireEvent("forms:goto",["next"])}),this.btnSubmit&&this.btnSubmit.on("click",function(e,i){t.fireEvent("forms:submit")})}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this),this.toolbar=t.toolbar,this.appConfig=t.config,this.paragraphControls=[];this.appConfig.isRestrictedEdit&&this.appConfig.canFillForms?this.btnClear=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon clear-style",caption:this.textClear}):(this.btnTextField=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-text-field",caption:this.capBtnText,disabled:!0}),this.paragraphControls.push(this.btnTextField),this.btnComboBox=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-combo-box",caption:this.capBtnComboBox,disabled:!0}),this.paragraphControls.push(this.btnComboBox),this.btnDropDown=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-dropdown",caption:this.capBtnDropDown,disabled:!0}),this.paragraphControls.push(this.btnDropDown),this.btnCheckBox=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-checkbox",caption:this.capBtnCheckBox,disabled:!0}),this.paragraphControls.push(this.btnCheckBox),this.btnRadioBox=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-radio-button",caption:this.capBtnRadioBox,disabled:!0}),this.paragraphControls.push(this.btnRadioBox),this.btnImageField=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-insertimage",caption:this.capBtnImage,disabled:!0}),this.paragraphControls.push(this.btnImageField),this.btnViewForm=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-sheet-view",caption:this.capBtnView,enableToggle:!0,disabled:!0}),this.paragraphControls.push(this.btnViewForm),this.btnClearFields=new Common.UI.Button({cls:"btn-toolbar",iconCls:"toolbar__icon btn-clearstyle",caption:this.textClearFields,disabled:!0}),this.paragraphControls.push(this.btnClearFields),this.btnHighlight=new Common.UI.ButtonColored({cls:"btn-toolbar",iconCls:"toolbar__icon btn-highlight",caption:this.textHighlight,menu:!0,disabled:!0}),this.paragraphControls.push(this.btnHighlight)),this.btnPrevForm=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon previous-field",caption:this.capBtnPrev}),this.paragraphControls.push(this.btnPrevForm),this.btnNextForm=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon next-field",caption:this.capBtnNext}),this.paragraphControls.push(this.btnNextForm),this.appConfig.canSubmitForms&&(this.btnSubmit=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon submit-form",caption:this.capBtnSubmit}),this.paragraphControls.push(this.btnSubmit)),this._state={disabled:!1},Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return t&&t.html(this.getPanel()),this},onAppReady:function(e){var i=this;new Promise(function(t,e){t()}).then(function(){e.isEdit&&e.canFeatureContentControl?(e.canEditContentControl?(i.btnHighlight.setMenu(new Common.UI.Menu({items:[i.mnuNoFormsColor=new Common.UI.MenuItem({id:"id-toolbar-menu-no-highlight-form",caption:i.textNoHighlight,checkable:!0,checked:null===i.btnHighlight.currentColor}),{caption:"--"},{template:_.template('<div id="id-toolbar-menu-form-color" style="width: 169px; height: 94px; margin: 10px;"></div>')},{template:_.template('<a id="id-toolbar-menu-new-form-color" style="padding-left:12px;">'+i.textNewColor+"</a>")}]})),i.mnuFormsColorPicker=new Common.UI.ThemeColorPalette({el:$("#id-toolbar-menu-form-color"),colors:["000000","993300","333300","003300","003366","000080","333399","333333","800000","FF6600","808000","00FF00","008080","0000FF","666699","808080","FF0000","FF9900","99CC00","339966","33CCCC","3366FF","800080","999999","FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0","FF99CC","FFCC99","FFFF99","CCFFCC","CCFFFF","99CCFF","CC99FF","FFFFFF"],value:i.btnHighlight.currentColor}),i.btnHighlight.setColor(i.btnHighlight.currentColor||"transparent")):i.btnHighlight.cmpEl.parents(".group").hide().prev(".separator").hide(),i.btnTextField.updateHint(i.tipTextField),i.btnComboBox.updateHint(i.tipComboBox),i.btnDropDown.updateHint(i.tipDropDown),i.btnCheckBox.updateHint(i.tipCheckBox),i.btnRadioBox.updateHint(i.tipRadioBox),i.btnImageField.updateHint(i.tipImageField),i.btnViewForm.updateHint(i.tipViewForm)):i.btnClear.updateHint(i.textClearFields),i.btnPrevForm.updateHint(i.tipPrevForm),i.btnNextForm.updateHint(i.tipNextForm),i.btnSubmit&&i.btnSubmit.updateHint(i.tipSubmit),t.call(i)})},getPanel:function(){this.$el=$(_.template('<section class="panel" data-tab="forms"><div class="group" style="display: none;"><span class="btn-slot text x-huge" id="slot-btn-form-field"></span><span class="btn-slot text x-huge" id="slot-btn-form-combobox"></span><span class="btn-slot text x-huge" id="slot-btn-form-dropdown"></span><span class="btn-slot text x-huge" id="slot-btn-form-checkbox"></span><span class="btn-slot text x-huge" id="slot-btn-form-radiobox"></span><span class="btn-slot text x-huge" id="slot-btn-form-image"></span></div><div class="separator long forms" style="display: none;"></div><div class="group no-group-mask inner-elset small" style="display: none;"><div class="elset no-group-mask form-view"><span class="btn-slot text" id="slot-form-clear-fields"></span></div><div class="elset"><span class="btn-slot text" id="slot-form-highlight"></span></div></div><div class="group no-group-mask form-view"><span class="btn-slot text x-huge" id="slot-btn-form-clear"></span><span class="btn-slot text x-huge" id="slot-btn-form-prev"></span><span class="btn-slot text x-huge" id="slot-btn-form-next"></span></div><div class="separator long submit" style="display: none;"></div><div class="group no-group-mask form-view" style="display: none;"><span class="btn-slot text x-huge" id="slot-btn-form-view"></span><span class="btn-slot text x-huge" id="slot-btn-form-submit"></span></div></section>')({}));var t=this.$el;if(this.appConfig.canSubmitForms&&this.btnSubmit.render(t.find("#slot-btn-form-submit")),this.appConfig.isRestrictedEdit&&this.appConfig.canFillForms)this.btnClear.render(t.find("#slot-btn-form-clear")),this.btnSubmit&&t.find(".separator.submit").show().next(".group").show();else{this.btnTextField.render(t.find("#slot-btn-form-field")),this.btnComboBox.render(t.find("#slot-btn-form-combobox")),this.btnDropDown.render(t.find("#slot-btn-form-dropdown")),this.btnCheckBox.render(t.find("#slot-btn-form-checkbox")),this.btnRadioBox.render(t.find("#slot-btn-form-radiobox")),this.btnImageField.render(t.find("#slot-btn-form-image")),this.btnViewForm.render(t.find("#slot-btn-form-view")),this.btnClearFields.render(t.find("#slot-form-clear-fields")),this.btnHighlight.render(t.find("#slot-form-highlight"));var e=t.find(".separator.forms");e.prev(".group").show(),e.show().next(".group").show(),t.find(".separator.submit").show().next(".group").show()}return this.btnPrevForm.render(t.find("#slot-btn-form-prev")),this.btnNextForm.render(t.find("#slot-btn-form-next")),this.$el},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButtons:function(){return this.paragraphControls},SetDisabled:function(t){this._state.disabled=t,this.paragraphControls.forEach(function(e){e&&e.setDisabled(t)},this)},capBtnText:"Text Field",capBtnComboBox:"Combo Box",capBtnDropDown:"Dropdown",capBtnCheckBox:"Checkbox",capBtnRadioBox:"Radio Button",capBtnImage:"Image",capBtnView:"Fill Form",textClearFields:"Clear All Fields",textHighlight:"Highlight Settings",tipTextField:"Insert text field",tipComboBox:"Insert combo box",tipDropDown:"Insert dropdown list",tipCheckBox:"Insert checkbox",tipRadioBox:"Insert radio button",tipImageField:"Insert image",tipViewForm:"View form",textNoHighlight:"No highlighting",textNewColor:"Add New Custom Color",textClear:"Clear Fields",capBtnPrev:"Previous Field",capBtnNext:"Next Field",capBtnSubmit:"Submit",tipPrevForm:"Go to the previous field",tipNextForm:"Go to the next field",tipSubmit:"Submit form",textSubmited:"Form submitted successfully",textRequired:"Fill all required fields to send form."}}(),DE.Views.FormsTab||{}))}),define("documenteditor/main/app/controller/FormsTab",["core","documenteditor/main/app/view/FormsTab"],function(){"use strict";DE.Controllers.FormsTab=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["FormsTab"],sdkViewName:"#id_main",initialize:function(){},onLaunch:function(){this._state={prcontrolsdisable:void 0}},setApi:function(t){return t&&(this.api=t,this.api.asc_registerCallback("asc_onFocusObject",this.onApiFocusObject.bind(this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this)),this.api.asc_registerCallback("asc_onChangeSpecialFormsGlobalSettings",_.bind(this.onChangeSpecialFormsGlobalSettings,this)),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this)),this.api.asc_registerCallback("asc_onStartAction",_.bind(this.onLongActionBegin,this)),this.api.asc_registerCallback("asc_onEndAction",_.bind(this.onLongActionEnd,this)),this.api.asc_registerCallback("asc_onError",_.bind(this.onError,this))),this},setConfig:function(t){this.toolbar=t.toolbar,this.appConfig=t.config,this.view=this.createView("FormsTab",{toolbar:this.toolbar.toolbar,config:t.config}),this.addListeners({FormsTab:{"forms:insert":this.onControlsSelect,"forms:new-color":this.onNewControlsColor,"forms:clear":this.onClearClick,"forms:no-color":this.onNoControlsColor,"forms:select-color":this.onSelectControlsColor,"forms:mode":this.onModeClick,"forms:goto":this.onGoTo,"forms:submit":this.onSubmitClick}})},SetDisabled:function(t){this.view&&this.view.SetDisabled(t)},createToolbarPanel:function(){return this.view.getPanel()},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onCoAuthoringDisconnect:function(){this.SetDisabled(!0)},onApiFocusObject:function(t){if(this.toolbar.editMode&&!this.appConfig.isRestrictedEdit){for(var e,i,n=-1,o=!1,s=!1;++n<t.length;)i=t[n].get_ObjectType(),e=t[n].get_ObjectValue(),i===Asc.c_oAscTypeSelectElement.Paragraph?o=e.get_Locked():i===Asc.c_oAscTypeSelectElement.Header&&(s=e.get_Locked());var a=this.api.asc_IsContentControl(),r=a?this.api.asc_GetContentControlProperties():null,l=a&&r?r.get_Lock():Asc.c_oAscSdtLockType.Unlocked,c=!(!a||!r)&&r.get_ContentControlType()==Asc.c_oAscSdtLevelType.Inline;void 0===l&&(l=Asc.c_oAscSdtLockType.Unlocked);var d=l==Asc.c_oAscSdtLockType.SdtContentLocked||l==Asc.c_oAscSdtLockType.ContentLocked,h=o||s||c||d;this._state.prcontrolsdisable!==h&&(this.view.btnTextField.setDisabled(h),this.view.btnComboBox.setDisabled(h),this.view.btnDropDown.setDisabled(h),this.view.btnCheckBox.setDisabled(h),this.view.btnRadioBox.setDisabled(h),this.view.btnImageField.setDisabled(h),this.view.btnTextField.setDisabled(h),this._state.prcontrolsdisable=h)}},onChangeSpecialFormsGlobalSettings:function(){if(this.view&&this.view.mnuFormsColorPicker){var t=this.api.asc_GetSpecialFormsHighlightColor(),e=!!t;this.view.mnuNoFormsColor.setChecked(!e,!0),this.view.mnuFormsColorPicker.clearSelection(),t&&(t=Common.Utils.ThemeColor.getHexColor(t.get_r(),t.get_g(),t.get_b()),this.view.mnuFormsColorPicker.selectByRGB(t,!0)),this.view.btnHighlight.currentColor=t,this.view.btnHighlight.setColor(this.view.btnHighlight.currentColor||"transparent")}},onControlsSelect:function(t){if(this.toolbar.mode&&this.toolbar.mode.canFeatureContentControl&&this.toolbar.mode.canFeatureForms){var e,i=new AscCommon.CSdtFormPr;this.toolbar.toolbar.fireEvent("insertcontrol",this.toolbar.toolbar),"picture"==t?this.api.asc_AddContentControlPicture(i):"checkbox"==t||"radiobox"==t?(e=new AscCommon.CSdtCheckBoxPr,"radiobox"==t&&e.put_GroupKey(this.toolbar.textGroup+" 1"),this.api.asc_AddContentControlCheckBox(e,i)):"combobox"==t||"dropdown"==t?this.api.asc_AddContentControlList("combobox"==t,e,i):"text"==t&&(e=new AscCommon.CSdtTextFormPr,this.api.asc_AddContentControlTextForm(e,i)),Common.NotificationCenter.trigger("edit:complete",this.toolbar)}},onModeClick:function(t){this.api&&(this.disableEditing(t),this.api.asc_setRestriction(t?Asc.c_oAscRestrictionType.OnlyForms:Asc.c_oAscRestrictionType.None),this.api.asc_SetPerformContentControlActionByClick(t),this.api.asc_SetHighlightRequiredFields(t)),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onClearClick:function(){this.api&&this.api.asc_ClearAllSpecialForms(),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onNewControlsColor:function(){this.view.mnuFormsColorPicker.addNewColor()},onNoControlsColor:function(t){t.isChecked()?this.api.asc_SetSpecialFormsHighlightColor():this.api.asc_SetSpecialFormsHighlightColor(201,200,255),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onSelectControlsColor:function(t){var e=Common.Utils.ThemeColor.getRgbColor(t);this.api&&this.api.asc_SetSpecialFormsHighlightColor(e.get_r(),e.get_g(),e.get_b()),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onGoTo:function(t){this.api&&this.api.asc_MoveToFillingForm("next"==t),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onSubmitClick:function(){if(!this.api.asc_IsAllRequiredFormsFilled()){var t=this;return void Common.UI.warning({msg:this.view.textRequired,callback:function(){t.api.asc_MoveToFillingForm(!0,!0,!0),Common.NotificationCenter.trigger("edit:complete",t.toolbar)}})}this.api.asc_SendForm(),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},disableEditing:function(t){if(this._state.DisabledEditing!=t){this._state.DisabledEditing=t;var e=this.getApplication(),i=e.getController("RightMenu");i.getView("RightMenu").clearSelection(),i.SetDisabled(t),e.getController("Toolbar").DisableToolbar(t,!1,!1,!0),e.getController("Statusbar").getView("Statusbar").SetDisabled(t),e.getController("Common.Controllers.ReviewChanges").SetDisabled(t),e.getController("DocumentHolder").getView().SetDisabled(t),e.getController("Navigation")&&e.getController("Navigation").SetDisabled(t),e.getController("LeftMenu").setPreviewMode(t)
;var n=e.getController("Common.Controllers.Comments");n&&n.setPreviewMode(t),this.view&&this.view.$el.find(".no-group-mask.form-view").css("opacity",1)}},onLongActionBegin:function(t,e){e==Asc.c_oAscAsyncAction.Submit&&this.view.btnSubmit&&(this._submitFail=!1,this.submitedTooltip&&this.submitedTooltip.hide(),this.view.btnSubmit.setDisabled(!0))},onLongActionEnd:function(t,e){e==Asc.c_oAscAsyncAction.Submit&&this.view.btnSubmit&&(this.view.btnSubmit.setDisabled(!1),this.submitedTooltip||(this.submitedTooltip=new Common.UI.SynchronizeTip({text:this.view.textSubmited,extCls:"no-arrow",showLink:!1,target:$(".toolbar"),placement:"bottom"}),this.submitedTooltip.on("closeclick",function(){this.submitedTooltip.hide()},this)),!this._submitFail&&this.submitedTooltip.show())},onError:function(t,e,i){t==Asc.c_oAscError.ID.Submit&&(this._submitFail=!0,this.submitedTooltip&&this.submitedTooltip.hide())},onAppReady:function(t){var e=this;new Promise(function(t,e){t()}).then(function(){if(t.canEditContentControl&&e.view.btnHighlight){var i=e.api.asc_GetSpecialFormsHighlightColor();i&&(i=Common.Utils.ThemeColor.getHexColor(i.get_r(),i.get_g(),i.get_b())),e.view.btnHighlight.currentColor=i}})}},DE.Controllers.FormsTab||{}))}),define("documenteditor/main/app/view/Links",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout"],function(){"use strict";DE.Views.Links=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;this.btnsContents.forEach(function(e){e.menu.on("item:click",function(e,i,n){t.fireEvent("links:contents",[i.value])}),e.on("click",function(e,i){t.fireEvent("links:contents",[0])}),e.menu.on("show:after",function(e,i){t.fireEvent("links:contents-open",[e])})}),this.contentsMenu.on("item:click",function(e,i,n){setTimeout(function(){t.fireEvent("links:contents",[i.value,!0])},10)}),this.contentsMenu.on("show:after",function(e,i){t.fireEvent("links:contents-open",[e])}),this.btnContentsUpdate.menu.on("item:click",function(e,i,n){t.fireEvent("links:update",[i.value])}),this.btnContentsUpdate.on("click",function(e,i){t.fireEvent("links:update",["all"])}),this.contentsUpdateMenu.on("item:click",function(e,i,n){setTimeout(function(){t.fireEvent("links:update",[i.value,!0])},10)}),this.btnsNotes.forEach(function(e){e.menu.on("item:click",function(e,i,n){t.fireEvent("links:notes",[i.value])}),e.on("click",function(e,i){t.fireEvent("links:notes",["ins_footnote"])}),e.menu.items[7].menu.on("item:click",function(e,i,n){t.fireEvent("links:notes",[i.value])})}),this.btnsPrevNote.forEach(function(e){e.on("click",function(e,i){t.fireEvent("links:notes",["prev"])})}),this.btnsNextNote.forEach(function(e){e.on("click",function(e,i){t.fireEvent("links:notes",["next"])})}),this.btnsPrevEndNote.forEach(function(e){e.on("click",function(e,i){t.fireEvent("links:notes",["prev-end"])})}),this.btnsNextEndNote.forEach(function(e){e.on("click",function(e,i){t.fireEvent("links:notes",["next-end"])})}),this.btnsHyperlink.forEach(function(e){e.on("click",function(e,i){t.fireEvent("links:hyperlink")})}),this.btnBookmarks.on("click",function(e,i){t.fireEvent("links:bookmarks")}),this.btnCaption.on("click",function(e,i){t.fireEvent("links:caption")}),this.btnCrossRef.on("click",function(e,i){t.fireEvent("links:crossref")}),this.btnTableFigures.on("click",function(e,i){t.fireEvent("links:tof")}),this.btnTableFiguresUpdate.on("click",function(e,i){t.fireEvent("links:tof-update")})}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this),this.toolbar=t.toolbar,this.btnsPrevNote=[],this.btnsNextNote=[],this.btnsPrevEndNote=[],this.btnsNextEndNote=[],this.paragraphControls=[];var e=this,i=e.toolbar.$el;this.btnsContents=Common.Utils.injectButtons(i.find(".btn-slot.btn-contents"),"","toolbar__icon btn-contents",e.capBtnInsContents,void 0,!0,!0),this.btnsNotes=Common.Utils.injectButtons(i.find(".btn-slot.slot-notes"),"","toolbar__icon btn-notes",e.capBtnInsFootnote,void 0,!0,!0),this.btnsHyperlink=Common.Utils.injectButtons(i.find(".btn-slot.slot-inshyperlink"),"","toolbar__icon btn-inserthyperlink",e.capBtnInsLink),Array.prototype.push.apply(this.paragraphControls,this.btnsContents.concat(this.btnsNotes,this.btnsHyperlink)),this.btnContentsUpdate=new Common.UI.Button({parentEl:i.find("#slot-btn-contents-update"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-update",caption:this.capBtnContentsUpdate,split:!0,menu:!0,disabled:!0}),this.paragraphControls.push(this.btnContentsUpdate),this.btnBookmarks=new Common.UI.Button({parentEl:i.find("#slot-btn-bookmarks"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-bookmarks",caption:this.capBtnBookmarks,disabled:!0}),this.paragraphControls.push(this.btnBookmarks),this.btnCaption=new Common.UI.Button({parentEl:i.find("#slot-btn-caption"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-caption",caption:this.capBtnCaption,disabled:!0}),this.paragraphControls.push(this.btnCaption),this.btnCrossRef=new Common.UI.Button({parentEl:i.find("#slot-btn-crossref"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-cross-reference",caption:this.capBtnCrossRef,disabled:!0}),this.paragraphControls.push(this.btnCrossRef),this.btnTableFigures=new Common.UI.Button({parentEl:i.find("#slot-btn-tof"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-contents",caption:this.capBtnTOF,disabled:!0}),this.paragraphControls.push(this.btnTableFigures),this.btnTableFiguresUpdate=new Common.UI.Button({parentEl:i.find("#slot-btn-tof-update"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-update",caption:this.capBtnContentsUpdate,disabled:!0}),this.paragraphControls.push(this.btnTableFiguresUpdate),this._state={disabled:!1},Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return this},onAppReady:function(e){var i=this;new Promise(function(t,e){t()}).then(function(){var e=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem" class="item-contents"><div id="<%= options.previewId %>"></div></a>');i.btnsContents.forEach(function(t){t.updateHint(i.tipContents);var n=new Common.UI.Menu({cls:"toc-menu shifted-left",items:[{template:e,offsety:0,value:0,previewId:"id-toolbar-toc-0"},{template:e,offsety:72,value:1,previewId:"id-toolbar-toc-1"},{caption:i.textContentsSettings,value:"settings"},{caption:i.textContentsRemove,value:"remove"}]});t.setMenu(n)}),i.contentsMenu=new Common.UI.Menu({cls:"toc-menu shifted-left",items:[{template:e,offsety:0,value:0,previewId:"id-toolbar-toc-menu-0"},{template:e,offsety:72,value:1,previewId:"id-toolbar-toc-menu-1"},{caption:i.textContentsSettings,value:"settings"},{caption:i.textContentsRemove,value:"remove"}]}),i.btnContentsUpdate.updateHint([i.textUpdateAll,i.tipContentsUpdate]),i.btnContentsUpdate.setMenu(new Common.UI.Menu({items:[{caption:i.textUpdateAll,value:"all"},{caption:i.textUpdatePages,value:"pages"}]})),i.contentsUpdateMenu=new Common.UI.Menu({items:[{caption:i.textUpdateAll,value:"all"},{caption:i.textUpdatePages,value:"pages"}]}),i.btnsNotes.forEach(function(t,e){t.updateHint(i.tipNotes);var n=new Common.UI.Menu({items:[{caption:i.mniInsFootnote,value:"ins_footnote"},{caption:i.mniInsEndnote,value:"ins_endnote"},{caption:"--"},new Common.UI.MenuItem({template:_.template(['<div class="menu-zoom" style="height: 25px;" ',"<% if(!_.isUndefined(options.stopPropagation)) { %>",'data-stopPropagation="true"',"<% } %>",">",'<label class="title">'+i.textGotoFootnote+"</label>",'<button id="id-menu-goto-footnote-next-'+e+'" type="button" style="float:right; margin: 2px 5px 0 0;" class="btn small btn-toolbar"><i class="icon menu__icon btn-nextitem">&nbsp;</i></button>','<button id="id-menu-goto-footnote-prev-'+e+'" type="button" style="float:right; margin-top: 2px;" class="btn small btn-toolbar"><i class="icon menu__icon btn-previtem">&nbsp;</i></button>',"</div>"].join("")),stopPropagation:!0}),new Common.UI.MenuItem({template:_.template(['<div class="menu-zoom" style="height: 25px;" ',"<% if(!_.isUndefined(options.stopPropagation)) { %>",'data-stopPropagation="true"',"<% } %>",">",'<label class="title">'+i.textGotoEndnote+"</label>",'<button id="id-menu-goto-endnote-next-'+e+'" type="button" style="float:right; margin: 2px 5px 0 0;" class="btn small btn-toolbar"><i class="icon menu__icon btn-nextitem">&nbsp;</i></button>','<button id="id-menu-goto-endnote-prev-'+e+'" type="button" style="float:right; margin-top: 2px;" class="btn small btn-toolbar"><i class="icon menu__icon btn-previtem">&nbsp;</i></button>',"</div>"].join("")),stopPropagation:!0}),{caption:"--"},{caption:i.mniDelFootnote,value:"delele"},{caption:i.mniConvertNote,value:"convert",menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:i.textConvertToEndnotes,value:"to-endnotes"},{caption:i.textConvertToFootnotes,value:"to-footnotes"},{caption:i.textSwapNotes,value:"swap"}]})},{caption:i.mniNoteSettings,value:"settings"}]});t.setMenu(n),i.btnsPrevNote.push(new Common.UI.Button({el:$("#id-menu-goto-footnote-prev-"+e),cls:"btn-toolbar"})),i.btnsNextNote.push(new Common.UI.Button({el:$("#id-menu-goto-footnote-next-"+e),cls:"btn-toolbar"})),i.btnsPrevEndNote.push(new Common.UI.Button({el:$("#id-menu-goto-endnote-prev-"+e),cls:"btn-toolbar"})),i.btnsNextEndNote.push(new Common.UI.Button({el:$("#id-menu-goto-endnote-next-"+e),cls:"btn-toolbar"}))}),i.btnsHyperlink.forEach(function(t){t.updateHint(i.tipInsertHyperlink+Common.Utils.String.platformKey("Ctrl+K"))}),i.btnBookmarks.updateHint(i.tipBookmarks),i.btnCaption.updateHint(i.tipCaption),i.btnCrossRef.updateHint(i.tipCrossRef),i.btnTableFigures.updateHint(i.tipTableFigures),i.btnTableFiguresUpdate.updateHint(i.tipTableFiguresUpdate),t.call(i)})},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButtons:function(){return this.paragraphControls},SetDisabled:function(t){this._state.disabled=t,this.paragraphControls.forEach(function(e){e&&e.setDisabled(t)},this)},capBtnInsContents:"Table of Contents",tipContents:"Insert table of contents",textContentsSettings:"Settings",textContentsRemove:"Remove table of contents",capBtnContentsUpdate:"Refresh",tipContentsUpdate:"Refresh table of contents",textUpdateAll:"Refresh entire table",textUpdatePages:"Refresh page numbers only",tipNotes:"Footnotes",mniInsFootnote:"Insert Footnote",mniDelFootnote:"Delete All Notes",mniNoteSettings:"Notes Settings",textGotoFootnote:"Go to Footnotes",capBtnInsFootnote:"Footnotes",confirmDeleteFootnotes:"Do you want to delete all footnotes?",capBtnInsLink:"Hyperlink",tipInsertHyperlink:"Add Hyperlink",capBtnBookmarks:"Bookmark",tipBookmarks:"Create a bookmark",capBtnCaption:"Caption",tipCaption:"Insert caption",mniConvertNote:"Convert All Notes",textGotoEndnote:"Go to Endnotes",mniInsEndnote:"Insert Endnote",textConvertToEndnotes:"Convert All Footnotes to Endnotes",textConvertToFootnotes:"Convert All Endnotes to Footnotes",textSwapNotes:"Swap Footnotes and Endnotes",capBtnCrossRef:"Cross-reference",tipCrossRef:"Insert cross-reference",capBtnTOF:"Table of Figures",tipTableFiguresUpdate:"Refresh table of figures",tipTableFigures:"Insert table of figures",confirmReplaceTOF:"Do you want to replace the selected table of figures?",titleUpdateTOF:"Refresh Table of Figures"}}(),DE.Views.Links||{}))}),define("documenteditor/main/app/view/NoteSettingsDialog",["common/main/lib/util/utils","common/main/lib/component/MetricSpinner","common/main/lib/component/ComboBox","common/main/lib/view/AdvancedSettingsWindow"],function(){"use strict";DE.Views.NoteSettingsDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:300,height:395,buttons:null},initialize:function(t){var e=this;_.extend(this.options,{title:this.textTitle,template:['<div class="box" style="height:'+(e.options.height-85)+'px;">','<div class="content-panel" style="padding: 0 5px;"><div class="inner-content">','<div class="settings-panel active">','<table cols="1" style="width: 100%;">',"<tr>",'<td class="padding-small">','<label class="header">',e.textLocation,"</label>","</td>","</tr>","<tr>",'<td class="padding-small">','<div id="note-settings-radio-foot" style="margin-top: 4px;display: inline-block"></div>','<div id="note-settings-combo-footnote" class="input-group-nr" style="display: inline-block; width:150px;float:right;"></div>',"</td>","</tr>","<tr>",'<td class="padding-large">','<div id="note-settings-radio-end" style="margin-top: 4px;display: inline-block"></div>','<div id="note-settings-combo-endnote" class="input-group-nr" style="display: inline-block; width:150px;float:right;"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<label class="header">',e.textFormat,"</label>","</td>","</tr>","<tr>",'<td class="padding-small">','<div style="display: inline-block; margin-right: 10px; vertical-align: middle;">','<label class="input-label">',e.textNumFormat,"</label>",'<div id="note-settings-combo-format" class="input-group-nr" style="width:150px;"></div>',"</div>",'<div style="display: inline-block; vertical-align: middle;">','<label class="input-label">',e.textStart,"</label>",'<div id="note-settings-spin-start"></div>',"</div>","</td>","</tr>","<tr>",'<td class="padding-small">','<label class="input-label">',e.textNumbering,"</label>",'<div id="note-settings-combo-numbering" class="input-group-nr" style="width:150px;"></div>',"</td>","</tr>","<tr>",'<td class="padding-large">','<label class="input-label">',e.textCustom,"</label>",'<div id="note-settings-txt-custom"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<label class="header">',e.textApplyTo,"</label>",'<div id="note-settings-combo-apply" class="input-group-nr" style="width:150px;"></div>',"</td>","</tr>","</table>","</div></div>","</div>","</div>",'<div class="footer center">','<button class="btn normal dlg-btn primary" result="insert" style="width: 86px;">'+e.textInsert+"</button>",'<button id="note-settings-btn-apply" class="btn normal dlg-btn" result="apply" style="width: 86px;">'+e.textApply+"</button>",'<button class="btn normal dlg-btn" result="cancel" style="width: 86px;">'+e.cancelButtonText+"</button>","</div>"].join("")},t),this.api=t.api,this.handler=t.handler,this.props=t.props,this.isEndNote=t.isEndNote||!1,this.hasSections=t.hasSections||!1,Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this._state={footnote:{numbering:Asc.c_oAscFootnoteRestart.Continuous,format:Asc.c_oAscNumberingFormat.Decimal,start:1},endnote:{numbering:Asc.c_oAscFootnoteRestart.Continuous,format:Asc.c_oAscNumberingFormat.LowerRoman,start:1}}},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.radioFootnote=new Common.UI.RadioBox({el:$("#note-settings-radio-foot"),name:"asc-radio-notes",labelText:this.textFootnote,checked:!0}),this.radioFootnote.on("change",function(e,i,n){i&&(t.changeNoteType(!1),setTimeout(function(){t.cmbFootnote.focus()},1))}),this.radioEndnote=new Common.UI.RadioBox({el:$("#note-settings-radio-end"),labelText:this.textEndnote,name:"asc-radio-notes"}),this.radioEndnote.on("change",function(e,i,n){i&&(t.changeNoteType(!0),setTimeout(function(){t.cmbEndnote.focus()},1))}),this.cmbFootnote=new Common.UI.ComboBox({el:$("#note-settings-combo-footnote"),cls:"input-group-nr",menuStyle:"min-width: 150px;",editable:!1,takeFocusOnClose:!0,data:[{displayValue:this.textPageBottom,value:Asc.c_oAscFootnotePos.PageBottom},{displayValue:this.textTextBottom,value:Asc.c_oAscFootnotePos.BeneathText}]}),this.cmbFootnote.setValue(Asc.c_oAscFootnotePos.PageBottom),this.cmbEndnote=new Common.UI.ComboBox({el:$("#note-settings-combo-endnote"),cls:"input-group-nr",menuStyle:"min-width: 150px;",editable:!1,takeFocusOnClose:!0,data:[{displayValue:this.textSectEnd,value:Asc.c_oAscEndnotePos.SectEnd},{displayValue:this.textDocEnd,value:Asc.c_oAscEndnotePos.DocEnd}]}),this.cmbEndnote.setValue(Asc.c_oAscEndnotePos.DocEnd),this.cmbFormat=new Common.UI.ComboBox({el:$("#note-settings-combo-format"),cls:"input-group-nr",menuStyle:"min-width: 150px;",editable:!1,takeFocusOnClose:!0,data:[{displayValue:"1, 2, 3,...",value:Asc.c_oAscNumberingFormat.Decimal,maskExp:/[0-9]/,defValue:1},{displayValue:"a, b, c,...",value:Asc.c_oAscNumberingFormat.LowerLetter,maskExp:/[a-z]/,defValue:"a"},{displayValue:"A, B, C,...",value:Asc.c_oAscNumberingFormat.UpperLetter,maskExp:/[A-Z]/,defValue:"A"},{displayValue:"i, ii, iii,...",value:Asc.c_oAscNumberingFormat.LowerRoman,maskExp:/[ivxlcdm]/,defValue:"i"},{displayValue:"I, II, III,...",value:Asc.c_oAscNumberingFormat.UpperRoman,maskExp:/[IVXLCDM]/,defValue:"I"}]}),this.cmbFormat.setValue(this._state.footnote.format),this.cmbFormat.on("selected",_.bind(this.onFormatSelect,this)),this.spnStart=new Common.UI.CustomSpinner({el:$("#note-settings-spin-start"),step:1,width:85,defaultUnit:"",value:1,maxValue:16383,minValue:1,allowDecimal:!1,maskExp:/[0-9]/}),this.spnStart.on("change",function(e,i,n,o){e.getNumberValue()>1&&t.cmbNumbering.getValue()!==Asc.c_oAscFootnoteRestart.Continuous&&t.cmbNumbering.setValue(Asc.c_oAscFootnoteRestart.Continuous)}),this._arrNumbering=[{displayValue:this.textContinue,value:Asc.c_oAscFootnoteRestart.Continuous},{displayValue:this.textEachSection,value:Asc.c_oAscFootnoteRestart.EachSect},{displayValue:this.textEachPage,value:Asc.c_oAscFootnoteRestart.EachPage}],this.cmbNumbering=new Common.UI.ComboBox({el:$("#note-settings-combo-numbering"),cls:"input-group-nr",menuStyle:"min-width: 150px;",editable:!1,takeFocusOnClose:!0,data:this._arrNumbering}),this.cmbNumbering.setValue(Asc.c_oAscFootnoteRestart.Continuous),this.cmbNumbering.on("selected",function(e,i){i.value!=Asc.c_oAscFootnoteRestart.EachSect&&i.value!=Asc.c_oAscFootnoteRestart.EachPage||t.spnStart.setValue(1,!0)}),this.txtCustom=new Common.UI.InputField({el:$("#note-settings-txt-custom"),allowBlank:!0,validateOnChange:!0,validateOnBlur:!1,style:"width: 85px; vertical-align: middle;",value:""}).on("changing",function(e,i){t.cmbFormat.setDisabled(i.length>0),t.spnStart.setDisabled(i.length>0),t.btnApply.setDisabled(i.length>0)});var e=this.hasSections?[{displayValue:this.textSection,value:0}]:[];e.push({displayValue:this.textDocument,value:1}),this.cmbApply=new Common.UI.ComboBox({el:$("#note-settings-combo-apply"),cls:"input-group-nr",menuStyle:"min-width: 150px;",editable:!1,takeFocusOnClose:!0,data:e}),this.cmbApply.setValue(e[0].value),this.btnApply=new Common.UI.Button({el:$("#note-settings-btn-apply")}),this.afterRender()},getFocusedComponents:function(){return[this.radioFootnote,this.cmbFootnote,this.radioEndnote,this.cmbEndnote,this.cmbFormat,this.spnStart,this.cmbNumbering,this.txtCustom,this.cmbApply]},getDefaultFocusableComponent:function(){return this.cmbFormat},afterRender:function(){this._setDefaults(this.props)},_setDefaults:function(t){if(this.isEndNote?this.radioEndnote.setValue(!0,!0):this.radioFootnote.setValue(!0,!0),this.changeNoteType(this.isEndNote),t){var e=t.get_Pos();this.isEndNote?this.cmbEndnote.setValue(e):this.cmbFootnote.setValue(e),e=t.get_NumFormat(),this.cmbFormat.setValue(e),this.onFormatSelect(this.cmbFormat,this.cmbFormat.getSelectedRecord()),e=t.get_NumStart(),this.spnStart.setValue(e),e=t.get_NumRestart(),this.cmbNumbering.setValue(e)}},getSettings:function(){var t=new Asc.CAscFootnotePr;t.put_Pos(this.isEndNote?this.cmbEndnote.getValue():this.cmbFootnote.getValue()),t.put_NumRestart(this.cmbNumbering.getValue());var e=this.txtCustom.getValue();return _.isEmpty(e)&&(e=this.cmbFormat.getValue(),t.put_NumFormat(e),t.put_NumStart(this.spnStart.getNumberValue())),{props:t,applyToAll:1==this.cmbApply.getValue(),custom:_.isEmpty(e)?void 0:e,isEndNote:this.isEndNote}},onDlgBtnClick:function(t){this._handleInput("object"==typeof t?t.currentTarget.attributes.result.value:t)},onPrimary:function(){return this._handleInput("insert"),!1},_handleInput:function(t){this.handler&&this.handler.call(this,t,"insert"==t||"apply"==t?this.getSettings():void 0),this.close()},onFormatSelect:function(t,e){if(e){this.spnStart.setMask(e.maskExp);var i=this;switch(e.value){case Asc.c_oAscNumberingFormat.UpperRoman:this.spnStart.options.toCustomFormat=this._10toRome,this.spnStart.options.fromCustomFormat=this._Rometo10;break;case Asc.c_oAscNumberingFormat.LowerRoman:this.spnStart.options.toCustomFormat=function(t){return i._10toRome(t).toLocaleLowerCase()},this.spnStart.options.fromCustomFormat=function(t){return i._Rometo10(t.toLocaleUpperCase())};break;case Asc.c_oAscNumberingFormat.UpperLetter:this.spnStart.options.toCustomFormat=this._10toS,this.spnStart.options.fromCustomFormat=this._Sto10;break;case Asc.c_oAscNumberingFormat.LowerLetter:this.spnStart.options.toCustomFormat=function(t){return i._10toS(t).toLocaleLowerCase()},this.spnStart.options.fromCustomFormat=function(t){return i._Sto10(t.toLocaleUpperCase())};break;default:this.spnStart.options.toCustomFormat=function(t){return t},this.spnStart.options.fromCustomFormat=function(t){return t}}this.spnStart.setValue(this.spnStart.getValue()),this._state[this.isEndNote?"endnote":"footnote"].format=e.value}},_10toS:function(t){t=parseInt(t);for(var e=Math.ceil(t/26),i=String.fromCharCode((t-1)%26+"A".charCodeAt(0)),n="",o=0;o<e;o++)n+=i;return n},_Sto10:function(t){if(t.length<1||new RegExp("[^"+t.charAt(0)+"]").test(t)||!/[A-Z]/.test(t))return 1;var e=t.length-1,i=t.charCodeAt(0)-"A".charCodeAt(0)+1;return i+=26*e},_10toRome:function(t){t=parseInt(t);for(var e="",i=[["M",1e3],["CM",900],["D",500],["CD",400],["C",100],["XC",90],["L",50],["XL",40],["X",10],["IX",9],["V",5],["IV",4],["I",1]],n=i[0][1],o=Math.floor(t/n),s=0,a=0;a<o;a++)e+=i[s][0];for(t-=o*n,s++;t>0;)n=i[s][1],o=t-n,o>=0?(e+=i[s][0],t=o):s++;return e},_Rometo10:function(t){if(!/[IVXLCDM]/.test(t)||t.length<1)return 1;for(var e={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3},i=t.length-1,n=e[t.charAt(i)],o=n,s=i-1;s>=0;s--){var a=e[t.charAt(s)];if(a<o){if(o/a>10)return 1;a*=-1}n+=a,o=Math.abs(a)}return n},changeNoteType:function(t){this._state[this.isEndNote?"endnote":"footnote"].start=this.spnStart.getNumberValue(),this._state[this.isEndNote?"endnote":"footnote"].numbering=this.cmbNumbering.getValue(),this.isEndNote=t,this.cmbFootnote.setDisabled(t),this.cmbEndnote.setDisabled(!t);var e=this._state[t?"endnote":"footnote"],i=t?this._arrNumbering.slice(0,2):this._arrNumbering;this.cmbNumbering.setData(i),this.cmbNumbering.setValue(e.numbering),this.cmbFormat.setValue(e.format),this.onFormatSelect(this.cmbFormat,this.cmbFormat.getSelectedRecord()),this.spnStart.setValue(e.start)},textTitle:"Notes Settings",textLocation:"Location",textFootnote:"Footnote",textPageBottom:"Bottom of page",textTextBottom:"Below text",textFormat:"Format",textNumFormat:"Number Format",textStart:"Start at",textNumbering:"Numbering",textContinue:"Continuous",textEachPage:"Restart each page",textEachSection:"Restart each section",textApplyTo:"Apply changes to",textDocument:"Whole document",textSection:"Current section",textApply:"Apply",textInsert:"Insert",textCustom:"Custom Mark",textSectEnd:"End of section",textDocEnd:"End of document",textEndnote:"Endnote"},DE.Views.NoteSettingsDialog||{}))}),define("documenteditor/main/app/view/TableOfContentsSettings",["common/main/lib/util/utils","common/main/lib/component/MetricSpinner","common/main/lib/component/ComboBox","common/main/lib/view/AdvancedSettingsWindow"],function(){"use strict";DE.Views.TableOfContentsSettings=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:500,height:455},initialize:function(t){var e=this,i=t.type?385:455;_.extend(this.options,{title:t.type?this.textTitleTOF:this.textTitle,height:i,template:['<div class="box" style="height:'+(i-85)+'px;">','<div class="content-panel" style="padding: 15px 10px;"><div class="inner-content">','<div class="settings-panel active">','<table cols="2" style="width: 100%;">',"<tr>",'<td class="padding-small">','<div id="tableofcontents-chb-pages"></div>',"</td>",'<td rowspan="5" class="padding-small" style="vertical-align: top;">','<div class="canvas-box" style="width: 240px; height: 182px; float: right;position:relative;overflow:hidden;">','<div id="tableofcontents-img" style="width: 230px; height: 100%;"></div>',"</div>","</td>","</tr>","<tr>",'<td class="padding-small">','<div id="tableofcontents-chb-align"></div>',"</td>","</tr>","<tr>",'<td class="padding-large">','<label class="input-label">'+e.textLeader+"</label>",'<div id="tableofcontents-combo-leader" class="input-group-nr" style="display: inline-block; width:95px; margin-left: 10px;"></div>',"</td>","</tr>","<tr>",'<td class="padding-large">','<div id="tableofcontents-chb-links"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">',"<% if (type == 1) { %>",'<label class="input-label padding-small" style="display: block;">'+e.textBuildTableOF+"</label>",'<div id="tableofcontents-radio-caption" class="padding-small" style="display: block;"></div>','<div id="tableofcontents-radio-style" class="" style="display: block;"></div>',"<% } else { %>",'<label class="input-label padding-small" style="display: block;">'+e.textBuildTable+"</label>",'<div id="tableofcontents-radio-levels" class="padding-small" style="display: block;"></div>','<div id="tableofcontents-radio-styles" class="" style="display: block;"></div>',"<% } %>","</td>","</tr>","<tr>",'<td class="padding-small" style="vertical-align: top;">',"<% if (type == 1) { %>",'<div id="tableofcontents-tof-from-caption" style="width:220px;">','<div id="tableofcontents-combo-captions" style="display: inline-block; width:129px; margin-bottom: 10px;"></div>',"</div>",'<div id="tableofcontents-tof-from-style" style="width:220px;" class="hidden">','<div id="tableofcontents-combo-tof-styles" style="display: inline-block; width:129px; margin-bottom: 10px;"></div>',"</div>",'<div id="tableofcontents-chb-full-caption"></div>',"<% } else { %>",'<div id="tableofcontents-from-levels" style="width:220px;">','<label class="input-label">'+e.textLevels+"</label>",'<div id="tableofcontents-spin-levels" style="display: inline-block; width:95px; margin-left: 10px;"></div>',"</div>",'<div id="tableofcontents-from-styles" class="hidden">','<table><tr><td style="height: 25px;">','<label class="input-label" style="width: 144px; margin-left: 23px;">'+e.textStyle+"</label>",'<label class="input-label" style="">'+e.textLevel+"</label>","</td></tr>","<tr><td>",'<div id="tableofcontents-styles-list" class="header-styles-tableview" style="width:100%; height: 121px;"></div>',"</td></tr></table>","</div>","<% } %>","</td>",'<td class="padding-small" style="vertical-align: top;">','<label class="input-label" style="margin-left: 10px;">'+e.textStyles+"</label>",'<div id="tableofcontents-combo-styles" class="input-group-nr" style="display: inline-block; width:95px; margin-left: 10px;"></div>',"</td>","</tr>","</table>","</div></div>","</div>","</div>",'<div class="separator horizontal"></div>'].join("")},t),this.api=t.api,this.handler=t.handler,this.props=t.props,this.type=t.type||0,this.startLevel=1,this.endLevel=3,this._noApply=!0,this._originalProps=null,Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.chPages=new Common.UI.CheckBox({el:$("#tableofcontents-chb-pages"),labelText:this.strShowPages,value:"checked"}),this.chPages.on("change",_.bind(function(t,e,i,n){var o="checked"==t.getValue(),s=1==this.type&&this.cmbStyles.getValue()==Asc.c_oAscTOFStylesType.Centered;if(this.chAlign.setDisabled(!o||s),this.cmbLeader.setDisabled(!o||s),this.api&&!this._noApply){var a=this._originalProps?this._originalProps:new Asc.CTableOfContentsPr;a.put_ShowPageNumbers(o),o&&!s&&(a.put_RightAlignTab("checked"==this.chAlign.getValue()),a.put_TabLeader(this.cmbLeader.getValue())),1==this.type?this.api.SetDrawImagePlaceTableOfFigures("tableofcontents-img",a):this.api.SetDrawImagePlaceContents("tableofcontents-img",a),this.scrollerY.update()}},this)),this.chAlign=new Common.UI.CheckBox({el:$("#tableofcontents-chb-align"),labelText:this.strAlign,value:"checked"}),this.chAlign.on("change",_.bind(function(t,e,i,n){var o="checked"==t.getValue();if(this.cmbLeader.setDisabled(!o),this.api&&!this._noApply){var s=this._originalProps?this._originalProps:new Asc.CTableOfContentsPr;s.put_RightAlignTab(o),o&&s.put_TabLeader(this.cmbLeader.getValue()),1==this.type?this.api.SetDrawImagePlaceTableOfFigures("tableofcontents-img",s):this.api.SetDrawImagePlaceContents("tableofcontents-img",s),this.scrollerY.update()}},this)),this.cmbLeader=new Common.UI.ComboBox({el:$("#tableofcontents-combo-leader"),style:"width: 85px;",menuStyle:"min-width: 85px;",editable:!1,takeFocusOnClose:!0,cls:"input-group-nr",data:[{value:Asc.c_oAscTabLeader.None,displayValue:this.textNone},{value:Asc.c_oAscTabLeader.Dot,displayValue:"...................."},{value:Asc.c_oAscTabLeader.Hyphen,displayValue:"-----------------"},{value:Asc.c_oAscTabLeader.Underscore,displayValue:"__________"}]}),this.cmbLeader.setValue(Asc.c_oAscTabLeader.Dot),this.cmbLeader.on("selected",_.bind(function(t,e){if(this.api&&!this._noApply){var i=this._originalProps?this._originalProps:new Asc.CTableOfContentsPr;i.put_TabLeader(e.value),1==this.type?this.api.SetDrawImagePlaceTableOfFigures("tableofcontents-img",i):this.api.SetDrawImagePlaceContents("tableofcontents-img",i),this.scrollerY.update()}},this)),this.chLinks=new Common.UI.CheckBox({el:$("#tableofcontents-chb-links"),labelText:1==this.type?this.strLinksOF:this.strLinks,value:"checked"}),this.chLinks.on("change",_.bind(function(t,e,i,n){if(this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.CTableOfContentsPr;o.put_Hyperlink("checked"==t.getValue()),1==this.type?this.api.SetDrawImagePlaceTableOfFigures("tableofcontents-img",o):this.api.SetDrawImagePlaceContents("tableofcontents-img",o),this.scrollerY.update()}},this)),1==this.type?(this.radioCaption=new Common.UI.RadioBox({el:$("#tableofcontents-radio-caption"),labelText:this.textRadioCaption,name:"asc-radio-content-tof-build",checked:!0}),this.radioCaption.on("change",_.bind(function(t,e,i){e&&(this.captionContainer.toggleClass("hidden",!e),this.styleContainer.toggleClass("hidden",e),this.changeCaption(this.cmbCaptions.getSelectedRecord()),this.disableButtons())},this)),this.radioStyle=new Common.UI.RadioBox({el:$("#tableofcontents-radio-style"),labelText:this.textRadioStyle,name:"asc-radio-content-tof-build"}),this.radioStyle.on("change",_.bind(function(t,e,i){e&&(this.styleContainer.toggleClass("hidden",!e),this.captionContainer.toggleClass("hidden",e),this.changeTOFStyle(this.cmbTOFStyles.getSelectedRecord()),this.disableButtons())},this)),this.cmbCaptions=new Common.UI.ComboBox({el:$("#tableofcontents-combo-captions"),cls:"input-group-nr",menuStyle:"min-width: 100%;max-height: 233px;",editable:!1,takeFocusOnClose:!0,data:[]}),this.cmbCaptions.on("selected",_.bind(function(t,e){this.changeCaption(e),this.disableButtons()},this)),this.cmbTOFStyles=new Common.UI.ComboBox({el:$("#tableofcontents-combo-tof-styles"),cls:"input-group-nr",menuStyle:"min-width: 100%;max-height: 233px;",editable:!1,takeFocusOnClose:!0,data:[]}),this.cmbTOFStyles.on("selected",_.bind(function(t,e){this.changeTOFStyle(e)},this)),this.chFullCaption=new Common.UI.CheckBox({el:$("#tableofcontents-chb-full-caption"),labelText:this.strFullCaption,value:"checked"}),this.chFullCaption.on("change",_.bind(function(t,e,i,n){if(this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.CTableOfContentsPr;o.put_IncludeLabelAndNumber("checked"==t.getValue()),this.api.SetDrawImagePlaceTableOfFigures("tableofcontents-img",o),this.scrollerY.update()}},this)),this.captionContainer=$("#tableofcontents-tof-from-caption"),this.styleContainer=$("#tableofcontents-tof-from-style")):(this.radioLevels=new Common.UI.RadioBox({el:$("#tableofcontents-radio-levels"),labelText:this.textRadioLevels,
name:"asc-radio-content-build",checked:!0}),this.radioLevels.on("change",_.bind(function(t,e,i){e&&(this.levelsContainer.toggleClass("hidden",!e),this.stylesContainer.toggleClass("hidden",e),this._needUpdateOutlineLevels&&this.synchronizeLevelsFromStyles())},this)),this.radioStyles=new Common.UI.RadioBox({el:$("#tableofcontents-radio-styles"),labelText:this.textRadioStyles,name:"asc-radio-content-build"}),this.radioStyles.on("change",_.bind(function(e,i,n){i&&(this.stylesContainer.toggleClass("hidden",!i),this.levelsContainer.toggleClass("hidden",i),this._needUpdateStyles&&this.synchronizeLevelsFromOutline(),this.stylesList.scroller.update({alwaysVisibleY:!0}),setTimeout(function(){var e=t.stylesLevels.findWhere({checked:!0});e&&t.stylesList.scrollToRecord(e)},10))},this)),this.spnLevels=new Common.UI.CustomSpinner({el:$("#tableofcontents-spin-levels"),step:1,width:85,defaultUnit:"",value:this.endLevel,maxValue:9,minValue:1,allowDecimal:!1,maskExp:/[1-9]/}),this.spnLevels.on("change",_.bind(function(t,e,i,n){if(this._needUpdateStyles=!0,this.startLevel=1,this.endLevel=t.getNumberValue(),this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.CTableOfContentsPr;o.clear_Styles(),o.put_OutlineRange(this.startLevel,this.endLevel),this.api.SetDrawImagePlaceContents("tableofcontents-img",o),this.scrollerY.update()}},this)),this.stylesLevels=new Common.UI.DataViewStore,this.stylesLevels&&(this.stylesList=new Common.UI.ListView({el:$("#tableofcontents-styles-list",this.$window),store:this.stylesLevels,simpleAddMode:!0,showLast:!1,tabindex:1,template:_.template(['<div class="listview inner" style=""></div>'].join("")),itemTemplate:_.template(['<div id="<%= id %>" class="list-item">','<div class="<% if (checked) { %>checked<% } %>"><%= displayValue %></div>',"<div>",'<div class="input-field" style="width:40px;"><input type="text" class="form-control" value="<%= value %>" style="text-align: right;" maxLength="1">',"</div>","</div>","</div>"].join(""))}),this.stylesList.on("item:change",_.bind(this.onItemChange,this)),this.stylesList.on("item:add",_.bind(this.addEvents,this))),this.levelsContainer=$("#tableofcontents-from-levels"),this.stylesContainer=$("#tableofcontents-from-styles"));var e=1==this.type?[{displayValue:this.txtCurrent,value:Asc.c_oAscTOFStylesType.Current},{displayValue:this.txtSimple,value:Asc.c_oAscTOFStylesType.Simple},{displayValue:this.txtOnline,value:Asc.c_oAscTOFStylesType.Web},{displayValue:this.txtClassic,value:Asc.c_oAscTOFStylesType.Classic},{displayValue:this.txtDistinctive,value:Asc.c_oAscTOFStylesType.Distinctive},{displayValue:this.txtCentered,value:Asc.c_oAscTOFStylesType.Centered},{displayValue:this.txtFormal,value:Asc.c_oAscTOFStylesType.Formal}]:[{displayValue:this.txtCurrent,value:Asc.c_oAscTOCStylesType.Current},{displayValue:this.txtSimple,value:Asc.c_oAscTOCStylesType.Simple},{displayValue:this.txtOnline,value:Asc.c_oAscTOCStylesType.Web},{displayValue:this.txtStandard,value:Asc.c_oAscTOCStylesType.Standard},{displayValue:this.txtModern,value:Asc.c_oAscTOCStylesType.Modern},{displayValue:this.txtClassic,value:Asc.c_oAscTOCStylesType.Classic}];this.cmbStyles=new Common.UI.ComboBox({el:$("#tableofcontents-combo-styles"),cls:"input-group-nr",menuStyle:"min-width: 95px;",editable:!1,takeFocusOnClose:!0,data:e}),this.cmbStyles.setValue(1==this.type?Asc.c_oAscTOFStylesType.Current:Asc.c_oAscTOCStylesType.Current),this.cmbStyles.on("selected",_.bind(function(t,e){if(this.api&&!this._noApply){var i=this._originalProps?this._originalProps:new Asc.CTableOfContentsPr;if(i.put_StylesType(e.value),1==this.type){var n=e.value!==Asc.c_oAscTOFStylesType.Centered;this.chAlign.setValue(n,!0),this.chAlign.setDisabled(!n),this.cmbLeader.setDisabled(!n),i.put_RightAlignTab(n),n&&i.put_TabLeader(this.cmbLeader.getValue())}1==this.type?this.api.SetDrawImagePlaceTableOfFigures("tableofcontents-img",i):this.api.SetDrawImagePlaceContents("tableofcontents-img",i),this.scrollerY.update()}},this)),this.scrollerY=new Common.UI.Scroller({el:this.$window.find("#tableofcontents-img").parent(),minScrollbarLength:20}),this.scrollerY.update(),this.scrollerY.scrollTop(0),this.btnOk=new Common.UI.Button({el:this.$window.find(".primary")}),this.afterRender()},getFocusedComponents:function(){return[this.chPages,this.chAlign,this.cmbLeader,this.chLinks,this.radioLevels,this.radioStyles,this.spnLevels,this.stylesList,this.cmbStyles,this.radioCaption,this.radioStyle,this.cmbCaptions,this.cmbTOFStyles,this.chFullCaption]},getDefaultFocusableComponent:function(){return this.chPages},afterRender:function(){this._setDefaults(this.props)},close:function(){1==this.type?this.api.SetDrawImagePlaceTableOfFigures(null):this.api.SetDrawImagePlaceContents(null),this.scrollerY.update(),Common.Views.AdvancedSettingsWindow.prototype.close.apply(this)},_setDefaults:function(t){if(this._noApply=!0,t){var e=t.get_Hyperlink();this.chLinks.setValue(null!==e&&void 0!==e?e:"indeterminate",!0),e=t.get_StylesType(),this.cmbStyles.setValue(null!==e?e:Asc.c_oAscTOCStylesType.Current),e=t.get_ShowPageNumbers(),this.chPages.setValue(null!==e&&void 0!==e?e:"indeterminate"),"checked"==this.chPages.getValue()?(e=t.get_RightAlignTab(),this.chAlign.setValue(null!==e&&void 0!==e?e:"indeterminate"),"checked"==this.chAlign.getValue()&&void 0!==(e=t.get_TabLeader())&&this.cmbLeader.setValue(e)):1==this.type&&this.cmbStyles.getValue()==Asc.c_oAscTOFStylesType.Centered&&this.chAlign.setValue(!1)}1==this.type?this.fillTOFProps(t):this.fillTOCProps(t),this._originalProps=t||new Asc.CTableOfContentsPr,t||(1==this.type?(this._originalProps.put_Caption(this.textFigure),this._originalProps.put_IncludeLabelAndNumber("checked"==this.chFullCaption.getValue())):this._originalProps.put_OutlineRange(this.startLevel,this.endLevel),this._originalProps.put_Hyperlink("checked"==this.chLinks.getValue()),this._originalProps.put_ShowPageNumbers("checked"==this.chPages.getValue()),"checked"==this.chPages.getValue()&&(this._originalProps.put_RightAlignTab("checked"==this.chAlign.getValue()),this._originalProps.put_TabLeader(this.cmbLeader.getValue()))),1==this.type?this.api.SetDrawImagePlaceTableOfFigures("tableofcontents-img",this._originalProps):this.api.SetDrawImagePlaceContents("tableofcontents-img",this._originalProps),this.scrollerY.update(),this._noApply=!1},fillTOCProps:function(t){var e=this,i=this.api.asc_GetStylesArray(),n=[],o=!1;if(_.each(i,function(t){var i=t.get_Name(),o=e.api.asc_GetHeadingLevel(i);(t.get_QFormat()||o>=0)&&n.push({name:i,displayValue:t.get_TranslatedName(),allowSelected:!1,checked:!1,value:"",headerLevel:o>=0?o+1:-1})}),t){var s=t.get_OutlineStart(),a=t.get_OutlineEnd(),r=t.get_StylesCount();this.startLevel=s,this.endLevel=a,(s<0||a<0)&&r<1&&(s=1,a=9,this.spnLevels.setValue(a,!0));for(var l=!1,c=0;c<r;c++){var d=t.get_StyleName(c),h=t.get_StyleLevel(c),p=_.findWhere(n,{name:d});p?(p.checked=!0,p.value=h,p.headerLevel!==h&&(l=!0)):(n.push({name:d,displayValue:d,allowSelected:!1,checked:!0,value:h,headerLevel:-1}),l=!0)}if(s>0&&a>0)for(var c=s;c<=a;c++){var p=_.findWhere(n,{headerLevel:c});p&&(p.checked=!0,p.value=c)}for(var m=-1,u=-1,g=-1,c=0;c<9;c++){var p=_.findWhere(n,{headerLevel:c+1});if(p){var b=p.headerLevel,h=p.value;if(b==h){if(!(g<1)){m=u=-1,l=!0;break}m<1&&(m=h),u=h}else{if(p.checked){m=u=-1,l=!0;break}m>0&&(g=c+1)}}}this.spnLevels.setValue(u>0?u:"",!0),o=l||m>1}else for(var c=this.startLevel;c<=this.endLevel;c++){var p=_.findWhere(n,{headerLevel:c});p&&(p.checked=!0,p.value=c)}if(n.sort(function(t,e){var i=t.displayValue.toLocaleLowerCase(),n=e.displayValue.toLocaleLowerCase();return i<n?-1:i>n?1:0}),this.stylesLevels.reset(n),o){this.radioStyles.setValue(!0),this.stylesList.scroller.update({alwaysVisibleY:!0});var p=this.stylesLevels.findWhere({checked:!0});p&&this.stylesList.scrollToRecord(p)}},fillTOFProps:function(t){var e=!0,i=Common.Utils.InternalSettings.get("de-settings-captions");null!=i&&void 0!=i||(i=Common.localStorage.getItem("de-settings-captions")||"",Common.Utils.InternalSettings.set("de-settings-captions",i)),i=i?JSON.parse(i):[],i=i.concat([{value:this.textEquation,displayValue:this.textEquation},{value:this.textFigure,displayValue:this.textFigure},{value:this.textTable,displayValue:this.textTable}]),i.sort(function(t,e){var i=t.displayValue.toLowerCase(),n=e.displayValue.toLowerCase();return i>n?1:i<n?-1:0}),i=[{value:null,displayValue:this.textNone}].concat(i),this.cmbCaptions.setData(i);var n;if(t){e=!!t.get_Caption();var o=this.cmbCaptions.store.findWhere({value:t.get_Caption()});o&&(n=o.get("value"))}if(i.length>0&&this.cmbCaptions.setValue(n||this.textFigure),i=[],_.each(this.api.asc_getAllUsedParagraphStyles(),function(t,e){i.push({displayValue:t.get_TranslatedName(),styleName:t.get_Name(),value:e})}),i.sort(function(t,e){var i=t.displayValue.toLocaleLowerCase(),n=e.displayValue.toLocaleLowerCase();return i<n?-1:i>n?1:0}),this.cmbTOFStyles.setData(i),n=void 0,t){if(t.get_StylesCount()>0){var o=this.cmbTOFStyles.store.findWhere({styleName:t.get_StyleName(0)});o&&(n=o.get("value"))}}i.length>0&&this.cmbTOFStyles.setValue(n||i[0].value),t&&(n=t.get_IncludeLabelAndNumber(),this.chFullCaption.setValue(null!==n&&void 0!==n?n:"indeterminate",!0)),!e&&this.radioStyle.setValue(!0)},synchronizeLevelsFromOutline:function(){var t=this.spnLevels.getNumberValue();this.stylesLevels.each(function(e){var i=e.get("headerLevel");i>=1&&i<=t?(e.set("checked",!0),e.set("value",i)):(e.set("checked",!1),e.set("value",""))}),this._needUpdateStyles=!1},synchronizeLevelsFromStyles:function(){for(var t=-1,e=-1,i=-1,n=0;n<9;n++){var o=this.stylesLevels.findWhere({headerLevel:n+1});if(o){var s=o.get("headerLevel"),a=o.get("value");if(s==a){if(!(i<1)){t=e=-1,!0;break}t<1&&(t=a),e=a}else{if(o.get("checked")){t=e=-1,!0;break}t>0&&(i=n+1)}}}if(t<0&&e<0){var o=this.stylesLevels.findWhere({checked:!0});o?!0:(t=1,e=9)}this.startLevel=t,this.endLevel=e,this.spnLevels.setValue(e>0?e:"",!0),this._needUpdateOutlineLevels=!1},getSettings:function(){var t=this._originalProps;if(t.put_Hyperlink("checked"==this.chLinks.getValue()),t.put_ShowPageNumbers("checked"==this.chPages.getValue()),"checked"==this.chPages.getValue()&&(t.put_RightAlignTab("checked"==this.chAlign.getValue()),t.put_TabLeader(this.cmbLeader.getValue())),t.put_StylesType(this.cmbStyles.getValue()),t.clear_Styles(),1==this.type)if(this.radioCaption.getValue())t.put_Caption(this.cmbCaptions.getValue());else{t.put_Caption(null);var e=this.cmbTOFStyles.getSelectedRecord();e&&t.add_Style(e.styleName)}else this._needUpdateOutlineLevels&&this.synchronizeLevelsFromStyles(),this._needUpdateStyles||this.stylesLevels.each(function(e){e.get("checked")&&t.add_Style(e.get("name"),e.get("value"))}),t.put_OutlineRange(this.startLevel,this.endLevel);return t},addEvents:function(t,e,i){var n=e.$el.find("input"),o=this;n.on("keypress",function(t){/[1-9]/.test(String.fromCharCode(t.which))||t.ctrlKey||(t.preventDefault(),t.stopPropagation())}),n.on("input",function(t){var e=_.isEmpty(n.val());if(i.get("checked")!==!e&&i.set("checked",!e),i.set("value",e?"":parseInt(n.val())),o._needUpdateOutlineLevels=!0,o.api&&!o._noApply){var s=o._originalProps?o._originalProps:new Asc.CTableOfContentsPr;s.clear_Styles(),o.stylesLevels.each(function(t){t.get("checked")&&s.add_Style(t.get("name"),t.get("value"))}),s.get_StylesCount()>0?s.put_OutlineRange(-1,-1):s.put_OutlineRange(1,9),o.api.SetDrawImagePlaceContents("tableofcontents-img",s),o.scrollerY.update()}})},onItemChange:function(t,e,i){this.addEvents(t,e,i);var n=e.$el.find("input");setTimeout(function(){n.focus(),n[0].selectionStart=n[0].selectionEnd=n[0].value.length},10)},changeCaption:function(t){if(this.api&&!this._noApply&&t){var e=this._originalProps?this._originalProps:new Asc.CTableOfContentsPr;e.put_Caption(t.value),e.clear_Styles(),this.api.SetDrawImagePlaceTableOfFigures("tableofcontents-img",e),this.scrollerY.update()}},changeTOFStyle:function(t){if(this.api&&!this._noApply){var e=this._originalProps?this._originalProps:new Asc.CTableOfContentsPr;e.put_Caption(null),e.clear_Styles(),e.add_Style(t.styleName),this.api.SetDrawImagePlaceTableOfFigures("tableofcontents-img",e),this.scrollerY.update()}},disableButtons:function(){this.type&&this.btnOk.setDisabled(this.radioCaption.getValue()&&null===this.cmbCaptions.getValue()||this.radioStyle.getValue()&&this.cmbTOFStyles.length<1)},onDlgBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(){return this._handleInput("ok"),!1},_handleInput:function(t){if(this.handler){if("ok"==t&&this.btnOk.isDisabled())return;this.handler.call(this,t,this.getSettings())}this.close()},textTitle:"Table of Contents",textLeader:"Leader",textBuildTable:"Build table of contents from",textLevels:"Levels",textStyles:"Styles",strShowPages:"Show page numbers",strAlign:"Right align page numbers",strLinks:"Format Table of Contents as links",textNone:"None",textRadioLevels:"Outline levels",textRadioStyles:"Selected styles",textStyle:"Style",textLevel:"Level",txtCurrent:"Current",txtSimple:"Simple",txtStandard:"Standard",txtModern:"Modern",txtClassic:"Classic",txtOnline:"Online",textTitleTOF:"Table of Figures",textBuildTableOF:"Build table of figures from",textRadioCaption:"Caption",textRadioStyle:"Style",strFullCaption:"Include label and number",textEquation:"Equation",textFigure:"Figure",textTable:"Table",txtDistinctive:"Distinctive",txtCentered:"Centered",txtFormal:"Formal",strLinksOF:"Format table of figures as links"},DE.Views.TableOfContentsSettings||{}))}),define("documenteditor/main/app/view/BookmarksDialog",["common/main/lib/util/utils","common/main/lib/component/ListView","common/main/lib/component/InputField","common/main/lib/component/Button","common/main/lib/component/RadioBox","common/main/lib/view/AdvancedSettingsWindow"],function(){"use strict";DE.Views.BookmarksDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:310,height:366,buttons:null},initialize:function(t){var e=this;_.extend(this.options,{title:this.textTitle,template:['<div class="box" style="height:'+(e.options.height-85)+'px;">','<div class="content-panel" style="padding: 0 5px;"><div class="inner-content">','<div class="settings-panel active">','<table cols="1" style="width: 100%;">',"<tr>",'<td class="padding-extra-small">','<label class="input-label">',e.textBookmarkName,"</label>","</td>","</tr>","<tr>",'<td class="padding-large">','<div id="bookmarks-txt-name" style="display:inline-block;vertical-align: top;margin-right: 10px;"></div>','<button type="button" result="add" class="btn btn-text-default" id="bookmarks-btn-add" style="vertical-align: top;">',e.textAdd,"</button>","</td>","</tr>","<tr>",'<td class="padding-extra-small">','<label class="header" style="margin-right: 10px;">',e.textSort,"</label>",'<div id="bookmarks-radio-name" style="display: inline-block; margin-right: 10px;"></div>','<div id="bookmarks-radio-location" style="display: inline-block;"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<div id="bookmarks-list" style="width:290px; height: 139px;"></div>',"</td>","</tr>","<tr>",'<td class="padding-large">','<button type="button" class="btn btn-text-default" id="bookmarks-btn-goto" style="margin-right: 5px;">',e.textGoto,"</button>",'<div style="display: inline-block; position: relative;">','<button type="button" class="btn btn-text-default auto dropdown-toggle move-focus" id="bookmarks-btn-link" style="min-width: 75px;" data-toggle="dropdown">',e.textGetLink,"</button>",'<div id="id-clip-copy-box" class="dropdown-menu" style="width: 291px; left: -80px; padding: 10px;">','<div id="id-dlg-clip-copy"></div>','<button id="id-dlg-copy-btn" class="btn btn-text-default" style="margin-left: 5px; width: 86px;">'+e.textCopy+"</button>","</div>","</div>",'<button type="button" class="btn btn-text-default" id="bookmarks-btn-delete" style="float: right;">',e.textDelete,"</button>","</td>","</tr>","<tr>","<td>",'<div id="bookmarks-checkbox-hidden"></div>',"</td>","</tr>","</table>","</div></div>","</div>","</div>",'<div class="footer center">','<button class="btn normal dlg-btn" result="cancel" style="width: 86px;">'+e.textClose+"</button>","</div>"].join("")},t),this.api=t.api,this.handler=t.handler,this.props=t.props,this.appOptions=t.appOptions,Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;if(this.txtName=new Common.UI.InputField({el:$("#bookmarks-txt-name"),allowBlank:!0,validateOnChange:!0,validateOnBlur:!0,style:"width: 205px;",value:"",maxLength:40,validation:function(e){var i=t.props.asc_CheckNewBookmarkName(e),n=t.props.asc_HaveBookmark(e);return t.btnAdd.setDisabled(!i&&!n),!!(i||_.isEmpty(e)||n)||t.txtInvalidName}}).on("changing",function(e,i){var n=t.props.asc_HaveBookmark(i);if(n){var o=t.bookmarksList.store.findWhere({value:i});t.bookmarksList.selectRecord(o),t.bookmarksList.scrollToRecord(o)}else t.bookmarksList.deselectAll();t.btnGoto.setDisabled(!n),t.btnDelete.setDisabled(!n),t.btnGetLink.setDisabled(!n)}),this.radioName=new Common.UI.RadioBox({el:$("#bookmarks-radio-name"),labelText:this.textName,name:"asc-radio-bookmark-sort"}),this.radioName.on("change",_.bind(this.onRadioSort,this)),this.radioLocation=new Common.UI.RadioBox({el:$("#bookmarks-radio-location"),labelText:this.textLocation,name:"asc-radio-bookmark-sort"}),this.radioLocation.on("change",_.bind(this.onRadioSort,this)),Common.Utils.InternalSettings.get("de-bookmarks-sort-location")?this.radioLocation.setValue(!0,!0):this.radioName.setValue(!0,!0),this.bookmarksList=new Common.UI.ListView({el:$("#bookmarks-list",this.$window),store:new Common.UI.DataViewStore,tabindex:1,cls:"dbl-clickable",itemTemplate:_.template('<div id="<%= id %>" class="list-item" style="overflow: hidden; text-overflow: ellipsis;"><%= Common.Utils.String.htmlEncode(value) %></div>')}),this.bookmarksList.store.comparator=function(e){return t.radioName.getValue()?e.get("value"):e.get("location")},this.bookmarksList.on("item:dblclick",_.bind(this.onDblClickBookmark,this)),this.bookmarksList.on("entervalue",_.bind(this.onPrimary,this)),this.bookmarksList.on("item:select",_.bind(this.onSelectBookmark,this)),this.btnAdd=new Common.UI.Button({el:$("#bookmarks-btn-add"),disabled:!0}),this.btnAdd.on("click",_.bind(this.addBookmark,this)),this.btnGoto=new Common.UI.Button({el:$("#bookmarks-btn-goto"),disabled:!0}),this.btnGoto.on("click",_.bind(this.gotoBookmark,this)),this.btnDelete=new Common.UI.Button({el:$("#bookmarks-btn-delete"),disabled:!0}),this.btnDelete.on("click",_.bind(this.deleteBookmark,this)),this.btnGetLink=new Common.UI.Button({el:$("#bookmarks-btn-link"),disabled:!0}),this.btnGetLink.on("click",_.bind(this.getBookmarkLink,this)),this.chHidden=new Common.UI.CheckBox({el:$("#bookmarks-checkbox-hidden"),labelText:this.textHidden,value:Common.Utils.InternalSettings.get("de-bookmarks-hidden")||!1}),this.chHidden.on("change",_.bind(this.onChangeHidden,this)),this.appOptions.canMakeActionLink){var e=new Common.UI.InputField({el:$("#id-dlg-clip-copy"),editable:!1,style:"width: 176px;"}),i=this.$window.find("#id-clip-copy-box");i.on("click",_.bind(function(){return!1},this)),i.parent().on({"shown.bs.dropdown":function(){_.delay(function(){e._input.select().focus()},100)},"hide.bs.dropdown":function(){t.txtName._input.select().focus()}}),i.find("button").on("click",function(){e._input.select(),document.execCommand("copy")}),Common.Gateway.on("setactionlink",function(t){e.setValue(t)})}this.afterRender()},getFocusedComponents:function(){return[this.txtName,this.radioName,this.radioLocation,this.bookmarksList,this.btnAdd,this.btnGoto,this.btnGetLink,this.btnDelete,this.chHidden]},afterRender:function(){this._setDefaults(this.props);var t=this,e=function(){var e=t.bookmarksList.getSelectedRec();t.refreshBookmarks(),e&&(e=t.bookmarksList.store.findWhere({value:e.get("value")}),e?(t.bookmarksList.selectRecord(e),t.bookmarksList.scrollToRecord(e)):(t.txtName.setValue(""),t.btnAdd.setDisabled(!0),t.btnGoto.setDisabled(!0),t.btnDelete.setDisabled(!0),t.btnGetLink.setDisabled(!0)))};this.api.asc_registerCallback("asc_onBookmarksUpdate",e),this.on("close",function(i){t.api.asc_unregisterCallback("asc_onBookmarksUpdate",e)})},show:function(){Common.Views.AdvancedSettingsWindow.prototype.show.apply(this,arguments);var t=this;_.delay(function(){$("input",t.txtName.cmpEl).select().focus()},100)},close:function(){Common.Views.AdvancedSettingsWindow.prototype.close.apply(this,arguments),Common.Utils.InternalSettings.set("de-bookmarks-hidden","checked"==this.chHidden.getValue()),Common.Utils.InternalSettings.set("de-bookmarks-sort-location",this.radioLocation.getValue())},_setDefaults:function(t){this.refreshBookmarks(),this.btnGetLink.setVisible(this.appOptions.canMakeActionLink)},getSettings:function(){return{}},onDlgBtnClick:function(t){this.close()},onPrimary:function(){return!0},refreshBookmarks:function(){if(this.props){for(var t=this.bookmarksList.store,e=this.props.asc_GetCount(),i="checked"==this.chHidden.getValue(),n=[],o=0;o<e;o++){var s=this.props.asc_GetName(o);if(!this.props.asc_IsInternalUseBookmark(s)&&(i||!this.props.asc_IsHiddenBookmark(s))){var a=new Common.UI.DataViewModel;a.set({value:s,location:o}),n.push(a)}}t.reset(n,{silent:!1})}},onSelectBookmark:function(t,e,i){if(i){var n=i.get("value");this.txtName.setValue(n),this.btnAdd.setDisabled(!1),this.btnGoto.setDisabled(!1),this.btnDelete.setDisabled(!1),this.btnGetLink.setDisabled(!1)}},gotoBookmark:function(t,e){var i=this.bookmarksList.getSelectedRec();i?this.props.asc_SelectBookmark(i.get("value")):""!==this.txtName.getValue()&&this.props.asc_SelectBookmark(this.txtName.getValue())},addBookmark:function(t,e){this.props.asc_AddBookmark(this.txtName.getValue()),this.refreshBookmarks();var i=this.bookmarksList.store.findWhere({value:this.txtName.getValue()});this.bookmarksList.selectRecord(i),this.bookmarksList.scrollToRecord(i),this.txtName.focus()},onDblClickBookmark:function(t,e,i){this.props.asc_SelectBookmark(i.get("value"))},deleteBookmark:function(t,e){var i=this.bookmarksList.getSelectedRec();if(i){this.props.asc_RemoveBookmark(i.get("value"));var n=this.bookmarksList.store;_.indexOf(n.models,i);n.remove(i),this.txtName.setValue(""),this.btnAdd.setDisabled(!0),this.btnGoto.setDisabled(!0),this.btnDelete.setDisabled(!0),this.btnGetLink.setDisabled(!0)}},getBookmarkLink:function(t){if(!t.cmpEl||!t.cmpEl.parent().hasClass("open")){var e=this.bookmarksList.getSelectedRec();e&&Common.Gateway.requestMakeActionLink({action:{type:"bookmark",data:e.get("value")}})}},onRadioSort:function(t,e,i){e&&(this.bookmarksList.store.sort(),this.bookmarksList.onResetItems())},onChangeHidden:function(t,e,i,n){this.refreshBookmarks()},textTitle:"Bookmarks",textLocation:"Location",textBookmarkName:"Bookmark name",textSort:"Sort by",textName:"Name",textAdd:"Add",textGoto:"Go to",textDelete:"Delete",textClose:"Close",textHidden:"Hidden bookmarks",txtInvalidName:"Bookmark name can only contain letters, digits and underscores, and should begin with the letter",textGetLink:"Get Link",textCopy:"Copy"},DE.Views.BookmarksDialog||{}))}),define("documenteditor/main/app/view/AddNewCaptionLabelDialog",["common/main/lib/component/Window","common/main/lib/component/InputField"],function(){"use strict";DE.Views.AddNewCaptionLabelDialog=Common.UI.Window.extend(_.extend({options:{width:330,header:!1,cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,t||{}),this.template=['<div class="box">','<div class="input-row">',"<label>"+this.textLabel+"</label>","</div>",'<div id="id-dlg-label-caption" class="input-row"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this;t.inputLabel=new Common.UI.InputField({el:$("#id-dlg-label-caption"),allowBlank:!1,blankError:t.textLabelError,style:"width: 100%;",validateOnBlur:!1,validation:function(t){return!!t||""}}),this.getChild().find(".btn").on("click",_.bind(this.onBtnClick,this))},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var t=this;_.delay(function(){t.getChild("input").focus()},50)},onPrimary:function(t){return this._handleInput("ok"),!1},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},_handleInput:function(t){if(this.options.handler){if("ok"==t&&!0!==this.inputLabel.checkValidate())return void this.inputLabel.cmpEl.find("input").focus();this.options.handler.call(this,t,this.inputLabel.getValue())}this.close()},textLabel:"Label:",textLabelError:"Label must not be empty."},DE.Views.AddNewCaptionLabelDialog||{}))}),define("documenteditor/main/app/view/CaptionDialog",["common/main/lib/util/utils","common/main/lib/component/MetricSpinner","common/main/lib/component/ComboBox","common/main/lib/view/AdvancedSettingsWindow","documenteditor/main/app/view/AddNewCaptionLabelDialog"],function(){"use strict";DE.Views.CaptionDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:351,height:350},initialize:function(t){var e=this;_.extend(this.options,{title:this.textTitle,template:['<div class="box" style="height:'+(e.options.height-85)+'px;">','<div class="content-panel" style="padding: 0 5px;"><div class="inner-content">','<div class="settings-panel active">','<table cols="4" style="width: auto;">',"<tr>",'<td colspan="3" class="padding-small">','<label class="input-label">',e.textCaption,"</label>",'<div id="caption-txt-caption" style="margin-right: 10px;"></div>',"</td>",'<td class="padding-small">','<label class="input-label">',e.textInsert,"</label>",'<div id="caption-combo-position" class="input-group-nr" style="width:75px;"></div>',"</td>","</tr>","<tr>",'<td colspan="2" class="padding-small">','<label class="input-label">',e.textLabel,"</label>",'<div id="caption-combo-label" class="input-group-nr" style="width:160px;margin-right: 10px;"></div>',"</td>",'<td class="padding-small" style="vertical-align: bottom;">','<button type="button" result="add" class="btn btn-text-default" id="caption-btn-add" style="margin-right: 10px;">',e.textAdd,"</button>","</td>",'<td class="padding-small" style="vertical-align: bottom;">','<button type="button" result="add" class="btn btn-text-default" id="caption-btn-delete">',e.textDelete,"</button>","</td>","</tr>","<tr>",'<td colspan="4" class="padding-small">','<div id="caption-checkbox-exclude"></div>',"</td>","</tr>","<tr>",'<td colspan="2" class="padding-large">','<label class="input-label" >',e.textNumbering,"</label>",'<div id="caption-combo-numbering" class="input-group-nr" style="width:160px;"></div>',"</td>",'<td class="padding-large">',"</td>",'<td class="padding-large">',"</td>","</tr>","<tr>",'<td colspan="4" class="padding-small">','<div id="caption-checkbox-chapter"></div>',"</td>","</tr>","<tr>",'<td colspan="2" class="padding-small">','<label class="input-label">',e.textChapter,"</label>",'<div id="caption-combo-chapter" class="input-group-nr" style="width:160px;margin-right: 10px;"></div>',"</td>",'<td colspan="2" class="padding-small">','<label class="input-label" >',e.textSeparator,"</label>",'<div id="caption-combo-separator" class="input-group-nr" style="width:160px;"></div>',"</td>","</tr>","<tr>",'<td colspan="4" class="padding-small">','<label class="input-label" id="caption-label-example">',e.textExamples,"</label>","</td>","</tr>","</table>","</div>","</div></div>","</div>"].join("")},t),this.objectType=t.objectType,this.handler=t.handler,this.props=t.props,Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.txtCaption=new Common.UI.InputField({el:$("#caption-txt-caption"),allowBlank:!1,value:""});var e=this.txtCaption.$el.find("input");e.on("mouseup",_.bind(this.checkStartPosition,this,"mouse")),e.on("keydown",_.bind(this.checkStartPosition,this,"key")),this.cmbPosition=new Common.UI.ComboBox({el:$("#caption-combo-position"),cls:"input-group-nr",menuStyle:"min-width: 75px;",editable:!1,disabled:void 0===this.objectType,takeFocusOnClose:!0,data:[{displayValue:this.textBefore,value:1},{displayValue:this.textAfter,value:0}]}),this.cmbPosition.setValue(Common.Utils.InternalSettings.get("de-settings-label-position")||0),this.cmbPosition.on("selected",function(e,i){t.props.put_Before(!!i.value)});var i=Common.Utils.InternalSettings.get("de-settings-captions");null!=i&&void 0!=i||(i=Common.localStorage.getItem("de-settings-captions")||"",Common.Utils.InternalSettings.set("de-settings-captions",i)),i=i?JSON.parse(i):[],this.arrLabel=i.concat([{displayValue:this.textEquation,value:this.textEquation,type:0},{displayValue:this.textFigure,value:this.textFigure,type:0},{displayValue:this.textTable,value:this.textTable,type:0}]),this.cmbLabel=new Common.UI.ComboBox({el:$("#caption-combo-label"),cls:"input-group-nr",menuStyle:"min-width: 160px;max-height:155px;",editable:!1,takeFocusOnClose:!0,data:this.arrLabel,alwaysVisibleY:!0}),this.cmbLabel.on("selected",function(e,i){var n=i.value;t.props.put_Label(n),t.props.updateName(),t.txtCaption.setValue(t.props.get_Name());var o=1==i.type;t.btnDelete.setDisabled(!o),t.currentLabel=n,t.positionCaption=t.txtCaption.getValue().length});var n,o,s=Common.Utils.InternalSettings.get("de-settings-current-label");if(s&&(o=_.findIndex(this.arrLabel,function(t){return t.value===s})),s&&-1!==o)n=this.cmbLabel.store.at(o);else{var a=this.arrLabel.length-1;this.objectType===Asc.c_oAscTypeSelectElement.Math?a=this.arrLabel.length-3:this.objectType===Asc.c_oAscTypeSelectElement.Image&&(a=this.arrLabel.length-2),n=this.cmbLabel.store.at(a)}this.cmbLabel.selectRecord(n),this.btnAdd=new Common.UI.Button({el:$("#caption-btn-add")}),this.btnAdd.on("click",_.bind(function(t){var e=this;new DE.Views.AddNewCaptionLabelDialog({handler:function(t,i){if("ok"==t){var n=_.findWhere(e.arrLabel,{value:i});if(n)e.cmbLabel.setValue(i),e.cmbLabel.trigger("selected",e.cmbLabel,n);else{var n={displayValue:i,value:i,type:1};e.arrLabel.unshift(n),e.cmbLabel.setData(e.arrLabel),e.cmbLabel.setValue(i),e.cmbLabel.trigger("selected",e.cmbLabel,n),e.cmbLabel.scroller.update({alwaysVisibleY:!0})}}}}).on("close",function(){e.cmbLabel.focus()}).show()},this)),this.btnDelete=new Common.UI.Button({el:$("#caption-btn-delete"),disabled:!0}),this.btnDelete.on("click",_.bind(function(t){var e=this.cmbLabel.getValue();this.arrLabel=_.reject(this.arrLabel,function(t){return t.value===e}),this.cmbLabel.setData(this.arrLabel),this.cmbLabel.setValue(this.arrLabel[0].value),this.cmbLabel.trigger("selected",this.cmbLabel,this.arrLabel[0])},this)),this.chExclude=new Common.UI.CheckBox({el:$("#caption-checkbox-exclude"),labelText:this.textExclude}),this.chExclude.on("change",function(e,i,n){t.props.put_ExcludeLabel("checked"==i),t.props.updateName(),t.txtCaption.setValue(t.props.get_Name()),t.positionCaption=t.txtCaption.getValue().length}),this.chExclude.setValue(!!Common.Utils.InternalSettings.get("de-settings-label-exclude"),!0),this.cmbNumbering=new Common.UI.ComboBox({el:$("#caption-combo-numbering"),cls:"input-group-nr",menuStyle:"min-width: 160px;",editable:!1,takeFocusOnClose:!0,data:[{displayValue:"1, 2, 3,...",value:Asc.c_oAscNumberingFormat.Decimal,maskExp:/[0-9]/,defValue:1},{displayValue:"a, b, c,...",value:Asc.c_oAscNumberingFormat.LowerLetter,maskExp:/[a-z]/,defValue:"a"},{displayValue:"A, B, C,...",value:Asc.c_oAscNumberingFormat.UpperLetter,maskExp:/[A-Z]/,defValue:"A"},{displayValue:"i, ii, iii,...",value:Asc.c_oAscNumberingFormat.LowerRoman,maskExp:/[ivxlcdm]/,defValue:"i"},{displayValue:"I, II, III,...",value:Asc.c_oAscNumberingFormat.UpperRoman,maskExp:/[IVXLCDM]/,defValue:"I"}]})
;var r=Common.Utils.InternalSettings.get("de-settings-label-numbering");(void 0===r||null===r)&&(r=Asc.c_oAscNumberingFormat.Decimal),this.cmbNumbering.setValue(r),this.cmbNumbering.on("selected",function(e,i){t.props.put_Format(i.value),t.props.updateName(),t.txtCaption.setValue(t.props.get_Name())}),this.chChapter=new Common.UI.CheckBox({el:$("#caption-checkbox-chapter"),labelText:this.textChapterInc}),this.chChapter.on("change",function(e,i,n){t.props.put_IncludeChapterNumber("checked"==i),t.props.updateName(),t.txtCaption.setValue(t.props.get_Name()),t.positionCaption=t.txtCaption.getValue().length,t.cmbChapter.setDisabled("checked"!==i),t.cmbSeparator.setDisabled("checked"!==i)}),this.chChapter.setValue(!!Common.Utils.InternalSettings.get("de-settings-label-chapter-include"),!0);var l=DE.getController("Main");this._arrLevel=[];for(var c=0;c<9;c++)this._arrLevel.push({displayValue:l["txtStyle_Heading_"+(c+1)],value:c});this.cmbChapter=new Common.UI.ComboBox({el:$("#caption-combo-chapter"),cls:"input-group-nr",menuStyle:"min-width: 160px;max-height:135px;",editable:!1,takeFocusOnClose:!0,disabled:!0,data:this._arrLevel}),this.cmbChapter.setValue(Common.Utils.InternalSettings.get("de-settings-label-chapter")||0),this.cmbChapter.on("selected",function(e,i){t.props.put_HeadingLvl(i.value),t.props.updateName(),t.txtCaption.setValue(t.props.get_Name())}),this.cmbSeparator=new Common.UI.ComboBox({el:$("#caption-combo-separator"),cls:"input-group-nr",menuStyle:"min-width: 160px;",editable:!1,takeFocusOnClose:!0,disabled:!0,data:[{displayValue:"-     ("+this.textHyphen+")",value:"-"},{displayValue:".     ("+this.textPeriod+")",value:"."},{displayValue:":     ("+this.textColon+")",value:":"},{displayValue:"â  ("+this.textLongDash+")",value:"â"},{displayValue:"â    ("+this.textDash+")",value:"â"}]}),this.cmbSeparator.setValue(Common.Utils.InternalSettings.get("de-settings-label-separator")||"-"),this.cmbSeparator.on("selected",function(e,i){t.props.put_Separator(i.value),t.props.updateName(),t.txtCaption.setValue(t.props.get_Name())}),this.lblExample=this.$window.find("#caption-label-example"),this.afterRender()},getFocusedComponents:function(){return[this.txtCaption,this.cmbPosition,this.cmbLabel,this.btnAdd,this.btnDelete,this.chExclude,this.cmbNumbering,this.chChapter,this.cmbChapter,this.cmbSeparator]},getDefaultFocusableComponent:function(){return this.txtCaption},afterRender:function(){this._setDefaults(this.props)},close:function(){var t=_.where(this.arrLabel,{type:1}),e=JSON.stringify(t);Common.localStorage.setItem("de-settings-captions",e),Common.Utils.InternalSettings.set("de-settings-captions",e),Common.Views.AdvancedSettingsWindow.prototype.close.apply(this,arguments)},_setDefaults:function(t){this.props=new Asc.CAscCaptionProperties,this.props.put_Before(!!this.cmbPosition.getValue());var e=this.cmbLabel.getValue();this.props.put_Label(e);var i=this.cmbLabel.getSelectedRecord();this.btnDelete.setDisabled(!i||0==i.type),this.props.put_ExcludeLabel("checked"==this.chExclude.getValue()),this.props.put_Format(this.cmbNumbering.getValue()),this.props.put_IncludeChapterNumber("checked"==this.chChapter.getValue()),this.props.put_HeadingLvl(this.cmbChapter.getValue()),this.props.put_Separator(this.cmbSeparator.getValue()),this.props.updateName(),this.txtCaption.setValue(this.props.get_Name()),this.currentLabel=e,this.positionCaption=this.txtCaption.getValue().length,this.cmbChapter.setDisabled("checked"!==this.chChapter.getValue()),this.cmbSeparator.setDisabled("checked"!==this.chChapter.getValue())},getSettings:function(){return this.props.put_Additional(this.txtCaption.getValue().substr(this.positionCaption)),this.props},onDlgBtnClick:function(t){this._handleInput("object"==typeof t?t.currentTarget.attributes.result.value:t)},onPrimary:function(){return this._handleInput("ok"),!1},_handleInput:function(t){this.handler&&this.handler.call(this,t,"ok"==t?this.getSettings():void 0),"ok"==t&&(Common.Utils.InternalSettings.set("de-settings-current-label",this.cmbLabel.getValue()),Common.Utils.InternalSettings.set("de-settings-label-position",this.cmbPosition.getValue()),Common.Utils.InternalSettings.set("de-settings-label-exclude","checked"==this.chExclude.getValue()),Common.Utils.InternalSettings.set("de-settings-label-numbering",this.cmbNumbering.getValue()),Common.Utils.InternalSettings.set("de-settings-label-chapter-include","checked"==this.chChapter.getValue()),Common.Utils.InternalSettings.set("de-settings-label-chapter",this.cmbChapter.getValue()),Common.Utils.InternalSettings.set("de-settings-label-separator",this.cmbSeparator.getValue())),this.close()},checkStartPosition:function(t,e){var i=this,n=e.key;"mouse"===t||"ArrowLeft"===n||"ArrowDown"===n?setTimeout(function(){e.target.selectionStart<i.positionCaption+1&&(e.target.selectionStart=i.positionCaption)},0):"ArrowUp"===n||"Home"===n?setTimeout(function(){e.target.selectionStart=i.positionCaption},0):e.target.selectionStart!==e.target.selectionEnd&&"ArrowRight"===n?e.target.selectionEnd>i.positionCaption?setTimeout(function(){e.target.selectionStart=e.target.selectionEnd},0):setTimeout(function(){e.target.selectionStart=i.positionCaption},0):"Backspace"===n?(e.target.selectionStart===e.target.selectionEnd&&e.target.selectionStart<i.positionCaption+1||e.target.selectionStart<i.positionCaption)&&e.preventDefault():"Delete"===n?e.target.selectionStart<i.positionCaption&&e.preventDefault():"End"!==n&&e.target.selectionStart!==e.target.selectionEnd&&0===e.target.selectionStart&&e.preventDefault()},textTitle:"Insert Caption",textCaption:"Caption",textInsert:"Insert",textLabel:"Label",textAdd:"Add label",textDelete:"Delete label",textNumbering:"Numbering",textChapterInc:"Include chapter number",textChapter:"Chapter starts with style",textSeparator:"Use separator",textExamples:"Examples: Table 2-A, Image 1.IV",textBefore:"Before",textAfter:"After",textHyphen:"hyphen",textPeriod:"period",textColon:"colon",textLongDash:"long dash",textDash:"dash",textEquation:"Equation",textFigure:"Figure",textTable:"Table",textExclude:"Exclude label from caption"},DE.Views.CaptionDialog||{}))}),define("documenteditor/main/app/view/NotesRemoveDialog",["common/main/lib/component/Window","common/main/lib/component/RadioBox"],function(){"use strict";DE.Views.NotesRemoveDialog=Common.UI.Window.extend(_.extend({options:{width:214,height:138,header:!0,style:"min-width: 214px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t),this.template=['<div class="box">','<div id="notes-remove-chk-foot" style="margin-bottom: 5px;"></div>','<div id="notes-remove-chk-end"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this.getChild();t.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.chFootnote=new Common.UI.CheckBox({el:t.find("#notes-remove-chk-foot"),labelText:this.textFoot,value:!0}),this.chEndnote=new Common.UI.CheckBox({el:t.find("#notes-remove-chk-end"),labelText:this.textEnd,value:!0})},getFocusedComponents:function(){return[this.chFootnote,this.chEndnote]},getDefaultFocusableComponent:function(){return this.chFootnote},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,this,t),this.close()},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},getSettings:function(){return{footnote:this.chFootnote.isChecked(),endnote:this.chEndnote.isChecked()}},onPrimary:function(){return this._handleInput("ok"),!1},textTitle:"Delete Notes",textFoot:"Delete All Footnotes",textEnd:"Delete All Endnotes"},DE.Views.NotesRemoveDialog||{}))}),define("documenteditor/main/app/view/CrossReferenceDialog",["common/main/lib/component/Window","common/main/lib/component/ComboBox"],function(){"use strict";DE.Views.CrossReferenceDialog=Common.UI.Window.extend(_.extend({options:{width:400,height:407,style:"min-width: 240px;",cls:"modal-dlg",modal:!1},initialize:function(t){_.extend(this.options,{title:this.txtTitle,buttons:[{value:"ok",caption:this.textInsert},"close"]},t||{}),this.template=['<div class="box">','<table cols="2" style="width: 100%;">',"<tr>",'<td style="padding-right: 5px;">','<label class="input-label">'+this.txtType+"</label>",'<div id="id-dlg-cross-type" class="input-group-nr" style="width: 100%;margin-bottom: 10px;"></div>',"</td>",'<td style="padding-left: 5px;">','<label class="input-label">'+this.txtReference+"</label>",'<div id="id-dlg-cross-ref" class="input-group-nr" style="width: 100%;margin-bottom: 10px;"></div>',"</td>","</tr>","<tr>",'<td colspan="2" style="padding-bottom: 10px;">','<div id="id-dlg-cross-insert-as" style="width:100%;"></div>',"</td>","</tr>","<tr>",'<td colspan="2" style="padding-bottom: 7px;">','<div id="id-dlg-cross-below-above" style="width:100%;"></div>',"</td>","</tr>","<tr>",'<td colspan="2" style="padding-bottom: 10px;">','<div id="id-dlg-cross-separate" style="display: inline-block;vertical-align: middle;margin-right: 10px;"></div>','<div id="id-dlg-cross-separator" style="display: inline-block;vertical-align: middle;"></div>',"</td>","</tr>","<tr>",'<td colspan="2" style="width: 100%;">','<label id="id-dlg-cross-which">'+this.textWhich+"</label>",'<div id="id-dlg-cross-list" class="no-borders" style="width:368px; height:161px;margin-top: 2px; "></div>',"</td>","</tr>","</table>","</div>"].join(""),this.crossRefProps=t.crossRefProps,this.api=t.api,this.options.tpl=_.template(this.template)(this.options),this._locked=!1,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this.getChild();t.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this));var e=Common.Utils.InternalSettings.get("de-settings-captions");null!=e&&void 0!=e||(e=Common.localStorage.getItem("de-settings-captions")||"",Common.Utils.InternalSettings.set("de-settings-captions",e)),e=e?JSON.parse(e):[],e=e.concat([{value:5,displayValue:this.textEquation},{value:6,displayValue:this.textFigure},{value:7,displayValue:this.textTable}]),e.sort(function(t,e){var i=t.displayValue.toLowerCase(),n=e.displayValue.toLowerCase();return i>n?1:i<n?-1:0}),this.cmbType=new Common.UI.ComboBox({el:t.find("#id-dlg-cross-type"),menuStyle:"min-width: 100%;max-height: 233px;",editable:!1,cls:"input-group-nr",data:[{value:0,displayValue:this.textParagraph},{value:1,displayValue:this.textHeading},{value:2,displayValue:this.textBookmark},{value:3,displayValue:this.textFootnote},{value:4,displayValue:this.textEndnote}].concat(e)}),this.cmbType.on("selected",_.bind(this.onTypeSelected,this)),this.cmbReference=new Common.UI.ComboBox({el:t.find("#id-dlg-cross-ref"),menuStyle:"min-width: 100%;max-height: 233px;",editable:!1,cls:"input-group-nr",data:[]}),this.cmbReference.on("selected",_.bind(this.onReferenceSelected,this)),this.chInsertAs=new Common.UI.CheckBox({el:t.find("#id-dlg-cross-insert-as"),labelText:this.textInsertAs,value:!0}),this.chBelowAbove=new Common.UI.CheckBox({el:t.find("#id-dlg-cross-below-above"),labelText:this.textIncludeAbove}),this.chSeparator=new Common.UI.CheckBox({el:t.find("#id-dlg-cross-separate"),labelText:this.textSeparate}).on("change",_.bind(function(t,e,i,n){var o="checked"===t.getValue();this.inputSeparator.setDisabled(!o)},this)),this.inputSeparator=new Common.UI.InputField({el:t.findById("#id-dlg-cross-separator"),style:"width: 35px;",validateOnBlur:!1,disabled:!0}),this.refList=new Common.UI.ListView({el:t.find("#id-dlg-cross-list"),store:new Common.UI.DataViewStore,cls:"dbl-clickable",itemTemplate:_.template('<div id="<%= id %>" class="list-item" style="overflow: hidden; text-overflow: ellipsis;white-space: pre;"><%= Common.Utils.String.htmlEncode(value) %></div>')}),this.refList.on("entervalue",_.bind(this.onPrimary,this)).on("item:dblclick",_.bind(this.onPrimary,this)),this.lblWhich=t.find("#id-dlg-cross-which"),this.btnInsert=new Common.UI.Button({el:t.find(".primary"),disabled:!0}),this.afterRender()},afterRender:function(){this._setDefaults();var t=this,e=function(){t.refreshReferences(t.cmbType.getSelectedRecord(),!0)};this.api.asc_registerCallback("asc_onEndCalculate",e),this.on("close",function(i){t.api.asc_unregisterCallback("asc_onEndCalculate",e)})},_handleInput:function(t,e){if(this.options.handler&&this.options.handler.call(this,t),"ok"==t){if(!e&&document.activeElement&&"textarea"==document.activeElement.localName&&/area_id/.test(document.activeElement.id))return;return void(!this.btnInsert.isDisabled()&&this.insertReference())}this.close()},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value,!0)},onPrimary:function(t){return this._handleInput("ok"),!1},getSettings:function(){return{type:this.cmbType.getValue(),refType:this.cmbReference.getValue()}},_setDefaults:function(){var t,e;this.crossRefProps&&(t=this.cmbType.store.findWhere({value:this.crossRefProps.type}))&&(e=this.crossRefProps.refType),t?this.cmbType.selectRecord(t):this.cmbType.setValue(0),this.refreshReferenceTypes(this.cmbType.getSelectedRecord(),e)},insertReference:function(){var t=this.refList.getSelectedRec(),e=this.cmbType.getSelectedRecord(),i=1==e.type||e.value>4?5:e.value,n=this.cmbReference.getValue(),o="checked"==this.chInsertAs.getValue(),s="checked"==this.chBelowAbove.getValue(),a="checked"==this.chSeparator.getValue()?this.inputSeparator.getValue():void 0;switch(i){case 0:case 1:this.api.asc_AddCrossRefToParagraph(t.get("para"),n,o,s,a);break;case 2:this.api.asc_AddCrossRefToBookmark(t.get("value"),n,o,s,a);break;case 3:case 4:this.api.asc_AddCrossRefToNote(t.get("para"),n,o,s);break;case 5:n==Asc.c_oAscDocumentRefenceToType.OnlyCaptionText&&!1===t.get("para").asc_canAddRefToCaptionText(e.displayValue)?Common.UI.warning({msg:this.textEmpty}):this.api.asc_AddCrossRefToCaption(e.displayValue,t.get("para"),n,o,s)}},onTypeSelected:function(t,e){this.refreshReferenceTypes(e)},refreshReferenceTypes:function(t,e){var i=[],n=this.textWhich;if(1==t.type||t.value>4)i=[{value:Asc.c_oAscDocumentRefenceToType.Text,displayValue:this.textCaption},{value:Asc.c_oAscDocumentRefenceToType.OnlyLabelAndNumber,displayValue:this.textLabelNum},{value:Asc.c_oAscDocumentRefenceToType.OnlyCaptionText,displayValue:this.textOnlyCaption},{value:Asc.c_oAscDocumentRefenceToType.PageNum,displayValue:this.textPageNum},{value:Asc.c_oAscDocumentRefenceToType.AboveBelow,displayValue:this.textAboveBelow}];else switch(t.value){case 0:i=[{value:Asc.c_oAscDocumentRefenceToType.PageNum,displayValue:this.textPageNum},{value:Asc.c_oAscDocumentRefenceToType.ParaNum,displayValue:this.textParaNum},{value:Asc.c_oAscDocumentRefenceToType.ParaNumNoContext,displayValue:this.textParaNumNo},{value:Asc.c_oAscDocumentRefenceToType.ParaNumFullContex,displayValue:this.textParaNumFull},{value:Asc.c_oAscDocumentRefenceToType.Text,displayValue:this.textText},{value:Asc.c_oAscDocumentRefenceToType.AboveBelow,displayValue:this.textAboveBelow}],n=this.textWhichPara;break;case 1:i=[{value:Asc.c_oAscDocumentRefenceToType.Text,displayValue:this.textHeadingText},{value:Asc.c_oAscDocumentRefenceToType.PageNum,displayValue:this.textPageNum},{value:Asc.c_oAscDocumentRefenceToType.ParaNum,displayValue:this.textHeadingNum},{value:Asc.c_oAscDocumentRefenceToType.ParaNumNoContext,displayValue:this.textHeadingNumNo},{value:Asc.c_oAscDocumentRefenceToType.ParaNumFullContex,displayValue:this.textHeadingNumFull},{value:Asc.c_oAscDocumentRefenceToType.AboveBelow,displayValue:this.textAboveBelow}],n=this.textWhichHeading;break;case 2:i=[{value:Asc.c_oAscDocumentRefenceToType.Text,displayValue:this.textBookmarkText},{value:Asc.c_oAscDocumentRefenceToType.PageNum,displayValue:this.textPageNum},{value:Asc.c_oAscDocumentRefenceToType.ParaNum,displayValue:this.textParaNum},{value:Asc.c_oAscDocumentRefenceToType.ParaNumNoContext,displayValue:this.textParaNumNo},{value:Asc.c_oAscDocumentRefenceToType.ParaNumFullContex,displayValue:this.textParaNumFull},{value:Asc.c_oAscDocumentRefenceToType.AboveBelow,displayValue:this.textAboveBelow}],n=this.textWhichBookmark;break;case 3:i=[{value:Asc.c_oAscDocumentRefenceToType.NoteNumber,displayValue:this.textNoteNum},{value:Asc.c_oAscDocumentRefenceToType.PageNum,displayValue:this.textPageNum},{value:Asc.c_oAscDocumentRefenceToType.AboveBelow,displayValue:this.textAboveBelow},{value:Asc.c_oAscDocumentRefenceToType.NoteNumberFormatted,displayValue:this.textNoteNumForm}],n=this.textWhichNote;break;case 4:i=[{value:Asc.c_oAscDocumentRefenceToType.NoteNumber,displayValue:this.textEndNoteNum},{value:Asc.c_oAscDocumentRefenceToType.PageNum,displayValue:this.textPageNum},{value:Asc.c_oAscDocumentRefenceToType.AboveBelow,displayValue:this.textAboveBelow},{value:Asc.c_oAscDocumentRefenceToType.NoteNumberFormatted,displayValue:this.textEndNoteNumForm}],n=this.textWhichEndnote}this.cmbReference.setData(i);var o=this.cmbReference.store.findWhere({value:e});this.cmbReference.setValue(o?e:i[0].value),this.onReferenceSelected(this.cmbReference,this.cmbReference.getSelectedRecord()),this.lblWhich.text(n),this.refreshReferences(t)},refreshReferences:function(t,e){if(t){var i,n=this.refList.store,o=1==t.type||t.value>4?5:t.value,s=[],a=n.length,r=_.indexOf(n.models,this.refList.getSelectedRec());switch(o){case 0:i=this.api.asc_GetAllNumberedParagraphs();break;case 1:i=this.api.asc_GetAllHeadingParagraphs();break;case 2:i=this.api.asc_GetBookmarksManager();break;case 3:i=this.api.asc_GetAllFootNoteParagraphs();break;case 4:i=this.api.asc_GetAllEndNoteParagraphs();break;case 5:i=this.api.asc_GetAllCaptionParagraphs(this.cmbType.getSelectedRecord().displayValue)}if(2==o)for(var l=i.asc_GetCount(),c=0;c<l;c++){var d=i.asc_GetName(c);i.asc_IsInternalUseBookmark(d)||i.asc_IsHiddenBookmark(d)||s.push({value:d})}else if(i)for(var c=0;c<i.length;c++)s.push({value:i[c].asc_getText(),para:i[c]});if(n.reset(s),n.length>0){var h=e&&n.length==a&&r>=0&&r<n.length?n.at(r):n.at(0);this.refList.selectRecord(h),this.refList.scrollToRecord(h)}this.btnInsert.setDisabled(s.length<1||this._locked)}},onReferenceSelected:function(t,e){if(e){var i=e.value,n=this.cmbType.getSelectedRecord(),o=1==n.type||n.value>4?5:n.value,s=5==o&&i!==Asc.c_oAscDocumentRefenceToType.PageNum||o<5&&(i==Asc.c_oAscDocumentRefenceToType.Text||i==Asc.c_oAscDocumentRefenceToType.AboveBelow);this.chBelowAbove.setDisabled(s),s=!(0==o||2==o)||i!==Asc.c_oAscDocumentRefenceToType.ParaNumFullContex,this.chSeparator.setDisabled(s),this.inputSeparator.setDisabled(s||"checked"!==this.chSeparator.getValue())}},setLocked:function(t){this._locked=t,this.btnInsert.setDisabled(this.refList.store.length<1||this._locked)},txtTitle:"Cross-reference",txtType:"Reference type",txtReference:"Insert reference to",textInsertAs:"Insert as hyperlink",textSeparate:"Separate numbers with",textIncludeAbove:"Include above/below",textPageNum:"Page number",textParaNum:"Paragraph number",textParaNumNo:"Paragraph number (no context)",textParaNumFull:"Paragraph number (full context)",textText:"Paragraph text",textAboveBelow:"Above/below",textHeadingText:"Heading text",textHeadingNum:"Heading number",textHeadingNumNo:"Heading number (no context)",textHeadingNumFull:"Heading number (full context)",textBookmarkText:"Bookmark text",textNoteNum:"Footnote number",textNoteNumForm:"Footnote number (formatted)",textEndNoteNum:"Endnote number",textEndNoteNumForm:"Endnote number (formatted)",textCaption:"Entire caption",textLabelNum:"Only label and number",textOnlyCaption:"Only caption text",textParagraph:"Numbered item",textHeading:"Heading",textBookmark:"Bookmark",textFootnote:"Footnote",textEndnote:"Endnote",textEquation:"Equation",textFigure:"Figure",textTable:"Table",textInsert:"Insert",textWhich:"For which caption",textWhichHeading:"For which heading",textWhichBookmark:"For which bookmark",textWhichNote:"For which footnote",textWhichEndnote:"For which endnote",textWhichPara:"For which numbered item",textEmpty:"The request reference is empty."},DE.Views.CrossReferenceDialog||{}))}),define("documenteditor/main/app/controller/Links",["core","documenteditor/main/app/view/Links","documenteditor/main/app/view/NoteSettingsDialog","documenteditor/main/app/view/HyperlinkSettingsDialog","documenteditor/main/app/view/TableOfContentsSettings","documenteditor/main/app/view/BookmarksDialog","documenteditor/main/app/view/CaptionDialog","documenteditor/main/app/view/NotesRemoveDialog","documenteditor/main/app/view/CrossReferenceDialog","common/main/lib/view/OptionsDialog"],function(){"use strict";DE.Controllers.Links=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["Links"],sdkViewName:"#id_main",initialize:function(){this.addListeners({Links:{"links:contents":this.onTableContents,"links:contents-open":this.onTableContentsOpen,"links:update":this.onTableContentsUpdate,"links:notes":this.onNotesClick,"links:hyperlink":this.onHyperlinkClick,"links:bookmarks":this.onBookmarksClick,"links:caption":this.onCaptionClick,"links:crossref":this.onCrossRefClick,"links:tof":this.onTableFigures,"links:tof-update":this.onTableFiguresUpdate},DocumentHolder:{"links:contents":this.onTableContents,"links:update":this.onTableContentsUpdate,"links:contents-open":this.onTableContentsOpen,"links:caption":this.onCaptionClick}})},onLaunch:function(){this._state={prcontrolsdisable:void 0,in_object:void 0},Common.Gateway.on("setactionlink",function(t){console.log("url with actions: "+t)}.bind(this))},setApi:function(t){return t&&(this.api=t,this.api.asc_registerCallback("asc_onFocusObject",this.onApiFocusObject.bind(this)),this.api.asc_registerCallback("asc_onCanAddHyperlink",_.bind(this.onApiCanAddHyperlink,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this)),this.api.asc_registerCallback("asc_onShowContentControlsActions",_.bind(this.onShowContentControlsActions,this)),this.api.asc_registerCallback("asc_onHideContentControlsActions",_.bind(this.onHideContentControlsActions,this)),this.api.asc_registerCallback("asc_onAscReplaceCurrentTOF",_.bind(this.onAscReplaceCurrentTOF,this)),this.api.asc_registerCallback("asc_onAscTOFUpdate",_.bind(this.onAscTOFUpdate,this))),this},setConfig:function(t){this.toolbar=t.toolbar,this.view=this.createView("Links",{toolbar:this.toolbar.toolbar})},SetDisabled:function(t){this.view&&this.view.SetDisabled(t)},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onCoAuthoringDisconnect:function(){this.SetDisabled(!0)},onApiFocusObject:function(t){if(this.toolbar.editMode){for(var e,i,n,o=-1,s=!1,a=!1,r=!1,l=!1,c=!1,d=null;++o<t.length;)i=t[o].get_ObjectType(),e=t[o].get_ObjectValue(),i===Asc.c_oAscTypeSelectElement.Paragraph?(s=e.get_Locked(),d=e):i===Asc.c_oAscTypeSelectElement.Header?(a=e.get_Locked(),r=!0):i===Asc.c_oAscTypeSelectElement.Image?(c=!0,n=i):i===Asc.c_oAscTypeSelectElement.Math?(l=!0,n=i):i===Asc.c_oAscTypeSelectElement.Table&&(!0,n=i);this._state.prcontrolsdisable=s||a,this._state.in_object=n;var h=this.api.asc_IsContentControl()?this.api.asc_GetContentControlProperties():null,p=!!h&&h.get_ContentControlType()==Asc.c_oAscSdtLevelType.Inline,m=h?h.get_Lock():Asc.c_oAscSdtLockType.Unlocked,u=m==Asc.c_oAscSdtLockType.SdtContentLocked||m==Asc.c_oAscSdtLockType.ContentLocked,g=!!d&&!d.can_DeleteBlockContentControl(),b=!!d&&!d.can_EditBlockContentControl(),f=!!d&&!d.can_DeleteInlineContentControl(),C=!!d&&!d.can_EditInlineContentControl(),v=s||l||c||r||p||b||C;this.view.btnsNotes.setDisabled(v),v=s||a||r||p,this.view.btnBookmarks.setDisabled(v),v=r||b||C||g||f,this.view.btnsContents.setDisabled(v),this.view.btnTableFigures.setDisabled(v),this.view.btnTableFiguresUpdate.setDisabled(v||s||!this.api.asc_CanUpdateTablesOfFigures()),v=r,this.view.btnCaption.setDisabled(v),v=s||a||p||b||C||u,this.view.btnCrossRef.setDisabled(v),this.dlgCrossRefDialog&&this.dlgCrossRefDialog.isVisible()&&this.dlgCrossRefDialog.setLocked(v)}},onApiCanAddHyperlink:function(t){this.toolbar.editMode&&this.view.btnsHyperlink.setDisabled(!t||this._state.prcontrolsdisable)},onHyperlinkClick:function(t){var e,i,n,o=this;if(o.api){var s=function(t,e){"ok"==e&&(i=t.getSettings(),!1!==n?o.api.add_Hyperlink(i):o.api.change_Hyperlink(i)),Common.NotificationCenter.trigger("edit:complete",o.toolbar)};if(!1!==(n=o.api.can_AddHyperlink()))e=new DE.Views.HyperlinkSettingsDialog({api:o.api,handler:s}),i=new Asc.CHyperlinkProperty,i.put_Text(n),e.show(),e.setSettings(i);else{var a=o.api.getSelectedElements();a&&_.isArray(a)&&_.each(a,function(t,e){a[e].get_ObjectType()==Asc.c_oAscTypeSelectElement.Hyperlink&&(i=a[e].get_ObjectValue())}),i&&(e=new DE.Views.HyperlinkSettingsDialog({api:o.api,handler:s}),e.show(),e.setSettings(i))}}Common.component.Analytics.trackEvent("ToolBar","Add Hyperlink")},onTableContents:function(t,e){e=!!e;var i=this.api.asc_GetTableOfContentsPr(e);switch(t){case 0:i||(i=new Asc.CTableOfContentsPr,i.put_OutlineRange(1,9)),i.put_Hyperlink(!0),i.put_ShowPageNumbers(!0),i.put_RightAlignTab(!0),i.put_TabLeader(Asc.c_oAscTabLeader.Dot),e?this.api.asc_SetTableOfContentsPr(i):this.api.asc_AddTableOfContents(null,i);break;case 1:i||(i=new Asc.CTableOfContentsPr,i.put_OutlineRange(1,9)),i.put_Hyperlink(!0),i.put_ShowPageNumbers(!1),i.put_TabLeader(Asc.c_oAscTabLeader.None),i.put_StylesType(Asc.c_oAscTOCStylesType.Web),e?this.api.asc_SetTableOfContentsPr(i):this.api.asc_AddTableOfContents(null,i);break;case"settings":var n=this;new DE.Views.TableOfContentsSettings({api:this.api,props:i,type:0,handler:function(t,e){"ok"==t&&(i?n.api.asc_SetTableOfContentsPr(e):n.api.asc_AddTableOfContents(null,e)),Common.NotificationCenter.trigger("edit:complete",n.toolbar)}}).show();break;case"remove":e=e&&i?i.get_InternalClass():void 0,this.api.asc_RemoveTableOfContents(e)}Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onTableContentsUpdate:function(t,e){var i=this.api.asc_GetTableOfContentsPr(e);i&&(e&&i&&(e=i.get_InternalClass()),this.api.asc_UpdateTableOfContents("pages"==t,e)),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onTableContentsOpen:function(t){this.api.asc_getButtonsTOC(t.items[0].options.previewId,t.items[1].options.previewId)},onNotesClick:function(t){var e=this;switch(t){case"ins_footnote":this.api.asc_AddFootnote();break;case"ins_endnote":this.api.asc_AddEndnote();break;case"delele":new DE.Views.NotesRemoveDialog({handler:function(t,i){if("ok"==i){var n=t.getSettings();(n.footnote||n.endnote)&&e.api.asc_RemoveAllFootnotes(n.footnote,n.endnote)}Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}).show();break;case"settings":var i=e.api.asc_IsCursorInEndnote(),n=e.api.asc_IsCursorInFootnote();i=i||n?i:Common.Utils.InternalSettings.get("de-settings-note-last")||!1,new DE.Views.NoteSettingsDialog({api:e.api,handler:function(t,i){i&&(i.isEndNote?e.api.asc_SetEndnoteProps(i.props,i.applyToAll):e.api.asc_SetFootnoteProps(i.props,i.applyToAll),"insert"==t&&setTimeout(function(){i.isEndNote?e.api.asc_AddEndnote(i.custom):e.api.asc_AddFootnote(i.custom)},1),"insert"!=t&&"apply"!=t||Common.Utils.InternalSettings.set("de-settings-note-last",i.isEndNote)),Common.NotificationCenter.trigger("edit:complete",e.toolbar)},isEndNote:i,hasSections:e.api.asc_GetSectionsCount()>1,props:i?e.api.asc_GetEndnoteProps():e.api.asc_GetFootnoteProps()}).show();break;case"prev":this.api.asc_GotoFootnote(!1),setTimeout(function(){Common.NotificationCenter.trigger("edit:complete",e.toolbar)},50);break;case"next":this.api.asc_GotoFootnote(!0),setTimeout(function(){Common.NotificationCenter.trigger("edit:complete",e.toolbar)},50);break;case"prev-end":this.api.asc_GotoEndnote(!1),setTimeout(function(){Common.NotificationCenter.trigger("edit:complete",e.toolbar)},50);break;case"next-end":this.api.asc_GotoEndnote(!0),setTimeout(function(){Common.NotificationCenter.trigger("edit:complete",e.toolbar)},50);break;case"to-endnotes":this.api.asc_ConvertFootnoteType(!1,!0,!1),setTimeout(function(){Common.NotificationCenter.trigger("edit:complete",e.toolbar)},50);break;case"to-footnotes":this.api.asc_ConvertFootnoteType(!1,!1,!0),setTimeout(function(){Common.NotificationCenter.trigger("edit:complete",e.toolbar)},50);break;case"swap":this.api.asc_ConvertFootnoteType(!1,!0,!0),setTimeout(function(){Common.NotificationCenter.trigger("edit:complete",e.toolbar)},50)}},onBookmarksClick:function(t){var e=this;new DE.Views.BookmarksDialog({api:e.api,appOptions:e.toolbar.appOptions,props:e.api.asc_GetBookmarksManager(),handler:function(t,i){Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}).show()},onCaptionClick:function(t){var e=this;new DE.Views.CaptionDialog({objectType:this._state.in_object,handler:function(t,i){"ok"==t&&e.api.asc_AddObjectCaption(i),Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}).show()},onShowTOCActions:function(t,e,i){var n=t.button,o=n==AscCommon.CCButtonType.Toc?this.view.contentsUpdateMenu:this.view.contentsMenu,s=this.getApplication().getController("DocumentHolder").documentHolder,a=s.cmpEl.find(Common.Utils.String.format("#menu-container-{0}",o.id)),r=this;o&&(this._fromShowContentControls=!0,Common.UI.Menu.Manager.hideAll(),o.rendered||(a.length<1&&(a=$(Common.Utils.String.format('<div id="menu-container-{0}" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',o.id)),s.cmpEl.append(a)),o.render(a),o.cmpEl.attr({tabindex:"-1"}),o.on("hide:after",function(){r._fromShowContentControls||r.api.asc_UncheckContentControlButtons()})),a.css({left:e,top:i}),a.attr("data-value","prevent-canvas-click"),s._preventClick=!0,o.show(),o.alignPosition(),_.delay(function(){o.cmpEl.focus()},10),this._fromShowContentControls=!1)},onHideContentControlsActions:function(){this.view.contentsMenu&&this.view.contentsMenu.hide(),this.view.contentsUpdateMenu&&this.view.contentsUpdateMenu.hide()},onShowContentControlsActions:function(t,e,i){t.type==Asc.c_oAscContentControlSpecificType.TOC&&this.onShowTOCActions(t,e,i)},onCrossRefClick:function(t){if(!this.dlgCrossRefDialog||!this.dlgCrossRefDialog.isVisible()){var e=this;e.dlgCrossRefDialog=new DE.Views.CrossReferenceDialog({api:e.api,crossRefProps:e.crossRefProps,handler:function(t,i){"ok"!=t&&Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}),e.dlgCrossRefDialog.on("close",function(t){e.crossRefProps=e.dlgCrossRefDialog.getSettings()}),e.dlgCrossRefDialog.show()}},onTableFigures:function(){var t=this.api.asc_GetTableOfFiguresPr(),e=this;new DE.Views.TableOfContentsSettings({api:this.api,props:t,type:1,handler:function(t,i){"ok"==t&&e.api.asc_AddTableOfFigures(i),Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}).show(),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onTableFiguresUpdate:function(){this.api.asc_UpdateTablesOfFigures(),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onAscReplaceCurrentTOF:function(t){Common.UI.warning({msg:this.view.confirmReplaceTOF,buttons:["yes","no","cancel"],primary:"yes",callback:_.bind(function(e){"yes"!=e&&"no"!=e||t&&t("yes"===e),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},this)})},onAscTOFUpdate:function(t){var e=this;new Common.Views.OptionsDialog({width:300,title:this.view.titleUpdateTOF,items:[{caption:this.view.textUpdatePages,value:!0,checked:!0},{caption:this.view.textUpdateAll,value:!1,checked:!1}],handler:function(i,n){"ok"==n&&t&&t(i.getSettings()),Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}).show()}},DE.Controllers.Links||{}))}),define("documenteditor/main/app/collection/Navigation",["underscore","backbone","common/main/lib/component/TreeView"],function(t,e){"use strict";DE.Collections=DE.Collections||{},DE.Collections.Navigation=Common.UI.TreeViewStore.extend({
model:Common.UI.TreeViewModel})}),define("documenteditor/main/app/controller/Navigation",["core","documenteditor/main/app/collection/Navigation","documenteditor/main/app/view/Navigation"],function(){"use strict";DE.Controllers.Navigation=Backbone.Controller.extend(_.extend({models:[],collections:["Navigation"],views:["Navigation"],initialize:function(){var t=this;this.addListeners({Navigation:{show:function(){var e=t.api.asc_ShowDocumentOutline();t._navigationObject||(t._navigationObject=e),t.updateNavigation()},hide:function(){t.api&&t.api.asc_HideDocumentOutline()}}})},events:function(){},onLaunch:function(){this.panelNavigation=this.createView("Navigation",{storeNavigation:this.getApplication().getCollection("Navigation")}),this.panelNavigation.on("render:after",_.bind(this.onAfterRender,this)),this._navigationObject=null,this._isDisabled=!1},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onDocumentOutlineUpdate",_.bind(this.updateNavigation,this)),this.api.asc_registerCallback("asc_onDocumentOutlineCurrentPosition",_.bind(this.onChangeOutlinePosition,this)),this.api.asc_registerCallback("asc_onDocumentOutlineUpdateAdd",_.bind(this.updateNavigation,this)),this.api.asc_registerCallback("asc_onDocumentOutlineUpdateChange",_.bind(this.updateChangeNavigation,this)),this.api.asc_registerCallback("asc_onDocumentOutlineUpdateRemove",_.bind(this.updateNavigation,this)),this},setMode:function(t){return this.mode=t,this},onAfterRender:function(t){t.viewNavigationList.on("item:click",_.bind(this.onSelectItem,this)),t.viewNavigationList.on("item:contextmenu",_.bind(this.onItemContextMenu,this)),t.navigationMenu.on("item:click",_.bind(this.onMenuItemClick,this)),t.navigationMenu.items[11].menu.on("item:click",_.bind(this.onMenuLevelsItemClick,this))},updateNavigation:function(){if(this._navigationObject){for(var t=this._navigationObject.get_ElementsCount(),e=-1,i=-1,n=!this._navigationObject.isFirstItemNotHeader(),o=[],s=0;s<t;s++){var a=this._navigationObject.get_Level(s),r=!0;a>e&&s>0&&o[s-1].set("hasSubItems",!0),(i<0||a<=i)&&((s>0||n)&&(i=a),r=!1),o.push(new Common.UI.TreeViewModel({name:this._navigationObject.get_Text(s),level:a,index:s,hasParent:r,isEmptyItem:this._navigationObject.isEmptyItem(s)})),e=a}t>0&&!n&&(o[0].set("hasSubItems",!1),o[0].set("isNotHeader",!0),o[0].set("name",this.txtBeginning),o[0].set("tip",this.txtGotoBeginning)),this.getApplication().getCollection("Navigation").reset(o),this.onChangeOutlinePosition(this._navigationObject.get_CurrentPosition())}},updateChangeNavigation:function(t){if(this._navigationObject){var e=this.getApplication().getCollection("Navigation").at(t);e.get("level")!==this._navigationObject.get_Level(t)||0==t&&e.get("isNotHeader")!==this._navigationObject.isFirstItemNotHeader()?this.updateNavigation():(e.set("name",this._navigationObject.get_Text(t)),e.set("isEmptyItem",this._navigationObject.isEmptyItem(t)))}},onChangeOutlinePosition:function(t){this.panelNavigation.viewNavigationList.scrollToRecord(this.panelNavigation.viewNavigationList.selectByIndex(t))},onItemContextMenu:function(t,e,i,n){var o,s=this.panelNavigation.navigationMenu;s.isVisible()&&s.hide();var a=this.panelNavigation.$el.offset(),r=n.clientY*Common.Utils.zoom();o=[n.clientX*Common.Utils.zoom()+5,r-a.top+5];for(var l=0;l<7;l++)s.items[l].setVisible(this.mode.isEdit);var c=i.get("isNotHeader");if(s.items[0].setDisabled(c||this._isDisabled),s.items[1].setDisabled(c||this._isDisabled),s.items[3].setDisabled(c||this._isDisabled),s.items[4].setDisabled(this._isDisabled),s.items[5].setDisabled(this._isDisabled),s.items[7].setDisabled(c),void 0!=o){var d=this.panelNavigation.$el.find("#menu-navigation-container");s.rendered||(d.length<1&&(d=$('<div id="menu-navigation-container" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',s.id),$(this.panelNavigation.$el).append(d)),s.render(d),s.cmpEl.attr({tabindex:"-1"})),s.cmpEl.attr("data-value",i.get("index")),d.css({left:o[0],top:o[1]}),s.show(),_.delay(function(){s.cmpEl.focus()},10)}},onSelectItem:function(t,e,i,n){this._navigationObject&&(this._navigationObject.goto(i.get("index")),Common.NotificationCenter.trigger("edit:complete",this.panelNavigation))},onMenuItemClick:function(t,e){if(this._navigationObject){var i=parseInt(t.cmpEl.attr("data-value"));"promote"==e.value?this._navigationObject.promote(i):"demote"==e.value?this._navigationObject.demote(i):"before"==e.value?this._navigationObject.insertHeader(i,!0):"after"==e.value?this._navigationObject.insertHeader(i,!1):"new"==e.value?this._navigationObject.insertSubHeader(i):"select"==e.value?this._navigationObject.selectContent(i):"expand"==e.value?this.panelNavigation.viewNavigationList.expandAll():"collapse"==e.value&&this.panelNavigation.viewNavigationList.collapseAll()}},onMenuLevelsItemClick:function(t,e){this.panelNavigation.viewNavigationList.expandToLevel(e.value-1)},SetDisabled:function(t){this._isDisabled=t},txtBeginning:"Beginning of document",txtGotoBeginning:"Go to the beginning of the document"},DE.Controllers.Navigation||{}))}),define("text!documenteditor/main/app/template/RightMenu.template",[],function(){return'<div id="view-right-menu" class="tool-menu right">\n    <div class="right-panel">\n        <div id="id-paragraph-settings" class="settings-panel">\n        </div>\n        <div id="id-table-settings" class="settings-panel">\n        </div>\n        <div id="id-image-settings" class="settings-panel">\n        </div>\n        <div id="id-header-settings" class="settings-panel">\n        </div>\n        <div id="id-shape-settings" class="settings-panel">\n        </div>\n        <div id="id-chart-settings" class="settings-panel">\n        </div>\n        <div id="id-mail-merge-settings" class="settings-panel">\n        </div>\n        <div id="id-textart-settings" class="settings-panel">\n        </div>\n        <div id="id-signature-settings" class="settings-panel">\n        </div>\n        <div id="id-form-settings" class="settings-panel">\n        </div>\n    </div>\n    <div class="tool-menu-btns">\n        <div class="ct-btn-category arrow-left"></div>\n        <button id="id-right-menu-text" class="btn btn-category arrow-left" content-target="id-paragraph-settings"><i class="icon toolbar__icon btn-paragraph">&nbsp;</i></button>\n        <button id="id-right-menu-table" class="btn btn-category arrow-left" content-target="id-table-settings"><i class="icon toolbar__icon btn-menu-table">&nbsp;</i></button>\n        <button id="id-right-menu-image" class="btn btn-category arrow-left" content-target="id-image-settings"><i class="icon toolbar__icon btn-menu-image">&nbsp;</i></button>\n        <button id="id-right-menu-header" class="btn btn-category arrow-left" content-target="id-header-settings"><i class="icon toolbar__icon btn-menu-header">&nbsp;</i></button>\n        <button id="id-right-menu-shape" class="btn btn-category arrow-left" content-target="id-shape-settings"><i class="icon toolbar__icon btn-menu-shape">&nbsp;</i></button>\n        <button id="id-right-menu-chart" class="btn btn-category arrow-left" content-target="id-chart-settings"><i class="icon toolbar__icon btn-menu-chart">&nbsp;</i></button>\n        <button id="id-right-menu-textart" class="btn btn-category arrow-left" content-target="id-textart-settings"><i class="icon toolbar__icon btn-menu-textart">&nbsp;</i></button>\n        <button id="id-right-menu-mail-merge" class="btn btn-category arrow-left hidden" content-target="id-mail-merge-settings"><i class="icon toolbar__icon btn-mailmerge">&nbsp;</i></button>\n        <button id="id-right-menu-signature" class="btn btn-category arrow-left hidden" content-target="id-signature-settings"><i class="icon toolbar__icon btn-menu-signature">&nbsp;</i></button>\n        <button id="id-right-menu-form" class="btn btn-category arrow-left hidden" content-target="id-form-settings"><i class="icon toolbar__icon btn-field">&nbsp;</i></button>\n    </div>\n</div>'}),define("text!documenteditor/main/app/template/ParagraphSettings.template",[],function(){return'<table cols="2">\r\n    <tr>\r\n        <td colspan=2>\r\n            <label class="header"><%= scope.strLineHeight %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="50%">\r\n            <div id="paragraph-combo-line-rule" style="width: 85px;"></div>\r\n        </td>\r\n        <td class="padding-small" width="50%">\r\n            <div id="paragraph-spin-line-height"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2>\r\n            <label class="header"><%= scope.strParagraphSpacing %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="50%">\r\n            <label class="input-label"><%= scope.strSpacingBefore %></label>\r\n            <div id="paragraph-spin-spacing-before"></div>\r\n        </td>\r\n        <td class="padding-small" width="50%">\r\n            <label class="input-label"><%= scope.strSpacingAfter %></label>\r\n            <div id="paragraph-spin-spacing-after"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="text-only">\r\n        <td class="padding-small" colspan=2>\r\n            <div id="paragraph-checkbox-add-interval"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2>\r\n            <label class="header"><%= scope.strIndent %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="50%">\r\n            <label class="input-label"><%= scope.strIndentsLeftText %></label>\r\n            <div id="paragraph-spin-indent-left"></div>\r\n        </td>\r\n        <td class="padding-small" width="50%">\r\n            <label class="input-label"><%= scope.strIndentsRightText %></label>\r\n            <div id="paragraph-spin-indent-right"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2>\r\n            <label class="input-label"><%= scope.strIndentsSpecial %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="50%">\r\n            <div id="paragraph-combo-special" style="width: 85px;"></div>\r\n        </td>\r\n        <td class="padding-small" width="50%">\r\n            <div id="paragraph-spin-special-by"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="text-only">\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="text-only">\r\n        <td class="padding-small" colspan=2>\r\n            <div id="paragraph-color-btn" style="display: inline-block;"></div>\r\n            <label class="input-label" style="margin-left: 5px;"><%= scope.textBackColor %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td align="center" colspan=2>\r\n            <label class="link" id="paragraph-advanced-link"><%= scope.textAdvanced %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'}),define("documenteditor/main/app/view/ParagraphSettings",["text!documenteditor/main/app/template/ParagraphSettings.template","jquery","underscore","backbone","common/main/lib/component/ComboBox","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox","common/main/lib/component/ThemeColorPalette","common/main/lib/component/ColorButton","documenteditor/main/app/view/ParagraphSettingsAdvanced"],function(t,e,i,n){"use strict";DE.Views.ParagraphSettings=n.View.extend(i.extend({el:"#id-paragraph-settings",template:i.template(t),events:{},options:{alias:"ParagraphSettings"},initialize:function(){this._initSettings=!0,this._state={LineRuleIdx:null,LineHeight:null,LineSpacingBefore:null,LineSpacingAfter:null,AddInterval:!1,BackColor:"#000000",DisabledControls:!0,HideTextOnlySettings:!1,LeftIndent:null,RightIndent:null,FirstLine:null,CurSpecial:void 0},this.spinners=[],this.lockedControls=[],this._locked=!0,this.isChart=!1,this._arrLineRule=[{displayValue:this.textAtLeast,defaultValue:5,value:c_paragraphLinerule.LINERULE_LEAST,minValue:.03,step:.01,defaultUnit:"cm"},{displayValue:this.textAuto,defaultValue:1,value:c_paragraphLinerule.LINERULE_AUTO,minValue:.5,step:.01,defaultUnit:""},{displayValue:this.textExact,defaultValue:5,value:c_paragraphLinerule.LINERULE_EXACT,minValue:.03,step:.01,defaultUnit:"cm"}],this._arrSpecial=[{displayValue:this.textNoneSpecial,value:c_paragraphSpecial.NONE_SPECIAL,defaultValue:0},{displayValue:this.textFirstLine,value:c_paragraphSpecial.FIRST_LINE,defaultValue:12.7},{displayValue:this.textHanging,value:c_paragraphSpecial.HANGING,defaultValue:12.7}],this.render()},render:function(){var t=e(this.template({scope:this})),n=this;this.cmbLineRule=new Common.UI.ComboBox({el:t.findById("#paragraph-combo-line-rule"),cls:"input-group-nr",menuStyle:"min-width: 85px;",editable:!1,data:this._arrLineRule,disabled:this._locked}),this.cmbLineRule.setValue(""),this.lockedControls.push(this.cmbLineRule),this.numLineHeight=new Common.UI.MetricSpinner({el:t.findById("#paragraph-spin-line-height"),step:.01,width:85,value:"",defaultUnit:"",maxValue:132,minValue:.5,disabled:this._locked}),this.lockedControls.push(this.numLineHeight),this.numSpacingBefore=new Common.UI.MetricSpinner({el:t.findById("#paragraph-spin-spacing-before"),step:.1,width:85,value:"",defaultUnit:"cm",maxValue:55.88,minValue:0,allowAuto:!0,autoText:this.txtAutoText,disabled:this._locked}),this.spinners.push(this.numSpacingBefore),this.lockedControls.push(this.numSpacingBefore),this.numSpacingAfter=new Common.UI.MetricSpinner({el:t.findById("#paragraph-spin-spacing-after"),step:.1,width:85,value:"",defaultUnit:"cm",maxValue:55.88,minValue:0,allowAuto:!0,autoText:this.txtAutoText,disabled:this._locked}),this.spinners.push(this.numSpacingAfter),this.lockedControls.push(this.numSpacingAfter),this.chAddInterval=new Common.UI.CheckBox({el:t.findById("#paragraph-checkbox-add-interval"),labelText:this.strSomeParagraphSpace,disabled:this._locked}),this.lockedControls.push(this.chAddInterval),this.btnColor=new Common.UI.ColorButton({parentEl:t.findById("#paragraph-color-btn"),disabled:this._locked,transparent:!0,menu:!0}),this.lockedControls.push(this.btnColor),this.numIndentsLeft=new Common.UI.MetricSpinner({el:t.findById("#paragraph-spin-indent-left"),step:.1,width:85,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:-55.87,disabled:this._locked}),this.spinners.push(this.numIndentsLeft),this.lockedControls.push(this.numIndentsLeft),this.numIndentsRight=new Common.UI.MetricSpinner({el:t.findById("#paragraph-spin-indent-right"),step:.1,width:85,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:-55.87,disabled:this._locked}),this.spinners.push(this.numIndentsRight),this.lockedControls.push(this.numIndentsRight),this.cmbSpecial=new Common.UI.ComboBox({el:t.findById("#paragraph-combo-special"),cls:"input-group-nr",editable:!1,data:this._arrSpecial,style:"width: 85px;",menuStyle:"min-width: 85px;",disabled:this._locked}),this.cmbSpecial.setValue(""),this.lockedControls.push(this.cmbSpecial),this.numSpecialBy=new Common.UI.MetricSpinner({el:t.findById("#paragraph-spin-special-by"),step:.1,width:85,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:0,disabled:this._locked}),this.spinners.push(this.numSpecialBy),this.lockedControls.push(this.numSpecialBy),this.numLineHeight.on("change",this.onNumLineHeightChange.bind(this)),this.numSpacingBefore.on("change",this.onNumSpacingBeforeChange.bind(this)),this.numSpacingAfter.on("change",this.onNumSpacingAfterChange.bind(this)),this.numLineHeight.on("inputleave",function(){n.fireEvent("editcomplete",n)}),this.numSpacingBefore.on("inputleave",function(){n.fireEvent("editcomplete",n)}),this.numSpacingAfter.on("inputleave",function(){n.fireEvent("editcomplete",n)}),this.chAddInterval.on("change",this.onAddIntervalChange.bind(this)),this.cmbLineRule.on("selected",this.onLineRuleSelect.bind(this)),this.cmbLineRule.on("hide:after",this.onHideMenus.bind(this)),this.btnColor.on("color:select",this.onColorPickerSelect.bind(this)),this.numIndentsLeft.on("change",this.onNumIndentsLeftChange.bind(this)),this.numIndentsRight.on("change",this.onNumIndentsRightChange.bind(this)),this.numSpecialBy.on("change",this.onFirstLineChange.bind(this)),this.cmbSpecial.on("selected",i.bind(this.onSpecialSelect,this)),this.numIndentsLeft.on("inputleave",function(){n.fireEvent("editcomplete",n)}),this.numIndentsRight.on("inputleave",function(){n.fireEvent("editcomplete",n)}),this.numSpecialBy.on("inputleave",function(){n.fireEvent("editcomplete",n)}),this.linkAdvanced=t.findById("#paragraph-advanced-link"),this.linkAdvanced.toggleClass("disabled",this._locked),this.$el.on("click","#paragraph-advanced-link",this.openAdvancedSettings.bind(this)),this.$el.html(t),this.TextOnlySettings=e(".text-only",this.$el),this.rendered=!0},setApi:function(t){return this.api=t,this.api&&this.api.asc_registerCallback("asc_onParaSpacingLine",i.bind(this._onLineSpacing,this)),this},onNumLineHeightChange:function(t,e,i,n){if(""!==this.cmbLineRule.getRawValue()){c_paragraphLinerule.LINERULE_AUTO;this.api&&this.api.put_PrLineSpacing(this.cmbLineRule.getValue(),this.cmbLineRule.getValue()==c_paragraphLinerule.LINERULE_AUTO?t.getNumberValue():Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))}},onNumSpacingBeforeChange:function(t,e,i,n){if(this.api){var o=t.getNumberValue();this._state.LineSpacingBefore=o<0?-1:Common.Utils.Metric.fnRecalcToMM(o),this.api.put_LineSpacingBeforeAfter(0,this._state.LineSpacingBefore)}},onNumSpacingAfterChange:function(t,e,i,n){if(this.api){var o=t.getNumberValue();this._state.LineSpacingAfter=o<0?-1:Common.Utils.Metric.fnRecalcToMM(o),this.api.put_LineSpacingBeforeAfter(1,this._state.LineSpacingAfter)}},onAddIntervalChange:function(t,e,i,n){this.api&&this.api.put_AddSpaceBetweenPrg("checked"==t.getValue()),this.fireEvent("editcomplete",this)},onLineRuleSelect:function(t,e){this.api&&this.api.put_PrLineSpacing(e.value,e.defaultValue),this.numLineHeight.setDefaultUnit(this._arrLineRule[e.value].defaultUnit),this.numLineHeight.setMinValue(this._arrLineRule[e.value].minValue),this.numLineHeight.setStep(this._arrLineRule[e.value].step),this.fireEvent("editcomplete",this)},_onLineSpacing:function(t){var e=t.get_LineRule(),i=t.get_Line();if(this._state.LineRuleIdx!==e&&(this.cmbLineRule.setValue(null!==e?this._arrLineRule[e].value:""),this.numLineHeight.setMinValue(this._arrLineRule[null!==e?e:1].minValue),this.numLineHeight.setDefaultUnit(this._arrLineRule[null!==e?e:1].defaultUnit),this.numLineHeight.setStep(this._arrLineRule[null!==e?e:1].step),this._state.LineRuleIdx=e),Math.abs(this._state.LineHeight-i)>.001||(null===this._state.LineHeight||null===i)&&this._state.LineHeight!==i){var n="";e==c_paragraphLinerule.LINERULE_AUTO?n=i:null!==e&&null!==i&&(n=Common.Utils.Metric.fnRecalcFromMM(i)),this.numLineHeight.setValue(null!==n?n:"",!0),this._state.LineHeight=i}},onColorPickerSelect:function(t,e){this.BackColor=e,this._state.BackColor=this.BackColor,this.api&&("transparent"==e?this.api.put_ParagraphShade(!1):this.api.put_ParagraphShade(!0,Common.Utils.ThemeColor.getRgbColor(e))),this.fireEvent("editcomplete",this)},onSpecialSelect:function(t,e){var i=e.value,n=i===c_paragraphSpecial.NONE_SPECIAL?0:this.numSpecialBy.getNumberValue();n=Common.Utils.Metric.fnRecalcToMM(n),0===n&&(n=this._arrSpecial[i].defaultValue),i===c_paragraphSpecial.HANGING&&(n=-n);var o=new Asc.asc_CParagraphProperty;if(o.put_Ind(new Asc.asc_CParagraphInd),o.get_Ind().put_FirstLine(n),n<0||this._state.FirstLine<0){var s=this._state.LeftIndent;void 0!==s&&null!==s&&o.get_Ind().put_Left(n<0?s-n:s)}this.api&&this.api.paraApply(o),this.fireEvent("editcomplete",this)},onFirstLineChange:function(t,e,i,n){var o=Common.Utils.Metric.fnRecalcToMM(t.getNumberValue());this._state.CurSpecial===c_paragraphSpecial.HANGING&&(o=-o);var s=new Asc.asc_CParagraphProperty;if(s.put_Ind(new Asc.asc_CParagraphInd),s.get_Ind().put_FirstLine(o),o<0||this._state.FirstLine<0){var a=this._state.LeftIndent;void 0!==a&&null!==a&&s.get_Ind().put_Left(o<0?a-o:a)}this.api&&this.api.paraApply(s)},onNumIndentsLeftChange:function(t,e,i,n){var o=Common.Utils.Metric.fnRecalcToMM(t.getNumberValue());this._state.FirstLine<0&&(o-=this._state.FirstLine);var s=new Asc.asc_CParagraphProperty;s.put_Ind(new Asc.asc_CParagraphInd),s.get_Ind().put_Left(o),this.api&&this.api.paraApply(s)},onNumIndentsRightChange:function(t,e,i,n){var o=new Asc.asc_CParagraphProperty;o.put_Ind(new Asc.asc_CParagraphInd),o.get_Ind().put_Right(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api&&this.api.paraApply(o)},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedElements(),this.disableControls(this._locked),this.hideTextOnlySettings(this.isChart),t){var e={Line:t.get_Spacing().get_Line(),Before:t.get_Spacing().get_Before(),After:t.get_Spacing().get_After(),LineRule:t.get_Spacing().get_LineRule()},i={ContextualSpacing:t.get_ContextualSpacing()};if(this._state.LineRuleIdx!==e.LineRule&&(this.cmbLineRule.setValue(null!==e.LineRule?this._arrLineRule[e.LineRule].value:""),this.numLineHeight.setMinValue(this._arrLineRule[null!==e.LineRule?e.LineRule:1].minValue),this.numLineHeight.setDefaultUnit(this._arrLineRule[null!==e.LineRule?e.LineRule:1].defaultUnit),this.numLineHeight.setStep(this._arrLineRule[null!==e.LineRule?e.LineRule:1].step),this._state.LineRuleIdx=e.LineRule),Math.abs(this._state.LineHeight-e.Line)>.001||(null===this._state.LineHeight||null===e.Line)&&this._state.LineHeight!==e.Line){var n="";e.LineRule==c_paragraphLinerule.LINERULE_AUTO?n=e.Line:null!==e.LineRule&&null!==e.Line&&(n=Common.Utils.Metric.fnRecalcFromMM(e.Line)),this.numLineHeight.setValue(null!==n?n:"",!0),this._state.LineHeight=e.Line}(Math.abs(this._state.LineSpacingBefore-e.Before)>.001||(null===this._state.LineSpacingBefore||null===e.Before)&&this._state.LineSpacingBefore!==e.Before)&&(this.numSpacingBefore.setValue(null!==e.Before?e.Before<0?e.Before:Common.Utils.Metric.fnRecalcFromMM(e.Before):"",!0),this._state.LineSpacingBefore=e.Before),(Math.abs(this._state.LineSpacingAfter-e.After)>.001||(null===this._state.LineSpacingAfter||null===e.After)&&this._state.LineSpacingAfter!==e.After)&&(this.numSpacingAfter.setValue(null!==e.After?e.After<0?e.After:Common.Utils.Metric.fnRecalcFromMM(e.After):"",!0),this._state.LineSpacingAfter=e.After),this._state.AddInterval!==i.ContextualSpacing&&(this.chAddInterval.setValue(null!==i.ContextualSpacing&&void 0!==i.ContextualSpacing?i.ContextualSpacing:"indeterminate",!0),this._state.AddInterval=i.ContextualSpacing);var o=t.get_Ind(),s=null!==o?o.get_FirstLine():null,a=null!==o?o.get_Left():null;s<0&&null!==a&&(a+=s),(Math.abs(this._state.LeftIndent-a)>.001||(null===this._state.LeftIndent||null===a)&&this._state.LeftIndent!==a)&&(this.numIndentsLeft.setValue(null!==a?Common.Utils.Metric.fnRecalcFromMM(a):"",!0),this._state.LeftIndent=a),(Math.abs(this._state.FirstLine-s)>.001||(null===this._state.FirstLine||null===s)&&this._state.FirstLine!==s)&&(this.numSpecialBy.setValue(null!==s?Math.abs(Common.Utils.Metric.fnRecalcFromMM(s)):"",!0),this._state.FirstLine=s);var r=null!==o?o.get_Right():null;(Math.abs(this._state.RightIndent-r)>.001||(null===this._state.RightIndent||null===r)&&this._state.RightIndent!==r)&&(this.numIndentsRight.setValue(null!==r?Common.Utils.Metric.fnRecalcFromMM(r):"",!0),this._state.RightIndent=r),r=0===s?c_paragraphSpecial.NONE_SPECIAL:s>0?c_paragraphSpecial.FIRST_LINE:c_paragraphSpecial.HANGING,this._state.CurSpecial!==r&&(this.cmbSpecial.setValue(r),this._state.CurSpecial=r);var l=t.get_Shade();if(null!==l&&void 0!==l&&l.get_Value()===Asc.c_oAscShdClear){var c=l.get_Color();c?c.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.BackColor={color:Common.Utils.ThemeColor.getHexColor(c.get_r(),c.get_g(),c.get_b()),effectValue:c.get_value()}:this.BackColor=Common.Utils.ThemeColor.getHexColor(c.get_r(),c.get_g(),c.get_b()):this.BackColor="transparent"}else this.BackColor="transparent";var d=typeof this.BackColor;if(d!==typeof this._state.BackColor||"object"==d&&(this.BackColor.effectValue!==this._state.BackColor.effectValue||this._state.BackColor.color.indexOf(this.BackColor.color)<0)||"object"!=d&&this._state.BackColor.indexOf(this.BackColor)<0){if(this.btnColor.setColor(this.BackColor),"object"==typeof this.BackColor){for(var h=!1,p=0;p<10;p++)if(Common.Utils.ThemeColor.ThemeValues[p]==this.BackColor.effectValue){this.mnuColorPicker.select(this.BackColor,!0),h=!0;break}h||this.mnuColorPicker.clearSelection()}else this.mnuColorPicker.select(this.BackColor,!0);this._state.BackColor=this.BackColor}}},updateMetricUnit:function(){if(this.spinners)for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),"paragraphadv-spin-position"==e.el.id||"paragraph-spin-spacing-before"==e.el.id||"paragraph-spin-spacing-after"==e.el.id?e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.01):e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}if(this._arrLineRule[2].defaultUnit=this._arrLineRule[0].defaultUnit=Common.Utils.Metric.getCurrentMetricName(),this._arrLineRule[2].minValue=this._arrLineRule[0].minValue=parseFloat(Common.Utils.Metric.fnRecalcFromMM(.3).toFixed(2)),this._arrLineRule[2].step=this._arrLineRule[0].step=Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.01,null!==this._state.LineRuleIdx){this.numLineHeight.setDefaultUnit(this._arrLineRule[this._state.LineRuleIdx].defaultUnit),this.numLineHeight.setStep(this._arrLineRule[this._state.LineRuleIdx].step);var i="";this._state.LineRuleIdx==c_paragraphLinerule.LINERULE_AUTO?i=this._state.LineHeight:null!==this._state.LineHeight&&(i=Common.Utils.Metric.fnRecalcFromMM(this._state.LineHeight)),this.numLineHeight&&this.numLineHeight.setValue(null!==i?i:"",!0)}var i=this._state.LineSpacingBefore;this.numSpacingBefore&&this.numSpacingBefore.setValue(null!==i?i<0?i:Common.Utils.Metric.fnRecalcFromMM(i):"",!0),i=this._state.LineSpacingAfter,this.numSpacingAfter&&this.numSpacingAfter.setValue(null!==i?i<0?i:Common.Utils.Metric.fnRecalcFromMM(i):"",!0)},createDelayedElements:function(){this._initSettings=!1,this.UpdateThemeColors(),this.updateMetricUnit()},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;if(e.api&&!this._locked){var i=e.api.getSelectedElements();if(i&&i.length>0)for(var n,o,s=i.length-1;s>=0;s--)if(n=i[s].get_ObjectType(),o=i[s].get_ObjectValue(),Asc.c_oAscTypeSelectElement.Paragraph==n){new DE.Views.ParagraphSettingsAdvanced({tableStylerRows:2,tableStylerColumns:1,paragraphProps:o,borderProps:e.borderAdvancedProps,isChart:e.isChart,api:e.api,handler:function(t,i){"ok"==t&&e.api&&(e.borderAdvancedProps=i.borderProps,e.api.paraApply(i.paragraphProps)),e.fireEvent("editcomplete",e)}}).show();break}}}},UpdateThemeColors:function(){this.mnuColorPicker||(this.btnColor.setMenu(),this.mnuColorPicker=this.btnColor.getPicker()),this.mnuColorPicker.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors())},onHideMenus:function(t,e,i){i||this.fireEvent("editcomplete",this)},setLocked:function(t){this._locked=t},disableControls:function(t){this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,function(e){e.setDisabled(t)}),this.linkAdvanced.toggleClass("disabled",t))},hideTextOnlySettings:function(t){this._state.HideTextOnlySettings!==t&&(this._state.HideTextOnlySettings=t,this.TextOnlySettings.toggleClass("hidden",1==t))},strParagraphSpacing:"Paragraph Spacing",strSomeParagraphSpace:"Don't add interval between paragraphs of the same style",strLineHeight:"Line Spacing",strSpacingBefore:"Before",strSpacingAfter:"After",textAuto:"Multiple",textAtLeast:"At least",textExact:"Exactly",textAdvanced:"Show advanced settings",textAt:"At",txtAutoText:"Auto",textBackColor:"Background color",strIndent:"Indents",strIndentsLeftText:"Left",strIndentsRightText:"Right",strIndentsSpecial:"Special",textNoneSpecial:"(none)",textFirstLine:"First line",textHanging:"Hanging"},DE.Views.ParagraphSettings||{}))}),define("text!documenteditor/main/app/template/HeaderFooterSettings.template",[],function(){
return'<table cols="1">\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.textPosition %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <label id="headerfooter-label-position" class="input-label"><%= scope.textHeaderFromTop %></label>\r\n            <div id="headerfooter-spin-position"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <label class="header"><%= scope.textOptions %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="headerfooter-check-diff-first"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="headerfooter-check-diff-odd"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="headerfooter-check-same-as"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <label class="header"><%= scope.textPageNum %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <label><%= scope.textTopPage %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="headerfooter-button-top-left" style="display: inline-block; margin-right:5px;"></div>\r\n            <div id="headerfooter-button-top-center" style="display: inline-block; margin-right:5px;"></div>\r\n            <div id="headerfooter-button-top-right" style="display: inline-block; margin-right:5px;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <label><%= scope.textBottomPage %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="headerfooter-button-bottom-left" style="display: inline-block; margin-right:5px;"></div>\r\n            <div id="headerfooter-button-bottom-center" style="display: inline-block; margin-right:5px;"></div>\r\n            <div id="headerfooter-button-bottom-right" style="display: inline-block; margin-right:5px;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <button type="button" class="btn btn-text-default" id="headerfooter-button-current" style="width:100%;"><%= scope.textInsertCurrent %></button>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <label class="header"><%= scope.textPageNumbering %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="headerfooter-radio-prev"  style="margin-bottom: 5px;"></div>\r\n            <div id="headerfooter-radio-from" style="display: inline-block;vertical-align: middle; margin-right: 2px;"></div>\r\n            <div id="headerfooter-spin-from" style="display: inline-block;vertical-align: middle;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'}),define("documenteditor/main/app/view/HeaderFooterSettings",["text!documenteditor/main/app/template/HeaderFooterSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox","common/main/lib/component/RadioBox"],function(t,e,i,n){"use strict";DE.Views.HeaderFooterSettings=n.View.extend(i.extend({el:"#id-header-settings",template:i.template(t),events:{},options:{alias:"HeaderFooterSettings"},initialize:function(){this._initSettings=!0,this._state={PositionType:c_pageNumPosition.PAGE_NUM_POSITION_TOP,Position:12.5,DiffFirst:!1,DiffOdd:!1,SameAs:!1,DisabledControls:!1,Numbering:void 0},this.spinners=[],this.lockedControls=[],this._locked=!1,this.render()},render:function(){(this.$el||e(this.el)).html(this.template({scope:this}))},setApi:function(t){return this.api=t,this},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedElements(),this.disableControls(this._locked),t){var e=t.get_Type();this._state.PositionType!==e&&(e==c_pageNumPosition.PAGE_NUM_POSITION_BOTTOM?this.lblPosition[0].innerHTML=this.textHeaderFromBottom:this.lblPosition[0].innerHTML=this.textHeaderFromTop,this._state.PositionType=e),e=t.get_Position(),Math.abs(this._state.Position-e)>.001&&(this.numPosition.setValue(Common.Utils.Metric.fnRecalcFromMM(e),!0),this._state.Position=e),e=t.get_DifferentFirst(),this._state.DiffFirst!==e&&(this.chDiffFirst.setValue(e,!0),this._state.DiffFirst=e),e=t.get_DifferentEvenOdd(),this._state.DiffOdd!==e&&(this.chDiffOdd.setValue(e,!0),this._state.DiffOdd=e),e=t.get_LinkToPrevious(),this._state.SameAs!==e&&(this.chSameAs.setDisabled(null===e||this._locked),this.chSameAs.setValue(1==e,!0),this._state.SameAs=e),e=t.get_StartPageNumber(),this._state.Numbering!==e&&null!==e&&(e<0?this.radioPrev.setValue(!0,!0):(this.radioFrom.setValue(!0,!0),this.numFrom.setValue(e,!0)),this._state.Numbering=e)}},onBtnPositionClick:function(t,e){this.api&&this.api.put_PageNum(t.options.posWhere,t.options.posAlign),this.fireEvent("editcomplete",this)},onNumPositionChange:function(t,e,i,n){this.api&&this.api.put_HeadersAndFootersDistance(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))},onDiffFirstChange:function(t,e,i,n){this.api&&this.api.HeadersAndFooters_DifferentFirstPage("checked"==t.getValue()),this.fireEvent("editcomplete",this)},onDiffOddChange:function(t,e,i,n){this.api&&this.api.HeadersAndFooters_DifferentOddandEvenPage("checked"==t.getValue()),this.fireEvent("editcomplete",this)},onSameAsChange:function(t,e,i,n){this.api&&this.api.HeadersAndFooters_LinkToPrevious("checked"==t.getValue()),this.fireEvent("editcomplete",this)},onInsertCurrentClick:function(){this.api&&this.api.put_PageNum(-1),this.fireEvent("editcomplete",this)},onRadioPrev:function(t,e,i){e&&this.api&&this.api.asc_SetSectionStartPage(-1),this.fireEvent("editcomplete",this)},onRadioFrom:function(t,e,n){e&&this.api&&(i.isEmpty(this.numFrom.getValue())&&this.numFrom.setValue(1,!0),this.api.asc_SetSectionStartPage(this.numFrom.getNumberValue())),this.fireEvent("editcomplete",this)},onNumFromChange:function(t,e,i,n){this.api&&(this.radioFrom.setValue(!0,!0),this.api.asc_SetSectionStartPage(t.getNumberValue()))},updateMetricUnit:function(){if(this.spinners){for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.01)}this.numPosition&&this.numPosition.setValue(Common.Utils.Metric.fnRecalcFromMM(this._state.Position),!0)}},createDelayedControls:function(){var t=this,n=[[c_pageNumPosition.PAGE_NUM_POSITION_TOP,c_pageNumPosition.PAGE_NUM_POSITION_LEFT,"page-number-top-left","headerfooter-button-top-left",this.textTopLeft],[c_pageNumPosition.PAGE_NUM_POSITION_TOP,c_pageNumPosition.PAGE_NUM_POSITION_CENTER,"page-number-top-center","headerfooter-button-top-center",this.textTopCenter],[c_pageNumPosition.PAGE_NUM_POSITION_TOP,c_pageNumPosition.PAGE_NUM_POSITION_RIGHT,"page-number-top-right","headerfooter-button-top-right",this.textTopRight],[c_pageNumPosition.PAGE_NUM_POSITION_BOTTOM,c_pageNumPosition.PAGE_NUM_POSITION_LEFT,"page-number-bottom-left","headerfooter-button-bottom-left",this.textBottomLeft],[c_pageNumPosition.PAGE_NUM_POSITION_BOTTOM,c_pageNumPosition.PAGE_NUM_POSITION_CENTER,"page-number-bottom-center","headerfooter-button-bottom-center",this.textBottomCenter],[c_pageNumPosition.PAGE_NUM_POSITION_BOTTOM,c_pageNumPosition.PAGE_NUM_POSITION_RIGHT,"page-number-bottom-right","headerfooter-button-bottom-right",this.textBottomRight]];this._btnsPosition=[],i.each(n,function(t,n,o){var s=new Common.UI.Button({parentEl:e("#"+t[3]),cls:"btn-options huge-1 bg-white",iconCls:"options__icon options__icon-huge "+t[2],posWhere:t[0],posAlign:t[1],hint:t[4]});s.on("click",i.bind(this.onBtnPositionClick,this)),this._btnsPosition.push(s),this.lockedControls.push(s)},this),this.numPosition=new Common.UI.MetricSpinner({el:e("#headerfooter-spin-position"),step:.1,width:85,value:"1.25 cm",defaultUnit:"cm",maxValue:55.88,minValue:0}),this.spinners.push(this.numPosition),this.lockedControls.push(this.numPosition),this.lblPosition=e(this.el).find("#headerfooter-label-position"),this.chDiffFirst=new Common.UI.CheckBox({el:e("#headerfooter-check-diff-first"),labelText:this.textDiffFirst}),this.lockedControls.push(this.chDiffFirst),this.chDiffOdd=new Common.UI.CheckBox({el:e("#headerfooter-check-diff-odd"),labelText:this.textDiffOdd}),this.lockedControls.push(this.chDiffOdd),this.chSameAs=new Common.UI.CheckBox({el:e("#headerfooter-check-same-as"),labelText:this.textSameAs}),this.numPosition.on("change",i.bind(this.onNumPositionChange,this)),this.numPosition.on("inputleave",function(){t.fireEvent("editcomplete",t)}),this.chDiffFirst.on("change",i.bind(this.onDiffFirstChange,this)),this.chDiffOdd.on("change",i.bind(this.onDiffOddChange,this)),this.chSameAs.on("change",i.bind(this.onSameAsChange,this)),this.btnInsertCurrent=new Common.UI.Button({el:e("#headerfooter-button-current")}),this.lockedControls.push(this.btnInsertCurrent),this.btnInsertCurrent.on("click",i.bind(this.onInsertCurrentClick,this)),this.radioPrev=new Common.UI.RadioBox({el:e("#headerfooter-radio-prev"),labelText:this.textPrev,name:"asc-radio-header-numbering",checked:!0}).on("change",i.bind(this.onRadioPrev,this)),this.lockedControls.push(this.radioPrev),this.radioFrom=new Common.UI.RadioBox({el:e("#headerfooter-radio-from"),labelText:this.textFrom,name:"asc-radio-header-numbering"}).on("change",i.bind(this.onRadioFrom,this)),this.lockedControls.push(this.radioFrom),this.numFrom=new Common.UI.MetricSpinner({el:e("#headerfooter-spin-from"),step:1,width:85,value:"1",defaultUnit:"",maxValue:2147483646,minValue:0,allowDecimal:!1}),this.lockedControls.push(this.numFrom),this.numFrom.on("change",i.bind(this.onNumFromChange,this)),this.numFrom.on("inputleave",function(){t.fireEvent("editcomplete",t)})},createDelayedElements:function(){this.createDelayedControls(),this.updateMetricUnit(),this._initSettings=!1},setLocked:function(t){this._locked=t},disableControls:function(t){this._initSettings||this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,function(e){e.setDisabled(t)}),this.chSameAs.setDisabled(t||null===this._state.SameAs))},textHeaderFromTop:"Header from Top",textHeaderFromBottom:"Header from Bottom",textPosition:"Position",textOptions:"Options",textDiffFirst:"Different first page",textDiffOdd:"Different odd and even pages",textPageNum:"Insert Page Number",textTopLeft:"Top Left",textTopRight:"Top Right",textTopCenter:"Top Center",textBottomLeft:"Bottom Left",textBottomRight:"Bottom Right",textBottomCenter:"Bottom Center",textSameAs:"Link to Previous",textInsertCurrent:"Insert to Current Position",textTopPage:"Top of Page",textBottomPage:"Bottom of Page",textPageNumbering:"Page Numbering",textPrev:"Continue from previous section",textFrom:"Start at"},DE.Views.HeaderFooterSettings||{}))}),define("text!documenteditor/main/app/template/ImageSettings.template",[],function(){return'<table cols="2">\r\n    <tr>\r\n        <td colspan=2>\r\n            <label class="header"><%= scope.textSize %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="50%">\r\n            <label id="image-label-width" class="input-label"><%= scope.textWidth %></label>\r\n        </td>\r\n        <td class="padding-small" width="50%">\r\n            <label id="image-label-height" class="input-label"><%= scope.textHeight %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <button type="button" class="btn btn-text-default" id="image-button-original-size" style="min-width:100px;width: auto;"><%= scope.textOriginalSize %></button>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <button type="button" class="btn btn-text-default" id="image-button-fit-margins" style="min-width:100px;width: auto;"><%= scope.textFitMargins %></button>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div id="image-button-crop" style="min-width: 100px;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2 class="padding-small">\r\n            <label class="header"><%= scope.textRotation %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="50%">\r\n            <label class="input-label"><%= scope.textRotate90 %></label>\r\n            <div>\r\n                <div id="image-button-270" style="display: inline-block;margin-right: 4px;"></div>\r\n                <div id="image-button-90" style="display: inline-block;"></div>\r\n            </div>\r\n        </td>\r\n        <td class="padding-small" width="50%">\r\n            <label class="input-label"><%= scope.textFlip %></label>\r\n            <div>\r\n                <div id="image-button-fliph" style="display: inline-block;margin-right: 4px;"></div>\r\n                <div id="image-button-flipv" style="display: inline-block;"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2 class="padding-small">\r\n            <label class="header"><%= scope.textWrap %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div id="image-combo-wrap" style="width: 100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2>\r\n            <div id="image-button-replace" style="width:100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <button type="button" class="btn btn-text-default hidden" id="image-button-edit-object" style="width:100%;"><%= scope.textEditObject %></button>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td align="center" colspan=2>\r\n            <label class="link" id="image-advanced-link"><%= scope.textAdvanced %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'}),define("text!documenteditor/main/app/template/ImageSettingsAdvanced.template",[],function(){
return'<div id="id-adv-image-width" class="settings-panel active">\r\n    <div class="inner-content">\r\n    <table cols="4" width="100%">\r\n        <tr>\r\n            <td width="88px">\r\n                <label class="input-label"><%= scope.textWidth %></label>\r\n                <div id="image-advanced-spin-width"></div>\r\n            </td>\r\n            <td width="28px" style="vertical-align: bottom;">\r\n                <div id="image-advanced-button-ratio"></div>\r\n            </td>\r\n            <td width="88px">\r\n                <label class="input-label"><%= scope.textHeight %></label>\r\n                <div id="image-advanced-spin-height"></div>\r\n            </td>\r\n            <td style="vertical-align: bottom;">\r\n                <button type="button" class="btn btn-text-default" id="image-advanced-button-original-size" style="width:100px;"><%= scope.textOriginalSize %></button>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n    </div>\r\n</div>\r\n<div id="id-adv-shape-size" class="settings-panel active">\r\n    <div class="inner-content">\r\n    <table cols="3">\r\n        <tr>\r\n            <td colspan="3">\r\n                <label class="header"><%= scope.textWidth %></label>\r\n            </td>\r\n        </tr>\r\n        <tr>\r\n            <td style="vertical-align: bottom; padding-bottom: 12px;">\r\n                <div id="shape-radio-hsize"></div>\r\n            </td>\r\n            <td class="padding-small">\r\n                <label class="input-label"><%= scope.textAbsoluteWH %></label>\r\n                <div id="shape-advanced-spin-width"></div>\r\n            </td>\r\n        </tr>\r\n        <tr>\r\n            <td style="vertical-align: bottom; padding-bottom: 19px;">\r\n                <div id="shape-radio-hsizepc"></div>\r\n            </td>\r\n            <td class="padding-large" style="padding-right: 15px;">\r\n                <label class="input-label"><%= scope.textRelativeWH %></label>\r\n                <div id="shape-advanced-spin-width-rel"></div>\r\n            </td>\r\n            <td class="padding-large">\r\n                <label class="input-label"><%= scope.textRelative %></label>\r\n                <div id="shape-combo-width-rel" style="width: 115px;"></div>\r\n            </td>\r\n        </tr>\r\n        <tr>\r\n            <td colspan="3">\r\n                <label class="header"><%= scope.textHeight %></label>\r\n            </td>\r\n        </tr>\r\n        <tr>\r\n            <td style="vertical-align: bottom; padding-bottom: 12px;">\r\n                <div id="shape-radio-vsize"></div>\r\n            </td>\r\n            <td class="padding-small">\r\n                <label class="input-label"><%= scope.textAbsoluteWH %></label>\r\n                <div id="shape-advanced-spin-height"></div>\r\n            </td>\r\n        </tr>\r\n        <tr>\r\n            <td style="vertical-align: bottom; padding-bottom: 19px;">\r\n                <div id="shape-radio-vsizepc"></div>\r\n            </td>\r\n            <td class="padding-large" style="padding-right: 15px;">\r\n                <label class="input-label"><%= scope.textRelativeWH %></label>\r\n                <div id="shape-advanced-spin-height-rel"></div>\r\n            </td>\r\n            <td class="padding-large">\r\n                <label class="input-label"><%= scope.textRelative %></label>\r\n                <div id="shape-combo-height-rel" style="width: 115px;"></div>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n    </div>\r\n    <div class="separator horizontal padding-large"></div>\r\n    <div class="inner-content">\r\n        <table cols="1" style="width: 100%;">\r\n            <tr>\r\n                <td>\r\n                    <div id="shape-checkbox-ratio"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-adv-image-rotate" class="settings-panel active">\r\n    <div class="inner-content  padding-large">\r\n        <div style="width: 100%;">\r\n            <label class="input-label"><%= scope.textAngle %></label>\r\n            <div id="image-advanced-spin-angle" style="display: inline-block; margin-left: 5px;"></div>\r\n        </div>\r\n    </div>\r\n    <div class="separator horizontal padding-large"></div>\r\n    <div class="inner-content  padding-large">\r\n        <table cols="2">\r\n            <tr>\r\n                <td rowspan="2" class="padding-small" style="vertical-align: top;">\r\n                    <label class="input-label" style="margin-right: 15px;vertical-align: top;"><%= scope.textFlipped %></label>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <div id="image-advanced-checkbox-hor"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <div id="image-advanced-checkbox-vert"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-adv-image-wrap" class="settings-panel">\r\n    <div class="inner-content padding-large">\r\n        <label class="header padding-small"><%= scope.textWrap %></label>\r\n        <div class="padding-small">\r\n            <div id="image-advanced-button-wrap-inline" style="display: inline-block; margin-right:7px;"></div>\r\n            <div id="image-advanced-button-wrap-square" style="display: inline-block; margin-right:7px;"></div>\r\n            <div id="image-advanced-button-wrap-tight" style="display: inline-block; margin-right:7px;"></div>\r\n            <div id="image-advanced-button-wrap-through" style="display: inline-block; margin-right:7px;"></div>\r\n        </div>\r\n        <div class="padding-small">\r\n            <div id="image-advanced-button-wrap-topbottom" style="display: inline-block; margin-right:7px;"></div>\r\n            <div id="image-advanced-button-wrap-infront" style="display: inline-block; margin-right:7px;"></div>\r\n            <div id="image-advanced-button-wrap-behind" style="display: inline-block;"></div>\r\n        </div>\r\n    </div>\r\n    <div class="separator horizontal padding-large"></div>\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textDistance %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="125px">\r\n                    <label class="input-label"><%= scope.textTop %></label>\r\n                    <div id="image-advanced-distance-top"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textLeft %></label>\r\n                    <div id="image-advanced-distance-left"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textBottom %></label>\r\n                    <div id="image-advanced-distance-bottom"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textRight %></label>\r\n                    <div id="image-advanced-distance-right"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-adv-image-position" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="3" style="width: 100%;">\r\n            <tr>\r\n                <td colspan="3">\r\n                    <label class="header"><%= scope.textHorizontal %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td style="vertical-align: bottom; padding-bottom: 12px;">\r\n                    <div id="image-radio-halign"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textAlignment %></label>\r\n                    <div id="image-combo-halign" style="width: 115px;"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textRelative %></label>\r\n                    <div id="image-combo-hrelative" style="width: 115px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td style="vertical-align: bottom; padding-bottom: 12px;">\r\n                    <div id="image-radio-hposition"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textPosition %></label>\r\n                    <div id="image-spin-x"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textRightOf %></label>\r\n                    <div id="image-combo-hposition" style="width: 115px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td style="vertical-align: bottom; padding-bottom: 19px;">\r\n                    <div id="image-radio-hpositionpc"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textPositionPc %></label>\r\n                    <div id="image-spin-xpc"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textRelative %></label>\r\n                    <div id="image-combo-hpositionpc" style="width: 115px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan="3">\r\n                    <label class="header"><%= scope.textVertical %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td style="vertical-align: bottom; padding-bottom: 12px;">\r\n                    <div id="image-radio-valign"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textAlignment %></label>\r\n                    <div id="image-combo-valign" style="width: 115px;"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textRelative %></label>\r\n                    <div id="image-combo-vrelative" style="width: 115px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td style="vertical-align: bottom; padding-bottom: 12px;">\r\n                    <div id="image-radio-vposition"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textPosition %></label>\r\n                    <div id="image-spin-y"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textBelow %></label>\r\n                    <div id="image-combo-vposition" style="width: 115px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td style="vertical-align: bottom; padding-bottom: 19px;">\r\n                    <div id="image-radio-vpositionpc"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textPositionPc %></label>\r\n                    <div id="image-spin-ypc"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textRelative %></label>\r\n                    <div id="image-combo-vpositionpc" style="width: 115px;"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n    <div class="separator horizontal padding-small"></div>\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan="2">\r\n                    <label class="header"><%= scope.textOptions %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    <div id="image-checkbox-move"></div>\r\n                </td>\r\n                <td>\r\n                    <div id="image-checkbox-overlap"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-adv-image-shape" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textLineStyle %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large" width="125px">\r\n                    <label class="input-label"><%= scope.textCapType %></label>\r\n                    <div id="shape-advanced-cap-type" style="width: 100px;"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textJoinType %></label>\r\n                    <div id="shape-advanced-join-type" style="width: 100px;"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n    <div class="separator horizontal padding-large"></div>\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textArrows %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="125px">\r\n                    <label class="input-label"><%= scope.textBeginStyle %></label>\r\n                    <div id="shape-advanced-begin-style" style="width: 100px;"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textEndStyle %></label>\r\n                    <div id="shape-advanced-end-style" style="width: 100px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textBeginSize %></label>\r\n                    <div id="shape-advanced-begin-size" style="width: 100px;"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textEndSize %></label>\r\n                    <div id="shape-advanced-end-size" style="width: 100px;"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-adv-image-margins" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="1" style="width: 100%;">\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <label class="header"><%= scope.textAutofit %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <div id="shape-checkbox-autofit"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n        <div class="separator horizontal padding-large"></div>\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.strMargins %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="125px">\r\n                    <label class="input-label"><%= scope.textTop %></label>\r\n                    <div id="image-margin-top"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textLeft %></label>\r\n                    <div id="image-margin-left"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textBottom %></label>\r\n                    <div id="image-margin-bottom"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textRight %></label>\r\n                    <div id="image-margin-right"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-adv-image-alttext" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="1" width="100%">\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <label class="header"><%= scope.textAltTitle %></label>\r\n                    <div id="image-advanced-alt-title"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    <label class="header"><%= scope.textAltDescription %></label>\r\n                    <textarea id="image-advanced-alt-description" class="form-control" style="width: 100%; height: 120px;"></textarea>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    <label><%= scope.textAltTip %></label>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>'}),define("documenteditor/main/app/view/ImageSettingsAdvanced",["text!documenteditor/main/app/template/ImageSettingsAdvanced.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/ComboBox","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox","common/main/lib/component/RadioBox"],function(t){"use strict";DE.Views.ImageSettingsAdvanced=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:340,height:485,toggleGroup:"image-adv-settings-group",sizeOriginal:{width:0,height:0},sizeMax:{width:55.88,height:55.88},properties:null,storageName:"de-img-settings-adv-category"},initialize:function(e){_.extend(this.options,{title:this.textTitle,items:[{panelId:"id-adv-image-width",panelCaption:this.textSize},{panelId:"id-adv-shape-size",panelCaption:this.textSize},{panelId:"id-adv-image-rotate",panelCaption:this.textRotation},{panelId:"id-adv-image-wrap",panelCaption:this.textBtnWrap},{panelId:"id-adv-image-position",panelCaption:this.textPosition},{panelId:"id-adv-image-shape",panelCaption:this.textWeightArrows},{panelId:"id-adv-image-margins",panelCaption:this.textTextBox},{panelId:"id-adv-image-alttext",panelCaption:this.textAlt}],contentTemplate:_.template(t)({scope:this})},e),Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this.spinners=[],this._state={HAlignType:Asc.c_oAscAlignH.Left,HAlignFrom:Asc.c_oAscRelativeFromH.Character,HPositionFrom:Asc.c_oAscRelativeFromH.Character,HPositionPcFrom:Asc.c_oAscRelativeFromH.Page,ShapeWidthPcFrom:Asc.c_oAscRelativeFromH.Margin,VAlignType:Asc.c_oAscAlignV.Top,VAlignFrom:Asc.c_oAscRelativeFromV.Paragraph,VPositionFrom:Asc.c_oAscRelativeFromV.Paragraph,VPositionPcFrom:Asc.c_oAscRelativeFromV.Page,ShapeHeightPcFrom:Asc.c_oAscRelativeFromV.Margin,spnXChanged:!1,spnYChanged:!1,spnXPcChanged:!1,spnYPcChanged:!1},this._objectType=Asc.c_oAscTypeSelectElement.Image,this.Margins=void 0,this._nRatio=1,this._originalProps=this.options.imageProps,this.sectionProps=this.options.sectionProps,this.pageWidth=this.options.sectionProps?this.options.sectionProps.get_W():210,this.pageHeight=this.options.sectionProps?this.options.sectionProps.get_H():297,this.api=this.options.api,this._changedProps=null,this._changedShapeProps=null},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.spnWidth=new Common.UI.MetricSpinner({el:$("#image-advanced-spin-width"),step:.1,width:80,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0}),this.spnWidth.on("change",_.bind(function(t,e,i,n){if(this.btnRatio.pressed){var o=t.getNumberValue(),s=o/this._nRatio;s>this.sizeMax.height&&(s=this.sizeMax.height,o=s*this._nRatio,this.spnWidth.setValue(o,!0)),this.spnHeight.setValue(s,!0)}this._changedProps&&(this._changedProps.put_Width(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this._changedProps.put_Height(Common.Utils.Metric.fnRecalcToMM(this.spnHeight.getNumberValue())),this._changedProps.put_ResetCrop(!1))},this)),this.spinners.push(this.spnWidth),this.spnHeight=new Common.UI.MetricSpinner({el:$("#image-advanced-spin-height"),step:.1,width:80,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0}),this.spnHeight.on("change",_.bind(function(t,e,i,n){var o=t.getNumberValue(),s=null;this.btnRatio.pressed&&(s=o*this._nRatio,s>this.sizeMax.width&&(s=this.sizeMax.width,o=s/this._nRatio,this.spnHeight.setValue(o,!0)),this.spnWidth.setValue(s,!0)),this._changedProps&&(this._changedProps.put_Height(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this._changedProps.put_Width(Common.Utils.Metric.fnRecalcToMM(this.spnWidth.getNumberValue())),this._changedProps.put_ResetCrop(!1))},this)),this.spinners.push(this.spnHeight),this.btnOriginalSize=new Common.UI.Button({el:$("#image-advanced-button-original-size")}),this.btnOriginalSize.on("click",_.bind(function(t,e){this.spnAngle.setValue(0),this.spnWidth.setValue(this.sizeOriginal.width,!0),this.spnHeight.setValue(this.sizeOriginal.height,!0),this._nRatio=this.sizeOriginal.width/this.sizeOriginal.height,this._changedProps&&(this._changedProps.put_Height(Common.Utils.Metric.fnRecalcToMM(this.spnHeight.getNumberValue())),this._changedProps.put_Width(Common.Utils.Metric.fnRecalcToMM(this.spnWidth.getNumberValue())),this._changedProps.put_ResetCrop(!0),this._changedProps.put_Rot(0))},this)),this.btnRatio=new Common.UI.Button({parentEl:$("#image-advanced-button-ratio"),cls:"btn-toolbar",iconCls:"toolbar__icon advanced-btn-ratio",style:"margin-bottom: 1px;",enableToggle:!0,hint:this.textKeepRatio}),this.btnRatio.on("click",_.bind(function(t,e){t.pressed&&this.spnHeight.getNumberValue()>0&&(this._nRatio=this.spnWidth.getNumberValue()/this.spnHeight.getNumberValue()),this._changedProps&&this._changedProps.asc_putLockAspect(t.pressed)},this)),this.radioHSize=new Common.UI.RadioBox({el:$("#shape-radio-hsize"),name:"asc-radio-width",checked:!0}),this.radioHSize.on("change",_.bind(this.onRadioHSizeChange,this)),this.radioHSizePc=new Common.UI.RadioBox({el:$("#shape-radio-hsizepc"),name:"asc-radio-width"}),this.radioHSizePc.on("change",_.bind(this.onRadioHSizePcChange,this)),this.radioVSize=new Common.UI.RadioBox({el:$("#shape-radio-vsize"),name:"asc-radio-height",checked:!0}),this.radioVSize.on("change",_.bind(this.onRadioVSizeChange,this)),this.radioVSizePc=new Common.UI.RadioBox({el:$("#shape-radio-vsizepc"),name:"asc-radio-height"}),this.radioVSizePc.on("change",_.bind(this.onRadioVSizePcChange,this)),this.chRatio=new Common.UI.CheckBox({el:$("#shape-checkbox-ratio"),labelText:this.textAspectRatio}),this.chRatio.on("change",_.bind(function(t,e,i,n){"checked"==t.getValue()&&this.spnShapeHeight.getNumberValue()>0&&(this._nRatio=this.spnShapeWidth.getNumberValue()/this.spnShapeHeight.getNumberValue()),this._changedProps&&this._changedProps.asc_putLockAspect("checked"==t.getValue())},this)),this.spnShapeWidth=new Common.UI.MetricSpinner({el:$("#shape-advanced-spin-width"),step:.1,width:80,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0}),this.spnShapeWidth.on("change",_.bind(function(t,e,i,n){if("checked"==this.chRatio.getValue()&&!this.chRatio.isDisabled()){var o=t.getNumberValue(),s=o/this._nRatio;s>this.sizeMax.height&&(s=this.sizeMax.height,o=s*this._nRatio,this.spnShapeWidth.setValue(o,!0)),this.spnShapeHeight.setValue(s,!0)}this._changedProps&&(this._changedProps.put_Width(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.fillShapeHeight())},this)),this.spinners.push(this.spnShapeWidth),this.spnShapeHeight=new Common.UI.MetricSpinner({el:$("#shape-advanced-spin-height"),step:.1,width:80,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0}),this.spnShapeHeight.on("change",_.bind(function(t,e,i,n){var o=t.getNumberValue(),s=null;"checked"!=this.chRatio.getValue()||this.chRatio.isDisabled()||(s=o*this._nRatio,s>this.sizeMax.width&&(s=this.sizeMax.width,o=s/this._nRatio,this.spnShapeHeight.setValue(o,!0)),this.spnShapeWidth.setValue(s,!0)),this._changedProps&&(this._changedProps.put_Height(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.fillShapeWidth())},this)),this.spinners.push(this.spnShapeHeight),this.spnShapeWidthPc=new Common.UI.MetricSpinner({el:$("#shape-advanced-spin-width-rel"),disabled:!0,step:1,width:80,defaultUnit:"%",value:"1 %",maxValue:1e3,minValue:1}),this.spnShapeWidthPc.on("change",_.bind(function(t,e,i,n){this._changedProps&&(null!==this._changedProps.get_SizeRelH()&&void 0!==this._changedProps.get_SizeRelH()||this._changedProps.put_SizeRelH(new Asc.CImagePositionH),this._changedProps.get_SizeRelH().put_Value(t.getNumberValue()),this._changedProps.get_SizeRelH().put_RelativeFrom(this._state.ShapeWidthPcFrom),this.fillShapeHeight())},this)),this.spnShapeHeightPc=new Common.UI.MetricSpinner({el:$("#shape-advanced-spin-height-rel"),disabled:!0,step:1,width:80,defaultUnit:"%",value:"1 %",maxValue:1e3,minValue:1}),this.spnShapeHeightPc.on("change",_.bind(function(t,e,i,n){this._changedProps&&(null!==this._changedProps.get_SizeRelV()&&void 0!==this._changedProps.get_SizeRelV()||this._changedProps.put_SizeRelV(new Asc.CImagePositionV),this._changedProps.get_SizeRelV().put_Value(t.getNumberValue()),this._changedProps.get_SizeRelV().put_RelativeFrom(this._state.ShapeHeightPcFrom),this.fillShapeWidth())},this)),this._arrHRelativePc=[{displayValue:this.textLeftMargin,value:Asc.c_oAscRelativeFromH.LeftMargin,size:this.sectionProps.get_LeftMargin()},{displayValue:this.textMargin,value:Asc.c_oAscRelativeFromH.Margin,size:this.sectionProps.get_W()-this.sectionProps.get_LeftMargin()-this.sectionProps.get_RightMargin()},{displayValue:this.textPage,value:Asc.c_oAscRelativeFromH.Page,size:this.sectionProps.get_W()},{displayValue:this.textRightMargin,value:Asc.c_oAscRelativeFromH.RightMargin,size:this.sectionProps.get_RightMargin()}],this.cmbWidthPc=new Common.UI.ComboBox({el:$("#shape-combo-width-rel"),cls:"input-group-nr",menuStyle:"min-width: 115px;",editable:!1,data:this._arrHRelativePc,takeFocusOnClose:!0}),this.cmbWidthPc.setDisabled(!0),this.cmbWidthPc.setValue(this._state.ShapeWidthPcFrom),this.cmbWidthPc.on("selected",_.bind(this.onCmbWidthPcSelect,this)),this._arrVRelativePc=[{displayValue:this.textMargin,value:Asc.c_oAscRelativeFromV.Margin,size:this.sectionProps.get_H()-this.sectionProps.get_TopMargin()-this.sectionProps.get_BottomMargin()},{displayValue:this.textBottomMargin,value:Asc.c_oAscRelativeFromV.BottomMargin,size:this.sectionProps.get_BottomMargin()},{displayValue:this.textPage,value:Asc.c_oAscRelativeFromV.Page,size:this.sectionProps.get_H()},{displayValue:this.textTopMargin,value:Asc.c_oAscRelativeFromV.TopMargin,size:this.sectionProps.get_TopMargin()}],this.cmbHeightPc=new Common.UI.ComboBox({el:$("#shape-combo-height-rel"),cls:"input-group-nr",menuStyle:"min-width: 115px;",editable:!1,data:this._arrVRelativePc,takeFocusOnClose:!0}),this.cmbHeightPc.setDisabled(!0),this.cmbHeightPc.setValue(this._state.ShapeHeightPcFrom),this.cmbHeightPc.on("selected",_.bind(this.onCmbHeightPcSelect,this)),this.spnAngle=new Common.UI.MetricSpinner({el:$("#image-advanced-spin-angle"),step:1,width:80,defaultUnit:"Â°",value:"0 Â°",maxValue:3600,minValue:-3600}),this.chFlipHor=new Common.UI.CheckBox({el:$("#image-advanced-checkbox-hor"),labelText:this.textHorizontally}),this.chFlipVert=new Common.UI.CheckBox({el:$("#image-advanced-checkbox-vert"),labelText:this.textVertically}),this.btnWrapInline=new Common.UI.Button({parentEl:$("#image-advanced-button-wrap-inline"),cls:"btn-options huge-1",iconCls:"icon-advanced-wrap options__icon options__icon-huge btn-wrap-inline",posId:Asc.c_oAscWrapStyle2.Inline,hint:this.textWrapInlineTooltip,enableToggle:!0,allowDepress:!1,toggleGroup:"imgAdvWrapGroup"}),this.btnWrapInline.on("click",_.bind(this.onBtnWrapClick,this)),this.btnWrapSquare=new Common.UI.Button({parentEl:$("#image-advanced-button-wrap-square"),cls:"btn-options huge-1",iconCls:"icon-advanced-wrap options__icon options__icon-huge btn-wrap-square",posId:Asc.c_oAscWrapStyle2.Square,hint:this.textWrapSquareTooltip,enableToggle:!0,allowDepress:!1,toggleGroup:"imgAdvWrapGroup"}),this.btnWrapSquare.on("click",_.bind(this.onBtnWrapClick,this)),this.btnWrapTight=new Common.UI.Button({parentEl:$("#image-advanced-button-wrap-tight"),cls:"btn-options huge-1",iconCls:"icon-advanced-wrap options__icon options__icon-huge btn-wrap-tight",posId:Asc.c_oAscWrapStyle2.Tight,hint:this.textWrapTightTooltip,enableToggle:!0,allowDepress:!1,toggleGroup:"imgAdvWrapGroup"}),this.btnWrapTight.on("click",_.bind(this.onBtnWrapClick,this)),this.btnWrapThrough=new Common.UI.Button({parentEl:$("#image-advanced-button-wrap-through"),cls:"btn-options huge-1",iconCls:"icon-advanced-wrap options__icon options__icon-huge btn-wrap-through",posId:Asc.c_oAscWrapStyle2.Through,hint:this.textWrapThroughTooltip,enableToggle:!0,allowDepress:!1,toggleGroup:"imgAdvWrapGroup"}),this.btnWrapThrough.on("click",_.bind(this.onBtnWrapClick,this)),this.btnWrapTopBottom=new Common.UI.Button({parentEl:$("#image-advanced-button-wrap-topbottom"),cls:"btn-options huge-1",iconCls:"icon-advanced-wrap options__icon options__icon-huge btn-wrap-topbottom",posId:Asc.c_oAscWrapStyle2.TopAndBottom,hint:this.textWrapTopbottomTooltip,enableToggle:!0,allowDepress:!1,toggleGroup:"imgAdvWrapGroup"}),this.btnWrapTopBottom.on("click",_.bind(this.onBtnWrapClick,this)),this.btnWrapBehind=new Common.UI.Button({parentEl:$("#image-advanced-button-wrap-behind"),cls:"btn-options huge-1",iconCls:"icon-advanced-wrap options__icon options__icon-huge btn-wrap-behind",posId:Asc.c_oAscWrapStyle2.Behind,hint:this.textWrapBehindTooltip,enableToggle:!0,allowDepress:!1,toggleGroup:"imgAdvWrapGroup"}),this.btnWrapBehind.on("click",_.bind(this.onBtnWrapClick,this)),this.btnWrapInFront=new Common.UI.Button({parentEl:$("#image-advanced-button-wrap-infront"),cls:"btn-options huge-1",iconCls:"icon-advanced-wrap options__icon options__icon-huge btn-wrap-infront",posId:Asc.c_oAscWrapStyle2.InFront,hint:this.textWrapInFrontTooltip,enableToggle:!0,allowDepress:!1,toggleGroup:"imgAdvWrapGroup"}),this.btnWrapInFront.on("click",_.bind(this.onBtnWrapClick,this)),this.spnTop=new Common.UI.MetricSpinner({el:$("#image-advanced-distance-top"),step:.1,width:85,defaultUnit:"cm",value:"0 cm",maxValue:55.87,minValue:0}),this.spnTop.on("change",_.bind(function(t,e,i,n){this._changedProps&&(null!==this._changedProps.get_Paddings()&&void 0!==this._changedProps.get_Paddings()||this._changedProps.put_Paddings(new Asc.asc_CPaddings),this._changedProps.get_Paddings().put_Top(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},this)),this.spinners.push(this.spnTop),this.spnBottom=new Common.UI.MetricSpinner({el:$("#image-advanced-distance-bottom"),step:.1,width:85,defaultUnit:"cm",value:"0 cm",maxValue:55.87,minValue:0}),this.spnBottom.on("change",_.bind(function(t,e,i,n){this._changedProps&&(null!==this._changedProps.get_Paddings()&&void 0!==this._changedProps.get_Paddings()||this._changedProps.put_Paddings(new Asc.asc_CPaddings),this._changedProps.get_Paddings().put_Bottom(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},this)),this.spinners.push(this.spnBottom),this.spnLeft=new Common.UI.MetricSpinner({el:$("#image-advanced-distance-left"),step:.1,width:85,
defaultUnit:"cm",value:"0.32 cm",maxValue:55.87,minValue:0}),this.spnLeft.on("change",_.bind(function(t,e,i,n){this._changedProps&&(null!==this._changedProps.get_Paddings()&&void 0!==this._changedProps.get_Paddings()||this._changedProps.put_Paddings(new Asc.asc_CPaddings),this._changedProps.get_Paddings().put_Left(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},this)),this.spinners.push(this.spnLeft),this.spnRight=new Common.UI.MetricSpinner({el:$("#image-advanced-distance-right"),step:.1,width:85,defaultUnit:"cm",value:"0.32 cm",maxValue:55.87,minValue:0}),this.spnRight.on("change",_.bind(function(t,e,i,n){this._changedProps&&(null!==this._changedProps.get_Paddings()&&void 0!==this._changedProps.get_Paddings()||this._changedProps.put_Paddings(new Asc.asc_CPaddings),this._changedProps.get_Paddings().put_Right(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},this)),this.spinners.push(this.spnRight),this.spnX=new Common.UI.MetricSpinner({el:$("#image-spin-x"),step:.1,width:115,disabled:!0,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:-55.87}),this.spnX.on("change",_.bind(function(t,e,i,n){this._changedProps&&(null!==this._changedProps.get_PositionH()&&void 0!==this._changedProps.get_PositionH()||this._changedProps.put_PositionH(new Asc.CImagePositionH),this._changedProps.get_PositionH().put_UseAlign(!1),this._changedProps.get_PositionH().put_Percent(!1),this._changedProps.get_PositionH().put_RelativeFrom(this._state.HPositionFrom),this._changedProps.get_PositionH().put_Value(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this._state.spnXChanged=!0)},this)),this.spinners.push(this.spnX),this.spnY=new Common.UI.MetricSpinner({el:$("#image-spin-y"),step:.1,width:115,disabled:!0,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:-55.87}),this.spnY.on("change",_.bind(function(t,e,i,n){this._changedProps&&(null!==this._changedProps.get_PositionV()&&void 0!==this._changedProps.get_PositionV()||this._changedProps.put_PositionV(new Asc.CImagePositionV),this._changedProps.get_PositionV().put_UseAlign(!1),this._changedProps.get_PositionV().put_Percent(!1),this._changedProps.get_PositionV().put_RelativeFrom(this._state.VPositionFrom),this._changedProps.get_PositionV().put_Value(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this._state.spnYChanged=!0)},this)),this.spinners.push(this.spnY),this._arrHAlign=[{displayValue:this.textLeft,value:Asc.c_oAscAlignH.Left},{displayValue:this.textCenter,value:Asc.c_oAscAlignH.Center},{displayValue:this.textRight,value:Asc.c_oAscAlignH.Right}],this.cmbHAlign=new Common.UI.ComboBox({el:$("#image-combo-halign"),cls:"input-group-nr",menuStyle:"min-width: 115px;",editable:!1,data:this._arrHAlign,takeFocusOnClose:!0}),this.cmbHAlign.setValue(this._state.HAlignType),this.cmbHAlign.on("selected",_.bind(this.onHAlignSelect,this)),this._arrHRelative=[{displayValue:this.textCharacter,value:Asc.c_oAscRelativeFromH.Character},{displayValue:this.textColumn,value:Asc.c_oAscRelativeFromH.Column},{displayValue:this.textLeftMargin,value:Asc.c_oAscRelativeFromH.LeftMargin},{displayValue:this.textMargin,value:Asc.c_oAscRelativeFromH.Margin},{displayValue:this.textPage,value:Asc.c_oAscRelativeFromH.Page},{displayValue:this.textRightMargin,value:Asc.c_oAscRelativeFromH.RightMargin}],this.cmbHRelative=new Common.UI.ComboBox({el:$("#image-combo-hrelative"),cls:"input-group-nr",menuStyle:"min-width: 115px;",editable:!1,data:this._arrHRelative,takeFocusOnClose:!0}),this.cmbHRelative.setValue(this._state.HAlignFrom),this.cmbHRelative.on("selected",_.bind(this.onHRelativeSelect,this)),this.cmbHPosition=new Common.UI.ComboBox({el:$("#image-combo-hposition"),cls:"input-group-nr",menuStyle:"min-width: 115px;",editable:!1,data:this._arrHRelative,takeFocusOnClose:!0}),this.cmbHPosition.setDisabled(!0),this.cmbHPosition.setValue(this._state.HPositionFrom),this.cmbHPosition.on("selected",_.bind(this.onHPositionSelect,this)),this.spnXPc=new Common.UI.MetricSpinner({el:$("#image-spin-xpc"),step:1,width:115,disabled:!0,defaultUnit:"%",defaultValue:0,value:"0 %",maxValue:1e3,minValue:-1e3}),this.spnXPc.on("change",_.bind(function(t,e,i,n){this._changedProps&&(null!==this._changedProps.get_PositionH()&&void 0!==this._changedProps.get_PositionH()||this._changedProps.put_PositionH(new Asc.CImagePositionH),this._changedProps.get_PositionH().put_UseAlign(!1),this._changedProps.get_PositionH().put_Percent(!0),this._changedProps.get_PositionH().put_RelativeFrom(this._state.HPositionPcFrom),this._changedProps.get_PositionH().put_Value(t.getNumberValue()),this._state.spnXPcChanged=!0)},this)),this.cmbHPositionPc=new Common.UI.ComboBox({el:$("#image-combo-hpositionpc"),cls:"input-group-nr",menuStyle:"min-width: 115px;",editable:!1,data:this._arrHRelativePc,takeFocusOnClose:!0}),this.cmbHPositionPc.setDisabled(!0),this.cmbHPositionPc.setValue(this._state.HPositionPcFrom),this.cmbHPositionPc.on("selected",_.bind(this.onHPositionPcSelect,this)),this._arrVAlign=[{displayValue:this.textTop,value:Asc.c_oAscAlignV.Top},{displayValue:this.textCenter,value:Asc.c_oAscAlignV.Center},{displayValue:this.textBottom,value:Asc.c_oAscAlignV.Bottom}],this.cmbVAlign=new Common.UI.ComboBox({el:$("#image-combo-valign"),cls:"input-group-nr",menuStyle:"min-width: 115px;",editable:!1,data:this._arrVAlign,takeFocusOnClose:!0}),this.cmbVAlign.setValue(this._state.VAlignType),this.cmbVAlign.on("selected",_.bind(this.onVAlignSelect,this)),this._arrVRelative=[{displayValue:this.textLine,value:Asc.c_oAscRelativeFromV.Line},{displayValue:this.textMargin,value:Asc.c_oAscRelativeFromV.Margin},{displayValue:this.textBottomMargin,value:Asc.c_oAscRelativeFromV.BottomMargin},{displayValue:this.textParagraph,value:Asc.c_oAscRelativeFromV.Paragraph},{displayValue:this.textPage,value:Asc.c_oAscRelativeFromV.Page},{displayValue:this.textTopMargin,value:Asc.c_oAscRelativeFromV.TopMargin}],this.cmbVRelative=new Common.UI.ComboBox({el:$("#image-combo-vrelative"),cls:"input-group-nr",menuStyle:"min-width: 115px;",editable:!1,data:this._arrVRelative,takeFocusOnClose:!0}),this.cmbVRelative.setValue(this._state.VAlignFrom),this.cmbVRelative.on("selected",_.bind(this.onVRelativeSelect,this)),this.cmbVPosition=new Common.UI.ComboBox({el:$("#image-combo-vposition"),cls:"input-group-nr",menuStyle:"min-width: 115px;",editable:!1,data:this._arrVRelative,takeFocusOnClose:!0}),this.cmbVPosition.setDisabled(!0),this.cmbVPosition.setValue(this._state.VPositionFrom),this.cmbVPosition.on("selected",_.bind(this.onVPositionSelect,this)),this.spnYPc=new Common.UI.MetricSpinner({el:$("#image-spin-ypc"),step:1,width:115,disabled:!0,defaultUnit:"%",defaultValue:0,value:"0 %",maxValue:1e3,minValue:-1e3}),this.spnYPc.on("change",_.bind(function(t,e,i,n){this._changedProps&&(null!==this._changedProps.get_PositionV()&&void 0!==this._changedProps.get_PositionV()||this._changedProps.put_PositionV(new Asc.CImagePositionV),this._changedProps.get_PositionV().put_UseAlign(!1),this._changedProps.get_PositionV().put_Percent(!0),this._changedProps.get_PositionV().put_RelativeFrom(this._state.VPositionPcFrom),this._changedProps.get_PositionV().put_Value(t.getNumberValue()),this._state.spnYPcChanged=!0)},this)),this.cmbVPositionPc=new Common.UI.ComboBox({el:$("#image-combo-vpositionpc"),cls:"input-group-nr",menuStyle:"min-width: 115px;",editable:!1,data:this._arrVRelativePc,takeFocusOnClose:!0}),this.cmbVPositionPc.setDisabled(!0),this.cmbVPositionPc.setValue(this._state.VPositionPcFrom),this.cmbVPositionPc.on("selected",_.bind(this.onVPositionPcSelect,this)),this.radioHAlign=new Common.UI.RadioBox({el:$("#image-radio-halign"),name:"asc-radio-horizontal",checked:!0}),this.radioHAlign.on("change",_.bind(this.onRadioHAlignChange,this)),this.radioHPosition=new Common.UI.RadioBox({el:$("#image-radio-hposition"),name:"asc-radio-horizontal"}),this.radioHPosition.on("change",_.bind(this.onRadioHPositionChange,this)),this.radioHPositionPc=new Common.UI.RadioBox({el:$("#image-radio-hpositionpc"),name:"asc-radio-horizontal"}),this.radioHPositionPc.on("change",_.bind(this.onRadioHPositionPcChange,this)),this.radioVAlign=new Common.UI.RadioBox({el:$("#image-radio-valign"),name:"asc-radio-vertical",checked:!0}),this.radioVAlign.on("change",_.bind(this.onRadioVAlignChange,this)),this.radioVPosition=new Common.UI.RadioBox({el:$("#image-radio-vposition"),name:"asc-radio-vertical"}),this.radioVPosition.on("change",_.bind(this.onRadioVPositionChange,this)),this.radioVPositionPc=new Common.UI.RadioBox({el:$("#image-radio-vpositionpc"),name:"asc-radio-vertical"}),this.radioVPositionPc.on("change",_.bind(this.onRadioVPositionPcChange,this)),this.chMove=new Common.UI.CheckBox({el:$("#image-checkbox-move"),labelText:this.textMove}),this.chMove.on("change",_.bind(function(t,e,i,n){if(this._changedProps){var o=this._arrVRelative["checked"==t.getValue()?3:4].value;if(this.cmbVRelative.isDisabled()){this.cmbVPosition.setValue(o);var s=this.cmbVPosition.getSelectedRecord();s&&this.onVPositionSelect(this.cmbVPosition,s)}else{this.cmbVRelative.setValue(o);var s=this.cmbVRelative.getSelectedRecord();s&&this.onVRelativeSelect(this.cmbVRelative,s)}}},this)),this.chOverlap=new Common.UI.CheckBox({el:$("#image-checkbox-overlap"),labelText:this.textOverlap}),this.chOverlap.on("change",_.bind(function(t,e,i,n){this._changedProps&&this._changedProps.put_AllowOverlap("checked"==t.getValue())},this)),this.spnMarginTop=new Common.UI.MetricSpinner({el:$("#image-margin-top"),step:.1,width:100,defaultUnit:"cm",value:"0 cm",maxValue:55.87,minValue:0}),this.spnMarginTop.on("change",_.bind(function(t,e,i,n){this._changedProps&&(void 0===this.Margins&&(this.Margins=new Asc.asc_CPaddings),this.Margins.put_Top(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},this)),this.spinners.push(this.spnMarginTop),this.spnMarginBottom=new Common.UI.MetricSpinner({el:$("#image-margin-bottom"),step:.1,width:100,defaultUnit:"cm",value:"0 cm",maxValue:55.87,minValue:0}),this.spnMarginBottom.on("change",_.bind(function(t,e,i,n){this._changedProps&&(void 0===this.Margins&&(this.Margins=new Asc.asc_CPaddings),this.Margins.put_Bottom(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},this)),this.spinners.push(this.spnMarginBottom),this.spnMarginLeft=new Common.UI.MetricSpinner({el:$("#image-margin-left"),step:.1,width:100,defaultUnit:"cm",value:"0.19 cm",maxValue:9.34,minValue:0}),this.spnMarginLeft.on("change",_.bind(function(t,e,i,n){this._changedProps&&(void 0===this.Margins&&(this.Margins=new Asc.asc_CPaddings),this.Margins.put_Left(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},this)),this.spinners.push(this.spnMarginLeft),this.spnMarginRight=new Common.UI.MetricSpinner({el:$("#image-margin-right"),step:.1,width:100,defaultUnit:"cm",value:"0.19 cm",maxValue:9.34,minValue:0}),this.spnMarginRight.on("change",_.bind(function(t,e,i,n){this._changedProps&&(void 0===this.Margins&&(this.Margins=new Asc.asc_CPaddings),this.Margins.put_Right(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},this)),this.spinners.push(this.spnMarginRight),this.chAutofit=new Common.UI.CheckBox({el:$("#shape-checkbox-autofit"),labelText:this.textResizeFit}),this.chAutofit.on("change",_.bind(function(t,e,i,n){this._changedShapeProps&&this._changedShapeProps.asc_putTextFitType("checked"==t.getValue()?AscFormat.text_fit_Auto:AscFormat.text_fit_No)},this)),this._arrCapType=[{displayValue:this.textFlat,value:Asc.c_oAscLineCapType.Flat},{displayValue:this.textRound,value:Asc.c_oAscLineCapType.Round},{displayValue:this.textSquare,value:Asc.c_oAscLineCapType.Square}],this.cmbCapType=new Common.UI.ComboBox({el:$("#shape-advanced-cap-type"),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:this._arrCapType,takeFocusOnClose:!0}),this.cmbCapType.setValue(Asc.c_oAscLineCapType.Flat),this.cmbCapType.on("selected",_.bind(function(t,e){this._changedShapeProps&&(null===this._changedShapeProps.get_stroke()&&this._changedShapeProps.put_stroke(new Asc.asc_CStroke),this._changedShapeProps.get_stroke().put_linecap(e.value))},this)),this._arrJoinType=[{displayValue:this.textRound,value:Asc.c_oAscLineJoinType.Round},{displayValue:this.textBevel,value:Asc.c_oAscLineJoinType.Bevel},{displayValue:this.textMiter,value:Asc.c_oAscLineJoinType.Miter}],this.cmbJoinType=new Common.UI.ComboBox({el:$("#shape-advanced-join-type"),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:this._arrJoinType,takeFocusOnClose:!0}),this.cmbJoinType.setValue(Asc.c_oAscLineJoinType.Round),this.cmbJoinType.on("selected",_.bind(function(t,e){this._changedShapeProps&&(null===this._changedShapeProps.get_stroke()&&this._changedShapeProps.put_stroke(new Asc.asc_CStroke),this._changedShapeProps.get_stroke().put_linejoin(e.value))},this));for(var e=[],i=[],n=0;n<6;n++)e.push({value:n,offsetx:80*n+10,offsety:0});for(e[0].type=Asc.c_oAscLineBeginType.None,e[1].type=Asc.c_oAscLineBeginType.Triangle,e[2].type=Asc.c_oAscLineBeginType.Arrow,e[3].type=Asc.c_oAscLineBeginType.Stealth,e[4].type=Asc.c_oAscLineBeginType.Diamond,e[5].type=Asc.c_oAscLineBeginType.Oval,n=0;n<9;n++)i.push({value:n,offsetx:90,offsety:20*(n+1)});for(i[0].type=Asc.c_oAscLineBeginSize.small_small,i[1].type=Asc.c_oAscLineBeginSize.small_mid,i[2].type=Asc.c_oAscLineBeginSize.small_large,i[3].type=Asc.c_oAscLineBeginSize.mid_small,i[4].type=Asc.c_oAscLineBeginSize.mid_mid,i[5].type=Asc.c_oAscLineBeginSize.mid_large,i[6].type=Asc.c_oAscLineBeginSize.large_small,i[7].type=Asc.c_oAscLineBeginSize.large_mid,i[8].type=Asc.c_oAscLineBeginSize.large_large,this.btnBeginStyle=new Common.UI.ComboBox({el:$("#shape-advanced-begin-style"),template:_.template(['<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle combo-arrow-style"  data-toggle="dropdown">','<div class="img-arrows form-control image" style="width: 100px;"></div>','<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default">','<span class="caret"></span>',"</button>","</div>"].join(""))}),this.btnBeginStyleMenu=new Common.UI.Menu({style:"min-width: 105px;",additionalAlign:this.menuAddAlign,items:[{template:_.template('<div id="shape-advanced-menu-begin-style" style="width: 105px; margin: 0 5px;"></div>')}]}).render($("#shape-advanced-begin-style")),this.mnuBeginStylePicker=new Common.UI.DataView({el:$("#shape-advanced-menu-begin-style"),parentMenu:this.btnBeginStyleMenu,store:new Common.UI.DataViewStore(e),itemTemplate:_.template('<div id="<%= id %>" class="item-arrow img-arrows" style="background-position: -<%= offsetx %>px -<%= offsety %>px;"></div>')}),this.mnuBeginStylePicker.on("item:click",_.bind(this.onSelectBeginStyle,this)),this._selectStyleItem(this.btnBeginStyle,null),this.btnBeginSize=new Common.UI.ComboBox({el:$("#shape-advanced-begin-size"),template:_.template(['<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle combo-arrow-style"  data-toggle="dropdown">','<div class="img-arrows form-control image" style="width: 100px;"></div>','<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default">','<span class="caret"></span>',"</button>","</div>"].join(""))}),this.btnBeginSizeMenu=new Common.UI.Menu({style:"min-width: 160px;",additionalAlign:this.menuAddAlign,items:[{template:_.template('<div id="shape-advanced-menu-begin-size" style="width: 160px; margin: 0 5px;"></div>')}]}).render($("#shape-advanced-begin-size")),this.mnuBeginSizePicker=new Common.UI.DataView({el:$("#shape-advanced-menu-begin-size"),parentMenu:this.btnBeginSizeMenu,store:new Common.UI.DataViewStore(i),itemTemplate:_.template('<div id="<%= id %>" class="item-arrow img-arrows" style="background-position: -<%= offsetx %>px -<%= offsety %>px;"></div>')}),this.mnuBeginSizePicker.on("item:click",_.bind(this.onSelectBeginSize,this)),this._selectStyleItem(this.btnBeginSize,null),n=0;n<e.length;n++)e[n].offsety+=200;for(n=0;n<i.length;n++)i[n].offsety+=200;this.btnEndStyle=new Common.UI.ComboBox({el:$("#shape-advanced-end-style"),template:_.template(['<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle combo-arrow-style"  data-toggle="dropdown">','<div class="img-arrows form-control image" style="width: 100px;"></div>','<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default">','<span class="caret"></span>',"</button>","</div>"].join(""))}),this.btnEndStyleMenu=new Common.UI.Menu({style:"min-width: 105px;",additionalAlign:this.menuAddAlign,items:[{template:_.template('<div id="shape-advanced-menu-end-style" style="width: 105px; margin: 0 5px;"></div>')}]}).render($("#shape-advanced-end-style")),this.mnuEndStylePicker=new Common.UI.DataView({el:$("#shape-advanced-menu-end-style"),parentMenu:this.btnEndStyleMenu,store:new Common.UI.DataViewStore(e),itemTemplate:_.template('<div id="<%= id %>" class="item-arrow img-arrows" style="background-position: -<%= offsetx %>px -<%= offsety %>px;"></div>')}),this.mnuEndStylePicker.on("item:click",_.bind(this.onSelectEndStyle,this)),this._selectStyleItem(this.btnEndStyle,null),this.btnEndSize=new Common.UI.ComboBox({el:$("#shape-advanced-end-size"),template:_.template(['<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle combo-arrow-style"  data-toggle="dropdown">','<div class="img-arrows form-control image" style="width: 100px;"></div>','<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default">','<span class="caret"></span>',"</button>","</div>"].join(""))}),this.btnEndSizeMenu=new Common.UI.Menu({style:"min-width: 160px;",additionalAlign:this.menuAddAlign,items:[{template:_.template('<div id="shape-advanced-menu-end-size" style="width: 160px; margin: 0 5px;"></div>')}]}).render($("#shape-advanced-end-size")),this.mnuEndSizePicker=new Common.UI.DataView({el:$("#shape-advanced-menu-end-size"),parentMenu:this.btnEndSizeMenu,store:new Common.UI.DataViewStore(i),itemTemplate:_.template('<div id="<%= id %>" class="item-arrow img-arrows" style="background-position: -<%= offsetx %>px -<%= offsety %>px;"></div>')}),this.mnuEndSizePicker.on("item:click",_.bind(this.onSelectEndSize,this)),this._selectStyleItem(this.btnEndSize,null),this.inputAltTitle=new Common.UI.InputField({el:$("#image-advanced-alt-title"),allowBlank:!0,validateOnBlur:!1,style:"width: 100%;"}).on("changed:after",function(){t.isAltTitleChanged=!0}),this.textareaAltDescription=this.$window.find("textarea"),this.textareaAltDescription.keydown(function(e){e.keyCode==Common.UI.Keys.RETURN&&e.stopPropagation(),t.isAltDescChanged=!0}),this.afterRender()},getFocusedComponents:function(){return[this.spnWidth,this.spnHeight,this.btnOriginalSize,this.radioHSize,this.spnShapeWidth,this.spnShapeWidthPc,this.radioHSizePc,this.cmbWidthPc,this.radioVSize,this.spnShapeHeight,this.spnShapeHeightPc,this.radioVSizePc,this.cmbHeightPc,this.chRatio,this.spnAngle,this.chFlipHor,this.chFlipVert,this.spnTop,this.spnLeft,this.spnBottom,this.spnRight,this.radioHAlign,this.radioHPosition,this.radioHPositionPc,this.cmbHAlign,this.cmbHRelative,this.spnX,this.cmbHPosition,this.spnXPc,this.cmbHPositionPc,this.radioVAlign,this.radioVPosition,this.radioVPositionPc,this.cmbVAlign,this.cmbVRelative,this.spnY,this.cmbVPosition,this.spnYPc,this.cmbVPositionPc,this.chMove,this.chOverlap,this.cmbCapType,this.cmbJoinType,this.chAutofit,this.spnMarginTop,this.spnMarginLeft,this.spnMarginBottom,this.spnMarginRight,this.inputAltTitle,this.textareaAltDescription]},onCategoryClick:function(t,e){Common.Views.AdvancedSettingsWindow.prototype.onCategoryClick.call(this,t,e);var i=this;setTimeout(function(){switch(e){case 0:i.spnWidth.focus();break;case 1:i.spnShapeWidth.isDisabled()?i.spnShapeWidthPc.focus():i.spnShapeWidth.focus();break;case 2:i.spnAngle.focus();break;case 3:i.spnTop.focus();break;case 4:i.cmbHAlign.isDisabled()?i.spnX.isDisabled()?i.spnXPc.focus():i.spnX.focus():i.cmbHAlign.focus();break;case 5:i.cmbCapType.focus();break;case 6:i.chAutofit.focus();break;case 7:i.inputAltTitle.focus()}},10)},afterRender:function(){if(this.updateMetricUnit(),this._setDefaults(this._originalProps),this.btnsCategory[this._objectType==Asc.c_oAscTypeSelectElement.Shape?0:1].setVisible(!1),this.storageName){var t=Common.localStorage.getItem(this.storageName);this.setActiveCategory(null!==t?parseInt(t):0)}},_setDefaults:function(t){if(t){this._objectType=Asc.c_oAscTypeSelectElement.Image;var e=t.get_WrappingStyle();if(t.get_CanBeFlow()){switch(e){case Asc.c_oAscWrapStyle2.Inline:this.btnWrapInline.toggle(!0);break;case Asc.c_oAscWrapStyle2.Square:this.btnWrapSquare.toggle(!0);break;case Asc.c_oAscWrapStyle2.Tight:this.btnWrapTight.toggle(!0);break;case Asc.c_oAscWrapStyle2.Through:this.btnWrapThrough.toggle(!0);break;case Asc.c_oAscWrapStyle2.TopAndBottom:this.btnWrapTopBottom.toggle(!0);break;case Asc.c_oAscWrapStyle2.Behind:this.btnWrapBehind.toggle(!0);break;case Asc.c_oAscWrapStyle2.InFront:this.btnWrapInFront.toggle(!0);break;default:this.btnWrapInline.toggle(!1),this.btnWrapSquare.toggle(!1),this.btnWrapTight.toggle(!1),this.btnWrapThrough.toggle(!1),this.btnWrapTopBottom.toggle(!1),this.btnWrapBehind.toggle(!1),this.btnWrapInFront.toggle(!1)}this._DisableElem(e)}else this.btnWrapInline.toggle(!0),this.btnWrapSquare.setDisabled(!0),this.btnWrapTight.setDisabled(!0),this.btnWrapThrough.setDisabled(!0),this.btnWrapTopBottom.setDisabled(!0),this.btnWrapBehind.setDisabled(!0),this.btnWrapInFront.setDisabled(!0),this._DisableElem(Asc.c_oAscWrapStyle2.Inline);if(t.get_Paddings()){var i={Top:t.get_Paddings().get_Top(),Right:t.get_Paddings().get_Right(),Bottom:t.get_Paddings().get_Bottom(),Left:t.get_Paddings().get_Left()};null!==i.Top&&void 0!==i.Top&&this.spnTop.setValue(Common.Utils.Metric.fnRecalcFromMM(i.Top),!0),null!==i.Left&&void 0!==i.Left&&this.spnLeft.setValue(Common.Utils.Metric.fnRecalcFromMM(i.Left),!0),null!==i.Bottom&&void 0!==i.Bottom&&this.spnBottom.setValue(Common.Utils.Metric.fnRecalcFromMM(i.Bottom),!0),null!==i.Right&&void 0!==i.Right&&this.spnRight.setValue(Common.Utils.Metric.fnRecalcFromMM(i.Right),!0)}var n=t.get_PositionH();if(n)if(n.get_UseAlign()){e=n.get_Align();for(var o=0;o<this._arrHAlign.length;o++)if(e==this._arrHAlign[o].value){this.cmbHAlign.setValue(e),this._state.HAlignType=e;break}e=n.get_RelativeFrom();for(var o=0;o<this._arrHRelative.length;o++)if(e==this._arrHRelative[o].value){this.cmbHRelative.setValue(e),this._state.HAlignFrom=e;break}}else if(n.get_Percent()){for(this.radioHPositionPc.setValue(!0),this.spnXPc.setValue(n.get_Value()),e=n.get_RelativeFrom(),o=0;o<this._arrHRelativePc.length;o++)if(e==this._arrHRelativePc[o].value){this.cmbHPositionPc.setValue(e),this._state.HPositionPcFrom=e;break}}else for(this.radioHPosition.setValue(!0),e=n.get_Value(),this.spnX.setValue(Common.Utils.Metric.fnRecalcFromMM(e)),e=n.get_RelativeFrom(),o=0;o<this._arrHRelative.length;o++)if(e==this._arrHRelative[o].value){this.cmbHPosition.setValue(e),this._state.HPositionFrom=e;break}if(n=t.get_PositionV()){if(n.get_UseAlign()){for(e=n.get_Align(),o=0;o<this._arrVAlign.length;o++)if(e==this._arrVAlign[o].value){this.cmbVAlign.setValue(e),this._state.VAlignType=e;break}for(e=n.get_RelativeFrom(),o=0;o<this._arrVRelative.length;o++)if(e==this._arrVRelative[o].value){this.cmbVRelative.setValue(e),this._state.VAlignFrom=e;break}}else if(n.get_Percent()){for(this.radioVPositionPc.setValue(!0),this.spnYPc.setValue(n.get_Value()),e=n.get_RelativeFrom(),o=0;o<this._arrVRelativePc.length;o++)if(e==this._arrVRelativePc[o].value){this.cmbVPositionPc.setValue(e),this._state.VPositionPcFrom=e;break}}else for(this.radioVPosition.setValue(!0),e=n.get_Value(),this.spnY.setValue(Common.Utils.Metric.fnRecalcFromMM(e)),e=n.get_RelativeFrom(),o=0;o<this._arrVRelative.length;o++)if(e==this._arrVRelative[o].value){this.cmbVPosition.setValue(e),this._state.VPositionFrom=e;break}this.chMove.setValue(e==Asc.c_oAscRelativeFromV.Line||e==Asc.c_oAscRelativeFromV.Paragraph,!0),this.chMove.setDisabled(!n.get_UseAlign()&&n.get_Percent())}this.chOverlap.setValue(null!==t.get_AllowOverlap()&&void 0!==t.get_AllowOverlap()?t.get_AllowOverlap():"indeterminate",!0),t.get_Height()>0&&(this._nRatio=t.get_Width()/t.get_Height());var s=t.get_ShapeProperties(),a=t.get_ChartProperties(),r=t.asc_getPluginGuid();this.btnOriginalSize.setVisible(!(s||a)),this.btnOriginalSize.setDisabled(null===t.get_ImageUrl()||void 0===t.get_ImageUrl()),this.btnsCategory[5].setVisible(null!==s&&!s.get_FromChart()),this.btnsCategory[6].setVisible(null!==s&&!s.get_FromChart()),this.btnsCategory[2].setVisible(!a&&(null===r||void 0===r));var l=this.api&&this.api.asc_IsContentControl()?this.api.asc_GetContentControlProperties():null;if(this.btnsCategory[3].setDisabled(t.get_FromGroup()||!!l&&l.get_SpecificType()==Asc.c_oAscContentControlSpecificType.Picture),s){this._objectType=Asc.c_oAscTypeSelectElement.Shape,this._setShapeDefaults(s),this.setTitle(this.textTitleShape),e=t.asc_getLockAspect(),this.chRatio.setValue(e),this.spnShapeWidth.setMaxValue(this.sizeMax.width),this.spnShapeHeight.setMaxValue(this.sizeMax.height);var c=t.get_SizeRelH();if(c){for(this.radioHSizePc.setValue(!0),this.spnShapeWidthPc.setValue(c.get_Value()),e=c.get_RelativeFrom(),o=0;o<this._arrHRelativePc.length;o++)if(e==this._arrHRelativePc[o].value){this.cmbWidthPc.setValue(e),this.spnShapeWidth.setValue(Common.Utils.Metric.fnRecalcFromMM(this._arrHRelativePc[o].size*c.get_Value()/100).toFixed(2),!0),this._state.ShapeWidthPcFrom=e;break}}else this.radioHSize.setValue(!0),e=t.get_Width(),this.spnShapeWidth.setValue(void 0!==e?Common.Utils.Metric.fnRecalcFromMM(e).toFixed(2):"",!0);var d=t.get_SizeRelV();if(d){for(this.radioVSizePc.setValue(!0),this.spnShapeHeightPc.setValue(d.get_Value()),e=d.get_RelativeFrom(),o=0;o<this._arrVRelativePc.length;o++)if(e==this._arrVRelativePc[o].value){this.cmbHeightPc.setValue(e),this.spnShapeHeight.setValue(Common.Utils.Metric.fnRecalcFromMM(this._arrVRelativePc[o].size*d.get_Value()/100).toFixed(2),!0),this._state.ShapeHeightPcFrom=e;break}}else this.radioVSize.setValue(!0),e=t.get_Height(),this.spnShapeHeight.setValue(void 0!==e?Common.Utils.Metric.fnRecalcFromMM(e).toFixed(2):"",!0);this.chRatio.setDisabled(this.radioVSizePc.getValue()||this.radioHSizePc.getValue());var h=s.get_paddings();if(h){var p=h.get_Left();this.spnMarginLeft.setValue(null!==p&&void 0!==p?Common.Utils.Metric.fnRecalcFromMM(p):"",!0),p=h.get_Top(),this.spnMarginTop.setValue(null!==p&&void 0!==p?Common.Utils.Metric.fnRecalcFromMM(p):"",!0),p=h.get_Right(),this.spnMarginRight.setValue(null!==p&&void 0!==p?Common.Utils.Metric.fnRecalcFromMM(p):"",!0),p=h.get_Bottom(),this.spnMarginBottom.setValue(null!==p&&void 0!==p?Common.Utils.Metric.fnRecalcFromMM(p):"",!0)}this.chAutofit.setValue(s.asc_getTextFitType()==AscFormat.text_fit_Auto),this.btnsCategory[6].setDisabled(null===h),this.btnsCategory[5].setDisabled(s.get_stroke().get_type()==Asc.c_oAscStrokeType.STROKE_NONE)}else e=t.asc_getLockAspect(),a?(this._objectType=Asc.c_oAscTypeSelectElement.Chart,this.setTitle(this.textTitleChart)):this.setTitle(this.textTitle),this.btnRatio.toggle(e),this.spnWidth.setMaxValue(this.sizeMax.width),this.spnHeight.setMaxValue(this.sizeMax.height),e=t.get_Width(),this.spnWidth.setValue(void 0!==e?Common.Utils.Metric.fnRecalcFromMM(e).toFixed(2):"",!0),e=t.get_Height(),this.spnHeight.setValue(void 0!==e?Common.Utils.Metric.fnRecalcFromMM(e).toFixed(2):"",!0);a||(e=t.asc_getRot(),this.spnAngle.setValue(void 0==e||null===e?"":Math.floor(180*e/3.14159265358979+.5),!0),this.chFlipHor.setValue(t.asc_getFlipH()),this.chFlipVert.setValue(t.asc_getFlipV())),e=t.asc_getTitle(),this.inputAltTitle.setValue(e||""),e=t.asc_getDescription(),this.textareaAltDescription.val(e||""),this._changedProps=new Asc.asc_CImgProperty}},getSettings:function(){var t=this._changedProps;if(this._objectType==Asc.c_oAscTypeSelectElement.Shape&&(t.put_ShapeProperties(this._changedShapeProps),this.Margins&&(null!==t.get_ShapeProperties()&&void 0!==t.get_ShapeProperties()||t.put_ShapeProperties(new Asc.asc_CShapeProperty),t.get_ShapeProperties().put_paddings(this.Margins))),this._originalProps.get_WrappingStyle()===Asc.c_oAscWrapStyle2.Inline&&void 0!==t.get_WrappingStyle()&&t.get_WrappingStyle()!==Asc.c_oAscWrapStyle2.Inline){if(null===t.get_PositionH()||void 0===t.get_PositionH()){t.put_PositionH(new Asc.CImagePositionH),t.get_PositionH().put_UseAlign(!1),t.get_PositionH().put_Percent(!1),t.get_PositionH().put_RelativeFrom(Asc.c_oAscRelativeFromH.Column);var e=this._originalProps.get_Value_X(Asc.c_oAscRelativeFromH.Column);t.get_PositionH().put_Value(e)}null!==t.get_PositionV()&&void 0!==t.get_PositionV()||(t.put_PositionV(new Asc.CImagePositionV),t.get_PositionV().put_UseAlign(!1),t.get_PositionV().put_Percent(!1),t.get_PositionV().put_RelativeFrom(Asc.c_oAscRelativeFromV.Paragraph),e=this._originalProps.get_Value_Y(Asc.c_oAscRelativeFromV.Paragraph),t.get_PositionV().put_Value(e))}return this._objectType!=Asc.c_oAscTypeSelectElement.Chart&&(t.asc_putRot(3.14159265358979*this.spnAngle.getNumberValue()/180),t.asc_putFlipH("checked"==this.chFlipHor.getValue()),t.asc_putFlipV("checked"==this.chFlipVert.getValue())),this.isAltTitleChanged&&t.asc_putTitle(this.inputAltTitle.getValue()),this.isAltDescChanged&&t.asc_putDescription(this.textareaAltDescription.val()),{imageProps:t}},_setShapeDefaults:function(t){if(t){var e=t.get_stroke();if(e){for(var i=e.get_linejoin(),n=0;n<this._arrJoinType.length;n++)if(i==this._arrJoinType[n].value){this.cmbJoinType.setValue(i);break}for(i=e.get_linecap(),n=0;n<this._arrCapType.length;n++)if(i==this._arrCapType[n].value){this.cmbCapType.setValue(i);break}var o=e.get_canChangeArrows();if(this.btnBeginStyle.setDisabled(!o),this.btnEndStyle.setDisabled(!o),this.btnBeginSize.setDisabled(!o),this.btnEndSize.setDisabled(!o),o){i=e.get_linebeginsize();var s=this.mnuBeginSizePicker.store.findWhere({type:i});s?this._beginSizeIdx=s.get("value"):(this._beginSizeIdx=null,this._selectStyleItem(this.btnBeginSize,null)),i=e.get_linebeginstyle(),s=this.mnuBeginStylePicker.store.findWhere({type:i}),s?(this.mnuBeginStylePicker.selectRecord(s,!0),this._updateSizeArr(this.btnBeginSize,this.mnuBeginSizePicker,s,this._beginSizeIdx),this._selectStyleItem(this.btnBeginStyle,s)):this._selectStyleItem(this.btnBeginStyle,null),i=e.get_lineendsize(),s=this.mnuEndSizePicker.store.findWhere({type:i}),s?this._endSizeIdx=s.get("value"):(this._endSizeIdx=null,this._selectStyleItem(this.btnEndSize,null)),i=e.get_lineendstyle(),s=this.mnuEndStylePicker.store.findWhere({type:i}),s?(this.mnuEndStylePicker.selectRecord(s,!0),this._updateSizeArr(this.btnEndSize,this.mnuEndSizePicker,s,this._endSizeIdx),this._selectStyleItem(this.btnEndStyle,s)):this._selectStyleItem(this.btnEndStyle,null)}else this._selectStyleItem(this.btnBeginStyle),this._selectStyleItem(this.btnEndStyle),this._selectStyleItem(this.btnBeginSize),this._selectStyleItem(this.btnEndSize)}}this._changedShapeProps=new Asc.asc_CShapeProperty},updateMetricUnit:function(){if(this.spinners)for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.01)}this.sizeMax={width:Common.Utils.Metric.fnRecalcFromMM(10*this.options.sizeMax.width),height:Common.Utils.Metric.fnRecalcFromMM(10*this.options.sizeMax.height)},this.options.sizeOriginal&&(this.sizeOriginal={width:Common.Utils.Metric.fnRecalcFromMM(this.options.sizeOriginal.width),height:Common.Utils.Metric.fnRecalcFromMM(this.options.sizeOriginal.height)})},onBtnWrapClick:function(t,e){this._DisableElem(t.options.posId),this._changedProps&&this._changedProps.put_WrappingStyle(t.options.posId)},_DisableElem:function(t){
var e=t==Asc.c_oAscWrapStyle2.Inline||t==Asc.c_oAscWrapStyle2.Behind||t==Asc.c_oAscWrapStyle2.InFront||t==Asc.c_oAscWrapStyle2.TopAndBottom,i=t==Asc.c_oAscWrapStyle2.Inline||t==Asc.c_oAscWrapStyle2.Behind||t==Asc.c_oAscWrapStyle2.InFront||t==Asc.c_oAscWrapStyle2.Tight||t==Asc.c_oAscWrapStyle2.Through;this.spnLeft.setDisabled(e),this.spnRight.setDisabled(e),this.spnTop.setDisabled(i),this.spnBottom.setDisabled(i),this.btnsCategory[4].setDisabled(t==Asc.c_oAscWrapStyle2.Inline)},onHAlignSelect:function(t,e){this._changedProps&&(null!==this._changedProps.get_PositionH()&&void 0!==this._changedProps.get_PositionH()||this._changedProps.put_PositionH(new Asc.CImagePositionH),this._state.HAlignType=e.value,this._changedProps.get_PositionH().put_UseAlign(!0),this._changedProps.get_PositionH().put_Percent(!1),this._changedProps.get_PositionH().put_RelativeFrom(this._state.HAlignFrom),this._changedProps.get_PositionH().put_Align(this._state.HAlignType))},onHRelativeSelect:function(t,e){this._changedProps&&(null!==this._changedProps.get_PositionH()&&void 0!==this._changedProps.get_PositionH()||this._changedProps.put_PositionH(new Asc.CImagePositionH),this._state.HAlignFrom=e.value,this._changedProps.get_PositionH().put_UseAlign(!0),this._changedProps.get_PositionH().put_Percent(!1),this._changedProps.get_PositionH().put_RelativeFrom(this._state.HAlignFrom),this._changedProps.get_PositionH().put_Align(this._state.HAlignType))},onHPositionSelect:function(t,e){if(this._changedProps){if(null!==this._changedProps.get_PositionH()&&void 0!==this._changedProps.get_PositionH()||this._changedProps.put_PositionH(new Asc.CImagePositionH),this._state.HPositionFrom=e.value,this._changedProps.get_PositionH().put_UseAlign(!1),this._changedProps.get_PositionH().put_Percent(!1),this._changedProps.get_PositionH().put_RelativeFrom(this._state.HPositionFrom),!this._state.spnXChanged){var i=this._originalProps.get_Value_X(this._state.HPositionFrom);this.spnX.setValue(Common.Utils.Metric.fnRecalcFromMM(i),!0)}this._changedProps.get_PositionH().put_Value(Common.Utils.Metric.fnRecalcToMM(this.spnX.getNumberValue()))}},onHPositionPcSelect:function(t,e){if(this._changedProps){if(null!==this._changedProps.get_PositionH()&&void 0!==this._changedProps.get_PositionH()||this._changedProps.put_PositionH(new Asc.CImagePositionH),this._state.HPositionPcFrom=e.value,this._changedProps.get_PositionH().put_UseAlign(!1),this._changedProps.get_PositionH().put_Percent(!0),this._changedProps.get_PositionH().put_RelativeFrom(this._state.HPositionPcFrom),!this._state.spnXPcChanged){var i=this._originalProps.get_Value_X(this._state.HPositionPcFrom);this.spnXPc.setValue(parseFloat((100*i/this.pageWidth).toFixed(2)),!0)}this._changedProps.get_PositionH().put_Value(this.spnXPc.getNumberValue())}},onVAlignSelect:function(t,e){this._changedProps&&(null!==this._changedProps.get_PositionV()&&void 0!==this._changedProps.get_PositionV()||this._changedProps.put_PositionV(new Asc.CImagePositionV),this._state.VAlignType=e.value,this._changedProps.get_PositionV().put_UseAlign(!0),this._changedProps.get_PositionV().put_Percent(!1),this._changedProps.get_PositionV().put_RelativeFrom(this._state.VAlignFrom),this._changedProps.get_PositionV().put_Align(this._state.VAlignType))},onVRelativeSelect:function(t,e){this._changedProps&&(null!==this._changedProps.get_PositionV()&&void 0!==this._changedProps.get_PositionV()||this._changedProps.put_PositionV(new Asc.CImagePositionV),this._state.VAlignFrom=e.value,this._changedProps.get_PositionV().put_UseAlign(!0),this._changedProps.get_PositionV().put_Percent(!1),this._changedProps.get_PositionV().put_RelativeFrom(this._state.VAlignFrom),this._changedProps.get_PositionV().put_Align(this._state.VAlignType),this.chMove.setValue(this._state.VAlignFrom==Asc.c_oAscRelativeFromV.Line||this._state.VAlignFrom==Asc.c_oAscRelativeFromV.Paragraph,!0))},onVPositionSelect:function(t,e){if(this._changedProps){if(null!==this._changedProps.get_PositionV()&&void 0!==this._changedProps.get_PositionV()||this._changedProps.put_PositionV(new Asc.CImagePositionV),this._state.VPositionFrom=e.value,this._changedProps.get_PositionV().put_UseAlign(!1),this._changedProps.get_PositionV().put_Percent(!1),this._changedProps.get_PositionV().put_RelativeFrom(this._state.VPositionFrom),!this._state.spnYChanged){var i=this._originalProps.get_Value_Y(this._state.VPositionFrom);this.spnY.setValue(Common.Utils.Metric.fnRecalcFromMM(i),!0)}this._changedProps.get_PositionV().put_Value(Common.Utils.Metric.fnRecalcToMM(this.spnY.getNumberValue())),this.chMove.setValue(this._state.VPositionFrom==Asc.c_oAscRelativeFromV.Line||this._state.VPositionFrom==Asc.c_oAscRelativeFromV.Paragraph,!0)}},onVPositionPcSelect:function(t,e){if(this._changedProps){if(null!==this._changedProps.get_PositionV()&&void 0!==this._changedProps.get_PositionV()||this._changedProps.put_PositionV(new Asc.CImagePositionV),this._state.VPositionPcFrom=e.value,this._changedProps.get_PositionV().put_UseAlign(!1),this._changedProps.get_PositionV().put_Percent(!0),this._changedProps.get_PositionV().put_RelativeFrom(this._state.VPositionPcFrom),!this._state.spnYPcChanged){var i=this._originalProps.get_Value_Y(this._state.VPositionPcFrom);this.spnYPc.setValue(parseFloat((100*i/this.pageHeight).toFixed(2)),!0)}this._changedProps.get_PositionV().put_Value(this.spnYPc.getNumberValue())}},onRadioHAlignChange:function(t,e,i){this._changedProps&&(null!==this._changedProps.get_PositionH()&&void 0!==this._changedProps.get_PositionH()||this._changedProps.put_PositionH(new Asc.CImagePositionH),this._changedProps.get_PositionH().put_UseAlign(e),e&&(this._changedProps.get_PositionH().put_Percent(!1),this._changedProps.get_PositionH().put_Align(this._state.HAlignType),this._changedProps.get_PositionH().put_RelativeFrom(this._state.HAlignFrom))),e&&(this.cmbHAlign.setDisabled(!1),this.cmbHAlign.focus(),this.cmbHRelative.setDisabled(!1),this.spnX.setDisabled(!0),this.cmbHPosition.setDisabled(!0),this.spnXPc.setDisabled(!0),this.cmbHPositionPc.setDisabled(!0))},onRadioHPositionChange:function(t,e,i){this._changedProps&&(null!==this._changedProps.get_PositionH()&&void 0!==this._changedProps.get_PositionH()||this._changedProps.put_PositionH(new Asc.CImagePositionH),e&&(this._changedProps.get_PositionH().put_UseAlign(!1),this._changedProps.get_PositionH().put_Percent(!1),this._changedProps.get_PositionH().put_Value(Common.Utils.Metric.fnRecalcToMM(this.spnX.getNumberValue())),this._changedProps.get_PositionH().put_RelativeFrom(this._state.HPositionFrom))),e&&(this.cmbHAlign.setDisabled(!0),this.cmbHRelative.setDisabled(!0),this.spnX.setDisabled(!1),this.spnX.focus(),this.cmbHPosition.setDisabled(!1),this.spnXPc.setDisabled(!0),this.cmbHPositionPc.setDisabled(!0))},onRadioHPositionPcChange:function(t,e,i){this._changedProps&&(null!==this._changedProps.get_PositionH()&&void 0!==this._changedProps.get_PositionH()||this._changedProps.put_PositionH(new Asc.CImagePositionH),this._changedProps.get_PositionH().put_Percent(e),e&&(this._changedProps.get_PositionH().put_UseAlign(!1),this._changedProps.get_PositionH().put_Value(this.spnXPc.getNumberValue()),this._changedProps.get_PositionH().put_RelativeFrom(this._state.HPositionPcFrom))),e&&(this.cmbHAlign.setDisabled(!0),this.cmbHRelative.setDisabled(!0),this.spnX.setDisabled(!0),this.cmbHPosition.setDisabled(!0),this.spnXPc.setDisabled(!1),this.spnXPc.focus(),this.cmbHPositionPc.setDisabled(!1))},onRadioVAlignChange:function(t,e,i){this._changedProps&&(null!==this._changedProps.get_PositionV()&&void 0!==this._changedProps.get_PositionV()||this._changedProps.put_PositionV(new Asc.CImagePositionV),this._changedProps.get_PositionV().put_UseAlign(e),e&&(this._changedProps.get_PositionV().put_Percent(!1),this._changedProps.get_PositionV().put_Align(this._state.VAlignType),this._changedProps.get_PositionV().put_RelativeFrom(this._state.VAlignFrom))),e&&(this.cmbVAlign.setDisabled(!1),this.cmbVAlign.focus(),this.cmbVRelative.setDisabled(!1),this.spnY.setDisabled(!0),this.cmbVPosition.setDisabled(!0),this.chMove.setValue(this._state.VAlignFrom==Asc.c_oAscRelativeFromV.Line||this._state.VAlignFrom==Asc.c_oAscRelativeFromV.Paragraph,!0),this.chMove.setDisabled(!1),this.spnYPc.setDisabled(!0),this.cmbVPositionPc.setDisabled(!0))},onRadioVPositionChange:function(t,e,i){this._changedProps&&(null!==this._changedProps.get_PositionV()&&void 0!==this._changedProps.get_PositionV()||this._changedProps.put_PositionV(new Asc.CImagePositionV),e&&(this._changedProps.get_PositionV().put_UseAlign(!1),this._changedProps.get_PositionV().put_Percent(!1),this._changedProps.get_PositionV().put_Value(Common.Utils.Metric.fnRecalcToMM(this.spnY.getNumberValue())),this._changedProps.get_PositionV().put_RelativeFrom(this._state.VPositionFrom))),e&&(this.cmbVAlign.setDisabled(!0),this.cmbVRelative.setDisabled(!0),this.spnY.setDisabled(!1),this.spnY.focus(),this.cmbVPosition.setDisabled(!1),this.chMove.setValue(this._state.VPositionFrom==Asc.c_oAscRelativeFromV.Line||this._state.VPositionFrom==Asc.c_oAscRelativeFromV.Paragraph,!0),this.chMove.setDisabled(!1),this.spnYPc.setDisabled(!0),this.cmbVPositionPc.setDisabled(!0))},onRadioVPositionPcChange:function(t,e,i){this._changedProps&&(null!==this._changedProps.get_PositionV()&&void 0!==this._changedProps.get_PositionV()||this._changedProps.put_PositionV(new Asc.CImagePositionV),this._changedProps.get_PositionV().put_Percent(e),e&&(this._changedProps.get_PositionV().put_UseAlign(!1),this._changedProps.get_PositionV().put_Value(this.spnYPc.getNumberValue()),this._changedProps.get_PositionV().put_RelativeFrom(this._state.VPositionPcFrom))),e&&(this.cmbVAlign.setDisabled(!0),this.cmbVRelative.setDisabled(!0),this.spnY.setDisabled(!0),this.cmbVPosition.setDisabled(!0),this.chMove.setValue(!1,!0),this.chMove.setDisabled(!0),this.spnYPc.setDisabled(!1),this.spnYPc.focus(),this.cmbVPositionPc.setDisabled(!1))},onRadioHSizeChange:function(t,e,i){e&&(this._changedProps&&(this._changedProps.put_Width(Common.Utils.Metric.fnRecalcToMM(this.spnShapeWidth.getNumberValue())),this._changedProps.put_SizeRelH(void 0),this.fillShapeHeight()),this.chRatio.setDisabled(this.radioVSizePc.getValue()),this.cmbWidthPc.setDisabled(!0),this.spnShapeWidthPc.setDisabled(!0),this.spnShapeWidth.setDisabled(!1),this.spnShapeWidth.focus())},onRadioHSizePcChange:function(t,e,i){e&&(this._changedProps&&(null!==this._changedProps.get_SizeRelH()&&void 0!==this._changedProps.get_SizeRelH()||this._changedProps.put_SizeRelH(new Asc.CImagePositionH),this._changedProps.get_SizeRelH().put_Value(this.spnShapeWidthPc.getNumberValue()),this._changedProps.get_SizeRelH().put_RelativeFrom(this._state.ShapeWidthPcFrom),this.fillShapeHeight()),this.chRatio.setDisabled(!0),this.cmbWidthPc.setDisabled(!1),this.spnShapeWidthPc.setDisabled(!1),this.spnShapeWidthPc.focus(),this.spnShapeWidth.setDisabled(!0))},onRadioVSizeChange:function(t,e,i){e&&(this._changedProps&&(this._changedProps.put_Height(Common.Utils.Metric.fnRecalcToMM(this.spnShapeHeight.getNumberValue())),this._changedProps.put_SizeRelV(void 0),this.fillShapeWidth()),this.chRatio.setDisabled(this.radioHSizePc.getValue()),this.cmbHeightPc.setDisabled(!0),this.spnShapeHeightPc.setDisabled(!0),this.spnShapeHeight.setDisabled(!1),this.spnShapeHeight.focus())},onRadioVSizePcChange:function(t,e,i){e&&(this._changedProps&&(null!==this._changedProps.get_SizeRelV()&&void 0!==this._changedProps.get_SizeRelV()||this._changedProps.put_SizeRelV(new Asc.CImagePositionV),this._changedProps.get_SizeRelV().put_Value(this.spnShapeHeightPc.getNumberValue()),this._changedProps.get_SizeRelV().put_RelativeFrom(this._state.ShapeHeightPcFrom),this.fillShapeWidth()),this.chRatio.setDisabled(!0),this.cmbHeightPc.setDisabled(!1),this.spnShapeHeightPc.setDisabled(!1),this.spnShapeHeightPc.focus(),this.spnShapeHeight.setDisabled(!0))},onCmbWidthPcSelect:function(t,e){this._changedProps&&(null!==this._changedProps.get_SizeRelH()&&void 0!==this._changedProps.get_SizeRelH()||this._changedProps.put_SizeRelH(new Asc.CImagePositionH),this._state.ShapeWidthPcFrom=e.value,this._changedProps.get_SizeRelH().put_Value(this.spnShapeWidthPc.getNumberValue()),this._changedProps.get_SizeRelH().put_RelativeFrom(this._state.ShapeWidthPcFrom),this.fillShapeHeight())},onCmbHeightPcSelect:function(t,e){this._changedProps&&(null!==this._changedProps.get_SizeRelV()&&void 0!==this._changedProps.get_SizeRelV()||this._changedProps.put_SizeRelV(new Asc.CImagePositionV),this._state.ShapeHeightPcFrom=e.value,this._changedProps.get_SizeRelV().put_Value(this.spnShapeHeightPc.getNumberValue()),this._changedProps.get_SizeRelV().put_RelativeFrom(this._state.ShapeHeightPcFrom),this.fillShapeWidth())},fillShapeWidth:function(t,e){this.radioHSize.getValue()?this._changedProps.put_Width(Common.Utils.Metric.fnRecalcToMM(this.spnShapeWidth.getNumberValue())):(null!==this._changedProps.get_SizeRelH()&&void 0!==this._changedProps.get_SizeRelH()||this._changedProps.put_SizeRelH(new Asc.CImagePositionH),this._changedProps.get_SizeRelH().put_Value(this.spnShapeWidthPc.getNumberValue()),this._changedProps.get_SizeRelH().put_RelativeFrom(this._state.ShapeWidthPcFrom))},fillShapeHeight:function(t,e){this.radioVSize.getValue()?this._changedProps.put_Height(Common.Utils.Metric.fnRecalcToMM(this.spnShapeHeight.getNumberValue())):(null!==this._changedProps.get_SizeRelV()&&void 0!==this._changedProps.get_SizeRelV()||this._changedProps.put_SizeRelV(new Asc.CImagePositionV),this._changedProps.get_SizeRelV().put_Value(this.spnShapeHeightPc.getNumberValue()),this._changedProps.get_SizeRelV().put_RelativeFrom(this._state.ShapeHeightPcFrom))},_updateSizeArr:function(t,e,i,n){i.get("value")>0?(e.store.each(function(t){t.set({offsetx:80*i.get("value")+10})},this),t.setDisabled(!1),null!==n?(e.selectByIndex(n,!0),this._selectStyleItem(t,e.store.at(n))):this._selectStyleItem(t,null)):(this._selectStyleItem(t,null),t.setDisabled(!0))},_selectStyleItem:function(t,e){$(t.el).find(".form-control").css("background-position",(e?20-e.get("offsetx")+"px":"0")+" "+(e?"-"+e.get("offsety")+"px":"-30px"))},onSelectBeginStyle:function(t,e,i,n){this._changedShapeProps&&(null===this._changedShapeProps.get_stroke()&&this._changedShapeProps.put_stroke(new Asc.asc_CStroke),this._changedShapeProps.get_stroke().put_linebeginstyle(i.get("type"))),null!==this._beginSizeIdx&&void 0!==this._beginSizeIdx||(this._beginSizeIdx=4),this._updateSizeArr(this.btnBeginSize,this.mnuBeginSizePicker,i,this._beginSizeIdx),this._selectStyleItem(this.btnBeginStyle,i)},onSelectBeginSize:function(t,e,i,n){this._changedShapeProps&&(null===this._changedShapeProps.get_stroke()&&this._changedShapeProps.put_stroke(new Asc.asc_CStroke),this._changedShapeProps.get_stroke().put_linebeginsize(i.get("type"))),this._beginSizeIdx=i.get("value"),this._selectStyleItem(this.btnBeginSize,i)},onSelectEndStyle:function(t,e,i,n){this._changedShapeProps&&(null===this._changedShapeProps.get_stroke()&&this._changedShapeProps.put_stroke(new Asc.asc_CStroke),this._changedShapeProps.get_stroke().put_lineendstyle(i.get("type"))),null!==this._endSizeIdx&&void 0!==this._endSizeIdx||(this._endSizeIdx=4),this._updateSizeArr(this.btnEndSize,this.mnuEndSizePicker,i,this._endSizeIdx),this._selectStyleItem(this.btnEndStyle,i)},onSelectEndSize:function(t,e,i,n){this._changedShapeProps&&(null===this._changedShapeProps.get_stroke()&&this._changedShapeProps.put_stroke(new Asc.asc_CStroke),this._changedShapeProps.get_stroke().put_lineendsize(i.get("type"))),this._endSizeIdx=i.get("value"),this._selectStyleItem(this.btnEndSize,i)},textTop:"Top",textLeft:"Left",textBottom:"Bottom",textRight:"Right",textOriginalSize:"Actual Size",textPosition:"Position",textDistance:"Distance From Text",textSize:"Size",textWrap:"Wrapping Style",textWidth:"Width",textHeight:"Height",textWrapInlineTooltip:"Inline",textWrapSquareTooltip:"Square",textWrapTightTooltip:"Tight",textWrapThroughTooltip:"Through",textWrapTopbottomTooltip:"Top and Bottom",textWrapBehindTooltip:"Behind",textWrapInFrontTooltip:"In Front",textTitle:"Image - Advanced Settings",textKeepRatio:"Constant Proportions",textBtnWrap:"Text Wrapping",textCenter:"Center",textCharacter:"Character",textColumn:"Column",textLeftMargin:"Left Margin",textMargin:"Margin",textPage:"Page",textRightMargin:"Right Margin",textLine:"Line",textBottomMargin:"Bottom Margin",textParagraph:"Paragraph",textTopMargin:"Top Margin",textHorizontal:"Horizontal",textVertical:"Vertical",textAlignment:"Alignment",textRelative:"relative to",textRightOf:"to the right Of",textBelow:"below",textOverlap:"Allow overlap",textMove:"Move object with text",textOptions:"Options",textShape:"Shape Settings",textTitleShape:"Shape - Advanced Settings",textTitleChart:"Chart - Advanced Settings",strMargins:"Text Padding",textRound:"Round",textMiter:"Miter",textSquare:"Square",textFlat:"Flat",textBevel:"Bevel",textArrows:"Arrows",textLineStyle:"Line Style",textCapType:"Cap Type",textJoinType:"Join Type",textBeginStyle:"Begin Style",textBeginSize:"Begin Size",textEndStyle:"End Style",textEndSize:"End Size",textPositionPc:"Relative position",textAspectRatio:"Lock aspect ratio",textAbsoluteWH:"Absolute",textRelativeWH:"Relative",textAlt:"Alternative Text",textAltTitle:"Title",textAltDescription:"Description",textAltTip:"The alternative text-based representation of the visual object information, which will be read to the people with vision or cognitive impairments to help them better understand what information there is in the image, autoshape, chart or table.",textWeightArrows:"Weights & Arrows",textRotation:"Rotation",textAngle:"Angle",textFlipped:"Flipped",textHorizontally:"Horizontally",textVertically:"Vertically",textTextBox:"Text Box",textAutofit:"AutoFit",textResizeFit:"Resize shape to fit text"},DE.Views.ImageSettingsAdvanced||{}))}),define("documenteditor/main/app/view/ImageSettings",["text!documenteditor/main/app/template/ImageSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/view/ImageFromUrlDialog","documenteditor/main/app/view/ImageSettingsAdvanced"],function(t,e,i,n){"use strict";DE.Views.ImageSettings=n.View.extend(i.extend({el:"#id-image-settings",template:i.template(t),events:{},options:{alias:"ImageSettings"},initialize:function(){this._initSettings=!0,this._state={WrappingStyle:Asc.c_oAscWrapStyle2.Inline,CanBeFlow:!0,Width:0,Height:0,FromGroup:!1,DisabledControls:!1,isOleObject:!1,cropMode:!1,isPictureControl:!1},this.lockedControls=[],this._locked=!1,this._originalProps=null,this.render()},render:function(){var t=this.$el||e(this.el);t.html(this.template({scope:this})),this.labelWidth=t.find("#image-label-width"),this.labelHeight=t.find("#image-label-height")},setApi:function(t){return this.api=t,this.api&&(this.api.asc_registerCallback("asc_onImgWrapStyleChanged",i.bind(this._ImgWrapStyleChanged,this)),this.api.asc_registerCallback("asc_ChangeCropState",i.bind(this._changeCropState,this))),Common.NotificationCenter.on("storage:image-insert",i.bind(this.insertImageFromStorage,this)),this},setMode:function(t){this.mode=t},updateMetricUnit:function(){var t=Common.Utils.Metric.fnRecalcFromMM(this._state.Width);this.labelWidth[0].innerHTML=this.textWidth+": "+t.toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName(),t=Common.Utils.Metric.fnRecalcFromMM(this._state.Height),this.labelHeight[0].innerHTML=this.textHeight+": "+t.toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()},createDelayedControls:function(){var t=this,n=[{icon:"btn-wrap-inline",data:Asc.c_oAscWrapStyle2.Inline,tip:this.txtInline,selected:!0},{icon:"btn-wrap-square",data:Asc.c_oAscWrapStyle2.Square,tip:this.txtSquare},{icon:"btn-wrap-tight",data:Asc.c_oAscWrapStyle2.Tight,tip:this.txtTight},{icon:"btn-wrap-through",data:Asc.c_oAscWrapStyle2.Through,tip:this.txtThrough},{icon:"btn-wrap-topbottom",data:Asc.c_oAscWrapStyle2.TopAndBottom,tip:this.txtTopAndBottom},{icon:"btn-wrap-infront",data:Asc.c_oAscWrapStyle2.InFront,tip:this.txtInFront},{icon:"btn-wrap-behind",data:Asc.c_oAscWrapStyle2.Behind,tip:this.txtBehind}];this.cmbWrapType=new Common.UI.ComboDataView({itemWidth:50,itemHeight:50,menuMaxHeight:300,enableKeyEvents:!0,store:new Common.UI.DataViewStore(n),cls:"combo-chart-style"}),this.cmbWrapType.menuPicker.itemTemplate=this.cmbWrapType.fieldPicker.itemTemplate=i.template(['<div class="item-icon-box" id="<%= id %>" style="">','<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" class="combo-wrap-item options__icon options__icon-huge <%= icon %>"',"</div>"].join("")),this.cmbWrapType.render(e("#image-combo-wrap")),this.cmbWrapType.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.cmbWrapType.on("click",i.bind(this.onSelectWrap,this)),this.cmbWrapType.openButton.menu.on("show:after",function(){t.cmbWrapType.menuPicker.scroller.update({alwaysVisibleY:!0})}),this.lockedControls.push(this.cmbWrapType),this.btnOriginalSize=new Common.UI.Button({el:e("#image-button-original-size")}),this.lockedControls.push(this.btnOriginalSize),this.btnFitMargins=new Common.UI.Button({el:e("#image-button-fit-margins")}),this.lockedControls.push(this.btnFitMargins);var o=Math.max(this.btnOriginalSize.cmpEl.width(),this.btnFitMargins.cmpEl.width());this.btnOriginalSize.cmpEl.width(o),this.btnFitMargins.cmpEl.width(o),this.btnEditObject=new Common.UI.Button({el:e("#image-button-edit-object")}),this.lockedControls.push(this.btnEditObject),this.btnOriginalSize.on("click",i.bind(this.setOriginalSize,this)),this.btnEditObject.on("click",i.bind(function(t){this.api&&this.api.asc_startEditCurrentOleObject(),this.fireEvent("editcomplete",this)},this)),this.btnFitMargins.on("click",i.bind(this.setFitMargins,this)),this.btnRotate270=new Common.UI.Button({parentEl:e("#image-button-270",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-270",value:0,hint:this.textHint270}),this.btnRotate270.on("click",i.bind(this.onBtnRotateClick,this)),this.lockedControls.push(this.btnRotate270),this.btnRotate90=new Common.UI.Button({parentEl:e("#image-button-90",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-90",value:1,hint:this.textHint90}),this.btnRotate90.on("click",i.bind(this.onBtnRotateClick,this)),this.lockedControls.push(this.btnRotate90),this.btnFlipV=new Common.UI.Button({parentEl:e("#image-button-flipv",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-flip-vert",value:0,hint:this.textHintFlipV}),this.btnFlipV.on("click",i.bind(this.onBtnFlipClick,this)),this.lockedControls.push(this.btnFlipV),this.btnFlipH=new Common.UI.Button({parentEl:e("#image-button-fliph",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-flip-hor",value:1,hint:this.textHintFlipH}),this.btnFlipH.on("click",i.bind(this.onBtnFlipClick,this)),this.lockedControls.push(this.btnFlipH);var o=this.btnOriginalSize.cmpEl.outerWidth();this.btnCrop=new Common.UI.Button({parentEl:e("#image-button-crop"),cls:"btn-text-split-default",caption:this.textCrop,split:!0,enableToggle:!0,allowDepress:!0,pressed:this._state.cropMode,width:o,menu:new Common.UI.Menu({style:"min-width:"+o+"px;",items:[{caption:this.textCrop,checkable:!0,allowDepress:!0,checked:this._state.cropMode,value:0},{caption:this.textCropFill,value:1},{caption:this.textCropFit,value:2}]})}),this.btnCrop.on("click",i.bind(this.onCrop,this)),this.btnCrop.menu.on("item:click",i.bind(this.onCropMenu,this)),this.lockedControls.push(this.btnCrop),this.btnSelectImage=new Common.UI.Button({parentEl:e("#image-button-replace"),cls:"btn-text-menu-default",caption:this.textInsert,style:"width:100%;",menu:new Common.UI.Menu({style:"min-width: 194px;",maxHeight:200,items:[{caption:this.textFromFile,value:0},{cls:"cp-from-url",caption:this.textFromUrl,value:1},{caption:this.textFromStorage,value:2}]})}),this.lockedControls.push(this.btnSelectImage),this.btnSelectImage.menu.on("item:click",i.bind(this.onImageSelect,this)),this.btnSelectImage.menu.items[2].setVisible(this.mode.canRequestInsertImage||this.mode.fileChoiceUrl&&this.mode.fileChoiceUrl.indexOf("{documentType}")>-1),this.linkAdvanced=e("#image-advanced-link"),e(this.el).on("click","#image-advanced-link",i.bind(this.openAdvancedSettings,this))},_changeCropState:function(t){this._state.cropMode=t,this.btnCrop&&(this.btnCrop.toggle(t,!0),this.btnCrop.menu.items[0].setChecked(t,!0))},createDelayedElements:function(){this.createDelayedControls(),this.updateMetricUnit(),this._initSettings=!1},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedElements(),this.disableControls(this._locked),t){this._originalProps=new Asc.asc_CImgProperty(t);var e=t.get_WrappingStyle();if(this._state.WrappingStyle!==e){this.cmbWrapType.suspendEvents();var i=this.cmbWrapType.menuPicker.store.findWhere({data:e});this.cmbWrapType.menuPicker.selectRecord(i),this.cmbWrapType.resumeEvents(),this._state.WrappingStyle=e}e=t.get_CanBeFlow()&&!this._locked;var n=t.get_FromGroup()||this._locked,o=this.api.asc_IsContentControl()?this.api.asc_GetContentControlProperties():null,s=!!o&&o.get_SpecificType()==Asc.c_oAscContentControlSpecificType.Picture||this._locked;this._state.CanBeFlow===e&&this._state.FromGroup===n&&this._state.isPictureControl===s||(this.cmbWrapType.setDisabled(!e||n||s),this._state.CanBeFlow=e,this._state.FromGroup=n,this._state.isPictureControl=s),e=t.get_Width(),Math.abs(this._state.Width-e)>.001&&(this.labelWidth[0].innerHTML=this.textWidth+": "+Common.Utils.Metric.fnRecalcFromMM(e).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName(),this._state.Width=e),e=t.get_Height(),Math.abs(this._state.Height-e)>.001&&(this.labelHeight[0].innerHTML=this.textHeight+": "+Common.Utils.Metric.fnRecalcFromMM(e).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName(),this._state.Height=e),this.btnOriginalSize.setDisabled(null===t.get_ImageUrl()||void 0===t.get_ImageUrl()||this._locked);var a=t.asc_getPluginGuid();if(e=null!==a&&void 0!==a,this._state.isOleObject!==e&&(this.btnSelectImage.setVisible(!e),this.btnEditObject.setVisible(e),this.btnRotate270.setDisabled(e),this.btnRotate90.setDisabled(e),this.btnFlipV.setDisabled(e),this.btnFlipH.setDisabled(e),this._state.isOleObject=e),this._state.isOleObject){var r=DE.getCollection("Common.Collections.Plugins").findWhere({guid:a});this.btnEditObject.setDisabled(null===r||void 0===r||this._locked)}else this.btnSelectImage.setDisabled(null===a||this._locked)}},_ImgWrapStyleChanged:function(t){if(this.cmbWrapType&&this._state.WrappingStyle!==t){this.cmbWrapType.suspendEvents();var e=this.cmbWrapType.menuPicker.store.findWhere({data:t});this.cmbWrapType.menuPicker.selectRecord(e),this.cmbWrapType.resumeEvents(),this._state.WrappingStyle=t}},onSelectWrap:function(t,e){if(this.api){var i=new Asc.asc_CImgProperty,n=e.get("data");if(i.put_WrappingStyle(n),this._state.WrappingStyle===Asc.c_oAscWrapStyle2.Inline&&n!==Asc.c_oAscWrapStyle2.Inline){i.put_PositionH(new Asc.CImagePositionH),i.get_PositionH().put_UseAlign(!1),i.get_PositionH().put_RelativeFrom(Asc.c_oAscRelativeFromH.Column);var o=this._originalProps.get_Value_X(Asc.c_oAscRelativeFromH.Column);i.get_PositionH().put_Value(o),i.put_PositionV(new Asc.CImagePositionV),i.get_PositionV().put_UseAlign(!1),i.get_PositionV().put_RelativeFrom(Asc.c_oAscRelativeFromV.Paragraph),o=this._originalProps.get_Value_Y(Asc.c_oAscRelativeFromV.Paragraph),i.get_PositionV().put_Value(o)}this.api.ImgApply(i)}this.fireEvent("editcomplete",this)},setOriginalSize:function(){if(this.api){var t=this.api.get_OriginalSizeImage(),e=t.get_ImageWidth(),i=t.get_ImageHeight();this.labelWidth[0].innerHTML=this.textWidth+": "+Common.Utils.Metric.fnRecalcFromMM(e).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName(),this.labelHeight[0].innerHTML=this.textHeight+": "+Common.Utils.Metric.fnRecalcFromMM(i).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName();var n=new Asc.asc_CImgProperty;n.put_Width(e),n.put_Height(i),n.put_ResetCrop(!0),n.put_Rot(0),this.api.ImgApply(n),this.fireEvent("editcomplete",this)}},setFitMargins:function(){if(this.api){var t,e,i=this.api.asc_GetSectionProps(),n=this._state.Height>0?this._state.Width/this._state.Height:1,o=this.api.asc_GetCurrentColumnWidth?this.api.asc_GetCurrentColumnWidth():i.get_W()-i.get_LeftMargin()-i.get_RightMargin(),s=i.get_H()-i.get_TopMargin()-i.get_BottomMargin(),a=o/s;n>a?(t=o,e=t/n):n<a?(e=s,t=e*n):(t=o,e=s),this.labelWidth[0].innerHTML=this.textWidth+": "+Common.Utils.Metric.fnRecalcFromMM(t).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName(),this.labelHeight[0].innerHTML=this.textHeight+": "+Common.Utils.Metric.fnRecalcFromMM(e).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName();var r=new Asc.asc_CImgProperty;if(r.put_Width(t),r.put_Height(e),this._state.WrappingStyle!==Asc.c_oAscWrapStyle2.Inline){if(n>=1){var l=new Asc.CImagePositionH;l.put_UseAlign(!0),l.put_Percent(!1),l.put_RelativeFrom(Asc.c_oAscRelativeFromH.Margin),l.put_Align(Asc.c_oAscAlignH.Left),r.put_PositionH(l)}n<=1&&(l=new Asc.CImagePositionV,l.put_UseAlign(!0),l.put_Percent(!1),l.put_RelativeFrom(Asc.c_oAscRelativeFromV.Margin),l.put_Align(Asc.c_oAscAlignV.Top),r.put_PositionV(l))}this.api.ImgApply(r),this.fireEvent("editcomplete",this)}},setImageUrl:function(t,e){var i=new Asc.asc_CImgProperty;i.put_ImageUrl(t,e),this.api.ImgApply(i)},insertImageFromStorage:function(t){t&&t.url&&"change"==t.c&&this.setImageUrl(t.url,t.token)},onImageSelect:function(t,e){if(1==e.value){var n=this;new Common.Views.ImageFromUrlDialog({handler:function(t,e){if("ok"==t&&n.api){var o=e.replace(/ /g,"");i.isEmpty(o)||n.setImageUrl(o)}n.fireEvent("editcomplete",n)}}).show()}else if(2==e.value)Common.NotificationCenter.trigger("storage:image-load","change");else{if(this._isFromFile)return;this._isFromFile=!0,this.api&&this.api.ChangeImageFromFile(),this.fireEvent("editcomplete",this),this._isFromFile=!1}},onBtnRotateClick:function(t){var e=new Asc.asc_CImgProperty;e.asc_putRotAdd(3.14159265358979*(1==t.options.value?90:270)/180),this.api.ImgApply(e),this.fireEvent("editcomplete",this)},onBtnFlipClick:function(t){var e=new Asc.asc_CImgProperty;1==t.options.value?e.asc_putFlipHInvert(!0):e.asc_putFlipVInvert(!0),this.api.ImgApply(e),this.fireEvent("editcomplete",this)},onCrop:function(t,e){this.api&&(t.pressed?this.api.asc_startEditCrop():this.api.asc_endEditCrop()),this.fireEvent("editcomplete",this)},onCropMenu:function(t,e){this.api&&(1==e.value?this.api.asc_cropFill():2==e.value?this.api.asc_cropFit():e.checked?this.api.asc_startEditCrop():this.api.asc_endEditCrop()),this.fireEvent("editcomplete",this)},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;if(e.api&&!this._locked){var i=e.api.getSelectedElements();if(i&&i.length>0)for(var n,o,s=i.length-1;s>=0;s--)if(n=i[s].get_ObjectType(),o=i[s].get_ObjectValue(),Asc.c_oAscTypeSelectElement.Image==n){var a;e.btnOriginalSize.isDisabled()||(a=e.api.get_OriginalSizeImage())&&(a={width:a.get_ImageWidth(),height:a.get_ImageHeight()}),new DE.Views.ImageSettingsAdvanced({imageProps:o,sizeOriginal:a,api:e.api,sectionProps:e.api.asc_GetSectionProps(),handler:function(t,i){"ok"==t&&e.api&&e.api.ImgApply(i.imageProps),e.fireEvent("editcomplete",e)}}).show();break}}}},setLocked:function(t){this._locked=t},disableControls:function(t){this._initSettings||(this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,function(e){e.setDisabled(t)}),this.linkAdvanced.toggleClass("disabled",t)),this.btnCrop.setDisabled(t||!this.api.asc_canEditCrop()))},textSize:"Size",textWrap:"Wraping Style",textWidth:"Width",textHeight:"Height",textOriginalSize:"Actual Size",textInsert:"Replace Image",textFromUrl:"From URL",textFromFile:"From File",textAdvanced:"Show advanced settings",txtInline:"Inline",txtSquare:"Square",txtTight:"Tight",txtThrough:"Through",txtTopAndBottom:"Top and bottom",txtBehind:"Behind",txtInFront:"In front",textEditObject:"Edit Object",textEdit:"Edit",textFitMargins:"Fit to Margin",
textRotation:"Rotation",textRotate90:"Rotate 90Â°",textFlip:"Flip",textHint270:"Rotate 90Â° Counterclockwise",textHint90:"Rotate 90Â° Clockwise",textHintFlipV:"Flip Vertically",textHintFlipH:"Flip Horizontally",textCrop:"Crop",textCropFill:"Fill",textCropFit:"Fit",textFromStorage:"From Storage"},DE.Views.ImageSettings||{}))}),define("text!documenteditor/main/app/template/ChartSettings.template",[],function(){return'<table cols="2">\r\n    <tr>\r\n        <td colspan=2>\r\n            <label class="header"><%= scope.textSize %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="50%">\r\n            <label id="chart-label-width" class="input-label"><%= scope.textWidth %></label>\r\n        </td>\r\n        <td class="padding-small" width="50%">\r\n            <label id="chart-label-height" class="input-label"><%= scope.textHeight %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2 class="padding-small">\r\n            <label class="header"><%= scope.textWrap %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div id="chart-combo-wrap" style="width: 100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2>\r\n            <label class="header"><%= scope.textChartType %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div id="chart-button-type" style=""></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="not-combined">\r\n        <td class="padding-small" colspan=2>\r\n            <div class="" id="chart-combo-style" style="width: 100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <button type="button" class="btn btn-text-default auto" id="chart-button-edit-data" style="min-width:115px;"><%= scope.textEditData %></button>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td align="center" colspan=2>\r\n            <label class="link" id="chart-advanced-link"><%= scope.textAdvanced %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'}),define("documenteditor/main/app/view/ChartSettings",["text!documenteditor/main/app/template/ChartSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/ComboDataView","documenteditor/main/app/view/ImageSettingsAdvanced"],function(t,e,i,n){"use strict";DE.Views.ChartSettings=n.View.extend(i.extend({el:"#id-chart-settings",template:i.template(t),events:{},options:{alias:"ChartSettings"},initialize:function(){this._initSettings=!0,this._state={WrappingStyle:Asc.c_oAscWrapStyle2.Inline,CanBeFlow:!0,Width:0,Height:0,FromGroup:!1,ChartStyle:1,ChartType:-1,SeveralCharts:!1,DisabledControls:!1},this.lockedControls=[],this._locked=!1,this._noApply=!1,this._originalProps=null,this.render()},render:function(){var t=this.$el||e(this.el);t.html(this.template({scope:this})),this.labelWidth=t.find("#chart-label-width"),this.labelHeight=t.find("#chart-label-height"),this.NotCombinedSettings=e(".not-combined")},setApi:function(t){return this.api=t,this.api&&(this.api.asc_registerCallback("asc_onImgWrapStyleChanged",i.bind(this._ChartWrapStyleChanged,this)),this.api.asc_registerCallback("asc_onUpdateChartStyles",i.bind(this._onUpdateChartStyles,this))),this},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedElements(),this.disableControls(this._locked),t&&t.get_ChartProperties()){this._originalProps=new Asc.asc_CImgProperty(t),this._noApply=!0;var e=t.get_WrappingStyle();if(this._state.WrappingStyle!==e){this.cmbWrapType.suspendEvents();var i=this.cmbWrapType.menuPicker.store.findWhere({data:e});this.cmbWrapType.menuPicker.selectRecord(i),this.cmbWrapType.resumeEvents(),this._state.WrappingStyle=e}if(this.chartProps=t.get_ChartProperties(),e=t.get_SeveralCharts()||this._locked,this._state.SeveralCharts!==e&&(this.btnEditData.setDisabled(e),this._state.SeveralCharts=e),e=t.get_SeveralChartTypes(),this._state.SeveralCharts&&e)this.btnChartType.setIconCls("svgicon"),this._state.ChartType=null;else{var n=this.chartProps.getType();if(this._state.ChartType!==n){var o=this.mnuChartTypePicker.store.findWhere({type:n});this.mnuChartTypePicker.selectRecord(o,!0),o?this.btnChartType.setIconCls("svgicon chart-"+o.get("iconCls")):this.btnChartType.setIconCls("svgicon"),this.ShowCombinedProps(n),!(null===n||n==Asc.c_oAscChartTypeSettings.comboBarLine||n==Asc.c_oAscChartTypeSettings.comboBarLineSecondary||n==Asc.c_oAscChartTypeSettings.comboAreaBar||n==Asc.c_oAscChartTypeSettings.comboCustom)&&this.updateChartStyles(this.api.asc_getChartPreviews(n)),this._state.ChartType=n}}if(n!=Asc.c_oAscChartTypeSettings.comboBarLine&&n!=Asc.c_oAscChartTypeSettings.comboBarLineSecondary&&n!=Asc.c_oAscChartTypeSettings.comboAreaBar&&n!=Asc.c_oAscChartTypeSettings.comboCustom){if(e=t.get_SeveralChartStyles(),this._state.SeveralCharts&&e)this.cmbChartStyle.fieldPicker.deselectAll(),this.cmbChartStyle.menuPicker.deselectAll(),this._state.ChartStyle=null;else if(e=this.chartProps.getStyle(),this._state.ChartStyle!==e||this._isChartStylesChanged){this.cmbChartStyle.suspendEvents();var i=this.cmbChartStyle.menuPicker.store.findWhere({data:e});this.cmbChartStyle.menuPicker.selectRecord(i),this.cmbChartStyle.resumeEvents(),this._isChartStylesChanged&&(i?this.cmbChartStyle.fillComboView(this.cmbChartStyle.menuPicker.getSelectedRec(),!0):this.cmbChartStyle.fillComboView(this.cmbChartStyle.menuPicker.store.at(0),!0)),this._state.ChartStyle=e}this._isChartStylesChanged=!1}this._noApply=!1,e=t.get_CanBeFlow()&&!this._locked;var s=t.get_FromGroup()||this._locked;this._state.CanBeFlow===e&&this._state.FromGroup===s||(this.cmbWrapType.setDisabled(!e||s),this._state.CanBeFlow=e,this._state.FromGroup=s),e=t.get_Width(),Math.abs(this._state.Width-e)>.001&&(this.labelWidth[0].innerHTML=this.textWidth+": "+Common.Utils.Metric.fnRecalcFromMM(e).toFixed(1)+" "+Common.Utils.Metric.getCurrentMetricName(),this._state.Width=e),e=t.get_Height(),Math.abs(this._state.Height-e)>.001&&(this.labelHeight[0].innerHTML=this.textHeight+": "+Common.Utils.Metric.fnRecalcFromMM(e).toFixed(1)+" "+Common.Utils.Metric.getCurrentMetricName(),this._state.Height=e)}},updateMetricUnit:function(){var t=Common.Utils.Metric.fnRecalcFromMM(this._state.Width);this.labelWidth[0].innerHTML=this.textWidth+": "+t.toFixed(1)+" "+Common.Utils.Metric.getCurrentMetricName(),t=Common.Utils.Metric.fnRecalcFromMM(this._state.Height),this.labelHeight[0].innerHTML=this.textHeight+": "+t.toFixed(1)+" "+Common.Utils.Metric.getCurrentMetricName()},createDelayedControls:function(){var t=this,n=[{icon:"btn-wrap-inline",data:Asc.c_oAscWrapStyle2.Inline,tip:this.txtInline,selected:!0},{icon:"btn-wrap-square",data:Asc.c_oAscWrapStyle2.Square,tip:this.txtSquare},{icon:"btn-wrap-tight",data:Asc.c_oAscWrapStyle2.Tight,tip:this.txtTight},{icon:"btn-wrap-through",data:Asc.c_oAscWrapStyle2.Through,tip:this.txtThrough},{icon:"btn-wrap-topbottom",data:Asc.c_oAscWrapStyle2.TopAndBottom,tip:this.txtTopAndBottom},{icon:"btn-wrap-infront",data:Asc.c_oAscWrapStyle2.InFront,tip:this.txtInFront},{icon:"btn-wrap-behind",data:Asc.c_oAscWrapStyle2.Behind,tip:this.txtBehind}];this.cmbWrapType=new Common.UI.ComboDataView({itemWidth:50,itemHeight:50,menuMaxHeight:300,enableKeyEvents:!0,store:new Common.UI.DataViewStore(n),cls:"combo-chart-style"}),this.cmbWrapType.menuPicker.itemTemplate=this.cmbWrapType.fieldPicker.itemTemplate=i.template(['<div class="item-icon-box" id="<%= id %>">','<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" class="combo-wrap-item options__icon options__icon-huge <%= icon %>" ',"</div>"].join("")),this.cmbWrapType.render(e("#chart-combo-wrap")),this.cmbWrapType.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.cmbWrapType.on("click",i.bind(this.onSelectWrap,this)),this.cmbWrapType.openButton.menu.on("show:after",function(){t.cmbWrapType.menuPicker.scroller.update({alwaysVisibleY:!0})}),this.lockedControls.push(this.cmbWrapType),this.btnChartType=new Common.UI.Button({cls:"btn-large-dataview",iconCls:"svgicon chart-column-normal",menu:new Common.UI.Menu({style:"width: 364px;",items:[{template:i.template('<div id="id-chart-menu-type" class="menu-insertchart" ></div>')}]})}),this.btnChartType.on("render:after",function(n){t.mnuChartTypePicker=new Common.UI.DataView({el:e("#id-chart-menu-type"),parentMenu:n.menu,restoreHeight:465,groups:new Common.UI.DataViewGroupStore(Common.define.chartData.getChartGroupData()),store:new Common.UI.DataViewStore(Common.define.chartData.getChartData()),itemTemplate:i.template('<div id="<%= id %>" class="item-chartlist"><svg width="40" height="40" class="icon"><use xlink:href="#chart-<%= iconCls %>"></use></svg></div>')})}),this.btnChartType.render(e("#chart-button-type")),this.mnuChartTypePicker.on("item:click",i.bind(this.onSelectType,this,this.btnChartType)),this.lockedControls.push(this.btnChartType),this.btnEditData=new Common.UI.Button({el:e("#chart-button-edit-data")}),this.lockedControls.push(this.btnEditData),this.btnEditData.on("click",i.bind(this.setEditData,this)),this.linkAdvanced=e("#chart-advanced-link"),e(this.el).on("click","#chart-advanced-link",i.bind(this.openAdvancedSettings,this))},createDelayedElements:function(){this.createDelayedControls(),this.updateMetricUnit(),this._initSettings=!1},_ChartWrapStyleChanged:function(t){if(this.cmbWrapType&&this._state.WrappingStyle!==t){this.cmbWrapType.suspendEvents();var e=this.cmbWrapType.menuPicker.store.findWhere({data:t});this.cmbWrapType.menuPicker.selectRecord(e),this.cmbWrapType.resumeEvents(),this._state.WrappingStyle=t}},onSelectWrap:function(t,e){if(this.api){var i=new Asc.asc_CImgProperty,n=e.get("data");if(i.put_WrappingStyle(n),this._state.WrappingStyle===Asc.c_oAscWrapStyle2.Inline&&n!==Asc.c_oAscWrapStyle2.Inline){i.put_PositionH(new Asc.CImagePositionH),i.get_PositionH().put_UseAlign(!1),i.get_PositionH().put_RelativeFrom(Asc.c_oAscRelativeFromH.Column);var o=this._originalProps.get_Value_X(Asc.c_oAscRelativeFromH.Column);i.get_PositionH().put_Value(o),i.put_PositionV(new Asc.CImagePositionV),i.get_PositionV().put_UseAlign(!1),i.get_PositionV().put_RelativeFrom(Asc.c_oAscRelativeFromV.Paragraph),o=this._originalProps.get_Value_Y(Asc.c_oAscRelativeFromV.Paragraph),i.get_PositionV().put_Value(o)}this.api.ImgApply(i)}this.fireEvent("editcomplete",this)},setEditData:function(){var t=DE.getController("Common.Controllers.ExternalDiagramEditor").getView("Common.Views.ExternalDiagramEditor");if(t){t.setEditMode(!0),t.show();var e=this.api.asc_getChartObject();e&&t.setChartData(new Asc.asc_CChartBinary(e))}},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;if(e.api&&!this._locked){var i=e.api.getSelectedElements();if(i&&i.length>0)for(var n,o,s=i.length-1;s>=0;s--)if(n=i[s].get_ObjectType(),o=i[s].get_ObjectValue(),Asc.c_oAscTypeSelectElement.Image==n){new DE.Views.ImageSettingsAdvanced({imageProps:o,sectionProps:e.api.asc_GetSectionProps(),handler:function(t,i){"ok"==t&&e.api&&e.api.ImgApply(i.imageProps),e.fireEvent("editcomplete",e)}}).show();break}}}},onSelectType:function(t,e,n,o){if(!this._noApply){var s={};if(i.isFunction(o.toJSON)){if(!o.get("selected"))return;s=o.toJSON()}else s=o;if(this.api&&!this._noApply&&this.chartProps){(s.type==Asc.c_oAscChartTypeSettings.comboBarLine||s.type==Asc.c_oAscChartTypeSettings.comboBarLineSecondary||s.type==Asc.c_oAscChartTypeSettings.comboAreaBar||s.type==Asc.c_oAscChartTypeSettings.comboCustom)&&this.chartProps.getSeries().length<2?(Common.NotificationCenter.trigger("showerror",Asc.c_oAscError.ID.ComboSeriesError,Asc.c_oAscError.Level.NoCritical),this.mnuChartTypePicker.selectRecord(this.mnuChartTypePicker.store.findWhere({type:this.chartProps.getType()}),!0)):(this.btnChartType.setIconCls("svgicon chart-"+s.iconCls),this._state.ChartType=-1,this.chartProps.changeType(s.type))}this.fireEvent("editcomplete",this)}},onSelectStyle:function(t,e){if(!this._noApply){if(this.api&&!this._noApply&&this.chartProps){var i=new Asc.asc_CImgProperty;this.chartProps.putStyle(e.get("data")),i.put_ChartProperties(this.chartProps),this.api.ImgApply(i)}this.fireEvent("editcomplete",this)}},_onUpdateChartStyles:function(){this.api&&null!==this._state.ChartType&&this._state.ChartType>-1&&this._state.ChartType!=Asc.c_oAscChartTypeSettings.comboBarLine&&this._state.ChartType!=Asc.c_oAscChartTypeSettings.comboBarLineSecondary&&this._state.ChartType!=Asc.c_oAscChartTypeSettings.comboAreaBar&&this._state.ChartType!=Asc.c_oAscChartTypeSettings.comboCustom&&this.updateChartStyles(this.api.asc_getChartPreviews(this._state.ChartType))},updateChartStyles:function(t){var n=this;if(this._isChartStylesChanged=!0,this.cmbChartStyle||(this.cmbChartStyle=new Common.UI.ComboDataView({itemWidth:50,itemHeight:50,menuMaxHeight:270,enableKeyEvents:!0,cls:"combo-chart-style"}),this.cmbChartStyle.render(e("#chart-combo-style")),this.cmbChartStyle.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.cmbChartStyle.on("click",i.bind(this.onSelectStyle,this)),this.cmbChartStyle.openButton.menu.on("show:after",function(){n.cmbChartStyle.menuPicker.scroller.update({alwaysVisibleY:!0})}),this.lockedControls.push(this.cmbChartStyle)),t&&t.length>0){var o=this.cmbChartStyle.menuPicker.store;if(o){var s=o.length;if(s>0&&s==t.length){var a=o.models;i.each(t,function(t,e){a[e].set("imageUrl",t.asc_getImage())})}else{var r=[];i.each(t,function(t,e){r.push({imageUrl:t.asc_getImage(),data:t.asc_getName(),tip:n.textStyle+" "+t.asc_getName()})}),o.reset(r,{silent:!1})}}}else this.cmbChartStyle.menuPicker.store.reset(),this.cmbChartStyle.clearComboView();this.cmbChartStyle.setDisabled(!t||t.length<1||this._locked)},ShowCombinedProps:function(t){this.NotCombinedSettings.toggleClass("settings-hidden",null===t||t==Asc.c_oAscChartTypeSettings.comboBarLine||t==Asc.c_oAscChartTypeSettings.comboBarLineSecondary||t==Asc.c_oAscChartTypeSettings.comboAreaBar||t==Asc.c_oAscChartTypeSettings.comboCustom)},setLocked:function(t){this._locked=t},disableControls:function(t){this._initSettings||this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,function(e){e.setDisabled(t)}),this.linkAdvanced.toggleClass("disabled",t))},textSize:"Size",textWrap:"Wrapping Style",textWidth:"Width",textHeight:"Height",textAdvanced:"Show advanced settings",txtInline:"Inline",txtSquare:"Square",txtTight:"Tight",txtThrough:"Through",txtTopAndBottom:"Top and bottom",txtBehind:"Behind",txtInFront:"In front",textEditData:"Edit Data",textChartType:"Change Chart Type",textStyle:"Style"},DE.Views.ChartSettings||{}))}),define("text!documenteditor/main/app/template/TableSettings.template",[],function(){return'<table cols="2">\r\n    <tr>\r\n        <td width="50%">\r\n            <label class="header"><%= scope.textRows %></label>\r\n        </td>\r\n        <td width="50%">\r\n            <label class="header"><%= scope.textColumns %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="table-checkbox-header"></div>\r\n        </td>\r\n        <td class="padding-small">\r\n            <div id="table-checkbox-first"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="table-checkbox-total"></div>\r\n        </td>\r\n        <td class="padding-small">\r\n            <div id="table-checkbox-last"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="table-checkbox-banded"></div>\r\n        </td>\r\n        <td class="padding-small">\r\n            <div id="table-checkbox-col-banded"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2>\r\n            <label class="header"><%= scope.textTemplate %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2 class="padding-small">\r\n            <div class="" id="table-btn-template" style="width: 100%; height: 58px;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2 class="padding-small">\r\n            <label class="header"><%= scope.textBorders %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div id="table-combo-border-size" style="display: inline-block; vertical-align: middle; width: 93px;"></div>\r\n            <div style="display: inline-block; float:right;vertical-align: middle;">\r\n                <label class="input-label" style="margin-right: 5px;"><%= scope.textBorderColor %></label>\r\n                <div id="table-border-color-btn" style="display: inline-block;"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <label class="input-label"><%= scope.textSelectBorders %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2 class="padding-small">\r\n            <div id="table-button-border-all" style="display: inline-block;"></div>\r\n            <div id="table-button-border-none" style="display: inline-block;"></div>\r\n            <div id="table-button-border-inner" style="display: inline-block;"></div>\r\n            <div id="table-button-border-outer" style="display: inline-block;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2 class="padding-small">\r\n            <div id="table-button-border-left" style="display: inline-block;"></div>\r\n            <div id="table-button-border-inner-vert" style="display: inline-block;"></div>\r\n            <div id="table-button-border-right" style="display: inline-block;"></div>\r\n            <div id="table-button-border-top" style="display: inline-block;"></div>\r\n            <div id="table-button-border-inner-hor" style="display: inline-block;"></div>\r\n            <div id="table-button-border-bottom" style="display: inline-block;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2 align="right">\r\n            <label class="input-label" style="margin-right: 5px;"><%= scope.textBackColor %></label>\r\n            <div id="table-back-color-btn" style="display: inline-block;text-align:left;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <label class="header" style="margin-top: 3px;"><%= scope.textEdit %></label>\r\n            <div id="table-btn-edit" style="display: inline-block; float:right;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2>\r\n            <label class="header"><%= scope.textCellSize %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <label style="margin-top: 3px;"><%= scope.textHeight %></label>\r\n            <div id="table-btn-distrub-rows" style="display: inline-block; float:right; margin-left: 4px;"></div>\r\n            <div id="table-spin-cell-height" style="display: inline-block; float:right;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <label style="margin-top: 3px;"><%= scope.textWidth %></label>\r\n            <div id="table-btn-distrub-cols" style="display: inline-block; float:right; margin-left: 4px;"></div>\r\n            <div id="table-spin-cell-width" style="display: inline-block; float:right;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <button type="button" class="btn btn-text-default" id="table-btn-add-formula" style="width:100%;"><%= scope.textAddFormula %></button>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div id="table-checkbox-repeat-row"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div id="table-btn-convert-to-text" style="width:100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td align="center" colspan=2>\r\n            <label class="link" id="table-advanced-link"><%= scope.textAdvanced %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'}),void 0===Common)var Common={};if(define("common/main/lib/component/ComboBorderSize",["common/main/lib/component/ComboBox"],function(){"use strict";Common.UI.BordersModel=Backbone.Model.extend({defaults:function(){return{value:null,displayValue:null,pxValue:null,id:Common.UI.getId(),offsety:void 0}}}),Common.UI.BordersStore=Backbone.Collection.extend({model:Common.UI.BordersModel}),Common.UI.ComboBorderSize=Common.UI.ComboBox.extend(_.extend({template:_.template(['<div class="input-group combobox combo-border-size input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<div class="form-control" style="<%= style %>">','<i class="image"></i>','<span class="text"></span>',"</div>",'<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem">',"<span><%= item.displayValue %></span>","<% if (item.offsety!==undefined) { %>",'<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" align="right" style="background-position: 0 -<%= item.offsety %>px;">',"<% } %>","</a></li>","<% }); %>","</ul>","</div>"].join("")),initialize:function(t){var e=Common.Utils.Metric.getMetricName(Common.Utils.Metric.c_MetricUnits.pt),i=[{displayValue:"0.5 "+e,value:.5,pxValue:.5,offsety:0},{displayValue:"1 "+e,value:1,pxValue:1,offsety:20},{displayValue:"1.5 "+e,value:1.5,pxValue:2,offsety:40},{displayValue:"2.25 "+e,value:2.25,pxValue:3,offsety:60},{displayValue:"3 "+e,value:3,pxValue:4,offsety:80},{displayValue:"4.5 "+e,value:4.5,pxValue:5,offsety:100},{displayValue:"6 "+e,value:6,pxValue:6,offsety:120}];!1!==t.allowNoBorders&&i.unshift({displayValue:this.txtNoBorders,value:0,pxValue:0}),Common.UI.ComboBox.prototype.initialize.call(this,_.extend({editable:!1,store:new Common.UI.BordersStore,data:i,menuStyle:"min-width: 160px;"},t))},render:function(t){return Common.UI.ComboBox.prototype.render.call(this,t),this},itemClicked:function(t){var e=$(t.currentTarget).parent();this._selectedItem=this.store.findWhere({id:e.attr("id")}),this._selectedItem&&($(".selected",$(this.el)).removeClass("selected"),e.addClass("selected"),this.updateFormControl(this._selectedItem),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),t),t.preventDefault())},updateFormControl:function(t){var e=$(this.el).find(".form-control"),i=e.find("> .image"),n=e.find("> .text");t.get("value")>0?(i.css("background-position","10px -"+t.get("offsety")+"px").show(),n.hide()):(i.hide(),n.text(this.txtNoBorders).show())},setValue:function(t){this._selectedItem=null===t||void 0===t?void 0:_.find(this.store.models,function(e){if(t<e.attributes.value+.01&&t>e.attributes.value-.01)return!0}),$(".selected",$(this.el)).removeClass("selected"),this._selectedItem?(this.updateFormControl(this._selectedItem),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected")):$(this.el).find(".form-control > .text").text("").show()},txtNoBorders:"No Borders"},Common.UI.ComboBorderSize||{})),Common.UI.ComboBorderSizeEditable=Common.UI.ComboBox.extend(_.extend({template:_.template(['<span class="input-group combobox combo-border-size input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<input type="text" class="form-control text">','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem">',"<span><%= item.displayValue %></span>","<% if (item.offsety!==undefined) { %>",'<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" align="right" style="background-position: 0 -<%= item.offsety %>px;">',"<% } %>","</a></li>","<% }); %>","</ul>","</span>"].join("")),initialize:function(t){this.txtNoBorders=t.txtNoBorders||this.txtNoBorders;var e=Common.Utils.Metric.getMetricName(Common.Utils.Metric.c_MetricUnits.pt),i=[{displayValue:"0.5 "+e,value:.5,pxValue:.5,offsety:0},{displayValue:"1 "+e,value:1,pxValue:1,offsety:20},{displayValue:"1.5 "+e,value:1.5,pxValue:2,offsety:40},{displayValue:"2.25 "+e,value:2.25,pxValue:3,offsety:60},{displayValue:"3 "+e,value:3,pxValue:4,offsety:80},{displayValue:"4.5 "+e,value:4.5,pxValue:5,offsety:100},{displayValue:"6 "+e,value:6,pxValue:6,offsety:120}];!1!==t.allowNoBorders&&i.unshift({displayValue:this.txtNoBorders,value:0,pxValue:0}),Common.UI.ComboBox.prototype.initialize.call(this,_.extend({editable:!0,store:new Common.UI.BordersStore,data:i,menuStyle:"min-width: 160px;"},t))},render:function(t){return Common.UI.ComboBox.prototype.render.call(this,t),this},txtNoBorders:"No Borders"},Common.UI.ComboBorderSizeEditable||{})),Common.UI.ComboBorderType=Common.UI.ComboBorderSize.extend(_.extend({template:_.template(['<div class="input-group combobox combo-border-size input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<div class="form-control" style="<%= style %>">','<i class="image"></i>',"</div>",'<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem" style="padding: 2px 0 2px 10px;">','<span style="margin-top: 0;"></span>',"<% if (item.offsety!==undefined) { %>",'<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" align="left" style="background-position: 0 -<%= item.offsety %>px;">',"<% } %>","</a></li>","<% }); %>","</ul>","</div>"].join("")),initialize:function(t){Common.UI.ComboBorderSize.prototype.initialize.call(this,_.extend({store:new Common.UI.BordersStore,data:[{value:Asc.c_oDashType.solid,offsety:140},{value:Asc.c_oDashType.sysDot,offsety:160},{value:Asc.c_oDashType.sysDash,offsety:180},{value:Asc.c_oDashType.dash,offsety:200},{value:Asc.c_oDashType.dashDot,offsety:220},{value:Asc.c_oDashType.lgDash,offsety:240},{value:Asc.c_oDashType.lgDashDot,offsety:260},{value:Asc.c_oDashType.lgDashDotDot,offsety:280}]},t))},render:function(t){return Common.UI.ComboBorderSize.prototype.render.call(this,t),this},updateFormControl:function(t){$(this.el).find(".form-control > .image").css("background-position","10px -"+t.get("offsety")+"px")}},Common.UI.ComboBorderType||{})),Common.UI.ComboBoxColor=Common.UI.ComboBox.extend(_.extend({template:_.template(['<div class="input-group combobox combo-color input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<div class="form-control" style="padding:2px 14px 2px 3px; <%= style %> display: block;">','<div style="display: inline-block;overflow: hidden;width: 100%;height: 100%;"></div>',"</div>",'<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>","<% if (item.value==-1) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>',"<% } else { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>">','<a tabindex="-1" type="menuitem" style="padding: 5px;"><div style="height: 15px;<%= item.styleStr %>"><%= scope.getDisplayValue(item) %></div></a>',"</li>","<% } %>","<% }); %>","</ul>","</div>"].join("")),itemClicked:function(t){var e=$(t.currentTarget).parent();this._selectedItem=this.store.findWhere({id:e.attr("id")}),this._selectedItem&&($(".selected",$(this.el)).removeClass("selected"),e.addClass("selected"),this.updateFormControl(this._selectedItem),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),t),t.preventDefault())},updateFormControl:function(t){var e=$(this.el).find(".form-control > div");e[0].innerHTML=t.get("displayValue"),-1!=t.get("value")?(e.css({"margin-top":"0"}),e.css(t.get("styleObj"))):(e.css({"margin-top":"1px"}),e.css(t.get("styleObj")))},setValue:function(t){var e;if(this._selectedItem=this.store.findWhere((e={},e[this.valueField]=t,e)),$(".selected",$(this.el)).removeClass("selected"),this._selectedItem)this.updateFormControl(this._selectedItem),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected");else{var i=$(this.el).find(".form-control > div");i[0].innerHTML=t,i.css("margin-top","1px"),i.css({color:"","text-align":"",background:"",border:""})}},onResetItems:function(){this.itemsTemplate?$(this.el).find("ul").html($(this.itemsTemplate({items:this.store.toJSON(),scope:this}))):$(this.el).find("ul").html(_.template(["<% _.each(items, function(item) { %>","<% if (item.value==-1) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>',"<% } else { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>">','<a tabindex="-1" type="menuitem" style="padding: 5px;"><div style="height: 15px;<%= item.styleStr %>"><%= scope.getDisplayValue(item) %></div></a>',"</li>","<% } %>","<% }); %>"].join(""))({items:this.store.toJSON(),scope:this})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.scroller=new Common.UI.Scroller(_.extend({el:$(".dropdown-menu",this.cmpEl),minScrollbarLength:40,includePadding:!0,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible},this.options.scroller))}},Common.UI.ComboBoxColor||{})),Common.UI.ComboBoxIcons=Common.UI.ComboBox.extend(_.extend({
template:_.template(['<div class="input-group combobox combo-color input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<div class="form-control" style="padding:2px 0 2px 3px; <%= style %> display: block;">','<div style="display: inline-block;overflow: hidden;width: 100%;height: 100%;"></div>',"</div>",'<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>","<% if (item.value==-1) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>',"<% } else { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>">','<a tabindex="-1" type="menuitem" style="padding: 5px;">',"<% _.each(item.data.iconSet, function(icon) { %>",'<img src="<%= item.data.icons.at(icon-1).get(\'icon\') %>" style="width:16px;height:16px;margin-right: 5px;">',"<% }) %>","</a>","</li>","<% } %>","<% }); %>","</ul>","</div>"].join("")),itemClicked:function(t){var e=$(t.currentTarget).parent();this._selectedItem=this.store.findWhere({id:e.attr("id")}),this._selectedItem&&($(".selected",$(this.el)).removeClass("selected"),e.addClass("selected"),this.updateFormControl(this._selectedItem),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),t),t.preventDefault())},updateFormControl:function(t){var e=$(this.el).find(".form-control > div");if(-1!=t.get("value")){var i="";_.each(t.get("data").iconSet,function(e){i+='<img src="'+t.get("data").icons.at(e-1).get("icon")+'" style="width:16px;height:16px;margin-right: 5px;">'}),e[0].innerHTML=i,e.css({"margin-top":"0"})}else e[0].innerHTML=t.get("displayValue"),e.css({"margin-top":"1px"})},setValue:function(t){var e;if(this._selectedItem=this.store.findWhere((e={},e[this.valueField]=t,e)),$(".selected",$(this.el)).removeClass("selected"),this._selectedItem)this.updateFormControl(this._selectedItem),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected");else{var i=$(this.el).find(".form-control > div");i[0].innerHTML=t,i.css({"margin-top":"1px"})}},onResetItems:function(){this.itemsTemplate?$(this.el).find("ul").html($(this.itemsTemplate({items:this.store.toJSON(),scope:this}))):$(this.el).find("ul").html(_.template(["<% _.each(items, function(item) { %>","<% if (item.value==-1) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>',"<% } else { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>">','<a tabindex="-1" type="menuitem" style="padding: 5px;">',"<% _.each(item.data.iconSet, function(icon) { %>",'<img src="<%= item.data.icons.at(icon-1).get(\'icon\') %>" style="width:16px;height:16px;margin-right: 5px;">',"<% }) %>","</a>","</li>","<% } %>","<% }); %>"].join(""))({items:this.store.toJSON(),scope:this})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.scroller=new Common.UI.Scroller(_.extend({el:$(".dropdown-menu",this.cmpEl),minScrollbarLength:40,includePadding:!0,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible},this.options.scroller))}},Common.UI.ComboBoxIcons||{}))}),define("documenteditor/main/app/view/TableFormulaDialog",["common/main/lib/component/InputField","common/main/lib/component/Window"],function(){"use strict";DE.Views.TableFormulaDialog=Common.UI.Window.extend(_.extend({options:{width:300,style:"min-width: 230px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box" style="height: 150px;">','<div class="input-row">',"<label>"+this.textFormula+"</label>","</div>",'<div id="id-dlg-formula-formula" class="input-row" style="margin-bottom: 5px;"></div>','<div class="input-row">',"<label>"+this.textFormat+"</label>","</div>",'<div id="id-dlg-formula-format" class="input-row" style="margin-bottom: 20px;"></div>','<div class="input-row">','<div id="id-dlg-formula-function" style="display: inline-block; width: 50%; padding-right: 10px; float: left;"></div>','<div id="id-dlg-formula-bookmark" style="display: inline-block; width: 50%;"></div>',"</div>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.bookmarks=this.options.bookmarks,this.api=this.options.api,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this,e=this.getChild();this.inputFormula=new Common.UI.InputField({el:$("#id-dlg-formula-formula"),allowBlank:!0,validateOnChange:!0,style:"width: 100%;"}).on("changing",_.bind(this.checkFormulaInput,this)),this.cmbFormat=new Common.UI.ComboBox({el:$("#id-dlg-formula-format"),cls:"input-group-nr",menuStyle:"min-width: 100%; max-height: 200px;",takeFocusOnClose:!0}),this.cmbFunction=new Common.UI.ComboBox({el:$("#id-dlg-formula-function"),cls:"input-group-nr",menuStyle:"min-width: 100%; max-height: 150px;",editable:!1,takeFocusOnClose:!0,scrollAlwaysVisible:!0,data:[{displayValue:"ABS",value:1},{displayValue:"AND",value:1},{displayValue:"AVERAGE",value:1},{displayValue:"COUNT",value:1},{displayValue:"DEFINED",value:1},{displayValue:"FALSE",value:0},{displayValue:"IF",value:1},{displayValue:"INT",value:1},{displayValue:"MAX",value:1},{displayValue:"MIN",value:1},{displayValue:"MOD",value:1},{displayValue:"NOT",value:1},{displayValue:"OR",value:1},{displayValue:"PRODUCT",value:1},{displayValue:"ROUND",value:1},{displayValue:"SIGN",value:1},{displayValue:"SUM",value:1},{displayValue:"TRUE",value:0}]}),this.cmbFunction.on("selected",_.bind(function(e,i){e.setValue(this.textInsertFunction);var n=t.inputFormula._input,o=n[0].selectionEnd;n.val(n.val().substring(0,o)+i.displayValue+(i.value?"()":"")+n.val().substring(o)),n.focus(),n[0].selectionStart=n[0].selectionEnd=o+i.displayValue.length+i.value,this.btnOk.setDisabled(!1)},this)),this.cmbFunction.setValue(this.textInsertFunction),this.cmbBookmark=new Common.UI.ComboBox({el:$("#id-dlg-formula-bookmark"),cls:"input-group-nr",menuStyle:"min-width: 100%; max-height: 150px;",editable:!1,takeFocusOnClose:!0}),this.cmbBookmark.on("selected",_.bind(function(e,i){e.setValue(this.textBookmark);var n=t.inputFormula._input,o=n[0].selectionEnd;n.val(n.val().substring(0,o)+i.displayValue+n.val().substring(o)),n.focus(),n[0].selectionStart=n[0].selectionEnd=o+i.displayValue.length,this.btnOk.setDisabled(!1)},this)),this.cmbBookmark.setValue(this.textBookmark),t.btnOk=new Common.UI.Button({el:e.find(".primary")}),e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.afterRender()},getFocusedComponents:function(){return[this.inputFormula,this.cmbFormat,this.cmbFunction,this.cmbBookmark]},getDefaultFocusableComponent:function(){return this.inputFormula},onSelectItem:function(t,e,i,n){this.btnOk.setDisabled(0==i.get("level")&&i.get("index")>0)},afterRender:function(){this.refreshBookmarks(),this._setDefaults()},_setDefaults:function(){var t=[];_.each(this.api.asc_GetTableFormulaFormats(),function(e){t.push({value:e,displayValue:e})}),this.cmbFormat.setData(t);var e=this.api.asc_ParseTableFormulaInstrLine(this.api.asc_GetTableFormula());this.inputFormula.setValue(e[0]),this.cmbFormat.setValue(e[1]),this.checkFormulaInput(this.inputFormula,this.inputFormula.getValue())},refreshBookmarks:function(){var t=[];if(this.bookmarks){for(var e=this.bookmarks.asc_GetCount(),i=0;i<e;i++){var n=this.bookmarks.asc_GetName(i);this.bookmarks.asc_IsInternalUseBookmark(n)||t.push({value:i,displayValue:n})}this.cmbBookmark.setData(t),this.cmbBookmark.setValue(this.textBookmark)}this.cmbBookmark.setDisabled(t.length<1)},checkFormulaInput:function(t,e){var i=e.trim();this.btnOk.setDisabled(""==i||"="==i)},getSettings:function(){return this.api.asc_CreateInstructionLine(this.inputFormula.getValue(),this.cmbFormat.getValue())},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(t){return this._handleInput("ok"),!1},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,t,this.getSettings()),this.close()},textFormula:"Formula",textFormat:"Number Format",textBookmark:"Paste Bookmark",textInsertFunction:"Paste Function",textTitle:"Formula Settings"},DE.Views.TableFormulaDialog||{}))}),define("documenteditor/main/app/view/TableToTextDialog",["common/main/lib/component/Window","common/main/lib/component/CheckBox","common/main/lib/component/RadioBox"],function(){"use strict";DE.Views.TableToTextDialog=Common.UI.Window.extend(_.extend({options:{width:300,height:254,header:!0,style:"min-width: 240px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box">','<div style="margin-bottom: 8px;"><label style="font-weight: bold;">'+this.textSeparator+"</label></div>",'<div id="id-table-text-radio-para" style="margin-bottom: 8px;"></div>','<div id="id-table-text-radio-tabs" style="margin-bottom: 8px;"></div>','<div id="id-table-text-radio-semi" style="margin-bottom: 5px;"></div>','<div style="margin-bottom: 24px;">','<div id="id-table-text-radio-other" style="display: inline-block;vertical-align: middle;margin-right: 10px;"></div>','<div id="id-table-text-txt-other" style="display: inline-block;vertical-align: middle;"></div>',"</div>",'<div id="id-table-text-check-nested"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this.getChild();this.rbPara=new Common.UI.RadioBox({el:t.find("#id-table-text-radio-para"),labelText:this.textPara,name:"asc-radio-table-text-separator",value:1}).on("change",_.bind(this.onRadioSeparatorChange,this)),this.rbTabs=new Common.UI.RadioBox({el:t.find("#id-table-text-radio-tabs"),labelText:this.textTab,name:"asc-radio-table-text-separator",value:2,checked:!0}).on("change",_.bind(this.onRadioSeparatorChange,this)),this.rbSemi=new Common.UI.RadioBox({el:t.find("#id-table-text-radio-semi"),labelText:this.textSemicolon,name:"asc-radio-table-text-separator",value:";"}).on("change",_.bind(this.onRadioSeparatorChange,this)),this.rbOther=new Common.UI.RadioBox({el:t.find("#id-table-text-radio-other"),labelText:this.textOther,name:"asc-radio-table-text-separator",value:3}).on("change",_.bind(this.onRadioSeparatorChange,this)),this.inputOther=new Common.UI.InputField({el:t.find("#id-table-text-txt-other"),style:"width: 30px;",maxLength:1,validateOnChange:!0,validateOnBlur:!1,value:"-",disabled:!0}),this.chNested=new Common.UI.CheckBox({el:t.find("#id-table-text-check-nested"),labelText:this.textNested,value:!0,disabled:!0}),this.getChild().find(".dlg-btn").on("click",_.bind(this.onBtnClick,this))},getFocusedComponents:function(){return[this.rbPara,this.rbTabs,this.rbSemi,this.rbOther,this.inputOther,this.chNested]},getDefaultFocusableComponent:function(){return this.rbTabs},setSettings:function(t){},_handleInput:function(t){if(this.options.handler){if("ok"==t&&!this.isRangeValid())return;this.options.handler.call(this,this,t)}this.close()},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(){return this._handleInput("ok"),!1},getSettings:function(){return{type:this.rbPara.getValue()?1:this.rbTabs.getValue()?2:3,separator:this.rbSemi.getValue()?";".charCodeAt(0):this.rbOther.getValue()?this.inputOther.getValue().charCodeAt(0):void 0,nested:"checked"===this.chNested.getValue()}},onRadioSeparatorChange:function(t,e,i){var n=t.options.value,o=this;e&&(this.inputOther.setDisabled(3!==n),3==n&&setTimeout(function(){o.inputOther.focus()},1),1!==n&&this.chNested.setValue(!0),this.chNested.setDisabled(1!==n))},isRangeValid:function(){if(this.rbOther.getValue()&&""==this.inputOther.getValue()){var t=this;return Common.UI.warning({msg:this.textEmpty,maxwidth:600,callback:function(e){t.inputOther.focus()}}),!1}return!0},textTitle:"Convert Table to Text",textSeparator:"Separate text with",textPara:"Paragraph marks",textTab:"Tabs",textSemicolon:"Semicolons",textOther:"Other",textNested:"Convert nested tables",textEmpty:"You must type a character for the custom separator."},DE.Views.TableToTextDialog||{}))}),define("documenteditor/main/app/view/TableSettings",["text!documenteditor/main/app/template/TableSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/CheckBox","common/main/lib/component/ThemeColorPalette","common/main/lib/component/ColorButton","common/main/lib/component/ComboBorderSize","common/main/lib/component/ComboDataView","common/main/lib/view/InsertTableDialog","documenteditor/main/app/view/TableSettingsAdvanced","documenteditor/main/app/view/TableFormulaDialog","documenteditor/main/app/view/TableToTextDialog"],function(t,e,i,n){"use strict";DE.Views.TableSettings=n.View.extend(i.extend({el:"#id-table-settings",template:i.template(t),events:{},options:{alias:"TableSettings"},initialize:function(){this._initSettings=!0,this._state={TemplateId:0,CheckHeader:!1,CheckTotal:!1,CheckBanded:!1,CheckFirst:!1,CheckLast:!1,CheckColBanded:!1,BackColor:"#000000",RepeatRow:!1,DisabledControls:!1,Width:null,Height:null},this.spinners=[],this.lockedControls=[],this._locked=!1,this._originalLook=new Asc.CTablePropLook,this._originalProps=null,this.CellBorders={},this.CellColor={Value:1,Color:"transparent"},this.BorderSize=1,this._noApply=!1,this.render()},onCheckTemplateChange:function(t,e,i,n,o){if(this.api){var s=new Asc.CTableProp,a=this._originalLook?this._originalLook:new Asc.CTablePropLook;switch(t){case 0:a.put_FirstRow("checked"==e.getValue());break;case 1:a.put_LastRow("checked"==e.getValue());break;case 2:a.put_BandHor("checked"==e.getValue());break;case 3:a.put_FirstCol("checked"==e.getValue());break;case 4:a.put_LastCol("checked"==e.getValue());break;case 5:a.put_BandVer("checked"==e.getValue())}s.put_TableLook(a),this.api.tblApply(s)}this.fireEvent("editcomplete",this)},onTableTemplateSelect:function(t,e,i,n){if(this.api&&!this._noApply){var o=new Asc.CTableProp;o.put_TableStyle(n.get("templateId")),this.api.tblApply(o)}this.fireEvent("editcomplete",this)},onCheckRepeatRowChange:function(t,e,i,n){if(this.api){var o=new Asc.CTableProp;o.put_RowsInHeader("checked"==t.getValue()),this.api.tblApply(o)}this.fireEvent("editcomplete",this)},onColorsBackSelect:function(t,e){if(this.CellColor={Value:1,Color:e},this.api){var i=new Asc.CTableProp,n=new Asc.CBackground;i.put_CellsBackground(n),"transparent"==this.CellColor.Color?n.put_Value(1):(n.put_Value(0),n.put_Color(Common.Utils.ThemeColor.getRgbColor(this.CellColor.Color))),i.put_CellSelect(!0),this.api.tblApply(i)}this.fireEvent("editcomplete",this)},onBtnBordersClick:function(t,e){if(this._UpdateBordersStyle(t.options.strId,!0),this.api){var i=new Asc.CTableProp;i.put_CellBorders(this.CellBorders),i.put_CellSelect(!0),this.api.tblApply(i)}this.fireEvent("editcomplete",this)},onBorderSizeSelect:function(t,e){this.BorderSize=e.value},onEditClick:function(t,e,i){if(this.api)switch(e.value){case 0:this.api.selectRow();break;case 1:this.api.selectColumn();break;case 2:this.api.selectCell();break;case 3:this.api.selectTable();break;case 4:this.api.addRowAbove();break;case 5:this.api.addRowBelow();break;case 6:this.api.addColumnLeft();break;case 7:this.api.addColumnRight();break;case 8:this.api.remRow();break;case 9:this.api.remColumn();break;case 10:this.api.remTable();break;case 11:this.api.MergeCells();break;case 12:this.splitCells(t,e,i)}this.fireEvent("editcomplete",this)},splitCells:function(t,e,i){var n=this;new Common.Views.InsertTableDialog({split:!0,handler:function(t,e){"ok"==t&&n.api&&n.api.SplitCell(e.columns,e.rows),n.fireEvent("editcomplete",n)}}).show()},render:function(){(this.$el||e(this.el)).html(this.template({scope:this}))},setApi:function(t){return this.api=t,t&&this.api.asc_registerCallback("asc_onInitTableTemplates",i.bind(this._onInitTemplates,this)),this},createDelayedControls:function(){var t=this;this.chHeader=new Common.UI.CheckBox({el:e("#table-checkbox-header"),labelText:this.textHeader}),this.lockedControls.push(this.chHeader),this.chTotal=new Common.UI.CheckBox({el:e("#table-checkbox-total"),labelText:this.textTotal}),this.lockedControls.push(this.chTotal),this.chBanded=new Common.UI.CheckBox({el:e("#table-checkbox-banded"),labelText:this.textBanded}),this.lockedControls.push(this.chBanded),this.chFirst=new Common.UI.CheckBox({el:e("#table-checkbox-first"),labelText:this.textFirst}),this.lockedControls.push(this.chFirst),this.chLast=new Common.UI.CheckBox({el:e("#table-checkbox-last"),labelText:this.textLast}),this.lockedControls.push(this.chLast),this.chColBanded=new Common.UI.CheckBox({el:e("#table-checkbox-col-banded"),labelText:this.textBanded}),this.lockedControls.push(this.chColBanded),this.chHeader.on("change",i.bind(this.onCheckTemplateChange,this,0)),this.chTotal.on("change",i.bind(this.onCheckTemplateChange,this,1)),this.chBanded.on("change",i.bind(this.onCheckTemplateChange,this,2)),this.chFirst.on("change",i.bind(this.onCheckTemplateChange,this,3)),this.chLast.on("change",i.bind(this.onCheckTemplateChange,this,4)),this.chColBanded.on("change",i.bind(this.onCheckTemplateChange,this,5));var n=[["l","toolbar__icon btn-border-left","table-button-border-left",this.tipLeft],["c","toolbar__icon btn-border-insidevert","table-button-border-inner-vert",this.tipInnerVert],["r","toolbar__icon btn-border-right","table-button-border-right",this.tipRight],["t","toolbar__icon btn-border-top","table-button-border-top",this.tipTop],["m","toolbar__icon btn-border-insidehor","table-button-border-inner-hor",this.tipInnerHor],["b","toolbar__icon btn-border-bottom","table-button-border-bottom",this.tipBottom],["cm","toolbar__icon btn-border-inside","table-button-border-inner",this.tipInner],["lrtb","toolbar__icon btn-border-out","table-button-border-outer",this.tipOuter],["lrtbcm","toolbar__icon btn-border-all","table-button-border-all",this.tipAll],["","toolbar__icon btn-border-no","table-button-border-none",this.tipNone]];this._btnsBorderPosition=[],i.each(n,function(t,n,o){var s=new Common.UI.Button({parentEl:e("#"+t[2]),cls:"btn-toolbar borders--small",iconCls:t[1],strId:t[0],hint:t[3]});s.on("click",i.bind(this.onBtnBordersClick,this)),this._btnsBorderPosition.push(s),this.lockedControls.push(s)},this),this.cmbBorderSize=new Common.UI.ComboBorderSize({el:e("#table-combo-border-size"),style:"width: 93px;"}),this.BorderSize=this.cmbBorderSize.store.at(1).get("value"),this.cmbBorderSize.setValue(this.BorderSize),this.cmbBorderSize.on("selected",i.bind(this.onBorderSizeSelect,this)),this.lockedControls.push(this.cmbBorderSize),this.btnEdit=new Common.UI.Button({parentEl:e("#table-btn-edit"),cls:"btn-icon-default",iconCls:"btn-edit-table",menu:new Common.UI.Menu({menuAlign:"tr-br",items:[{caption:this.selectRowText,value:0},{caption:this.selectColumnText,value:1},{caption:this.selectCellText,value:2},{caption:this.selectTableText,value:3},{caption:"--"},{caption:this.insertRowAboveText,value:4},{caption:this.insertRowBelowText,value:5},{caption:this.insertColumnLeftText,value:6},{caption:this.insertColumnRightText,value:7},{caption:"--"},{caption:this.deleteRowText,value:8},{caption:this.deleteColumnText,value:9},{caption:this.deleteTableText,value:10},{caption:"--"},{caption:this.mergeCellsText,value:11},{caption:this.splitCellsText,value:12}]})}),this.mnuMerge=this.btnEdit.menu.items[this.btnEdit.menu.items.length-2],this.mnuSplit=this.btnEdit.menu.items[this.btnEdit.menu.items.length-1],this.btnEdit.menu.on("show:after",i.bind(function(){this.api&&(this.mnuMerge.setDisabled(!this.api.CheckBeforeMergeCells()),this.mnuSplit.setDisabled(!this.api.CheckBeforeSplitCells()))},this)),this.btnEdit.menu.on("item:click",i.bind(this.onEditClick,this)),this.lockedControls.push(this.btnEdit),this.chRepeatRow=new Common.UI.CheckBox({el:e("#table-checkbox-repeat-row"),labelText:this.strRepeatRow}),this.chRepeatRow.on("change",i.bind(this.onCheckRepeatRowChange,this)),this.lockedControls.push(this.chRepeatRow),this.numHeight=new Common.UI.MetricSpinner({el:e("#table-spin-cell-height"),step:.1,width:90,defaultUnit:"cm",value:"1 cm",maxValue:55.88,minValue:0}),this.numHeight.on("change",i.bind(function(t,e,i,n){var o=new Asc.CTableProp;o.put_RowHeight(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api.tblApply(o)},this)),this.numHeight.on("inputleave",function(){t.fireEvent("editcomplete",t)}),this.lockedControls.push(this.numHeight),this.spinners.push(this.numHeight),this.numWidth=new Common.UI.MetricSpinner({el:e("#table-spin-cell-width"),step:.1,width:90,defaultUnit:"cm",value:"1 cm",maxValue:55.88,minValue:0}),this.numWidth.on("change",i.bind(function(t,e,i,n){var o=new Asc.CTableProp;o.put_ColumnWidth(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api.tblApply(o)},this)),this.numWidth.on("inputleave",function(){t.fireEvent("editcomplete",t)}),this.lockedControls.push(this.numWidth),this.spinners.push(this.numWidth),this.btnDistributeRows=new Common.UI.Button({parentEl:e("#table-btn-distrub-rows",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon distribute-rows",hint:this.textDistributeRows}),this.lockedControls.push(this.btnDistributeRows),this.btnDistributeRows.on("click",i.bind(function(t){this.api.asc_DistributeTableCells(!1)},this)),this.btnDistributeCols=new Common.UI.Button({parentEl:e("#table-btn-distrub-cols",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon distribute-columns",hint:this.textDistributeCols}),this.lockedControls.push(this.btnDistributeCols),this.btnDistributeCols.on("click",i.bind(function(t){this.api.asc_DistributeTableCells(!0)},this)),this.btnAddFormula=new Common.UI.Button({el:e("#table-btn-add-formula")}),this.lockedControls.push(this.btnAddFormula),this.btnAddFormula.on("click",i.bind(this.onAddFormula,this)),this.btnConvert=new Common.UI.Button({parentEl:e("#table-btn-convert-to-text"),cls:"btn-toolbar",iconCls:"toolbar__icon table-to-text",caption:this.textConvert,style:"width: 100%;text-align: left;"}),this.btnConvert.on("click",i.bind(this.onConvertTable,this)),this.lockedControls.push(this.btnConvert),this.linkAdvanced=e("#table-advanced-link"),e(this.el).on("click","#table-advanced-link",i.bind(this.openAdvancedSettings,this))},createDelayedElements:function(){this._initSettings=!1,this.createDelayedControls(),this.UpdateThemeColors(),this.updateMetricUnit()},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedElements(),this.disableControls(this._locked),t){this._originalProps=new Asc.CTableProp(t),this._originalProps.put_CellSelect(!0);var e=t.get_ColumnWidth();if(((void 0===this._state.Width||void 0===e)&&this._state.Width!==e||Math.abs(this._state.Width-e)>.001)&&(this.numWidth.setValue(null!==e&&void 0!==e?Common.Utils.Metric.fnRecalcFromMM(e):"",!0),this._state.Width=e),e=t.get_RowHeight(),((void 0===this._state.Height||void 0===e)&&this._state.Height!==e||Math.abs(this._state.Height-e)>.001)&&(this.numHeight.setValue(null!==e&&void 0!==e?Common.Utils.Metric.fnRecalcFromMM(e):"",!0),this._state.Height=e),e=t.get_TableStyle(),this._state.TemplateId!==e||this._isTemplatesChanged){var i=this.mnuTableTemplatePicker.store.findWhere({templateId:e});i||(i=this.mnuTableTemplatePicker.store.at(0)),this.btnTableTemplate.suspendEvents(),this.mnuTableTemplatePicker.selectRecord(i,!0),this.btnTableTemplate.resumeEvents(),this.$el.find(".icon-template-table").css({"background-image":"url("+i.get("imageUrl")+")",height:"52px",width:"72px","background-position":"center","background-size":"auto 52px"}),this._state.TemplateId=e}this._isTemplatesChanged=!1;var n=t.get_TableLook();n&&(e=n.get_FirstRow(),this._state.CheckHeader!==e&&(this.chHeader.setValue(e,!0),this._state.CheckHeader=e,this._originalLook.put_FirstRow(e)),e=n.get_LastRow(),this._state.CheckTotal!==e&&(this.chTotal.setValue(e,!0),this._state.CheckTotal=e,this._originalLook.put_LastRow(e)),e=n.get_BandHor(),this._state.CheckBanded!==e&&(this.chBanded.setValue(e,!0),this._state.CheckBanded=e,this._originalLook.put_BandHor(e)),e=n.get_FirstCol(),this._state.CheckFirst!==e&&(this.chFirst.setValue(e,!0),this._state.CheckFirst=e,this._originalLook.put_FirstCol(e)),e=n.get_LastCol(),this._state.CheckLast!==e&&(this.chLast.setValue(e,!0),this._state.CheckLast=e,this._originalLook.put_LastCol(e)),e=n.get_BandVer(),this._state.CheckColBanded!==e&&(this.chColBanded.setValue(e,!0),this._state.CheckColBanded=e,this._originalLook.put_BandVer(e)));var o=t.get_CellsBackground();if(o)if(0==o.get_Value()){var s=o.get_Color();s?s.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.CellColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(s.get_r(),s.get_g(),s.get_b()),effectValue:s.get_value()}}:this.CellColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(s.get_r(),s.get_g(),s.get_b())}:this.CellColor={Value:1,Color:"transparent"}}else this.CellColor={Value:1,Color:"transparent"};else this.CellColor={Value:0,Color:"transparent"};var a=typeof this.CellColor.Color;if(a!==typeof this._state.BackColor||"object"==a&&(this.CellColor.Color.effectValue!==this._state.BackColor.effectValue||this._state.BackColor.color.indexOf(this.CellColor.Color.color)<0)||"object"!=a&&this._state.BackColor.indexOf(this.CellColor.Color)<0){if(this.btnBackColor.setColor(this.CellColor.Color),"object"==typeof this.CellColor.Color){for(var r=!1,l=0;l<10;l++)if(Common.Utils.ThemeColor.ThemeValues[l]==this.CellColor.Color.effectValue){this.colorsBack.select(this.CellColor.Color,!0),r=!0;break}r||this.colorsBack.clearSelection()}else this.colorsBack.select(this.CellColor.Color,!0);this._state.BackColor=this.CellColor.Color}e=t.get_RowsInHeader(),this._state.RepeatRow!==e&&(this.chRepeatRow.setValue(!!e,!0),this.chRepeatRow.setDisabled(null===e),this._state.RepeatRow=e)}},updateMetricUnit:function(){if(this.spinners){for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}var i=this._state.Width;this.numWidth&&this.numWidth.setValue(null!==i&&void 0!==i?Common.Utils.Metric.fnRecalcFromMM(i):"",!0),i=this._state.Height,this.numHeight&&this.numHeight.setValue(null!==i&&void 0!==i?Common.Utils.Metric.fnRecalcFromMM(i):"",!0)}},_UpdateBordersStyle:function(t){this.CellBorders=new Asc.CBorders;var e=this.CellBorders,i=""!=t;(t.indexOf("l")>-1||!i)&&(null!==e.get_Left()&&void 0!==e.get_Left()||e.put_Left(new Asc.asc_CTextBorder),this._UpdateBorderStyle(e.get_Left(),i)),(t.indexOf("t")>-1||!i)&&(null!==e.get_Top()&&void 0!==e.get_Top()||e.put_Top(new Asc.asc_CTextBorder),this._UpdateBorderStyle(e.get_Top(),i)),(t.indexOf("r")>-1||!i)&&(null!==e.get_Right()&&void 0!==e.get_Right()||e.put_Right(new Asc.asc_CTextBorder),this._UpdateBorderStyle(e.get_Right(),i)),(t.indexOf("b")>-1||!i)&&(null!==e.get_Bottom()&&void 0!==e.get_Bottom()||e.put_Bottom(new Asc.asc_CTextBorder),this._UpdateBorderStyle(e.get_Bottom(),i)),(t.indexOf("c")>-1||!i)&&(null!==e.get_InsideV()&&void 0!==e.get_InsideV()||e.put_InsideV(new Asc.asc_CTextBorder),this._UpdateBorderStyle(e.get_InsideV(),i)),(t.indexOf("m")>-1||!i)&&(null!==e.get_InsideH()&&void 0!==e.get_InsideH()||e.put_InsideH(new Asc.asc_CTextBorder),this._UpdateBorderStyle(e.get_InsideH(),i))},_UpdateBorderStyle:function(t,e){if(null==t&&(t=new Asc.asc_CTextBorder),e&&this.BorderSize>0){var i=parseFloat(this.BorderSize);t.put_Value(1),t.put_Size(25.4*i/72);var n;this.btnBorderColor.isAutoColor()?(n=new Asc.asc_CColor,n.put_auto(!0)):n=Common.Utils.ThemeColor.getRgbColor(this.btnBorderColor.color),t.put_Color(n)}else t.put_Value(0)},UpdateThemeColors:function(){this._initSettings||(this.btnBackColor||(this.btnBorderColor=new Common.UI.ColorButton({parentEl:e("#table-border-color-btn"),color:"auto",auto:!0}),this.lockedControls.push(this.btnBorderColor),this.borderColor=this.btnBorderColor.getPicker(),this.btnBackColor=new Common.UI.ColorButton({parentEl:e("#table-back-color-btn"),transparent:!0}),this.lockedControls.push(this.btnBackColor),this.colorsBack=this.btnBackColor.getPicker(),this.btnBackColor.on("color:select",i.bind(this.onColorsBackSelect,this))),this.colorsBack.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.borderColor.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),!this.btnBorderColor.isAutoColor()&&this.btnBorderColor.setColor(this.borderColor.getColor()))},_onInitTemplates:function(t){var n=this;this._isTemplatesChanged=!0,this.btnTableTemplate||(this.btnTableTemplate=new Common.UI.Button({cls:"btn-large-dataview template-table",iconCls:"icon-template-table",menu:new Common.UI.Menu({style:"width: 588px;",items:[{template:i.template('<div id="id-table-menu-template" class="menu-table-template"  style="margin: 5px 5px 5px 10px;"></div>')}]})}),this.btnTableTemplate.on("render:after",function(t){n.mnuTableTemplatePicker=new Common.UI.DataView({el:e("#id-table-menu-template"),parentMenu:t.menu,restoreHeight:350,groups:new Common.UI.DataViewGroupStore,store:new Common.UI.DataViewStore,itemTemplate:i.template('<div id="<%= id %>" class="item"><img src="<%= imageUrl %>" height="52" width="72"></div>'),style:"max-height: 350px;"})}),this.btnTableTemplate.render(e("#table-btn-template")),this.lockedControls.push(this.btnTableTemplate),this.mnuTableTemplatePicker.on("item:click",i.bind(this.onTableTemplateSelect,this,this.btnTableTemplate)));var o=n.mnuTableTemplatePicker.store.length;if(o>0&&o==t.length){var s=n.mnuTableTemplatePicker.dataViewItems;s&&i.each(t,function(t,i){var n=t.asc_getImage();s[i].model.set("imageUrl",n,{silent:!0}),e(s[i].el).find("img").attr("src",n)})}else{var a=[];i.each(t,function(t){var e=t.asc_getDisplayName();0==t.asc_getType()&&["Table Grid","Plain Table","Grid Table","List Table","Light","Dark","Colorful","Accent"].forEach(function(t){var i="txtTable_"+t.replace(" ","");n[i]&&(e=e.replace(t,n[i]))}),a.push({imageUrl:t.asc_getImage(),id:Common.UI.getId(),templateId:t.asc_getId(),tip:e})}),n.mnuTableTemplatePicker.store.reset(a)}},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;if(e.api&&!this._locked){var i=e.api.getSelectedElements();if(i&&i.length>0)for(var n,o,s=i.length-1;s>=0;s--)if(n=i[s].get_ObjectType(),o=i[s].get_ObjectValue(),Asc.c_oAscTypeSelectElement.Table==n){new DE.Views.TableSettingsAdvanced({tableStylerRows:null===o.get_CellBorders().get_InsideH()&&1==o.get_CellSelect()?1:2,tableStylerColumns:null===o.get_CellBorders().get_InsideV()&&1==o.get_CellSelect()?1:2,tableProps:o,borderProps:e.borderAdvancedProps,sectionProps:e.api.asc_GetSectionProps(),handler:function(t,i){"ok"==t&&e.api&&(e.borderAdvancedProps=i.borderProps,e.api.tblApply(i.tableProps)),e.fireEvent("editcomplete",e)}}).show();break}}}},onAddFormula:function(t){var e=this;e.api&&!this._locked&&new DE.Views.TableFormulaDialog({api:e.api,bookmarks:e.api.asc_GetBookmarksManager(),handler:function(t,i){"ok"==t&&e.api&&e.api.asc_AddTableFormula(i),e.fireEvent("editcomplete",e)}}).show()},onConvertTable:function(t){var e=this;e.api&&!this._locked&&new DE.Views.TableToTextDialog({handler:function(t,i){if("ok"==i){var n=t.getSettings();e.api.asc_ConvertTableToText(n.type,n.separator,n.nested)}e.fireEvent("editcomplete",e)}}).show()},setLocked:function(t){this._locked=t},disableControls:function(t){this._initSettings||this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,function(e){e.setDisabled(t)}),this.linkAdvanced.toggleClass("disabled",t))},textBorders:"Border's Style",textBorderColor:"Color",textBackColor:"Background color",
textEdit:"Rows & Columns",selectRowText:"Select Row",selectColumnText:"Select Column",selectCellText:"Select Cell",selectTableText:"Select Table",insertRowAboveText:"Insert Row Above",insertRowBelowText:"Insert Row Below",insertColumnLeftText:"Insert Column Left",insertColumnRightText:"Insert Column Right",deleteRowText:"Delete Row",deleteColumnText:"Delete Column",deleteTableText:"Delete Table",mergeCellsText:"Merge Cells",splitCellsText:"Split Cell...",splitCellTitleText:"Split Cell",textSelectBorders:"Select borders that you want to change",textAdvanced:"Show advanced settings",txtNoBorders:"No borders",textTemplate:"Select From Template",textRows:"Rows",textColumns:"Columns",textHeader:"Header",textTotal:"Total",textBanded:"Banded",textFirst:"First",textLast:"Last",textEmptyTemplate:"No templates",strRepeatRow:"Repeat as header row at the top of each page",tipTop:"Set Outer Top Border Only",tipLeft:"Set Outer Left Border Only",tipBottom:"Set Outer Bottom Border Only",tipRight:"Set Outer Right Border Only",tipAll:"Set Outer Border and All Inner Lines",tipNone:"Set No Borders",tipInner:"Set Inner Lines Only",tipInnerVert:"Set Vertical Inner Lines Only",tipInnerHor:"Set Horizontal Inner Lines Only",tipOuter:"Set Outer Border Only",textCellSize:"Rows & Columns Size",textHeight:"Height",textWidth:"Width",textDistributeRows:"Distribute rows",textDistributeCols:"Distribute columns",textAddFormula:"Add formula",txtTable_TableGrid:"Table Grid",txtTable_PlainTable:"Plain Table",txtTable_GridTable:"Grid Table",txtTable_ListTable:"List Table",txtTable_Light:"Light",txtTable_Dark:"Dark",txtTable_Colorful:"Colorful",txtTable_Accent:"Accent",textConvert:"Convert Table to Text"},DE.Views.TableSettings||{}))}),define("text!documenteditor/main/app/template/ShapeSettings.template",[],function(){return'<table cols="1">\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.strFill %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="shape-combo-fill-src" style="width: 100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <div id="shape-panel-color-fill" class="padding-small" style="width: 100%;">\r\n                <div id="shape-back-color-btn" style=""></div>\r\n            </div>\r\n            <div id="shape-panel-image-fill" class="settings-hidden padding-small" style="width: 100%;">\r\n                <table cols="2" style="width: 100%;">\r\n                <tr>\r\n                    <td colspan="2" class="padding-small">\r\n                        <div id="shape-button-replace" style="width:100%;"></div>\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <td style="vertical-align: top">\r\n                        <div id="shape-combo-fill-type" style="width: 90px;"></div>\r\n                    </td>\r\n                    <td rowspan="2">\r\n                        <div style="width: 90px; height: 80px; padding: 14px 20px; border: 1px solid #AFAFAF; border-radius: 2px; background: #ffffff;float:right;">\r\n                            <div id="shape-texture-img" style="width: 50px;height: 50px;"></div>\r\n                        </div>\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <td style="vertical-align: bottom">\r\n                        <label class="input-label" style=""><%= scope.textTexture %></label>\r\n                        <div id="shape-combo-fill-texture" style="width: 90px;"></div>\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n            </div>\r\n            <div id="shape-panel-pattern-fill" class="settings-hidden padding-small" style="width: 100%;">\r\n                <label class="input-label" style="margin-top: 3px;"><%= scope.strPattern %></label>\r\n                <div id="shape-combo-pattern" style="width: 100%; height: 42px; margin-bottom: 8px;"></div>\r\n                <div style="width: 100%; height: 25px; margin-bottom: 8px;">\r\n                    <label class="input-label" style="margin-top: 3px;"><%= scope.strForeground %></label>\r\n                    <div id="shape-foreground-color-btn" style="display: inline-block; float:right;"></div>\r\n                </div>\r\n                <div style="width: 100%; height: 25px;">\r\n                    <label class="input-label" style="margin-top: 3px;"><%= scope.strBackground %></label>\r\n                    <div id="shape-background-color-btn" style="display: inline-block; float:right;"></div>\r\n                </div>\r\n            </div>\r\n            <div id="shape-panel-gradient-fill" class="settings-hidden padding-small" style="width: 100%;">\r\n                <table cols="3" style="margin-bottom: 10px;">\r\n                    <tr valign="top">\r\n                        <td colspan="2">\r\n                            <div>\r\n                                <label class="input-label" style=""><%= scope.textStyle %></label>\r\n                                <div id="shape-combo-grad-type" style="width: 100%;"></div>\r\n                            </div>\r\n                        </td>\r\n                        <td rowspan="2" style="width: 100%;">\r\n                            <div style="float: right;">\r\n                                <label class="input-label"><%= scope.textDirection %></label>\r\n                                <div id="shape-button-direction"></div>\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                    <tr valign="bottom">\r\n                        <td>\r\n                            <label class="input-label" style="margin-right: 5px;margin-bottom: 3px;"><%= scope.textAngle %></label>\r\n                        </td>\r\n                        <td>\r\n                            <div id="shape-spin-gradient-angle" style="display: inline-block; width: 60px;"></div>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n                <label class="input-label" style="display:block;margin-bottom: 5px;"><%= scope.textGradient %></label>\r\n                <div style="display: inline-block; margin-top: 3px;">\r\n                    <div id="shape-slider-gradient" style="display: inline-block; vertical-align: middle;"></div>\r\n                </div>\r\n                <div style="height: 40px;margin-top:6px;display:flex;justify-content:space-between;">\r\n                    <div style="display: flex;">\r\n                    <div style="">\r\n                        <label class="input-label" style=""><%= scope.strColor %></label>\r\n                        <div id="shape-gradient-color-btn"></div>\r\n                    </div>\r\n                    <div style="margin-left: 10px;">\r\n                        <label class="input-label" style=""><%= scope.textPosition %></label>\r\n                        <div id="shape-gradient-position"></div>\r\n                    </div>\r\n                    </div>\r\n                    <div style="display:flex;padding-top:15px;">\r\n                        <div id="shape-gradient-add-step"></div>\r\n                        <div id="shape-gradient-remove-step"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <div class="padding-small" id="shape-panel-transparent-fill" style="width: 100%;">\r\n                <label class="header" style="display:block;"><%= scope.strTransparency %></label>\r\n                <div style="display: inline-block; margin-top: 3px;">\r\n                    <label id="shape-lbl-transparency-start">0</label>\r\n                    <div id="shape-slider-transparency" style="display: inline-block;margin: 0 4px; vertical-align: middle;"></div>\r\n                    <label id="shape-lbl-transparency-end">100</label>\r\n                </div>\r\n                <div id="shape-spin-transparency" style="display: inline-block;float: right;"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.strStroke %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n        <div style="display:inline-block;width:100px;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strSize %></label>\r\n            <div id="shape-combo-border-size" style="width: 93px;"></div>\r\n        </div>\r\n        <div style="display:inline-block;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strColor %></label>\r\n            <div id="shape-border-color-btn" style=""></div>\r\n        </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n        <div style="display:inline-block;width:100px;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strType %></label>\r\n            <div id="shape-combo-border-type" style="width: 93px;"></div>\r\n        </div>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-only">\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-only">\r\n        <td class="padding-small">\r\n            <label class="header"><%= scope.textRotation %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-only">\r\n        <td>\r\n            <table cols="2" style="width: 100%;">\r\n                <tr>\r\n                    <td class="padding-small" width="50%">\r\n                        <label class="input-label"><%= scope.textRotate90 %></label>\r\n                        <div>\r\n                            <div id="shape-button-270" style="display: inline-block;margin-right: 4px;"></div>\r\n                            <div id="shape-button-90" style="display: inline-block;"></div>\r\n                        </div>\r\n                    </td>\r\n                    <td class="padding-small" width="50%">\r\n                        <label class="input-label"><%= scope.textFlip %></label>\r\n                        <div>\r\n                            <div id="shape-button-fliph" style="display: inline-block;margin-right: 4px;"></div>\r\n                            <div id="shape-button-flipv" style="display: inline-block;"></div>\r\n                        </div>\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-only">\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-only">\r\n        <td class="padding-small">\r\n            <label class="header"><%= scope.textWrap %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-only">\r\n        <td>\r\n            <div id="shape-combo-wrap" style="width: 100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-only">\r\n        <td class="padding-small"></td>\r\n    </tr>\r\n    <tr class="change-type">\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="change-type">\r\n        <td class="padding-small">\r\n            <label class="header" style="margin-top: 3px;"><%= scope.strChange %></label>\r\n            <div id="shape-btn-change" style="display: inline-block; float:right;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div id="shape-checkbox-shadow"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-only">\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-only">\r\n        <td align="center">\r\n            <label class="link" id="shape-advanced-link"><%= scope.textAdvanced %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'}),void 0===Common)var Common={};if(define("common/main/lib/component/Slider",["common/main/lib/component/BaseView","underscore"],function(t,e){"use strict";Common.UI.SingleSlider=Common.UI.BaseView.extend({options:{width:100,minValue:0,maxValue:100,step:1,value:100,enableKeyEvents:!1},disabled:!1,template:e.template(['<div class="slider single-slider" style="">','<div class="track"></div>','<div class="thumb" style=""></div>',"<% if (this.options.enableKeyEvents) { %>",'<input type="text" style="position: absolute; top:-10px; width: 1px; height: 1px;">',"<% } %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.width=e.options.width,e.minValue=e.options.minValue,e.maxValue=e.options.maxValue,e.delta=100/(e.maxValue-e.minValue),e.step=e.options.step,e.options.el&&e.render(),this.setValue(e.options.value)},render:function(t){var i=this;i.rendered?this.cmpEl=i.$el:(this.cmpEl=$(this.template({})),t?(this.setElement(t,!1),t.html(this.cmpEl)):i.$el.html(this.cmpEl)),this.cmpEl.find(".track-center").width(i.options.width-14),this.cmpEl.width(i.options.width),this.thumb=this.cmpEl.find(".thumb");var n,o=function(t){t.preventDefault(),t.stopPropagation();var e=Math.max(0,Math.min(100,Math.round((t.pageX*Common.Utils.zoom()-i.cmpEl.offset().left-i._dragstart)/i.width*100)));i.setThumbPosition(e),i.lastValue=i.value,i.value=e/i.delta+i.minValue,i.thumb.removeClass("active"),$(document).off("mouseup",o),$(document).off("mousemove",s),i._dragstart=void 0,i.trigger("changecomplete",i,i.value,i.lastValue)},s=function(t){if(!i.disabled&&void 0!==i._dragstart){t.preventDefault(),t.stopPropagation();var e=Math.max(0,Math.min(100,Math.round((t.pageX*Common.Utils.zoom()-i.cmpEl.offset().left-i._dragstart)/i.width*100)));i.setThumbPosition(e),i.lastValue=i.value,i.value=e/i.delta+i.minValue,Math.abs(i.value-i.lastValue)>.001&&i.trigger("change",i,i.value,i.lastValue)}},a=function(t){i.disabled||(i._dragstart=t.pageX*Common.Utils.zoom()-i.thumb.offset().left-7,i.thumb.addClass("active"),$(document).on("mouseup",o),$(document).on("mousemove",s),i.options.enableKeyEvents&&setTimeout(function(){i.input.focus()},10))},r=function(t){if(!i.disabled){var e=Math.max(0,Math.min(100,Math.round((t.pageX*Common.Utils.zoom()-i.cmpEl.offset().left)/i.width*100)));i.setThumbPosition(e),i.lastValue=i.value,i.value=e/i.delta+i.minValue,i.trigger("change",i,i.value,i.lastValue),i.trigger("changecomplete",i,i.value,i.lastValue)}},l=function(t){i.lastValue=i.value,i.value=Math.max(i.minValue,Math.min(i.maxValue,i.value+(t?i.step:-i.step))),i.setThumbPosition(Math.round((i.value-i.minValue)*i.delta)),i.trigger("change",i,i.value,i.lastValue)},c=function(t){i.disabled||t.keyCode!=Common.UI.Keys.UP&&t.keyCode!=Common.UI.Keys.DOWN&&t.keyCode!=Common.UI.Keys.LEFT&&t.keyCode!=Common.UI.Keys.RIGHT||(t.preventDefault(),t.stopPropagation(),h.off("keydown","input",c),n=setInterval(e.bind(l,i,t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.RIGHT),100))},d=function(t){i.disabled||(t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN||Common.UI.Keys.LEFT||Common.UI.Keys.RIGHT)&&(t.stopPropagation(),t.preventDefault(),clearInterval(n),l(t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.RIGHT),h.on("keydown","input",c),i.trigger("changecomplete",i,i.value,i.lastValue))};if(!i.rendered){var h=i.cmpEl;h.on("mousedown",".thumb",a),h.on("mousedown",".track",r),this.options.enableKeyEvents&&(h.on("keydown","input",c),h.on("keyup","input",d))}return i.rendered=!0,this},setThumbPosition:function(t){this.thumb.css({left:t+"%"})},setValue:function(t){this.lastValue=this.value,this.value=Math.max(this.minValue,Math.min(this.maxValue,t)),this.setThumbPosition(Math.round((t-this.minValue)*this.delta))},getValue:function(){return this.value},setDisabled:function(t){t!==this.disabled&&this.cmpEl.toggleClass("disabled",t),this.disabled=t}}),Common.UI.MultiSlider=Common.UI.BaseView.extend({options:{width:100,minValue:0,maxValue:100,values:[0,100],thumbTemplate:'<div class="thumb" style=""></div>'},disabled:!1,template:e.template(['<div class="slider multi-slider">','<div class="track">','<div class="track-left"></div>','<div class="track-center""></div>','<div class="track-right" style=""></div>',"</div>","<% _.each(items, function(item) { %>","<%= thumbTemplate %>","<% }); %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.width=e.options.width,e.minValue=e.options.minValue,e.maxValue=e.options.maxValue,e.delta=100/(e.maxValue-e.minValue),e.thumbs=[],e.options.el&&e.render()},render:function(t){var i=this;i.rendered?this.cmpEl=this.$el:(this.cmpEl=$(this.template({items:this.options.values,thumbTemplate:this.options.thumbTemplate})),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl));var n=this.cmpEl;n.find(".track-center").width(i.options.width-14),n.width(i.options.width);var o=function(t){t.preventDefault(),t.stopPropagation();var n=t.data.index,o=i.thumbs[n].value,s=n-1<0?0:i.thumbs[n-1].position,a=n+1<i.thumbs.length?i.thumbs[n+1].position:100,r=Math.round((t.pageX*Common.Utils.zoom()-i.cmpEl.offset().left-i._dragstart)/i.width*100),l=r<s||r>a,c=Math.max(0,Math.min(100,r)),d=c/i.delta+i.minValue;if(i.isRemoveThumb){if(i.thumbs.length<3)return $(document).off("mouseup",i.binding.onMouseUp),$(document).off("mousemove",i.binding.onMouseMove),void(i._dragstart=void 0);i.trigger("removethumb",i,e.findIndex(i.thumbs,{index:n})),i.trigger("change",i,d,o),i.trigger("changecomplete",i,d,o)}else i.setThumbPosition(n,c),i.thumbs[n].value=d,l&&i.sortThumbs();$(document).off("mouseup",i.binding.onMouseUp),$(document).off("mousemove",i.binding.onMouseMove),i._dragstart=void 0,!i.isRemoveThumb&&i.trigger("changecomplete",i,d,o),i.isRemoveThumb=void 0},s=function(t){if(!i.disabled&&void 0!==i._dragstart){t.preventDefault(),t.stopPropagation();var e=t.data.index,n=i.thumbs[e].value,o=e-1<0?0:i.thumbs[e-1].position,s=e+1<i.thumbs.length?i.thumbs[e+1].position:100,a=Math.round((t.pageX*Common.Utils.zoom()-i.cmpEl.offset().left-i._dragstart)/i.width*100),r=a<o||a>s,l=Math.max(0,Math.min(100,a)),c=l/i.delta+i.minValue;i.setThumbPosition(e,l),i.thumbs[e].value=c,r&&i.sortThumbs();var d=t.pageY*Common.Utils.zoom()-i.cmpEl.offset().top;i.isRemoveThumb=d>i.cmpEl.height()||d<0,i.setRemoveThumb(e,i.isRemoveThumb),Math.abs(c-n)>.001&&i.trigger("change",i,c,n)}},a=function(t){if(!i.disabled){var n=t.data.index,o=i.thumbs[n].thumb;i._dragstart=t.pageX*Common.Utils.zoom()-o.offset().left-o.width()/2,i.setActiveThumb(n),e.each(i.thumbs,function(t,e){n==e?t.thumb.css("z-index",500):t.thumb.css("z-index","")}),$(document).on("mouseup",null,t.data,i.binding.onMouseUp),$(document).on("mousemove",null,t.data,i.binding.onMouseMove)}},r=function(t){if(!(i.disabled||!e.isUndefined(i._dragstart)||i.thumbs.length>9)){var n=Math.max(0,Math.min(100,Math.round((t.pageX*Common.Utils.zoom()-i.cmpEl.offset().left)/i.width*100))),o=l(n),s=(i.thumbs[o].colorValue,i.thumbs[o].value,n/i.delta+i.minValue);i.addThumb();var a=i.thumbs.length-1;i.setThumbPosition(a,n),i.thumbs[a].value=s,i.trigger("addthumb",i,a,n),i.trigger("change",i),i.trigger("changecomplete",i)}},l=function(t){for(var e,n=100,o=0,s=i.thumbs.length,a=0;a<s;a++)if(e=Math.abs(i.thumbs[a].position-t),Math.abs(e<=n)){var r=i.thumbs[a+1],l=i.thumbs[a-1];if(void 0!==l&&t<l.position)continue;if(void 0!==r&&t>r.position)continue;o=a,n=e}return o};return this.binding={onMouseUp:e.bind(o,this),onMouseMove:e.bind(s,this),onMouseDown:e.bind(a,this)},this.$thumbs=n.find(".thumb"),e.each(this.$thumbs,function(t,e){var n=$(t);i.thumbs.push({thumb:n,index:e}),i.setValue(e,i.options.values[e]),n.on("mousedown",null,i.thumbs[e],i.binding.onMouseDown)}),i.setActiveThumb(0,!0),i.rendered||n.on("mouseup",".track",r),i.rendered=!0,this},setActiveThumb:function(t,e){this.currentThumb=t,this.$thumbs=this.cmpEl.find(".thumb"),this.$thumbs.removeClass("active"),this.thumbs[t].thumb.addClass("active"),!0!==e&&this.trigger("thumbclick",this,t)},setRemoveThumb:function(t,i){-1!==e.findIndex(this.thumbs,{index:t})&&(i&&this.thumbs.length>2?this.$el.find(".active").addClass("remove"):this.$el.find(".remove").removeClass("remove"))},setThumbPosition:function(t,e){this.thumbs[t].position=e,this.thumbs[t].thumb.css({left:e+"%"})},setValue:function(t,e){this.thumbs[t].value=Math.max(this.minValue,Math.min(this.maxValue,e)),this.setThumbPosition(t,Math.round((e-this.minValue)*this.delta))},getValue:function(t){return this.thumbs[t].value},getValues:function(){var t=[];return e.each(this.thumbs,function(e){t.push(e.value)}),t},setDisabled:function(t){t!==this.disabled&&this.cmpEl.toggleClass("disabled",t),this.disabled=t},sortThumbs:function(){this.thumbs.sort(function(t,e){return t.position-e.position});var t=[];return e.each(this.thumbs,function(e,i){t.push(e.index),e.index=i}),t},setThumbs:function(t){var e=this.thumbs.length;if(e!=t)for(var i=0;i<Math.abs(t-e);i++)e<t?this.addThumb():this.removeThumb()},addThumb:function(){var t=this.cmpEl,e=$(this.options.thumbTemplate),i=this.thumbs.length;t.append(e),this.thumbs.push({thumb:e,index:i}),i>0&&this.setValue(i,this.getValue(i-1)),e.on("mousedown",null,this.thumbs[i],this.binding.onMouseDown)},removeThumb:function(t){void 0===t&&(t=this.thumbs.length-1),t>0&&(this.thumbs[t].thumb.remove(),this.thumbs.splice(t,1))}})}),void 0===Common)var Common={};if(define("common/main/lib/component/MultiSliderGradient",["common/main/lib/component/Slider","underscore"],function(t,e){"use strict";Common.UI.MultiSliderGradient=Common.UI.MultiSlider.extend({options:{width:100,minValue:0,maxValue:100,values:[0,100],colorValues:["#000000","#ffffff"],currentThumb:0,thumbTemplate:'<div class="thumb" style=""><div class="thumb-top"><div class="thumb-top-inner"></div></div><div class="thumb-bottom"><div class="thumb-bottom-inner"></div></div></div>'},disabled:!1,template:e.template(['<div class="slider multi-slider-gradient">','<div class="track"></div>',"<% _.each(items, function(item) { %>","<%= thumbTemplate %>","<% }); %>","</div>"].join("")),initialize:function(t){this.styleStr={},Common.UI.MultiSlider.prototype.initialize.call(this,t)},render:function(t){Common.UI.MultiSlider.prototype.render.call(this,t);var i=this;i.trackEl=i.cmpEl.find(".track");for(var n=0;n<i.thumbs.length;n++)i.thumbs[n].thumb.on("dblclick",null,function(){i.trigger("thumbdblclick",i)}),i.thumbs[n].thumbcolor=i.thumbs[n].thumb.find("> div"),i.setColorValue(i.options.colorValues[n],n);i.changeSliderStyle(),i.changeGradientStyle(),i.on("change",e.bind(i.changeGradientStyle,i))},setColorValue:function(t,e){var i=void 0!==e?e:this.currentThumb;this.thumbs[i].colorValue=t,this.thumbs[i].thumbcolor.css("background-color",t),this.changeGradientStyle()},getColorValue:function(t){var e=void 0!==t?t:this.currentThumb;return this.thumbs[e].colorValue},setValue:function(t,e){Common.UI.MultiSlider.prototype.setValue.call(this,t,e),this.changeGradientStyle()},getColorValues:function(){var t=[];return e.each(this.thumbs,function(e){t.push(e.colorValue)}),t},changeGradientStyle:function(){if(this.rendered){var t;this.styleStr.specific&&(t=Common.Utils.String.format(this.styleStr.specific,this.getColorValues().concat(this.getValues())),this.trackEl.css("background",t)),Common.Utils.isIE&&(t=Common.Utils.String.format("progid:DXImageTransform.Microsoft.gradient( startColorstr={0}, endColorstr={1},GradientType=1 )",this.getColorValue(0),this.getColorValue(this.thumbs.length-1)),this.trackEl.css("filter",t)),this.styleStr.common&&(t=Common.Utils.String.format(this.styleStr.common,this.getColorValues().concat(this.getValues())),this.trackEl.css("background",t))}},sortThumbs:function(){var t=Common.UI.MultiSlider.prototype.sortThumbs.call(this);return this.trigger("sortthumbs",this,t),t},findLeftThumb:function(t){for(var e,i=this,n=100,o=0,s=this.thumbs.length,a=0;a<s;a++)if((e=t-i.thumbs[a].position)>0&&e<=n){var r=i.thumbs[a+1],l=i.thumbs[a-1];if(void 0!==l&&t<l.position)continue;if(void 0!==r&&t>r.position)continue;o=a,n=e}return o},calculationNewColor:function(t,e,i){var n=i?i/100:.5,o=1-n,s=Common.Utils.ThemeColor.getRgbColor(t),a=Common.Utils.ThemeColor.getRgbColor(e),r=[Math.round(s.get_r()*o+a.get_r()*n),Math.round(s.get_g()*o+a.get_g()*n),Math.round(s.get_b()*o+a.get_b()*n)];return Common.Utils.ThemeColor.getHexColor(r[0],r[1],r[2])},addThumb:function(){Common.UI.MultiSlider.prototype.addThumb.call(this);var t=this,e=t.thumbs.length-1;t.thumbs[e].thumb.on("dblclick",null,function(){t.trigger("thumbdblclick",t)}),t.thumbs[e].thumbcolor=t.thumbs[e].thumb.find("> div"),e>0&&this.setColorValue(this.getColorValue(e-1),e),t.changeSliderStyle()},addNewThumb:function(t,i,n){var o,s=this,a=this.findLeftThumb(i),t=t;if(e.isUndefined(n)){var r=100*(i-this.thumbs[a].value)/(this.thumbs[a+1].value-this.thumbs[a].value);o=r<0?this.thumbs[a].colorValue:this.calculationNewColor(this.thumbs[a].colorValue,this.thumbs[a===t-1?a:a+1].colorValue,r)}else{this.addThumb(),t=this.thumbs.length-1,o=this.calculationNewColor(this.thumbs[a].colorValue,this.thumbs[a===t-1?a:a+1].colorValue),this.setThumbPosition(t,i);var l=i/this.delta+this.minValue;this.thumbs[t].value=l}return s.thumbs[t].thumbcolor=s.thumbs[t].thumb.find("> div"),t>0&&this.setColorValue("#"+o,t),s.sortThumbs(),s.changeSliderStyle(),s.changeGradientStyle(),o},removeThumb:function(t){void 0===t&&(t=this.thumbs.length-1),this.thumbs.length>2&&(this.thumbs[t].thumb.remove(),this.thumbs.splice(t,1),this.sortThumbs(),this.changeSliderStyle())},changeSliderStyle:function(){this.styleStr={specific:"",common:"linear-gradient(to right"},Common.Utils.isChrome&&Common.Utils.chromeVersion<10||Common.Utils.isSafari&&Common.Utils.safariVersion<5.1?this.styleStr.specific="-webkit-gradient(linear, left top, right top":Common.Utils.isChrome||Common.Utils.isSafari?this.styleStr.specific="-webkit-linear-gradient(left":Common.Utils.isGecko?this.styleStr.specific="-moz-linear-gradient(left":Common.Utils.isOpera&&Common.Utils.operaVersion>11?this.styleStr.specific="-o-linear-gradient(left":Common.Utils.isIE&&(this.styleStr.specific="-ms-linear-gradient(left");for(var t=0;t<this.thumbs.length;t++)this.styleStr.common+=", {"+t+"} {"+(this.thumbs.length+t)+"}%",Common.Utils.isChrome&&Common.Utils.chromeVersion<10||Common.Utils.isSafari&&Common.Utils.safariVersion<5.1?this.styleStr.specific+=", color-stop({"+(this.thumbs.length+t)+"}%,{"+t+"})":this.styleStr.specific+=", {"+t+"} {"+(this.thumbs.length+t)+"}%";this.styleStr.specific+=")",this.styleStr.common+=")"}})}),define("documenteditor/main/app/view/ShapeSettings",["text!documenteditor/main/app/template/ShapeSettings.template","jquery","underscore","backbone","common/main/lib/component/ComboBox","common/main/lib/component/ComboBorderSize","common/main/lib/component/MetricSpinner","common/main/lib/component/ThemeColorPalette","common/main/lib/component/ColorButton","common/main/lib/component/ComboDataView","common/main/lib/component/Slider","common/main/lib/component/MultiSliderGradient","common/main/lib/view/ImageFromUrlDialog","documenteditor/main/app/view/ImageSettingsAdvanced"],function(t,e,i,n){"use strict";DE.Views.ShapeSettings=n.View.extend(i.extend({el:"#id-shape-settings",template:i.template(t),events:{},options:{alias:"ShapeSettings"},initialize:function(){this._initSettings=!0,this._originalProps=null,this._noApply=!0,this.imgprops=null,this._sendUndoPoint=!0,this._sliderChanged=!1,this._texturearray=null,this.txtPt=Common.Utils.Metric.getMetricName(Common.Utils.Metric.c_MetricUnits.pt),this._state={Transparency:null,FillType:Asc.c_oAscFill.FILL_TYPE_SOLID,ShapeColor:"transparent",BlipFillType:Asc.c_oAscFillBlipType.STRETCH,StrokeType:Asc.c_oAscStrokeType.STROKE_COLOR,StrokeWidth:this._pt2mm(1),StrokeColor:"000000",StrokeBorderType:Asc.c_oDashType.solid,FGColor:"000000",BGColor:"ffffff",GradColor:"000000",GradFillType:Asc.c_oAscFillGradType.GRAD_LINEAR,WrappingStyle:Asc.c_oAscWrapStyle2.Inline,CanBeFlow:!0,FromGroup:!1,DisabledFillPanels:!1,DisabledControls:!1,HideShapeOnlySettings:!1,HideChangeTypeSettings:!1,isFromImage:!1},this.lockedControls=[],this._locked=!1,this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_SOLID,this.ShapeColor={Value:1,Color:"transparent"},this.BlipFillType=Asc.c_oAscFillBlipType.STRETCH,this.GradFillType=Asc.c_oAscFillGradType.GRAD_LINEAR,this.GradColor={values:[0,100],colors:["000000","ffffff"],currentIdx:0},this.GradRadialDirectionIdx=0,this.GradLinearDirectionType=0,this.PatternFillType=0,this.FGColor={Value:1,Color:"000000"},this.BGColor={Value:1,Color:"ffffff"},this.BorderColor={Value:1,Color:"transparent"},this.BorderSize=0,this.BorderType=Asc.c_oDashType.solid,this.textureNames=[this.txtCanvas,this.txtCarton,this.txtDarkFabric,this.txtGrain,this.txtGranite,this.txtGreyPaper,this.txtKnit,this.txtLeather,this.txtBrownPaper,this.txtPapyrus,this.txtWood],this.fillControls=[],this.render()},render:function(){(this.$el||e(this.el)).html(this.template({scope:this})),this.FillColorContainer=e("#shape-panel-color-fill"),this.FillImageContainer=e("#shape-panel-image-fill"),this.FillPatternContainer=e("#shape-panel-pattern-fill"),this.FillGradientContainer=e("#shape-panel-gradient-fill"),this.TransparencyContainer=e("#shape-panel-transparent-fill"),this.ShapeOnlySettings=e(".shape-only"),this.CanChangeType=e(".change-type")},setApi:function(t){return this.api=t,this.api&&(this.api.asc_registerCallback("asc_onImgWrapStyleChanged",i.bind(this._ImgWrapStyleChanged,this)),this.api.asc_setInterfaceDrawImagePlaceShape("shape-texture-img"),this.api.asc_registerCallback("asc_onInitStandartTextures",i.bind(this.onInitStandartTextures,this))),Common.NotificationCenter.on("storage:image-insert",i.bind(this.insertImageFromStorage,this)),this},setMode:function(t){this.mode=t},onFillSrcSelect:function(t,e){switch(this.ShowHideElem(e.value),e.value){case Asc.c_oAscFill.FILL_TYPE_SOLID:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_SOLID,!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.put_type(Asc.c_oAscFill.FILL_TYPE_SOLID),n.put_fill(new Asc.asc_CFillSolid),n.get_fill().put_color(Common.Utils.ThemeColor.getRgbColor("transparent"==this.ShapeColor.Color?{color:"4f81bd",effectId:24}:this.ShapeColor.Color)),i.put_fill(n),this.imgprops.put_ShapeProperties(i),this.api.ImgApply(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_GRAD:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_GRAD,!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;if(n.put_type(Asc.c_oAscFill.FILL_TYPE_GRAD),n.put_fill(new Asc.asc_CFillGrad),n.get_fill().put_grad_type(this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(n.get_fill().put_linear_angle(6e4*this.GradLinearDirectionType),n.get_fill().put_linear_scale(!0)),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD){this.GradColor.values=[0,100],this.GradColor.colors=[this.GradColor.colors[0],this.GradColor.colors[this.GradColor.colors.length-1]],this.GradColor.currentIdx=0;var o=Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[0]).get_color().get_hex(),s=Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1]).get_color().get_hex();o="ffffff"===o&&"ffffff"===s?{color:"4f81bd",effectId:24}:this.GradColor.colors[0],n.get_fill().put_positions([1e3*this.GradColor.values[0],1e3*this.GradColor.values[1]]),
n.get_fill().put_colors([Common.Utils.ThemeColor.getRgbColor(o),Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1])])}i.put_fill(n),this.imgprops.put_ShapeProperties(i),this.api.ImgApply(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_BLIP:this._state.FillType=Asc.c_oAscFill.FILL_TYPE_BLIP;break;case Asc.c_oAscFill.FILL_TYPE_PATT:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_PATT,!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.put_type(Asc.c_oAscFill.FILL_TYPE_PATT),n.put_fill(new Asc.asc_CFillHatch),n.get_fill().put_pattern_type(this.PatternFillType);var a=Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color).get_color().get_hex();a="ffffff"===Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color).get_color().get_hex()&&"ffffff"===a?{color:"4f81bd",effectId:24}:this.FGColor.Color,n.get_fill().put_color_fg(Common.Utils.ThemeColor.getRgbColor(a)),n.get_fill().put_color_bg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color)),i.put_fill(n),this.imgprops.put_ShapeProperties(i),this.api.ImgApply(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_NOFILL:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_NOFILL,!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.put_type(Asc.c_oAscFill.FILL_TYPE_NOFILL),n.put_fill(null),i.put_fill(n),this.imgprops.put_ShapeProperties(i),this.api.ImgApply(this.imgprops)}}this.fireEvent("editcomplete",this)},onColorsBackSelect:function(t,e){if(this.ShapeColor={Value:1,Color:e},this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;"transparent"==this.ShapeColor.Color?(n.put_type(Asc.c_oAscFill.FILL_TYPE_NOFILL),n.put_fill(null)):(n.put_type(Asc.c_oAscFill.FILL_TYPE_SOLID),n.put_fill(new Asc.asc_CFillSolid),n.get_fill().put_color(Common.Utils.ThemeColor.getRgbColor(this.ShapeColor.Color))),i.put_fill(n),this.imgprops.put_ShapeProperties(i),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},onPatternSelect:function(t,e){if(this.api&&!this._noApply){this.PatternFillType=e.get("type");var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.put_type(Asc.c_oAscFill.FILL_TYPE_PATT),n.put_fill(new Asc.asc_CFillHatch),n.get_fill().put_pattern_type(this.PatternFillType),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_PATT&&(n.get_fill().put_color_fg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),n.get_fill().put_color_bg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color))),i.put_fill(n),this.imgprops.put_ShapeProperties(i),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},onColorsFGSelect:function(t,e){if(this.FGColor={Value:1,Color:e},this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.put_type(Asc.c_oAscFill.FILL_TYPE_PATT),n.put_fill(new Asc.asc_CFillHatch),n.get_fill().put_color_fg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_PATT&&(n.get_fill().put_pattern_type(this.PatternFillType),n.get_fill().put_color_bg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color))),i.put_fill(n),this.imgprops.put_ShapeProperties(i),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},onColorsBGSelect:function(t,e){if(this.BGColor={Value:1,Color:e},this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.put_type(Asc.c_oAscFill.FILL_TYPE_PATT),n.put_fill(new Asc.asc_CFillHatch),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_PATT&&(n.get_fill().put_pattern_type(this.PatternFillType),n.get_fill().put_color_fg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color))),n.get_fill().put_color_bg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color)),i.put_fill(n),this.imgprops.put_ShapeProperties(i),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},onFillTypeSelect:function(t,e){if(this.BlipFillType=e.value,this.api&&!0!==this._fromTextureCmb&&this.OriginalFillType==Asc.c_oAscFill.FILL_TYPE_BLIP){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.put_type(Asc.c_oAscFill.FILL_TYPE_BLIP),n.put_fill(new Asc.asc_CFillBlip),n.get_fill().put_type(this.BlipFillType),i.put_fill(n),this.imgprops.put_ShapeProperties(i),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},onNumTransparencyChange:function(t,e,i,n){if(this.sldrTransparency.setValue(t.getNumberValue(),!0),this.api){var o=t.getNumberValue(),s=new Asc.asc_CShapeProperty,a=new Asc.asc_CShapeFill;a.put_transparent(2.55*o),s.put_fill(a),this.imgprops.put_ShapeProperties(s),this.api.ImgApply(this.imgprops)}},onTransparencyChange:function(t,e,n){this._sliderChanged=e,this.numTransparency.setValue(e,!0),this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(i.bind(this._transparencyApplyFunc,this),100))},onTransparencyChangeComplete:function(t,e,i){clearInterval(this.updateslider),this._sliderChanged=e,this._sendUndoPoint||(this.api.setEndPointHistory(),this._transparencyApplyFunc()),this._sendUndoPoint=!0},_transparencyApplyFunc:function(){if(void 0!==this._sliderChanged){var t=new Asc.asc_CShapeProperty,e=new Asc.asc_CShapeFill;e.put_transparent(2.55*this._sliderChanged),t.put_fill(e),this.imgprops.put_ShapeProperties(t),this.api.ImgApply(this.imgprops),this._sliderChanged=void 0}},onGradTypeSelect:function(t,e){if(this.GradFillType=e.value,this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){this.mnuDirectionPicker.store.reset(this._viewDataLinear),this.mnuDirectionPicker.cmpEl.width(175),this.mnuDirectionPicker.restoreHeight=174;var e=this.mnuDirectionPicker.store.findWhere({type:this.GradLinearDirectionType});this.mnuDirectionPicker.selectRecord(e,!0),e?this.btnDirection.setIconCls("item-gradient "+e.get("iconcls")):this.btnDirection.setIconCls(""),this.numGradientAngle.setValue(this.GradLinearDirectionType,!0),this.numGradientAngle.setDisabled(this._locked)}else this.GradFillType==Asc.c_oAscFillGradType.GRAD_PATH&&(this.mnuDirectionPicker.store.reset(this._viewDataRadial),this.mnuDirectionPicker.cmpEl.width(60),this.mnuDirectionPicker.restoreHeight=58,this.mnuDirectionPicker.selectByIndex(this.GradRadialDirectionIdx,!0),this.GradRadialDirectionIdx>=0?this.btnDirection.setIconCls("item-gradient "+this._viewDataRadial[this.GradRadialDirectionIdx].iconcls):this.btnDirection.setIconCls(""),this.numGradientAngle.setValue(0,!0),this.numGradientAngle.setDisabled(!0));if(this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.put_type(Asc.c_oAscFill.FILL_TYPE_GRAD),n.put_fill(new Asc.asc_CFillGrad),n.get_fill().put_grad_type(this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(n.get_fill().put_linear_angle(6e4*this.GradLinearDirectionType),n.get_fill().put_linear_scale(!0)),i.put_fill(n),this.imgprops.put_ShapeProperties(i),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},onSelectGradient:function(t,e,n,o){if(!this._noApply){var s={};if(i.isFunction(o.toJSON)){if(!o.get("selected"))return;s=o.toJSON()}else s=o;if(this.btnDirection.setIconCls("item-gradient "+s.iconcls),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR?this.GradLinearDirectionType=s.type:this.GradRadialDirectionIdx=0,this.api&&this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){this.numGradientAngle.setValue(s.type,!0);var a=new Asc.asc_CShapeProperty,r=new Asc.asc_CShapeFill;r.put_type(Asc.c_oAscFill.FILL_TYPE_GRAD),r.put_fill(new Asc.asc_CFillGrad),r.get_fill().put_grad_type(this.GradFillType),r.get_fill().put_linear_angle(6e4*s.type),r.get_fill().put_linear_scale(!0),a.put_fill(r),this.imgprops.put_ShapeProperties(a),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)}},onColorsGradientSelect:function(t,e){if(this.GradColor.colors[this.GradColor.currentIdx]=e,this.sldrGradient.setColorValue(Common.Utils.String.format("#{0}","object"==typeof e?e.color:e)),this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.put_type(Asc.c_oAscFill.FILL_TYPE_GRAD),n.put_fill(new Asc.asc_CFillGrad),n.get_fill().put_grad_type(this.GradFillType);var o=[];this.GradColor.colors.forEach(function(t){o.push(Common.Utils.ThemeColor.getRgbColor(t))}),n.get_fill().put_colors(o),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD&&(this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(n.get_fill().put_linear_angle(6e4*this.GradLinearDirectionType),n.get_fill().put_linear_scale(!0)),o=[],this.GradColor.values.forEach(function(t){o.push(1e3*t)}),n.get_fill().put_positions(o)),i.put_fill(n),this.imgprops.put_ShapeProperties(i),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},onGradientChange:function(t,e,n){this.GradColor.values=t.getValues(),this.spnGradPosition.setValue(this.GradColor.values[this.GradColor.currentIdx],!0),this._sliderChanged=!0,this.api&&!this._noApply&&this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(i.bind(this._gradientApplyFunc,this),100))},onGradientChangeComplete:function(t,e,i){clearInterval(this.updateslider),this._sliderChanged=!0,this._sendUndoPoint||(this.api.setEndPointHistory(),this._gradientApplyFunc()),this._sendUndoPoint=!0},_gradientApplyFunc:function(){if(this._sliderChanged){var t=new Asc.asc_CShapeProperty,e=new Asc.asc_CShapeFill;e.put_type(Asc.c_oAscFill.FILL_TYPE_GRAD),e.put_fill(new Asc.asc_CFillGrad),e.get_fill().put_grad_type(this.GradFillType);var i=[];this.GradColor.values.forEach(function(t){i.push(1e3*t)}),e.get_fill().put_positions(i),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(e.get_fill().put_linear_angle(6e4*this.GradLinearDirectionType),e.get_fill().put_linear_scale(!0)),i=[],this.GradColor.colors.forEach(function(t){i.push(Common.Utils.ThemeColor.getRgbColor(t))}),e.get_fill().put_colors(i),t.put_fill(e),this.imgprops.put_ShapeProperties(t),this.api.ImgApply(this.imgprops),this._sliderChanged=!1}},applyBorderSize:function(t){if(t=Common.Utils.String.parseFloat(t),t=isNaN(t)?0:Math.max(0,Math.min(1584,t)),this.BorderSize=t,this.api&&!this._noApply){var e=new Asc.asc_CShapeProperty,i=new Asc.asc_CStroke;this.BorderSize<1e-5?(i.put_type(Asc.c_oAscStrokeType.STROKE_NONE),this._state.StrokeType=this._state.StrokeWidth=-1):(i.put_type(Asc.c_oAscStrokeType.STROKE_COLOR),"transparent"==this.BorderColor.Color||"transparent"==this.BorderColor.Color.color?i.put_color(Common.Utils.ThemeColor.getRgbColor({color:"000000",effectId:29})):this._state.StrokeType!=Asc.c_oAscStrokeType.STROKE_NONE&&null!==this._state.StrokeType||i.put_color(Common.Utils.ThemeColor.getRgbColor(Common.Utils.ThemeColor.colorValue2EffectId(this.BorderColor.Color))),i.asc_putPrstDash(this.BorderType),i.put_width(this._pt2mm(this.BorderSize))),e.put_stroke(i),this.imgprops.put_ShapeProperties(e),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},onComboBlur:function(){this.fireEvent("editcomplete",this)},onBorderSizeChanged:function(t,e,n,o){var s=this;if(t){var a=parseFloat(n.value);(!new RegExp("^\\s*(\\d*(\\.|,)?\\d+)\\s*("+s.txtPt+")?\\s*$").exec(n.value)||a<0||a>1584)&&(this._state.StrokeType=this._state.StrokeWidth=-1,setTimeout(function(){Common.UI.error({msg:s.textBorderSizeErr,callback:function(){i.defer(function(t){s.fireEvent("editcomplete",s)})}})},10))}else this.applyBorderSize(n.value)},onBorderSizeSelect:function(t,e){this.applyBorderSize(e.value)},onBorderTypeSelect:function(t,e){if(this.BorderType=e.value,this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CStroke;this.BorderSize<1e-5?n.put_type(Asc.c_oAscStrokeType.STROKE_NONE):(n.put_type(Asc.c_oAscStrokeType.STROKE_COLOR),n.put_color(Common.Utils.ThemeColor.getRgbColor(this.BorderColor.Color)),n.put_width(this._pt2mm(this.BorderSize)),n.asc_putPrstDash(this.BorderType)),i.put_stroke(n),this.imgprops.put_ShapeProperties(i),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},onColorsBorderSelect:function(t,e){if(this.BorderColor={Value:1,Color:e},this.api&&this.BorderSize>0&&!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CStroke;this.BorderSize<1e-5?n.put_type(Asc.c_oAscStrokeType.STROKE_NONE):(n.put_type(Asc.c_oAscStrokeType.STROKE_COLOR),n.put_color(Common.Utils.ThemeColor.getRgbColor(this.BorderColor.Color)),n.put_width(this._pt2mm(this.BorderSize)),n.asc_putPrstDash(this.BorderType)),i.put_stroke(n),this.imgprops.put_ShapeProperties(i),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},_ImgWrapStyleChanged:function(t){if(this.cmbWrapType&&this._state.WrappingStyle!==t){this.cmbWrapType.suspendEvents();var e=this.cmbWrapType.menuPicker.store.findWhere({data:t});this.cmbWrapType.menuPicker.selectRecord(e),this.cmbWrapType.resumeEvents(),this._state.WrappingStyle=t}},onSelectWrap:function(t,e){if(this.api){var i=new Asc.asc_CImgProperty,n=e.get("data");if(i.put_WrappingStyle(n),this._state.WrappingStyle===Asc.c_oAscWrapStyle2.Inline&&n!==Asc.c_oAscWrapStyle2.Inline){i.put_PositionH(new Asc.CImagePositionH),i.get_PositionH().put_UseAlign(!1),i.get_PositionH().put_RelativeFrom(Asc.c_oAscRelativeFromH.Column);var o=this._originalProps.get_Value_X(Asc.c_oAscRelativeFromH.Column);i.get_PositionH().put_Value(o),i.put_PositionV(new Asc.CImagePositionV),i.get_PositionV().put_UseAlign(!1),i.get_PositionV().put_RelativeFrom(Asc.c_oAscRelativeFromV.Paragraph),o=this._originalProps.get_Value_Y(Asc.c_oAscRelativeFromV.Paragraph),i.get_PositionV().put_Value(o)}this.api.ImgApply(i)}this.fireEvent("editcomplete",this)},setImageUrl:function(t,e){if(null!==this.BlipFillType){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.put_type(Asc.c_oAscFill.FILL_TYPE_BLIP),n.put_fill(new Asc.asc_CFillBlip),n.get_fill().put_type(this.BlipFillType),n.get_fill().put_url(t,e),i.put_fill(n),this.imgprops.put_ShapeProperties(i),this.api.ImgApply(this.imgprops)}},insertImageFromStorage:function(t){t&&t.url&&"fill"==t.c&&this.setImageUrl(t.url,t.token)},onImageSelect:function(t,e){if(1==e.value){var n=this;new Common.Views.ImageFromUrlDialog({handler:function(t,e){if("ok"==t&&n.api){var o=e.replace(/ /g,"");i.isEmpty(o)||n.setImageUrl(o)}n.fireEvent("editcomplete",n)}}).show()}else 2==e.value?Common.NotificationCenter.trigger("storage:image-load","fill"):(this.api&&this.api.ChangeShapeImageFromFile(this.BlipFillType),this.fireEvent("editcomplete",this))},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;if(e.api&&!this._locked){var i=e.api.getSelectedElements();if(i&&i.length>0)for(var n,o,s=i.length-1;s>=0;s--)if(n=i[s].get_ObjectType(),o=i[s].get_ObjectValue(),Asc.c_oAscTypeSelectElement.Image==n){new DE.Views.ImageSettingsAdvanced({imageProps:o,sectionProps:e.api.asc_GetSectionProps(),handler:function(t,i){"ok"==t&&e.api&&e.api.ImgApply(i.imageProps),e.fireEvent("editcomplete",e)}}).show();break}}}},ChangeSettings:function(t){if(null==this.imgprops?this.imgprops=new Asc.asc_CImgProperty:this.imgprops.put_ImageUrl(null),this._initSettings&&this.createDelayedElements(),t&&t.get_ShapeProperties()){var n=t.get_ShapeProperties(),o=n.asc_getType();this._originalProps=new Asc.asc_CImgProperty(t),this._noApply=!0,this.disableControls(this._locked,!n.get_CanFill()),this.hideShapeOnlySettings(n.get_FromChart()||n.get_FromImage());var s=n.get_FromChart()||"line"==o||"bentConnector2"==o||"bentConnector3"==o||"bentConnector4"==o||"bentConnector5"==o||"curvedConnector2"==o||"curvedConnector3"==o||"curvedConnector4"==o||"curvedConnector5"==o||"straightConnector1"==o;this.hideChangeTypeSettings(s),this._state.isFromImage=!!n.get_FromImage(),!s&&this.btnChangeShape.menu.items.length&&(this.btnChangeShape.menu.items[0].setVisible(n.get_FromImage()),this.btnChangeShape.menu.items[1].setVisible(!n.get_FromImage()));var a=t.get_WrappingStyle();if(this._state.WrappingStyle!==a){this.cmbWrapType.suspendEvents();var r=this.cmbWrapType.menuPicker.store.findWhere({data:a});this.cmbWrapType.menuPicker.selectRecord(r),this.cmbWrapType.resumeEvents(),this._state.WrappingStyle=a}a=t.get_CanBeFlow()&&!this._locked;var l=t.get_FromGroup()||this._locked;this._state.CanBeFlow===a&&this._state.FromGroup===l||(this.cmbWrapType.setDisabled(!a||l),this._state.CanBeFlow=a,this._state.FromGroup=l);var r=null,c=n.get_fill(),d=c.get_type(),h=null,p=c.get_transparent();if((Math.abs(this._state.Transparency-p)>.001||Math.abs(this.numTransparency.getNumberValue()-p)>.001||(null===this._state.Transparency||null===p)&&(this._state.Transparency!==p||this.numTransparency.getNumberValue()!==p))&&(void 0!==p&&(this.sldrTransparency.setValue(null===p?100:p/255*100,!0),this.numTransparency.setValue(this.sldrTransparency.getValue(),!0)),this._state.Transparency=p),null===c||null===d)this.OriginalFillType=null;else if(d==Asc.c_oAscFill.FILL_TYPE_NOFILL)this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_NOFILL;else if(d==Asc.c_oAscFill.FILL_TYPE_SOLID)c=c.get_fill(),h=c.get_color(),h?h.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.ShapeColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(h.get_r(),h.get_g(),h.get_b()),effectValue:h.get_value()}}:this.ShapeColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(h.get_r(),h.get_g(),h.get_b())}:this.ShapeColor={Value:0,Color:"transparent"},this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_SOLID,this.FGColor="transparent"!==this.ShapeColor.Color?{Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.ShapeColor.Color)}:{Value:1,Color:"000000"},this.BGColor={Value:1,Color:"ffffff"},this.GradColor.colors[0]="transparent"!==this.ShapeColor.Color?Common.Utils.ThemeColor.colorValue2EffectId(this.ShapeColor.Color):"000000",this.GradColor.colors[this.GradColor.colors.length-1]="ffffff";else if(d==Asc.c_oAscFill.FILL_TYPE_BLIP)c=c.get_fill(),this.BlipFillType=c.get_type(),this._state.BlipFillType!==this.BlipFillType&&(this.BlipFillType==Asc.c_oAscFillBlipType.STRETCH||this.BlipFillType==Asc.c_oAscFillBlipType.TILE?this.cmbFillType.setValue(this.BlipFillType):this.cmbFillType.setValue(""),this._state.BlipFillType=this.BlipFillType),this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_BLIP;else if(d==Asc.c_oAscFill.FILL_TYPE_PATT){if(c=c.get_fill(),this.PatternFillType=c.get_pattern_type(),this._state.PatternFillType!==this.PatternFillType){this.cmbPattern.suspendEvents();var r=this.cmbPattern.menuPicker.store.findWhere({type:this.PatternFillType});this.cmbPattern.menuPicker.selectRecord(r),this.cmbPattern.resumeEvents(),this._state.PatternFillType=this.PatternFillType}h=c.get_color_fg(),h?h.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.FGColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(h.get_r(),h.get_g(),h.get_b()),effectValue:h.get_value()}}:this.FGColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(h.get_r(),h.get_g(),h.get_b())}:this.FGColor={Value:1,Color:"000000"},h=c.get_color_bg(),h?h.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.BGColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(h.get_r(),h.get_g(),h.get_b()),effectValue:h.get_value()}}:this.BGColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(h.get_r(),h.get_g(),h.get_b())}:this.BGColor={Value:1,Color:"ffffff"},this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_PATT,this.ShapeColor={Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.FGColor.Color)},this.GradColor.colors[0]=Common.Utils.ThemeColor.colorValue2EffectId(this.FGColor.Color),this.GradColor.colors[this.GradColor.colors.length-1]="ffffff"}else if(d==Asc.c_oAscFill.FILL_TYPE_GRAD){c=c.get_fill();var m=c.get_grad_type();if(this._state.GradFillType===m&&this.GradFillType===m||(this.GradFillType=m,r=void 0,this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR||this.GradFillType==Asc.c_oAscFillGradType.GRAD_PATH?(this.cmbGradType.setValue(this.GradFillType),r=this.cmbGradType.store.findWhere({value:this.GradFillType}),this.onGradTypeSelect(this.cmbGradType,r.attributes)):(this.cmbGradType.setValue(""),this.btnDirection.setIconCls("")),this._state.GradFillType=this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){var a=Math.floor(c.get_linear_angle()/6e4);if(Math.abs(this.GradLinearDirectionType-a)>.001){this.GradLinearDirectionType=a;var u=this.mnuDirectionPicker.store.findWhere({type:a});this.mnuDirectionPicker.selectRecord(u,!0),u?this.btnDirection.setIconCls("item-gradient "+u.get("iconcls")):this.btnDirection.setIconCls(""),this.numGradientAngle.setValue(a,!0)}}else this.numGradientAngle.setValue(0,!0);var g=this,b=c.get_colors(),f=c.get_positions(),C=b?b.length:this.GradColor.colors.length;this.sldrGradient.setThumbs(C),this.GradColor.colors.length>C&&(this.GradColor.colors.splice(C,this.GradColor.colors.length-C),this.GradColor.values.splice(C,this.GradColor.colors.length-C),this.GradColor.currentIdx=0),b&&b.forEach(function(t,e){t?t.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?(g.GradColor.colors[e]={color:Common.Utils.ThemeColor.getHexColor(t.get_r(),t.get_g(),t.get_b()),effectValue:t.get_value()},Common.Utils.ThemeColor.colorValue2EffectId(g.GradColor.colors[e])):g.GradColor.colors[e]=Common.Utils.ThemeColor.getHexColor(t.get_r(),t.get_g(),t.get_b()):g.GradColor.colors[e]="000000";var i=f[e];null!==i&&(i/=1e3,g.GradColor.values[e]=i)});for(var v=0;v<C;v++)g.sldrGradient.setColorValue(Common.Utils.String.format("#{0}","object"==typeof g.GradColor.colors[v]?g.GradColor.colors[v].color:g.GradColor.colors[v]),v),g.sldrGradient.setValue(v,g.GradColor.values[v]);(i.isUndefined(g.GradColor.currentIdx)||g.GradColor.currentIdx>=this.GradColor.colors.length)&&(g.GradColor.currentIdx=0),g.sldrGradient.setActiveThumb(g.GradColor.currentIdx),this.spnGradPosition.setValue(this.GradColor.values[this.GradColor.currentIdx]),this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_GRAD,this.FGColor={Value:1,Color:this.GradColor.colors[0]},this.BGColor={Value:1,Color:"ffffff"},this.ShapeColor={Value:1,Color:this.GradColor.colors[0]}}this._state.FillType!==this.OriginalFillType&&(this.cmbFillSrc.setValue(null===this.OriginalFillType?"":this.OriginalFillType),this._state.FillType=this.OriginalFillType,this.ShowHideElem(this.OriginalFillType)),e(this.btnTexture.el).find(".form-control").prop("innerHTML",this.textSelectTexture);var _=typeof this.ShapeColor.Color,y=typeof this._state.ShapeColor;if(_!==y||"object"==_&&(this.ShapeColor.Color.effectValue!==this._state.ShapeColor.effectValue||this._state.ShapeColor.color.indexOf(this.ShapeColor.Color.color)<0)||"object"!=_&&this._state.ShapeColor.indexOf(this.ShapeColor.Color)<0){if(this.btnBackColor.setColor(this.ShapeColor.Color),"object"==typeof this.ShapeColor.Color){for(var x=!1,w=0;w<10;w++)if(Common.Utils.ThemeColor.ThemeValues[w]==this.ShapeColor.Color.effectValue){this.colorsBack.select(this.ShapeColor.Color,!0),x=!0;break}x||this.colorsBack.clearSelection()}else this.colorsBack.select(this.ShapeColor.Color,!0);this._state.ShapeColor=this.ShapeColor.Color}var S,A=n.get_stroke(),k=A.get_type(),T="transparent"==this._state.StrokeColor&&"transparent"!==this.BorderColor.Color;if(A?(k==Asc.c_oAscStrokeType.STROKE_COLOR?(h=A.get_color(),h?h.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.BorderColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(h.get_r(),h.get_g(),h.get_b()),effectValue:h.get_value()}}:this.BorderColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(h.get_r(),h.get_g(),h.get_b())}:this.BorderColor={Value:1,Color:"transparent"}):this.BorderColor={Value:1,Color:"transparent"},S=A.asc_getPrstDash()):(k=null,this.BorderColor={Value:0,Color:"transparent"}),_=typeof this.BorderColor.Color,y=typeof this._state.StrokeColor,T||_!==y||"object"==_&&(this.BorderColor.Color.effectValue!==this._state.StrokeColor.effectValue||this._state.StrokeColor.color.indexOf(this.BorderColor.Color.color)<0)||"object"!=_&&(this._state.StrokeColor.indexOf(this.BorderColor.Color)<0||"object"==typeof this.btnBorderColor.color)){if(this.btnBorderColor.setColor(this.BorderColor.Color),"object"==typeof this.BorderColor.Color){for(var x=!1,w=0;w<10;w++)if(Common.Utils.ThemeColor.ThemeValues[w]==this.BorderColor.Color.effectValue){this.colorsBorder.select(this.BorderColor.Color,!0),x=!0;break}x||this.colorsBorder.clearSelection()}else this.colorsBorder.select(this.BorderColor.Color,!0);this._state.StrokeColor=this.BorderColor.Color}if(this._state.StrokeType!==k||k==Asc.c_oAscStrokeType.STROKE_COLOR){if(k==Asc.c_oAscStrokeType.STROKE_COLOR){var I=A.get_width(),P=Math.abs(this._state.StrokeWidth-I)<1e-5&&!new RegExp(this.txtPt+"\\s*$").test(this.cmbBorderSize.getRawValue());if(Math.abs(this._state.StrokeWidth-I)>1e-5||P||(null===this._state.StrokeWidth||null===I)&&this._state.StrokeWidth!==I){this._state.StrokeWidth=I,null!==I&&(I=this._mm2pt(I));var M=null===I?I:i.find(this.cmbBorderSize.store.models,function(t){if(I<t.attributes.value+1e-5&&I>t.attributes.value-1e-5)return!0});M?this.cmbBorderSize.selectRecord(M):this.cmbBorderSize.setValue(null!==I?parseFloat(I.toFixed(2))+" "+this.txtPt:""),this.BorderSize=I}}else k==Asc.c_oAscStrokeType.STROKE_NONE?(this._state.StrokeWidth=0,this.BorderSize=this.cmbBorderSize.store.at(0).get("value"),this.cmbBorderSize.setValue(this.BorderSize)):(this._state.StrokeWidth=null,this.BorderSize=-1,this.cmbBorderSize.setValue(null));this._state.StrokeType=k}if(this._state.StrokeBorderType!==S&&(this.BorderType=this._state.StrokeBorderType=S,this.cmbBorderType.setValue(S)),_=typeof this.FGColor.Color,y=typeof this._state.FGColor,_!==y||"object"==_&&(this.FGColor.Color.effectValue!==this._state.FGColor.effectValue||this._state.FGColor.color.indexOf(this.FGColor.Color.color)<0)||"object"!=_&&this._state.FGColor.indexOf(this.FGColor.Color)<0){if(this.btnFGColor.setColor(this.FGColor.Color),"object"==typeof this.FGColor.Color){for(var x=!1,w=0;w<10;w++)if(Common.Utils.ThemeColor.ThemeValues[w]==this.FGColor.Color.effectValue){this.colorsFG.select(this.FGColor.Color,!0),x=!0;break}x||this.colorsFG.clearSelection()}else this.colorsFG.select(this.FGColor.Color,!0);this._state.FGColor=this.FGColor.Color}if(_=typeof this.BGColor.Color,y=typeof this._state.BGColor,_!==y||"object"==_&&(this.BGColor.Color.effectValue!==this._state.BGColor.effectValue||this._state.BGColor.color.indexOf(this.BGColor.Color.color)<0)||"object"!=_&&this._state.BGColor.indexOf(this.BGColor.Color)<0){if(this.btnBGColor.setColor(this.BGColor.Color),"object"==typeof this.BGColor.Color){for(var x=!1,w=0;w<10;w++)if(Common.Utils.ThemeColor.ThemeValues[w]==this.BGColor.Color.effectValue){this.colorsBG.select(this.BGColor.Color,!0),x=!0;break}x||this.colorsBG.clearSelection()}else this.colorsBG.select(this.BGColor.Color,!0);this._state.BGColor=this.BGColor.Color}if(h=this.GradColor.colors[this.GradColor.currentIdx],_=typeof h,y=typeof this._state.GradColor,_!==y||"object"==_&&(h.effectValue!==this._state.GradColor.effectValue||this._state.GradColor.color.indexOf(h.color)<0)||"object"!=_&&this._state.GradColor.indexOf(h)<0){if(this.btnGradColor.setColor(h),"object"==typeof h){for(var x=!1,w=0;w<10;w++)if(Common.Utils.ThemeColor.ThemeValues[w]==h.effectValue){this.colorsGrad.select(h,!0),x=!0;break}x||this.colorsGrad.clearSelection()}else this.colorsGrad.select(h,!0);this._state.GradColor=h}this.chShadow.setValue(!!n.asc_getShadow(),!0),this._noApply=!1}},createDelayedControls:function(){var t=this;this._arrFillSrc=[{displayValue:this.textColor,value:Asc.c_oAscFill.FILL_TYPE_SOLID},{displayValue:this.textGradientFill,value:Asc.c_oAscFill.FILL_TYPE_GRAD},{displayValue:this.textImageTexture,value:Asc.c_oAscFill.FILL_TYPE_BLIP},{displayValue:this.textPatternFill,value:Asc.c_oAscFill.FILL_TYPE_PATT},{displayValue:this.textNoFill,value:Asc.c_oAscFill.FILL_TYPE_NOFILL}],this.cmbFillSrc=new Common.UI.ComboBox({el:e("#shape-combo-fill-src"),cls:"input-group-nr",style:"width: 100%;",menuStyle:"min-width: 100%;",editable:!1,data:this._arrFillSrc}),this.cmbFillSrc.setValue(this._arrFillSrc[0].value),this.cmbFillSrc.on("selected",i.bind(this.onFillSrcSelect,this)),this.fillControls.push(this.cmbFillSrc),this.cmbPattern=new Common.UI.ComboDataView({itemWidth:28,itemHeight:28,menuMaxHeight:300,enableKeyEvents:!0,cls:"combo-pattern"}),this.cmbPattern.menuPicker.itemTemplate=this.cmbPattern.fieldPicker.itemTemplate=i.template(['<div class="style" id="<%= id %>">','<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" class="combo-pattern-item" ','width="'+this.cmbPattern.itemWidth+'" height="'+this.cmbPattern.itemHeight+'" ','style="background-position: -<%= offsetx %>px -<%= offsety %>px;"/>',"</div>"].join("")),this.cmbPattern.render(e("#shape-combo-pattern")),this.cmbPattern.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.cmbPattern.on("click",i.bind(this.onPatternSelect,this)),this.cmbPattern.openButton.menu.on("show:after",function(){t.cmbPattern.menuPicker.scroller.update({alwaysVisibleY:!0})}),this.fillControls.push(this.cmbPattern),this.btnSelectImage=new Common.UI.Button({parentEl:e("#shape-button-replace"),cls:"btn-text-menu-default",caption:this.textSelectImage,style:"width:100%;",menu:new Common.UI.Menu({style:"min-width: 194px;",maxHeight:200,items:[{caption:this.textFromFile,value:0},{cls:"cp-from-url",caption:this.textFromUrl,value:1},{caption:this.textFromStorage,value:2}]})}),this.fillControls.push(this.btnSelectImage),this.btnSelectImage.menu.on("item:click",i.bind(this.onImageSelect,this)),this.btnSelectImage.menu.items[2].setVisible(this.mode.canRequestInsertImage||this.mode.fileChoiceUrl&&this.mode.fileChoiceUrl.indexOf("{documentType}")>-1),this._arrFillType=[{displayValue:this.textStretch,value:Asc.c_oAscFillBlipType.STRETCH},{displayValue:this.textTile,value:Asc.c_oAscFillBlipType.TILE}],this.cmbFillType=new Common.UI.ComboBox({el:e("#shape-combo-fill-type"),cls:"input-group-nr",menuStyle:"min-width: 90px;",editable:!1,data:this._arrFillType}),this.cmbFillType.setValue(this._arrFillType[0].value),this.cmbFillType.on("selected",i.bind(this.onFillTypeSelect,this)),this.fillControls.push(this.cmbFillType),this.numTransparency=new Common.UI.MetricSpinner({el:e("#shape-spin-transparency"),step:1,width:62,value:"100 %",defaultUnit:"%",maxValue:100,minValue:0}),this.numTransparency.on("change",i.bind(this.onNumTransparencyChange,this)),this.numTransparency.on("inputleave",function(){t.fireEvent("editcomplete",t)}),this.fillControls.push(this.numTransparency),this.sldrTransparency=new Common.UI.SingleSlider({el:e("#shape-slider-transparency"),width:75,minValue:0,maxValue:100,value:100}),this.sldrTransparency.on("change",i.bind(this.onTransparencyChange,this)),this.sldrTransparency.on("changecomplete",i.bind(this.onTransparencyChangeComplete,this)),this.fillControls.push(this.sldrTransparency),this.lblTransparencyStart=e(this.el).find("#shape-lbl-transparency-start"),this.lblTransparencyEnd=e(this.el).find("#shape-lbl-transparency-end"),this._arrGradType=[{displayValue:this.textLinear,value:Asc.c_oAscFillGradType.GRAD_LINEAR},{displayValue:this.textRadial,value:Asc.c_oAscFillGradType.GRAD_PATH}],this.cmbGradType=new Common.UI.ComboBox({el:e("#shape-combo-grad-type"),cls:"input-group-nr",menuStyle:"min-width: 100%;",editable:!1,data:this._arrGradType}),this.cmbGradType.setValue(this._arrGradType[0].value),this.cmbGradType.on("selected",i.bind(this.onGradTypeSelect,this)),this.fillControls.push(this.cmbGradType),this._viewDataLinear=[{offsetx:0,offsety:0,type:45,subtype:-1,iconcls:"gradient-left-top"},{offsetx:50,offsety:0,type:90,subtype:4,iconcls:"gradient-top"},{offsetx:100,offsety:0,type:135,subtype:5,iconcls:"gradient-right-top"},{offsetx:0,offsety:50,type:0,subtype:6,iconcls:"gradient-left",cls:"item-gradient-separator",selected:!0},{offsetx:100,offsety:50,type:180,subtype:1,iconcls:"gradient-right"},{offsetx:0,offsety:100,type:315,subtype:2,iconcls:"gradient-left-bottom"},{offsetx:50,offsety:100,type:270,subtype:3,iconcls:"gradient-bottom"},{offsetx:100,offsety:100,type:225,subtype:7,iconcls:"gradient-right-bottom"}],this._viewDataRadial=[{
offsetx:100,offsety:150,type:2,subtype:5,iconcls:"gradient-radial-center"}],this.btnDirection=new Common.UI.Button({cls:"btn-large-dataview",iconCls:"item-gradient gradient-left",menu:new Common.UI.Menu({style:"min-width: 60px;",menuAlign:"tr-br",items:[{template:i.template('<div id="id-shape-menu-direction" style="width: 175px; margin: 0 5px;"></div>')}]})}),this.btnDirection.on("render:after",function(n){t.mnuDirectionPicker=new Common.UI.DataView({el:e("#id-shape-menu-direction"),parentMenu:n.menu,restoreHeight:174,allowScrollbar:!1,store:new Common.UI.DataViewStore(t._viewDataLinear),itemTemplate:i.template('<div id="<%= id %>" class="item-gradient" style="background-position: -<%= offsetx %>px -<%= offsety %>px;"></div>')})}),this.btnDirection.render(e("#shape-button-direction")),this.mnuDirectionPicker.on("item:click",i.bind(this.onSelectGradient,this,this.btnDirection)),this.fillControls.push(this.btnDirection),this.sldrGradient=new Common.UI.MultiSliderGradient({el:e("#shape-slider-gradient"),width:192,minValue:0,maxValue:100,values:[0,100]}),this.sldrGradient.on("change",i.bind(this.onGradientChange,this)),this.sldrGradient.on("changecomplete",i.bind(this.onGradientChangeComplete,this)),this.sldrGradient.on("thumbclick",function(e,i){t.GradColor.currentIdx=i;var n=t.GradColor.colors[t.GradColor.currentIdx];t.btnGradColor.setColor(n),t.colorsGrad.select(n,!1);var o=t.GradColor.values[t.GradColor.currentIdx];t.spnGradPosition.setValue(o,!0)}),this.sldrGradient.on("thumbdblclick",function(e){t.btnGradColor.cmpEl.find("button").dropdown("toggle")}),this.sldrGradient.on("sortthumbs",function(e,n){var o,s=[];i.each(n,function(e,i){s.push(t.GradColor.colors[e]),t.GradColor.currentIdx==e&&(o=i)}),t.OriginalFillType=null,t.GradColor.colors=s,t.GradColor.currentIdx=o}),this.sldrGradient.on("addthumb",function(e,i,n){t.GradColor.colors[i]=t.GradColor.colors[t.GradColor.currentIdx],t.GradColor.currentIdx=i;var o=t.sldrGradient.addNewThumb(i,n);t.GradColor.colors[t.GradColor.currentIdx]=o}),this.sldrGradient.on("removethumb",function(e,n){if(t.sldrGradient.removeThumb(n),t.GradColor.values.splice(n,1),t.sldrGradient.changeGradientStyle(),i.isUndefined(t.GradColor.currentIdx)||t.GradColor.currentIdx>=t.GradColor.colors.length){var o=n>0?n-1:n;o=0===o&&t.GradColor.values.length>2?t.GradColor.values.length-2:o,t.GradColor.currentIdx=o}t.sldrGradient.setActiveThumb(t.GradColor.currentIdx)}),this.fillControls.push(this.sldrGradient),this.spnGradPosition=new Common.UI.MetricSpinner({el:e("#shape-gradient-position"),step:1,width:60,defaultUnit:"%",value:"50 %",allowDecimal:!1,maxValue:100,minValue:0,disabled:this._locked}),this.fillControls.push(this.spnGradPosition),this.spnGradPosition.on("change",i.bind(this.onPositionChange,this)),this.spnGradPosition.on("inputleave",function(){t.fireEvent("editcomplete",t)}),this.btnAddGradientStep=new Common.UI.Button({parentEl:e("#shape-gradient-add-step"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-add-breakpoint",disabled:this._locked,hint:this.tipAddGradientPoint}),this.btnAddGradientStep.on("click",i.bind(this.onAddGradientStep,this)),this.fillControls.push(this.btnAddGradientStep),this.btnRemoveGradientStep=new Common.UI.Button({parentEl:e("#shape-gradient-remove-step"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-remove-breakpoint",disabled:this._locked,hint:this.tipRemoveGradientPoint}),this.btnRemoveGradientStep.on("click",i.bind(this.onRemoveGradientStep,this)),this.fillControls.push(this.btnRemoveGradientStep),this.numGradientAngle=new Common.UI.MetricSpinner({el:e("#shape-spin-gradient-angle"),step:10,width:60,defaultUnit:"Â°",value:"0 Â°",allowDecimal:!0,maxValue:359.9,minValue:0,disabled:this._locked}),this.fillControls.push(this.numGradientAngle),this.numGradientAngle.on("change",i.bind(this.onGradientAngleChange,this)),this.numGradientAngle.on("inputleave",function(){t.fireEvent("editcomplete",t)}),this.cmbBorderSize=new Common.UI.ComboBorderSizeEditable({el:e("#shape-combo-border-size"),style:"width: 93px;",txtNoBorders:this.txtNoBorders}).on("selected",i.bind(this.onBorderSizeSelect,this)).on("changed:before",i.bind(this.onBorderSizeChanged,this,!0)).on("changed:after",i.bind(this.onBorderSizeChanged,this,!1)).on("combo:blur",i.bind(this.onComboBlur,this,!1)),this.BorderSize=this.cmbBorderSize.store.at(2).get("value"),this.cmbBorderSize.setValue(this.BorderSize),this.lockedControls.push(this.cmbBorderSize),this.cmbBorderType=new Common.UI.ComboBorderType({el:e("#shape-combo-border-type"),style:"width: 93px;",menuStyle:"min-width: 93px;"}).on("selected",i.bind(this.onBorderTypeSelect,this)).on("combo:blur",i.bind(this.onComboBlur,this,!1)),this.BorderType=Asc.c_oDashType.solid,this.cmbBorderType.setValue(this.BorderType),this.lockedControls.push(this.cmbBorderType),this.btnRotate270=new Common.UI.Button({parentEl:e("#shape-button-270",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-270",value:0,hint:this.textHint270}),this.btnRotate270.on("click",i.bind(this.onBtnRotateClick,this)),this.lockedControls.push(this.btnRotate270),this.btnRotate90=new Common.UI.Button({parentEl:e("#shape-button-90",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-90",value:1,hint:this.textHint90}),this.btnRotate90.on("click",i.bind(this.onBtnRotateClick,this)),this.lockedControls.push(this.btnRotate90),this.btnFlipV=new Common.UI.Button({parentEl:e("#shape-button-flipv",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-flip-vert",value:0,hint:this.textHintFlipV}),this.btnFlipV.on("click",i.bind(this.onBtnFlipClick,this)),this.lockedControls.push(this.btnFlipV),this.btnFlipH=new Common.UI.Button({parentEl:e("#shape-button-fliph",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-flip-hor",value:1,hint:this.textHintFlipH}),this.btnFlipH.on("click",i.bind(this.onBtnFlipClick,this)),this.lockedControls.push(this.btnFlipH);var n=[{icon:"btn-wrap-inline",data:Asc.c_oAscWrapStyle2.Inline,tip:this.txtInline,selected:!0},{icon:"btn-wrap-square",data:Asc.c_oAscWrapStyle2.Square,tip:this.txtSquare},{icon:"btn-wrap-tight",data:Asc.c_oAscWrapStyle2.Tight,tip:this.txtTight},{icon:"btn-wrap-through",data:Asc.c_oAscWrapStyle2.Through,tip:this.txtThrough},{icon:"btn-wrap-topbottom",data:Asc.c_oAscWrapStyle2.TopAndBottom,tip:this.txtTopAndBottom},{icon:"btn-wrap-infront",data:Asc.c_oAscWrapStyle2.InFront,tip:this.txtInFront},{icon:"btn-wrap-behind",data:Asc.c_oAscWrapStyle2.Behind,tip:this.txtBehind}];this.cmbWrapType=new Common.UI.ComboDataView({itemWidth:50,itemHeight:50,menuMaxHeight:300,enableKeyEvents:!0,store:new Common.UI.DataViewStore(n),cls:"combo-chart-style"}),this.cmbWrapType.menuPicker.itemTemplate=this.cmbWrapType.fieldPicker.itemTemplate=i.template(['<div class="item-icon-box" id="<%= id %>">','<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" class="combo-wrap-item options__icon options__icon-huge <%= icon %>"',"</div>"].join("")),this.cmbWrapType.render(e("#shape-combo-wrap")),this.cmbWrapType.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.cmbWrapType.on("click",i.bind(this.onSelectWrap,this)),this.cmbWrapType.openButton.menu.on("show:after",function(){t.cmbWrapType.menuPicker.scroller.update({alwaysVisibleY:!0})}),this.lockedControls.push(this.cmbWrapType),this.btnChangeShape=new Common.UI.Button({parentEl:e("#shape-btn-change"),cls:"btn-icon-default",iconCls:"btn-change-shape",menu:new Common.UI.Menu({menuAlign:"tr-br",cls:"menu-shapes",items:[]})}),this.lockedControls.push(this.btnChangeShape),this.chShadow=new Common.UI.CheckBox({el:e("#shape-checkbox-shadow"),labelText:this.strShadow}),this.chShadow.on("change",i.bind(this.onCheckShadow,this)),this.lockedControls.push(this.chShadow),this.linkAdvanced=e("#shape-advanced-link"),e(this.el).on("click","#shape-advanced-link",i.bind(this.openAdvancedSettings,this))},createDelayedElements:function(){this._initSettings=!1,this.createDelayedControls();var t=[0,1,3,2,4,53,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,23,24,25,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,49,50,51,52];this.patternViewData=[];for(var e=0;e<13;e++)for(var i=0;i<4;i++){var n=4*e+i;this.patternViewData[n]={offsetx:28*i,offsety:28*e,type:t[n]}}this.patternViewData.splice(this.patternViewData.length-2,2);for(var e=0;e<this.patternViewData.length;e++)this.patternViewData[e].id=Common.UI.getId();this.cmbPattern.menuPicker.store.add(this.patternViewData),this.cmbPattern.menuPicker.store.length>0&&(this.cmbPattern.fillComboView(this.cmbPattern.menuPicker.store.at(0),!0),this.PatternFillType=this.patternViewData[0].type),this.onInitStandartTextures(),this.onApiAutoShapes(),this.UpdateThemeColors()},onInitStandartTextures:function(t){var n=this;if(t&&t.length>0&&(n._texturearray=[],i.each(t,function(t){n._texturearray.push({imageUrl:t.get_image(),name:n.textureNames[t.get_id()],type:t.get_id(),selected:!1})})),n._texturearray&&!(n._texturearray.length<1)&&!this._initSettings&&!this.btnTexture){this.btnTexture=new Common.UI.ComboBox({el:e("#shape-combo-fill-texture"),template:i.template(['<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle" tabindex="0" data-toggle="dropdown">','<div class="form-control text" style="width: 90px;">'+this.textSelectTexture+"</div>",'<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default">','<span class="caret"></span>',"</button>","</div>"].join(""))}),this.textureMenu=new Common.UI.Menu({items:[{template:i.template('<div id="id-shape-menu-texture" style="width: 233px; margin: 0 5px;"></div>')}]}),this.textureMenu.render(e("#shape-combo-fill-texture")),this.fillControls.push(this.btnTexture);var o=function(t){new Common.UI.DataView({el:e("#id-shape-menu-texture"),restoreHeight:174,parentMenu:t,showLast:!1,store:new Common.UI.DataViewStore(n._texturearray||[]),itemTemplate:i.template('<div class="item-texture"><img src="<%= imageUrl %>" id="<%= id %>"></div>')}).on("item:click",i.bind(n.onSelectTexture,n)),t.off("show:before",o)};this.textureMenu.on("show:before",o)}},onSelectTexture:function(t,i,n){if(this._fromTextureCmb=!0,this.cmbFillType.setValue(this._arrFillType[1].value),this._fromTextureCmb=!1,this.api){var o=new Asc.asc_CShapeProperty,s=new Asc.asc_CShapeFill;s.put_type(Asc.c_oAscFill.FILL_TYPE_BLIP),s.put_fill(new Asc.asc_CFillBlip),s.get_fill().put_type(Asc.c_oAscFillBlipType.TILE),s.get_fill().put_texture_id(n.get("type")),o.put_fill(s),this.imgprops.put_ShapeProperties(o),this.api.ImgApply(this.imgprops)}e(this.btnTexture.el).find(".form-control").prop("innerHTML",n.get("name")),this.fireEvent("editcomplete",this)},onBtnRotateClick:function(t){var e=new Asc.asc_CImgProperty;e.asc_putRotAdd(3.14159265358979*(1==t.options.value?90:270)/180),this.api.ImgApply(e),this.fireEvent("editcomplete",this)},onBtnFlipClick:function(t){var e=new Asc.asc_CImgProperty;1==t.options.value?e.asc_putFlipHInvert(!0):e.asc_putFlipVInvert(!0),this.api.ImgApply(e),this.fireEvent("editcomplete",this)},onCheckShadow:function(t,e,i,n){if(this.api){var o=new Asc.asc_CShapeProperty;o.asc_putShadow("checked"==t.getValue()?new Asc.asc_CShadowProperty:null),this.imgprops.put_ShapeProperties(o),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},onApiAutoShapes:function(){var t=this,e=function(i){t.fillAutoShapes(),i.off("show:before",e)};t.btnChangeShape.menu.on("show:before",e)},fillAutoShapes:function(){var t=this,n=this.application.getCollection("ShapeGroups"),o=n.length,s=function(a){for(var r=-1;r<o-1&&o>0;r++){var l=n.at(r>-1?r:0).get("groupStore");r<0&&(l=l.clone(),l.shift());new Common.UI.DataViewSimple({el:e("#id-shape-menu-shapegroup"+(r+1),a.items[r+1].$el),store:l,parentMenu:a.items[r+1].menu,itemTemplate:i.template('<div class="item-shape" id="<%= id %>"><svg width="20" height="20" class="icon"><use xlink:href="#svg-icon-<%= data.shapeType %>"></use></svg></div>')}).on("item:click",function(e,i,n,o){t.api&&(t.api.ChangeShapeType(n.get("data").shapeType),t.fireEvent("editcomplete",t)),"click"!==o.type&&t.btnChangeShape.menu.hide()})}a.off("show:after",s)};t.btnChangeShape.menu.on("show:after",s);for(var a=-1;a<o-1&&o>0;a++){var r=n.at(a>-1?a:a+1),l=new Common.UI.MenuItem({caption:r.get("groupName"),menu:new Common.UI.Menu({menuAlign:"tr-tl",items:[{template:i.template('<div id="id-shape-menu-shapegroup'+(a+1)+'" class="menu-shape" style="width: '+(r.get("groupWidth")-8)+'px; margin-left: 5px;"></div>')}]})});t.btnChangeShape.menu.addItem(l)}t.btnChangeShape.menu.items[0].setVisible(t._state.isFromImage),t.btnChangeShape.menu.items[1].setVisible(!t._state.isFromImage)},UpdateThemeColors:function(){this._initSettings||(this.btnBackColor||(this.btnBackColor=new Common.UI.ColorButton({parentEl:e("#shape-back-color-btn"),transparent:!0,color:"transparent"}),this.fillControls.push(this.btnBackColor),this.colorsBack=this.btnBackColor.getPicker(),this.btnBackColor.on("color:select",i.bind(this.onColorsBackSelect,this)),this.btnFGColor=new Common.UI.ColorButton({parentEl:e("#shape-foreground-color-btn"),color:"000000"}),this.fillControls.push(this.btnFGColor),this.colorsFG=this.btnFGColor.getPicker(),this.btnFGColor.on("color:select",i.bind(this.onColorsFGSelect,this)),this.btnBGColor=new Common.UI.ColorButton({parentEl:e("#shape-background-color-btn"),color:"ffffff"}),this.fillControls.push(this.btnBGColor),this.colorsBG=this.btnBGColor.getPicker(),this.btnBGColor.on("color:select",i.bind(this.onColorsBGSelect,this)),this.btnGradColor=new Common.UI.ColorButton({parentEl:e("#shape-gradient-color-btn"),color:"000000"}),this.fillControls.push(this.btnGradColor),this.colorsGrad=this.btnGradColor.getPicker(),this.btnGradColor.on("color:select",i.bind(this.onColorsGradientSelect,this)),this.btnBorderColor=new Common.UI.ColorButton({parentEl:e("#shape-border-color-btn"),color:"000000"}),this.lockedControls.push(this.btnBorderColor),this.colorsBorder=this.btnBorderColor.getPicker(),this.btnBorderColor.on("color:select",i.bind(this.onColorsBorderSelect,this))),this.colorsBorder.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBack.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsFG.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBG.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsGrad.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()))},_pt2mm:function(t){return 25.4*t/72},_mm2pt:function(t){return 72*t/25.4},disableFillPanels:function(t){this._state.DisabledFillPanels!==t&&(this._state.DisabledFillPanels=t,i.each(this.fillControls,function(e){e.setDisabled(t)}),this.lblTransparencyStart.toggleClass("disabled",t),this.lblTransparencyEnd.toggleClass("disabled",t),this.numGradientAngle.setDisabled(t||this.GradFillType!==Asc.c_oAscFillGradType.GRAD_LINEAR))},ShowHideElem:function(t){this.FillColorContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_SOLID),this.FillImageContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_BLIP),this.FillPatternContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_PATT),this.FillGradientContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_GRAD),this.TransparencyContainer.toggleClass("settings-hidden",t===Asc.c_oAscFill.FILL_TYPE_NOFILL||null===t)},setLocked:function(t){this._locked=t},disableControls:function(t,e){this._initSettings||(this.disableFillPanels(t||e),this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,function(e){e.setDisabled(t)}),this.linkAdvanced.toggleClass("disabled",t)))},hideShapeOnlySettings:function(t){this._state.HideShapeOnlySettings!==t&&(this._state.HideShapeOnlySettings=t,this.ShapeOnlySettings.toggleClass("hidden",1==t))},hideChangeTypeSettings:function(t){this._state.HideChangeTypeSettings!==t&&(this._state.HideChangeTypeSettings=t,this.CanChangeType.toggleClass("hidden",1==t))},onPositionChange:function(t){var e=t.getNumberValue(),i=this.GradColor.currentIdx-1<0?0:this.GradColor.values[this.GradColor.currentIdx-1],n=this.GradColor.currentIdx+1<this.GradColor.values.length?this.GradColor.values[this.GradColor.currentIdx+1]:100,o=e<i||e>n;if(this.api){this.GradColor.values[this.GradColor.currentIdx]=e;var s=new Asc.asc_CShapeProperty,a=new Asc.asc_CShapeFill;a.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),a.asc_putFill(new Asc.asc_CFillGrad),a.asc_getFill().asc_putGradType(this.GradFillType);var r=[];this.GradColor.values.forEach(function(t){r.push(1e3*t)}),a.asc_getFill().asc_putPositions(r),s.asc_putFill(a),this.imgprops.put_ShapeProperties(s),this.api.ImgApply(this.imgprops),o&&(this.sldrGradient.sortThumbs(),this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient))}},onAddGradientStep:function(){if(!(this.GradColor.colors.length>9)){var t=this.GradColor.currentIdx,e=(this.GradColor.values[t]+this.GradColor.values[t<this.GradColor.colors.length-1?t+1:t-1])/2;this.GradColor.colors[this.GradColor.colors.length]=this.GradColor.colors[t],this.GradColor.currentIdx=this.GradColor.colors.length-1;var i=this.sldrGradient.addNewThumb(void 0,e,t);this.GradColor.colors[this.GradColor.currentIdx]=i,this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient)}},onRemoveGradientStep:function(){if(!(this.GradColor.values.length<3)){var t=this.GradColor.currentIdx;if(this.GradColor.values.splice(this.GradColor.currentIdx,1),this.sldrGradient.removeThumb(this.GradColor.currentIdx),i.isUndefined(this.GradColor.currentIdx)||this.GradColor.currentIdx>=this.GradColor.colors.length){var e=t>0?t-1:t;e=0===e&&this.GradColor.values.length>2?this.GradColor.values.length-2:e,this.GradColor.currentIdx=e}this.sldrGradient.setActiveThumb(this.GradColor.currentIdx),this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient)}},onGradientAngleChange:function(t,e,i,n){if(this.api&&!this._noApply){var o=new Asc.asc_CShapeProperty,s=new Asc.asc_CShapeFill;s.put_type(Asc.c_oAscFill.FILL_TYPE_GRAD),s.put_fill(new Asc.asc_CFillGrad),s.get_fill().put_grad_type(this.GradFillType),s.get_fill().put_linear_angle(6e4*t.getNumberValue()),s.get_fill().put_linear_scale(!0),o.put_fill(s),this.imgprops.put_ShapeProperties(o),this.api.ImgApply(this.imgprops)}},txtNoBorders:"No Line",strStroke:"Stroke",strColor:"Color",strSize:"Size",strChange:"Change Autoshape",strFill:"Fill",textColor:"Color Fill",textImageTexture:"Picture or Texture",textTexture:"From Texture",textFromUrl:"From URL",textFromFile:"From File",textStretch:"Stretch",textTile:"Tile",txtCanvas:"Canvas",txtCarton:"Carton",txtDarkFabric:"Dark Fabric",txtGrain:"Grain",txtGranite:"Granite",txtGreyPaper:"Grey Paper",txtKnit:"Knit",txtLeather:"Leather",txtBrownPaper:"Brown Paper",txtPapyrus:"Papyrus",txtWood:"Wood",textAdvanced:"Show advanced settings",strTransparency:"Opacity",textNoFill:"No Fill",textSelectTexture:"Select",textGradientFill:"Gradient Fill",textPatternFill:"Pattern",strBackground:"Background color",strForeground:"Foreground color",strPattern:"Pattern",textEmptyPattern:"No Pattern",textLinear:"Linear",textRadial:"Radial",textDirection:"Direction",textStyle:"Style",textGradient:"Gradient Points",textWrap:"Wraping Style",txtInline:"Inline",txtSquare:"Square",txtTight:"Tight",txtThrough:"Through",txtTopAndBottom:"Top and bottom",txtBehind:"Behind",txtInFront:"In front",textBorderSizeErr:"The entered value is incorrect.<br>Please enter a value between 0 pt and 1584 pt.",strType:"Type",textRotation:"Rotation",textRotate90:"Rotate 90Â°",textFlip:"Flip",textHint270:"Rotate 90Â° Counterclockwise",textHint90:"Rotate 90Â° Clockwise",textHintFlipV:"Flip Vertically",textHintFlipH:"Flip Horizontally",strShadow:"Show shadow",textFromStorage:"From Storage",textSelectImage:"Select Picture",textPosition:"Position",tipAddGradientPoint:"Add gradient point",tipRemoveGradientPoint:"Remove gradient point",textAngle:"Angle"},DE.Views.ShapeSettings||{}))}),define("text!documenteditor/main/app/template/MailMerge.template",[],function(){return'<table cols="1">\r\n    <tr>\r\n        <td class="padding-small">\r\n            <button type="button" class="btn btn-text-default" id="mmerge-button-edit-data" style="width:100%;"><%= scope.textEditData %></button>\r\n            <label id="mmerge-lbl-add-recipients" style="margin-top: 4px;"><%= scope.textAddRecipients %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.textMergeFields %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td style="padding-bottom: 13px;">\r\n            <div id="mmerge-btn-ins-field" style="width:100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td  style="padding-bottom: 13px;">\r\n            <div id="mmerge-switcher-highlight" style="display: inline-block; vertical-align: top;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="mmerge-switcher-preview" style="display: inline-block; vertical-align: top;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="mmerge-button-first" style="display: inline-block;margin-right: 4px;"></div>\r\n            <div id="mmerge-button-prev" style="display: inline-block;margin-right: 4px;"></div>\r\n            <div id="mmerge-field-num" style="display:inline-block;vertical-align: middle;"></div>\r\n            <div id="mmerge-button-next" style="display: inline-block;margin-left: 4px;"></div>\r\n            <div id="mmerge-button-last" style="display: inline-block;margin-left: 4px;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.textMergeTo %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="">\r\n            <div id="mmerge-combo-merge-to" style="width: 100%;padding-bottom: 2px;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-medium">\r\n            <label style=""><%= scope.textMaxRecepients %></label>\r\n            <label class="link-solid" id="mmerge-readmore-link"><%= scope.textReadMore %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-large">\r\n            <div id="mmerge-radio-all" style="margin-bottom: 5px;"></div>\r\n            <div id="mmerge-radio-current"  style="margin-bottom: 5px;"></div>\r\n            <div id="mmerge-radio-from-to" style="display: inline-block;vertical-align: middle; margin-right: 2px;"></div>\r\n            <div id="mmerge-field-from" style="display: inline-block;vertical-align: middle;"></div>\r\n            <label style="width: 30px; text-align: right; vertical-align: middle; margin-right: 2px;"><%= scope.textTo %></label>\r\n            <div id="mmerge-field-to" style="display: inline-block;vertical-align: middle;"></div>\r\n        </td>\r\n    </tr>\r\n</table>\r\n<table cols="2">\r\n    <tr>\r\n        <td width="50%">\r\n            <button type="button" class="btn btn-text-default" id="mmerge-button-download" style="width:90px;"><%= scope.textDownload %></button>\r\n            <button type="button" class="btn btn-text-default hidden" id="mmerge-button-merge" style="width:90px;"><%= scope.textMerge %></button>\r\n        </td>\r\n        <td width="50%" style="text-align: right;">\r\n            <button type="button" class="btn btn-text-default" id="mmerge-button-portal" style="width:90px;"><%= scope.textPortal %></button>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'}),define("common/main/lib/view/SaveAsDlg",["common/main/lib/component/Window","common/main/lib/component/LoadMask"],function(){"use strict";Common.Views.SaveAsDlg=Common.UI.Window.extend(_.extend({initialize:function(t){var e={};_.extend(e,{title:this.textTitle,width:420,height:681,header:!0},t),this.template=['<div id="id-saveas-folder-placeholder"></div>'].join(""),e.tpl=_.template(this.template)(e),this.saveFolderUrl=t.saveFolderUrl||"",this.saveFileUrl=t.saveFileUrl||"",this.defFileName=t.defFileName||"",this.saveFolderUrl=this.saveFolderUrl.replace("{title}",encodeURIComponent(this.defFileName)).replace("{fileuri}",encodeURIComponent(this.saveFileUrl)),Common.UI.Window.prototype.initialize.call(this,e)},render:function(){Common.UI.Window.prototype.render.call(this),this.$window.find("> .body").css({height:"auto",overflow:"hidden"});var t=document.createElement("iframe");t.width="100%",t.height=645,t.align="top",t.frameBorder=0,t.scrolling="no",t.onload=_.bind(this._onLoad,this),$("#id-saveas-folder-placeholder").append(t),this.loadMask=new Common.UI.LoadMask({owner:$("#id-saveas-folder-placeholder")}),this.loadMask.setTitle(this.textLoading),this.loadMask.show(),t.src=this.saveFolderUrl;var e=this;this._eventfunc=function(t){e._onWindowMessage(t)},this._bindWindowEvents.call(this),this.on("close",function(t){e._unbindWindowEvents()})},_bindWindowEvents:function(){window.addEventListener?window.addEventListener("message",this._eventfunc,!1):window.attachEvent&&window.attachEvent("onmessage",this._eventfunc)},_unbindWindowEvents:function(){window.removeEventListener?window.removeEventListener("message",this._eventfunc):window.detachEvent&&window.detachEvent("onmessage",this._eventfunc)},_onWindowMessage:function(t){if(t&&window.JSON)try{this._onMessage.call(this,window.JSON.parse(t.data))}catch(t){}},_onMessage:function(t){t&&"onlyoffice"==t.Referer&&(_.isEmpty(t.error)?_.isEmpty(t.message)||Common.NotificationCenter.trigger("showmessage",{msg:t.message}):this.trigger("saveaserror",this,t.error),Common.NotificationCenter.trigger("window:close",this))},_onLoad:function(){this.loadMask&&this.loadMask.hide()},textTitle:"Folder for save",textLoading:"Loading"},Common.Views.SaveAsDlg||{}))}),define("text!documenteditor/main/app/template/MailMergeEmailDlg.template",[],function(){return'<div id="id-merge-email-dlg" class="settings-panel active">\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;" cellpadding="10">\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <label class="input-label header"><%= scope.textFrom %></label>\r\n                    <div id="merge-email-dlg-from" style="margin-right: 5px;"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label header"><%= scope.textTo %></label>\r\n                    <div id="merge-email-dlg-to"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan="2" class="padding-small">\r\n                    <label class="input-label header"><%= scope.textSubject %></label>\r\n                    <div id="merge-email-dlg-subject" style="width: 100%;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan="2" class="padding-small">\r\n                    <label class="input-label header"><%= scope.textFormat %></label>\r\n                    <div id="merge-email-dlg-format" style="width: 170px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan="2" class="padding-small">\r\n                    <label id="merge-email-dlg-lbl-filename"  class="input-label disabled header"><%= scope.textFileName %></label>\r\n                    <div id="merge-email-dlg-filename" style="width: 100%;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan="2" class="padding-small">\r\n                    <label id="merge-email-dlg-lbl-message" class="input-label disabled header"><%= scope.textMessage %></label>\r\n                     <textarea id="merge-email-dlg-message" class="disabled form-control" disabled="disabled" style="width: 100%;height: 70px;margin-bottom: 0;"></textarea>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan="2" class="padding-small">\r\n                    <label style="font-weight: bold;"><%= scope.textWarning %></label>\r\n                    <label class=""><%= scope.textWarningMsg %></label>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>'}),define("documenteditor/main/app/view/MailMergeEmailDlg",["text!documenteditor/main/app/template/MailMergeEmailDlg.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/ComboBox","common/main/lib/component/InputField"],function(t){"use strict";DE.Views.MailMergeEmailDlg=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{alias:"MailMergeEmail",contentWidth:500,height:435},initialize:function(e){_.extend(this.options,{title:this.textTitle,template:['<div class="box" style="height:'+(this.options.height-85)+'px;">','<div class="content-panel" style="padding: 0;">'+_.template(t)({scope:this})+"</div>","</div>",'<div class="separator horizontal"></div>'].join("")},e),Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this._arrFrom=[],this.cmbFrom=new Common.UI.ComboBox({el:$("#merge-email-dlg-from"),cls:"input-group-nr",menuStyle:"min-width: 100%;",editable:!1,data:this._arrFrom}),this._arrTo=[],this.cmbTo=new Common.UI.ComboBox({el:$("#merge-email-dlg-to"),cls:"input-group-nr",menuStyle:"min-width: 100%;",editable:!1,data:this._arrTo}),this.inputSubject=new Common.UI.InputField({el:$("#merge-email-dlg-subject"),allowBlank:!0,validateOnBlur:!1,placeHolder:this.subjectPlaceholder,style:"width: 100%;"}),this._arrFormat=[{displayValue:this.textHTML,value:Asc.c_oAscFileType.HTML},{displayValue:this.textAttachDocx,value:Asc.c_oAscFileType.DOCX},{displayValue:this.textAttachPdf,value:Asc.c_oAscFileType.PDF}],this.cmbFormat=new Common.UI.ComboBox({el:$("#merge-email-dlg-format"),cls:"input-group-nr",menuStyle:"min-width: 100%;",editable:!1,data:this._arrFormat}),this.cmbFormat.setValue(Asc.c_oAscFileType.HTML),this.cmbFormat.on("selected",_.bind(this.onCmbFormatSelect,this)),this.inputFileName=new Common.UI.InputField({el:$("#merge-email-dlg-filename"),allowBlank:!0,validateOnBlur:!1,disabled:!0,placeHolder:this.filePlaceholder,style:"width: 100%;"}),this.textareaMessage=this.$window.find("textarea"),this.lblFileName=$("#merge-email-dlg-lbl-filename"),this.lblMessage=$("#merge-email-dlg-lbl-message"),this._eventfunc=function(e){t._onWindowMessage(e)},this.mergeProps=this.options.props,this.mergedFileUrl=this.options.mergedFileUrl||"",this.afterRender()},_bindWindowEvents:function(){window.addEventListener?window.addEventListener("message",this._eventfunc,!1):window.attachEvent&&window.attachEvent("onmessage",this._eventfunc)},_unbindWindowEvents:function(){window.removeEventListener?window.removeEventListener("message",this._eventfunc):window.detachEvent&&window.detachEvent("onmessage",this._eventfunc)},_onWindowMessage:function(t){if(t&&window.JSON)try{this._onMessage.call(this,window.JSON.parse(t.data))}catch(t){}},_onMessage:function(t){t&&t.Referer},afterRender:function(){this._setDefaults(this.mergeProps)},getSettings:function(){var t=this.inputFileName.getValue(),e=this.cmbFormat.getValue();if(e!==Asc.c_oAscFileType.HTML){_.isEmpty(t)&&(t="attach")
;var i=t.lastIndexOf("."),n=i>0?t.substring(i,t.length).toLowerCase():"";e==Asc.c_oAscFileType.PDF&&".pdf"!==n?t+=".pdf":e==Asc.c_oAscFileType.DOCX&&".docx"!==n&&(t+=".docx")}return{from:this.cmbFrom.getValue(),to:this.cmbTo.getValue(),subject:this.inputSubject.getValue(),mailFormat:e,fileName:t,message:this.textareaMessage.val()}},_setDefaults:function(t){if(t){if(t.fieldsList){var e=[];_.each(t.fieldsList,function(t,i){e.push({displayValue:"<"+t+">",value:t})}),this.cmbTo.setData(e),e.length>0&&this.cmbTo.setValue(e[0].value)}if(t.emailAddresses){var e=[];_.each(t.emailAddresses,function(t,i){e.push({displayValue:t,value:t})}),this.cmbFrom.setData(e),e.length>0&&this.cmbFrom.setValue(e[0].value)}}},onPrimary:function(){return!0},onDlgBtnClick:function(t){var e=t.currentTarget.attributes.result.value;"ok"==e&&this.handler&&this.handler.call(this,e,"ok"==e?this.getSettings():void 0),this.close()},onCmbFormatSelect:function(t,e){var i=e.value==Asc.c_oAscFileType.HTML;this.inputFileName.setDisabled(i),this.lblFileName.toggleClass("disabled",i),i?this.textareaMessage.attr("disabled","disabled"):this.textareaMessage.removeAttr("disabled"),this.textareaMessage.toggleClass("disabled",i),this.lblMessage.toggleClass("disabled",i)},textTitle:"Send to E-mail",textFrom:"From",textTo:"To",textSubject:"Subject Line",textFormat:"Mail format",textFileName:"File name",textMessage:"Message",textHTML:"HTML",textAttachDocx:"Attach as DOCX",textAttachPdf:"Attach as PDF",subjectPlaceholder:"Theme",filePlaceholder:"PDF",textWarning:"Warning!",textWarningMsg:"Please note that mailing cannot be stopped once your click the 'Send' button."},DE.Views.MailMergeEmailDlg||{}))}),define("documenteditor/main/app/view/MailMergeSettings",["text!documenteditor/main/app/template/MailMerge.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/CheckBox","common/main/lib/view/SaveAsDlg","common/main/lib/view/SelectFileDlg","documenteditor/main/app/view/MailMergeEmailDlg"],function(t,e,i,n){"use strict";DE.enumLockMM={lostConnect:"disconnect",preview:"preview",coAuth:"co-auth",noFields:"no-fields",noRecipients:"no-recipients",radioAllCurr:"radio-all-curr"},DE.Views.MailMergeSettings=n.View.extend(i.extend({el:"#id-mail-merge-settings",template:i.template(t),events:{},options:{alias:"MailMergeSettings"},initialize:function(){DE.enumLockMM;this._initSettings=!0,this._state={recipientsCount:0,fieldsList:[]},this._locked=!1,this.emptyDBControls=[],this._noApply=!1,this._originalProps=null,this.defFileName="",this.emailAddresses=void 0,this.mergeMailData=void 0,this.render()},render:function(){this.$el.html(this.template({scope:this}))},setApi:function(t){return this.api=t,this.api&&(this.api.asc_registerCallback("asc_onPreviewMailMergeResult",i.bind(this.onPreviewMailMergeResult,this)),this.api.asc_registerCallback("asc_onEndPreviewMailMergeResult",i.bind(this.onEndPreviewMailMergeResult,this)),this.api.asc_registerCallback("asc_onStartMailMerge",i.bind(this.onStartMailMerge,this)),this.api.asc_registerCallback("asc_onSaveMailMerge",i.bind(this.onSaveMailMerge,this)),this.api.asc_registerCallback("asc_onEndAction",i.bind(this.onLongActionEnd,this)),Common.Gateway.on("setemailaddresses",i.bind(this.onSetEmailAddresses,this)),Common.Gateway.on("processmailmerge",i.bind(this.onProcessMailMerge,this))),this},createDelayedControls:function(){var t=this,n=DE.enumLockMM;this.btnInsField=new Common.UI.Button({parentEl:e("#mmerge-btn-ins-field",t.$el),cls:"btn-text-menu-default",caption:this.textInsertField,style:"width: 100%;",lock:[n.noFields,n.preview,n.coAuth,n.lostConnect],menu:new Common.UI.Menu({style:"min-width: 190px;max-width: 400px;",maxHeight:200,items:[]})}),this.txtFieldNum=new Common.UI.InputField({el:e("#mmerge-field-num",t.$el),allowBlank:!0,validateOnChange:!1,style:"width: 80px; vertical-align: middle;",maskExp:/[0-9]/,value:1,validation:function(e){return/(^[0-9]+$)/.test(e)?(e=parseInt(e),void 0===e||null===e||e<1?t.txtFieldNum.setValue(1):e>t._state.recipientsCount&&t.txtFieldNum.setValue(t._state.recipientsCount)):t.txtFieldNum.setValue(1),!0},lock:[n.noRecipients,n.lostConnect]}).on("changed:after",function(e,i,n,o){var s=parseInt(t.txtFieldNum.getValue());s!==parseInt(n)&&(t.api.asc_PreviewMailMergeResult(s-1),t.fireEvent("editcomplete",t))}),this.emptyDBControls.push(this.txtFieldNum),this.btnEditData=new Common.UI.Button({el:t.$el.find("#mmerge-button-edit-data"),lock:[n.preview,n.lostConnect]}),this.btnEditData.on("click",i.bind(this.onEditData,this)),this.lblAddRecipients=e("#mmerge-lbl-add-recipients"),this.chHighlight=new Common.UI.CheckBox({el:t.$el.find("#mmerge-switcher-highlight"),labelText:this.textHighlight,lock:[n.noFields,n.lostConnect]}),this.chHighlight.on("change",i.bind(this.onCheckHighlightChange,this)),this.chPreview=new Common.UI.CheckBox({el:t.$el.find("#mmerge-switcher-preview"),labelText:this.textPreview,lock:[n.noRecipients,n.lostConnect]}),this.chPreview.on("change",i.bind(this.onCheckPreviewChange,this)),this.emptyDBControls.push(this.chPreview),this.btnFirst=new Common.UI.Button({parentEl:e("#mmerge-button-first",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-firstitem",disabled:!0,value:0,hint:this.txtFirst,lock:[n.noRecipients,n.lostConnect]}),this.btnFirst.on("click",i.bind(this.onBtnPreviewFieldClick,this)),this.emptyDBControls.push(this.btnFirst),this.btnPrev=new Common.UI.Button({parentEl:e("#mmerge-button-prev",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-previtem",disabled:!0,value:1,hint:this.txtPrev,lock:[n.noRecipients,n.lostConnect]}),this.btnPrev.on("click",i.bind(this.onBtnPreviewFieldClick,this)),this.emptyDBControls.push(this.btnPrev),this.btnNext=new Common.UI.Button({parentEl:e("#mmerge-button-next",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-nextitem",value:2,hint:this.txtNext,lock:[n.noRecipients,n.lostConnect]}),this.btnNext.on("click",i.bind(this.onBtnPreviewFieldClick,this)),this.emptyDBControls.push(this.btnNext),this.btnLast=new Common.UI.Button({parentEl:e("#mmerge-button-last",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-lastitem",value:3,hint:this.txtLast,lock:[n.noRecipients,n.lostConnect]}),this.btnLast.on("click",i.bind(this.onBtnPreviewFieldClick,this)),this.emptyDBControls.push(this.btnLast),this._arrMergeSrc=[{displayValue:this.textPdf,value:Asc.c_oAscFileType.PDF},{displayValue:this.textDocx,value:Asc.c_oAscFileType.DOCX},{displayValue:this.textEmail,value:Asc.c_oAscFileType.HTML}],this.cmbMergeTo=new Common.UI.ComboBox({el:e("#mmerge-combo-merge-to",t.$el),cls:"input-group-nr",style:"width: 100%;",menuStyle:"min-width: 190px;",editable:!1,data:this._arrMergeSrc,lock:[n.noRecipients,n.lostConnect]}),this.cmbMergeTo.setValue(this._arrMergeSrc[0].value),this.cmbMergeTo.on("selected",i.bind(this.onCmbMergeToSelect,this)),this.emptyDBControls.push(this.cmbMergeTo),this.radioAll=new Common.UI.RadioBox({el:e("#mmerge-radio-all",t.$el),labelText:this.textAll,name:"asc-radio-merge",checked:!0,lock:[n.noRecipients,n.lostConnect]}).on("change",i.bind(this.onRadioAllCurrent,this)),this.emptyDBControls.push(this.radioAll),this.radioCurrent=new Common.UI.RadioBox({el:e("#mmerge-radio-current",t.$el),labelText:this.textCurrent,name:"asc-radio-merge",lock:[n.noRecipients,n.lostConnect]}).on("change",i.bind(this.onRadioAllCurrent,this)),this.emptyDBControls.push(this.radioCurrent),this.radioFromTo=new Common.UI.RadioBox({el:e("#mmerge-radio-from-to",t.$el),labelText:this.textFrom,name:"asc-radio-merge",lock:[n.noRecipients,n.lostConnect]}).on("change",i.bind(this.onRadioFromToChange,this)),this.emptyDBControls.push(this.radioFromTo),this.txtFieldFrom=new Common.UI.InputField({el:e("#mmerge-field-from",t.$el),allowBlank:!0,validateOnChange:!1,style:"width: 50px;",maskExp:/[0-9]/,value:0,disabled:!0,lock:[n.radioAllCurr,n.noRecipients,n.lostConnect],validation:function(e){/(^[0-9]+$)/.test(e)?(e=parseInt(e),void 0===e||null===e||e<1?t.txtFieldFrom.setValue(1):e>t._state.recipientsCount&&t.txtFieldFrom.setValue(t._state.recipientsCount)):t.txtFieldFrom.setValue(1),e=parseInt(t.txtFieldFrom.getValue());var i=Math.min(t._state.recipientsCount,e+99);if(parseInt(t.txtFieldTo.getValue())>i&&t.txtFieldTo.setValue(i),t._checkFromToValues){if(e>parseInt(t.txtFieldTo.getValue()))return t.txtFromToError;t._checkFromToValues=!1,t.txtFieldTo.checkValidate()}return!0}}),this.emptyDBControls.push(this.txtFieldFrom),this.txtFieldTo=new Common.UI.InputField({el:e("#mmerge-field-to",t.$el),allowBlank:!0,validateOnChange:!1,style:"width: 50px;",maskExp:/[0-9]/,value:0,disabled:!0,lock:[n.radioAllCurr,n.noRecipients,n.lostConnect],validation:function(e){if(/(^[0-9]+$)/.test(e))if(void 0===(e=parseInt(e))||null===e||e<1)t.txtFieldTo.setValue(1);else{var i=Math.min(t._state.recipientsCount,parseInt(t.txtFieldFrom.getValue())+99);e>i&&t.txtFieldTo.setValue(i)}else t.txtFieldTo.setValue(1);if(t._checkFromToValues){if(parseInt(t.txtFieldFrom.getValue())>parseInt(t.txtFieldTo.getValue()))return t.txtFromToError;t._checkFromToValues=!1,t.txtFieldFrom.checkValidate()}return!0}}),this.txtFieldTo.on("changed:after",function(){t._isToChanged=!0}),this.emptyDBControls.push(this.txtFieldTo),this.onRadioAllCurrent(this.radioAll,!0),this.btnDownload=new Common.UI.Button({el:e("#mmerge-button-download",t.$el),lock:[n.noRecipients,n.lostConnect]}).on("click",i.bind(this.onDownloadClick,this,!0)),this.emptyDBControls.push(this.btnDownload),this.btnPortal=new Common.UI.Button({el:e("#mmerge-button-portal",t.$el),lock:[n.noRecipients,n.lostConnect]}).on("click",i.bind(this.onDownloadClick,this,!1)),this.btnMerge=new Common.UI.Button({el:e("#mmerge-button-merge",t.$el),lock:[n.noRecipients,n.lostConnect]}).on("click",i.bind(this.onMergeClick,this,!1)),this.emptyDBControls.push(this.btnMerge),this.linkReadMore=e("#mmerge-readmore-link",this.$el),this.$el.on("click","#mmerge-readmore-link",i.bind(this.openHelp,this)),this.mode&&(this.mode.canRequestSaveAs||this.mode.mergeFolderUrl||this.btnPortal.setVisible(!1),this.mode.canSendEmailAddresses||(this._arrMergeSrc.pop(),this.cmbMergeTo.setData(this._arrMergeSrc),this.cmbMergeTo.setValue(this._arrMergeSrc[0].value))),this._initSettings=!1},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedControls(),this.disableInsertControls(this._locked),t){var e=this;this._state.recipientsCount=t.recipientsCount,this._state.fieldsList=t.fieldsList?t.fieldsList:[],this.btnInsField.menu.items.length<1&&i.each(this._state.fieldsList,function(t,i){var n=new Common.UI.MenuItem({caption:"Â«"+t+"Â»",field:t}).on("click",function(t,i){e.api&&(e.api.asc_AddMailMergeField(t.options.field),e.fireEvent("editcomplete",e))});e.btnInsField.menu.addItem(n)});var n=parseInt(this.txtFieldFrom.getValue());n=isNaN(n)?0:n-1,(n<0||n>this._state.recipientsCount-1)&&(n=0);var o=this._isToChanged?parseInt(this.txtFieldTo.getValue()):this._state.recipientsCount;o=isNaN(o)?0:o-1,(o<0||o>this._state.recipientsCount-1)&&(o=Math.max(this._state.recipientsCount-1,0)),n>o&&(n=0,o=this._state.recipientsCount-1),this.txtFieldFrom.setValue(n+1),this.txtFieldTo.setValue(Math.min(o+1,n+100));var s=parseInt(this.txtFieldNum.getValue());s=isNaN(s)?0:s-1,s<0&&(s=0),s>this._state.recipientsCount-1&&(s=this._state.recipientsCount-1),this.lockControls(DE.enumLockMM.noRecipients,this._state.recipientsCount<1,{array:this.mode.canRequestSaveAs||this.mode.mergeFolderUrl?[this.btnPortal]:[],merge:!0}),this.lockControls(DE.enumLockMM.noFields,this._state.fieldsList.length<1,{array:[this.btnInsField,this.chHighlight]}),this.lblAddRecipients[this._state.fieldsList.length<1?"show":"hide"](),this.disableFieldBtns(s)}},onEditData:function(){var t=DE.getController("Common.Controllers.ExternalMergeEditor").getView("Common.Views.ExternalMergeEditor");if(t){t.show();var e=this.api.asc_getMailMergeData();e&&t.setMergeData(e)}},onCheckHighlightChange:function(t,e,i){this.api&&this.api.asc_SetHighlightMailMergeFields("checked"==t.getValue()),this.fireEvent("editcomplete",this)},onCheckPreviewChange:function(t,e,i){var n="checked"==t.getValue(),o=parseInt(this.txtFieldNum.getValue());this.api&&(n?this.api.asc_PreviewMailMergeResult(isNaN(o)?0:o-1):this.api.asc_EndPreviewMailMergeResult()),this.fireEvent("editcomplete",this)},onRadioFromToChange:function(t,e,i){e&&this.lockControls(DE.enumLockMM.radioAllCurr,!1,{array:[this.txtFieldFrom,this.txtFieldTo]})},onRadioAllCurrent:function(t,e,i){e&&this.lockControls(DE.enumLockMM.radioAllCurr,!0,{array:[this.txtFieldFrom,this.txtFieldTo]})},checkFromToValues:function(){this._checkFromToValues=!0;var t=this.txtFieldFrom.checkValidate(),e=this.txtFieldTo.checkValidate();return!0!==t||!0!==e?(this.txtFieldTo.cmpEl.find("input").focus(),!1):(this._checkFromToValues=!1,!0)},onDownloadClick:function(t,n,o){if(this.api){var s=0,a=Math.min(Math.max(this._state.recipientsCount-1,0),99);if(this.radioCurrent.getValue())s=a=parseInt(this.txtFieldNum.getValue())-1;else if(this.radioFromTo.getValue()){if(!this.checkFromToValues())return;s=parseInt(this.txtFieldFrom.getValue())-1,a=parseInt(this.txtFieldTo.getValue())-1,a=Math.min(a,s+99),this.txtFieldTo.setValue(a+1)}if(this.api.asc_DownloadAsMailMerge(this.cmbMergeTo.getValue(),s,a,t)){if(!t){var r=DE.getController("Main");r.loadMask||(r.loadMask=new Common.UI.LoadMask({owner:e("#viewport")})),r.loadMask.setTitle(this.downloadMergeTitle),r.loadMask.show()}}else{var l={closable:!1,title:this.notcriticalErrorTitle,msg:this.errorMailMergeSaveFile,iconCls:"warn",buttons:["ok"],callback:i.bind(function(t){this.fireEvent("editcomplete",this)},this)};Common.UI.alert(l)}}},onSaveMailMerge:function(t){var e=DE.getController("Main").loadMask;if(e&&e.hide(),!this._mailMergeDlg){var i=this;if(this.cmbMergeTo.getValue()!=Asc.c_oAscFileType.HTML){var n=i.defFileName+(this.cmbMergeTo.getValue()==Asc.c_oAscFileType.PDF?".pdf":".docx");i.mode.canRequestSaveAs?Common.Gateway.requestSaveAs(t,n):(i._mailMergeDlg=new Common.Views.SaveAsDlg({saveFolderUrl:i.mode.mergeFolderUrl,saveFileUrl:t,defFileName:n}),i._mailMergeDlg.on("saveasfolder",function(t,e){}).on("saveaserror",function(t,e){var n={closable:!1,title:i.notcriticalErrorTitle,msg:e,iconCls:"warn",buttons:["ok"],callback:function(t){i.fireEvent("editcomplete",i)}};Common.UI.alert(n)}).on("close",function(t){i._mailMergeDlg=void 0}),i._mailMergeDlg.show())}}},onMergeClick:function(t,i,n){var o=0,s=Math.min(Math.max(this._state.recipientsCount-1,0),99);if(this.radioFromTo.getValue()){if(!this.checkFromToValues())return;o=parseInt(this.txtFieldFrom.getValue())-1,s=parseInt(this.txtFieldTo.getValue())-1,s=Math.min(s,o+99),this.txtFieldTo.setValue(s+1)}if(void 0==this.emailAddresses){var a=DE.getController("Main");a.loadMask||(a.loadMask=new Common.UI.LoadMask({owner:e("#viewport")})),a.loadMask.setTitle(this.requestMailsTitle),a.loadMask.show(),Common.Gateway.requestEmailAddresses()}else this.showMergeMailDlg()},onSetEmailAddresses:function(t){var e=DE.getController("Main").loadMask;if(e&&e.hide(),t&&t.data)if(t.data.error){var n={width:500,closable:!1,title:this.notcriticalErrorTitle,msg:t.data.error,iconCls:"warn",buttons:i.isEmpty(t.data.createEmailAccountUrl)?["ok"]:["custom","cancel"],primary:i.isEmpty(t.data.createEmailAccountUrl)?["ok"]:"custom",customButtonText:this.textGoToMail,callback:i.bind(function(e){"custom"==e&&window.open(t.data.createEmailAccountUrl,"_blank"),this.fireEvent("editcomplete",this)},this)};Common.UI.alert(n)}else this.emailAddresses=t.data.emailAddresses,this.showMergeMailDlg()},showMergeMailDlg:function(){if(!this._mailMergeDlg){var t=this;t._mailMergeDlg=new DE.Views.MailMergeEmailDlg({props:{fieldsList:this._state.fieldsList,emailAddresses:this.emailAddresses},handler:function(i,n){if("ok"==i){t.mergeMailData=n;var o=DE.getController("Main");o.loadMask||(o.loadMask=new Common.UI.LoadMask({owner:e("#viewport")})),o.loadMask.setTitle(t.downloadMergeTitle),o.loadMask.show(),Common.Gateway.requestStartMailMerge()}t.fireEvent("editcomplete",t)}}),t._mailMergeDlg.on("close",function(e){t._mailMergeDlg=void 0}),t._mailMergeDlg.show()}},onProcessMailMerge:function(t){var e=DE.getController("Main").loadMask;if(e&&e.hide(),t)if(t.enabled)this.sendMergeDataByEmail();else{var n={closable:!1,title:this.notcriticalErrorTitle,msg:i.isEmpty(t.message)?this.warnProcessMailMerge:t.message,iconCls:"warn",buttons:["ok"],callback:i.bind(function(t){this.fireEvent("editcomplete",this)},this)};Common.UI.alert(n)}},sendMergeDataByEmail:function(){if(this.api){var t=0,e=Math.min(Math.max(this._state.recipientsCount-1,0),99);this.radioCurrent.getValue()?t=e=parseInt(this.txtFieldNum.getValue())-1:this.radioFromTo.getValue()&&(t=parseInt(this.txtFieldFrom.getValue())-1,e=parseInt(this.txtFieldTo.getValue())-1);var i=new Asc.CMailMergeSendData;i.put_RecordFrom(t),i.put_RecordTo(e),i.put_From(this.mergeMailData.from),i.put_To(this.mergeMailData.to),i.put_Subject(this.mergeMailData.subject),i.put_MailFormat(this.mergeMailData.mailFormat),this.mergeMailData.mailFormat!==Asc.c_oAscFileType.HTML&&(i.put_FileName(this.mergeMailData.fileName),i.put_Message(this.mergeMailData.message)),this.api.asc_sendMailMergeData(i),this.fireEvent("editcomplete",this)}},onLongActionEnd:function(t,e){e==Asc.c_oAscAsyncAction.SendMailMerge&&Common.UI.info({closable:!1,width:500,msg:this.textSendMsg,iconCls:"info",buttons:["ok"],callback:i.bind(function(t){this.fireEvent("editcomplete",this)},this)})},onBtnPreviewFieldClick:function(t,e){var i=parseInt(this.txtFieldNum.getValue());switch(i=isNaN(i)?0:i-1,t.options.value){case 0:i=0;break;case 1:i--;break;case 2:i++;break;case 3:i=this._state.recipientsCount-1}i<0&&(i=0),i>this._state.recipientsCount-1&&(i=this._state.recipientsCount-1),this.api.asc_PreviewMailMergeResult(i),this.fireEvent("editcomplete",this)},disableFieldBtns:function(t){var e=this._state.recipientsCount<1||"checked"!==this.chPreview.getValue(),i=e||t<1;this.btnFirst.isDisabled()!==i&&this.btnFirst.setDisabled(i),this.btnPrev.isDisabled()!==i&&this.btnPrev.setDisabled(i),i=e||t>this._state.recipientsCount-2,this.btnLast.isDisabled()!==i&&this.btnLast.setDisabled(i),this.btnNext.isDisabled()!==i&&this.btnNext.setDisabled(i),i=e||t<0,this.txtFieldNum.isDisabled()!==i&&this.txtFieldNum.setDisabled(i),t>=0&&this.txtFieldNum.setValue(t+1)},onPreviewMailMergeResult:function(t){"checked"!==this.chPreview.getValue()&&this.chPreview.setValue(!0),this.disableFieldBtns(t),this.disableEditing(!0)},onEndPreviewMailMergeResult:function(){"checked"==this.chPreview.getValue()&&this.chPreview.setValue(!1),this.disableFieldBtns(-1),this.disableEditing(!1)},onStartMailMerge:function(){this.btnInsField&&this.btnInsField.menu.removeAll(),this.txtFieldNum&&this.txtFieldNum.setValue(1),this.ChangeSettings({recipientsCount:this.api.asc_GetReceptionsCount(),fieldsList:this.api.asc_GetMailMergeFieldsNameList()})},onCmbMergeToSelect:function(t,e){var i=e.value==Asc.c_oAscFileType.HTML;this.btnMerge.setVisible(i),this.btnPortal.setVisible(!i&&(this.mode.canRequestSaveAs||this.mode.mergeFolderUrl)),this.btnDownload.setVisible(!i)},setLocked:function(t){this._locked=t},disableControls:function(t){this._initSettings||this.lockControls(DE.enumLockMM.lostConnect,t,{array:i.union([this.btnEditData,this.btnInsField,this.chHighlight],this.mode.canRequestSaveAs||this.mode.mergeFolderUrl?[this.btnPortal]:[]),merge:!0})},disableInsertControls:function(t){this.lockControls(DE.enumLockMM.coAuth,t,{array:[this.btnInsField]})},setMode:function(t){this.mode=t},disableEditing:function(t){DE.getController("Toolbar").DisableToolbar(t,t),DE.getController("RightMenu").SetDisabled(t,!0),DE.getController("Statusbar").getView("Statusbar").SetDisabled(t),DE.getController("Common.Controllers.ReviewChanges").SetDisabled(t),DE.getController("DocumentHolder").getView().SetDisabled(t),DE.getController("Navigation")&&DE.getController("Navigation").SetDisabled(t);var e=DE.getController("Common.Controllers.Comments");e&&e.setPreviewMode(t),DE.getController("LeftMenu").setPreviewMode(t),this.lockControls(DE.enumLockMM.preview,t,{array:[this.btnInsField,this.btnEditData]})},setDocumentName:function(t){this.defFileName=t||this.txtUntitled;var e=this.defFileName.lastIndexOf(".");e>0&&(this.defFileName=this.defFileName.substring(0,e))},openHelp:function(t){DE.getController("LeftMenu").getView("LeftMenu").showMenu("file:help","UsageInstructions/UseMailMerge.htm")},disablePreviewMode:function(){this.api&&this.chPreview&&"checked"==this.chPreview.getValue()&&this.api.asc_EndPreviewMailMergeResult()},lockControls:function(t,e,i){Common.Utils.lockControls(t,e,i,this.emptyDBControls)},textDataSource:"Data Source",textEditData:"Edit recipients list",textInsertField:"Insert Merge Field",textHighlight:"Highlight merge fields",textPreview:"Preview results",textPdf:"PDF",textDocx:"Docx",textEmail:"E-mail",txtFirst:"To first field",txtPrev:"To previous field",txtNext:"To next field",txtLast:"To last field",textMergeTo:"Merge to",textAll:"All records",textCurrent:"Current record",textFrom:"From",textTo:"To",textDownload:"Download",textPortal:"Save",errorMailMergeSaveFile:"Merge failed.",downloadMergeTitle:"Merging",requestMailsTitle:"Requesting e-mails",textMerge:"Merge",sendTitle:"Send e-mail",textSendMsg:"All mail messages are ready and will be sent out within some time.<br>The speed of mailing depends on your mail service.<br>You can continue working with document or close it. After the operation is over the notification will be sent to your registration email address.",notcriticalErrorTitle:"Warning",warnProcessMailMerge:"Starting merge failed",txtUntitled:"Untitled",textMaxRecepients:"Max 100 recipients.",textReadMore:"Read more",txtFromToError:'"From" value must be less than "To" value',textMergeFields:"Merge Fields",textGoToMail:"Go to Mail",textAddRecipients:"Add some recipients to the list first"},DE.Views.MailMergeSettings||{}))}),define("text!documenteditor/main/app/template/TextArtSettings.template",[],function(){return'<table cols="1">\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.textTemplate %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="" id="textart-combo-template" style="width: 100%; height: 64px;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.strFill %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="textart-combo-fill-src" style="width: 100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <div id="textart-panel-color-fill" class="padding-small" style="width: 100%;">\r\n                <div id="textart-back-color-btn" style=""></div>\r\n            </div>\r\n            <div id="textart-panel-gradient-fill" class="settings-hidden padding-small" style="width: 100%;">\r\n                <table cols="3" style="margin-bottom: 10px;">\r\n                    <tr valign="top">\r\n                        <td colspan="2">\r\n                            <div>\r\n                                <label class="input-label" style=""><%= scope.textStyle %></label>\r\n                                <div id="textart-combo-grad-type" style="width: 100%;"></div>\r\n                            </div>\r\n                        </td>\r\n                        <td rowspan="2" style="width: 100%;">\r\n                            <div style="float: right;">\r\n                                <label class="input-label"><%= scope.textDirection %></label>\r\n                                <div id="textart-button-direction"></div>\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                    <tr valign="bottom">\r\n                        <td>\r\n                            <label class="input-label" style="margin-right: 5px;margin-bottom: 3px;"><%= scope.textAngle %></label>\r\n                        </td>\r\n                        <td>\r\n                            <div id="textart-spin-gradient-angle" style="display: inline-block; width: 60px;"></div>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n                <label class="input-label" style="display:block;margin-bottom: 5px;"><%= scope.textGradient %></label>\r\n                <div style="display: inline-block; margin-top: 3px;">\r\n                    <div id="textart-slider-gradient" style="display: inline-block; vertical-align: middle;"></div>\r\n                </div>\r\n                <div style="height: 40px;margin-top:6px;display:flex;justify-content:space-between;">\r\n                    <div style="display: flex;">\r\n                    <div style="">\r\n                        <label class="input-label" style=""><%= scope.strColor %></label>\r\n                        <div id="textart-gradient-color-btn"></div>\r\n                    </div>\r\n                    <div style="margin-left: 10px;">\r\n                        <label class="input-label" style=""><%= scope.textPosition %></label>\r\n                        <div id="textart-gradient-position"></div>\r\n                    </div>\r\n                    </div>\r\n                    <div style="display:flex;padding-top:15px;">\r\n                        <div id="textart-gradient-add-step"></div>\r\n                        <div id="textart-gradient-remove-step"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <div class="padding-small" id="textart-panel-transparent-fill" style="width: 100%;">\r\n                <label class="header" style="display:block;"><%= scope.strTransparency %></label>\r\n                <div style="display: inline-block; margin-top: 3px;">\r\n                    <label id="textart-lbl-transparency-start">0</label>\r\n                    <div id="textart-slider-transparency" style="display: inline-block;margin: 0 4px; vertical-align: middle;"></div>\r\n                    <label id="textart-lbl-transparency-end">100</label>\r\n                </div>\r\n                <div id="textart-spin-transparency" style="display: inline-block;float: right;"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.strStroke %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n        <div style="display:inline-block;width:100px;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strSize %></label>\r\n            <div id="textart-combo-border-size" style="width: 93px;"></div>\r\n        </div>\r\n        <div style="display:inline-block;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strColor %></label>\r\n            <div id="textart-border-color-btn" style=""></div>\r\n        </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n        <div style="display:inline-block;width:100px;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strType %></label>\r\n            <div id="textart-combo-border-type" style="width: 93px;"></div>\r\n        </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.textTransform %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="" id="textart-combo-transform" style="width: 100%; height: 42px;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'}),define("documenteditor/main/app/view/TextArtSettings",["text!documenteditor/main/app/template/TextArtSettings.template","jquery","underscore","backbone","common/main/lib/component/ComboBox","common/main/lib/component/ComboBorderSize","common/main/lib/component/MetricSpinner","common/main/lib/component/ThemeColorPalette","common/main/lib/component/ColorButton","common/main/lib/component/ComboDataView","common/main/lib/component/Slider","common/main/lib/component/MultiSliderGradient"],function(t,e,i,n){"use strict";DE.Views.TextArtSettings=n.View.extend(i.extend({el:"#id-textart-settings",template:i.template(t),events:{},options:{alias:"TextArtSettings"},initialize:function(){this._initSettings=!0,this._noApply=!0,this.imgprops=null,this.shapeprops=null,this._sendUndoPoint=!0,this._sliderChanged=!1,this.txtPt=Common.Utils.Metric.getMetricName(Common.Utils.Metric.c_MetricUnits.pt),this._state={Transparency:null,FillType:Asc.c_oAscFill.FILL_TYPE_SOLID,ShapeColor:"transparent",StrokeType:Asc.c_oAscStrokeType.STROKE_COLOR,StrokeWidth:this._pt2mm(1),StrokeColor:"000000",StrokeBorderType:Asc.c_oDashType.solid,GradColor:"000000",GradFillType:Asc.c_oAscFillGradType.GRAD_LINEAR,FormId:null,DisabledControls:!1,applicationPixelRatio:Common.Utils.applicationPixelRatio()},this.lockedControls=[],this._locked=!1,this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_SOLID,this.ShapeColor={Value:1,Color:"transparent"},this.GradFillType=Asc.c_oAscFillGradType.GRAD_LINEAR,this.GradColor={values:[0,100],colors:["000000","ffffff"],currentIdx:0},this.GradRadialDirectionIdx=0,this.GradLinearDirectionType=0,this.BorderColor={Value:1,Color:"transparent"},this.BorderSize=0,this.BorderType=Asc.c_oDashType.solid,DE.getCollection("Common.Collections.TextArt").bind({reset:this.fillTextArt.bind(this)}),this.render()},render:function(){(this.$el||e(this.el)).html(this.template({scope:this})),this.FillColorContainer=e("#textart-panel-color-fill"),this.FillGradientContainer=e("#textart-panel-gradient-fill"),this.TransparencyContainer=e("#textart-panel-transparent-fill"),e(window).on("resize",i.bind(this.onWindowResize,this))},setApi:function(t){return this.api=t,this},onFillSrcSelect:function(t,e){switch(this.ShowHideElem(e.value),e.value){case Asc.c_oAscFill.FILL_TYPE_SOLID:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_SOLID,!this._noApply){var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CShapeFill;n.put_type(Asc.c_oAscFill.FILL_TYPE_SOLID),n.put_fill(new Asc.asc_CFillSolid),n.get_fill().put_color(Common.Utils.ThemeColor.getRgbColor("transparent"==this.ShapeColor.Color?{color:"4f81bd",effectId:24}:this.ShapeColor.Color)),i.asc_putFill(n),this.shapeprops.put_TextArtProperties(i),this.api.ImgApply(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_GRAD:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_GRAD,!this._noApply){var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CShapeFill;if(n.put_type(Asc.c_oAscFill.FILL_TYPE_GRAD),n.put_fill(new Asc.asc_CFillGrad),n.get_fill().put_grad_type(this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(n.get_fill().put_linear_angle(6e4*this.GradLinearDirectionType),n.get_fill().put_linear_scale(!0)),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD){this.GradColor.values=[0,100],this.GradColor.colors=[this.GradColor.colors[0],this.GradColor.colors[this.GradColor.colors.length-1]],this.GradColor.currentIdx=0;var o=Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[0]).get_color().get_hex(),s=Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1]).get_color().get_hex();o="ffffff"===o&&"ffffff"===s?{color:"4f81bd",effectId:24}:this.GradColor.colors[0],n.get_fill().put_positions([1e3*this.GradColor.values[0],1e3*this.GradColor.values[1]]),
n.get_fill().put_colors([Common.Utils.ThemeColor.getRgbColor(o),Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1])])}i.asc_putFill(n),this.shapeprops.put_TextArtProperties(i),this.api.ImgApply(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_NOFILL:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_NOFILL,!this._noApply){var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CShapeFill;n.put_type(Asc.c_oAscFill.FILL_TYPE_NOFILL),n.put_fill(null),i.asc_putFill(n),this.shapeprops.put_TextArtProperties(i),this.api.ImgApply(this.imgprops)}}this.fireEvent("editcomplete",this)},onColorsBackSelect:function(t,e){if(this.ShapeColor={Value:1,Color:e},this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CShapeFill;"transparent"==this.ShapeColor.Color?(n.put_type(Asc.c_oAscFill.FILL_TYPE_NOFILL),n.put_fill(null)):(n.put_type(Asc.c_oAscFill.FILL_TYPE_SOLID),n.put_fill(new Asc.asc_CFillSolid),n.get_fill().put_color(Common.Utils.ThemeColor.getRgbColor(this.ShapeColor.Color))),i.asc_putFill(n),this.shapeprops.put_TextArtProperties(i),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},onNumTransparencyChange:function(t,e,i,n){if(this.sldrTransparency.setValue(t.getNumberValue(),!0),this.api){var o=t.getNumberValue(),s=new Asc.asc_TextArtProperties,a=new Asc.asc_CShapeFill;a.put_transparent(2.55*o),s.asc_putFill(a),this.shapeprops.put_TextArtProperties(s),this.api.ImgApply(this.imgprops)}},onTransparencyChange:function(t,e,n){this._sliderChanged=e,this.numTransparency.setValue(e,!0),this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(i.bind(this._transparencyApplyFunc,this),100))},onTransparencyChangeComplete:function(t,e,i){clearInterval(this.updateslider),this._sliderChanged=e,this._sendUndoPoint||(this.api.setEndPointHistory(),this._transparencyApplyFunc()),this._sendUndoPoint=!0},_transparencyApplyFunc:function(){if(void 0!==this._sliderChanged){var t=new Asc.asc_TextArtProperties,e=new Asc.asc_CShapeFill;e.put_transparent(2.55*this._sliderChanged),t.asc_putFill(e),this.shapeprops.put_TextArtProperties(t),this.api.ImgApply(this.imgprops),this._sliderChanged=void 0}},onGradTypeSelect:function(t,e){if(this.GradFillType=e.value,this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){this.mnuDirectionPicker.store.reset(this._viewDataLinear),this.mnuDirectionPicker.cmpEl.width(175),this.mnuDirectionPicker.restoreHeight=174;var e=this.mnuDirectionPicker.store.findWhere({type:this.GradLinearDirectionType});this.mnuDirectionPicker.selectRecord(e,!0),e?this.btnDirection.setIconCls("item-gradient "+e.get("iconcls")):this.btnDirection.setIconCls(""),this.numGradientAngle.setValue(this.GradLinearDirectionType,!0),this.numGradientAngle.setDisabled(this._locked)}else this.GradFillType==Asc.c_oAscFillGradType.GRAD_PATH&&(this.mnuDirectionPicker.store.reset(this._viewDataRadial),this.mnuDirectionPicker.cmpEl.width(60),this.mnuDirectionPicker.restoreHeight=58,this.mnuDirectionPicker.selectByIndex(this.GradRadialDirectionIdx,!0),this.GradRadialDirectionIdx>=0?this.btnDirection.setIconCls("item-gradient "+this._viewDataRadial[this.GradRadialDirectionIdx].iconcls):this.btnDirection.setIconCls(""),this.numGradientAngle.setValue(0,!0),this.numGradientAngle.setDisabled(!0));if(this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CShapeFill;n.put_type(Asc.c_oAscFill.FILL_TYPE_GRAD),n.put_fill(new Asc.asc_CFillGrad),n.get_fill().put_grad_type(this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(n.get_fill().put_linear_angle(6e4*this.GradLinearDirectionType),n.get_fill().put_linear_scale(!0)),i.asc_putFill(n),this.shapeprops.put_TextArtProperties(i),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},onSelectGradient:function(t,e,n,o){if(!this._noApply){var s={};if(i.isFunction(o.toJSON)){if(!o.get("selected"))return;s=o.toJSON()}else s=o;if(this.btnDirection.setIconCls("item-gradient "+s.iconcls),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR?this.GradLinearDirectionType=s.type:this.GradRadialDirectionIdx=0,this.api&&this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){this.numGradientAngle.setValue(s.type,!0);var a=new Asc.asc_TextArtProperties,r=new Asc.asc_CShapeFill;r.put_type(Asc.c_oAscFill.FILL_TYPE_GRAD),r.put_fill(new Asc.asc_CFillGrad),r.get_fill().put_grad_type(this.GradFillType),r.get_fill().put_linear_angle(6e4*s.type),r.get_fill().put_linear_scale(!0),a.asc_putFill(r),this.shapeprops.put_TextArtProperties(a),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)}},onColorsGradientSelect:function(t,e){if(this.GradColor.colors[this.GradColor.currentIdx]=e,this.sldrGradient.setColorValue(Common.Utils.String.format("#{0}","object"==typeof e?e.color:e)),this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CShapeFill;n.put_type(Asc.c_oAscFill.FILL_TYPE_GRAD),n.put_fill(new Asc.asc_CFillGrad),n.get_fill().put_grad_type(this.GradFillType);var o=[];this.GradColor.colors.forEach(function(t){o.push(Common.Utils.ThemeColor.getRgbColor(t))}),n.get_fill().put_colors(o),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD&&(this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(n.get_fill().put_linear_angle(6e4*this.GradLinearDirectionType),n.get_fill().put_linear_scale(!0)),o=[],this.GradColor.values.forEach(function(t){o.push(1e3*t)}),n.get_fill().put_positions(o)),i.asc_putFill(n),this.shapeprops.put_TextArtProperties(i),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},onGradientChange:function(t,e,n){this.GradColor.values=t.getValues(),this.spnGradPosition.setValue(this.GradColor.values[this.GradColor.currentIdx],!0),this._sliderChanged=!0,this.api&&!this._noApply&&this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(i.bind(this._gradientApplyFunc,this),100))},onGradientChangeComplete:function(t,e,i){clearInterval(this.updateslider),this._sliderChanged=!0,this._sendUndoPoint||(this.api.setEndPointHistory(),this._gradientApplyFunc()),this._sendUndoPoint=!0},_gradientApplyFunc:function(){if(this._sliderChanged){var t=new Asc.asc_TextArtProperties,e=new Asc.asc_CShapeFill;e.put_type(Asc.c_oAscFill.FILL_TYPE_GRAD),e.put_fill(new Asc.asc_CFillGrad),e.get_fill().put_grad_type(this.GradFillType);var i=[];this.GradColor.values.forEach(function(t){i.push(1e3*t)}),e.get_fill().put_positions(i),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD&&(this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(e.get_fill().put_linear_angle(6e4*this.GradLinearDirectionType),e.get_fill().put_linear_scale(!0)),i=[],this.GradColor.colors.forEach(function(t){i.push(Common.Utils.ThemeColor.getRgbColor(t))}),e.get_fill().put_colors(i)),t.asc_putFill(e),this.shapeprops.put_TextArtProperties(t),this.api.ImgApply(this.imgprops),this._sliderChanged=!1}},applyBorderSize:function(t){if(t=Common.Utils.String.parseFloat(t),t=isNaN(t)?0:Math.max(0,Math.min(1584,t)),this.BorderSize=t,this.api&&!this._noApply){var e=new Asc.asc_TextArtProperties,i=new Asc.asc_CStroke;this.BorderSize<1e-5?(i.put_type(Asc.c_oAscStrokeType.STROKE_NONE),this._state.StrokeType=this._state.StrokeWidth=-1):(i.put_type(Asc.c_oAscStrokeType.STROKE_COLOR),"transparent"==this.BorderColor.Color||"transparent"==this.BorderColor.Color.color?i.put_color(Common.Utils.ThemeColor.getRgbColor({color:"000000",effectId:29})):this._state.StrokeType!=Asc.c_oAscStrokeType.STROKE_NONE&&null!==this._state.StrokeType||i.put_color(Common.Utils.ThemeColor.getRgbColor(Common.Utils.ThemeColor.colorValue2EffectId(this.BorderColor.Color))),i.asc_putPrstDash(this.BorderType),i.put_width(this._pt2mm(this.BorderSize))),e.asc_putLine(i),this.shapeprops.put_TextArtProperties(e),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},onComboBlur:function(){this.fireEvent("editcomplete",this)},onBorderSizeChanged:function(t,e,n,o){var s=this;if(t){var a=parseFloat(n.value);(!new RegExp("^\\s*(\\d*(\\.|,)?\\d+)\\s*("+s.txtPt+")?\\s*$").exec(n.value)||a<0||a>1584)&&(this._state.StrokeType=this._state.StrokeWidth=-1,setTimeout(function(){Common.UI.error({msg:s.textBorderSizeErr,callback:function(){i.defer(function(t){s.fireEvent("editcomplete",s)})}})},10))}else this.applyBorderSize(n.value)},onBorderSizeSelect:function(t,e){this.applyBorderSize(e.value)},onBorderTypeSelect:function(t,e){if(this.BorderType=e.value,this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CStroke;this.BorderSize<1e-5?n.put_type(Asc.c_oAscStrokeType.STROKE_NONE):(n.put_type(Asc.c_oAscStrokeType.STROKE_COLOR),n.put_color(Common.Utils.ThemeColor.getRgbColor(this.BorderColor.Color)),n.put_width(this._pt2mm(this.BorderSize)),n.asc_putPrstDash(this.BorderType)),i.asc_putLine(n),this.shapeprops.put_TextArtProperties(i),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},onColorsBorderSelect:function(t,e){if(this.BorderColor={Value:1,Color:e},this.api&&this.BorderSize>0&&!this._noApply){var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CStroke;this.BorderSize<1e-5?n.put_type(Asc.c_oAscStrokeType.STROKE_NONE):(n.put_type(Asc.c_oAscStrokeType.STROKE_COLOR),n.put_color(Common.Utils.ThemeColor.getRgbColor(this.BorderColor.Color)),n.put_width(this._pt2mm(this.BorderSize)),n.asc_putPrstDash(this.BorderType)),i.asc_putLine(n),this.shapeprops.put_TextArtProperties(i),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},ChangeSettings:function(t){if(null==this.imgprops?(this.imgprops=new Asc.asc_CImgProperty,this.imgprops.put_ShapeProperties(new Asc.asc_CShapeProperty),this.shapeprops=this.imgprops.get_ShapeProperties()):this.imgprops.put_ImageUrl(null),this._initSettings&&this.createDelayedElements(),t&&t.get_ShapeProperties()&&t.get_ShapeProperties().get_TextArtProperties()){var e=t.get_ShapeProperties().get_TextArtProperties();this._noApply=!0,this.disableControls(this._locked);var n=null,o=e.asc_getFill(),s=o?o.get_type():null,a=null;if(o){var r=o.get_transparent();(Math.abs(this._state.Transparency-r)>.001||Math.abs(this.numTransparency.getNumberValue()-r)>.001||(null===this._state.Transparency||null===r)&&(this._state.Transparency!==r||this.numTransparency.getNumberValue()!==r))&&(void 0!==r&&(this.sldrTransparency.setValue(null===r?100:r/255*100,!0),this.numTransparency.setValue(this.sldrTransparency.getValue(),!0)),this._state.Transparency=r)}if(null===o||void 0===o||null===s)this.OriginalFillType=null;else if(s==Asc.c_oAscFill.FILL_TYPE_NOFILL)this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_NOFILL;else if(s==Asc.c_oAscFill.FILL_TYPE_SOLID)o=o.get_fill(),a=o.get_color(),a?a.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.ShapeColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(a.get_r(),a.get_g(),a.get_b()),effectValue:a.get_value()}}:this.ShapeColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(a.get_r(),a.get_g(),a.get_b())}:this.ShapeColor={Value:0,Color:"transparent"},this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_SOLID,this.GradColor.colors[0]="transparent"!==this.ShapeColor.Color?Common.Utils.ThemeColor.colorValue2EffectId(this.ShapeColor.Color):"000000",this.GradColor.colors[this.GradColor.colors.length-1]="ffffff";else if(s==Asc.c_oAscFill.FILL_TYPE_GRAD){o=o.get_fill();var l=o.get_grad_type();if(this._state.GradFillType===l&&this.GradFillType===l||(this.GradFillType=l,n=void 0,this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR||this.GradFillType==Asc.c_oAscFillGradType.GRAD_PATH?(this.cmbGradType.setValue(this.GradFillType),n=this.cmbGradType.store.findWhere({value:this.GradFillType}),this.onGradTypeSelect(this.cmbGradType,n.attributes)):(this.cmbGradType.setValue(""),this.btnDirection.setIconCls("")),this._state.GradFillType=this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){var c=Math.floor(o.get_linear_angle()/6e4);if(Math.abs(this.GradLinearDirectionType-c)>.001){this.GradLinearDirectionType=c;var d=this.mnuDirectionPicker.store.findWhere({type:c});this.mnuDirectionPicker.selectRecord(d,!0),d?this.btnDirection.setIconCls("item-gradient "+d.get("iconcls")):this.btnDirection.setIconCls(""),this.numGradientAngle.setValue(c,!0)}}else this.numGradientAngle.setValue(0,!0);var h=this,p=o.get_colors(),m=o.get_positions(),u=p?p.length:this.GradColor.colors.length;this.sldrGradient.setThumbs(u),this.GradColor.colors.length>u&&(this.GradColor.colors.splice(u,this.GradColor.colors.length-u),this.GradColor.values.splice(u,this.GradColor.colors.length-u),this.GradColor.currentIdx=0),p&&p.forEach(function(t,e){t?t.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?(h.GradColor.colors[e]={color:Common.Utils.ThemeColor.getHexColor(t.get_r(),t.get_g(),t.get_b()),effectValue:t.get_value()},Common.Utils.ThemeColor.colorValue2EffectId(h.GradColor.colors[e])):h.GradColor.colors[e]=Common.Utils.ThemeColor.getHexColor(t.get_r(),t.get_g(),t.get_b()):h.GradColor.colors[e]="000000";var i=m[e];null!==i&&(i/=1e3,h.GradColor.values[e]=i)});for(var g=0;g<u;g++)h.sldrGradient.setColorValue(Common.Utils.String.format("#{0}","object"==typeof h.GradColor.colors[g]?h.GradColor.colors[g].color:h.GradColor.colors[g]),g),h.sldrGradient.setValue(g,h.GradColor.values[g]);(i.isUndefined(h.GradColor.currentIdx)||h.GradColor.currentIdx>=this.GradColor.colors.length)&&(h.GradColor.currentIdx=0),h.sldrGradient.setActiveThumb(h.GradColor.currentIdx),this.spnGradPosition.setValue(this.GradColor.values[this.GradColor.currentIdx]),this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_GRAD,this.ShapeColor={Value:1,Color:this.GradColor.colors[0]}}this._state.FillType!==this.OriginalFillType&&(this.cmbFillSrc.setValue(null===this.OriginalFillType?"":this.OriginalFillType),this._state.FillType=this.OriginalFillType,this.ShowHideElem(this.OriginalFillType));var b=typeof this.ShapeColor.Color,f=typeof this._state.ShapeColor;if(b!==f||"object"==b&&(this.ShapeColor.Color.effectValue!==this._state.ShapeColor.effectValue||this._state.ShapeColor.color.indexOf(this.ShapeColor.Color.color)<0)||"object"!=b&&this._state.ShapeColor.indexOf(this.ShapeColor.Color)<0){if(this.btnBackColor.setColor(this.ShapeColor.Color),"object"==typeof this.ShapeColor.Color){for(var C=!1,v=0;v<10;v++)if(Common.Utils.ThemeColor.ThemeValues[v]==this.ShapeColor.Color.effectValue){this.colorsBack.select(this.ShapeColor.Color,!0),C=!0;break}C||this.colorsBack.clearSelection()}else this.colorsBack.select(this.ShapeColor.Color,!0);this._state.ShapeColor=this.ShapeColor.Color}var _,y=e.asc_getLine(),x=y?y.get_type():null,w="transparent"==this._state.StrokeColor&&"transparent"!==this.BorderColor.Color;if(y?(x==Asc.c_oAscStrokeType.STROKE_COLOR?(a=y.get_color(),a?a.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.BorderColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(a.get_r(),a.get_g(),a.get_b()),effectValue:a.get_value()}}:this.BorderColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(a.get_r(),a.get_g(),a.get_b())}:this.BorderColor={Value:1,Color:"transparent"}):this.BorderColor={Value:1,Color:"transparent"},_=y.asc_getPrstDash()):this.BorderColor={Value:0,Color:"transparent"},b=typeof this.BorderColor.Color,f=typeof this._state.StrokeColor,w||b!==f||"object"==b&&(this.BorderColor.Color.effectValue!==this._state.StrokeColor.effectValue||this._state.StrokeColor.color.indexOf(this.BorderColor.Color.color)<0)||"object"!=b&&(this._state.StrokeColor.indexOf(this.BorderColor.Color)<0||"object"==typeof this.btnBorderColor.color)){if(this.btnBorderColor.setColor(this.BorderColor.Color),"object"==typeof this.BorderColor.Color){for(var C=!1,v=0;v<10;v++)if(Common.Utils.ThemeColor.ThemeValues[v]==this.BorderColor.Color.effectValue){this.colorsBorder.select(this.BorderColor.Color,!0),C=!0;break}C||this.colorsBorder.clearSelection()}else this.colorsBorder.select(this.BorderColor.Color,!0);this._state.StrokeColor=this.BorderColor.Color}if(this._state.StrokeType!==x||x==Asc.c_oAscStrokeType.STROKE_COLOR){if(x==Asc.c_oAscStrokeType.STROKE_COLOR){var S=y.get_width(),A=Math.abs(this._state.StrokeWidth-S)<1e-5&&!new RegExp(this.txtPt+"\\s*$").test(this.cmbBorderSize.getRawValue());if(Math.abs(this._state.StrokeWidth-S)>1e-5||A||(null===this._state.StrokeWidth||null===S)&&this._state.StrokeWidth!==S){this._state.StrokeWidth=S,null!==S&&(S=this._mm2pt(S));var k=null===S?S:i.find(this.cmbBorderSize.store.models,function(t){if(S<t.attributes.value+1e-5&&S>t.attributes.value-1e-5)return!0});k?this.cmbBorderSize.selectRecord(k):this.cmbBorderSize.setValue(null!==S?parseFloat(S.toFixed(2))+" "+this.txtPt:""),this.BorderSize=S}}else x==Asc.c_oAscStrokeType.STROKE_NONE?(this._state.StrokeWidth=0,this.BorderSize=this.cmbBorderSize.store.at(0).get("value"),this.cmbBorderSize.setValue(this.BorderSize)):(this._state.StrokeWidth=null,this.BorderSize=-1,this.cmbBorderSize.setValue(null));this._state.StrokeType=x}if(this._state.StrokeBorderType!==_&&(this.BorderType=this._state.StrokeBorderType=_,this.cmbBorderType.setValue(_)),a=this.GradColor.colors[this.GradColor.currentIdx],b=typeof a,f=typeof this._state.GradColor,b!==f||"object"==b&&(a.effectValue!==this._state.GradColor.effectValue||this._state.GradColor.color.indexOf(a.color)<0)||"object"!=b&&this._state.GradColor.indexOf(a)<0){if(this.btnGradColor.setColor(a),"object"==typeof a){for(var C=!1,v=0;v<10;v++)if(Common.Utils.ThemeColor.ThemeValues[v]==a.effectValue){this.colorsGrad.select(a,!0),C=!0;break}C||this.colorsGrad.clearSelection()}else this.colorsGrad.select(a,!0);this._state.GradColor=a}var T=e.asc_getForm();if(this._state.FormId!==T){this.cmbTransform.suspendEvents();var n=this.cmbTransform.menuPicker.store.findWhere({type:T});this.cmbTransform.menuPicker.selectRecord(n),this.cmbTransform.resumeEvents(),this._state.FormId=T}this._noApply=!1}},createDelayedControls:function(){var t=this;this._arrFillSrc=[{displayValue:this.textColor,value:Asc.c_oAscFill.FILL_TYPE_SOLID},{displayValue:this.textGradientFill,value:Asc.c_oAscFill.FILL_TYPE_GRAD},{displayValue:this.textNoFill,value:Asc.c_oAscFill.FILL_TYPE_NOFILL}],this.cmbFillSrc=new Common.UI.ComboBox({el:e("#textart-combo-fill-src"),cls:"input-group-nr",style:"width: 100%;",menuStyle:"min-width: 100%;",editable:!1,data:this._arrFillSrc}),this.cmbFillSrc.setValue(this._arrFillSrc[0].value),this.cmbFillSrc.on("selected",i.bind(this.onFillSrcSelect,this)),this.lockedControls.push(this.cmbFillSrc),this.numTransparency=new Common.UI.MetricSpinner({el:e("#textart-spin-transparency"),step:1,width:62,value:"100 %",defaultUnit:"%",maxValue:100,minValue:0}),this.numTransparency.on("change",i.bind(this.onNumTransparencyChange,this)),this.numTransparency.on("inputleave",function(){t.fireEvent("editcomplete",t)}),this.lockedControls.push(this.numTransparency),this.sldrTransparency=new Common.UI.SingleSlider({el:e("#textart-slider-transparency"),width:75,minValue:0,maxValue:100,value:100}),this.sldrTransparency.on("change",i.bind(this.onTransparencyChange,this)),this.sldrTransparency.on("changecomplete",i.bind(this.onTransparencyChangeComplete,this)),this.lockedControls.push(this.sldrTransparency),this.lblTransparencyStart=e(this.el).find("#textart-lbl-transparency-start"),this.lblTransparencyEnd=e(this.el).find("#textart-lbl-transparency-end"),this._arrGradType=[{displayValue:this.textLinear,value:Asc.c_oAscFillGradType.GRAD_LINEAR},{displayValue:this.textRadial,value:Asc.c_oAscFillGradType.GRAD_PATH}],this.cmbGradType=new Common.UI.ComboBox({el:e("#textart-combo-grad-type"),cls:"input-group-nr",menuStyle:"min-width: 100%;",editable:!1,data:this._arrGradType}),this.cmbGradType.setValue(this._arrGradType[0].value),this.cmbGradType.on("selected",i.bind(this.onGradTypeSelect,this)),this.lockedControls.push(this.cmbGradType),this._viewDataLinear=[{offsetx:0,offsety:0,type:45,subtype:-1,iconcls:"gradient-left-top"},{offsetx:50,offsety:0,type:90,subtype:4,iconcls:"gradient-top"},{offsetx:100,offsety:0,type:135,subtype:5,iconcls:"gradient-right-top"},{offsetx:0,offsety:50,type:0,subtype:6,iconcls:"gradient-left",cls:"item-gradient-separator",selected:!0},{offsetx:100,offsety:50,type:180,subtype:1,iconcls:"gradient-right"},{offsetx:0,offsety:100,type:315,subtype:2,iconcls:"gradient-left-bottom"},{offsetx:50,offsety:100,type:270,subtype:3,iconcls:"gradient-bottom"},{offsetx:100,offsety:100,type:225,subtype:7,iconcls:"gradient-right-bottom"}],this._viewDataRadial=[{offsetx:100,offsety:150,type:2,subtype:5,iconcls:"gradient-radial-center"}],this.btnDirection=new Common.UI.Button({cls:"btn-large-dataview",iconCls:"item-gradient gradient-left",menu:new Common.UI.Menu({style:"min-width: 60px;",menuAlign:"tr-br",items:[{template:i.template('<div id="id-textart-menu-direction" style="width: 175px; margin: 0 5px;"></div>')}]})}),this.btnDirection.on("render:after",function(n){t.mnuDirectionPicker=new Common.UI.DataView({el:e("#id-textart-menu-direction"),parentMenu:n.menu,restoreHeight:174,store:new Common.UI.DataViewStore(t._viewDataLinear),itemTemplate:i.template('<div id="<%= id %>" class="item-gradient" style="background-position: -<%= offsetx %>px -<%= offsety %>px;"></div>')})}),this.btnDirection.render(e("#textart-button-direction")),this.mnuDirectionPicker.on("item:click",i.bind(this.onSelectGradient,this,this.btnDirection)),this.lockedControls.push(this.btnDirection),this.sldrGradient=new Common.UI.MultiSliderGradient({el:e("#textart-slider-gradient"),width:192,minValue:0,maxValue:100,values:[0,100]}),this.sldrGradient.on("change",i.bind(this.onGradientChange,this)),this.sldrGradient.on("changecomplete",i.bind(this.onGradientChangeComplete,this)),this.sldrGradient.on("thumbclick",function(e,i){t.GradColor.currentIdx=i;var n=t.GradColor.colors[t.GradColor.currentIdx];t.btnGradColor.setColor(n),t.colorsGrad.select(n,!1);var o=t.GradColor.values[t.GradColor.currentIdx];t.spnGradPosition.setValue(o,!0)}),this.sldrGradient.on("thumbdblclick",function(e){t.btnGradColor.cmpEl.find("button").dropdown("toggle")}),this.sldrGradient.on("sortthumbs",function(e,n){var o,s=[];i.each(n,function(e,i){s.push(t.GradColor.colors[e]),t.GradColor.currentIdx==e&&(o=i)}),t.OriginalFillType=null,t.GradColor.colors=s,t.GradColor.currentIdx=o}),this.sldrGradient.on("addthumb",function(e,i,n){t.GradColor.colors[i]=t.GradColor.colors[t.GradColor.currentIdx],t.GradColor.currentIdx=i;var o=t.sldrGradient.addNewThumb(i,n);t.GradColor.colors[t.GradColor.currentIdx]=o}),this.sldrGradient.on("removethumb",function(e,n){if(t.sldrGradient.removeThumb(n),t.GradColor.values.splice(n,1),t.sldrGradient.changeGradientStyle(),i.isUndefined(t.GradColor.currentIdx)||t.GradColor.currentIdx>=t.GradColor.colors.length){var o=n>0?n-1:n;o=0===o&&t.GradColor.values.length>2?t.GradColor.values.length-2:o,t.GradColor.currentIdx=o}t.sldrGradient.setActiveThumb(t.GradColor.currentIdx)}),this.lockedControls.push(this.sldrGradient),this.spnGradPosition=new Common.UI.MetricSpinner({el:e("#textart-gradient-position"),step:1,width:60,defaultUnit:"%",value:"50 %",allowDecimal:!1,maxValue:100,minValue:0,disabled:this._locked}),this.lockedControls.push(this.spnGradPosition),this.spnGradPosition.on("change",i.bind(this.onPositionChange,this)),this.spnGradPosition.on("inputleave",function(){t.fireEvent("editcomplete",t)}),this.btnAddGradientStep=new Common.UI.Button({parentEl:e("#textart-gradient-add-step"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-add-breakpoint",disabled:this._locked,hint:this.tipAddGradientPoint}),this.btnAddGradientStep.on("click",i.bind(this.onAddGradientStep,this)),this.lockedControls.push(this.btnAddGradientStep),this.btnRemoveGradientStep=new Common.UI.Button({parentEl:e("#textart-gradient-remove-step"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-remove-breakpoint",disabled:this._locked,hint:this.tipRemoveGradientPoint}),this.btnRemoveGradientStep.on("click",i.bind(this.onRemoveGradientStep,this)),this.lockedControls.push(this.btnRemoveGradientStep),this.numGradientAngle=new Common.UI.MetricSpinner({el:e("#textart-spin-gradient-angle"),step:10,width:60,defaultUnit:"Â°",value:"0 Â°",allowDecimal:!0,maxValue:359.9,minValue:0,disabled:this._locked}),this.lockedControls.push(this.numGradientAngle),this.numGradientAngle.on("change",i.bind(this.onGradientAngleChange,this)),this.numGradientAngle.on("inputleave",function(){t.fireEvent("editcomplete",t)}),this.cmbBorderSize=new Common.UI.ComboBorderSizeEditable({el:e("#textart-combo-border-size"),style:"width: 93px;",txtNoBorders:this.txtNoBorders}).on("selected",i.bind(this.onBorderSizeSelect,this)).on("changed:before",i.bind(this.onBorderSizeChanged,this,!0)).on("changed:after",i.bind(this.onBorderSizeChanged,this,!1)).on("combo:blur",i.bind(this.onComboBlur,this,!1)),this.BorderSize=this.cmbBorderSize.store.at(2).get("value"),this.cmbBorderSize.setValue(this.BorderSize),this.lockedControls.push(this.cmbBorderSize),this.cmbBorderType=new Common.UI.ComboBorderType({el:e("#textart-combo-border-type"),style:"width: 93px;",menuStyle:"min-width: 93px;"}).on("selected",i.bind(this.onBorderTypeSelect,this)).on("combo:blur",i.bind(this.onComboBlur,this,!1)),this.BorderType=Asc.c_oDashType.solid,this.cmbBorderType.setValue(this.BorderType),this.lockedControls.push(this.cmbBorderType),this.cmbTransform=new Common.UI.ComboDataView({itemWidth:50,itemHeight:50,menuMaxHeight:300,enableKeyEvents:!0,cls:"combo-textart"}),this.cmbTransform.render(e("#textart-combo-transform")),this.cmbTransform.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.cmbTransform.on("click",i.bind(this.onTransformSelect,this)),this.cmbTransform.openButton.menu.on("show:after",function(){t.cmbTransform.menuPicker.scroller.update({alwaysVisibleY:!0})}),this.lockedControls.push(this.cmbTransform)},createDelayedElements:function(){this._initSettings=!1,this.createDelayedControls(),this.UpdateThemeColors(),this.fillTransform(this.api.asc_getPropertyEditorTextArts()),this.fillTextArt()},fillTextArt:function(){if(!this._initSettings){var t=this;this.cmbTextArt||(this.cmbTextArt=new Common.UI.ComboDataView({itemWidth:50,itemHeight:50,menuMaxHeight:300,enableKeyEvents:!0,showLast:!1,cls:"combo-textart"}),this.cmbTextArt.render(e("#textart-combo-template")),this.cmbTextArt.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.cmbTextArt.on("click",i.bind(this.onTextArtSelect,this)),this.cmbTextArt.openButton.menu.on("show:after",function(){t.cmbTextArt.menuPicker.scroller.update({alwaysVisibleY:!0})}),this.lockedControls.push(this.cmbTextArt));var n=this.application.getCollection("Common.Collections.TextArt").models,o=this.cmbTextArt.menuPicker.store.length;if(n.length<1)return void DE.getController("Main").fillTextArt(this.api.asc_getTextArtPreviews());if(o>0&&o==n.length){var s=this.cmbTextArt.menuPicker.store.models;i.each(n,function(t,e){s[e].set("imageUrl",t.get("imageUrl"))})}else this.cmbTextArt.menuPicker.store.reset(n),this.cmbTextArt.menuPicker.store.length>0&&this.cmbTextArt.fillComboView(this.cmbTextArt.menuPicker.store.at(0))}},onTextArtSelect:function(t,e){if(this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties;i.asc_putStyle(e.get("data")),this.shapeprops.put_TextArtProperties(i),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},fillTransform:function(t){if(t){for(var e=[],i=0;i<t.length;i++){var n=t[i];e.push({imageUrl:n.Image,type:n.Type,selected:!1})}this.cmbTransform.menuPicker.store.reset(e),this.cmbTransform.menuPicker.store.length>0&&this.cmbTransform.fillComboView(this.cmbTransform.menuPicker.store.at(0),!0)}},onTransformSelect:function(t,e){if(this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties;i.asc_putForm(e.get("type")),this.shapeprops.put_TextArtProperties(i),this.api.ImgApply(this.imgprops)}this.fireEvent("editcomplete",this)},UpdateThemeColors:function(){this._initSettings||(this.btnBackColor||(this.btnBorderColor=new Common.UI.ColorButton({parentEl:e("#textart-border-color-btn"),color:"000000"}),this.lockedControls.push(this.btnBorderColor),this.colorsBorder=this.btnBorderColor.getPicker(),this.btnBorderColor.on("color:select",i.bind(this.onColorsBorderSelect,this)),this.btnGradColor=new Common.UI.ColorButton({parentEl:e("#textart-gradient-color-btn"),color:"000000"}),this.lockedControls.push(this.btnGradColor),this.colorsGrad=this.btnGradColor.getPicker(),this.btnGradColor.on("color:select",i.bind(this.onColorsGradientSelect,this)),this.btnBackColor=new Common.UI.ColorButton({parentEl:e("#textart-back-color-btn"),transparent:!0,color:"transparent"}),this.lockedControls.push(this.btnBackColor),this.colorsBack=this.btnBackColor.getPicker(),this.btnBackColor.on("color:select",i.bind(this.onColorsBackSelect,this))),this.colorsBorder.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBack.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsGrad.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()))},_pt2mm:function(t){return 25.4*t/72},_mm2pt:function(t){return 72*t/25.4},ShowHideElem:function(t){this.FillColorContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_SOLID),this.FillGradientContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_GRAD),this.TransparencyContainer.toggleClass("settings-hidden",t===Asc.c_oAscFill.FILL_TYPE_NOFILL||null===t)},setLocked:function(t){this._locked=t},disableControls:function(t){this._initSettings||this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,function(e){e.setDisabled(t)}),this.numGradientAngle.setDisabled(t||this.GradFillType!==Asc.c_oAscFillGradType.GRAD_LINEAR))},onPositionChange:function(t){var e=t.getNumberValue(),i=this.GradColor.currentIdx-1<0?0:this.GradColor.values[this.GradColor.currentIdx-1],n=this.GradColor.currentIdx+1<this.GradColor.values.length?this.GradColor.values[this.GradColor.currentIdx+1]:100,o=e<i||e>n;if(this.api){this.GradColor.values[this.GradColor.currentIdx]=e;var s=new Asc.asc_TextArtProperties,a=new Asc.asc_CShapeFill;a.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),a.asc_putFill(new Asc.asc_CFillGrad),a.asc_getFill().asc_putGradType(this.GradFillType);var r=[];this.GradColor.values.forEach(function(t){r.push(1e3*t)}),a.asc_getFill().asc_putPositions(r),s.asc_putFill(a),this.shapeprops.put_TextArtProperties(s),this.api.ImgApply(this.imgprops),o&&(this.sldrGradient.sortThumbs(),this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient))}},onAddGradientStep:function(){if(!(this.GradColor.colors.length>9)){var t=this.GradColor.currentIdx,e=(this.GradColor.values[t]+this.GradColor.values[t<this.GradColor.colors.length-1?t+1:t-1])/2;this.GradColor.colors[this.GradColor.colors.length]=this.GradColor.colors[t],this.GradColor.currentIdx=this.GradColor.colors.length-1;var i=this.sldrGradient.addNewThumb(void 0,e,t);this.GradColor.colors[this.GradColor.currentIdx]=i,this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient)}},onRemoveGradientStep:function(){if(!(this.GradColor.values.length<3)){var t=this.GradColor.currentIdx;if(this.GradColor.values.splice(this.GradColor.currentIdx,1),this.sldrGradient.removeThumb(this.GradColor.currentIdx),i.isUndefined(this.GradColor.currentIdx)||this.GradColor.currentIdx>=this.GradColor.colors.length){var e=t>0?t-1:t;e=0===e&&this.GradColor.values.length>2?this.GradColor.values.length-2:e,this.GradColor.currentIdx=e}this.sldrGradient.setActiveThumb(this.GradColor.currentIdx),this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient)}},onGradientAngleChange:function(t,e,i,n){if(this.api&&!this._noApply){var o=new Asc.asc_TextArtProperties,s=new Asc.asc_CShapeFill;s.put_type(Asc.c_oAscFill.FILL_TYPE_GRAD),s.put_fill(new Asc.asc_CFillGrad),s.get_fill().put_grad_type(this.GradFillType),
s.get_fill().put_linear_angle(6e4*t.getNumberValue()),s.get_fill().put_linear_scale(!0),o.asc_putFill(s),this.shapeprops.put_TextArtProperties(o),this.api.ImgApply(this.imgprops)}},onWindowResize:function(){this._initSettings||this._state.applicationPixelRatio===Common.Utils.applicationPixelRatio()||this.fillTransform(this.api.asc_getPropertyEditorTextArts()),this._state.applicationPixelRatio=Common.Utils.applicationPixelRatio()},txtNoBorders:"No Line",strStroke:"Stroke",strColor:"Color",strSize:"Size",strFill:"Fill",textColor:"Color Fill",strTransparency:"Opacity",textNoFill:"No Fill",textSelectTexture:"Select",textGradientFill:"Gradient Fill",textLinear:"Linear",textRadial:"Radial",textDirection:"Direction",textStyle:"Style",textGradient:"Gradient Points",textBorderSizeErr:"The entered value is incorrect.<br>Please enter a value between 0 pt and 1584 pt.",textTransform:"Transform",textTemplate:"Template",strType:"Type",textPosition:"Position",tipAddGradientPoint:"Add gradient point",tipRemoveGradientPoint:"Remove gradient point",textAngle:"Angle"},DE.Views.TextArtSettings||{}))}),define("text!documenteditor/main/app/template/SignatureSettings.template",[],function(){return'<table cols="2">\n    <tr>\n        <td class="padding-large">\n            <label style="font-size: 18px;"><%= scope.strSignature %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-large">\n            <div id="signature-invisible-sign" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr class="requested">\n        <td class="padding-small">\n            <label class="header"><%= scope.strRequested %></label>\n        </td>\n    </tr>\n    <tr class="requested">\n        <td class="padding-large">\n            <div id="signature-requested-sign"></div>\n        </td>\n    </tr>\n    <tr class="valid">\n        <td class="padding-small">\n            <label class="header"><%= scope.strValid %></label>\n        </td>\n    </tr>\n    <tr class="valid">\n        <td class="padding-large">\n            <div id="signature-valid-sign"></div>\n        </td>\n    </tr>\n    <tr class="invalid">\n        <td class="padding-small">\n            <label class="header" style="color:#bb3d3d;"><%= scope.strInvalid %></label>\n        </td>\n    </tr>\n    <tr class="invalid">\n        <td><div id="signature-invalid-sign"></div></td>\n    </tr>\n    <tr class="finish-cell"></tr>\n</table>'}),define("documenteditor/main/app/view/SignatureSettings",["text!documenteditor/main/app/template/SignatureSettings.template","jquery","underscore","backbone","common/main/lib/component/Button"],function(t,e,i,n){"use strict";DE.Views.SignatureSettings=n.View.extend(i.extend({el:"#id-signature-settings",template:i.template(t),events:{},options:{alias:"SignatureSettings"},initialize:function(){this._state={DisabledEditing:!1,ready:!1,hasValid:!1,hasInvalid:!1,hasRequested:!1,tip:void 0},this._locked=!1,this.render()},render:function(){this.$el.html(this.template({scope:this}));var t=DE.getController("Common.Controllers.Protection").getView();this.btnAddInvisibleSign=t.getButton("signature"),this.btnAddInvisibleSign.render(this.$el.find("#signature-invisible-sign")),this.viewRequestedList=new Common.UI.DataView({el:e("#signature-requested-sign"),enableKeyEvents:!1,itemTemplate:i.template(['<div id="<%= id %>" class="signature-item requested">','<div class="caret img-commonctrl nomargin"></div>','<div class="name"><%= Common.Utils.String.htmlEncode(name) %></div>',"</div>"].join(""))}),this.viewValidList=new Common.UI.DataView({el:e("#signature-valid-sign"),enableKeyEvents:!1,itemTemplate:i.template(['<div id="<%= id %>" class="signature-item">','<div class="caret img-commonctrl img-colored <% if (name == "" || date == "") { %>nomargin<% } %>"></div>','<div class="name"><%= Common.Utils.String.htmlEncode(name) %></div>','<div class="date"><%= Common.Utils.String.htmlEncode(date) %></div>',"</div>"].join(""))}),this.viewInvalidList=new Common.UI.DataView({el:e("#signature-invalid-sign"),enableKeyEvents:!1,itemTemplate:i.template(['<div id="<%= id %>" class="signature-item">','<div class="caret img-commonctrl <% if (name == "" || date == "") { %>nomargin<% } %>"></div>','<div class="name"><%= Common.Utils.String.htmlEncode(name) %></div>','<div class="date"><%= Common.Utils.String.htmlEncode(date) %></div>',"</div>"].join(""))}),this.viewRequestedList.on("item:click",i.bind(this.onSelectSignature,this)),this.viewValidList.on("item:click",i.bind(this.onSelectSignature,this)),this.viewInvalidList.on("item:click",i.bind(this.onSelectSignature,this)),this.viewRequestedList.on("item:contextmenu",i.bind(this.onItemContextMenu,this)),this.viewValidList.on("item:contextmenu",i.bind(this.onItemContextMenu,this)),this.viewInvalidList.on("item:contextmenu",i.bind(this.onItemContextMenu,this)),this.signatureMenu=new Common.UI.Menu({menuAlign:"tr-br",items:[{caption:this.strSign,value:0},{caption:this.strDetails,value:1},{caption:this.strSetup,value:2},{caption:this.strDelete,value:3}]}),this.signatureMenu.on("item:click",i.bind(this.onMenuSignatureClick,this))},setApi:function(t){return this.api=t,this.api&&this.api.asc_registerCallback("asc_onUpdateSignatures",i.bind(this.onApiUpdateSignatures,this)),Common.NotificationCenter.on("document:ready",i.bind(this.onDocumentReady,this)),this},ChangeSettings:function(t){this._state.hasRequested||this._state.hasValid||this._state.hasInvalid||this.updateSignatures(this.api.asc_getSignatures(),this.api.asc_getRequestSignatures())},setLocked:function(t){this._locked=t},setMode:function(t){this.mode=t},onApiUpdateSignatures:function(t,e){this._state.ready&&(this.updateSignatures(t,e),this.showSignatureTooltip(this._state.hasValid,this._state.hasInvalid))},updateSignatures:function(t,e){var n=this,o=[],s=[],a=[],r=1;i.each(e,function(t,e){var i=t.asc_getSigner1();o.push({name:""!==i?i:n.strSigner+" "+r++,guid:t.asc_getGuid(),requested:!0})}),i.each(t,function(t,e){var n=t.asc_getDate(),o={name:t.asc_getSigner1(),certificateId:t.asc_getId(),guid:t.asc_getGuid(),date:i.isEmpty(n)?"":new Date(n).toLocaleString(),invisible:!t.asc_getVisible()};0==t.asc_getValid()?s.push(o):a.push(o)}),n._state.hasValid=s.length>0,n._state.hasInvalid=a.length>0,n._state.hasRequested=o.length>0,this.viewRequestedList.store.reset(o),this.viewValidList.store.reset(s),this.viewInvalidList.store.reset(a),this.$el.find(".requested").toggleClass("hidden",!n._state.hasRequested),this.$el.find(".valid").toggleClass("hidden",!n._state.hasValid),this.$el.find(".invalid").toggleClass("hidden",!n._state.hasInvalid),n.disableEditing(n._state.hasValid||n._state.hasInvalid)},onItemContextMenu:function(t,n,o,s){var a=this.signatureMenu;a.isVisible()&&a.hide();var r=e(this.el).offset(),l=[s.clientX*Common.Utils.zoom()-r.left+5,s.clientY*Common.Utils.zoom()-r.top+5];this.showSignatureMenu(o,l),a.menuAlign="tl-bl",a.menuAlignEl=null,a.setOffset(15,5),a.show(),i.delay(function(){a.cmpEl.focus()},10)},onSelectSignature:function(t,n,o,s){if(o){var a=e(s.target);if(a&&a.hasClass("caret")){var r=this.signatureMenu;if(r.isVisible())return void r.hide();var l=e(s.currentTarget),c=l.offset(),d=e(this.el).offset(),h=[c.left-d.left+l.width(),c.top-d.top+l.height()/2];this.showSignatureMenu(o,h),r.menuAlign="tr-br",r.menuAlignEl=l,r.setOffset(-20,-l.height()/2+3),r.show(),i.delay(function(){r.cmpEl.focus()},10),s.stopPropagation(),s.preventDefault()}else this.api.asc_gotoSignature(o.get("guid"))}},showSignatureMenu:function(t,i){this.api.asc_gotoSignature(t.get("guid"));var n=this.signatureMenu,o=e(this.el),s=o.find("#menu-signature-container");n.rendered||(s.length<1&&(s=e('<div id="menu-signature-container" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',n.id),o.append(s)),n.render(s),n.cmpEl.attr({tabindex:"-1"}),n.on({"show:after":function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!0)},"hide:after":function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!1)}}));var a=t.get("requested"),r=this._state.hasValid||this._state.hasInvalid;n.items[0].setVisible(a),n.items[1].setVisible(!a),n.items[2].setVisible(a||!t.get("invisible")),n.items[3].setVisible(!a),n.items[0].setDisabled(this._locked),n.items[3].setDisabled(this._locked),n.items[1].cmpEl.attr("data-value",t.get("certificateId")),n.items[2].cmpEl.attr("data-value",r?1:0),n.cmpEl.attr("data-value",t.get("guid")),s.css({left:i[0],top:i[1]})},onMenuSignatureClick:function(t,e){var i=t.cmpEl.attr("data-value");switch(e.value){case 0:Common.NotificationCenter.trigger("protect:sign",i);break;case 1:this.api.asc_ViewCertificate(e.cmpEl.attr("data-value"));break;case 2:Common.NotificationCenter.trigger("protect:signature","visible",!!parseInt(e.cmpEl.attr("data-value")),i);break;case 3:var n=this;Common.UI.warning({title:this.notcriticalErrorTitle,msg:this.txtRemoveWarning,buttons:["ok","cancel"],primary:"ok",callback:function(t){"ok"==t&&n.api.asc_RemoveSignature(i)}})}},onDocumentReady:function(){this._state.ready=!0,this.updateSignatures(this.api.asc_getSignatures(),this.api.asc_getRequestSignatures()),this.showSignatureTooltip(this._state.hasValid,this._state.hasInvalid,this._state.hasRequested)},showSignatureTooltip:function(t,e,i){var n=this,o=n._state.tip;if(!t&&!e&&!i)return void(o&&o.isVisible()&&(o.close(),n._state.tip=void 0));var s=t||e,a=e?n.txtSignedInvalid:t?n.txtSigned:"";i&&(a=n.txtRequestedSignatures+"<br><br>"+a),o&&o.isVisible()&&(a!==o.text||s!==o.showLink)&&(o.close(),n._state.tip=void 0),n._state.tip||(o=new Common.UI.SynchronizeTip({target:DE.getController("RightMenu").getView("RightMenu").btnSignature.btnEl,text:a,showLink:s,textLink:this.txtContinueEditing,placement:"left-bottom"}),o.on({dontshowclick:function(){Common.UI.warning({title:n.notcriticalErrorTitle,msg:n.txtEditWarning,buttons:["ok","cancel"],primary:"ok",callback:function(t){"ok"==t&&(o.close(),n._state.tip=void 0,n.api.asc_RemoveAllSignatures())}})},closeclick:function(){o.close(),n._state.tip=void 0}}),n._state.tip=o,o.show())},disableEditing:function(t){if(this._state.DisabledEditing!=t){this._state.DisabledEditing=t;var e=DE.getController("RightMenu");t&&"id-signature-settings"!==e.rightmenu.GetActivePane()&&e.rightmenu.clearSelection(),e.SetDisabled(t,!1,!0),DE.getController("Toolbar").DisableToolbar(t,t),DE.getController("Statusbar").getView("Statusbar").SetDisabled(t),DE.getController("Common.Controllers.ReviewChanges").SetDisabled(t),DE.getController("DocumentHolder").getView().SetDisabled(t,!0),DE.getController("Navigation")&&DE.getController("Navigation").SetDisabled(t),DE.getController("LeftMenu").setPreviewMode(t);var i=DE.getController("Common.Controllers.Comments");i&&i.setPreviewMode(t)}},strSignature:"Signature",strRequested:"Requested signatures",strValid:"Valid signatures",strInvalid:"Invalid signatures",strSign:"Sign",strDetails:"Signature Details",strSetup:"Signature Setup",txtSigned:"Valid signatures has been added to the document. The document is protected from editing.",txtSignedInvalid:"Some of the digital signatures in document are invalid or could not be verified. The document is protected from editing.",txtRequestedSignatures:"This document needs to be signed.",txtContinueEditing:"Edit anyway",notcriticalErrorTitle:"Warning",txtEditWarning:"Editing will remove the signatures from the document.<br>Are you sure you want to continue?",strDelete:"Remove Signature",strSigner:"Signer",txtRemoveWarning:"Are you sure you want to remove this signature?<br>This action cannot be undone."},DE.Views.SignatureSettings||{}))}),define("text!documenteditor/main/app/template/FormSettings.template",[],function(){return'<table cols="1">\n    <tr>\n        <td>\n            <label class="header padding-small" id="form-settings-name"><%= scope.textField %></label>\n        </td>\n    </tr>\n    <tr class="form-keyfield">\n        <td class="padding-small">\n            <label class="input-label"><%= scope.textKey %></label>\n            <div id="form-combo-key" style="width: 100%;"></div>\n        </td>\n    </tr>\n    <tr class="form-connected">\n        <td class="padding-small">\n            <label style="opacity: 0.5; margin-right: 5px;" id="form-settings-connected"><%= scope.textConnected %></label>\n            <label class="link-solid" id="form-settings-disconnect"><%= scope.textDisconnect %></label>\n        </td>\n    </tr>\n    <tr class="form-radiobox">\n        <td class="padding-small">\n            <label class="input-label"><%= scope.textGroupKey %></label>\n            <div id="form-combo-group-key" style="width: 100%;"></div>\n        </td>\n    </tr>\n    <tr class="form-placeholder">\n        <td class="padding-small">\n            <label class="input-label"><%= scope.textPlaceholder %></label>\n            <div id="form-txt-pholder"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-large">\n            <label class="input-label"><%= scope.textTip %></label>\n            <div id="form-txt-help"></div>\n        </td>\n    </tr>\n    <tr class="form-not-image">\n        <td class="padding-small">\n            <div id="form-chb-fixed"></div>\n        </td>\n    </tr>\n    <tr class="form-textfield">\n        <td class="padding-small">\n            <div id="form-chb-max-chars" style="display: inline-block;margin-top: 4px;"></div>\n            <div id="form-spin-max-chars" style="display: inline-block;float: right;"></div>\n        </td>\n    </tr>\n    <tr class="form-textfield">\n        <td class="padding-small">\n            <div id="form-chb-comb"></div>\n        </td>\n    </tr>\n    <tr class="form-textfield">\n        <td class="padding-small">\n            <label class="input-label" style="margin-left: 22px;margin-top: 4px;"><%= scope.textWidth %></label>\n            <div id="form-spin-width" style="display: inline-block; float: right;"></div>\n        </td>\n    </tr>\n    <tr class="form-textfield">\n        <td class="padding-small">\n            <label class="input-label" style="margin-left: 22px;margin-top: 4px;"><%= scope.textColor %></label>\n            <div id="form-color-btn" style="display: inline-block; float: right;"></div>\n        </td>\n    </tr>\n    <tr class="form-textfield">\n        <td class="padding-small">\n            <div id="form-chb-autofit"></div>\n        </td>\n    </tr>\n    <tr class="form-textfield">\n        <td class="padding-small">\n            <div id="form-chb-multiline"></div>\n        </td>\n    </tr>\n    <tr class="form-image">\n        <td class="padding-large">\n            <label class="input-label"><%= scope.textScale %></label>\n            <div id="form-combo-scale" style="width: 100%;"></div>\n        </td>\n    </tr>\n    <tr class="form-image">\n        <td class="padding-large">\n            <div id="form-chb-aspect"></div>\n        </td>\n    </tr>\n    <tr class="form-image">\n        <td class="padding-large">\n            <div id="form-button-replace" style="width:100%;"></div>\n        </td>\n    </tr>\n</table>\n<table cols="2" class="form-list" style="margin-top:5px;">\n    <tr>\n        <td colspan="2" class="padding-small">\n            <label class="input-label"><%= scope.textValue %></label>\n        </td>\n    </tr>\n    <tr style="vertical-align: top;">\n        <td class="padding-small">\n            <div id="form-txt-new-value" style="margin-right: 5px;"></div>\n        </td>\n        <td class="padding-small">\n            <div id="form-list-add" style="margin-left: 5px;"></div>\n        </td>\n    </tr>\n    <tr style="vertical-align: top;">\n        <td class="padding-large">\n            <div id="form-list-list" style="width:162px; height: 95px;margin-right: 5px;"></div>\n        </td>\n        <td class="padding-large">\n            <div id="form-list-delete" style="margin-bottom: 5px;margin-left: 5px;"></div>\n            <div id="form-list-up" style="margin-bottom: 5px;margin-left: 5px;"></div>\n            <div id="form-list-down" style="margin-left: 5px;"></div>\n        </td>\n    </tr>\n</table>\n<table cols="1">\n    <tr>\n        <td class="padding-small">\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small">\n            <div id="form-chb-required"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small">\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small">\n            <div id="form-btn-delete"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small">\n            <div id="form-btn-lock"></div>\n        </td>\n    </tr>\n    <tr class="finish-cell"></tr>\n</table>'}),void 0===Common)var Common={};define("common/main/lib/component/TextareaField",["common/main/lib/component/BaseView","common/main/lib/component/Tooltip"],function(){"use strict";Common.UI.TextareaField=Common.UI.BaseView.extend(function(){return{options:{id:null,cls:"",style:"",value:"",maxlength:void 0,placeHolder:"",spellcheck:!1,disabled:!1},template:_.template(['<div class="textarea-field" style="<%= style %>">',"<textarea ",'spellcheck="<%= spellcheck %>" ','class="form-control <%= cls %>" ','placeholder="<%= placeHolder %>" ',"></textarea>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=e.options.id||Common.UI.getId(),this.cls=e.options.cls,this.style=e.options.style,this.value=e.options.value,this.placeHolder=e.options.placeHolder,this.template=e.options.template||e.template,this.disabled=e.options.disabled,this.spellcheck=e.options.spellcheck,this.maxLength=e.options.maxLength,e.rendered=e.options.rendered||!1,e.options.el&&e.render()},render:function(t){var e=this;if(e.rendered?this.cmpEl=this.$el:(this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,placeHolder:this.placeHolder,spellcheck:this.spellcheck,scope:e})),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl)),!e.rendered){this.cmpEl;this._input=this.cmpEl.find("textarea").addBack().filter("textarea"),this._input.on("blur",_.bind(this.onInputChanged,this)),this._input.on("keydown",_.bind(this.onKeyDown,this)),this.maxLength&&this._input.attr("maxlength",this.maxLength),this.disabled&&this.setDisabled(this.disabled)}return e.rendered=!0,this},_doChange:function(t,e){if(!e||!e.synthetic){var i=$(t.target).val(),n=this.value;this.trigger("changed:before",this,i,n,t),t.isDefaultPrevented()||(this.value=i,this.trigger("changed:after",this,i,n,t))}},onInputChanged:function(t,e){this._doChange(t,e)},onKeyDown:function(t){this.trigger("keydown:before",this,t),t.isDefaultPrevented()||(t.keyCode===Common.UI.Keys.RETURN&&t.stopPropagation(),t.keyCode==Common.UI.Keys.ESC&&this.setValue(this.value),t.keyCode==Common.UI.Keys.ESC&&this.trigger("inputleave",this))},setDisabled:function(t){this.disabled=t,$(this.el).toggleClass("disabled",t),t?this._input.attr("disabled",!0):this._input.removeAttr("disabled")},isDisabled:function(){return this.disabled},setValue:function(t){this.value=t,this.rendered&&this._input.val(t)},getValue:function(){return this.value},focus:function(){this._input.focus()}}}())}),define("documenteditor/main/app/view/FormSettings",["text!documenteditor/main/app/template/FormSettings.template","jquery","underscore","backbone","common/main/lib/component/ComboBox","common/main/lib/component/MetricSpinner","common/main/lib/component/TextareaField","common/main/lib/component/CheckBox","common/main/lib/view/ImageFromUrlDialog"],function(t,e,i,n){"use strict";DE.Views.FormSettings=n.View.extend(i.extend({el:"#id-form-settings",template:i.template(t),events:{},options:{alias:"FormSettings"},initialize:function(){this._initSettings=!0,this._state={DisabledControls:void 0,LockDelete:void 0},this.spinners=[],this.lockedControls=[],this.internalId=null,this._locked=!0,this._originalTextFormProps=null,this._originalFormProps=null,this._originalProps=null,this.render()},render:function(){var t=this.$el||e(this.el);t.html(this.template({scope:this})),this.TextOnlySettings=t.find(".form-textfield"),this.PlaceholderSettings=t.find(".form-placeholder"),this.KeySettings=t.find(".form-keyfield"),this.KeySettingsTd=this.KeySettings.find("td"),this.CheckOnlySettings=t.find(".form-checkbox"),this.RadioOnlySettings=t.find(".form-radiobox"),this.ListOnlySettings=t.find(".form-list"),this.ImageOnlySettings=t.find(".form-image"),this.ConnectedSettings=t.find(".form-connected"),this.NotImageSettings=t.find(".form-not-image")},createDelayedElements:function(){this._initSettings=!1;var t=this.$el||e(this.el),n=this;this.labelFormName=t.findById("#form-settings-name"),this.labelConnectedFields=t.findById("#form-settings-connected"),t.findById("#form-settings-disconnect").on("click",i.bind(this.onDisconnect,this)),this.cmbKey=new Common.UI.ComboBox({el:t.findById("#form-combo-key"),cls:"input-group-nr",menuStyle:"min-width: 100%;",editable:!0,data:[]}),this.cmbKey.setValue(""),this.lockedControls.push(this.cmbKey),this.cmbKey.on("selected",this.onKeyChanged.bind(this)),this.cmbKey.on("changed:after",this.onKeyChanged.bind(this)),this.cmbKey.on("hide:after",this.onHideMenus.bind(this)),this.txtPlaceholder=new Common.UI.InputField({el:t.findById("#form-txt-pholder"),allowBlank:!0,validateOnChange:!1,validateOnBlur:!1,style:"width: 100%;",value:""}),this.lockedControls.push(this.txtPlaceholder),this.txtPlaceholder.on("changed:after",this.onPlaceholderChanged.bind(this)),this.txtPlaceholder.on("inputleave",function(){n.fireEvent("editcomplete",n)}),this.txtPlaceholder.cmpEl.on("focus","input.form-control",function(){setTimeout(function(){n.txtPlaceholder._input&&n.txtPlaceholder._input.select()},1)}),this.textareaHelp=new Common.UI.TextareaField({el:t.findById("#form-txt-help"),style:"width: 100%; height: 60px;",value:""}),this.lockedControls.push(this.textareaHelp),this.textareaHelp.on("changed:after",this.onHelpChanged.bind(this)),this.textareaHelp.on("inputleave",function(){n.fireEvent("editcomplete",n)}),this.chMaxChars=new Common.UI.CheckBox({el:t.findById("#form-chb-max-chars"),labelText:this.textMaxChars}),this.chMaxChars.on("change",this.onChMaxCharsChanged.bind(this)),this.lockedControls.push(this.chMaxChars),this.spnMaxChars=new Common.UI.MetricSpinner({el:t.findById("#form-spin-max-chars"),step:1,width:45,defaultUnit:"",value:"10",maxValue:1e6,minValue:1}),this.lockedControls.push(this.spnMaxChars),this.spnMaxChars.on("change",this.onMaxCharsChange.bind(this)),this.spnMaxChars.on("inputleave",function(){n.fireEvent("editcomplete",n)}),this.chComb=new Common.UI.CheckBox({el:t.findById("#form-chb-comb"),labelText:this.textComb}),this.chComb.on("change",this.onChCombChanged.bind(this)),this.lockedControls.push(this.chComb),this.spnWidth=new Common.UI.MetricSpinner({el:t.findById("#form-spin-width"),step:.1,width:64,defaultUnit:"cm",value:"Auto",allowAuto:!0,maxValue:55.88,minValue:.1}),this.lockedControls.push(this.spnWidth),this.spinners.push(this.spnWidth),this.spnWidth.on("change",this.onWidthChange.bind(this)),this.spnWidth.on("inputleave",function(){n.fireEvent("editcomplete",n)}),this.chAutofit=new Common.UI.CheckBox({el:t.findById("#form-chb-autofit"),labelText:this.textAutofit}),this.chAutofit.on("change",this.onChAutofit.bind(this)),this.lockedControls.push(this.chAutofit),this.chMulti=new Common.UI.CheckBox({el:t.findById("#form-chb-multiline"),labelText:this.textMulti}),this.chMulti.on("change",this.onChMulti.bind(this)),this.lockedControls.push(this.chMulti),this.chRequired=new Common.UI.CheckBox({el:t.findById("#form-chb-required"),labelText:this.textRequired}),this.chRequired.on("change",this.onChRequired.bind(this)),this.lockedControls.push(this.chRequired),this.chFixed=new Common.UI.CheckBox({el:t.findById("#form-chb-fixed"),labelText:this.textFixed}),this.chFixed.on("change",this.onChFixed.bind(this)),this.lockedControls.push(this.chFixed),this.cmbGroupKey=new Common.UI.ComboBox({el:t.findById("#form-combo-group-key"),cls:"input-group-nr",menuStyle:"min-width: 100%;",editable:!0,data:[]}),this.cmbGroupKey.setValue(""),this.lockedControls.push(this.cmbGroupKey),this.cmbGroupKey.on("selected",this.onGroupKeyChanged.bind(this)),this.cmbGroupKey.on("changed:after",this.onGroupKeyChanged.bind(this)),this.cmbGroupKey.on("hide:after",this.onHideMenus.bind(this)),this.txtNewValue=new Common.UI.InputField({el:t.findById("#form-txt-new-value"),allowBlank:!0,validateOnChange:!1,validateOnBlur:!1,style:"width: 100%;",value:""}),this.lockedControls.push(this.txtNewValue),this.txtNewValue.on("inputleave",function(){n.fireEvent("editcomplete",n)}),this.txtNewValue._input.on("keydown",i.bind(this.onNewValueKeydown,this)),this.list=new Common.UI.ListView({el:t.findById("#form-list-list"),store:new Common.UI.DataViewStore,emptyText:"",template:i.template(['<div class="listview inner" style=""></div>'].join("")),itemTemplate:i.template(['<div id="<%= id %>" class="list-item" style="width: 100%;display:inline-block;">','<div style="width:145px;display: inline-block;vertical-align: middle; overflow: hidden; text-overflow: ellipsis;white-space: pre;"><%= Common.Utils.String.htmlEncode(name) %></div>',"</div>"].join(""))}),this.list.on("item:select",i.bind(this.onSelectItem,this)),this.lockedControls.push(this.list),this.btnListAdd=new Common.UI.Button({parentEl:t.findById("#form-list-add"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-zoomup",hint:this.textTipAdd}),this.btnListAdd.on("click",i.bind(this.onAddItem,this)),this.lockedControls.push(this.btnListAdd),this.btnListDelete=new Common.UI.Button({parentEl:t.findById("#form-list-delete"),cls:"btn-toolbar",iconCls:"toolbar__icon cc-remove",hint:this.textTipDelete}),this.btnListDelete.on("click",i.bind(this.onDeleteItem,this)),this.lockedControls.push(this.btnListDelete),this.btnListUp=new Common.UI.Button({parentEl:t.findById("#form-list-up"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-arrow-up",hint:this.textTipUp}),this.btnListUp.on("click",i.bind(this.onMoveItem,this,!0)),this.lockedControls.push(this.btnListUp),this.btnListDown=new Common.UI.Button({parentEl:t.findById("#form-list-down"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-arrow-down",hint:this.textTipDown}),this.btnListDown.on("click",i.bind(this.onMoveItem,this,!1)),this.lockedControls.push(this.btnListDown),this.btnSelectImage=new Common.UI.Button({parentEl:e("#form-button-replace"),cls:"btn-text-menu-default",caption:this.textSelectImage,style:"width:100%;",menu:new Common.UI.Menu({style:"min-width: 194px;",maxHeight:200,items:[{caption:this.textFromFile,value:0},{cls:"cp-from-url",caption:this.textFromUrl,value:1},{caption:this.textFromStorage,value:2}]})}),this.lockedControls.push(this.btnSelectImage),this.btnSelectImage.menu.on("item:click",i.bind(this.onImageSelect,this)),this.btnSelectImage.menu.items[2].setVisible(this.mode.canRequestInsertImage||this.mode.fileChoiceUrl&&this.mode.fileChoiceUrl.indexOf("{documentType}")>-1),this.btnRemForm=new Common.UI.Button({parentEl:t.findById("#form-btn-delete"),cls:"btn-toolbar",iconCls:"toolbar__icon cc-remove",caption:this.textDelete,style:"text-align: left;"}),this.btnRemForm.on("click",i.bind(function(t){this.api.asc_RemoveContentControl(this._state.id)},this)),this.lockedControls.push(this.btnRemForm),this.btnLockForm=new Common.UI.Button({parentEl:t.findById("#form-btn-lock"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-lock",caption:this.textLock,style:"text-align: left;"}),this.btnLockForm.on("click",i.bind(function(t){if(this.api&&!this._noApply){var e=this._originalProps||new AscCommon.CContentControlPr;e.put_Lock(this._state.LockDelete?Asc.c_oAscSdtLockType.Unlocked:Asc.c_oAscSdtLockType.SdtLocked),this.api.asc_SetContentControlProperties(e,this.internalId)}},this)),this.chAspect=new Common.UI.CheckBox({el:t.findById("#form-chb-aspect"),labelText:this.textAspect}),this.chAspect.on("change",this.onChAspect.bind(this)),this.lockedControls.push(this.chAspect),this.cmbScale=new Common.UI.ComboBox({el:t.findById("#form-combo-scale"),cls:"input-group-nr",menuStyle:"min-width: 100%;",editable:!1,data:[{displayValue:this.textAlways,value:Asc.c_oAscPictureFormScaleFlag.Always},{displayValue:this.textNever,value:Asc.c_oAscPictureFormScaleFlag.Never},{displayValue:this.textTooBig,value:Asc.c_oAscPictureFormScaleFlag.Bigger},{displayValue:this.textTooSmall,value:Asc.c_oAscPictureFormScaleFlag.Smaller}]}),this.cmbScale.setValue(Asc.c_oAscPictureFormScaleFlag.Always),this.lockedControls.push(this.cmbScale),this.cmbScale.on("selected",this.onScaleChanged.bind(this)),this.cmbScale.on("changed:after",this.onScaleChanged.bind(this)),this.cmbScale.on("hide:after",this.onHideMenus.bind(this)),this.updateMetricUnit(),this.UpdateThemeColors()},setApi:function(t){return this.api=t,this.api,Common.NotificationCenter.on("storage:image-insert",i.bind(this.insertImageFromStorage,this)),this},setMode:function(t){this.mode=t},onKeyChanged:function(t,e){if(this.api&&!this._noApply){var i=this._originalProps||new AscCommon.CContentControlPr,n=this._originalFormProps||new AscCommon.CSdtFormPr;n.put_Key(e.value),i.put_FormPr(n),this.api.asc_SetContentControlProperties(i,this.internalId),this.fireEvent("editcomplete",this)}},onPlaceholderChanged:function(t,e,i,n){if(this.api&&!this._noApply&&e!==i){var o=this._originalProps||new AscCommon.CContentControlPr;o.put_PlaceholderText(e||"    "),this.api.asc_SetContentControlProperties(o,this.internalId),n.relatedTarget&&("input"==n.relatedTarget.localName||"textarea"==n.relatedTarget.localName)&&/form-control/.test(n.relatedTarget.className)||this.fireEvent("editcomplete",this)}},onHelpChanged:function(t,e,i,n){if(this.api&&!this._noApply&&e!==i){var o=this._originalProps||new AscCommon.CContentControlPr,s=this._originalFormProps||new AscCommon.CSdtFormPr;s.put_HelpText(e),o.put_FormPr(s),this.api.asc_SetContentControlProperties(o,this.internalId),n.relatedTarget&&("input"==n.relatedTarget.localName||"textarea"==n.relatedTarget.localName)&&/form-control/.test(n.relatedTarget.className)||this.fireEvent("editcomplete",this)}},onChMaxCharsChanged:function(t,e,i,n){var o="checked"==t.getValue();if(this.spnMaxChars.setDisabled(!o),o||(this.chComb.setValue(!1,!0),this.spnWidth.setDisabled(!0)),this.api&&!this._noApply){var s=this._originalProps||new AscCommon.CContentControlPr,a=this._originalTextFormProps||new AscCommon.CSdtTextFormPr;!o&&a.put_Comb(o),a.put_MaxCharacters(o?this.spnMaxChars.getNumberValue()||10:o),s.put_TextFormPr(a),this.api.asc_SetContentControlProperties(s,this.internalId),this.fireEvent("editcomplete",this)}},onMaxCharsChange:function(t,e,i,n){if(this.api&&!this._noApply){var o=this._originalProps||new AscCommon.CContentControlPr,s=this._originalTextFormProps||new AscCommon.CSdtTextFormPr,a="checked"==this.chMaxChars.getValue()||"checked"==this.chComb.getValue();s.put_MaxCharacters(a?t.getNumberValue()||10:a),o.put_TextFormPr(s),this.api.asc_SetContentControlProperties(o,this.internalId)}},onChCombChanged:function(t,e,i,n){var o="checked"==t.getValue();if(o&&(this.chMaxChars.setValue(!0,!0),this.spnMaxChars.setDisabled(!1)),this.spnWidth.setDisabled(!o),this.api&&!this._noApply){var s=this._originalProps||new AscCommon.CContentControlPr,a=this._originalTextFormProps||new AscCommon.CSdtTextFormPr;if(a.put_Comb(o),o)if(a.put_MaxCharacters(this.spnMaxChars.getNumberValue()||10),this.spnWidth.getValue()){var r=this.spnWidth.getNumberValue();a.put_Width(r<=0?0:parseInt(72*Common.Utils.Metric.fnRecalcToMM(r)*20/25.4+.5))}else a.put_Width(0);s.put_TextFormPr(a),this.api.asc_SetContentControlProperties(s,this.internalId),this.fireEvent("editcomplete",this)}},onWidthChange:function(t,e,i,n){if(this.api&&!this._noApply){var o=this._originalProps||new AscCommon.CContentControlPr,s=this._originalTextFormProps||new AscCommon.CSdtTextFormPr;if(this.spnWidth.getValue()){var a=this.spnWidth.getNumberValue()
;s.put_Width(a<=0?0:parseInt(72*Common.Utils.Metric.fnRecalcToMM(a)*20/25.4+.5))}else s.put_Width(0);o.put_TextFormPr(s),this.api.asc_SetContentControlProperties(o,this.internalId)}},onChRequired:function(t,e,i,n){var o="checked"==t.getValue();if(this.api&&!this._noApply){var s=this._originalProps||new AscCommon.CContentControlPr,a=this._originalFormProps||new AscCommon.CSdtFormPr;a.put_Required(o),s.put_FormPr(a),this.api.asc_SetContentControlProperties(s,this.internalId),this.fireEvent("editcomplete",this)}},onChAutofit:function(t,e,i,n){var o="checked"==t.getValue();if(this.api&&!this._noApply){var s=this._originalProps||new AscCommon.CContentControlPr,a=this._originalTextFormProps||new AscCommon.CSdtTextFormPr;a.put_AutoFit(o),s.put_TextFormPr(a),this.api.asc_SetContentControlProperties(s,this.internalId),this.fireEvent("editcomplete",this)}},onChMulti:function(t,e,i,n){var o="checked"==t.getValue();if(this.api&&!this._noApply){var s=this._originalProps||new AscCommon.CContentControlPr,a=this._originalTextFormProps||new AscCommon.CSdtTextFormPr;a.put_MultiLine(o),s.put_TextFormPr(a),this.api.asc_SetContentControlProperties(s,this.internalId),this.fireEvent("editcomplete",this)}},onChFixed:function(t,e,i,n){this.api&&!this._noApply&&(this.api.asc_SetFixedForm(this.internalId,"checked"==t.getValue()),this.fireEvent("editcomplete",this))},onChAspect:function(t,e,i,n){if(this.api&&!this._noApply){var o=this._originalProps||new AscCommon.CContentControlPr,s=this._originalPictProps||new AscCommon.CSdtPictureFormPr;s.put_ConstantProportions("checked"==t.getValue()),o.put_PictureFormPr(s),this.api.asc_SetContentControlProperties(o,this.internalId),this.fireEvent("editcomplete",this)}},onScaleChanged:function(t,e){if(this.api&&!this._noApply){var i=this._originalProps||new AscCommon.CContentControlPr,n=this._originalPictProps||new AscCommon.CSdtPictureFormPr;n.put_ScaleFlag(e.value),i.put_PictureFormPr(n),this.api.asc_SetContentControlProperties(i,this.internalId),this.fireEvent("editcomplete",this)}},onGroupKeyChanged:function(t,e){if(this.api&&!this._noApply){var i=this._originalProps||new AscCommon.CContentControlPr,n=this._originalCheckProps||new AscCommon.CSdtCheckBoxPr;n.put_GroupKey(e.value),i.put_CheckBoxPr(n),this.api.asc_SetContentControlProperties(i,this.internalId),this.fireEvent("editcomplete",this)}},fillListProps:function(){if(this.api&&!this._noApply){var t=this._originalProps||new AscCommon.CContentControlPr,e=this._originalListProps||new AscCommon.CSdtComboBoxPr;e.clear(),this.list.store.each(function(t,i){e.add_Item(t.get("name"),t.get("value"))}),this.type==Asc.c_oAscContentControlSpecificType.ComboBox?t.put_ComboBoxPr(e):t.put_DropDownListPr(e),this.api.asc_SetContentControlProperties(t,this.internalId)}},onNewValueKeydown:function(t){this.api&&!this._noApply&&t.keyCode==Common.UI.Keys.RETURN&&this.onAddItem()},onAddItem:function(){var t=this.list.store,e=this.txtNewValue.getValue();if(""!==e){t.findWhere({value:e})||(t.add({value:e,name:e}),this._state.listValue=e,this._state.listIndex=void 0,this.fillListProps())}this.fireEvent("editcomplete",this)},onDeleteItem:function(t,e){var i=this.list.getSelectedRec();if(i){var n=this.list.store;this._state.listIndex=n.indexOf(i),this._state.listValue=void 0,n.remove(i),this.fillListProps()}this.fireEvent("editcomplete",this)},onMoveItem:function(t){var e=this.list.store,i=e.length,n=this.list.getSelectedRec();if(n){var o=e.indexOf(n);e.add(e.remove(n),{at:t?Math.max(0,o-1):Math.min(i-1,o+1)}),this.fillListProps()}this.fireEvent("editcomplete",this)},setImageUrl:function(t,e){this.api.asc_SetContentControlPictureUrl(t,this.internalId,e)},insertImageFromStorage:function(t){t&&t.url&&"control"==t.c&&this.setImageUrl(t.url,t.token)},onImageSelect:function(t,e){if(1==e.value){var n=this;new Common.Views.ImageFromUrlDialog({handler:function(t,e){if("ok"==t&&n.api){var o=e.replace(/ /g,"");i.isEmpty(o)||n.setImageUrl(o)}n.fireEvent("editcomplete",n)}}).show()}else if(2==e.value)Common.NotificationCenter.trigger("storage:image-load","control");else{if(this._isFromFile)return;this._isFromFile=!0,this.api&&this.api.asc_addImage(this._originalProps),this.fireEvent("editcomplete",this),this._isFromFile=!1}},onColorPickerSelect:function(t,e){if(this.BorderColor=e,this._state.BorderColor=void 0,this.api&&!this._noApply){var i=this._originalProps||new AscCommon.CContentControlPr,n=this._originalFormProps||new AscCommon.CSdtFormPr;if("transparent"==e)n.put_Border();else{var o=n.get_Border();o||(o=new Asc.asc_CTextBorder),o.put_Value(1),o.put_Color(Common.Utils.ThemeColor.getRgbColor(e)),n.put_Border(o)}i.put_FormPr(n),this.api.asc_SetContentControlProperties(i,this.internalId),this.fireEvent("editcomplete",this)}},onNoBorderClick:function(t){if(this.BorderColor="transparent",this._state.BorderColor=void 0,this.api&&!this._noApply){var e=this._originalProps||new AscCommon.CContentControlPr,i=this._originalFormProps||new AscCommon.CSdtFormPr;i.put_Border(),e.put_FormPr(i),this.api.asc_SetContentControlProperties(e,this.internalId),this.fireEvent("editcomplete",this)}},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedElements(),t){this._originalProps=t,this._noApply=!0,this.internalId=t.get_InternalId();var e=t.get_PlaceholderText();this._state.placeholder!==e&&(this.txtPlaceholder.setValue(e||""),this._state.placeholder=e),e=t.get_Lock(),void 0===e&&(e=Asc.c_oAscSdtLockType.Unlocked),this._state.LockDelete!==(e==Asc.c_oAscSdtLockType.SdtContentLocked||e==Asc.c_oAscSdtLockType.SdtLocked)&&(this._state.LockDelete=e==Asc.c_oAscSdtLockType.SdtContentLocked||e==Asc.c_oAscSdtLockType.SdtLocked,this.btnLockForm.setCaption(this._state.LockDelete?this.textUnlock:this.textLock)),this.disableControls(this._locked);var n,o=t.get_SpecificType(),s=!1;if(o==Asc.c_oAscContentControlSpecificType.ComboBox||o==Asc.c_oAscContentControlSpecificType.DropDownList){if(this.labelFormName.text(o==Asc.c_oAscContentControlSpecificType.ComboBox?this.textCombobox:this.textDropDown),n=o==Asc.c_oAscContentControlSpecificType.ComboBox?t.get_ComboBoxPr():t.get_DropDownListPr()){this._originalListProps=n;for(var a=n.get_ItemsCount(),r=[],l=0;l<a;l++)""!==n.get_ItemValue(l)&&r.push({value:n.get_ItemValue(l),name:n.get_ItemDisplayText(l)});this.list.store.reset(r);var c=null;r.length>0&&this._state.internalId===this.internalId&&(void 0!==this._state.listValue||void 0!==this._state.listIndex)&&(void 0!==this._state.listIndex&&this._state.listIndex>=this.list.store.length&&(this._state.listIndex=this.list.store.length-1),c=void 0!==this._state.listValue?this.list.store.findWhere({value:this._state.listValue}):this.list.store.at(this._state.listIndex)),c?(this.list.selectRecord(c,this.txtNewValue._input.is(":focus")),this.list.scrollToRecord(c)):this.txtNewValue._input.is(":focus")||(this.txtNewValue.setValue(""),this._state.listValue=this._state.listIndex=void 0)}this.disableListButtons()}else o==Asc.c_oAscContentControlSpecificType.CheckBox&&(n=t.get_CheckBoxPr(),this._originalCheckProps=n);var d=t.get_FormPr();if(d){this._originalFormProps=d;var h=[];if(o==Asc.c_oAscContentControlSpecificType.CheckBox?h=this.api.asc_GetCheckBoxFormKeys():o==Asc.c_oAscContentControlSpecificType.Picture?(h=this.api.asc_GetPictureFormKeys(),this.labelFormName.text(this.textImage)):h=this.api.asc_GetTextFormKeys(),!this._state.arrKey||this._state.arrKey.length!==h.length||i.difference(this._state.arrKey,h).length>0){var r=[];h.forEach(function(t){r.push({displayValue:t,value:t})}),this.cmbKey.setData(r),this._state.arrKey=h}if(e=d.get_Key(),this._state.Key!==e&&(this.cmbKey.setValue(e||""),this._state.Key=e),e&&(e=this.api.asc_GetFormsCountByKey(e),s=e>1),s&&this.labelConnectedFields.text(this.textConnected+": "+e),e=d.get_HelpText(),this._state.help!==e&&(this.textareaHelp.setValue(e||""),this._state.help=e),e=d.get_Required(),this._state.Required!==e&&(this.chRequired.setValue(!!e,!0),this._state.Required=e),o==Asc.c_oAscContentControlSpecificType.CheckBox&&n){e=n.get_GroupKey();var p="string"!=typeof e;if(!p){if(h=this.api.asc_GetRadioButtonGroupKeys(),!this._state.arrGroupKey||this._state.arrGroupKey.length!==h.length||i.difference(this._state.arrGroupKey,h).length>0){var r=[];h.forEach(function(t){r.push({displayValue:t,value:t})}),this.cmbGroupKey.setData(r),this._state.arrGroupKey=h}this._state.groupKey!==e&&(this.cmbGroupKey.setValue(e||""),this._state.groupKey=e)}this.labelFormName.text(p?this.textCheckbox:this.textRadiobox)}o!==Asc.c_oAscContentControlSpecificType.Picture&&(e=d.get_Fixed(),this._state.Fixed!==e&&(this.chFixed.setValue(!!e,!0),this._state.Fixed=e));var m=d.get_Border();if(m){var u=m.get_Color();u?u.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.BorderColor={color:Common.Utils.ThemeColor.getHexColor(u.get_r(),u.get_g(),u.get_b()),effectValue:u.get_value()}:this.BorderColor=Common.Utils.ThemeColor.getHexColor(u.get_r(),u.get_g(),u.get_b()):this.BorderColor="transparent"}else this.BorderColor="transparent";var g=typeof this.BorderColor;(g!==typeof this._state.BorderColor||"object"==g&&(this.BorderColor.effectValue!==this._state.BorderColor.effectValue||this._state.BorderColor.color.indexOf(this.BorderColor.color)<0)||"object"!=g&&this._state.BorderColor.indexOf(this.BorderColor)<0)&&(this.btnColor.setColor(this.BorderColor),this.mnuColorPicker.clearSelection(),this.mnuNoBorder.setChecked("transparent"==this.BorderColor,!0),"transparent"!=this.BorderColor&&this.mnuColorPicker.selectByRGB("object"==typeof this.BorderColor?this.BorderColor.color:this.BorderColor,!0),this._state.BorderColor=this.BorderColor)}var b=t.get_PictureFormPr();b&&(this._originalPictProps=b,e=b.get_ConstantProportions(),this._state.Aspect!==e&&(this.chAspect.setValue(!!e,!0),this._state.Aspect=e),e=b.get_ScaleFlag(),this._state.scaleFlag!==e&&(this.cmbScale.setValue(e),this._state.scaleFlag=e));var f=t.get_TextFormPr();f&&(this._originalTextFormProps=f,this.labelFormName.text(this.textField),e=f.get_Comb(),this._state.Comb!==e&&(this.chComb.setValue(!!e,!0),this._state.Comb=e),e=f.get_MultiLine(),this._state.Multi!==e&&(this.chMulti.setValue(!!e,!0),this._state.Multi=e),this.chMulti.setDisabled(!this._state.Fixed||this._state.Comb),e=f.get_AutoFit(),this._state.AutoFit!==e&&(this.chAutofit.setValue(!!e,!0),this._state.AutoFit=e),this.chAutofit.setDisabled(!this._state.Fixed||this._state.Comb),this.spnWidth.setDisabled(!this._state.Comb),e=f.get_Width(),((void 0===e||void 0===this._state.Width)&&this._state.Width!==e||Math.abs(this._state.Width-e)>.1)&&(this.spnWidth.setValue(0!==e&&void 0!==e?Common.Utils.Metric.fnRecalcFromMM(25.4*e/20/72):-1,!0),this._state.Width=e),e=this.api.asc_GetTextFormAutoWidth(),(this._state.WidthPlaceholder!==e||Math.abs(this._state.WidthPlaceholder-e)>.01)&&(this.spnWidth.setDefaultValue(void 0!==e&&null!==e?Common.Utils.Metric.fnRecalcFromMM(25.4*(e+1)/20/72):this.spnWidth.options.minValue),this._state.WidthPlaceholder=e),e=f.get_MaxCharacters(),this.chMaxChars.setValue(e&&e>=0),this.spnMaxChars.setDisabled(!e||e<0),((void 0===e||void 0===this._state.MaxChars)&&this._state.MaxChars!==e||Math.abs(this._state.MaxChars-e)>.1)&&(this.spnMaxChars.setValue(e&&e>=0?e:10,!0),this._state.MaxChars=e)),this._noApply=!1,this.KeySettingsTd.toggleClass("padding-small",!s),this.ConnectedSettings.toggleClass("hidden",!s),this.type===o&&o!=Asc.c_oAscContentControlSpecificType.CheckBox||this.showHideControls(o,f,n),this.type=o,this._state.internalId=this.internalId}},updateMetricUnit:function(){if(this.spinners){for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}var i=this._state.Width;this.spnWidth&&this.spnWidth.setMinValue(Common.Utils.Metric.fnRecalcFromMM(1)),this.spnWidth&&this.spnWidth.setValue(0!==i&&void 0!==i?Common.Utils.Metric.fnRecalcFromMM(25.4*i/20/72):-1,!0)}},UpdateThemeColors:function(){this._initSettings||this.btnColor||(this.btnColor=new Common.UI.ColorButton({parentEl:(this.$el||e(this.el)).findById("#form-color-btn"),additionalItems:[this.mnuNoBorder=new Common.UI.MenuItem({style:"padding-left:20px;",caption:this.textNoBorder,toggleGroup:"form-settings-no-border",checkable:!0}),{caption:"--"}],menu:!0,colors:["000000","993300","333300","003300","003366","000080","333399","333333","800000","FF6600","808000","00FF00","008080","0000FF","666699","808080","FF0000","FF9900","99CC00","339966","33CCCC","3366FF","800080","999999","FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0","FF99CC","FFCC99","FFFF99","CCFFCC","CCFFFF","C9C8FF","CC99FF","FFFFFF"],paletteHeight:94}),this.lockedControls.push(this.btnColor),this.mnuNoBorder.on("click",i.bind(this.onNoBorderClick,this)),this.btnColor.on("color:select",this.onColorPickerSelect.bind(this)),this.btnColor.setMenu(),this.mnuColorPicker=this.btnColor.getPicker())},onHideMenus:function(t,e,i){i||this.fireEvent("editcomplete",this)},setLocked:function(t){this._locked=t},disableControls:function(t){if(!this._initSettings){var e=this;this._state.DisabledControls!==(this._state.LockDelete||t)&&(this._state.DisabledControls=this._state.LockDelete||t,i.each(this.lockedControls,function(t){t.setDisabled(e._state.DisabledControls)})),this.btnLockForm.setDisabled(t)}},showHideControls:function(t,e,i){var n=!1,o=!1,s=!1,a=!1,r=!1;t==Asc.c_oAscContentControlSpecificType.ComboBox||t==Asc.c_oAscContentControlSpecificType.DropDownList?a=!!i:t==Asc.c_oAscContentControlSpecificType.CheckBox?i&&(o="string"!=typeof i.get_GroupKey(),s=!o):t==Asc.c_oAscContentControlSpecificType.Picture?r=!0:t==Asc.c_oAscContentControlSpecificType.None&&(n=!!e),this.TextOnlySettings.toggleClass("hidden",!n),this.ListOnlySettings.toggleClass("hidden",!a),this.ImageOnlySettings.toggleClass("hidden",!r),this.RadioOnlySettings.toggleClass("hidden",!s),this.KeySettings.toggleClass("hidden",s);var l=o||s;this.PlaceholderSettings.toggleClass("hidden",l),this.CheckOnlySettings.toggleClass("hidden",!l),this.NotImageSettings.toggleClass("hidden",r)},onSelectItem:function(t,e,i){i&&(this.txtNewValue.setValue(i.get("name")),this._state.listValue=i.get("name"),this._state.listIndex=void 0,this.disableListButtons(!1))},onDisconnect:function(){this.onKeyChanged(this.cmbKey,{value:""})},disableListButtons:function(t){void 0===t&&(t=!this.list.getSelectedRec()),this.btnListDelete.setDisabled(t||this._state.DisabledControls),this.btnListUp.setDisabled(t||this._state.DisabledControls),this.btnListDown.setDisabled(t||this._state.DisabledControls)},textField:"Text Field",textKey:"Key",textPlaceholder:"Placeholder",textTip:"Tip",textMaxChars:"Characters limit",textComb:"Comb of characters",textWidth:"Cell width",textDelete:"Delete",textLock:"Lock",textUnlock:"Unlock",textRadiobox:"Radio Button",textCheckbox:"Checkbox",textCombobox:"Combo Box",textDropDown:"Dropdown",textImage:"Image",textGroupKey:"Group key",textTipAdd:"Add new value",textTipDelete:"Delete value",textTipUp:"Move up",textTipDown:"Move down",textValue:"Value Options",textSelectImage:"Select Image",textFromUrl:"From URL",textFromFile:"From File",textFromStorage:"From Storage",textColor:"Border color",textConnected:"Fields connected",textDisconnect:"Disconnect",textNoBorder:"No border",textFixed:"Fixed size field",textRequired:"Required",textAutofit:"AutoFit",textMulti:"Multiline field",textAspect:"Lock aspect ratio",textAlways:"Always",textNever:"Never",textTooBig:"Image is Too Big",textTooSmall:"Image is Too Small",textScale:"When to scale"},DE.Views.FormSettings||{}))});var SCALE_MIN=40,MENU_SCALE_PART=260;if(define("documenteditor/main/app/view/RightMenu",["text!documenteditor/main/app/template/RightMenu.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox","documenteditor/main/app/view/ParagraphSettings","documenteditor/main/app/view/HeaderFooterSettings","documenteditor/main/app/view/ImageSettings","documenteditor/main/app/view/ChartSettings","documenteditor/main/app/view/TableSettings","documenteditor/main/app/view/ShapeSettings","documenteditor/main/app/view/MailMergeSettings","documenteditor/main/app/view/TextArtSettings","documenteditor/main/app/view/SignatureSettings","documenteditor/main/app/view/FormSettings","common/main/lib/component/Scroller"],function(t,e,i,n){"use strict";DE.Views.RightMenu=n.View.extend(i.extend({el:"#right-menu",template:i.template(t),events:{},initialize:function(){return this.minimizedMode=!0,this.btnText=new Common.UI.Button({hint:this.txtParagraphSettings,asctype:Common.Utils.documentSettingsType.Paragraph,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnTable=new Common.UI.Button({hint:this.txtTableSettings,asctype:Common.Utils.documentSettingsType.Table,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnImage=new Common.UI.Button({hint:this.txtImageSettings,asctype:Common.Utils.documentSettingsType.Image,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnHeaderFooter=new Common.UI.Button({hint:this.txtHeaderFooterSettings,asctype:Common.Utils.documentSettingsType.Header,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnChart=new Common.UI.Button({hint:this.txtChartSettings,asctype:Common.Utils.documentSettingsType.Chart,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnShape=new Common.UI.Button({hint:this.txtShapeSettings,asctype:Common.Utils.documentSettingsType.Shape,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnTextArt=new Common.UI.Button({hint:this.txtTextArtSettings,asctype:Common.Utils.documentSettingsType.TextArt,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this._settings=[],this._settings[Common.Utils.documentSettingsType.Paragraph]={panel:"id-paragraph-settings",btn:this.btnText},this._settings[Common.Utils.documentSettingsType.Table]={panel:"id-table-settings",btn:this.btnTable},this._settings[Common.Utils.documentSettingsType.Image]={panel:"id-image-settings",btn:this.btnImage},this._settings[Common.Utils.documentSettingsType.Header]={panel:"id-header-settings",btn:this.btnHeaderFooter},this._settings[Common.Utils.documentSettingsType.Shape]={panel:"id-shape-settings",btn:this.btnShape},this._settings[Common.Utils.documentSettingsType.Chart]={panel:"id-chart-settings",btn:this.btnChart},this._settings[Common.Utils.documentSettingsType.TextArt]={panel:"id-textart-settings",btn:this.btnTextArt},this},render:function(t){this.trigger("render:before",this),this.defaultHideRightMenu=t.customization&&!!t.customization.hideRightMenu;var n=!Common.localStorage.getBool("de-hide-right-settings",this.defaultHideRightMenu);this.$el.css("width",(n?MENU_SCALE_PART:SCALE_MIN)+"px"),this.$el.show();var o=e(this.template({}));return this.$el.html(o),this.btnText.setElement(o.findById("#id-right-menu-text"),!1),this.btnText.render(),this.btnTable.setElement(o.findById("#id-right-menu-table"),!1),this.btnTable.render(),this.btnImage.setElement(o.findById("#id-right-menu-image"),!1),this.btnImage.render(),this.btnHeaderFooter.setElement(o.findById("#id-right-menu-header"),!1),this.btnHeaderFooter.render(),this.btnChart.setElement(o.findById("#id-right-menu-chart"),!1),this.btnChart.render(),this.btnShape.setElement(o.findById("#id-right-menu-shape"),!1),this.btnShape.render(),this.btnTextArt.setElement(o.findById("#id-right-menu-textart"),!1),this.btnTextArt.render(),this.btnText.on("click",this.onBtnMenuClick.bind(this)),this.btnTable.on("click",this.onBtnMenuClick.bind(this)),this.btnImage.on("click",this.onBtnMenuClick.bind(this)),this.btnHeaderFooter.on("click",this.onBtnMenuClick.bind(this)),this.btnChart.on("click",this.onBtnMenuClick.bind(this)),this.btnShape.on("click",this.onBtnMenuClick.bind(this)),this.btnTextArt.on("click",this.onBtnMenuClick.bind(this)),this.paragraphSettings=new DE.Views.ParagraphSettings,this.headerSettings=new DE.Views.HeaderFooterSettings,this.imageSettings=new DE.Views.ImageSettings,this.chartSettings=new DE.Views.ChartSettings,this.tableSettings=new DE.Views.TableSettings,this.shapeSettings=new DE.Views.ShapeSettings,this.textartSettings=new DE.Views.TextArtSettings,t&&t.canCoAuthoring&&t.canUseMailMerge&&(this.btnMailMerge=new Common.UI.Button({hint:this.txtMailMergeSettings,asctype:Common.Utils.documentSettingsType.MailMerge,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this._settings[Common.Utils.documentSettingsType.MailMerge]={panel:"id-mail-merge-settings",btn:this.btnMailMerge},this.btnMailMerge.setElement(o.findById("#id-right-menu-mail-merge"),!1),this.btnMailMerge.render().setVisible(!0),this.btnMailMerge.on("click",this.onBtnMenuClick.bind(this)),this.mergeSettings=new DE.Views.MailMergeSettings),t&&t.isSignatureSupport&&(this.btnSignature=new Common.UI.Button({hint:this.txtSignatureSettings,asctype:Common.Utils.documentSettingsType.Signature,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this._settings[Common.Utils.documentSettingsType.Signature]={panel:"id-signature-settings",btn:this.btnSignature},this.btnSignature.setElement(o.findById("#id-right-menu-signature"),!1),this.btnSignature.render().setVisible(!0),this.btnSignature.on("click",this.onBtnMenuClick.bind(this)),this.signatureSettings=new DE.Views.SignatureSettings),t&&t.canFeatureContentControl&&t.canEditContentControl&&t.canFeatureForms&&(this.btnForm=new Common.UI.Button({hint:this.txtFormSettings,asctype:Common.Utils.documentSettingsType.Form,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this._settings[Common.Utils.documentSettingsType.Form]={panel:"id-form-settings",btn:this.btnForm},this.btnForm.setElement(o.findById("#id-right-menu-form"),!1),this.btnForm.render().setVisible(!0),this.btnForm.on("click",this.onBtnMenuClick.bind(this)),this.formSettings=new DE.Views.FormSettings),i.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:e(this.el).find(".right-panel"),suppressScrollX:!0,useKeyboard:!1})),n&&(o.findById("#id-paragraph-settings").parent().css("display","inline-block"),o.findById("#id-paragraph-settings").addClass("active")),this.trigger("render:after",this),this},setApi:function(t){var e=this;e.api=t;var i=function(){e.fireEvent("editcomplete",e)};this.paragraphSettings.setApi(t).on("editcomplete",i),this.headerSettings.setApi(t).on("editcomplete",i),this.imageSettings.setApi(t).on("editcomplete",i),this.chartSettings.setApi(t).on("editcomplete",i),this.tableSettings.setApi(t).on("editcomplete",i),this.shapeSettings.setApi(t).on("editcomplete",i),this.textartSettings.setApi(t).on("editcomplete",i),this.mergeSettings&&this.mergeSettings.setApi(t).on("editcomplete",i),this.signatureSettings&&this.signatureSettings.setApi(t).on("editcomplete",i),this.formSettings&&this.formSettings.setApi(t).on("editcomplete",i)},setMode:function(t){this.mergeSettings&&this.mergeSettings.setMode(t),this.imageSettings&&this.imageSettings.setMode(t),this.shapeSettings&&this.shapeSettings.setMode(t),this.formSettings&&this.formSettings.setMode(t)},onBtnMenuClick:function(t,i){var n=e("#"+this._settings[t.options.asctype].panel),o=n.parent();t.pressed?(this.minimizedMode&&(e(this.el).width(MENU_SCALE_PART),o.css("display","inline-block"),this.minimizedMode=!1,Common.localStorage.setItem("de-hide-right-settings",0)),o.find("> .active").removeClass("active"),n.addClass("active"),this.scroller&&this.scroller.scrollTop(0)):(o.css("display","none"),e(this.el).width(SCALE_MIN),this.minimizedMode=!0,Common.localStorage.setItem("de-hide-right-settings",1)),this.fireEvent("rightmenuclick",[this,t.options.asctype,this.minimizedMode,i])},SetActivePane:function(t,e){if(!(this.minimizedMode&&!0!==e||void 0===this._settings[t]))if(this.minimizedMode)this._settings[t].btn.toggle(!0,!1),this._settings[t].btn.trigger("click",this._settings[t].btn);else{var i=this.$el.find("#"+this._settings[t].panel);i.hasClass("active")||(i.parent().find("> .active").removeClass("active"),i.addClass("active"),this.scroller&&(this.scroller.update(),this.scroller.scrollTop(0))),this._settings[t].btn.isActive()||this._settings[t].btn.toggle(!0,!1)}},GetActivePane:function(){return this.minimizedMode?null:this.$el.find(".settings-panel.active")[0].id},clearSelection:function(){this.mergeSettings&&this.mergeSettings.disablePreviewMode();var t=e(".right-panel");t.find("> .active").removeClass("active"),this._settings.forEach(function(t){t.btn.isActive()&&t.btn.toggle(!1,!0)}),t.css("display","none"),e(this.el).width(SCALE_MIN),this.minimizedMode=!0,Common.NotificationCenter.trigger("layout:changed","rightmenu")},txtParagraphSettings:"Paragraph Settings",txtImageSettings:"Image Settings",txtTableSettings:"Table Settings",txtHeaderFooterSettings:"Header and Footer Settings",txtShapeSettings:"Shape Settings",txtTextArtSettings:"Text Art Settings",txtChartSettings:"Chart Settings",txtMailMergeSettings:"Mail Merge Settings",txtSignatureSettings:"Signature Settings",txtFormSettings:"Form Settings"},DE.Views.RightMenu||{}))}),define("documenteditor/main/app/controller/RightMenu",["core","documenteditor/main/app/view/RightMenu"],function(){"use strict";DE.Controllers.RightMenu=Backbone.Controller.extend({models:[],collections:[],views:["RightMenu"],initialize:function(){this.editMode=!0,this._initSettings=!0,this.addListeners({RightMenu:{rightmenuclick:this.onRightMenuClick}}),Common.Utils.InternalSettings.set("de-rightpanel-active-form",1)},onLaunch:function(){this.rightmenu=this.createView("RightMenu"),this.rightmenu.on("render:after",_.bind(this.onRightMenuAfterRender,this))},onRightMenuAfterRender:function(t){t.shapeSettings.application=t.textartSettings.application=this.getApplication(),this._settings=[],this._settings[Common.Utils.documentSettingsType.Paragraph]={panelId:"id-paragraph-settings",panel:t.paragraphSettings,btn:t.btnText,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Table]={panelId:"id-table-settings",panel:t.tableSettings,btn:t.btnTable,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Image]={panelId:"id-image-settings",panel:t.imageSettings,btn:t.btnImage,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Header]={panelId:"id-header-settings",panel:t.headerSettings,btn:t.btnHeaderFooter,hidden:1,locked:!1,needShow:!0},this._settings[Common.Utils.documentSettingsType.Shape]={panelId:"id-shape-settings",panel:t.shapeSettings,btn:t.btnShape,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.TextArt]={panelId:"id-textart-settings",panel:t.textartSettings,btn:t.btnTextArt,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Chart]={panelId:"id-chart-settings",panel:t.chartSettings,btn:t.btnChart,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.MailMerge]={panelId:"id-mail-merge-settings",panel:t.mergeSettings,btn:t.btnMailMerge,hidden:1,props:{},locked:!1},this._settings[Common.Utils.documentSettingsType.Signature]={panelId:"id-signature-settings",panel:t.signatureSettings,btn:t.btnSignature,hidden:1,props:{},locked:!1},this._settings[Common.Utils.documentSettingsType.Form]={panelId:"id-form-settings",panel:t.formSettings,btn:t.btnForm,hidden:1,props:{},locked:!1}},setApi:function(t){this.api=t,this.api.asc_registerCallback("asc_onUpdateSignatures",_.bind(this.onApiUpdateSignatures,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this))},setMode:function(t){this.editMode=t.isEdit},onRightMenuClick:function(t,e,i,n){if(!i&&this.editMode){n&&(this._settings[Common.Utils.documentSettingsType.Form].hidden||(e==Common.Utils.documentSettingsType.Form?(this._settings[Common.Utils.documentSettingsType.Paragraph].hidden||Common.Utils.InternalSettings.set("de-rightpanel-active-para",0),this._settings[Common.Utils.documentSettingsType.Image].hidden||Common.Utils.InternalSettings.set("de-rightpanel-active-image",0),this._settings[Common.Utils.documentSettingsType.Shape].hidden||Common.Utils.InternalSettings.set("de-rightpanel-active-shape",0)):e==Common.Utils.documentSettingsType.Paragraph?Common.Utils.InternalSettings.set("de-rightpanel-active-para",2):e==Common.Utils.documentSettingsType.Image?(Common.Utils.InternalSettings.set("de-rightpanel-active-image",2),Common.Utils.InternalSettings.set("de-rightpanel-active-shape",0)):e==Common.Utils.documentSettingsType.Shape&&(Common.Utils.InternalSettings.set("de-rightpanel-active-shape",2),Common.Utils.InternalSettings.set("de-rightpanel-active-image",0))));var o=this._settings[e].panel,s=this._settings[e].props;s&&o&&o.ChangeSettings.call(o,e==Common.Utils.documentSettingsType.MailMerge||e==Common.Utils.documentSettingsType.Signature?void 0:s)}else i&&e==Common.Utils.documentSettingsType.MailMerge&&this.rightmenu.mergeSettings.disablePreviewMode();Common.NotificationCenter.trigger("layout:changed","rightmenu"),this.rightmenu.fireEvent("editcomplete",this.rightmenu)},onFocusObject:function(t){if(this.editMode){var e=!!this._initSettings&&!Common.localStorage.getBool("de-hide-right-settings",this.rightmenu.defaultHideRightMenu);this._initSettings=!1;for(var i=!1,n=!1,o=0;o<this._settings.length;o++)o!=Common.Utils.documentSettingsType.MailMerge&&o!=Common.Utils.documentSettingsType.Signature&&this._settings[o]&&(this._settings[o].hidden=1,this._settings[o].locked=!1);this._settings[Common.Utils.documentSettingsType.MailMerge].locked=!1,this._settings[Common.Utils.documentSettingsType.Signature].locked=!1;var s=!1,a=this.api.asc_IsContentControl()?this.api.asc_GetContentControlProperties():null,r=!1;for(o=0;o<t.length;o++){var l=!1,c=t[o].get_ObjectType(),d=this.getDocumentSettingsType(c);if(c===Asc.c_oAscTypeSelectElement.Math&&(n=!0),!(void 0===d||d>=this._settings.length||void 0===this._settings[d])){var h=t[o].get_ObjectValue();if(d==Common.Utils.documentSettingsType.Image){var p=a?a.get_Lock():Asc.c_oAscSdtLockType.Unlocked;l=p==Asc.c_oAscSdtLockType.SdtContentLocked||p==Asc.c_oAscSdtLockType.ContentLocked,null!==h.get_ChartProperties()?(s=!0,d=Common.Utils.documentSettingsType.Chart):null!==h.get_ShapeProperties()&&(s=h.get_ShapeProperties().get_FromChart(),d=Common.Utils.documentSettingsType.Shape,h.get_ShapeProperties().asc_getTextArtProperties()&&(this._settings[Common.Utils.documentSettingsType.TextArt].props=h,this._settings[Common.Utils.documentSettingsType.TextArt].hidden=0,this._settings[Common.Utils.documentSettingsType.TextArt].locked=h.get_Locked()||l)),r=r||h.get_Locked()}else d==Common.Utils.documentSettingsType.Paragraph&&(this._settings[d].panel.isChart=s,i=h.get_CanAddTable(),r=r||h.get_Locked());this._settings[d].props=h,this._settings[d].hidden=0,this._settings[d].locked=h.get_Locked()||l,this._settings[Common.Utils.documentSettingsType.MailMerge].locked||(this._settings[Common.Utils.documentSettingsType.MailMerge].locked=h.get_Locked()),this._settings[Common.Utils.documentSettingsType.Signature].locked||(this._settings[Common.Utils.documentSettingsType.Signature].locked=h.get_Locked())}}if(a&&a.get_FormPr()&&this.rightmenu.formSettings){var m=a.get_SpecificType();m!=Asc.c_oAscContentControlSpecificType.CheckBox&&m!=Asc.c_oAscContentControlSpecificType.Picture&&m!=Asc.c_oAscContentControlSpecificType.ComboBox&&m!=Asc.c_oAscContentControlSpecificType.DropDownList&&m!=Asc.c_oAscContentControlSpecificType.None||(d=Common.Utils.documentSettingsType.Form,this._settings[d].props=a,this._settings[d].locked=r,
this._settings[d].hidden=0)}if(this._settings[Common.Utils.documentSettingsType.Header].locked)for(o=0;o<this._settings.length;o++)this._settings[o]&&(this._settings[o].locked=!0);this._settings[Common.Utils.documentSettingsType.MailMerge].locked||(this._settings[Common.Utils.documentSettingsType.MailMerge].locked=!i||n);var u,g=-1,b=-1,f=this.rightmenu.GetActivePane();for(o=0;o<this._settings.length;o++){var C=this._settings[o];void 0!==C&&void 0!==C.btn&&void 0!==C.panel&&(C.hidden?(C.btn.isDisabled()||C.btn.setDisabled(!0),f==C.panelId&&(u=-1)):(C.btn.isDisabled()&&C.btn.setDisabled(!1),o!=Common.Utils.documentSettingsType.MailMerge&&o!=Common.Utils.documentSettingsType.Signature&&(g=o),C.needShow?(C.needShow=!1,b=o):f==C.panelId&&(u=o),C.panel.setLocked(C.locked)))}if(this._settings[Common.Utils.documentSettingsType.MailMerge].hidden||this._settings[Common.Utils.documentSettingsType.MailMerge].panel.setLocked(this._settings[Common.Utils.documentSettingsType.MailMerge].locked),!this.rightmenu.minimizedMode||e){var v;if(b<0&&!this._settings[Common.Utils.documentSettingsType.Form].hidden&&(!this._settings[Common.Utils.documentSettingsType.Paragraph].hidden||!this._settings[Common.Utils.documentSettingsType.Image].hidden||!this._settings[Common.Utils.documentSettingsType.Shape].hidden)){var _=Common.Utils.InternalSettings.get("de-rightpanel-active-image")||0,y=Common.Utils.InternalSettings.get("de-rightpanel-active-shape")||0,x=Common.Utils.InternalSettings.get("de-rightpanel-active-para")||0,w=Common.Utils.InternalSettings.get("de-rightpanel-active-form")||0;this._settings[Common.Utils.documentSettingsType.Paragraph].hidden?this._settings[Common.Utils.documentSettingsType.Paragraph].Image&&this._settings[Common.Utils.documentSettingsType.Shape].hidden||(b=w>y&&w>_?Common.Utils.documentSettingsType.Form:y>w&&y>_?Common.Utils.documentSettingsType.Shape:Common.Utils.documentSettingsType.Image):b=w>x?Common.Utils.documentSettingsType.Form:Common.Utils.documentSettingsType.Paragraph}b>-1?v=b:g>=0&&u<0?v=g:u>=0?v=u:this._settings[Common.Utils.documentSettingsType.MailMerge].hidden||(v=Common.Utils.documentSettingsType.MailMerge),void 0==v&&e&&g>=0&&(v=g),void 0!==v&&(this.rightmenu.SetActivePane(v,e),v!=Common.Utils.documentSettingsType.MailMerge&&v!=Common.Utils.documentSettingsType.Signature?this._settings[v].panel.ChangeSettings.call(this._settings[v].panel,this._settings[v].props):this._settings[v].panel.ChangeSettings.call(this._settings[v].panel))}this._settings[Common.Utils.documentSettingsType.Image].needShow=!1,this._settings[Common.Utils.documentSettingsType.Chart].needShow=!1}},onCoAuthoringDisconnect:function(){this.SetDisabled(!0,!1)},onInsertTable:function(){this._settings[Common.Utils.documentSettingsType.Table].needShow=!0},onInsertImage:function(){this._settings[Common.Utils.documentSettingsType.Image].needShow=!0},onInsertChart:function(){this._settings[Common.Utils.documentSettingsType.Chart].needShow=!0},onInsertShape:function(){this._settings[Common.Utils.documentSettingsType.Shape].needShow=!0},onInsertTextArt:function(){this._settings[Common.Utils.documentSettingsType.TextArt].needShow=!0},onInsertControl:function(){this._settings[Common.Utils.documentSettingsType.Form]&&(this._settings[Common.Utils.documentSettingsType.Form].needShow=!0)},UpdateThemeColors:function(){this.rightmenu.paragraphSettings.UpdateThemeColors(),this.rightmenu.tableSettings.UpdateThemeColors(),this.rightmenu.shapeSettings.UpdateThemeColors(),this.rightmenu.textartSettings.UpdateThemeColors()},updateMetricUnit:function(){this.rightmenu.headerSettings.updateMetricUnit(),this.rightmenu.paragraphSettings.updateMetricUnit(),this.rightmenu.chartSettings.updateMetricUnit(),this.rightmenu.imageSettings.updateMetricUnit(),this.rightmenu.tableSettings.updateMetricUnit(),this.rightmenu.formSettings&&this.rightmenu.formSettings.updateMetricUnit()},createDelayedElements:function(){if(this.api&&(this.api.asc_registerCallback("asc_onFocusObject",_.bind(this.onFocusObject,this)),this.api.asc_registerCallback("asc_doubleClickOnObject",_.bind(this.onDoubleClickOnObject,this)),this.rightmenu.mergeSettings&&(this.rightmenu.mergeSettings.setDocumentName(this.getApplication().getController("Viewport").getView("Common.Views.Header").getDocumentCaption()),this.api.asc_registerCallback("asc_onStartMailMerge",_.bind(this.onStartMailMerge,this))),this.api.asc_registerCallback("asc_onError",_.bind(this.onError,this))),this.editMode&&this.api){var t=this.api.getSelectedElements();t.length>0&&this.onFocusObject(t)}},onDoubleClickOnObject:function(t){if(this.editMode){var e=t.get_ObjectType(),i=this.getDocumentSettingsType(e);if(!(void 0===i||i>=this._settings.length||void 0===this._settings[i])){var n=t.get_ObjectValue();i==Common.Utils.documentSettingsType.Image&&(null!==n.get_ChartProperties()?i=Common.Utils.documentSettingsType.Chart:null!==n.get_ShapeProperties()&&(i=Common.Utils.documentSettingsType.Shape)),i!==Common.Utils.documentSettingsType.Paragraph&&(this.rightmenu.SetActivePane(i,!0),this._settings[i].panel.ChangeSettings.call(this._settings[i].panel,this._settings[i].props))}}},onStartMailMerge:function(){var t=Common.Utils.documentSettingsType.MailMerge;this._settings[t].hidden=0,this._settings[t].btn.setDisabled(!1),this.rightmenu.SetActivePane(t,!0),this._settings[t].panel.setLocked(this._settings[t].locked),this._settings[t].panel.ChangeSettings.call(this._settings[t].panel)},onError:function(t,e,i){if(t==Asc.c_oAscError.ID.MailMergeLoadFile){this._settings[Common.Utils.documentSettingsType.MailMerge].hidden=1,this._settings[Common.Utils.documentSettingsType.MailMerge].btn.setDisabled(!0);var n=this.api.getSelectedElements();n.length>0&&this.onFocusObject(n)}},onApiUpdateSignatures:function(t,e){if(this.rightmenu.signatureSettings){var i=(!t||t.length<1)&&(!e||e.length<1),n=Common.Utils.documentSettingsType.Signature;this._settings[n].hidden=i?1:0,this._settings[n].btn.setDisabled(i),this._settings[n].panel.setLocked(this._settings[n].locked)}},SetDisabled:function(t,e,i){if(this.setMode({isEdit:!t}),this.rightmenu&&this.rightmenu.paragraphSettings)if(this.rightmenu.paragraphSettings.disableControls(t),this.rightmenu.shapeSettings.disableControls(t),this.rightmenu.textartSettings.disableControls(t),this.rightmenu.headerSettings.disableControls(t),this.rightmenu.tableSettings.disableControls(t),this.rightmenu.imageSettings.disableControls(t),this.rightmenu.formSettings&&this.rightmenu.formSettings.disableControls(t),!e&&this.rightmenu.mergeSettings&&(this.rightmenu.mergeSettings.disableControls(t),t&&this.rightmenu.btnMailMerge.setDisabled(t)),this.rightmenu.chartSettings.disableControls(t),!i&&this.rightmenu.signatureSettings&&this.rightmenu.btnSignature.setDisabled(t),t)this.rightmenu.btnText.setDisabled(t),this.rightmenu.btnTable.setDisabled(t),this.rightmenu.btnImage.setDisabled(t),this.rightmenu.btnHeaderFooter.setDisabled(t),this.rightmenu.btnShape.setDisabled(t),this.rightmenu.btnTextArt.setDisabled(t),this.rightmenu.btnChart.setDisabled(t),this.rightmenu.btnForm&&this.rightmenu.btnForm.setDisabled(t);else{var n=this.api.getSelectedElements();n.length>0&&this.onFocusObject(n)}},getDocumentSettingsType:function(t){switch(t){case Asc.c_oAscTypeSelectElement.Paragraph:return Common.Utils.documentSettingsType.Paragraph;case Asc.c_oAscTypeSelectElement.Table:return Common.Utils.documentSettingsType.Table;case Asc.c_oAscTypeSelectElement.Image:return Common.Utils.documentSettingsType.Image;case Asc.c_oAscTypeSelectElement.Header:return Common.Utils.documentSettingsType.Header}}})}),function(t){function e(t,e){for(var i=t.length;i--;)if(t[i]===e)return i;return-1}function i(t,e){if(t.length!=e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function n(t){for(x in A)A[x]=t[U[x]]}function o(t){var i,o,s,a,l,c;if(i=t.keyCode,-1==e(M,i)&&M.push(i),93!=i&&224!=i||(i=91),i in A){A[i]=!0;for(s in T)T[s]==i&&(r[s]=!0)}else if(n(t),r.filter.call(this,t)&&i in S)for(c=m(),a=0;a<S[i].length;a++)if(o=S[i][a],o.scope==c||"all"==o.scope){l=o.mods.length>0;for(s in A)(!A[s]&&e(o.mods,+s)>-1||A[s]&&-1==e(o.mods,+s))&&(l=!1);(0!=o.mods.length||A[16]||A[18]||A[17]||A[91])&&!l||(!0===w||o.locked||!1===o.method(t,o))&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0))}}function s(t){var i,n=t.keyCode,o=e(M,n);if(o>=0&&M.splice(o,1),93!=n&&224!=n||(n=91),n in A){A[n]=!1;for(i in T)T[i]==n&&(r[i]=!1)}}function a(){for(x in A)A[x]=!1;for(x in T)r[x]=!1}function r(t,e,i){var n,o;n=g(t),void 0===i&&(i=e,e="all");for(var s=0;s<n.length;s++)o=[],t=n[s].split("+"),t.length>1&&(o=b(t),t=[t[t.length-1]]),t=t[0],t=P(t),t in S||(S[t]=[]),S[t].push({shortcut:n[s],scope:e,method:i,key:n[s],mods:o})}function l(t,e){var n,o,s,a,r,l=[];for(n=g(t),a=0;a<n.length;a++){if(o=n[a].split("+"),o.length>1&&(l=b(o),t=o[o.length-1]),t=P(t),void 0===e&&(e=m()),!S[t])return;for(s in S[t])r=S[t][s],r.scope===e&&i(r.mods,l)&&(S[t][s]={})}}function c(t){return"string"==typeof t&&(t=P(t)),-1!=e(M,t)}function d(){return M.slice(0)}function h(t){var e=(t.target||t.srcElement).tagName;return!("INPUT"==e||"SELECT"==e||"TEXTAREA"==e)}function p(t){k=t||"all"}function m(){return k||"all"}function u(t){var e,i,n;for(e in S)for(i=S[e],n=0;n<i.length;)i[n].scope===t?i.splice(n,1):n++}function g(t){var e;return t=t.replace(/\s/g,""),e=t.split(","),""==e[e.length-1]&&(e[e.length-2]+=","),e}function b(t){for(var e=t.slice(0,t.length-1),i=0;i<e.length;i++)e[i]=T[e[i]];return e}function f(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&t.attachEvent("on"+e,function(){i(window.event)})}function C(){var e=t.key;return t.key=B,e}function v(t,e,n,o){for(var s,a,r,l=[],c=g(t),d=c.length;d--;)if(s=c[d].split("+"),s.length>1&&(l=b(s),t=s[s.length-1]),t=P(t),void 0===e&&(e=m()),S[t])for(a in S[t])r=S[t][a],r.scope===e&&i(r.mods,l)&&(S[t][a][n]=o)}function _(t,e){t?v(t,e,"locked",!0):w=!0}function y(t,e){t?v(t,e,"locked",!1):w=!1}var x,w,S={},A={16:!1,18:!1,17:!1,91:!1},k="all",T={"â§":16,shift:16,"â¥":18,alt:18,option:18,"â":17,ctrl:17,control:17,"â":91,command:91},I={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220,"ff-":173,"ff=":61},P=function(t){return I[t]||t.toUpperCase().charCodeAt(0)},M=[];for(x=1;x<20;x++)I["f"+x]=111+x;var U={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(x in T)r[x]=!1;f(document,"keydown",function(t){o(t)}),f(document,"keyup",s),f(window,"focus",a);var B=t.key;t.key=r,t.key.setScope=p,t.key.getScope=m,t.key.deleteScope=u,t.key.filter=h,t.key.isPressed=c,t.key.getPressedKeyCodes=d,t.key.noConflict=C,t.key.unbind=l,t.key.suspend=_,t.key.resume=y,"undefined"!=typeof module&&(module.exports=key)}(this),define("keymaster",function(){}),void 0===Common)var Common={};if(Common.util=Common.util||{},define("common/main/lib/util/Shortcuts",["backbone","keymaster"],function(t){"use strict";var e=function(t){return this.cid=_.uniqueId("shortcuts"),this.initialize.apply(this,arguments),this};_.extend(e.prototype,t.Events,{initialize:function(){window.key.filter=function(t){return!0},Common.NotificationCenter.on({"modal:show":function(t){window.key.suspend()},"modal:close":function(t,e){e&&window.key.resume()},"modal:hide":function(t,e){e&&window.key.resume()}})},delegateShortcuts:function(t){if(t&&t.shortcuts){this.removeShortcuts(t);var e,i,n,o,s,a,r=[];for(s in t.shortcuts){if(e=t.shortcuts[s],_.isFunction(e))n=e;else if(!(n=t[e]))throw new Error("Method "+e+" does not exist");i=s.match(/^(\S+)\s*(.*)$/),a=i[1],o=i[2].length?i[2]:"all",n=_.bind(n,this),r.push(window.key(a,o,n))}}},removeShortcuts:function(t){if(t&&t.shortcuts){var e,i,n,o;for(n in t.shortcuts)e=n.match(/^(\S+)\s*(.*)$/),o=e[1],i=e[2].length?e[2]:"all",window.key.unbind(o,i)}},suspendEvents:function(t,e){window.key.suspend(t,e)},resumeEvents:function(t,e){window.key.resume(t,e)}}),e.extend=t.View.extend,Common.util.Shortcuts=new e}),define("documenteditor/main/app/controller/LeftMenu",["core","common/main/lib/util/Shortcuts","common/main/lib/view/SaveAsDlg","documenteditor/main/app/view/LeftMenu","documenteditor/main/app/view/FileMenu"],function(){"use strict";DE.Controllers.LeftMenu=Backbone.Controller.extend(_.extend({views:["LeftMenu","FileMenu"],initialize:function(){this.addListeners({"Common.Views.Chat":{hide:_.bind(this.onHideChat,this)},"Common.Views.Header":{"file:settings":_.bind(this.clickToolbarSettings,this),"history:show":function(){this.leftMenu.panelHistory.isVisible()||this.clickMenuFileItem("header","history")}.bind(this)},"Common.Views.About":{show:_.bind(this.aboutShowHide,this,!1),hide:_.bind(this.aboutShowHide,this,!0)},"Common.Views.Plugins":{"plugin:open":_.bind(this.onPluginOpen,this),hide:_.bind(this.onHidePlugins,this)},LeftMenu:{"comments:show":_.bind(this.commentsShowHide,this,"show"),"comments:hide":_.bind(this.commentsShowHide,this,"hide")},FileMenu:{"menu:hide":_.bind(this.menuFilesShowHide,this,"hide"),"menu:show":_.bind(this.menuFilesShowHide,this,"show"),"item:click":_.bind(this.clickMenuFileItem,this),"saveas:format":_.bind(this.clickSaveAsFormat,this),"savecopy:format":_.bind(this.clickSaveCopyAsFormat,this),"settings:apply":_.bind(this.applySettings,this),"create:new":_.bind(this.onCreateNew,this),"recent:open":_.bind(this.onOpenRecent,this)},Toolbar:{"file:settings":_.bind(this.clickToolbarSettings,this),"file:open":this.clickToolbarTab.bind(this,"file"),"file:close":this.clickToolbarTab.bind(this,"other"),"save:disabled":this.changeToolbarSaveState.bind(this)},SearchDialog:{hide:_.bind(this.onSearchDlgHide,this),"search:back":_.bind(this.onQuerySearch,this,"back"),"search:next":_.bind(this.onQuerySearch,this,"next"),"search:replace":_.bind(this.onQueryReplace,this),"search:replaceall":_.bind(this.onQueryReplaceAll,this),"search:highlight":_.bind(this.onSearchHighlight,this)},"Common.Views.ReviewChanges":{"collaboration:chat":_.bind(this.onShowHideChat,this)}}),Common.NotificationCenter.on("leftmenu:change",_.bind(this.onMenuChange,this)),Common.NotificationCenter.on("app:comment:add",_.bind(this.onAppAddComment,this)),Common.NotificationCenter.on("collaboration:history",_.bind(function(){this.leftMenu.panelHistory.isVisible()||this.clickMenuFileItem(null,"history")},this))},onLaunch:function(){this.leftMenu=this.createView("LeftMenu").render(),this.leftMenu.btnSearch.on("toggle",_.bind(this.onMenuSearch,this)),Common.util.Shortcuts.delegateShortcuts({shortcuts:{"command+shift+s,ctrl+shift+s":_.bind(this.onShortcut,this,"save"),"command+f,ctrl+f":_.bind(this.onShortcut,this,"search"),"ctrl+h":_.bind(this.onShortcut,this,"replace"),"alt+f":_.bind(this.onShortcut,this,"file"),esc:_.bind(this.onShortcut,this,"escape"),"alt+q":_.bind(this.onShortcut,this,"chat"),"command+shift+h,ctrl+shift+h":_.bind(this.onShortcut,this,"comments"),f1:_.bind(this.onShortcut,this,"help")}}),Common.util.Shortcuts.suspendEvents()},setApi:function(t){if(this.api=t,this.api.asc_registerCallback("asc_onReplaceAll",_.bind(this.onApiTextReplaced,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onApiServerDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiServerDisconnect,this)),this.api.asc_registerCallback("asc_onDownloadUrl",_.bind(this.onDownloadUrl,this)),this.mode.canCoAuthoring&&(this.mode.canChat&&this.api.asc_registerCallback("asc_onCoAuthoringChatReceiveMessage",_.bind(this.onApiChatMessage,this)),this.mode.canComments)){this.api.asc_registerCallback("asc_onAddComment",_.bind(this.onApiAddComment,this)),this.api.asc_registerCallback("asc_onAddComments",_.bind(this.onApiAddComments,this));for(var e=this.getApplication().getCollection("Common.Collections.Comments"),i=Common.Utils.InternalSettings.get("de-settings-resolvedcomment"),n=0;n<e.length;++n){var o=e.at(n);if(!o.get("hide")&&o.get("userid")!==this.mode.user.id&&(i||!o.get("resolved"))){this.leftMenu.markCoauthOptions("comments",!0);break}}}return this.leftMenu.getMenu("file").setApi(t),this.mode.canUseHistory&&this.getApplication().getController("Common.Controllers.History").setApi(this.api).setMode(this.mode),this},setMode:function(t){return this.mode=t,this.leftMenu.setMode(t),this.leftMenu.getMenu("file").setMode(t),t.isEdit||Common.util.Shortcuts.removeShortcuts({shortcuts:{"command+shift+s,ctrl+shift+s":_.bind(this.onShortcut,this,"save"),"alt+f":_.bind(this.onShortcut,this,"file")}}),this},createDelayedElements:function(){return this.mode.canCoAuthoring?(this.leftMenu.btnComments[this.mode.canViewComments&&!this.mode.isLightVersion?"show":"hide"](),this.mode.canViewComments&&this.leftMenu.setOptionsPanel("comment",this.getApplication().getController("Common.Controllers.Comments").getView()),this.leftMenu.btnChat[this.mode.canChat&&!this.mode.isLightVersion?"show":"hide"](),this.mode.canChat&&this.leftMenu.setOptionsPanel("chat",this.getApplication().getController("Common.Controllers.Chat").getView("Common.Views.Chat"))):(this.leftMenu.btnChat.hide(),this.leftMenu.btnComments.hide()),this.mode.canUseHistory&&this.leftMenu.setOptionsPanel("history",this.getApplication().getController("Common.Controllers.History").getView("Common.Views.History")),this.leftMenu.setOptionsPanel("navigation",this.getApplication().getController("Navigation").getView("Navigation")),(this.mode.trialMode||this.mode.isBeta)&&this.leftMenu.setDeveloperMode(this.mode.trialMode,this.mode.isBeta,this.mode.buildVersion),Common.util.Shortcuts.resumeEvents(),this},enablePlugins:function(){this.mode.canPlugins?this.leftMenu.setOptionsPanel("plugins",this.getApplication().getController("Common.Controllers.Plugins").getView("Common.Views.Plugins")):this.leftMenu.btnPlugins.hide(),(this.mode.trialMode||this.mode.isBeta)&&this.leftMenu.setDeveloperMode(this.mode.trialMode,this.mode.isBeta,this.mode.buildVersion)},clickMenuFileItem:function(t,e,i){var n=!0;switch(e){case"back":break;case"save":this.api.asc_Save();break;case"save-desktop":this.api.asc_DownloadAs();break;case"saveas":i?n=!1:this.clickSaveAsFormat(void 0);break;case"save-copy":i?n=!1:this.clickSaveCopyAsFormat(void 0);break;case"print":this.api.asc_Print(new Asc.asc_CDownloadOptions(null,Common.Utils.isChrome||Common.Utils.isSafari||Common.Utils.isOpera||Common.Utils.isGecko&&Common.Utils.firefoxVersion>86));break;case"exit":Common.NotificationCenter.trigger("goback");break;case"edit":this.getApplication().getController("Statusbar").setStatusCaption(this.requestEditRightsText),Common.Gateway.requestEditRights();break;case"new":i?n=!1:this.onCreateNew(void 0,"blank");break;case"history":if(!this.leftMenu.panelHistory.isVisible())if(this.api.isDocumentModified()){var o=this;this.api.asc_stopSaving(),Common.UI.warning({closable:!1,width:500,title:this.notcriticalErrorTitle,msg:this.leavePageText,buttons:["ok","cancel"],primary:"ok",callback:function(t){"ok"==t?(o.api.asc_undoAllChanges(),o.api.asc_continueSaving(),o.showHistory()):o.api.asc_continueSaving()}})}else this.showHistory();break;case"rename":var o=this,s=o.api.asc_getDocumentName();new Common.Views.RenameDialog({filename:s,maxLength:this.mode.wopi?this.mode.wopi.FileNameMaxLength:void 0,handler:function(t,e){"ok"!=t||_.isEmpty(e.trim())||s===e.trim()||(o.mode.wopi?o.api.asc_wopi_renameFile(e):Common.Gateway.requestRename(e)),Common.NotificationCenter.trigger("edit:complete",o)}}).show();break;default:n=!1}n&&t&&t.hide()},clickSaveAsFormat:function(t,e){if(t)if(e==Asc.c_oAscFileType.TXT||e==Asc.c_oAscFileType.RTF)Common.UI.warning({closable:!1,title:this.notcriticalErrorTitle,msg:e==Asc.c_oAscFileType.TXT?this.warnDownloadAs:this.warnDownloadAsRTF,buttons:["ok","cancel"],callback:_.bind(function(i){"ok"==i&&(e==Asc.c_oAscFileType.TXT?Common.NotificationCenter.trigger("download:advanced",Asc.c_oAscAdvancedOptionsID.TXT,this.api.asc_getAdvancedOptions(),2,new Asc.asc_CDownloadOptions(e)):this.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(e)),t.hide())},this)});else if(e==Asc.c_oAscFileType.DOCX)if(Common.Utils.InternalSettings.get("de-settings-compatible")||Common.localStorage.getBool("de-hide-save-compatible")||!this.api.asc_isCompatibilityMode()){var i=new Asc.asc_CDownloadOptions(Asc.c_oAscFileType.DOCX);i.asc_setCompatible(!!Common.Utils.InternalSettings.get("de-settings-compatible")),this.api.asc_DownloadAs(i),t.hide()}else Common.UI.warning({closable:!1,width:600,title:this.notcriticalErrorTitle,msg:this.txtCompatible,buttons:["ok","cancel"],dontshow:!0,callback:_.bind(function(i,n){n&&Common.localStorage.setItem("de-hide-save-compatible",1),"ok"==i&&(this.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(e)),t.hide())},this)});else this.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(e)),t.hide();else this.api.asc_DownloadOrigin()},clickSaveCopyAsFormat:function(t,e,i){if(t)if(e==Asc.c_oAscFileType.TXT||e==Asc.c_oAscFileType.RTF)Common.UI.warning({closable:!1,title:this.notcriticalErrorTitle,msg:e==Asc.c_oAscFileType.TXT?this.warnDownloadAs:this.warnDownloadAsRTF,buttons:["ok","cancel"],callback:_.bind(function(n){"ok"==n&&(this.isFromFileDownloadAs=i,e==Asc.c_oAscFileType.TXT?Common.NotificationCenter.trigger("download:advanced",Asc.c_oAscAdvancedOptionsID.TXT,this.api.asc_getAdvancedOptions(),2,new Asc.asc_CDownloadOptions(e,!0)):this.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(e,!0)),t.hide())},this)});else if(e==Asc.c_oAscFileType.DOCX)if(Common.Utils.InternalSettings.get("de-settings-compatible")||Common.localStorage.getBool("de-hide-save-compatible")||!this.api.asc_isCompatibilityMode()){this.isFromFileDownloadAs=i;var n=new Asc.asc_CDownloadOptions(Asc.c_oAscFileType.DOCX,!0);n.asc_setCompatible(!!Common.Utils.InternalSettings.get("de-settings-compatible")),this.api.asc_DownloadAs(n),t.hide()}else Common.UI.warning({closable:!1,width:600,title:this.notcriticalErrorTitle,msg:this.txtCompatible,buttons:["ok","cancel"],dontshow:!0,callback:_.bind(function(n,o){o&&Common.localStorage.setItem("de-hide-save-compatible",1),"ok"==n&&(this.isFromFileDownloadAs=i,this.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(e,!0)),t.hide())},this)});else this.isFromFileDownloadAs=i,this.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(e,!0)),t.hide();else this.isFromFileDownloadAs=!0,this.api.asc_DownloadOrigin(!0)},onDownloadUrl:function(t){if(this.isFromFileDownloadAs){var e=this,i=this.getApplication().getController("Viewport").getView("Common.Views.Header").getDocumentCaption();if(!i&&(i=e.txtUntitled),"string"==typeof this.isFromFileDownloadAs){var n=i.lastIndexOf(".");n>0&&(i=i.substring(0,n)+this.isFromFileDownloadAs)}e.mode.canRequestSaveAs?Common.Gateway.requestSaveAs(t,i):(e._saveCopyDlg=new Common.Views.SaveAsDlg({saveFolderUrl:e.mode.saveAsUrl,saveFileUrl:t,defFileName:i}),e._saveCopyDlg.on("saveaserror",function(t,i){var n={closable:!1,title:e.notcriticalErrorTitle,msg:i,iconCls:"warn",buttons:["ok"],callback:function(t){Common.NotificationCenter.trigger("edit:complete",e)}};Common.UI.alert(n)}).on("close",function(t){e._saveCopyDlg=void 0}),e._saveCopyDlg.show())}this.isFromFileDownloadAs=!1},applySettings:function(t){var e;e=Common.localStorage.getBool("de-settings-inputmode"),Common.Utils.InternalSettings.set("de-settings-inputmode",e),this.api.SetTextBoxInputMode(e);var i=Common.Utils.InternalSettings.get("de-settings-coauthmode");if(this.mode.isEdit&&!this.mode.isOffline&&this.mode.canCoAuthoring){switch(this.mode.canChangeCoAuthoring&&(i=Common.localStorage.getBool("de-settings-coauthmode",!0),Common.Utils.InternalSettings.set("de-settings-coauthmode",i),this.api.asc_SetFastCollaborative(i)),e=Common.localStorage.getItem(i?"de-settings-showchanges-fast":"de-settings-showchanges-strict"),Common.Utils.InternalSettings.set(i?"de-settings-showchanges-fast":"de-settings-showchanges-strict",e),e){case"all":e=Asc.c_oAscCollaborativeMarksShowType.All;break;case"none":e=Asc.c_oAscCollaborativeMarksShowType.None;break;case"last":e=Asc.c_oAscCollaborativeMarksShowType.LastChanges;break;default:e=i?Asc.c_oAscCollaborativeMarksShowType.None:Asc.c_oAscCollaborativeMarksShowType.LastChanges}this.api.SetCollaborativeMarksShowType(e)}e=Common.localStorage.getBool("de-settings-livecomment",!0),Common.Utils.InternalSettings.set("de-settings-livecomment",e);var n=Common.localStorage.getBool("de-settings-resolvedcomment");switch(Common.Utils.InternalSettings.set("de-settings-resolvedcomment",n),this.mode.canViewComments&&this.leftMenu.panelComments.isVisible()&&(e=n=!0),e?this.api.asc_showComments(n):this.api.asc_hideComments(),this.getApplication().getController("Common.Controllers.ReviewChanges").commentsShowHide(e?"show":"hide"),e=Common.localStorage.getBool("de-settings-cachemode",!0),Common.Utils.InternalSettings.set("de-settings-cachemode",e),this.api.asc_setDefaultBlitMode(e),e=Common.localStorage.getItem("de-settings-fontrender"),Common.Utils.InternalSettings.set("de-settings-fontrender",e),e){case"1":this.api.SetFontRenderingMode(1);break;case"2":this.api.SetFontRenderingMode(2);break;case"0":this.api.SetFontRenderingMode(3)}this.mode.isEdit&&(!this.mode.canChangeCoAuthoring&&i||(e=parseInt(Common.localStorage.getItem("de-settings-autosave")),Common.Utils.InternalSettings.set("de-settings-autosave",e),this.api.asc_setAutoSaveGap(e)),e=Common.localStorage.getBool("de-settings-spellcheck",!0),Common.Utils.InternalSettings.set("de-settings-spellcheck",e),this.api.asc_setSpellCheck(e),e=parseInt(Common.localStorage.getItem("de-settings-paste-button")),Common.Utils.InternalSettings.set("de-settings-paste-button",e),this.api.asc_setVisiblePasteButton(!!e)),this.api.put_ShowSnapLines(Common.Utils.InternalSettings.get("de-settings-showsnaplines")),t.hide()},onCreateNew:function(t,e){if(!Common.Controllers.Desktop.process("create:new"))if(this.mode.canRequestCreateNew)Common.Gateway.requestCreateNew();else{var i=window.open("blank"==e?this.mode.createUrl:e,"_blank");i&&i.focus()}t&&t.hide()},onOpenRecent:function(t,e){t&&t.hide();var i=window.open(e);i&&i.focus(),Common.component.Analytics.trackEvent("Open Recent")},clickToolbarSettings:function(t){this.leftMenu.showMenu("file:opts")},clickToolbarTab:function(t,e){"file"==t?this.leftMenu.showMenu("file"):this.leftMenu.menuFile.hide()},changeToolbarSaveState:function(t){var e=this.leftMenu.menuFile.getButton("save");e&&e.setDisabled(t)},onHideChat:function(){$(this.leftMenu.btnChat.el).blur(),Common.NotificationCenter.trigger("layout:changed","leftmenu")},onHidePlugins:function(){Common.NotificationCenter.trigger("layout:changed","leftmenu")},onQuerySearch:function(t,e,i){if(i.textsearch&&i.textsearch.length&&!this.api.asc_findText(i.textsearch,"back"!=t,i.matchcase,i.matchword)){var n=this;Common.UI.info({msg:this.textNoTextFound,callback:function(){n.dlgSearch.focus()}})}},onQueryReplace:function(t,e){if(!_.isEmpty(e.textsearch)&&!this.api.asc_replaceText(e.textsearch,e.textreplace,!1,e.matchcase,e.matchword)){var i=this;Common.UI.info({msg:this.textNoTextFound,callback:function(){i.dlgSearch.focus()}})}},onQueryReplaceAll:function(t,e){_.isEmpty(e.textsearch)||this.api.asc_replaceText(e.textsearch,e.textreplace,!0,e.matchcase,e.matchword)},onSearchHighlight:function(t,e){this.api.asc_selectSearchingResults(e)},showSearchDlg:function(t,e){if(this.dlgSearch||(this.dlgSearch=new Common.UI.SearchDialog({matchcase:!0,markresult:{applied:!0}})),t){var i=this.mode.isEdit&&!this.viewmode?e||void 0:"no-replace";this.dlgSearch.isVisible()?(this.dlgSearch.setMode(i),this.dlgSearch.setSearchText(this.api.asc_GetSelectedText()),this.dlgSearch.focus()):this.dlgSearch.show(i,this.api.asc_GetSelectedText())}else this.dlgSearch.hide()},onMenuSearch:function(t,e){this.showSearchDlg(e)},onSearchDlgHide:function(){this.leftMenu.btnSearch.toggle(!1,!0),this.api.asc_selectSearchingResults(!1),$(this.leftMenu.btnSearch.el).blur(),this.api.asc_enableKeyEvents(!0)},onApiTextReplaced:function(t,e){t?t-e>0?Common.UI.warning({msg:Common.Utils.String.format(this.textReplaceSkipped,t-e)}):Common.UI.info({msg:Common.Utils.String.format(this.textReplaceSuccess,e)}):Common.UI.info({msg:this.textNoTextFound})},onApiServerDisconnect:function(t){this.mode.isEdit=!1,this.leftMenu.close(),this.leftMenu.btnComments.setDisabled(!0),this.leftMenu.btnChat.setDisabled(!0),this.leftMenu.btnPlugins.setDisabled(!0),this.leftMenu.btnNavigation.setDisabled(!0),this.leftMenu.getMenu("file").setMode({isDisconnected:!0,enableDownload:!!t}),this.dlgSearch&&(this.leftMenu.btnSearch.toggle(!1,!0),this.dlgSearch.hide())},setPreviewMode:function(t){this.viewmode!==t&&(this.viewmode=t,this.dlgSearch&&this.dlgSearch.setMode(this.viewmode?"no-replace":"search"))},SetDisabled:function(t,e){this.mode.isEdit=!t,t&&this.leftMenu.close(),this.leftMenu.btnComments.setDisabled(t);var i=this.getApplication().getController("Common.Controllers.Comments");i&&i.setPreviewMode(t),this.setPreviewMode(t),this.leftMenu.btnChat.setDisabled(t),this.leftMenu.btnPlugins.setDisabled(t),this.leftMenu.btnNavigation.setDisabled(t),e&&this.leftMenu.getMenu("file").SetDisabled(t)},onApiChatMessage:function(){this.leftMenu.markCoauthOptions("chat")},onApiAddComment:function(t,e){var i=Common.Utils.InternalSettings.get("de-settings-resolvedcomment");e&&e.asc_getUserId()!==this.mode.user.id&&(i||!e.asc_getSolved())&&AscCommon.UserInfoParser.canViewComment(e.asc_getUserName())&&this.leftMenu.markCoauthOptions("comments")},onApiAddComments:function(t){for(var e=Common.Utils.InternalSettings.get("de-settings-resolvedcomment"),i=0;i<t.length;++i)if(t[i].asc_getUserId()!==this.mode.user.id&&(e||!t[i].asc_getSolved())&&AscCommon.UserInfoParser.canViewComment(t.asc_getUserName())){this.leftMenu.markCoauthOptions("comments");break}},onAppAddComment:function(t){var e=this;!1===this.api.can_AddQuotedComment()&&new Promise(function(t,e){t()}).then(function(){Common.UI.Menu.Manager.hideAll(),e.leftMenu.showMenu("comments");var t=DE.getController("Common.Controllers.Comments");t.getView().showEditContainer(!0),t.onAfterShow()})},commentsShowHide:function(t){var e=Common.Utils.InternalSettings.get("de-settings-livecomment"),i=Common.Utils.InternalSettings.get("de-settings-resolvedcomment");e&&i||("show"===t?this.api.asc_showComments(!0):e?this.api.asc_showComments(i):this.api.asc_hideComments()),"show"===t&&this.getApplication().getController("Common.Controllers.Comments").onAfterShow(),$(this.leftMenu.btnComments.el).blur()},aboutShowHide:function(t){this.api&&this.api.asc_enableKeyEvents(t),t&&$(this.leftMenu.btnAbout.el).blur(),t&&this.leftMenu._state.pluginIsRunning&&(this.leftMenu.panelPlugins.show(),this.mode.canCoAuthoring&&(this.mode.canViewComments&&this.leftMenu.panelComments.hide(),this.mode.canChat&&this.leftMenu.panelChat.hide()))},menuFilesShowHide:function(t){this.dlgSearch&&("show"==t?this.dlgSearch.suspendKeyEvents():Common.Utils.asyncCall(this.dlgSearch.resumeKeyEvents,this.dlgSearch)),this.api&&"hide"==t&&this.api.asc_enableKeyEvents(!0)},onMenuChange:function(t){"hide"===t&&this.leftMenu.btnComments.isActive()&&this.api&&(this.leftMenu.btnComments.toggle(!1),this.leftMenu.onBtnMenuClick(this.leftMenu.btnComments),this.api.asc_enableKeyEvents(!0))},onShortcut:function(t,e){if(this.mode)switch(t){case"replace":case"search":return Common.UI.Menu.Manager.hideAll(),this.showSearchDlg(!0,t),this.leftMenu.btnSearch.toggle(!0,!0),this.leftMenu.btnAbout.toggle(!1),!1;case"save":return(this.mode.canDownload||this.mode.canDownloadOrigin)&&(this.mode.isDesktopApp&&this.mode.isOffline?this.api.asc_DownloadAs():this.mode.canDownload?(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("file:saveas")):this.api.asc_DownloadOrigin()),!1;case"help":return this.mode.isEdit&&this.mode.canHelp&&(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("file:help")),!1;case"file":
return Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("file"),!1;case"escape":if(this.leftMenu.menuFile.isVisible())return this.leftMenu.menuFile.hide(),!1;var i=DE.getController("Statusbar"),n=i.statusbar.$el.find('.open > [data-toggle="dropdown"]');if(n.length)return $.fn.dropdown.Constructor.prototype.keydown.call(n[0],e),!1;if(this.mode.canPlugins&&this.leftMenu.panelPlugins&&(n=this.leftMenu.panelPlugins.$el.find('#menu-plugin-container.open > [data-toggle="dropdown"]'),n.length))return $.fn.dropdown.Constructor.prototype.keydown.call(n[0],e),!1;if(this.leftMenu.btnAbout.pressed||this.leftMenu.btnPlugins.pressed||$(e.target).parents("#left-menu").length)return this.leftMenu.close(),Common.NotificationCenter.trigger("layout:changed","leftmenu"),!1;break;case"chat":return this.mode.canCoAuthoring&&this.mode.canChat&&!this.mode.isLightVersion&&(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("chat")),!1;case"comments":return this.mode.canCoAuthoring&&this.mode.canViewComments&&!this.mode.isLightVersion&&(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("comments"),this.getApplication().getController("Common.Controllers.Comments").onAfterShow()),!1}},onPluginOpen:function(t,e,i){"onboard"==e&&("open"==i?(this.leftMenu.close(),this.leftMenu.panelPlugins.show(),this.leftMenu.onBtnMenuClick({pressed:!0,options:{action:"plugins"}}),this.leftMenu._state.pluginIsRunning=!0):(this.leftMenu._state.pluginIsRunning=!1,this.leftMenu.close()))},showHistory:function(){if(!this.mode.wopi){var t=DE.getController("Main");t.loadMask||(t.loadMask=new Common.UI.LoadMask({owner:$("#viewport")})),t.loadMask.setTitle(this.textLoadHistory),t.loadMask.show()}Common.Gateway.requestHistory()},onShowHideChat:function(t){this.mode.canCoAuthoring&&this.mode.canChat&&!this.mode.isLightVersion&&(t?(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("chat")):(this.leftMenu.btnChat.toggle(!1,!0),this.leftMenu.onBtnMenuClick(this.leftMenu.btnChat)))},textNoTextFound:"Text not found",newDocumentTitle:"Unnamed document",requestEditRightsText:"Requesting editing rights...",textReplaceSuccess:"Search has been done. {0} occurrences have been replaced",textReplaceSkipped:"The replacement has been made. {0} occurrences were skipped.",textLoadHistory:"Loading version history...",notcriticalErrorTitle:"Warning",leavePageText:"All unsaved changes in this document will be lost.<br> Click 'Cancel' then 'Save' to save them. Click 'OK' to discard all the unsaved changes.",warnDownloadAs:"If you continue saving in this format all features except the text will be lost.<br>Are you sure you want to continue?",warnDownloadAsRTF:"If you continue saving in this format some of the formatting might be lost.<br>Are you sure you want to continue?",txtUntitled:"Untitled",txtCompatible:"The document will be saved to the new format. It will allow to use all the editor features, but might affect the document layout.<br>Use the 'Compatibility' option of the advanced settings if you want to make the files compatible with older MS Word versions."},DE.Controllers.LeftMenu||{}))}),void 0===Common)var Common={};if(Common.IrregularStack=function(t){var e=[],i=function(t,e){return"object"==typeof t&&"object"==typeof e&&window.JSON?window.JSON.stringify(t)===window.JSON.stringify(e):t===e};t=t||{};var n=t.strongCompare||i,o=t.weakCompare||i,s=function(t,i){for(var n=e.length-1;n>=0;n--)if(i(e[n],t))return n;return-1};return{push:function(t){e.push(t)},pop:function(t){var i=s(t,n);if(-1!=i)return e.splice(i,1)[0]},get:function(t){var i=s(t,o);if(-1!=i)return e[i]},exist:function(t){return!(s(t,n)<0)}}},define("irregularstack",function(){}),void 0===Common)var Common={};if(Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/Fonts",["core","common/main/lib/collection/Fonts"],function(){"use strict";Common.Controllers.Fonts=Backbone.Controller.extend(function(){function t(t,e){for(var i,n=e.get("type")==o,s=-1,a=t.length,r=e.get("name");!n&&++s<a&&(i=t.at(s),i.get("type")==o);)n=i.get("name")==r;return n}function e(e,i){e.showlastused&&t(e.store,i)}function i(t){Common.NotificationCenter.trigger("fonts:change",t)}function n(t,e){var i=[];_.each(t,function(t){var e=t.asc_getFontId();i.push({id:_.isEmpty(e)?Common.UI.getId():e,name:t.asc_getFontName(),imgidx:t.asc_getFontThumbnail(),type:t.asc_getFontType()})});var n=this.getCollection("Common.Collections.Fonts");n&&n.add(i),Common.NotificationCenter.trigger("fonts:load",n,e)}var o=4;return{models:["Common.Models.Fonts"],collections:["Common.Collections.Fonts"],views:[],initialize:function(){Common.NotificationCenter.on("fonts:select",_.bind(e,this))},onLaunch:function(){},setApi:function(t){this.api=t,this.api.asc_registerCallback("asc_onInitEditorFonts",_.bind(n,this)),this.api.asc_registerCallback("asc_onFontFamily",_.bind(i,this))}}}())}),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/TextArt",["backbone"],function(t){"use strict";Common.Collections.TextArt=t.Collection.extend({model:t.Model.extend({defaults:function(){return{id:Common.UI.getId(),imageUrl:null,data:null}}})})}),define("common/main/lib/view/OpenDialog",["common/main/lib/component/Window"],function(){"use strict";Common.Views.OpenDialog=Common.UI.Window.extend(_.extend({applyFunction:void 0,initialize:function(t){var e,i,n=this,o={};if(t.preview)e=414,i=t.type==Common.Utils.importTextType.Data?385:277;else switch(e=t.type!==Common.Utils.importTextType.DRM?340:t.warning?420:280,t.type){case Common.Utils.importTextType.CSV:case Common.Utils.importTextType.Paste:case Common.Utils.importTextType.Columns:i=190;break;case Common.Utils.importTextType.Data:i=245;break;default:i=t.warning?187:147}_.extend(o,{closable:!1,preview:t.preview,warning:t.warning,codepages:t.codepages,warningMsg:t.warningMsg,width:e,height:i,header:!0,cls:"open-dlg",contentTemplate:"",toolcallback:_.bind(n.onToolClose,n),closeFile:!1},t),this.template=t.template||['<div class="box" style="height:'+(o.height-85)+'px;">','<div class="content-panel" >',"<% if (type == Common.Utils.importTextType.DRM) { %>","<% if (warning) { %>","<div>",'<div class="icon img-commonctrl warn"></div>','<div style="padding-left: 50px;"><div style="font-size: 12px;">'+("string"==typeof o.warningMsg?o.warningMsg:n.txtProtected)+"</div>",'<label class="header" style="margin-top: 15px;">'+n.txtPassword+"</label>",'<div id="id-password-txt" style="width: 290px;"></div></div>',"</div>","<% } else { %>","<div>",'<label class="">'+n.txtOpenFile+"</label>",'<div id="id-password-txt"></div>',"</div>","<% } %>","<% } else { %>","<% if (codepages && codepages.length>0) { %>",'<div style="<% if (!!preview && (type == Common.Utils.importTextType.CSV || type == Common.Utils.importTextType.Paste || type == Common.Utils.importTextType.Columns)) { %>width: 230px;margin-right: 10px;display: inline-block;<% } else { %>width: 100%;<% } %>margin-bottom:15px;">','<label class="header">'+n.txtEncoding+"</label>","<div>",'<div id="id-codepages-combo" class="input-group-nr" style="width: 100%; display: inline-block; vertical-align: middle;"></div>',"</div>","</div>","<% } %>","<% if (type == Common.Utils.importTextType.CSV) { %>",'<div style="display: inline-block; margin-bottom:15px;">','<label class="header">'+n.txtDelimiter+"</label>","<div>",'<div id="id-delimiters-combo" class="input-group-nr" style="max-width: 100px;display: inline-block; vertical-align: middle;"></div>','<div id="id-delimiter-other" class="input-row" style="display: inline-block; vertical-align: middle;margin-left: 10px;"></div>',"</div>","</div>","<% } %>","<% if (type == Common.Utils.importTextType.Paste || type == Common.Utils.importTextType.Columns || type == Common.Utils.importTextType.Data) { %>",'<div style="display: inline-block; margin-bottom:15px;width: 100%;">','<label class="header">'+n.txtDelimiter+"</label>","<div>",'<div id="id-delimiters-combo" class="input-group-nr" style="max-width: 100px;display: inline-block; vertical-align: middle;"></div>','<div id="id-delimiter-other" class="input-row" style="display: inline-block; vertical-align: middle;margin-left: 10px;"></div>','<button type="button" class="btn auto btn-text-default" id="id-delimiters-advanced" style="min-width:100px; display: inline-block;float:right;">'+n.txtAdvanced+"</button>","</div>","</div>","<% } %>","<% if (!!preview) { %>",'<div style="">','<label class="header">'+n.txtPreview+"</label>",'<div style="position: relative;">','<div style="width: 100%;">','<div id="id-preview">',"<div>",'<div style="position: absolute; top: 0;"><div id="id-preview-data"></div></div>',"</div>","</div>","</div>","</div>","</div>","<% } %>","<% if (type == Common.Utils.importTextType.Data) { %>",'<label class="header" style="margin-top:15px;">'+n.txtDestData+"</label>",'<div id="id-open-data-range" class="input-row" style="width: 100%;"></div>',"<% } %>","<% } %>","</div>","</div>",'<div class="footer center">','<button class="btn normal dlg-btn primary" result="ok">'+n.okButtonText+"</button>","<% if (closeFile) { %>",'<button class="btn normal dlg-btn custom" result="cancel" style="margin-left:10px;">'+n.closeButtonText+"</button>","<% } %>","<% if (closable) { %>",'<button class="btn normal dlg-btn custom" result="cancel" style="margin-left:10px;">'+n.cancelButtonText+"</button>","<% } %>","</div>"].join(""),this.handler=o.handler,this.type=o.type,this.preview=o.preview,this.previewData=o.previewData,this.warning=o.warning||!1,this.closable=o.closable,this.codepages=o.codepages,this.settings=o.settings,this.api=o.api,this.validatePwd=o.validatePwd||!1,o.tpl=_.template(this.template)(o),Common.UI.Window.prototype.initialize.call(this,o)},render:function(){if(Common.UI.Window.prototype.render.call(this),this.$window){var t=this;this.closable||this.$window.find(".tool").hide(),this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.previewPanel=this.$window.find("#id-preview-data"),this.previewParent=this.previewPanel.parent(),this.previewScrolled=this.$window.find("#id-preview"),this.previewInner=this.previewScrolled.find("div:first-child"),this.type==Common.Utils.importTextType.DRM?(this.inputPwd=new Common.UI.InputField({el:$("#id-password-txt"),type:"text",validateOnBlur:!1,validation:function(e){return t.txtIncorrectPwd}}),this.$window.find("input").on("input",function(){""!==$(this).val()?"password"!==$(this).attr("type")&&$(this).attr("type","password"):$(this).attr("type","text")})):(this.initCodePages(),this.preview&&(this.previewData?this.previewCallback(this.previewData):this.updatePreview())),this.type==Common.Utils.importTextType.Data&&(this.txtDestRange=new Common.UI.InputFieldBtn({el:$("#id-open-data-range"),name:"range",style:"width: 100%;",btnHint:this.textSelectData,allowBlank:!0,validateOnChange:!0,validateOnBlur:!1}),this.txtDestRange.on("button:click",_.bind(this.onSelectData,this)),this.dataDestValid=this.api.asc_getActiveRangeStr(Asc.referenceType.A,!0),this.txtDestRange.setValue(this.dataDestValid)),this.onPrimary=function(){return t._handleInput("ok"),!1}}},getFocusedComponents:function(){var t=[];return this.inputPwd&&t.push(this.inputPwd),this.cmbEncoding&&t.push(this.cmbEncoding),this.cmbDelimiter&&t.push(this.cmbDelimiter),this.inputDelimiter&&t.push(this.inputDelimiter),this.btnAdvanced&&t.push(this.btnAdvanced),this.txtDestRange&&t.push(this.txtDestRange),t},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var t=this;if(this.type==Common.Utils.importTextType.DRM)setTimeout(function(){t.inputPwd.focus(),t.validatePwd&&t.inputPwd.checkValidate()},500);else{var e=t.txtDestRange?t.txtDestRange:t.cmbEncoding?t.cmbEncoding:t.cmbDelimiter;e&&setTimeout(function(){e.focus()},500)}},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onToolClose:function(){this._handleInput("cancel")},_handleInput:function(t){if(this.handler)if(this.type==Common.Utils.importTextType.DRM)this.handler.call(this,t,{drmOptions:new Asc.asc_CDRMAdvancedOptions(this.inputPwd.getValue())});else{if(this.type==Common.Utils.importTextType.Data&&"ok"==t&&!this.isRangeValid())return;var e=this.cmbEncoding&&!this.cmbEncoding.isDisabled()?this.cmbEncoding.getValue():this.settings&&this.settings.asc_getCodePage()?this.settings.asc_getCodePage():0,i=this.cmbDelimiter?this.cmbDelimiter.getValue():null,n=-1==i?this.inputDelimiter.getValue():null;-1==i&&(i=null),this.closable||this.type!=Common.Utils.importTextType.TXT||Common.localStorage.setItem("de-settings-open-encoding",e);var o=this.separatorOptions?this.separatorOptions.decimal:void 0,s=this.separatorOptions?this.separatorOptions.thousands:void 0,a=new Asc.asc_CTextOptions(e,i,n);o&&a.asc_setNumberDecimalSeparator(o),s&&a.asc_setNumberGroupSeparator(s),this.handler.call(this,t,{textOptions:a,range:this.txtDestRange?this.txtDestRange.getValue():"",data:this.data})}this.close()},initCodePages:function(){var t,e,i,n=[],o=[],s=0,a=0;if(this.codepages){for(n=[],t=0;t<this.codepages.length;++t)i=this.codepages[t],e=[],e[0]=i.asc_getCodePage(),e[1]=i.asc_getCodePageName(),e[2]=i.asc_getLcid(),n.push(e);a=50}if(s=n.length){for(t=0;t<s;++t)o.push({value:n[t][0],displayValue:Common.Utils.String.htmlEncode(n[t][1]),lcid:n[t][2]||""});var r=_.template(["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem">','<div style="display: inline-block;"><%= item.displayValue %></div>','<label style="text-align: right;width:'+a+'px;"><%= item.lcid %></label>',"</a></li>","<% }); %>"].join(""));this.cmbEncoding=new Common.UI.ComboBox({el:$("#id-codepages-combo",this.$window),style:"width: 100%;",menuStyle:"min-width: 100%; max-height: 200px;",cls:"input-group-nr",menuCls:"scrollable-menu",data:o,editable:!1,disabled:!0,search:!0,itemsTemplate:r,takeFocusOnClose:!0}),this.cmbEncoding.setDisabled(!1);var l=this.settings&&this.settings.asc_getCodePage()?this.settings.asc_getCodePage():n[0][0];if(!this.closable&&this.type==Common.Utils.importTextType.TXT){var c=Common.localStorage.getItem("de-settings-open-encoding");c&&(l=parseInt(c))}this.cmbEncoding.setValue(l),this.preview&&this.cmbEncoding.on("selected",_.bind(this.onCmbEncodingSelect,this));var d=this.cmbEncoding.cmpEl.find("ul"),h=d.find("li:nth(0) a"),p=d.width()-parseInt(h.css("padding-left"))-parseInt(h.css("padding-right"))-50;d.find("li div").width(p)}this.type!=Common.Utils.importTextType.CSV&&this.type!=Common.Utils.importTextType.Paste&&this.type!=Common.Utils.importTextType.Columns&&this.type!=Common.Utils.importTextType.Data||(this.cmbDelimiter=new Common.UI.ComboBox({el:$("#id-delimiters-combo",this.$window),style:"width: 100px;",menuStyle:"min-width: 100px;",cls:"input-group-nr",data:[{value:4,displayValue:this.txtComma},{value:2,displayValue:this.txtSemicolon},{value:3,displayValue:this.txtColon},{value:1,displayValue:this.txtTab},{value:5,displayValue:this.txtSpace},{value:-1,displayValue:this.txtOther}],editable:!1,takeFocusOnClose:!0}),this.cmbDelimiter.setValue(this.settings&&this.settings.asc_getDelimiter()?this.settings.asc_getDelimiter():4),this.cmbDelimiter.on("selected",_.bind(this.onCmbDelimiterSelect,this)),this.inputDelimiter=new Common.UI.InputField({el:$("#id-delimiter-other"),style:"width: 30px;",maxLength:1,validateOnChange:!0,validateOnBlur:!1,value:this.settings&&this.settings.asc_getDelimiterChar()?this.settings.asc_getDelimiterChar():""}),this.inputDelimiter.setVisible(!1),this.preview&&this.inputDelimiter.on("changing",_.bind(this.updatePreview,this)),this.type!=Common.Utils.importTextType.Paste&&this.type!=Common.Utils.importTextType.Columns&&this.type!=Common.Utils.importTextType.Data||(this.btnAdvanced=new Common.UI.Button({el:$("#id-delimiters-advanced")}),this.btnAdvanced.on("click",_.bind(this.onAdvancedClick,this))))},updatePreview:function(){var t=this.cmbEncoding&&!this.cmbEncoding.isDisabled()?this.cmbEncoding.getValue():this.settings&&this.settings.asc_getCodePage()?this.settings.asc_getCodePage():0,e=this.cmbDelimiter?this.cmbDelimiter.getValue():null,i=-1==e?this.inputDelimiter.getValue():null;switch(-1==e&&(e=null),this.type){case Common.Utils.importTextType.CSV:this.api.asc_decodeBuffer(this.preview,new Asc.asc_CTextOptions(t,e,i),_.bind(this.previewCallback,this));break;case Common.Utils.importTextType.TXT:this.api.asc_decodeBuffer(this.preview,new Asc.asc_CTextOptions(t),_.bind(this.previewCallback,this));break;case Common.Utils.importTextType.Paste:case Common.Utils.importTextType.Columns:var n=new Asc.asc_CTextOptions(t,e,i);this.separatorOptions&&(n.asc_setNumberDecimalSeparator(this.separatorOptions.decimal),n.asc_setNumberGroupSeparator(this.separatorOptions.thousands)),this.api.asc_TextImport(n,_.bind(this.previewCallback,this),this.type==Common.Utils.importTextType.Paste);break;case Common.Utils.importTextType.Data:var n=new Asc.asc_CTextOptions(t,e,i);this.separatorOptions&&(n.asc_setNumberDecimalSeparator(this.separatorOptions.decimal),n.asc_setNumberGroupSeparator(this.separatorOptions.thousands)),this.api.asc_decodeBuffer(this.preview,n,_.bind(this.previewCallback,this))}},previewCallback:function(t){t&&t.length&&(this.data=t,this.previewInner.height(17*t.length),this.scrollerY||(this.scrollerY=new Common.UI.Scroller({el:this.previewScrolled,minScrollbarLength:20,alwaysVisibleY:!0,alwaysVisibleX:!0,onChange:_.bind(function(){if(this.scrollerY){var t=this.scrollerY.getScrollTop(),e=Math.floor(t/17+.5),i=e+Math.min(6,this.data.length);i>this.data.length&&(i=this.data.length,e=this.data.length-6,t=17*e),this.previewParent.height(108),this.previewParent.css({top:t}),this.previewDataBlock(this.data.slice(e,i))}},this)})),this.scrollerY.update(),this.scrollerY.scrollTop(0))},previewDataBlock:function(t){if(_.isUndefined(this.scrollerX)||(this.scrollerX.destroy(),delete this.scrollerX),this.type==Common.Utils.importTextType.CSV||this.type==Common.Utils.importTextType.Paste||this.type==Common.Utils.importTextType.Columns||this.type==Common.Utils.importTextType.Data){for(var e=0,i=0;i<t.length;i++)t[i].length>e&&(e=t[i].length);for(var n="<table>",i=0;i<t.length;i++){n+='<tr style="vertical-align: top;">';for(var o=0;o<t[i].length;o++)n+="<td>"+Common.Utils.String.htmlEncode(t[i][o])+"</td>";for(o=t[i].length;o<e;o++)n+="<td></td>";n+="</tr>"}n+="</table>"}else{for(var n="<table>",i=0;i<t.length;i++)n+='<tr style="vertical-align: top;"><td>'+Common.Utils.String.htmlEncode(t[i])+"</td></tr>";n+="</table>"}this.previewPanel.html(n),this.scrollerX=new Common.UI.Scroller({el:this.previewPanel,suppressScrollY:!0,alwaysVisibleX:!0,minScrollbarLength:20})},onCmbDelimiterSelect:function(t,e){this.inputDelimiter.setVisible(-1==e.value),-1==e.value&&this.inputDelimiter.cmpEl.find("input").focus(),this.preview&&this.updatePreview()},onCmbEncodingSelect:function(t,e){this.updatePreview()},onAdvancedClick:function(){if(SSE){var t=this,e=this.api.asc_getDecimalSeparator(),i=this.api.asc_getGroupSeparator();new SSE.Views.AdvancedSeparatorDialog({props:{decimal:e,thousands:i},handler:function(n,o){"ok"==n&&(t.separatorOptions={decimal:o.decimal.length>0?o.decimal:e,thousands:o.thousands.length>0?o.thousands:i})}}).show()}},onSelectData:function(t){var e=this,i=e.txtDestRange;if(e.api){var n=function(t,n){if("ok"==n){var o=t.getSettings();e.dataDestValid=o,i.setValue(o),i.checkValidate()}},o=new SSE.Views.CellRangeDialog({handler:n}).on("close",function(){e.show(),_.delay(function(){i.focus()},1)}),s=e.$window.offset();e.hide(),o.show(s.left+160,s.top+125),o.setSettings({api:e.api,range:_.isEmpty(i.getValue())||1!=i.checkValidate()?e.dataDestValid:i.getValue(),type:Asc.c_oAscSelectionDialogType.Chart})}},isRangeValid:function(){var t=!0,e="";return _.isEmpty(this.txtDestRange.getValue())?(t=!1,e=this.txtEmpty):(t=this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.Chart,this.txtDestRange.getValue()),!(t=t==Asc.c_oAscError.ID.No)&&(e=this.textInvalidRange)),t||(this.txtDestRange.showError([e]),this.txtDestRange.focus(),t)},txtDelimiter:"Delimiter",txtEncoding:"Encoding ",txtSpace:"Space",txtTab:"Tab",txtTitle:"Choose %1 options",txtPassword:"Password",txtTitleProtected:"Protected File",txtOther:"Other",txtIncorrectPwd:"Password is incorrect.",closeButtonText:"Close File",txtPreview:"Preview",txtComma:"Comma",txtColon:"Colon",txtSemicolon:"Semicolon",txtProtected:"Once you enter the password and open the file, the current password to the file will be reset.",txtAdvanced:"Advanced",txtOpenFile:"Enter a password to open the file",textSelectData:"Select data",txtDestData:"Choose where to put the data",txtEmpty:"This field is required",textInvalidRange:"Invalid cells range"},Common.Views.OpenDialog||{}))}),define("common/main/lib/view/UserNameDialog",["common/main/lib/component/Window","common/main/lib/component/InputField"],function(){"use strict";Common.Views.UserNameDialog=Common.UI.Window.extend(_.extend({options:{width:330,header:!1,modal:!1,cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,t||{}),this.template=['<div class="box">','<div style="margin-bottom: 2px;">'+(this.options.label?this.options.label:this.textLabel)+"</div>",'<div id="id-dlg-username-caption" class="input-row"></div>','<div id="id-dlg-username-chk-use" class="" style="margin-top: 10px;"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this;t.inputLabel=new Common.UI.InputField({el:$("#id-dlg-username-caption"),allowBlank:!0,style:"width: 100%;",maxLength:128,validateOnBlur:!1,validation:t.options.validation||function(t){return!!t||""}}),t.inputLabel.setValue(this.options.value||""),t.chDontShow=new Common.UI.CheckBox({el:$("#id-dlg-username-chk-use"),labelText:this.textDontShow,value:this.options.check}),this.getChild().find(".btn").on("click",_.bind(this.onBtnClick,this))},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var t=this;_.delay(function(){t.getChild("input").focus()},50)},onPrimary:function(t){return this._handleInput("ok"),!1},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},_handleInput:function(t){if(this.options.handler){if("ok"==t&&!0!==this.inputLabel.checkValidate())return void this.inputLabel.cmpEl.find("input").focus();this.options.handler.call(this,t,{input:this.inputLabel.getValue(),checkbox:"checked"==this.chDontShow.getValue()})}this.close()},textLabel:"Label:",textLabelError:"Label must not be empty.",textDontShow:"Don't ask me again"},Common.Views.UserNameDialog||{}))}),define("common/main/lib/util/LocalStorage",["gateway"],function(){Common.localStorage=new function(){var t,e,i={},n=function(t){"localstorage"==t.type&&(i=t.keys)};Common.Gateway.on("internalcommand",n);var o=function(){p||Common.Gateway.internalMessage("localstorage",{cmd:"get",keys:e})},s=function(){p||Common.Gateway.internalMessage("localstorage",{cmd:"set",keys:i})},a=function(t,e,n){if(p)try{localStorage.setItem(t,e)}catch(t){}else i[t]=e,!0===n&&Common.Gateway.internalMessage("localstorage",{cmd:"set",keys:{name:e}})},r=function(t,e,i){a(t,e?1:0,i)},l=function(t){return p?localStorage.getItem(t):void 0===i[t]?null:i[t]},c=function(t,e){var i=l(t);return e=e||!1,null!==i?0!=parseInt(i):e},d=function(t){return null!==l(t)},h=function(t){p?localStorage.removeItem(t):delete i[t]};try{var p=!!window.localStorage}catch(t){p=!1}return{getId:function(){return t},setId:function(e){t=e},getItem:l,getBool:c,setBool:r,setItem:a,removeItem:h,setKeysFilter:function(t){e=t},getKeysFilter:function(){return e},itemExists:d,sync:o,save:s}}}),define("documenteditor/main/app/model/ShapeGroup",["backbone"],function(t){"use strict";DE.Models=DE.Models||{},DE.Models.ShapeModel=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),imageUrl:null,data:null}}}),DE.Models.ShapeGroup=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),groupName:null,groupId:null,groupStore:null}}})}),define("documenteditor/main/app/collection/ShapeGroups",["backbone","documenteditor/main/app/model/ShapeGroup"],function(t){"use strict";if(void 0===e)var e={};e.Collections=e.Collections||{},DE.Collections=DE.Collections||{},DE.Collections.ShapeGroups=t.Collection.extend({model:DE.Models.ShapeGroup})}),define("documenteditor/main/app/model/EquationGroup",["backbone"],function(t){"use strict";DE.Models=DE.Models||{},DE.Models.EquationModel=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),data:null,width:0,height:0,posX:0,posY:0}}}),DE.Models.EquationGroup=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),groupName:null,groupId:null,groupStore:null}}})}),define("documenteditor/main/app/collection/EquationGroups",["backbone","documenteditor/main/app/model/EquationGroup"],function(t){"use strict";DE.Collections=DE.Collections||{},DE.Collections.EquationGroups=t.Collection.extend({model:DE.Models.EquationGroup})}),define("documenteditor/main/app/controller/Main",["core","irregularstack","common/main/lib/component/Window","common/main/lib/component/LoadMask","common/main/lib/component/Tooltip","common/main/lib/controller/Fonts","common/main/lib/collection/TextArt","common/main/lib/view/OpenDialog","common/main/lib/view/UserNameDialog","common/main/lib/util/LocalStorage","documenteditor/main/app/collection/ShapeGroups","documenteditor/main/app/collection/EquationGroups"],function(){"use strict";DE.Controllers.Main=Backbone.Controller.extend(_.extend(function(){var appHeader,ApplyEditRights=-255,LoadingDocument=-256,mapCustomizationElements={about:"button#left-btn-about",feedback:"button#left-btn-support",goback:"#fm-btn-back > a, #header-back > div"},mapCustomizationExtElements={toolbar:"#viewport #toolbar",leftMenu:"#viewport #left-menu, #viewport #id-toolbar-full-placeholder-btn-settings, #viewport #id-toolbar-short-placeholder-btn-settings",rightMenu:"#viewport #right-menu",statusBar:"#statusbar"};return Common.localStorage.setId("text"),Common.localStorage.setKeysFilter("de-,asc.text"),Common.localStorage.sync(),{models:[],collections:["ShapeGroups","EquationGroups","Common.Collections.HistoryUsers","Common.Collections.TextArt"],views:[],initialize:function(){this.addListeners({FileMenu:{"settings:apply":_.bind(this.applySettings,this)},"Common.Views.ReviewChanges":{"settings:apply":_.bind(this.applySettings,this)}});var t=this,e=["Normal","No Spacing","Heading 1","Heading 2","Heading 3","Heading 4","Heading 5","Heading 6","Heading 7","Heading 8","Heading 9","Title","Subtitle","Quote","Intense Quote","List Paragraph","footnote text","Caption","endnote text"],i={Series:this.txtSeries,"Diagram Title":this.txtDiagramTitle,"X Axis":this.txtXAxis,"Y Axis":this.txtYAxis,"Your text here":this.txtArt,"Error! Bookmark not defined.":this.txtBookmarkError,above:this.txtAbove,below:this.txtBelow,"on page ":this.txtOnPage+" ",Header:this.txtHeader,Footer:this.txtFooter," -Section ":" "+this.txtSection+" ","First Page ":this.txtFirstPage+" ","Even Page ":this.txtEvenPage+" ","Odd Page ":this.txtOddPage+" ","Same as Previous":this.txtSameAsPrev,"Current Document":this.txtCurrentDocument,"No table of contents entries found.":this.txtNoTableOfContents,"Table of Contents":this.txtTableOfContents,"Syntax Error":this.txtSyntaxError,"Missing Operator":this.txtMissOperator,"Missing Argument":this.txtMissArg,"Number Too Large To Format":this.txtTooLarge,"Zero Divide":this.txtZeroDivide,"Is Not In Table":this.txtNotInTable,"Index Too Large":this.txtIndTooLarge,"The Formula Not In Table":this.txtFormulaNotInTable,"Table Index Cannot be Zero":this.txtTableInd,"Undefined Bookmark":this.txtUndefBookmark,"Unexpected End of Formula":this.txtEndOfFormula,Hyperlink:this.txtHyperlink,"Error! Main Document Only.":this.txtMainDocOnly,"Error! Not a valid bookmark self-reference.":this.txtNotValidBookmark,"Error! No text of specified style in document.":this.txtNoText,"Choose an item":this.txtChoose,"Enter a date":this.txtEnterDate,"Type equation here":this.txtTypeEquation,"Click to load image":this.txtClickToLoad,None:this.txtNone,"No table of figures entries found.":this.txtNoTableOfFigures,"table of figures":this.txtTableOfFigures,"TOC Heading":this.txtTOCHeading};e.forEach(function(e){i[e]=t["txtStyle_"+e.replace(/ /g,"_")]||e}),t.translationTable=i},onLaunch:function(){var t=this;if(this.stackLongActions=new Common.IrregularStack({strongCompare:function(t,e){return t.id===e.id&&t.type===e.type},weakCompare:function(t,e){return t.type===e.type}}),this._state={isDisconnected:!1,usersCount:1,fastCoauth:!0,lostEditingRights:!1,licenseType:!1,isDocModified:!1},this.languages=null,!Common.Utils.isBrowserSupported())return Common.Utils.showBrowserRestriction(),void Common.Gateway.reportError(void 0,this.unsupportedBrowserErrorText);if(window.flat_desine=!0,this.api=this.getApplication().getController("Viewport").getApi(),Common.UI.FocusManager.init(),Common.UI.Themes.init(this.api),this.api){this.api.SetDrawingFreeze(!0);var e=Common.localStorage.getBool("de-settings-cachemode",!0);switch(Common.Utils.InternalSettings.set("de-settings-cachemode",e),this.api.asc_setDefaultBlitMode(!!e),e=Common.localStorage.getItem("de-settings-fontrender"),null===e&&(e="0"),Common.Utils.InternalSettings.set("de-settings-fontrender",e),e){case"0":this.api.SetFontRenderingMode(3);break;case"1":this.api.SetFontRenderingMode(1);break;case"2":this.api.SetFontRenderingMode(2)}this.api.asc_registerCallback("asc_onError",_.bind(this.onError,this)),this.api.asc_registerCallback("asc_onDocumentContentReady",_.bind(this.onDocumentContentReady,this)),this.api.asc_registerCallback("asc_onOpenDocumentProgress",_.bind(this.onOpenDocument,this)),this.api.asc_registerCallback("asc_onDocumentUpdateVersion",_.bind(this.onUpdateVersion,this)),this.api.asc_registerCallback("asc_onServerVersion",_.bind(this.onServerVersion,this)),this.api.asc_registerCallback("asc_onAdvancedOptions",_.bind(this.onAdvancedOptions,this)),this.api.asc_registerCallback("asc_onDocumentName",_.bind(this.onDocumentName,this)),this.api.asc_registerCallback("asc_onPrintUrl",_.bind(this.onPrintUrl,this)),this.api.asc_registerCallback("asc_onMeta",_.bind(this.onMeta,this)),this.api.asc_registerCallback("asc_onSpellCheckInit",_.bind(this.loadLanguages,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("goback",_.bind(this.goBack,this)),Common.NotificationCenter.on("markfavorite",_.bind(this.markFavorite,this)),Common.NotificationCenter.on("download:advanced",_.bind(this.onAdvancedOptions,this)),Common.NotificationCenter.on("showmessage",_.bind(this.onExternalMessage,this)),Common.NotificationCenter.on("showerror",_.bind(this.onError,this)),this.isShowOpenDialog=!1,this.editorConfig={},this.appOptions={},Common.Gateway.on("init",_.bind(this.loadConfig,this)),Common.Gateway.on("showmessage",_.bind(this.onExternalMessage,this)),Common.Gateway.on("opendocument",_.bind(this.loadDocument,this)),Common.Gateway.on("grabfocus",_.bind(this.onGrabFocus,this)),Common.Gateway.appReady(),this.getApplication().getController("Viewport").setApi(this.api),this.getApplication().getController("Statusbar").setApi(this.api),this.contComments=this.getApplication().getController("Common.Controllers.Comments"),$(document.body).on("focus","input, textarea",function(e){/area_id/.test(e.target.id)||(/msg-reply/.test(e.target.className)?(t.dontCloseDummyComment=!0,t.beforeShowDummyComment=t.beforeCloseDummyComment=!1):/textarea-control/.test(e.target.className)?t.inTextareaControl=!0:!Common.Utils.ModalWindow.isVisible()&&/form-control/.test(e.target.className)&&(t.inFormControl=!0))}),$(document.body).on("blur","input, textarea",function(e){if(!Common.Utils.ModalWindow.isVisible()){if(/form-control/.test(e.target.className)&&(t.inFormControl=!1),
t.getApplication().getController("LeftMenu").getView("LeftMenu").getMenu("file").isVisible())return;if(!e.relatedTarget||!/area_id/.test(e.target.id)&&!("input"==e.target.localName&&$(e.target).parent().find(e.relatedTarget).length>0)&&!("textarea"==e.target.localName&&$(e.target).closest(".asc-window").find(".dropdown-menu").find(e.relatedTarget).length>0)&&("input"!=e.relatedTarget.localName||!/form-control/.test(e.relatedTarget.className))&&("textarea"!=e.relatedTarget.localName||/area_id/.test(e.relatedTarget.id))){if(Common.Utils.isIE&&e.originalEvent&&e.originalEvent.target&&/area_id/.test(e.originalEvent.target.id)&&e.originalEvent.target===e.originalEvent.srcElement)return;t.api.asc_enableKeyEvents(!0),t.dontCloseDummyComment&&/msg-reply/.test(e.target.className)?$(e.target).closest(".user-comment-item").find(e.relatedTarget).length<1?t.dontCloseDummyComment=t.beforeCloseDummyComment=!1:t.beforeCloseDummyComment=!0:/textarea-control/.test(e.target.className)&&(t.inTextareaControl=!1)}}}).on("dragover",function(t){var e=t.originalEvent;if(e.target&&$(e.target).closest("#editor_sdk").length<1)return e.preventDefault(),e.dataTransfer.dropEffect="none",!1}).on("dragstart",function(t){var e=t.originalEvent;if(e.target){var i=$(e.target);(i.closest(".combobox").length>0||i.closest(".dropdown-menu").length>0||i.closest(".ribtab").length>0||i.closest(".combo-dataview").length>0)&&e.preventDefault()}}).on("mouseup",function(e){t.beforeCloseDummyComment&&setTimeout(function(){t.dontCloseDummyComment=t.beforeCloseDummyComment=!1},10)}),Common.NotificationCenter.on({"modal:show":function(){Common.Utils.ModalWindow.show(),t.api.asc_enableKeyEvents(!1)},"modal:close":function(e){Common.Utils.ModalWindow.close(),Common.Utils.ModalWindow.isVisible()||t.api.asc_enableKeyEvents(!0)},"modal:hide":function(e){Common.Utils.ModalWindow.close(),Common.Utils.ModalWindow.isVisible()||t.api.asc_enableKeyEvents(!0)},"settings:unitschanged":_.bind(this.unitsChanged,this),"dataview:focus":function(t){},"dataview:blur":function(e){Common.Utils.ModalWindow.isVisible()||t.api.asc_enableKeyEvents(!0)},"menu:show":function(t){},"menu:hide":function(e,i){Common.Utils.ModalWindow.isVisible()||i||t.api.asc_enableKeyEvents(!0)},"edit:complete":_.bind(t.onEditComplete,t)}),this.initNames(),Common.util.Shortcuts.delegateShortcuts({shortcuts:{"command+s,ctrl+s,command+p,ctrl+p,command+k,ctrl+k,command+d,ctrl+d":_.bind(function(t){t.preventDefault(),t.stopPropagation()},this)}})}t.defaultTitleText="ONLYOFFICE",t.warnNoLicense=t.warnNoLicense.replace(/%1/g,"ONLYOFFICE"),t.warnNoLicenseUsers=t.warnNoLicenseUsers.replace(/%1/g,"ONLYOFFICE"),t.textNoLicenseTitle=t.textNoLicenseTitle.replace(/%1/g,"ONLYOFFICE"),t.warnLicenseExceeded=t.warnLicenseExceeded.replace(/%1/g,"ONLYOFFICE"),t.warnLicenseUsersExceeded=t.warnLicenseUsersExceeded.replace(/%1/g,"ONLYOFFICE")},loadConfig:function(t){this.editorConfig=$.extend(this.editorConfig,t.config),this.appOptions.customization=this.editorConfig.customization,this.appOptions.canRenameAnonymous=!("object"==typeof this.appOptions.customization&&"object"==typeof this.appOptions.customization.anonymous&&!1===this.appOptions.customization.anonymous.request),this.appOptions.guestName="object"==typeof this.appOptions.customization&&"object"==typeof this.appOptions.customization.anonymous&&"string"==typeof this.appOptions.customization.anonymous.label&&""!==this.appOptions.customization.anonymous.label.trim()?Common.Utils.String.htmlEncode(this.appOptions.customization.anonymous.label):this.textGuest;var e;this.appOptions.canRenameAnonymous&&(e=Common.localStorage.getItem("guest-username"),Common.Utils.InternalSettings.set("guest-username",e),Common.Utils.InternalSettings.set("save-guest-username",!!e)),this.editorConfig.user=this.appOptions.user=Common.Utils.fillUserInfo(this.editorConfig.user,this.editorConfig.lang,e?e+" ("+this.appOptions.guestName+")":this.textAnonymous,Common.localStorage.getItem("guest-id")||"uid-"+Date.now()),this.appOptions.user.anonymous&&Common.localStorage.setItem("guest-id",this.appOptions.user.id),this.appOptions.isDesktopApp="desktop"==this.editorConfig.targetApp,this.appOptions.canCreateNew=this.editorConfig.canRequestCreateNew||!_.isEmpty(this.editorConfig.createUrl),this.appOptions.canOpenRecent=void 0!==this.editorConfig.recent&&!this.appOptions.isDesktopApp,this.appOptions.templates=this.editorConfig.templates,this.appOptions.recent=this.editorConfig.recent,this.appOptions.createUrl=this.editorConfig.createUrl,this.appOptions.canRequestCreateNew=this.editorConfig.canRequestCreateNew,this.appOptions.lang=this.editorConfig.lang,this.appOptions.location="string"==typeof this.editorConfig.location?this.editorConfig.location.toLowerCase():"",this.appOptions.sharingSettingsUrl=this.editorConfig.sharingSettingsUrl,this.appOptions.fileChoiceUrl=this.editorConfig.fileChoiceUrl,this.appOptions.mergeFolderUrl=this.editorConfig.mergeFolderUrl,this.appOptions.saveAsUrl=this.editorConfig.saveAsUrl,this.appOptions.canAnalytics=!1,this.appOptions.canRequestClose=this.editorConfig.canRequestClose,this.appOptions.canBackToFolder=!1!==this.editorConfig.canBackToFolder&&"object"==typeof this.editorConfig.customization&&"object"==typeof this.editorConfig.customization.goback&&(!_.isEmpty(this.editorConfig.customization.goback.url)||this.editorConfig.customization.goback.requestClose&&this.appOptions.canRequestClose),this.appOptions.canBack=!0===this.appOptions.canBackToFolder,this.appOptions.canPlugins=!1,this.appOptions.canMakeActionLink=this.editorConfig.canMakeActionLink,this.appOptions.canRequestUsers=this.editorConfig.canRequestUsers,this.appOptions.canRequestSendNotify=this.editorConfig.canRequestSendNotify,this.appOptions.canRequestSaveAs=this.editorConfig.canRequestSaveAs,this.appOptions.canRequestInsertImage=this.editorConfig.canRequestInsertImage,this.appOptions.canRequestCompareFile=this.editorConfig.canRequestCompareFile,this.appOptions.canRequestMailMergeRecipients=this.editorConfig.canRequestMailMergeRecipients,this.appOptions.canRequestSharingSettings=this.editorConfig.canRequestSharingSettings,this.appOptions.compatibleFeatures="object"==typeof this.appOptions.customization&&!!this.appOptions.customization.compatibleFeatures,this.appOptions.canFeatureComparison=!!this.api.asc_isSupportFeature("comparison"),this.appOptions.canFeatureContentControl=!!this.api.asc_isSupportFeature("content-controls"),this.appOptions.canFeatureForms=!1,this.appOptions.mentionShare=!("object"==typeof this.appOptions.customization&&0==this.appOptions.customization.mentionShare),this.appOptions.user.guest&&this.appOptions.canRenameAnonymous&&Common.NotificationCenter.on("user:rename",_.bind(this.showRenameUserDialog,this)),appHeader=this.getApplication().getController("Viewport").getView("Common.Views.Header"),appHeader.setCanBack(!0===this.appOptions.canBackToFolder,this.appOptions.canBackToFolder?this.editorConfig.customization.goback.text:""),this.editorConfig.lang&&this.api.asc_setLocale(this.editorConfig.lang),"us"!=this.appOptions.location&&"ca"!=this.appOptions.location||Common.Utils.Metric.setDefaultMetric(Common.Utils.Metric.c_MetricUnits.inch),e=Common.localStorage.getItem("de-macros-mode"),null===e?(e=this.editorConfig.customization?this.editorConfig.customization.macrosMode:"warn",e="enable"==e?1:"disable"==e?2:0):e=parseInt(e),Common.Utils.InternalSettings.set("de-macros-mode",e),this.appOptions.wopi=this.editorConfig.wopi,Common.Controllers.Desktop.init(this.appOptions)},loadDocument:function(t){this.permissions={},this.document=t.doc;var e={};if(t.doc){this.permissions=$.extend(this.permissions,t.doc.permissions);var i=$.extend({},t.doc.permissions),n=$.extend({},t.doc.options,this.editorConfig.actionLink||{}),o=new Asc.asc_CUserInfo;o.put_Id(this.appOptions.user.id),o.put_FullName(this.appOptions.user.fullname),o.put_IsAnonymousUser(!!this.appOptions.user.anonymous),e=new Asc.asc_CDocInfo,e.put_Id(t.doc.key),e.put_Url(t.doc.url),e.put_Title(t.doc.title),e.put_Format(t.doc.fileType),e.put_VKey(t.doc.vkey),e.put_Options(n),e.put_UserInfo(o),e.put_CallbackUrl(this.editorConfig.callbackUrl),e.put_Token(t.doc.token),e.put_Permissions(i),e.put_EncryptedInfo(this.editorConfig.encryptionKeys);var s=!this.editorConfig.customization||!1!==this.editorConfig.customization.macros;e.asc_putIsEnabledMacroses(!!s),s=!this.editorConfig.customization||!1!==this.editorConfig.customization.plugins,e.asc_putIsEnabledPlugins(!!s);var a=/^(?:(pdf|djvu|xps|oxps))$/.exec(t.doc.fileType);a&&"string"==typeof a[1]&&(this.permissions.edit=this.permissions.review=!1)}this.editorConfig.customization&&(this.editorConfig.customization.toolbarNoTabs||"desktop"!==this.editorConfig.targetApp&&(this.editorConfig.customization.loaderName||this.editorConfig.customization.loaderLogo))||($("#editor-container").css("overflow","hidden"),$("#editor-container").append('<div class="doc-placeholder">'+'<div class="line"></div>'.repeat(20)+"</div>"),("view"==this.editorConfig.mode||!1===this.permissions.edit&&!this.permissions.review)&&$("#editor-container").find(".doc-placeholder").css("margin-top",19)),this.api.asc_registerCallback("asc_onGetEditorPermissions",_.bind(this.onEditorPermissions,this)),this.api.asc_registerCallback("asc_onLicenseChanged",_.bind(this.onLicenseChanged,this)),this.api.asc_registerCallback("asc_onRunAutostartMacroses",_.bind(this.onRunAutostartMacroses,this)),this.api.asc_setDocInfo(e),this.api.asc_getEditorPermissions(this.editorConfig.licenseUrl,this.editorConfig.customerId),t.doc&&appHeader.setDocumentCaption(t.doc.title)},onProcessSaveResult:function(t){this.api.asc_OnSaveEnd(t.result),t&&!1===t.result&&Common.UI.error({title:this.criticalErrorTitle,msg:_.isEmpty(t.message)?this.errorProcessSaveResult:t.message})},onProcessRightsChange:function(t){if(t&&!1===t.enabled){var e=this,i=this._state.lostEditingRights;this._state.lostEditingRights=!this._state.lostEditingRights,this.api.asc_coAuthoringDisconnect(),Common.NotificationCenter.trigger("collaboration:sharingdeny"),Common.NotificationCenter.trigger("api:disconnect"),i||Common.UI.warning({title:this.notcriticalErrorTitle,maxwidth:600,msg:_.isEmpty(t.message)?this.warnProcessRightsChange:t.message,callback:function(){e._state.lostEditingRights=!1,e.onEditComplete()}})}},onDownloadAs:function(t){if(!this.appOptions.canDownload&&!this.appOptions.canDownloadOrigin)return void Common.Gateway.reportError(Asc.c_oAscError.ID.AccessDeny,this.errorAccessDeny);this._state.isFromGatewayDownloadAs=!0;var e=/^(?:(pdf|djvu|xps|oxps))$/.exec(this.document.fileType);if(e&&"string"==typeof e[1])this.api.asc_DownloadOrigin(!0);else{var i=t&&"string"==typeof t?Asc.c_oAscFileType[t.toUpperCase()]:null,n=[Asc.c_oAscFileType.TXT,Asc.c_oAscFileType.ODT,Asc.c_oAscFileType.DOCX,Asc.c_oAscFileType.HTML,Asc.c_oAscFileType.PDF,Asc.c_oAscFileType.PDFA,Asc.c_oAscFileType.DOTX,Asc.c_oAscFileType.OTT,Asc.c_oAscFileType.FB2,Asc.c_oAscFileType.EPUB];(!i||n.indexOf(i)<0)&&(i=Asc.c_oAscFileType.DOCX),this.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(i,!0))}},onProcessMouse:function(t){if("mouseup"==t.type){var e=document.getElementById("editor_sdk");if(e){var i=e.getBoundingClientRect();this.api.OnMouseUp(t.x-i.left,t.y-i.top)}}},onRefreshHistory:function(t){if(this.appOptions.canUseHistory)if(this.loadMask&&this.loadMask.hide(),t.data.error||!t.data.history){var e=this.getApplication().getCollection("Common.Collections.HistoryVersions");e&&e.size()>0&&e.each(function(t){t.set("canRestore",!1)}),Common.UI.alert({title:this.notcriticalErrorTitle,msg:t.data.error?t.data.error:this.txtErrorLoadHistory,iconCls:"warn",buttons:["ok"],callback:_.bind(function(t){this.onEditComplete()},this)})}else{this.api.asc_coAuthoringDisconnect(),appHeader.setCanRename(!1),appHeader.getButton("users")&&appHeader.getButton("users").hide(),this.getApplication().getController("LeftMenu").getView("LeftMenu").showHistory(),this.disableEditing(!0),this._renameDialog&&this._renameDialog.close();var i=t.data.history,e=this.getApplication().getCollection("Common.Collections.HistoryVersions"),n=null;if(e){var o,s,a=[],r=-1,l=-1,c=[],d="",h=this.getApplication().getCollection("Common.Collections.HistoryUsers"),p=null,m=0;for(o=i.length-1;o>=0;o--)if(s=i[o],void 0!==s.versionGroup&&null!==s.versionGroup||(s.versionGroup=s.version),s){if(s.user||(s.user={}),d=o>0&&i[o-1]?i[o-1].key:s.key+"0",p=h.findUser(s.user.id),p||(p=new Common.Models.User({id:s.user.id,username:s.user.name||this.textAnonymous,colorval:Asc.c_oAscArrUserColors[m],color:this.generateUserColor(Asc.c_oAscArrUserColors[m++])}),h.add(p)),a.push(new Common.Models.HistoryVersion({version:s.versionGroup,revision:s.version,userid:s.user.id,username:s.user.name||this.textAnonymous,usercolor:p.get("color"),created:s.created,docId:s.key,markedAsVersion:r!==s.versionGroup,selected:t.data.currentVersion==s.version,canRestore:this.appOptions.canHistoryRestore&&o<i.length-1,isExpanded:!0,serverVersion:s.serverVersion,fileType:"docx"})),t.data.currentVersion==s.version&&(n=a[a.length-1]),r=s.versionGroup,l!==s.version){for(l=s.version,c.reverse(),g=0;g<c.length;g++)a[a.length-g-2].set("arrColors",c);c=[]}c.push(p.get("colorval"));var u,g,b=s.changes;if(b&&b.length>0){if(a[a.length-1].set("docIdPrev",d),!_.isEmpty(s.serverVersion)&&s.serverVersion==this.appOptions.buildVersion)for(a[a.length-1].set("changeid",b.length-1),a[a.length-1].set("hasChanges",b.length>1),g=b.length-2;g>=0;g--)u=b[g],p=h.findUser(u.user.id),p||(p=new Common.Models.User({id:u.user.id,username:u.user.name||this.textAnonymous,colorval:Asc.c_oAscArrUserColors[m],color:this.generateUserColor(Asc.c_oAscArrUserColors[m++])}),h.add(p)),a.push(new Common.Models.HistoryVersion({version:s.versionGroup,revision:s.version,changeid:g,userid:u.user.id,username:u.user.name||this.textAnonymous,usercolor:p.get("color"),created:u.created,docId:s.key,docIdPrev:d,selected:!1,canRestore:this.appOptions.canHistoryRestore&&this.appOptions.canDownload,isRevision:!1,isVisible:!0,serverVersion:s.serverVersion,fileType:"docx"})),c.push(p.get("colorval"))}else 0==o&&1==i.length&&a[a.length-1].set("docId",s.key+"1")}if(c.length>0){for(c.reverse(),g=0;g<c.length;g++)a[a.length-g-1].set("arrColors",c);c=[]}e.reset(a),null===n&&e.size()>0&&(n=e.at(0),n.set("selected",!0)),n&&this.getApplication().getController("Common.Controllers.History").onSelectRevision(null,null,n)}}},generateUserColor:function(t){return"#"+("000000"+t.toString(16)).substr(-6)},disableEditing:function(t){var e=this.getApplication();this.appOptions.canEdit&&"view"!==this.editorConfig.mode&&(e.getController("RightMenu").getView("RightMenu").clearSelection(),e.getController("RightMenu").SetDisabled(t,!1),e.getController("Statusbar").getView("Statusbar").SetDisabled(t)),e.getController("LeftMenu").SetDisabled(t,!0),e.getController("Toolbar").DisableToolbar(t,t),e.getController("Common.Controllers.ReviewChanges").SetDisabled(t),e.getController("Viewport").SetDisabled(t)},onRequestClose:function(){var t=this;this.api.isDocumentModified()?(this.api.asc_stopSaving(),Common.UI.warning({closable:!1,width:500,title:this.notcriticalErrorTitle,msg:this.leavePageTextOnClose,buttons:["ok","cancel"],primary:"ok",callback:function(e){"ok"==e?(t.api.asc_undoAllChanges(),t.api.asc_continueSaving(),Common.Gateway.requestClose()):t.api.asc_continueSaving()}})):Common.Gateway.requestClose()},goBack:function(t){if(!Common.Controllers.Desktop.process("goback"))if(this.appOptions.customization.goback.requestClose&&this.appOptions.canRequestClose)this.onRequestClose();else{var e=this.appOptions.customization.goback.url;t||!1===this.appOptions.customization.goback.blank?parent.location.href=e:window.open(e,"_blank")}},markFavorite:function(t){Common.Controllers.Desktop.process("markfavorite")||Common.Gateway.metaChange({favorite:t})},onSetFavorite:function(t){this.appOptions.canFavorite&&appHeader.setFavorite(!!t)},onEditComplete:function(t){var e=this.getApplication(),i=e.getController("Toolbar"),n=i.getView();if(!this.appOptions.isEdit||!n||!n.btnInsertShape.pressed&&!n.btnInsertText.pressed||_.isObject(arguments[1])&&"tlbtn-insertshape"===arguments[1].id||(this.api&&this.api.StartAddShape("",!1),n.btnInsertShape.toggle(!1,!1),n.btnInsertText.toggle(!1,!1)),this.appOptions.isEdit&&n&&n.btnHighlightColor.pressed&&(!_.isObject(arguments[1])||"id-toolbar-btn-highlight"!==arguments[1].id)&&(this.api.SetMarkerFormat(!1),n.btnHighlightColor.toggle(!1,!1)),e.getController("DocumentHolder").getView().focus(),this.api&&this.appOptions.isEdit&&!n._state.previewmode){var o=this.api.asc_isDocumentCanSave(),s=this.appOptions.forcesave,a=!!n.btnCollabChanges.rendered&&n.btnCollabChanges.cmpEl.hasClass("notify"),r=!o&&!a&&!s||this._state.isDisconnected||this._state.fastCoauth&&this._state.usersCount>1&&!s;n.btnSave.setDisabled(r)}},onLongActionBegin:function(t,e){var i={id:e,type:t};this.stackLongActions.push(i),this.setLongActionView(i)},onLongActionEnd:function(t,e){var i={id:e,type:t};if(this.stackLongActions.pop(i),appHeader&&appHeader.setDocumentCaption(this.api.asc_getDocumentName()),this.updateWindowTitle(!0),i=this.stackLongActions.get({type:Asc.c_oAscAsyncActionType.Information}))this.setLongActionView(i);else{var n=this;e!=Asc.c_oAscAsyncAction.Save&&e!=Asc.c_oAscAsyncAction.ForceSaveButton||this.appOptions.isOffline?this.getApplication().getController("Statusbar").setStatusCaption(""):this._state.fastCoauth&&this._state.usersCount>1?n._state.timerSave=setTimeout(function(){n.getApplication().getController("Statusbar").setStatusCaption(n.textChangesSaved,!1,3e3)},500):n.getApplication().getController("Statusbar").setStatusCaption(n.textChangesSaved,!1,3e3)}i=this.stackLongActions.get({type:Asc.c_oAscAsyncActionType.BlockInteraction}),i?this.setLongActionView(i):this.loadMask&&this.loadMask.hide(),this.appOptions.isEdit&&(e==Asc.c_oAscAsyncAction.Save||e==Asc.c_oAscAsyncAction.ForceSaveButton)&&(!this._state.fastCoauth||this._state.usersCount<2||this.getApplication().getController("Common.Controllers.ReviewChanges").isPreviewChangesMode())?this.synchronizeChanges():this.appOptions.isEdit&&(e==Asc.c_oAscAsyncAction.Save||e==Asc.c_oAscAsyncAction.ForceSaveButton||e==Asc.c_oAscAsyncAction.ApplyChanges)&&this._state.fastCoauth&&this.getApplication().getController("Common.Controllers.ReviewChanges").synchronizeChanges(),e==Asc.c_oAscAsyncAction.Open&&(Common.Utils.InternalSettings.get("de-settings-livecomment")?this.api.asc_showComments(Common.Utils.InternalSettings.get("de-settings-resolvedcomment")):this.api.asc_hideComments()),t!=Asc.c_oAscAsyncActionType.BlockInteraction||this.getApplication().getController("LeftMenu").dlgSearch&&this.getApplication().getController("LeftMenu").dlgSearch.isVisible()||this.getApplication().getController("Toolbar").dlgSymbolTable&&this.getApplication().getController("Toolbar").dlgSymbolTable.isVisible()||(e==Asc.c_oAscAsyncAction.LoadDocumentFonts||e==Asc.c_oAscAsyncAction.ApplyChanges||e==Asc.c_oAscAsyncAction.DownloadAs)&&(this.dontCloseDummyComment||this.inTextareaControl||Common.Utils.ModalWindow.isVisible()||this.inFormControl)||this.api.asc_enableKeyEvents(!0)},setLongActionView:function(t){var e="",i="",n=!1;switch(t.id){case Asc.c_oAscAsyncAction.Open:e=this.openTitleText,i=this.openTextText;break;case Asc.c_oAscAsyncAction.Save:case Asc.c_oAscAsyncAction.ForceSaveButton:clearTimeout(this._state.timerSave),n=!0,e=this.saveTitleText,i=this.appOptions.isOffline?"":this.saveTextText;break;case Asc.c_oAscAsyncAction.LoadDocumentFonts:e=this.loadFontsTitleText,i=this.loadFontsTextText;break;case Asc.c_oAscAsyncAction.LoadDocumentImages:e=this.loadImagesTitleText,i=this.loadImagesTextText;break;case Asc.c_oAscAsyncAction.LoadFont:e=this.loadFontTitleText,i=this.loadFontTextText;break;case Asc.c_oAscAsyncAction.LoadImage:e=this.loadImageTitleText,i=this.loadImageTextText;break;case Asc.c_oAscAsyncAction.DownloadAs:e=this.downloadTitleText,i=this.downloadTextText;break;case Asc.c_oAscAsyncAction.Print:e=this.printTitleText,i=this.printTextText;break;case Asc.c_oAscAsyncAction.UploadImage:e=this.uploadImageTitleText,i=this.uploadImageTextText;break;case Asc.c_oAscAsyncAction.ApplyChanges:e=this.applyChangesTitleText,i=this.applyChangesTextText;break;case Asc.c_oAscAsyncAction.PrepareToSave:e=this.savePreparingText,i=this.savePreparingTitle;break;case Asc.c_oAscAsyncAction.MailMergeLoadFile:e=this.mailMergeLoadFileText,i=this.mailMergeLoadFileTitle;break;case Asc.c_oAscAsyncAction.DownloadMerge:e=this.downloadMergeTitle,i=this.downloadMergeText;break;case Asc.c_oAscAsyncAction.SendMailMerge:e=this.sendMergeTitle,i=this.sendMergeText;break;case Asc.c_oAscAsyncAction.Waiting:e=this.waitText,i=this.waitText;break;case ApplyEditRights:e=this.txtEditingMode,i=this.txtEditingMode;break;case LoadingDocument:e=this.loadingDocumentTitleText+"           ",i=this.loadingDocumentTextText;break;default:"string"==typeof t.id&&(e=t.id,i=t.id)}t.type==Asc.c_oAscAsyncActionType.BlockInteraction?(this.loadMask||(this.loadMask=new Common.UI.LoadMask({owner:$("#viewport")})),this.loadMask.setTitle(e),this.isShowOpenDialog||this.loadMask.show(t.id===Asc.c_oAscAsyncAction.Open)):this.getApplication().getController("Statusbar").setStatusCaption(i,n)},onApplyEditRights:function(t){this.getApplication().getController("Statusbar").setStatusCaption(""),t&&!t.allowed&&Common.UI.info({title:this.requestEditFailedTitleText,msg:t.message||this.requestEditFailedMessageText})},onDocumentContentReady:function(){function checkWarns(){if(!window.AscDesktopEditor){var t=[];Common.Utils.isIE9m&&t.push(me.warnBrowserIE9),t.length&&me.showTips(t)}document.removeEventListener("visibilitychange",checkWarns)}if(!this._isDocReady){this._state.openDlg&&this._state.openDlg.close();var me=this,value;me._isDocReady=!0,Common.NotificationCenter.trigger("app:ready",this.appOptions),me.api.SetDrawingFreeze(!1),me.hidePreloader(),me.onLongActionEnd(Asc.c_oAscAsyncActionType.BlockInteraction,LoadingDocument),Common.Utils.InternalSettings.set("de-settings-datetime-default",Common.localStorage.getItem("de-settings-datetime-default")),this.isLiveCommenting=Common.localStorage.getBool("de-settings-livecomment",!0),Common.Utils.InternalSettings.set("de-settings-livecomment",this.isLiveCommenting),value=Common.localStorage.getBool("de-settings-resolvedcomment"),Common.Utils.InternalSettings.set("de-settings-resolvedcomment",value),this.isLiveCommenting?this.api.asc_showComments(value):this.api.asc_hideComments(),value=Common.localStorage.getItem("de-settings-zoom"),Common.Utils.InternalSettings.set("de-settings-zoom",value);var zf=null!==value?parseInt(value):this.appOptions.customization&&this.appOptions.customization.zoom?parseInt(this.appOptions.customization.zoom):100;switch(-1==zf?this.api.zoomFitToPage():-2==zf?this.api.zoomFitToWidth():this.api.zoom(zf>0?zf:100),value=Common.localStorage.getItem("de-show-hiddenchars"),me.api.put_ShowParaMarks(null!==value&&eval(value)),value=Common.localStorage.getItem("de-show-tableline"),me.api.put_ShowTableEmptyLine(null===value||eval(value)),value=Common.localStorage.getBool("de-settings-spellcheck",!(this.appOptions.customization&&!1===this.appOptions.customization.spellcheck)),Common.Utils.InternalSettings.set("de-settings-spellcheck",value),me.api.asc_setSpellCheck(value),value=Common.localStorage.getBool("de-settings-compatible",!1),Common.Utils.InternalSettings.set("de-settings-compatible",value),Common.Utils.InternalSettings.set("de-settings-showsnaplines",me.api.get_ShowSnapLines()),void 0!==document.hidden&&document.hidden?document.addEventListener("visibilitychange",checkWarns):checkWarns(),me.api.asc_registerCallback("asc_onStartAction",_.bind(me.onLongActionBegin,me)),me.api.asc_registerCallback("asc_onEndAction",_.bind(me.onLongActionEnd,me)),me.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(me.onCoAuthoringDisconnect,me)),me.api.asc_registerCallback("asc_onPrint",_.bind(me.onPrint,me)),appHeader.setDocumentCaption(me.api.asc_getDocumentName()),me.updateWindowTitle(!0),value=Common.localStorage.getBool("de-settings-inputmode"),Common.Utils.InternalSettings.set("de-settings-inputmode",value),me.api.SetTextBoxInputMode(value),me._state.fastCoauth=Common.Utils.InternalSettings.get("de-settings-coauthmode"),me.api.asc_SetFastCollaborative(me._state.fastCoauth),value=Common.Utils.InternalSettings.get(me._state.fastCoauth?"de-settings-showchanges-fast":"de-settings-showchanges-strict")){case"all":value=Asc.c_oAscCollaborativeMarksShowType.All;break;case"none":value=Asc.c_oAscCollaborativeMarksShowType.None;break;case"last":value=Asc.c_oAscCollaborativeMarksShowType.LastChanges;break;default:value=me._state.fastCoauth?Asc.c_oAscCollaborativeMarksShowType.None:Asc.c_oAscCollaborativeMarksShowType.LastChanges}me.api.SetCollaborativeMarksShowType(value),me.api.asc_setAutoSaveGap(Common.Utils.InternalSettings.get("de-settings-autosave")),me.api.asc_SetPerformContentControlActionByClick(me.appOptions.isRestrictedEdit&&me.appOptions.canFillForms);var application=me.getApplication(),toolbarController=application.getController("Toolbar"),statusbarController=application.getController("Statusbar"),documentHolderController=application.getController("DocumentHolder"),fontsController=application.getController("Common.Controllers.Fonts"),rightmenuController=application.getController("RightMenu"),leftmenuController=application.getController("LeftMenu"),chatController=application.getController("Common.Controllers.Chat"),pluginsController=application.getController("Common.Controllers.Plugins"),navigationController=application.getController("Navigation");if(leftmenuController.getView("LeftMenu").getMenu("file").loadDocument({doc:me.document}),leftmenuController.setMode(me.appOptions).createDelayedElements().setApi(me.api),navigationController.setApi(me.api).setMode(this.appOptions),chatController.setApi(this.api).setMode(this.appOptions),application.getController("Common.Controllers.ExternalDiagramEditor").setApi(this.api).loadConfig({config:this.editorConfig,customization:this.editorConfig.customization}),application.getController("Common.Controllers.ExternalMergeEditor").setApi(this.api).loadConfig({config:this.editorConfig,customization:this.editorConfig.customization}),pluginsController.setApi(me.api),documentHolderController.setApi(me.api),documentHolderController.createDelayedElements(),statusbarController.createDelayedElements(),leftmenuController.getView("LeftMenu").disableMenu("all",!1),me.appOptions.canBranding&&me.getApplication().getController("LeftMenu").leftMenu.getMenu("about").setLicInfo(me.editorConfig.customization),documentHolderController.getView().setApi(me.api).on("editcomplete",_.bind(me.onEditComplete,me)),me.appOptions.isEdit){me.appOptions.canForcesave&&(me.appOptions.forcesave=Common.localStorage.getBool("de-settings-forcesave",me.appOptions.canForcesave),Common.Utils.InternalSettings.set("de-settings-forcesave",me.appOptions.forcesave),me.api.asc_setIsForceSaveOnUserSave(me.appOptions.forcesave)),value=Common.localStorage.getItem("de-settings-paste-button"),null===value&&(value="1"),Common.Utils.InternalSettings.set("de-settings-paste-button",parseInt(value)),me.api.asc_setVisiblePasteButton(!!parseInt(value)),me.loadAutoCorrectSettings(),me.needToUpdateVersion&&Common.NotificationCenter.trigger("api:disconnect");var timer_sl=setInterval(function(){if(window.styles_loaded){clearInterval(timer_sl),toolbarController.createDelayedElements(),documentHolderController.getView().createDelayedElements(),me.setLanguages();var t=me.api.asc_getPropertyEditorShapes();t&&me.fillAutoShapes(t[0],t[1]),rightmenuController.createDelayedElements(),me.updateThemeColors(),toolbarController.activateControls(),me.needToUpdateVersion&&toolbarController.onApiCoAuthoringDisconnect(),me.api.UpdateInterfaceState(),Common.NotificationCenter.trigger("document:ready","main"),me.applyLicense()}},50)}else documentHolderController.getView().createDelayedElementsViewer(),Common.NotificationCenter.trigger("document:ready","main"),"view"!==me.editorConfig.mode&&me.applyLicense();var dummyClass=~~(1e6*Math.random());$(".toolbar").prepend(Common.Utils.String.format('<div class="lazy-{0} x-huge"><div class="toolbar__icon" style="position: absolute; width: 1px; height: 1px;"></div>',dummyClass)),setTimeout(function(){$(Common.Utils.String.format(".toolbar .lazy-{0}",dummyClass)).remove()},10),this.appOptions.canAnalytics,Common.Gateway.on("applyeditrights",_.bind(me.onApplyEditRights,me)),Common.Gateway.on("processsaveresult",_.bind(me.onProcessSaveResult,me)),Common.Gateway.on("processrightschange",_.bind(me.onProcessRightsChange,me)),Common.Gateway.on("processmouse",_.bind(me.onProcessMouse,me)),Common.Gateway.on("refreshhistory",_.bind(me.onRefreshHistory,me)),Common.Gateway.on("downloadas",_.bind(me.onDownloadAs,me)),Common.Gateway.on("setfavorite",_.bind(me.onSetFavorite,me)),Common.Gateway.on("requestclose",_.bind(me.onRequestClose,me)),Common.Gateway.sendInfo({mode:me.appOptions.isEdit?"edit":"view"}),$(document).on("contextmenu",_.bind(me.onContextMenu,me)),Common.Gateway.documentReady(),$("#editor-container").css("overflow",""),$(".doc-placeholder").remove(),this.appOptions.user.guest&&this.appOptions.canRenameAnonymous&&null===Common.Utils.InternalSettings.get("guest-username")&&this.showRenameUserDialog()}},onLicenseChanged:function(t){var e=t.asc_getLicenseType();void 0!==e&&this.appOptions.canEdit&&"view"!==this.editorConfig.mode&&(e===Asc.c_oLicenseResult.Connections||e===Asc.c_oLicenseResult.UsersCount||e===Asc.c_oLicenseResult.ConnectionsOS||e===Asc.c_oLicenseResult.UsersCountOS||e===Asc.c_oLicenseResult.SuccessLimit&&0!=(this.appOptions.trialMode&Asc.c_oLicenseMode.Limited))&&(this._state.licenseType=e),this._isDocReady&&this.applyLicense()},applyLicense:function(){},onOpenDocument:function(t){var e=document.getElementById("loadmask-text"),i=(t.asc_getCurrentFont()+t.asc_getCurrentImage())/(t.asc_getFontsCount()+t.asc_getImagesCount());i=this.textLoadingDocument+": "+Common.Utils.String.fixedDigits(Math.min(Math.round(100*i),100),3,"  ")+"%",e?e.innerHTML=i:this.loadMask&&this.loadMask.setTitle(i)},onEditorPermissions:function(t){var e=t.asc_getLicenseType();if(!this.onServerVersion(t.asc_getBuildVersion())&&this.onLanguageLoaded()){this.permissions.review=void 0===this.permissions.review?!1!==this.permissions.edit:this.permissions.review,t.asc_getRights()!==Asc.c_oRights.Edit&&(this.permissions.edit=this.permissions.review=!1),this.appOptions.permissionsLicense=e,this.appOptions.canAnalytics=t.asc_getIsAnalyticsEnable(),this.appOptions.canLicense=e===Asc.c_oLicenseResult.Success||e===Asc.c_oLicenseResult.SuccessLimit,this.appOptions.isLightVersion=t.asc_getIsLight(),this.appOptions.canCoAuthoring=!this.appOptions.isLightVersion,this.appOptions.isOffline=this.api.asc_isOffline(),this.appOptions.isCrypted=this.api.asc_isCrypto(),this.appOptions.isReviewOnly=!0===this.permissions.review&&!1===this.permissions.edit,this.appOptions.canRequestEditRights=this.editorConfig.canRequestEditRights,this.appOptions.canEdit=(!1!==this.permissions.edit||!0===this.permissions.review)&&(this.editorConfig.canRequestEditRights||"view"!==this.editorConfig.mode)&&(!this.appOptions.isReviewOnly||this.appOptions.canLicense),this.appOptions.isEdit=this.appOptions.canLicense&&this.appOptions.canEdit&&"view"!==this.editorConfig.mode,this.appOptions.canReview=!0===this.permissions.review&&this.appOptions.canLicense&&this.appOptions.isEdit,this.appOptions.canViewReview=!0,this.appOptions.canUseHistory=this.appOptions.canLicense&&this.editorConfig.canUseHistory&&this.appOptions.canCoAuthoring&&!this.appOptions.isOffline,this.appOptions.canHistoryClose=this.editorConfig.canHistoryClose,this.appOptions.canHistoryRestore=this.editorConfig.canHistoryRestore,
this.appOptions.canUseMailMerge=this.appOptions.canLicense&&this.appOptions.canEdit&&!this.appOptions.isOffline,this.appOptions.canSendEmailAddresses=this.appOptions.canLicense&&this.editorConfig.canSendEmailAddresses&&this.appOptions.canEdit&&this.appOptions.canCoAuthoring,this.appOptions.canComments=this.appOptions.canLicense&&(void 0===this.permissions.comment?this.appOptions.isEdit:this.permissions.comment)&&"view"!==this.editorConfig.mode,this.appOptions.canComments=this.appOptions.canComments&&!("object"==typeof this.editorConfig.customization&&!1===this.editorConfig.customization.comments),this.appOptions.canViewComments=this.appOptions.canComments||!("object"==typeof this.editorConfig.customization&&!1===this.editorConfig.customization.comments),this.appOptions.canChat=this.appOptions.canLicense&&!this.appOptions.isOffline&&!("object"==typeof this.editorConfig.customization&&!1===this.editorConfig.customization.chat),this.appOptions.canEditStyles=this.appOptions.canLicense&&this.appOptions.canEdit,this.appOptions.canPrint=!1!==this.permissions.print,this.appOptions.canRename=this.editorConfig.canRename,this.appOptions.buildVersion=t.asc_getBuildVersion(),this.appOptions.canForcesave=this.appOptions.isEdit&&!this.appOptions.isOffline&&"object"==typeof this.editorConfig.customization&&!!this.editorConfig.customization.forcesave,this.appOptions.forcesave=this.appOptions.canForcesave,this.appOptions.canEditComments=this.appOptions.isOffline||!this.permissions.editCommentAuthorOnly,this.appOptions.canDeleteComments=this.appOptions.isOffline||!this.permissions.deleteCommentAuthorOnly,"object"==typeof this.editorConfig.customization&&!0===this.editorConfig.customization.commentAuthorOnly&&(console.log("Obsolete: The 'commentAuthorOnly' parameter of the 'customization' section is deprecated. Please use 'editCommentAuthorOnly' and 'deleteCommentAuthorOnly' parameters in the permissions instead."),void 0===this.permissions.editCommentAuthorOnly&&void 0===this.permissions.deleteCommentAuthorOnly&&(this.appOptions.canEditComments=this.appOptions.canDeleteComments=this.appOptions.isOffline)),this.appOptions.trialMode=t.asc_getLicenseMode(),this.appOptions.isBeta=t.asc_getIsBeta(),this.appOptions.isSignatureSupport=this.appOptions.isEdit&&this.appOptions.isDesktopApp&&this.appOptions.isOffline&&this.api.asc_isSignaturesSupport(),this.appOptions.isPasswordSupport=this.appOptions.isEdit&&this.api.asc_isProtectionSupport(),this.appOptions.canProtect=this.appOptions.isSignatureSupport||this.appOptions.isPasswordSupport,this.appOptions.canEditContentControl=!1!==this.permissions.modifyContentControl,this.appOptions.canHelp=!("object"==typeof this.editorConfig.customization&&!1===this.editorConfig.customization.help),this.appOptions.canSubmitForms=this.appOptions.canLicense&&"object"==typeof this.editorConfig.customization&&!!this.editorConfig.customization.submitForm,this.appOptions.canFillForms=this.appOptions.canLicense&&(void 0===this.permissions.fillForms?this.appOptions.isEdit:this.permissions.fillForms)&&"view"!==this.editorConfig.mode,this.appOptions.isRestrictedEdit=!this.appOptions.isEdit&&(this.appOptions.canComments||this.appOptions.canFillForms),this.appOptions.isRestrictedEdit&&this.appOptions.canComments&&this.appOptions.canFillForms&&(this.appOptions.canComments=!1),this.appOptions.isLightVersion&&(this.appOptions.canUseHistory=this.appOptions.canReview=this.appOptions.isReviewOnly=!1),this.appOptions.canCoAuthoring||(this.appOptions.canChat=!1);var i=/^(?:(pdf|djvu|xps|oxps))$/.exec(this.document.fileType);this.appOptions.canDownloadOrigin=!1!==this.permissions.download&&i&&"string"==typeof i[1],this.appOptions.canDownload=!1!==this.permissions.download&&(!i||"string"!=typeof i[1]),this.appOptions.fileKey=this.document.key,this.appOptions.canBranding=t.asc_getCustomization(),this.appOptions.canBranding&&appHeader.setBranding(this.editorConfig.customization),this.appOptions.canFavorite=this.document.info&&void 0!==this.document.info.favorite&&null!==this.document.info.favorite&&!this.appOptions.isOffline,this.appOptions.canFavorite&&appHeader.setFavorite(this.document.info.favorite),this.appOptions.canUseReviewPermissions=this.appOptions.canLicense&&(!!this.permissions.reviewGroups||this.editorConfig.customization&&this.editorConfig.customization.reviewPermissions&&"object"==typeof this.editorConfig.customization.reviewPermissions),this.appOptions.canUseCommentPermissions=this.appOptions.canLicense&&!!this.permissions.commentGroups,AscCommon.UserInfoParser.setParser(!0),AscCommon.UserInfoParser.setCurrentName(this.appOptions.user.fullname),this.appOptions.canUseReviewPermissions&&AscCommon.UserInfoParser.setReviewPermissions(this.permissions.reviewGroups,this.editorConfig.customization.reviewPermissions),this.appOptions.canUseCommentPermissions&&AscCommon.UserInfoParser.setCommentPermissions(this.permissions.commentGroups),appHeader.setUserName(AscCommon.UserInfoParser.getParsedName(AscCommon.UserInfoParser.getCurrentName())),this.appOptions.canRename&&appHeader.setCanRename(!0),this.appOptions.canBrandingExt=t.asc_getCanBranding()&&("object"==typeof this.editorConfig.customization||this.editorConfig.plugins),this.getApplication().getController("Common.Controllers.Plugins").setMode(this.appOptions,this.api),this.appOptions.canComments&&Common.NotificationCenter.on("comments:cleardummy",_.bind(this.onClearDummyComment,this)),Common.NotificationCenter.on("comments:showdummy",_.bind(this.onShowDummyComment,this)),this.appOptions.canChangeCoAuthoring=this.appOptions.isEdit&&this.appOptions.canCoAuthoring&&!("object"==typeof this.editorConfig.coEditing&&!1===this.editorConfig.coEditing.change),this.loadCoAuthSettings(),this.applyModeCommonElements(),this.applyModeEditorElements(),this.appOptions.isEdit||(Common.NotificationCenter.trigger("app:face",this.appOptions),this.hidePreloader(),this.onLongActionBegin(Asc.c_oAscAsyncActionType.BlockInteraction,LoadingDocument)),this.api.asc_setViewMode(!this.appOptions.isEdit&&!this.appOptions.isRestrictedEdit),this.appOptions.isRestrictedEdit&&this.appOptions.canComments&&this.api.asc_setRestriction(Asc.c_oAscRestrictionType.OnlyComments),this.appOptions.isRestrictedEdit&&this.appOptions.canFillForms&&this.api.asc_setRestriction(Asc.c_oAscRestrictionType.OnlyForms),this.appOptions.isRestrictedEdit&&this.appOptions.canFillForms&&this.api.asc_SetHighlightRequiredFields(!0),this.api.asc_LoadDocument()}},loadCoAuthSettings:function(){var t,e=!0,i=1;this.appOptions.isEdit&&!this.appOptions.isOffline&&this.appOptions.canCoAuthoring?(this.appOptions.canChangeCoAuthoring?null===(t=Common.localStorage.getItem("de-settings-coauthmode"))&&null===(t=this.editorConfig.coEditing&&void 0!==this.editorConfig.coEditing.mode?"strict"===this.editorConfig.coEditing.mode?0:1:null)&&!Common.localStorage.itemExists("de-settings-autosave")&&this.appOptions.customization&&!1===this.appOptions.customization.autosave&&(t=0):null===(t=this.editorConfig.coEditing&&void 0!==this.editorConfig.coEditing.mode?"strict"===this.editorConfig.coEditing.mode?0:1:null)&&this.appOptions.customization&&!1===this.appOptions.customization.autosave&&(t=0),e=null===t||1==parseInt(t),t=Common.localStorage.getItem(e?"de-settings-showchanges-fast":"de-settings-showchanges-strict"),null==t&&(t=e?"none":"last"),Common.Utils.InternalSettings.set(e?"de-settings-showchanges-fast":"de-settings-showchanges-strict",t)):!this.appOptions.isEdit&&this.appOptions.isRestrictedEdit?e=!0:(e=!1,i=0),this.appOptions.isEdit&&(t=Common.localStorage.getItem("de-settings-autosave"),null===t&&this.appOptions.customization&&!1===this.appOptions.customization.autosave&&(t=0),i=e||null===t?this.appOptions.canCoAuthoring?1:0:parseInt(t)),Common.Utils.InternalSettings.set("de-settings-coauthmode",e),Common.Utils.InternalSettings.set("de-settings-autosave",i)},applyModeCommonElements:function(){window.editor_elements_prepared=!0;var t=this.getApplication(),e=t.getController("Viewport").getView("Viewport"),i=t.getController("Statusbar").getView("Statusbar"),n=t.getController("DocumentHolder").getView(),o=t.getController("Toolbar");e&&e.setMode(this.appOptions),i&&i.setMode(this.appOptions),o.setMode(this.appOptions),n.setMode(this.appOptions),this.api.asc_registerCallback("asc_onSendThemeColors",_.bind(this.onSendThemeColors,this)),this.api.asc_registerCallback("asc_onDownloadUrl",_.bind(this.onDownloadUrl,this)),this.api.asc_registerCallback("asc_onAuthParticipantsChanged",_.bind(this.onAuthParticipantsChanged,this)),this.api.asc_registerCallback("asc_onParticipantsChanged",_.bind(this.onAuthParticipantsChanged,this)),this.api.asc_registerCallback("asc_onConnectionStateChanged",_.bind(this.onUserConnection,this)),this.api.asc_registerCallback("asc_onDocumentModifiedChanged",_.bind(this.onDocumentModifiedChanged,this))},applyModeEditorElements:function(){this.contComments.setMode(this.appOptions),this.contComments.setConfig({config:this.editorConfig},this.api);var t=this,e=this.getApplication();if(e.getController("Common.Controllers.ReviewChanges").setMode(t.appOptions).setConfig({config:t.editorConfig},t.api).loadDocument({doc:t.document}),this.appOptions.isEdit||this.appOptions.isRestrictedEdit){var i=e.getController("Toolbar");if(i&&i.setApi(t.api),!this.appOptions.isEdit)return;var n=e.getController("RightMenu"),o=e.getController("Common.Controllers.Fonts");o&&o.setApi(t.api),n&&n.setApi(t.api),this.appOptions.canProtect&&e.getController("Common.Controllers.Protection").setMode(t.appOptions).setConfig({config:t.editorConfig},t.api),this.getApplication().getController("Viewport").getView("Viewport").applyEditorMode();var s=n.getView("RightMenu");s&&(s.setApi(t.api),s.on("editcomplete",_.bind(t.onEditComplete,t)),s.setMode(t.appOptions));var a=i?i.getView():null;a&&(a.setApi(t.api),a.on("editcomplete",_.bind(t.onEditComplete,t)),a.on("insertimage",_.bind(t.onInsertImage,t)),a.on("inserttable",_.bind(t.onInsertTable,t)),a.on("insertshape",_.bind(t.onInsertShape,t)),a.on("inserttextart",_.bind(t.onInsertTextArt,t)),a.on("insertchart",_.bind(t.onInsertChart,t)),a.on("insertcontrol",_.bind(t.onInsertControl,t)));var r=Common.localStorage.getItem("de-settings-unit");r=null!==r?parseInt(r):this.appOptions.customization&&this.appOptions.customization.unit?Common.Utils.Metric.c_MetricUnits[this.appOptions.customization.unit.toLocaleLowerCase()]:Common.Utils.Metric.getDefaultMetric(),void 0===r&&(r=Common.Utils.Metric.getDefaultMetric()),Common.Utils.Metric.setCurrentMetric(r),Common.Utils.InternalSettings.set("de-settings-unit",r),t.api.asc_SetDocumentUnits(r==Common.Utils.Metric.c_MetricUnits.inch?Asc.c_oAscDocumentUnits.Inch:r==Common.Utils.Metric.c_MetricUnits.pt?Asc.c_oAscDocumentUnits.Point:Asc.c_oAscDocumentUnits.Millimeter),r=Common.localStorage.itemExists("de-hidden-rulers")?Common.localStorage.getBool("de-hidden-rulers"):this.appOptions.customization&&!!this.appOptions.customization.hideRulers,Common.Utils.InternalSettings.set("de-hidden-rulers",r),t.api.asc_SetViewRulers(!r),t.api.asc_registerCallback("asc_onDocumentCanSaveChanged",_.bind(t.onDocumentCanSaveChanged,t)),t.api.asc_registerCallback("asc_onCollaborativeChanges",_.bind(t.onCollaborativeChanges,t)),t.api.asc_registerCallback("asc_OnTryUndoInFastCollaborative",_.bind(t.onTryUndoInFastCollaborative,t)),t.api.asc_registerCallback("asc_onConvertEquationToMath",_.bind(t.onConvertEquationToMath,t)),t.stackLongActions.exist({id:ApplyEditRights,type:Asc.c_oAscAsyncActionType.BlockInteraction})?t.onLongActionEnd(Asc.c_oAscAsyncActionType.BlockInteraction,ApplyEditRights):this._isDocReady||(Common.NotificationCenter.trigger("app:face",t.appOptions),t.hidePreloader(),t.onLongActionBegin(Asc.c_oAscAsyncActionType.BlockInteraction,LoadingDocument)),window.onbeforeunload=_.bind(t.onBeforeUnload,t),window.onunload=_.bind(t.onUnload,t)}},onExternalMessage:function(t){t&&t.msg&&(t.msg=t.msg.toString(),this.showTips([t.msg.charAt(0).toUpperCase()+t.msg.substring(1)]),Common.component.Analytics.trackEvent("External Error"))},onError:function(t,e,i){if(t==Asc.c_oAscError.ID.LoadingScriptError)return this.showTips([this.scriptLoadError]),void(this.tooltip&&this.tooltip.getBSTip().$tip.css("z-index",1e4));this.hidePreloader(),this.onLongActionEnd(Asc.c_oAscAsyncActionType.BlockInteraction,LoadingDocument);var n={closable:!0};switch(t){case Asc.c_oAscError.ID.Unknown:n.msg=this.unknownErrorText;break;case Asc.c_oAscError.ID.ConvertationTimeout:n.msg=this.convertationTimeoutText;break;case Asc.c_oAscError.ID.ConvertationOpenError:n.msg=this.openErrorText;break;case Asc.c_oAscError.ID.ConvertationSaveError:n.msg=this.appOptions.isDesktopApp&&this.appOptions.isOffline?this.saveErrorTextDesktop:this.saveErrorText;break;case Asc.c_oAscError.ID.DownloadError:n.msg=this.downloadErrorText;break;case Asc.c_oAscError.ID.UplImageSize:n.msg=this.uploadImageSizeMessage;break;case Asc.c_oAscError.ID.UplImageExt:n.msg=this.uploadImageExtMessage;break;case Asc.c_oAscError.ID.UplImageFileCount:n.msg=this.uploadImageFileCountMessage;break;case Asc.c_oAscError.ID.UplDocumentSize:n.msg=this.uploadDocSizeMessage;break;case Asc.c_oAscError.ID.UplDocumentExt:n.msg=this.uploadDocExtMessage;break;case Asc.c_oAscError.ID.UplDocumentFileCount:n.msg=this.uploadDocFileCountMessage;break;case Asc.c_oAscError.ID.SplitCellMaxRows:n.msg=this.splitMaxRowsErrorText.replace("%1",i.get_Value());break;case Asc.c_oAscError.ID.SplitCellMaxCols:n.msg=this.splitMaxColsErrorText.replace("%1",i.get_Value());break;case Asc.c_oAscError.ID.SplitCellRowsDivider:n.msg=this.splitDividerErrorText.replace("%1",i.get_Value());break;case Asc.c_oAscError.ID.VKeyEncrypt:n.msg=this.errorToken;break;case Asc.c_oAscError.ID.KeyExpire:n.msg=this.errorTokenExpire;break;case Asc.c_oAscError.ID.UserCountExceed:n.msg=this.errorUsersExceed;break;case Asc.c_oAscError.ID.CoAuthoringDisconnect:n.msg=this.errorViewerDisconnect;break;case Asc.c_oAscError.ID.ConvertationPassword:n.msg=this.errorFilePassProtect;break;case Asc.c_oAscError.ID.StockChartError:n.msg=this.errorStockChart;break;case Asc.c_oAscError.ID.DataRangeError:n.msg=this.errorDataRange;break;case Asc.c_oAscError.ID.Database:n.msg=this.errorDatabaseConnection;break;case Asc.c_oAscError.ID.UserDrop:if(this._state.lostEditingRights)return void(this._state.lostEditingRights=!1);this._state.lostEditingRights=!0,n.msg=this.errorUserDrop,Common.NotificationCenter.trigger("collaboration:sharingdeny");break;case Asc.c_oAscError.ID.MailMergeLoadFile:n.msg=this.errorMailMergeLoadFile;break;case Asc.c_oAscError.ID.MailMergeSaveFile:n.msg=this.errorMailMergeSaveFile;break;case Asc.c_oAscError.ID.Warning:n.msg=this.errorConnectToServer,n.closable=!1;break;case Asc.c_oAscError.ID.SessionAbsolute:n.msg=this.errorSessionAbsolute;break;case Asc.c_oAscError.ID.SessionIdle:n.msg=this.errorSessionIdle;break;case Asc.c_oAscError.ID.SessionToken:n.msg=this.errorSessionToken;break;case Asc.c_oAscError.ID.AccessDeny:n.msg=this.errorAccessDeny;break;case Asc.c_oAscError.ID.UplImageUrl:n.msg=this.errorBadImageUrl;break;case Asc.c_oAscError.ID.ForceSaveButton:case Asc.c_oAscError.ID.ForceSaveTimeout:n.msg=this.errorForceSave,n.maxwidth=600;break;case Asc.c_oAscError.ID.DataEncrypted:n.msg=this.errorDataEncrypted;break;case Asc.c_oAscError.ID.EditingError:n.msg=this.appOptions.isDesktopApp&&this.appOptions.isOffline?this.errorEditingSaveas:this.errorEditingDownloadas;break;case Asc.c_oAscError.ID.MailToClientMissing:n.msg=this.errorEmailClient;break;case Asc.c_oAscError.ID.ConvertationOpenLimitError:n.msg=this.errorFileSizeExceed;break;case Asc.c_oAscError.ID.UpdateVersion:n.msg=this.errorUpdateVersionOnDisconnect,n.maxwidth=600;break;case Asc.c_oAscError.ID.DirectUrl:n.msg=this.errorDirectUrl;break;case Asc.c_oAscError.ID.CannotCompareInCoEditing:n.msg=this.errorCompare;break;case Asc.c_oAscError.ID.ComboSeriesError:n.msg=this.errorComboSeries;break;case Asc.c_oAscError.ID.Password:n.msg=this.errorSetPassword;break;case Asc.c_oAscError.ID.Submit:n.msg=this.errorSubmit;break;case Asc.c_oAscError.ID.LoadingFontError:n.msg=this.errorLoadingFont;break;default:n.msg="string"==typeof t?t:this.errorDefaultMessage.replace("%1",t)}e==Asc.c_oAscError.Level.Critical?(Common.Gateway.reportError(t,n.msg),n.title=this.criticalErrorTitle,n.iconCls="error",n.closable=!1,this.appOptions.canBackToFolder&&!this.appOptions.isDesktopApp&&"string"!=typeof t&&(n.msg+="<br><br>"+this.criticalErrorExtText,n.callback=function(t){"ok"==t&&Common.NotificationCenter.trigger("goback",!0)}),t==Asc.c_oAscError.ID.DataEncrypted&&(this.api.asc_coAuthoringDisconnect(),Common.NotificationCenter.trigger("api:disconnect"))):(Common.Gateway.reportWarning(t,n.msg),n.title=this.notcriticalErrorTitle,n.iconCls="warn",n.buttons=["ok"],n.callback=_.bind(function(e){if(t==Asc.c_oAscError.ID.Warning&&"ok"==e&&(this.appOptions.canDownload||this.appOptions.canDownloadOrigin))Common.UI.Menu.Manager.hideAll(),this.appOptions.isDesktopApp&&this.appOptions.isOffline?this.api.asc_DownloadAs():this.appOptions.canDownload?this.getApplication().getController("LeftMenu").leftMenu.showMenu("file:saveas"):this.api.asc_DownloadOrigin();else if(t==Asc.c_oAscError.ID.SplitCellMaxRows||t==Asc.c_oAscError.ID.SplitCellMaxCols||t==Asc.c_oAscError.ID.SplitCellRowsDivider){var i=this;setTimeout(function(){new Common.Views.InsertTableDialog({split:!0,handler:function(t,e){"ok"==t&&i.api&&i.api.SplitCell(e.columns,e.rows),i.onEditComplete()}}).show()},10)}else t==Asc.c_oAscError.ID.EditingError&&(this.disableEditing(!0),Common.NotificationCenter.trigger("api:disconnect",!0));this._state.lostEditingRights=!1,this.onEditComplete()},this)),(!Common.Utils.ModalWindow.isVisible()||$(".asc-window.modal.alert[data-value="+t+"]").length<1)&&Common.UI.alert(n).$window.attr("data-value",t),void 0!==t&&Common.component.Analytics.trackEvent("Internal Error",t.toString())},onCoAuthoringDisconnect:function(){this.getApplication().getController("Viewport").getView("Viewport").setMode({isDisconnected:!0}),appHeader.setCanRename(!1),this.appOptions.canRename=!1,this._state.isDisconnected=!0},showTips:function(t){function e(){var e=t.shift();e&&(e+="\n"+i.textCloseTip,n.setTitle(e),n.show())}var i=this;if(t.length){"object"!=typeof t&&(t=[t]),this.tooltip||(this.tooltip=new Common.UI.Tooltip({owner:this.getApplication().getController("Toolbar").getView(),hideonclick:!0,placement:"bottom",cls:"main-info",offset:30}));var n=this.tooltip;n.on("tooltip:hide",function(){setTimeout(e,300)}),e()}},updateWindowTitle:function(t){var e=this.api.isDocumentModified();if(this._state.isDocModified!==e||t){var i=this.defaultTitleText;appHeader&&!_.isEmpty(appHeader.getDocumentCaption())&&(i=appHeader.getDocumentCaption()+" - "+i),e&&(clearTimeout(this._state.timerCaption),_.isUndefined(i)||(i="* "+i)),window.document.title!=i&&(window.document.title=i),this._isDocReady&&this._state.isDocModified!==e&&Common.Gateway.setDocumentModified(e),e&&(!this._state.fastCoauth||this._state.usersCount<2)&&this.getApplication().getController("Statusbar").setStatusCaption("",!0),this._state.isDocModified=e}},onDocumentModifiedChanged:function(){var t=this.api.asc_isDocumentCanSave();this._state.isDocModified!==t&&this._isDocReady&&Common.Gateway.setDocumentModified(this.api.isDocumentModified()),this.updateWindowTitle();var e=this.getApplication().getController("Toolbar").getView();if(e&&e.btnCollabChanges&&!e._state.previewmode){var i=e.btnCollabChanges.cmpEl.hasClass("notify"),n=this.appOptions.forcesave,o=!t&&!i&&!n||this._state.isDisconnected||this._state.fastCoauth&&this._state.usersCount>1&&!n;e.btnSave.setDisabled(o)}!this.contComments.isDummyComment||this.dontCloseDummyComment||this.beforeShowDummyComment||this.contComments.clearDummyComment()},onDocumentCanSaveChanged:function(t){var e=this.getApplication().getController("Toolbar").getView();if(e&&this.api&&!e._state.previewmode){var i=e.btnCollabChanges.cmpEl.hasClass("notify"),n=this.appOptions.forcesave,o=!t&&!i&&!n||this._state.isDisconnected||this._state.fastCoauth&&this._state.usersCount>1&&!n;e.btnSave.setDisabled(o)}},onContextMenu:function(t){var e=t.target.getAttribute("data-can-copy"),i=t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement;if(i&&"false"===e||!i&&"true"!==e)return t.stopPropagation(),t.preventDefault(),!1},onBeforeUnload:function(){if(Common.localStorage.save(),this.api.isDocumentModified()){var t=this;return this.api.asc_stopSaving(),this.continueSavingTimer=window.setTimeout(function(){t.api.asc_continueSaving()},500),this.leavePageText}},onUnload:function(){this.continueSavingTimer&&clearTimeout(this.continueSavingTimer)},hidePreloader:function(){var t;this._state.customizationDone||(this._state.customizationDone=!0,this.appOptions.customization&&(this.appOptions.isDesktopApp?this.appOptions.customization.about=!1:this.appOptions.canBrandingExt||(this.appOptions.customization.about=!0)),Common.Utils.applyCustomization(this.appOptions.customization,mapCustomizationElements),this.appOptions.canBrandingExt&&(Common.Utils.applyCustomization(this.appOptions.customization,mapCustomizationExtElements),t=this.getApplication().getController("Common.Controllers.Plugins").applyUICustomization())),Common.NotificationCenter.trigger("layout:changed","main"),(t||new Promise(function(t,e){t()})).then(function(){$("#loading-mask").hide().remove(),Common.Controllers.Desktop.process("preloader:hide")})},onDownloadUrl:function(t){this._state.isFromGatewayDownloadAs&&Common.Gateway.downloadAs(t),this._state.isFromGatewayDownloadAs=!1},onUpdateVersion:function(t){var e=this;e.needToUpdateVersion=!0,e.onLongActionEnd(Asc.c_oAscAsyncActionType.BlockInteraction,LoadingDocument),Common.UI.warning({title:e.titleUpdateVersion,msg:this.errorUpdateVersion,callback:function(){_.defer(function(){Common.Gateway.updateVersion(),t&&t.call(e),e.onLongActionBegin(Asc.c_oAscAsyncActionType.BlockInteraction,LoadingDocument)})}})},onServerVersion:function(t){return!1},onCollaborativeChanges:function(){this._state.hasCollaborativeChanges||(this._state.hasCollaborativeChanges=!0,this.appOptions.isEdit&&this.getApplication().getController("Statusbar").setStatusCaption(this.txtNeedSynchronize,!0))},synchronizeChanges:function(){this.getApplication().getController("Statusbar").synchronizeChanges(),this.getApplication().getController("Common.Controllers.ReviewChanges").synchronizeChanges(),this.getApplication().getController("DocumentHolder").getView().hideTips(),this.getApplication().getController("Toolbar").getView().synchronizeChanges(),this._state.hasCollaborativeChanges=!1},initNames:function(){this.shapeGroupNames=[this.txtBasicShapes,this.txtFiguredArrows,this.txtMath,this.txtCharts,this.txtStarsRibbons,this.txtCallouts,this.txtButtons,this.txtRectangles,this.txtLines]},fillAutoShapes:function(t,e){if(!_.isEmpty(e)&&!_.isEmpty(t)&&e.length==t.length){var i=this,n=[],o=this.getCollection("ShapeGroups");o.reset(),_.each(t,function(t,o){var s=new Backbone.Collection([],{model:DE.Models.ShapeModel}),a=[],r=e[o].length>18?7:6,l=35*Math.ceil(e[o].length/r)+3,c=30*r;_.each(e[o],function(t,e){a.push({data:{shapeType:t.Type},tip:i["txtShape_"+t.Type]||i.textShape+" "+(e+1),allowSelected:!0,selected:!1})}),s.add(a),n.push({groupName:i.shapeGroupNames[o],groupStore:s,groupWidth:c,groupHeight:l})}),o.add(n),setTimeout(function(){i.getApplication().getController("Toolbar").onApiAutoShapes()},50)}},fillTextArt:function(t){var e=[],i=this.getCollection("Common.Collections.TextArt");!t&&i.length>0&&(t=this.api.asc_getTextArtPreviews()),_.isEmpty(t)||(_.each(t,function(t,i){e.push({imageUrl:t,data:i,allowSelected:!0,selected:!1})}),i.reset(e))},updateThemeColors:function(){var t=this;setTimeout(function(){t.getApplication().getController("RightMenu").UpdateThemeColors()},50),setTimeout(function(){t.getApplication().getController("Toolbar").updateThemeColors()},50)},onSendThemeColors:function(t,e){if(Common.Utils.ThemeColor.setColors(t,e),window.styles_loaded){this.updateThemeColors();var i=this;setTimeout(function(){i.fillTextArt()},1)}},loadLanguages:function(t){var e,i=[],n=Common.util.LanguageInfo.getLanguages();for(var o in n)n.hasOwnProperty(o)&&(e=n[o],e[2]&&i.push({displayValue:e[1],value:e[0],code:parseInt(o),spellcheck:_.indexOf(t,o)>-1}));i.sort(function(t,e){return t.value<e.value?-1:t.value>e.value?1:0}),this.languages=i,window.styles_loaded&&this.setLanguages()},setLanguages:function(){(!this.languages||this.languages.length<1)&&this.loadLanguages([]),this.languages&&this.languages.length>0&&(this.getApplication().getController("DocumentHolder").getView().setLanguages(this.languages),this.getApplication().getController("Statusbar").setLanguages(this.languages),this.getApplication().getController("Common.Controllers.ReviewChanges").setLanguages(this.languages))},onInsertTable:function(){this.getApplication().getController("RightMenu").onInsertTable()},onInsertImage:function(){this.getApplication().getController("RightMenu").onInsertImage()},onInsertChart:function(){this.getApplication().getController("RightMenu").onInsertChart()},onInsertShape:function(){this.getApplication().getController("RightMenu").onInsertShape()},onInsertTextArt:function(){this.getApplication().getController("RightMenu").onInsertTextArt()},onInsertControl:function(){this.getApplication().getController("RightMenu").onInsertControl()},unitsChanged:function(t){var e=Common.localStorage.getItem("de-settings-unit");e=null!==e?parseInt(e):Common.Utils.Metric.getDefaultMetric(),Common.Utils.Metric.setCurrentMetric(e),Common.Utils.InternalSettings.set("de-settings-unit",e),this.api.asc_SetDocumentUnits(e==Common.Utils.Metric.c_MetricUnits.inch?Asc.c_oAscDocumentUnits.Inch:e==Common.Utils.Metric.c_MetricUnits.pt?Asc.c_oAscDocumentUnits.Point:Asc.c_oAscDocumentUnits.Millimeter),this.getApplication().getController("RightMenu").updateMetricUnit(),this.getApplication().getController("Toolbar").getView().updateMetricUnit()},onAdvancedOptions:function(t,e,i,n){if(!this._state.openDlg){var o=this;t==Asc.c_oAscAdvancedOptionsID.TXT?o._state.openDlg=new Common.Views.OpenDialog({title:Common.Views.OpenDialog.prototype.txtTitle.replace("%1","TXT"),closable:2==i,type:Common.Utils.importTextType.TXT,preview:e.asc_getData(),codepages:e.asc_getCodePages(),settings:e.asc_getRecommendedSettings(),api:o.api,handler:function(e,s){o.isShowOpenDialog=!1,"ok"==e&&o&&o.api&&(2==i?(n&&n.asc_setAdvancedOptions(s.textOptions),o.api.asc_DownloadAs(n)):o.api.asc_setAdvancedOptions(t,s.textOptions),o.loadMask&&o.loadMask.show()),o._state.openDlg=null}}):t==Asc.c_oAscAdvancedOptionsID.DRM&&(o._state.openDlg=new Common.Views.OpenDialog({title:Common.Views.OpenDialog.prototype.txtTitleProtected,closeFile:o.appOptions.canRequestClose,type:Common.Utils.importTextType.DRM,warning:!(o.appOptions.isDesktopApp&&o.appOptions.isOffline)&&"string"==typeof e,warningMsg:e,validatePwd:!!o._state.isDRM,handler:function(e,i){o.isShowOpenDialog=!1,"ok"==e?o.api&&(o.api.asc_setAdvancedOptions(t,i.drmOptions),o.loadMask&&o.loadMask.show()):(Common.Gateway.requestClose(),Common.Controllers.Desktop.requestClose()),o._state.openDlg=null}}),o._state.isDRM=!0),o._state.openDlg&&(this.isShowOpenDialog=!0,this.loadMask&&this.loadMask.hide(),this.onLongActionEnd(Asc.c_oAscAsyncActionType.BlockInteraction,LoadingDocument),o._state.openDlg.show())}},onTryUndoInFastCollaborative:function(){Common.localStorage.getBool("de-hide-try-undoredo")||Common.UI.info({width:500,msg:this.appOptions.canChangeCoAuthoring?this.textTryUndoRedo:this.textTryUndoRedoWarn,iconCls:"info",buttons:this.appOptions.canChangeCoAuthoring?["custom","cancel"]:["ok"],primary:this.appOptions.canChangeCoAuthoring?"custom":"ok",customButtonText:this.textStrict,dontshow:!0,callback:_.bind(function(t,e){e&&Common.localStorage.setItem("de-hide-try-undoredo",1),"custom"==t&&(Common.localStorage.setItem("de-settings-coauthmode",0),Common.Utils.InternalSettings.set("de-settings-coauthmode",!1),this.api.asc_SetFastCollaborative(!1),this._state.fastCoauth=!1,Common.localStorage.setItem("de-settings-showchanges-strict","last"),this.api.SetCollaborativeMarksShowType(Asc.c_oAscCollaborativeMarksShowType.LastChanges),this.getApplication().getController("Common.Controllers.ReviewChanges").applySettings()),this.onEditComplete()},this)})},onAuthParticipantsChanged:function(t){var e=0;_.each(t,function(t){t.asc_getView()||e++}),this._state.usersCount=e},onUserConnection:function(t){if(t&&this.appOptions.user.guest&&this.appOptions.canRenameAnonymous&&t.asc_getIdOriginal()==this.appOptions.user.id){var e=t.asc_getUserName();if(e&&e!==AscCommon.UserInfoParser.getCurrentName()){this._renameDialog&&this._renameDialog.close(),AscCommon.UserInfoParser.setCurrentName(e),appHeader.setUserName(AscCommon.UserInfoParser.getParsedName(e));var i=e.lastIndexOf("("),n=e.lastIndexOf(")"),o=i>0&&i<n?e.substring(0,i-1):"";null!==Common.localStorage.getItem("guest-username")&&Common.localStorage.setItem("guest-username",o),Common.Utils.InternalSettings.set("guest-username",o)}}},applySettings:function(){if(this.appOptions.isEdit&&!this.appOptions.isOffline&&this.appOptions.canCoAuthoring){var t=this._state.fastCoauth;this._state.fastCoauth=Common.localStorage.getBool("de-settings-coauthmode",!0),this._state.fastCoauth&&!t&&this.synchronizeChanges()}this.appOptions.canForcesave&&(this.appOptions.forcesave=Common.localStorage.getBool("de-settings-forcesave",this.appOptions.canForcesave),Common.Utils.InternalSettings.set("de-settings-forcesave",this.appOptions.forcesave),this.api.asc_setIsForceSaveOnUserSave(this.appOptions.forcesave))},onDocumentName:function(t){appHeader.setDocumentCaption(t),this.updateWindowTitle(!0)},onMeta:function(t){appHeader.setDocumentCaption(t.title),this.updateWindowTitle(!0),this.document.title=t.title;var e=this.getApplication().getController("LeftMenu").getView("LeftMenu").getMenu("file");if(e.loadDocument({doc:this.document}),e.panels&&e.panels.info&&e.panels.info.updateInfo(this.document),this.getApplication().getController("Common.Controllers.ReviewChanges").loadDocument({doc:this.document}),Common.Gateway.metaChange(t),this.appOptions.wopi){var i=t.title.lastIndexOf(".");Common.Gateway.requestRename(i>0?t.title.substring(0,i):t.title)}},onPrint:function(){this.appOptions.canPrint&&!Common.Utils.ModalWindow.isVisible()&&(this.api&&this.api.asc_Print(new Asc.asc_CDownloadOptions(null,Common.Utils.isChrome||Common.Utils.isSafari||Common.Utils.isOpera||Common.Utils.isGecko&&Common.Utils.firefoxVersion>86)),Common.component.Analytics.trackEvent("Print"))},onPrintUrl:function(t){if(this.iframePrint&&(this.iframePrint.parentNode.removeChild(this.iframePrint),this.iframePrint=null),!this.iframePrint){var e=this;this.iframePrint=document.createElement("iframe"),this.iframePrint.id="id-print-frame",this.iframePrint.style.display="none",this.iframePrint.style.visibility="hidden",this.iframePrint.style.position="fixed",this.iframePrint.style.right="0",this.iframePrint.style.bottom="0",document.body.appendChild(this.iframePrint),this.iframePrint.onload=function(){try{e.iframePrint.contentWindow.focus(),e.iframePrint.contentWindow.print(),e.iframePrint.contentWindow.blur(),window.focus()}catch(t){e.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(Asc.c_oAscFileType.PDF))}}}t&&(this.iframePrint.src=t)},onClearDummyComment:function(){this.dontCloseDummyComment=!1},onShowDummyComment:function(){this.beforeShowDummyComment=!0},DisableMailMerge:function(){this.appOptions.mergeFolderUrl="";var t=this.getApplication().getController("Toolbar");t&&t.DisableMailMerge()},DisableVersionHistory:function(){this.editorConfig.canUseHistory=!1,this.appOptions.canUseHistory=!1},onConvertEquationToMath:function(t){var e,i=this,n=this.textConvertEquation+'<br><br><a id="id-equation-convert-help" style="cursor: pointer;">'+this.textLearnMore+"</a>";e=Common.UI.warning({width:500,msg:n,buttons:["yes","cancel"],
primary:"yes",dontshow:!0,textDontShow:this.textApplyAll,callback:_.bind(function(e,i){"yes"==e&&this.api.asc_ConvertEquationToMath(t,i),this.onEditComplete()},this)}),e.$window.find("#id-equation-convert-help").on("click",function(t){e&&e.close(),i.getApplication().getController("LeftMenu").getView("LeftMenu").showMenu("file:help","UsageInstructions/InsertEquation.htm#convertequation")})},warningDocumentIsLocked:function(){var t=this,e=function(e){t.disableEditing(e);var i=t.getApplication();i.getController("DocumentHolder").getView().SetDisabled(e),i.getController("Navigation")&&i.getController("Navigation").SetDisabled(e);var n=i.getController("LeftMenu");n.leftMenu.getMenu("file").getButton("protect").setDisabled(e),n.setPreviewMode(e);var o=i.getController("Common.Controllers.Comments");o&&o.setPreviewMode(e)};Common.Utils.warningDocumentIsLocked({disablefunc:e})},onRunAutostartMacroses:function(){var t=this;if(!this.editorConfig.customization||!1!==this.editorConfig.customization.macros){var e=Common.Utils.InternalSettings.get("de-macros-mode");1==e?this.api.asc_runAutostartMacroses():0===e&&Common.UI.warning({msg:this.textHasMacros+"<br>",buttons:["yes","no"],primary:"yes",dontshow:!0,textDontShow:this.textRemember,callback:function(e,i){i&&(Common.Utils.InternalSettings.set("de-macros-mode","yes"==e?1:2),Common.localStorage.setItem("de-macros-mode","yes"==e?1:2)),"yes"==e&&setTimeout(function(){t.api.asc_runAutostartMacroses()},1)}})}},loadAutoCorrectSettings:function(){var t=this,e=Common.localStorage.getItem("de-settings-math-correct-add");Common.Utils.InternalSettings.set("de-settings-math-correct-add",e);var i=e?JSON.parse(e):[];e=Common.localStorage.getItem("de-settings-math-correct-rem"),Common.Utils.InternalSettings.set("de-settings-math-correct-rem",e);var n=e?JSON.parse(e):[];e=Common.localStorage.getBool("de-settings-math-correct-replace-type",!0),Common.Utils.InternalSettings.set("de-settings-math-correct-replace-type",e),t.api.asc_refreshOnStartAutoCorrectMathSymbols(n,i,e),e=Common.localStorage.getItem("de-settings-rec-functions-add"),Common.Utils.InternalSettings.set("de-settings-rec-functions-add",e),i=e?JSON.parse(e):[],e=Common.localStorage.getItem("de-settings-rec-functions-rem"),Common.Utils.InternalSettings.set("de-settings-rec-functions-rem",e),n=e?JSON.parse(e):[],t.api.asc_refreshOnStartAutoCorrectMathFunctions(n,i),e=Common.localStorage.getBool("de-settings-autoformat-bulleted",!0),Common.Utils.InternalSettings.set("de-settings-autoformat-bulleted",e),t.api.asc_SetAutomaticBulletedLists(e),e=Common.localStorage.getBool("de-settings-autoformat-numbered",!0),Common.Utils.InternalSettings.set("de-settings-autoformat-numbered",e),t.api.asc_SetAutomaticNumberedLists(e),e=Common.localStorage.getBool("de-settings-autoformat-smart-quotes",!0),Common.Utils.InternalSettings.set("de-settings-autoformat-smart-quotes",e),t.api.asc_SetAutoCorrectSmartQuotes(e),e=Common.localStorage.getBool("de-settings-autoformat-hyphens",!0),Common.Utils.InternalSettings.set("de-settings-autoformat-hyphens",e),t.api.asc_SetAutoCorrectHyphensWithDash(e),e=Common.localStorage.getBool("de-settings-autoformat-fl-sentence",!0),Common.Utils.InternalSettings.set("de-settings-autoformat-fl-sentence",e),t.api.asc_SetAutoCorrectFirstLetterOfSentences(e)},showRenameUserDialog:function(){if(!this._renameDialog){var t=this;this._renameDialog=new Common.Views.UserNameDialog({label:this.textRenameLabel,error:this.textRenameError,value:Common.Utils.InternalSettings.get("guest-username")||"",check:Common.Utils.InternalSettings.get("save-guest-username")||!1,validation:function(e){return e.length<128||t.textLongName},handler:function(e,i){if("ok"==e){var n=i.input?i.input+" ("+t.appOptions.guestName+")":t.textAnonymous,o=new Asc.asc_CUserInfo;o.put_FullName(n);var s=new Asc.asc_CDocInfo;s.put_UserInfo(o),t.api.asc_changeDocInfo(s),i.checkbox?Common.localStorage.setItem("guest-username",i.input):Common.localStorage.removeItem("guest-username"),Common.Utils.InternalSettings.set("guest-username",i.input),Common.Utils.InternalSettings.set("save-guest-username",i.checkbox)}}}),this._renameDialog.on("close",function(){t._renameDialog=void 0}),this._renameDialog.show(Common.Utils.innerWidth()-this._renameDialog.options.width-15,30)}},onGrabFocus:function(){this.getApplication().getController("DocumentHolder").getView().focus()},onLanguageLoaded:function(){return!!Common.Locale.getCurrentLanguage()||(Common.UI.warning({msg:this.errorLang,buttons:[],closable:!1}),!1)},leavePageText:"You have unsaved changes in this document. Click 'Stay on this Page' then 'Save' to save them. Click 'Leave this Page' to discard all the unsaved changes.",criticalErrorTitle:"Error",notcriticalErrorTitle:"Warning",errorDefaultMessage:"Error code: %1",criticalErrorExtText:'Press "OK" to back to document list.',openTitleText:"Opening Document",openTextText:"Opening document...",loadFontsTitleText:"Loading Data",loadFontsTextText:"Loading data...",loadImagesTitleText:"Loading Images",loadImagesTextText:"Loading images...",loadFontTitleText:"Loading Data",loadFontTextText:"Loading data...",loadImageTitleText:"Loading Image",loadImageTextText:"Loading image...",downloadTitleText:"Downloading Document",downloadTextText:"Downloading document...",printTitleText:"Printing Document",printTextText:"Printing document...",uploadImageTitleText:"Uploading Image",uploadImageTextText:"Uploading image...",savePreparingText:"Preparing to save",savePreparingTitle:"Preparing to save. Please wait...",uploadImageSizeMessage:"Maximum image size limit exceeded.",uploadImageExtMessage:"Unknown image format.",uploadImageFileCountMessage:"No images uploaded.",reloadButtonText:"Reload Page",unknownErrorText:"Unknown error.",convertationTimeoutText:"Convertation timeout exceeded.",downloadErrorText:"Download failed.",unsupportedBrowserErrorText:"Your browser is not supported.",splitMaxRowsErrorText:"The number of rows must be less than %1",splitMaxColsErrorText:"The number of columns must be less than %1",splitDividerErrorText:"The number of rows must be a divisor of %1",requestEditFailedTitleText:"Access denied",requestEditFailedMessageText:"Someone is editing this document right now. Please try again later.",txtNeedSynchronize:"You have an updates",textLoadingDocument:"Loading document",warnBrowserZoom:"Your browser's current zoom setting is not fully supported. Please reset to the default zoom by pressing Ctrl+0.",warnBrowserIE9:"The application has low capabilities on IE9. Use IE10 or higher",applyChangesTitleText:"Loading Data",applyChangesTextText:"Loading data...",errorKeyEncrypt:"Unknown key descriptor",errorKeyExpire:"Key descriptor expired",errorUsersExceed:"Count of users was exceed",errorCoAuthoringDisconnect:"Server connection lost. You can't edit anymore.",errorFilePassProtect:"The file is password protected and cannot be opened.",txtBasicShapes:"Basic Shapes",txtFiguredArrows:"Figured Arrows",txtMath:"Math",txtCharts:"Charts",txtStarsRibbons:"Stars & Ribbons",txtCallouts:"Callouts",txtButtons:"Buttons",txtRectangles:"Rectangles",txtLines:"Lines",txtEditingMode:"Set editing mode...",textAnonymous:"Anonymous",loadingDocumentTitleText:"Loading document",loadingDocumentTextText:"Loading document...",warnProcessRightsChange:"You have been denied the right to edit the file.",errorProcessSaveResult:"Saving is failed.",textCloseTip:"Click to close the tip.",textShape:"Shape",errorStockChart:"Incorrect row order. To build a stock chart place the data on the sheet in the following order:<br> opening price, max price, min price, closing price.",errorDataRange:"Incorrect data range.",errorDatabaseConnection:"External error.<br>Database connection error. Please, contact support.",titleUpdateVersion:"Version changed",errorUpdateVersion:"The file version has been changed. The page will be reloaded.",errorUserDrop:"The file cannot be accessed right now.",txtDiagramTitle:"Chart Title",txtXAxis:"X Axis",txtYAxis:"Y Axis",txtSeries:"Seria",errorMailMergeLoadFile:"Loading the document failed. Please select a different file.",mailMergeLoadFileText:"Loading Data Source...",mailMergeLoadFileTitle:"Loading Data Source",errorMailMergeSaveFile:"Merge failed.",downloadMergeText:"Downloading...",downloadMergeTitle:"Downloading",sendMergeTitle:"Sending Merge",sendMergeText:"Sending Merge...",txtArt:"Your text here",errorConnectToServer:"The document could not be saved. Please check connection settings or contact your administrator.<br>When you click the 'OK' button, you will be prompted to download the document.",textTryUndoRedo:"The Undo/Redo functions are disabled for the Fast co-editing mode.<br>Click the 'Strict mode' button to switch to the Strict co-editing mode to edit the file without other users interference and send your changes only after you save them. You can switch between the co-editing modes using the editor Advanced settings.",textStrict:"Strict mode",txtErrorLoadHistory:"Loading history failed",textBuyNow:"Visit website",textNoLicenseTitle:"License limit reached",textContactUs:"Contact sales",errorViewerDisconnect:"Connection is lost. You can still view the document,<br>but will not be able to download or print until the connection is restored and page is reloaded.",warnLicenseExp:"Your license has expired.<br>Please update your license and refresh the page.",titleLicenseExp:"License expired",openErrorText:"An error has occurred while opening the file",saveErrorText:"An error has occurred while saving the file",errorToken:"The document security token is not correctly formed.<br>Please contact your Document Server administrator.",errorTokenExpire:"The document security token has expired.<br>Please contact your Document Server administrator.",errorSessionAbsolute:"The document editing session has expired. Please reload the page.",errorSessionIdle:"The document has not been edited for quite a long time. Please reload the page.",errorSessionToken:"The connection to the server has been interrupted. Please reload the page.",errorAccessDeny:"You are trying to perform an action you do not have rights for.<br>Please contact your Document Server administrator.",titleServerVersion:"Editor updated",errorServerVersion:"The editor version has been updated. The page will be reloaded to apply the changes.",textChangesSaved:"All changes saved",errorBadImageUrl:"Image url is incorrect",txtStyle_Normal:"Normal",txtStyle_No_Spacing:"No Spacing",txtStyle_Heading_1:"Heading 1",txtStyle_Heading_2:"Heading 2",txtStyle_Heading_3:"Heading 3",txtStyle_Heading_4:"Heading 4",txtStyle_Heading_5:"Heading 5",txtStyle_Heading_6:"Heading 6",txtStyle_Heading_7:"Heading 7",txtStyle_Heading_8:"Heading 8",txtStyle_Heading_9:"Heading 9",txtStyle_Title:"Title",txtStyle_Subtitle:"Subtitle",txtStyle_Quote:"Quote",txtStyle_Intense_Quote:"Intense Quote",txtStyle_List_Paragraph:"List Paragraph",txtStyle_footnote_text:"Footnote Text",saveTextText:"Saving document...",saveTitleText:"Saving Document",txtBookmarkError:"Error! Bookmark not defined.",txtAbove:"above",txtBelow:"below",txtOnPage:"on page",txtHeader:"Header",txtFooter:"Footer",txtSection:"-Section",txtFirstPage:"First Page",txtEvenPage:"Even Page",txtOddPage:"Odd Page",txtSameAsPrev:"Same as Previous",txtCurrentDocument:"Current Document",txtNoTableOfContents:"There are no headings in the document. Apply a heading style to the text so that it appears in the table of contents.",txtTableOfContents:"Table of Contents",errorForceSave:"An error occurred while saving the file. Please use the 'Download as' option to save the file to your computer hard drive or try again later.",warnNoLicense:"You've reached the limit for simultaneous connections to %1 editors. This document will be opened for viewing only.<br>Contact %1 sales team for personal upgrade terms.",warnNoLicenseUsers:"You've reached the user limit for %1 editors. Contact %1 sales team for personal upgrade terms.",warnLicenseExceeded:"You've reached the limit for simultaneous connections to %1 editors. This document will be opened for viewing only.<br>Contact your administrator to learn more.",warnLicenseUsersExceeded:"You've reached the user limit for %1 editors. Contact your administrator to learn more.",errorDataEncrypted:"Encrypted changes have been received, they cannot be deciphered.",textClose:"Close",textPaidFeature:"Paid feature",scriptLoadError:"The connection is too slow, some of the components could not be loaded. Please reload the page.",errorEditingSaveas:"An error occurred during the work with the document.<br>Use the 'Save as...' option to save the file backup copy to your computer hard drive.",errorEditingDownloadas:"An error occurred during the work with the document.<br>Use the 'Download as...' option to save the file backup copy to your computer hard drive.",txtShape_textRect:"Text Box",txtShape_rect:"Rectangle",txtShape_ellipse:"Ellipse",txtShape_triangle:"Triangle",txtShape_rtTriangle:"Right Triangle",txtShape_parallelogram:"Parallelogram",txtShape_trapezoid:"Trapezoid",txtShape_diamond:"Diamond",txtShape_pentagon:"Pentagon",txtShape_hexagon:"Hexagon",txtShape_heptagon:"Heptagon",txtShape_octagon:"Octagon",txtShape_decagon:"Decagon",txtShape_dodecagon:"Dodecagon",txtShape_pie:"Pie",txtShape_chord:"Chord",txtShape_teardrop:"Teardrop",txtShape_frame:"Frame",txtShape_halfFrame:"Half Frame",txtShape_corner:"Corner",txtShape_diagStripe:"Diagonal Stripe",txtShape_plus:"Plus",txtShape_plaque:"Sign",txtShape_can:"Can",txtShape_cube:"Cube",txtShape_bevel:"Bevel",txtShape_donut:"Donut",txtShape_noSmoking:'"No" Symbol',txtShape_blockArc:"Block Arc",txtShape_foldedCorner:"Folded Corner",txtShape_smileyFace:"Smiley Face",txtShape_heart:"Heart",txtShape_lightningBolt:"Lightning Bolt",txtShape_sun:"Sun",txtShape_moon:"Moon",txtShape_cloud:"Cloud",txtShape_arc:"Arc",txtShape_bracePair:"Double Brace",txtShape_leftBracket:"Left Bracket",txtShape_rightBracket:"Right Bracket",txtShape_leftBrace:"Left Brace",txtShape_rightBrace:"Right Brace",txtShape_rightArrow:"Right Arrow",txtShape_leftArrow:"Left Arrow",txtShape_upArrow:"Up Arrow",txtShape_downArrow:"Down Arrow",txtShape_leftRightArrow:"Left Right Arrow",txtShape_upDownArrow:"Up Down Arrow",txtShape_quadArrow:"Quad Arrow",txtShape_leftRightUpArrow:"Left Right Up Arrow",txtShape_bentArrow:"Bent Arrow",txtShape_uturnArrow:"U-Turn Arrow",txtShape_leftUpArrow:"Left Up Arrow",txtShape_bentUpArrow:"Bent Up Arrow",txtShape_curvedRightArrow:"Curved Right Arrow",txtShape_curvedLeftArrow:"Curved Left Arrow",txtShape_curvedUpArrow:"Curved Up Arrow",txtShape_curvedDownArrow:"Curved Down Arrow",txtShape_stripedRightArrow:"Striped Right Arrow",txtShape_notchedRightArrow:"Notched Right Arrow",txtShape_homePlate:"Pentagon",txtShape_chevron:"Chevron",txtShape_rightArrowCallout:"Right Arrow Callout",txtShape_downArrowCallout:"Down Arrow Callout",txtShape_leftArrowCallout:"Left Arrow Callout",txtShape_upArrowCallout:"Up Arrow Callout",txtShape_leftRightArrowCallout:"Left Right Arrow Callout",txtShape_quadArrowCallout:"Quad Arrow Callout",txtShape_circularArrow:"Circular Arrow",txtShape_mathPlus:"Plus",txtShape_mathMinus:"Minus",txtShape_mathMultiply:"Multiply",txtShape_mathDivide:"Division",txtShape_mathEqual:"Equal",txtShape_mathNotEqual:"Not Equal",txtShape_flowChartProcess:"Flowchart: Process",txtShape_flowChartAlternateProcess:"Flowchart: Alternate Process",txtShape_flowChartDecision:"Flowchart: Decision",txtShape_flowChartInputOutput:"Flowchart: Data",txtShape_flowChartPredefinedProcess:"Flowchart: Predefined Process",txtShape_flowChartInternalStorage:"Flowchart: Internal Storage",txtShape_flowChartDocument:"Flowchart: Document",txtShape_flowChartMultidocument:"Flowchart: Multidocument ",txtShape_flowChartTerminator:"Flowchart: Terminator",txtShape_flowChartPreparation:"Flowchart: Preparation",txtShape_flowChartManualInput:"Flowchart: Manual Input",txtShape_flowChartManualOperation:"Flowchart: Manual Operation",txtShape_flowChartConnector:"Flowchart: Connector",txtShape_flowChartOffpageConnector:"Flowchart: Off-page Connector",txtShape_flowChartPunchedCard:"Flowchart: Card",txtShape_flowChartPunchedTape:"Flowchart: Punched Tape",txtShape_flowChartSummingJunction:"Flowchart: Summing Junction",txtShape_flowChartOr:"Flowchart: Or",txtShape_flowChartCollate:"Flowchart: Collate",txtShape_flowChartSort:"Flowchart: Sort",txtShape_flowChartExtract:"Flowchart: Extract",txtShape_flowChartMerge:"Flowchart: Merge",txtShape_flowChartOnlineStorage:"Flowchart: Stored Data",txtShape_flowChartDelay:"Flowchart: Delay",txtShape_flowChartMagneticTape:"Flowchart: Sequential Access Storage",txtShape_flowChartMagneticDisk:"Flowchart: Magnetic Disk",txtShape_flowChartMagneticDrum:"Flowchart: Direct Access Storage",txtShape_flowChartDisplay:"Flowchart: Display",txtShape_irregularSeal1:"Explosion 1",txtShape_irregularSeal2:"Explosion 2",txtShape_star4:"4-Point Star",txtShape_star5:"5-Point Star",txtShape_star6:"6-Point Star",txtShape_star7:"7-Point Star",txtShape_star8:"8-Point Star",txtShape_star10:"10-Point Star",txtShape_star12:"12-Point Star",txtShape_star16:"16-Point Star",txtShape_star24:"24-Point Star",txtShape_star32:"32-Point Star",txtShape_ribbon2:"Up Ribbon",txtShape_ribbon:"Down Ribbon",txtShape_ellipseRibbon2:"Curved Up Ribbon",txtShape_ellipseRibbon:"Curved Down Ribbon",txtShape_verticalScroll:"Vertical Scroll",txtShape_horizontalScroll:"Horizontal Scroll",txtShape_wave:"Wave",txtShape_doubleWave:"Double Wave",txtShape_wedgeRectCallout:"Rectangular Callout",txtShape_wedgeRoundRectCallout:"Rounded Rectangular Callout",txtShape_wedgeEllipseCallout:"Oval Callout",txtShape_cloudCallout:"Cloud Callout",txtShape_borderCallout1:"Line Callout 1",txtShape_borderCallout2:"Line Callout 2",txtShape_borderCallout3:"Line Callout 3",txtShape_accentCallout1:"Line Callout 1 (Accent Bar)",txtShape_accentCallout2:"Line Callout 2 (Accent Bar)",txtShape_accentCallout3:"Line Callout 3 (Accent Bar)",txtShape_callout1:"Line Callout 1 (No Border)",txtShape_callout2:"Line Callout 2 (No Border)",txtShape_callout3:"Line Callout 3 (No Border)",txtShape_accentBorderCallout1:"Line Callout 1 (Border and Accent Bar)",txtShape_accentBorderCallout2:"Line Callout 2 (Border and Accent Bar)",txtShape_accentBorderCallout3:"Line Callout 3 (Border and Accent Bar)",txtShape_actionButtonBackPrevious:"Back or Previous Button",txtShape_actionButtonForwardNext:"Forward or Next Button",txtShape_actionButtonBeginning:"Beginning Button",txtShape_actionButtonEnd:"End Button",txtShape_actionButtonHome:"Home Button",txtShape_actionButtonInformation:"Information Button",txtShape_actionButtonReturn:"Return Button",txtShape_actionButtonMovie:"Movie Button",txtShape_actionButtonDocument:"Document Button",txtShape_actionButtonSound:"Sound Button",txtShape_actionButtonHelp:"Help Button",txtShape_actionButtonBlank:"Blank Button",txtShape_roundRect:"Round Corner Rectangle",txtShape_snip1Rect:"Snip Single Corner Rectangle",txtShape_snip2SameRect:"Snip Same Side Corner Rectangle",txtShape_snip2DiagRect:"Snip Diagonal Corner Rectangle",txtShape_snipRoundRect:"Snip and Round Single Corner Rectangle",txtShape_round1Rect:"Round Single Corner Rectangle",txtShape_round2SameRect:"Round Same Side Corner Rectangle",txtShape_round2DiagRect:"Round Diagonal Corner Rectangle",txtShape_line:"Line",txtShape_lineWithArrow:"Arrow",txtShape_lineWithTwoArrows:"Double Arrow",txtShape_bentConnector5:"Elbow Connector",txtShape_bentConnector5WithArrow:"Elbow Arrow Connector",txtShape_bentConnector5WithTwoArrows:"Elbow Double-Arrow Connector",txtShape_curvedConnector3:"Curved Connector",txtShape_curvedConnector3WithArrow:"Curved Arrow Connector",txtShape_curvedConnector3WithTwoArrows:"Curved Double-Arrow Connector",txtShape_spline:"Curve",txtShape_polyline1:"Scribble",txtShape_polyline2:"Freeform",txtSyntaxError:"Syntax Error",txtMissOperator:"Missing Operator",txtMissArg:"Missing Argument",txtTooLarge:"Number Too Large To Format",txtZeroDivide:"Zero Divide",txtNotInTable:"Is Not In Table",txtIndTooLarge:"Index Too Large",txtFormulaNotInTable:"The Formula Not In Table",txtTableInd:"Table Index Cannot be Zero",txtUndefBookmark:"Undefined Bookmark",txtEndOfFormula:"Unexpected End of Formula",errorEmailClient:"No email client could be found",textCustomLoader:"Please note that according to the terms of the license you are not entitled to change the loader.<br>Please contact our Sales Department to get a quote.",txtHyperlink:"Hyperlink",waitText:"Please, wait...",errorFileSizeExceed:"The file size exceeds the limitation set for your server.<br>Please contact your Document Server administrator for details.",txtMainDocOnly:"Error! Main Document Only.",txtNotValidBookmark:"Error! Not a valid bookmark self-reference.",txtNoText:"Error! No text of specified style in document.",uploadDocSizeMessage:"Maximum document size limit exceeded.",uploadDocExtMessage:"Unknown document format.",uploadDocFileCountMessage:"No documents uploaded.",errorUpdateVersionOnDisconnect:"Internet connection has been restored, and the file version has been changed.<br>Before you can continue working, you need to download the file or copy its content to make sure nothing is lost, and then reload this page.",txtChoose:"Choose an item",errorDirectUrl:"Please verify the link to the document.<br>This link must be a direct link to the file for downloading.",txtStyle_Caption:"Caption",errorCompare:"The Compare documents feature is not available in the co-editing mode.",textConvertEquation:"This equation was created with an old version of equation editor which is no longer supported. Converting this equation to Office Math ML format will make it editable.<br>Do you want to convert this equation?",textApplyAll:"Apply to all equations",textLearnMore:"Learn More",txtEnterDate:"Enter a date",txtTypeEquation:"Type equation here",textHasMacros:"The file contains automatic macros.<br>Do you want to run macros?",textRemember:"Remember my choice",warnLicenseLimitedRenewed:"License needs to be renewed.<br>You have a limited access to document editing functionality.<br>Please contact your administrator to get full access",warnLicenseLimitedNoAccess:"License expired.<br>You have no access to document editing functionality.<br>Please contact your administrator.",saveErrorTextDesktop:"This file cannot be saved or created.<br>Possible reasons are: <br>1. The file is read-only. <br>2. The file is being edited by other users. <br>3. The disk is full or corrupted.",errorComboSeries:"To create a combination chart, select at least two series of data.",errorSetPassword:"Password could not be set.",textRenameLabel:"Enter a name to be used for collaboration",textRenameError:"User name must not be empty.",textLongName:"Enter a name that is less than 128 characters.",textGuest:"Guest",errorSubmit:"Submit failed.",txtClickToLoad:"Click to load image",leavePageTextOnClose:"All unsaved changes in this document will be lost.<br> Click 'Cancel' then 'Save' to save them. Click 'OK' to discard all the unsaved changes.",textTryUndoRedoWarn:"The Undo/Redo functions are disabled for the Fast co-editing mode.",txtNone:"None",txtNoTableOfFigures:"No table of figures entries found.",txtTableOfFigures:"Table of figures",txtStyle_endnote_text:"Endnote Text",txtTOCHeading:"TOC Heading",errorLang:"The interface language is not loaded.<br>Please contact your Document Server administrator.",errorLoadingFont:"Fonts are not loaded.<br>Please contact your Document Server administrator."}}(),DE.Controllers.Main||{}))}),define("common/main/lib/view/DocumentAccessDialog",["common/main/lib/component/Window","common/main/lib/component/LoadMask"],function(){"use strict";Common.Views.DocumentAccessDialog=Common.UI.Window.extend(_.extend({initialize:function(t){var e={};_.extend(e,{title:this.textTitle,width:600,height:536,header:!0},t),this.template=['<div id="id-sharing-placeholder"></div>'].join(""),e.tpl=_.template(this.template)(e),this.settingsurl=t.settingsurl||"",Common.UI.Window.prototype.initialize.call(this,e)},render:function(){Common.UI.Window.prototype.render.call(this),this.$window.find("> .body").css({height:"auto",overflow:"hidden"});var t=document.createElement("iframe");t.width="100%",t.height=500,t.align="top",t.frameBorder=0,t.scrolling="no",t.onload=_.bind(this._onLoad,this),$("#id-sharing-placeholder").append(t),this.loadMask=new Common.UI.LoadMask({owner:$("#id-sharing-placeholder")}),this.loadMask.setTitle(this.textLoading),this.loadMask.show(),t.src=this.settingsurl;var e=this;this._eventfunc=function(t){e._onWindowMessage(t)},this._bindWindowEvents.call(this),this.on("close",function(t){e._unbindWindowEvents()})},_bindWindowEvents:function(){window.addEventListener?window.addEventListener("message",this._eventfunc,!1):window.attachEvent&&window.attachEvent("onmessage",this._eventfunc)},_unbindWindowEvents:function(){window.removeEventListener?window.removeEventListener("message",this._eventfunc):window.detachEvent&&window.detachEvent("onmessage",this._eventfunc)},_onWindowMessage:function(t){if(t&&window.JSON)try{this._onMessage.call(this,window.JSON.parse(t.data))}catch(t){}},_onMessage:function(t){t&&"onlyoffice"==t.Referer&&(t.needUpdate&&this.trigger("accessrights",this,t.sharingSettings),Common.NotificationCenter.trigger("window:close",this))},_onLoad:function(){this.loadMask&&this.loadMask.hide()},textTitle:"Sharing Settings",textLoading:"Loading"},Common.Views.DocumentAccessDialog||{}))}),define("text!common/main/lib/template/AutoCorrectDialog.template",[],function(){return'<div id="id-autocorrect-dialog-settings-math" class="settings-panel active">\n    <div class="inner-content">\n        <table cols="1" style="width: 100%;">\n        <tr>\n            <td style="padding-bottom: 8px;">\n                <div id="auto-correct-chb-replace-type"></div>\n            </td>\n        </tr>\n        <tr>\n            <td>\n                <label style="width: 117px;"><%= scope.textReplace %>:</label>\n                <label><%= scope.textBy %>:</label>\n                </td>\n            </tr>\n        <tr>\n            <td>\n                <div id="auto-correct-replace" style="height:22px;width: 115px;margin-right: 2px;display: inline-block;"></div>\n                <div id="auto-correct-by" style="height:22px;width: 234px;display: inline-block;"></div>\n                </td>\n            </tr>\n        <tr>\n            <td style="padding-bottom: 8px;">\n                <div id="auto-correct-math-list" class="" style="width:100%; height: 208px;"></div>\n                </td>\n            </tr>\n        <tr>\n            <td style="padding-bottom: 8px;">\n                <button type="button" class="btn btn-text-default auto" id="auto-correct-btn-reset" style="min-width: 80px;"><%= scope.textResetAll %></button>\n                <button type="button" class="btn btn-text-default auto" id="auto-correct-btn-delete" style="min-width: 80px;float: right;"><%= scope.textDelete %></button>\n                <button type="button" class="btn btn-text-default auto" id="auto-correct-btn-edit" style="min-width: 80px;float: right;margin-right:5px;"><%= scope.textAdd %></button>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-autocorrect-dialog-settings-recognized" class="settings-panel">\n    <div class="inner-content">\n        <table cols="1" style="width: 100%;">\n            <tr>\n                <td style="padding-bottom: 8px;">\n                    <label><%= scope.textRecognizedDesc %></label>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <div id="auto-correct-rec-find" style="height:22px;width: 100%;margin-bottom: 4px;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td style="padding-bottom: 8px;">\n                    <div id="auto-correct-recognized-list" class="" style="width:100%; height: 208px;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td style="padding-bottom: 8px;">\n                    <button type="button" class="btn btn-text-default auto" id="auto-correct-btn-rec-reset" style="min-width: 86px;"><%= scope.textResetAll %></button>\n                    <button type="button" class="btn btn-text-default auto" id="auto-correct-btn-rec-delete" style="min-width: 86px;float: right;"><%= scope.textDelete %></button>\n                    <button type="button" class="btn btn-text-default auto" id="auto-correct-btn-rec-edit" style="min-width: 86px;float: right;margin-right:5px;"><%= scope.textAdd %></button>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-autocorrect-dialog-settings-de-autoformat" class="settings-panel">\n    <div class="inner-content" style="width: 100%;">\n        <div class="padding-small">\n            <label class="header"><%= scope.textReplaceText %></label>\n        </div>\n        <div class="padding-large">\n            <div class="padding-small" id="id-autocorrect-dialog-chk-quotes"></div>\n            <div id="id-autocorrect-dialog-chk-hyphens"></div>\n        </div>\n        <div class="padding-small">\n            <label class="header"><%= scope.textApplyText %></label>\n        </div>\n        <div class="padding-large">\n            <div class="padding-small" id="id-autocorrect-dialog-chk-bulleted"></div>\n            <div id="id-autocorrect-dialog-chk-numbered"></div>\n        </div>\n    </div>\n</div>\n<div id="id-autocorrect-dialog-settings-sse-autoformat" class="settings-panel">\n    <div class="inner-content" style="width: 100%;">\n        <div class="padding-small">\n            <label class="header"><%= scope.textReplaceText %></label>\n        </div>\n        <div class="padding-large">\n            <div id="id-autocorrect-dialog-chk-hyperlink"></div>\n        </div>\n        <div class="padding-small">\n            <label class="header"><%= scope.textApplyAsWork %></label>\n        </div>\n        <div class="padding-large">\n            <div id="id-autocorrect-dialog-chk-new-rows"></div>\n        </div>\n    </div>\n</div>\n<div id="id-autocorrect-dialog-settings-autocorrect" class="settings-panel">\n    <div class="inner-content" style="width: 100%;">\n        <div class="padding-large">\n            <div id="id-autocorrect-dialog-chk-fl-sentence"></div>\n        </div>\n    </div>\n</div>\n'}),void 0===Common)var Common={};if(define("common/main/lib/view/AutoCorrectDialog",["text!common/main/lib/template/AutoCorrectDialog.template","common/main/lib/component/ListView","common/main/lib/component/Window","common/main/lib/component/CheckBox"],function(t){"use strict";var e=new Common.UI.DataViewStore,i=new Common.UI.DataViewStore;Common.Views.AutoCorrectDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:375,height:430,buttons:null,toggleGroup:"autocorrect-dialog-group"},initialize:function(e){var i=Common.localStorage.getKeysFilter();this.appPrefix=i&&i.length?i.split(",")[0]:"";var n=[{panelId:"id-autocorrect-dialog-settings-math",panelCaption:this.textMathCorrect},{panelId:"id-autocorrect-dialog-settings-recognized",panelCaption:this.textRecognized}];"de-"==this.appPrefix||"pe-"==this.appPrefix?(n.push({panelId:"id-autocorrect-dialog-settings-de-autoformat",panelCaption:this.textAutoFormat}),n.push({panelId:"id-autocorrect-dialog-settings-autocorrect",panelCaption:this.textAutoCorrect})):"sse-"==this.appPrefix&&n.push({panelId:"id-autocorrect-dialog-settings-sse-autoformat",panelCaption:this.textAutoFormat}),_.extend(this.options,{title:this.textTitle,storageName:this.appPrefix+"autocorrect-dialog-category",items:n,
template:['<div class="box" style="height:'+(this.options.height-85)+'px;">','<div class="menu-panel" style="overflow: hidden;">',"<% _.each(items, function(item) { %>",'<button class="btn btn-category" content-target="<%= item.panelId %>"><span class=""><%= item.panelCaption %></span></button>',"<% }); %>","</div>",'<div class="separator"></div>','<div class="content-panel">'+_.template(t)({scope:this})+"</div>","</div>",'<div class="separator horizontal"></div>','<div class="footer center">','<button class="btn normal dlg-btn" result="cancel" style="width: 86px;">'+this.closeButtonText+"</button>","</div>"].join("")},e||{}),this.api=this.options.api;var o=this.appPrefix+"settings-math-correct",s=Common.Utils.InternalSettings.get(o+"-add");this.arrAdd=s?JSON.parse(s):[],s=Common.Utils.InternalSettings.get(o+"-rem"),this.arrRem=s?JSON.parse(s):[],o=this.appPrefix+"settings-rec-functions",s=Common.Utils.InternalSettings.get(o+"-add"),this.arrAddRec=s?JSON.parse(s):[],s=Common.Utils.InternalSettings.get(o+"-rem"),this.arrRemRec=s?JSON.parse(s):[],Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this.getChild(),n=this;this.chReplaceType=new Common.UI.CheckBox({el:t.findById("#auto-correct-chb-replace-type"),labelText:this.textReplaceType,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-math-correct-replace-type")}).on("change",function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-math-correct-replace-type",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-math-correct-replace-type",s),n.api.asc_updateFlagAutoCorrectMathSymbols(s)}),this.onInitList(),this.mathList=new Common.UI.ListView({el:t.find("#auto-correct-math-list"),store:new Common.UI.DataViewStore(e.slice(0,9)),simpleAddMode:!1,template:_.template(['<div class="listview inner" style=""></div>'].join("")),itemTemplate:_.template(['<div id="<%= id %>" class="list-item" style="pointer-events:none;width: 100%;display:flex;">','<div style="width:110px;padding-right: 5px;overflow: hidden;text-overflow: ellipsis;<% if (defaultDisabled) { %> font-style:italic; opacity: 0.5;<% } %>"><%= replaced %></div>','<div style="width:230px;overflow: hidden;text-overflow: ellipsis;flex-grow:1;font-family: Cambria Math;font-size:13px;<% if (defaultDisabled) { %> font-style:italic; opacity: 0.5;<% } %>"><%= by %></div>',"</div>"].join("")),scrollAlwaysVisible:!0,tabindex:1}),this.mathList.on("item:select",_.bind(this.onSelectMathItem,this)),this.inputReplace=new Common.UI.InputField({el:t.find("#auto-correct-replace"),allowBlank:!0,validateOnChange:!0,maxLength:31,validation:function(){return!0}}).on("changing",function(t,e){var i;if(e.length){i=n.mathList.store.find(function(t){if(0==t.get("replaced").indexOf(e))return!0}),i&&(n.mathList.scrollToRecord(i,!0),i.get("replaced")==e?n.mathList.selectRecord(i,!0):i=null)}!i&&n.mathList.deselectAll(),n.updateControls(i)}),this.inputReplace.cmpEl.find("input").on("keydown",function(t){if("ArrowDown"==t.key){var e=n.mathList.getSelectedRec()||n.mathList.store.at(0);e&&(n.mathList.selectRecord(e),n.mathList.scrollToRecord(e)),_.delay(function(){n.mathList.focus()},10)}}),this.inputBy=new Common.UI.InputField({el:t.find("#auto-correct-by"),allowBlank:!0,validateOnChange:!0,maxLength:255,validation:function(){return!0}}).on("changing",function(t,e){n.updateControls()}),this.btnReset=new Common.UI.Button({el:$("#auto-correct-btn-reset")}),this.btnReset.on("click",_.bind(this.onResetToDefault,this)),this.btnEdit=new Common.UI.Button({el:$("#auto-correct-btn-edit")}),this.btnEdit.on("click",_.bind(this.onEdit,this,!1)),this.btnDelete=new Common.UI.Button({el:$("#auto-correct-btn-delete")}),this.btnDelete.on("click",_.bind(this.onDelete,this,!1)),this.onInitRecList(),this.mathRecList=new Common.UI.ListView({el:t.find("#auto-correct-recognized-list"),store:new Common.UI.DataViewStore(i.slice(0,9)),simpleAddMode:!1,template:_.template(['<div class="listview inner" style=""></div>'].join("")),itemTemplate:_.template(['<div id="<%= id %>" class="list-item" style="width: 340px;text-overflow: ellipsis;overflow: hidden;<% if (defaultDisabled) { %> font-style:italic; opacity: 0.5;<% } %>"><%= value %></div>'].join("")),scrollAlwaysVisible:!0,tabindex:1}),this.mathRecList.on("item:select",_.bind(this.onSelectRecItem,this)),this.inputRecFind=new Common.UI.InputField({el:t.find("#auto-correct-rec-find"),allowBlank:!0,validateOnChange:!0,maxLength:255,validation:function(){return!0}}).on("changing",function(t,e){var i;if(e.length){i=n.mathRecList.store.find(function(t){if(0==t.get("value").indexOf(e))return!0}),i&&(n.mathRecList.scrollToRecord(i,!0),i.get("value")==e?n.mathRecList.selectRecord(i,!0):i=null)}!i&&n.mathRecList.deselectAll(),n.updateRecControls(i)}),this.inputRecFind.cmpEl.find("input").on("keydown",function(t){if("ArrowDown"==t.key){var e=n.mathRecList.getSelectedRec()||n.mathRecList.store.at(0);e&&(n.mathRecList.selectRecord(e),n.mathRecList.scrollToRecord(e)),_.delay(function(){n.mathRecList.focus()},10)}}),this.btnResetRec=new Common.UI.Button({el:$("#auto-correct-btn-rec-reset")}),this.btnResetRec.on("click",_.bind(this.onResetRecToDefault,this)),this.btnAddRec=new Common.UI.Button({el:$("#auto-correct-btn-rec-edit")}),this.btnAddRec.on("click",_.bind(this.onAddRec,this,!1)),this.btnDeleteRec=new Common.UI.Button({el:$("#auto-correct-btn-rec-delete")}),this.btnDeleteRec.on("click",_.bind(this.onDeleteRec,this,!1)),"de-"==this.appPrefix||"pe-"==this.appPrefix?(this.chQuotes=new Common.UI.CheckBox({el:$("#id-autocorrect-dialog-chk-quotes"),labelText:this.textQuotes,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-autoformat-smart-quotes")}).on("change",function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-autoformat-smart-quotes",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-autoformat-smart-quotes",s),n.api.asc_SetAutoCorrectSmartQuotes(s)}),this.chHyphens=new Common.UI.CheckBox({el:$("#id-autocorrect-dialog-chk-hyphens"),labelText:this.textHyphens,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-autoformat-hyphens")}).on("change",function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-autoformat-hyphens",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-autoformat-hyphens",s),n.api.asc_SetAutoCorrectHyphensWithDash(s)}),this.chBulleted=new Common.UI.CheckBox({el:$("#id-autocorrect-dialog-chk-bulleted"),labelText:this.textBulleted,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-autoformat-bulleted")}).on("change",function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-autoformat-bulleted",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-autoformat-bulleted",s),n.api.asc_SetAutomaticBulletedLists(s)}),this.chNumbered=new Common.UI.CheckBox({el:$("#id-autocorrect-dialog-chk-numbered"),labelText:this.textNumbered,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-autoformat-numbered")}).on("change",function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-autoformat-numbered",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-autoformat-numbered",s),n.api.asc_SetAutomaticNumberedLists(s)}),this.chFLSentence=new Common.UI.CheckBox({el:$("#id-autocorrect-dialog-chk-fl-sentence"),labelText:this.textFLSentence,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-autoformat-fl-sentence")}).on("change",function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-autoformat-fl-sentence",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-autoformat-fl-sentence",s),n.api.asc_SetAutoCorrectFirstLetterOfSentences&&n.api.asc_SetAutoCorrectFirstLetterOfSentences(s)}),this.btnsCategory[3].on("click",_.bind(this.onAutocorrectCategoryClick,this,!1))):"sse-"==this.appPrefix&&(this.chNewRows=new Common.UI.CheckBox({el:$("#id-autocorrect-dialog-chk-new-rows"),labelText:this.textNewRowCol,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-autoformat-new-rows")}).on("change",function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-autoformat-new-rows",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-autoformat-new-rows",s),n.api.asc_setIncludeNewRowColTable(s)}),this.chHyperlink=new Common.UI.CheckBox({el:$("#id-autocorrect-dialog-chk-hyperlink"),labelText:this.textHyperlink,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-autoformat-hyperlink")}).on("change",function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-autoformat-hyperlink",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-autoformat-hyperlink",s),n.api.asc_setAutoCorrectHyperlinks(s)})),this.btnsCategory[0].on("click",_.bind(this.onMathCategoryClick,this,!1)),this.btnsCategory[1].on("click",_.bind(this.onRecCategoryClick,this,!1)),this.btnsCategory[2].on("click",_.bind(this.onAutoformatCategoryClick,this,!1)),this.afterRender()},afterRender:function(){if(this.updateControls(),this.updateRecControls(),this.storageName){var t=Common.localStorage.getItem(this.storageName);this.setActiveCategory(null!==t?parseInt(t):0)}},getFocusedComponents:function(){var t=[this.chReplaceType,this.inputReplace,this.inputBy,this.mathList,this.btnReset,this.btnEdit,this.btnDelete,this.inputRecFind,this.mathRecList,this.btnResetRec,this.btnAddRec,this.btnDeleteRec,this.chFLSentence];return t=t.concat(this.chNewRows?[this.chHyperlink,this.chNewRows]:[this.chQuotes,this.chHyphens,this.chBulleted,this.chNumbered]),t=t.concat(this.chFLSentence?[this.chFLSentence]:[])},getSettings:function(){},onSelectMathItem:function(t,e,i){i&&(this.inputReplace.setValue(i.get("replaced")),this.inputBy.setValue(i.get("by"))),this.updateControls(i)},updateControls:function(t){if(this.mathList){t=t||this.mathList.getSelectedRec();var e=this.inputBy.getValue(),i=this.inputReplace.getValue();if(t){var n=t.get("defaultDisabled"),o=t.get("defaultValue")&&t.get("defaultValueStr")!==t.get("by");this.btnDelete.setCaption(n?this.textRestore:this.textDelete),this.btnEdit.setDisabled(n||e===t.get("by")&&!o||!e||!i),this.btnEdit.setCaption(o&&e===t.get("by")?this.textReset:this.textReplace)}else this.btnDelete.setCaption(this.textDelete),this.btnEdit.setDisabled(!e||!i),this.btnEdit.setCaption(this.textAdd);this.btnDelete.setDisabled(!t)}},show:function(){Common.Views.AdvancedSettingsWindow.prototype.show.apply(this,arguments);var t=this.getActiveCategory();0==t?this.onMathCategoryClick(!0):1==t?this.onRecCategoryClick(!0):2==t?this.onAutoformatCategoryClick(!0):3==t&&this.onAutocorrectCategoryClick(!0)},close:function(){Common.Views.AdvancedSettingsWindow.prototype.close.apply(this,arguments),this.mathList&&this.mathList.deselectAll(),this.mathRecList&&this.mathRecList.deselectAll()},onMathCategoryClick:function(t){var i=this;_.delay(function(){$("input",i.inputReplace.cmpEl).select().focus()},t?50:0),i.mathList.store.length<e.length&&_.delay(function(){i.mathList.setStore(e),i.mathList.onResetItems()},t?100:10)},onAutoformatCategoryClick:function(t){var e=this;_.delay(function(){e.chHyperlink?e.chHyperlink.focus():e.chQuotes.focus()},t?50:0)},onAutocorrectCategoryClick:function(t){var e=this;_.delay(function(){e.chFLSentence.focus()},t?50:0)},onDelete:function(){var t=this.mathList.getSelectedRec();if(t){if(t.get("defaultValue")){var i=this.appPrefix+"settings-math-correct-rem",n=!t.get("defaultDisabled");t.set("defaultDisabled",n),n?this.arrRem.push(t.get("replaced")):this.arrRem.splice(this.arrRem.indexOf(t.get("replaced")),1);var o=JSON.stringify(this.arrRem);Common.Utils.InternalSettings.set(i,o),Common.localStorage.setItem(i,o),this.btnDelete.setCaption(n?this.textRestore:this.textDelete),n?this.api.asc_deleteFromAutoCorrectMathSymbols(t.get("replaced")):this.api.asc_AddOrEditFromAutoCorrectMathSymbols(t.get("replaced"),t.get("defaultValue"))}else e.remove(t),this.mathList.scroller&&this.mathList.scroller.update({}),this.api.asc_deleteFromAutoCorrectMathSymbols(t.get("replaced"));this.updateControls()}},onEdit:function(){var t=this.mathList.getSelectedRec(),i="",n=this,o=function(t,e){var i=n.appPrefix+"settings-math-correct-add",o=JSON.stringify(n.arrAdd);Common.Utils.InternalSettings.set(i,o),Common.localStorage.setItem(i,o),n.api.asc_AddOrEditFromAutoCorrectMathSymbols(t.get("replaced"),e),n.mathList.selectRecord(t),n.mathList.scrollToRecord(t)};if(t||(t=e.findWhere({replaced:this.inputReplace.getValue()})),t){var s=_.findIndex(this.arrAdd,function(e){return e[0]==t.get("replaced")}),a=t.get("defaultValue")&&t.get("defaultValueStr")!==t.get("by")&&this.inputBy.getValue()===t.get("by");Common.UI.warning({maxwidth:500,msg:a?this.warnRestore.replace("%1",t.get("replaced")):this.warnReplace.replace("%1",t.get("replaced")),buttons:["yes","no"],primary:"yes",callback:_.bind(function(e,n){"yes"==e&&(a?(i=t.get("defaultValue"),t.set("by",t.get("defaultValueStr")),s>=0&&this.arrAdd.splice(s,1)):(i=this.inputBy.getValue(),t.set("by",i),s<0?this.arrAdd.push([t.get("replaced"),i]):this.arrAdd[s][1]=i),o(t,i))},this)})}else t=e.add({replaced:this.inputReplace.getValue(),by:this.inputBy.getValue(),defaultDisabled:!1}),i=t.get("by"),this.arrAdd.push([t.get("replaced"),i]),o(t,i)},onResetToDefault:function(){Common.UI.warning({maxwidth:500,msg:this.warnReset,buttons:["yes","no"],primary:"yes",callback:_.bind(function(t,e){"yes"==t&&(this.api.asc_resetToDefaultAutoCorrectMathSymbols(),this.onResetList())},this)})},onResetList:function(){var t=this.appPrefix+"settings-math-correct",i=JSON.stringify([]);Common.Utils.InternalSettings.set(t+"-add",i),Common.localStorage.setItem(t+"-add",i),Common.Utils.InternalSettings.set(t+"-rem",i),Common.localStorage.setItem(t+"-rem",i),this.arrAdd=[],this.arrRem=[],e.remove(e.where({defaultValue:void 0})),e.each(function(t,e){t.set("by",t.get("defaultValueStr")),t.set("defaultDisabled",!1)}),this.mathList.deselectAll(),this.mathList.scroller&&(this.mathList.scroller.update(),this.mathList.scroller.scrollTop(0)),this.updateControls()},onInitList:function(){if(!(e.length>0)){e.comparator=function(t,e){var i=t.get("replaced").toLowerCase(),n=e.get("replaced").toLowerCase();return i==n?0:i<n?-1:1};var t=this.arrAdd,i=this.arrRem,n=this.api?this.api.asc_getAutoCorrectMathSymbols():[],o=[];_.each(n,function(t,e){var n={replaced:t[0],defaultValue:t[1],defaultDisabled:i.indexOf(t[0])>-1};"object"==typeof t[1]?(n.defaultValueStr="",_.each(t[1],function(t){n.defaultValueStr+=Common.Utils.String.encodeSurrogateChar(t)}),n.by=n.defaultValueStr):n.by=n.defaultValueStr=Common.Utils.String.encodeSurrogateChar(t[1]),o.push(n)});var s=[];_.each(t,function(t,e){var i=_.findIndex(o,{replaced:t[0]});if(i<0)s.push({replaced:t[0],by:t[1],defaultDisabled:!1});else{o[i].by=t[1]}}),e.reset(o.concat(s)),this.updateControls()}},onInitRecList:function(){if(!(i.length>0)){i.comparator=function(t,e){var i=t.get("value").toLowerCase(),n=e.get("value").toLowerCase();return i==n?0:i<n?-1:1};var t=this.arrAddRec,e=this.arrRemRec,n=this.api?this.api.asc_getAutoCorrectMathFunctions():[],o=[];_.each(n,function(t,i){o.push({value:t,defaultValue:!0,defaultDisabled:e.indexOf(t)>-1})});var s=[];_.each(t,function(t,e){_.findIndex(o,{value:t})<0&&s.push({value:t,defaultValue:!1,defaultDisabled:!1})}),i.reset(o.concat(s)),this.updateRecControls()}},onResetRecToDefault:function(){Common.UI.warning({maxwidth:500,msg:this.textWarnResetRec,buttons:["yes","no"],primary:"yes",callback:_.bind(function(t,e){"yes"==t&&(this.api.asc_resetToDefaultAutoCorrectMathFunctions(),this.onResetRecList())},this)})},onResetRecList:function(){var t=this.appPrefix+"settings-rec-functions",e=JSON.stringify([]);Common.Utils.InternalSettings.set(t+"-add",e),Common.localStorage.setItem(t+"-add",e),Common.Utils.InternalSettings.set(t+"-rem",e),Common.localStorage.setItem(t+"-rem",e),this.arrAddRec=[],this.arrRemRec=[],i.remove(i.where({defaultValue:!1})),i.each(function(t,e){t.set("defaultDisabled",!1)}),this.mathRecList.deselectAll(),this.mathRecList.scroller&&(this.mathRecList.scroller.update(),this.mathRecList.scroller.scrollTop(0)),this.updateRecControls()},onRecCategoryClick:function(t){var e=this;_.delay(function(){$("input",e.inputRecFind.cmpEl).select().focus()},t?50:0),e.mathRecList.store.length<i.length&&_.delay(function(){e.mathRecList.setStore(i),e.mathRecList.onResetItems()},t?100:10)},onDeleteRec:function(){var t=this.mathRecList.getSelectedRec();if(t){if(t.get("defaultValue")){var e=this.appPrefix+"settings-rec-functions-rem",n=!t.get("defaultDisabled");t.set("defaultDisabled",n),n?this.arrRemRec.push(t.get("value")):this.arrRemRec.splice(this.arrRemRec.indexOf(t.get("value")),1);var o=JSON.stringify(this.arrRemRec);Common.Utils.InternalSettings.set(e,o),Common.localStorage.setItem(e,o),this.btnDeleteRec.setCaption(n?this.textRestore:this.textDelete),n?this.api.asc_deleteFromAutoCorrectMathFunctions(t.get("value")):this.api.asc_AddFromAutoCorrectMathFunctions(t.get("value"))}else i.remove(t),this.mathRecList.scroller&&this.mathRecList.scroller.update({}),this.api.asc_deleteFromAutoCorrectMathFunctions(t.get("value"));this.updateRecControls()}},onAddRec:function(){var t=this.mathRecList.getSelectedRec(),e=this;t||(t=i.findWhere({value:this.inputRecFind.getValue()})),t?(e.mathRecList.selectRecord(t),e.mathRecList.scrollToRecord(t)):/^[A-Z]+$/i.test(this.inputRecFind.getValue())?(t=i.add({value:this.inputRecFind.getValue(),defaultValue:!1,defaultDisabled:!1}),this.arrAddRec.push(t.get("value")),function(t){var i=e.appPrefix+"settings-rec-functions-add",n=JSON.stringify(e.arrAddRec);Common.Utils.InternalSettings.set(i,n),Common.localStorage.setItem(i,n),e.api.asc_AddFromAutoCorrectMathFunctions(t.get("value")),e.mathRecList.selectRecord(t),e.mathRecList.scrollToRecord(t)}(t)):Common.UI.warning({maxwidth:500,msg:this.textWarnAddRec})},onSelectRecItem:function(t,e,i){i&&this.inputRecFind.setValue(i.get("value")),this.updateRecControls(i)},updateRecControls:function(t){if(this.mathRecList){t=t||this.mathRecList.getSelectedRec();var e=this.inputRecFind.getValue();this.btnDeleteRec.setCaption(t&&t.get("defaultDisabled")?this.textRestore:this.textDelete),this.btnDeleteRec.setDisabled(!t),this.btnAddRec.setDisabled(!!t||!e)}},textTitle:"AutoCorrect",textMathCorrect:"Math AutoCorrect",textReplace:"Replace",textBy:"By",textResetAll:"Reset to default",textAdd:"Add",textDelete:"Delete",textRestore:"Restore",textReset:"Reset",textReplaceType:"Replace text as you type",warnReset:"Any autocorrect you added will be removed and the changed ones will be restored to their original values. Do you want to continue?",warnReplace:"The autocorrect entry for %1 already exists. Do you want to replace it?",warnRestore:"The autocorrect entry for %1 will be reset to its original value. Do you want to continue?",textRecognized:"Recognized Functions",textRecognizedDesc:"The following expressions are recognized math expressions. They will not be automatically italicized.",textWarnAddRec:"Recognized functions must contain only the letters A through Z, uppercase or lowercase.",textWarnResetRec:"Any expression you added will be removed and the removed ones will be restored. Do you want to continue?",textAutoFormat:"AutoFormat As You Type",textReplaceText:"Replace As You Type",textApplyText:"Apply As You Type",textQuotes:'"Straight quotes" with "smart quotes"',textHyphens:"Hyphens (--) with dash (â)",textBulleted:"Automatic bulleted lists",textNumbered:"Automatic numbered lists",textApplyAsWork:"Apply as you work",textNewRowCol:"Include new rows and columns in table",textAutoCorrect:"AutoCorrect",textFLSentence:"Capitalize first letter of sentences",textHyperlink:"Internet and network paths with hyperlinks"},Common.Views.AutoCorrectDialog||{}))}),define("documenteditor/main/app/view/FileMenuPanels",["common/main/lib/view/DocumentAccessDialog","common/main/lib/view/AutoCorrectDialog"],function(){"use strict";!DE.Views.FileMenuPanels&&(DE.Views.FileMenuPanels={}),DE.Views.FileMenuPanels.ViewSaveAs=Common.UI.BaseView.extend({el:"#panel-saveas",menu:void 0,formats:[[{name:"DOCX",imgCls:"docx",type:Asc.c_oAscFileType.DOCX},{name:"PDF",imgCls:"pdf",type:Asc.c_oAscFileType.PDF},{name:"ODT",imgCls:"odt",type:Asc.c_oAscFileType.ODT},{name:"TXT",imgCls:"txt",type:Asc.c_oAscFileType.TXT}],[{name:"DOTX",imgCls:"dotx",type:Asc.c_oAscFileType.DOTX},{name:"PDFA",imgCls:"pdfa",type:Asc.c_oAscFileType.PDFA},{name:"OTT",imgCls:"ott",type:Asc.c_oAscFileType.OTT},{name:"RTF",imgCls:"rtf",type:Asc.c_oAscFileType.RTF}],[{name:"HTML (Zipped)",imgCls:"html",type:Asc.c_oAscFileType.HTML},{name:"FB2",imgCls:"fb2",type:Asc.c_oAscFileType.FB2},{name:"EPUB",imgCls:"epub",type:Asc.c_oAscFileType.EPUB}]],template:_.template(["<table><tbody>","<% _.each(rows, function(row) { %>","<tr>","<% _.each(row, function(item) { %>",'<td><div><svg class="btn-doc-format" format="<%= item.type %>">','<use xlink:href="#svg-format-<%= item.imgCls %>"></use>',"</svg></div></td>","<% }) %>","</tr>","<% }) %>","</tbody></table>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=t.menu},render:function(){return this.$el.html(this.template({rows:this.formats})),$(".btn-doc-format",this.el).on("click",_.bind(this.onFormatClick,this)),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el,suppressScrollX:!0,alwaysVisibleY:!0})),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.scroller&&this.scroller.update()},onFormatClick:function(t){var e=t.currentTarget.attributes.format;!_.isUndefined(e)&&this.menu&&this.menu.fireEvent("saveas:format",[this.menu,parseInt(e.value)])}}),DE.Views.FileMenuPanels.ViewSaveCopy=Common.UI.BaseView.extend({el:"#panel-savecopy",menu:void 0,formats:[[{name:"DOCX",imgCls:"docx",type:Asc.c_oAscFileType.DOCX,ext:".docx"},{name:"PDF",imgCls:"pdf",type:Asc.c_oAscFileType.PDF,ext:".pdf"},{name:"ODT",imgCls:"odt",type:Asc.c_oAscFileType.ODT,ext:".odt"},{name:"TXT",imgCls:"txt",type:Asc.c_oAscFileType.TXT,ext:".txt"}],[{name:"DOTX",imgCls:"dotx",type:Asc.c_oAscFileType.DOTX,ext:".dotx"},{name:"PDFA",imgCls:"pdfa",type:Asc.c_oAscFileType.PDFA,ext:".pdf"},{name:"OTT",imgCls:"ott",type:Asc.c_oAscFileType.OTT,ext:".ott"},{name:"RTF",imgCls:"rtf",type:Asc.c_oAscFileType.RTF,ext:".rtf"}],[{name:"HTML (Zipped)",imgCls:"html",type:Asc.c_oAscFileType.HTML,ext:".html"},{name:"FB2",imgCls:"fb2",type:Asc.c_oAscFileType.FB2,ext:".fb2"},{name:"EPUB",imgCls:"epub",type:Asc.c_oAscFileType.EPUB,ext:".epub"}]],template:_.template(["<table><tbody>","<% _.each(rows, function(row) { %>","<tr>","<% _.each(row, function(item) { %>",'<td><div><svg class="btn-doc-format" format="<%= item.type %>", format-ext="<%= item.ext %>">','<use xlink:href="#svg-format-<%= item.imgCls %>"></use>',"</svg></div></td>","<% }) %>","</tr>","<% }) %>","</tbody></table>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=t.menu},render:function(){return this.$el.html(this.template({rows:this.formats})),$(".btn-doc-format",this.el).on("click",_.bind(this.onFormatClick,this)),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el,suppressScrollX:!0,alwaysVisibleY:!0})),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.scroller&&this.scroller.update()},onFormatClick:function(t){var e=t.currentTarget.attributes.format,i=t.currentTarget.attributes["format-ext"];_.isUndefined(e)||_.isUndefined(i)||!this.menu||this.menu.fireEvent("savecopy:format",[this.menu,parseInt(e.value),i.value])}}),DE.Views.FileMenuPanels.Settings=Common.UI.BaseView.extend(_.extend({el:"#panel-settings",menu:void 0,template:_.template(['<div class="flex-settings">','<table style="margin: 30px 0 0;"><tbody>','<tr class="comments">','<td class="left"><label><%= scope.txtLiveComment %></label></td>','<td class="right"><div id="fms-chb-live-comment"></div></td>',"</tr>",'<tr class="divider comments"></tr>','<tr class="comments">','<td class="left"></td>','<td class="right"><div id="fms-chb-resolved-comment"></div></td>',"</tr>",'<tr class="divider comments"></tr>','<tr class="edit">','<td class="left"><label><%= scope.txtSpellCheck %></label></td>','<td class="right"><div id="fms-chb-spell-check"></div></td>',"</tr>",'<tr class="divider edit"></tr>','<tr class="edit">','<td class="left"><label><%= scope.txtProofing %></label></td>','<td class="right"><button type="button" class="btn btn-text-default" id="fms-btn-auto-correct" style="width:auto; display: inline-block;padding-right: 10px;padding-left: 10px;"><%= scope.txtAutoCorrect %></button></div></td>',"</tr>",'<tr class="divider edit"></tr>','<tr class="edit">','<td class="left"><label><%= scope.txtInput %></label></td>','<td class="right"><div id="fms-chb-input-mode"></div></td>',"</tr>",'<tr class="divider edit"></tr>','<tr class="edit">','<td class="left"><label><%= scope.textAlignGuides %></label></td>','<td class="right"><span id="fms-chb-align-guides"></span></td>',"</tr>",'<tr class="divider edit"></tr>','<tr class="edit">','<td class="left"><label><%= scope.textCompatible %></label></td>','<td class="right"><span id="fms-chb-compatible"></span></td>',"</tr>",'<tr class="divider edit"></tr>','<tr class="autosave">','<td class="left"><label id="fms-lbl-autosave"><%= scope.textAutoSave %></label></td>','<td class="right"><span id="fms-chb-autosave"></span></td>',"</tr>",'<tr class="divider autosave"></tr>','<tr class="forcesave">','<td class="left"><label id="fms-lbl-forcesave"><%= scope.textForceSave %></label></td>','<td class="right"><span id="fms-chb-forcesave"></span></td>',"</tr>",'<tr class="divider forcesave"></tr>','<tr class="coauth changes-mode">','<td class="left"><label><%= scope.strCoAuthMode %></label></td>','<td class="right">','<div><div id="fms-cmb-coauth-mode" style="display: inline-block; margin-right: 15px;vertical-align: middle;"></div>','<label id="fms-lbl-coauth-mode" style="vertical-align: middle;"><%= scope.strCoAuthModeDescFast %></label></div></td>',"</tr>",'<tr class="divider coauth changes-mode"></tr>','<tr class="coauth changes-show">','<td class="left"><label><%= scope.strShowChanges %></label></td>','<td class="right"><span id="fms-cmb-show-changes"></span></td>',"</tr>",'<tr class="divider coauth changes-show"></tr>','<tr class="themes">','<td class="left"><label><%= scope.strTheme %></label></td>','<td class="right"><span id="fms-cmb-theme"></span></td>',"</tr>",'<tr class="divider"></tr>',"<tr>",'<td class="left"><label><%= scope.strZoom %></label></td>','<td class="right"><div id="fms-cmb-zoom" class="input-group-nr"></div></td>',"</tr>",'<tr class="divider"></tr>',"<tr>",'<td class="left"><label><%= scope.strFontRender %></label></td>','<td class="right"><span id="fms-cmb-font-render"></span></td>',"</tr>",'<tr class="divider"></tr>','<tr class="edit">','<td class="left"><label><%= scope.strUnit %></label></td>','<td class="right"><span id="fms-cmb-unit"></span></td>',"</tr>",'<tr class="divider edit"></tr>','<tr class="edit">','<td class="left"><label><%= scope.strPaste %></label></td>','<td class="right"><div id="fms-chb-paste-settings"></div></td>',"</tr>",'<tr class="divider edit"></tr>','<tr class="macros">','<td class="left"><label><%= scope.strMacrosSettings %></label></td>','<td class="right">','<div><div id="fms-cmb-macros" style="display: inline-block; margin-right: 15px;vertical-align: middle;"></div>','<label id="fms-lbl-macros" style="vertical-align: middle;"><%= scope.txtWarnMacrosDesc %></label></div></td>',"</tr>",'<tr class="divider macros"></tr>','<tr class="fms-btn-apply">','<td class="left"></td>','<td class="right" style="padding-top:15px; padding-bottom: 15px;"><button class="btn normal dlg-btn primary"><%= scope.okButtonText %></button></td>',"</tr>","</tbody></table>","</div>",'<div class="fms-flex-apply hidden">','<table style="margin: 10px 0;"><tbody>',"<tr>",'<td class="left"></td>','<td class="right"><button class="btn normal dlg-btn primary"><%= scope.okButtonText %></button></td>',"</tr>","</tbody></table>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=t.menu},render:function(t){var e=this,i=$(this.template({scope:this}));this.chInputMode=new Common.UI.CheckBox({el:i.findById("#fms-chb-input-mode"),labelText:this.strInputMode}),this.chLiveComment=new Common.UI.CheckBox({el:i.findById("#fms-chb-live-comment"),labelText:this.strLiveComment}).on("change",function(t,i,n,o){e.chResolvedComment.setDisabled("checked"!==t.getValue())}),this.chResolvedComment=new Common.UI.CheckBox({el:i.findById("#fms-chb-resolved-comment"),labelText:this.strResolvedComment}),this.chSpell=new Common.UI.CheckBox({el:i.findById("#fms-chb-spell-check"),labelText:this.strSpellCheckMode}),this.chCompatible=new Common.UI.CheckBox({el:i.findById("#fms-chb-compatible"),labelText:this.textOldVersions}),this.chAutosave=new Common.UI.CheckBox({el:i.findById("#fms-chb-autosave"),labelText:this.strAutosave}).on("change",function(t,i,n,o){"checked"!==t.getValue()&&e.cmbCoAuthMode.getValue()&&(e.cmbCoAuthMode.setValue(0),e.onSelectCoAuthMode(e.cmbCoAuthMode.getSelectedRecord()))}),this.lblAutosave=i.findById("#fms-lbl-autosave"),this.chForcesave=new Common.UI.CheckBox({el:i.findById("#fms-chb-forcesave"),labelText:this.strForcesave}),this.chAlignGuides=new Common.UI.CheckBox({el:i.findById("#fms-chb-align-guides"),labelText:this.strAlignGuides}),this.cmbZoom=new Common.UI.ComboBox({el:i.findById("#fms-cmb-zoom"),style:"width: 160px;",editable:!1,cls:"input-group-nr",menuStyle:"max-height: 157px;",data:[{value:-1,displayValue:this.txtFitPage},{value:-2,displayValue:this.txtFitWidth},{value:50,displayValue:"50%"},{value:60,displayValue:"60%"},{value:70,displayValue:"70%"},{value:80,displayValue:"80%"},{value:90,displayValue:"90%"},{value:100,displayValue:"100%"},{value:110,displayValue:"110%"},{value:120,displayValue:"120%"},{value:150,displayValue:"150%"},{value:175,displayValue:"175%"},{value:200,displayValue:"200%"}]}),this.cmbShowChanges=new Common.UI.ComboBox({el:i.findById("#fms-cmb-show-changes"),style:"width: 160px;",editable:!1,cls:"input-group-nr",data:[{value:"none",displayValue:this.txtNone},{value:"all",displayValue:this.txtAll},{value:"last",displayValue:this.txtLast}]}),this.cmbCoAuthMode=new Common.UI.ComboBox({el:i.findById("#fms-cmb-coauth-mode"),style:"width: 160px;",editable:!1,cls:"input-group-nr",data:[{value:1,displayValue:this.strFast,descValue:this.strCoAuthModeDescFast},{value:0,displayValue:this.strStrict,descValue:this.strCoAuthModeDescStrict}]}).on("selected",function(t,i){1==i.value&&"checked"!==e.chAutosave.getValue()&&e.chAutosave.setValue(1),e.onSelectCoAuthMode(i)}),this.lblCoAuthMode=i.findById("#fms-lbl-coauth-mode");var n=_.template(["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>" <% if (item.value === "custom") { %> style="border-top: 1px solid #e5e5e5;margin-top: 5px;" <% } %> ><a tabindex="-1" type="menuitem" <% if (typeof(item.checked) !== "undefined" && item.checked) { %> class="checked" <% } %> ><%= scope.getDisplayValue(item) %></a></li>',"<% }); %>"].join(""));return this.cmbFontRender=new Common.UI.ComboBox({el:i.find("#fms-cmb-font-render"),style:"width: 160px;",editable:!1,cls:"input-group-nr",itemsTemplate:n,data:[{value:0,displayValue:this.txtWin},{value:1,displayValue:this.txtMac},{value:2,displayValue:this.txtNative},{value:"custom",displayValue:this.txtCacheMode}]}),this.cmbFontRender.on("selected",_.bind(this.onFontRenderSelected,this)),this.cmbUnit=new Common.UI.ComboBox({
el:i.findById("#fms-cmb-unit"),style:"width: 160px;",editable:!1,cls:"input-group-nr",data:[{value:Common.Utils.Metric.c_MetricUnits.cm,displayValue:this.txtCm},{value:Common.Utils.Metric.c_MetricUnits.pt,displayValue:this.txtPt},{value:Common.Utils.Metric.c_MetricUnits.inch,displayValue:this.txtInch}]}),this.cmbMacros=new Common.UI.ComboBox({el:i.findById("#fms-cmb-macros"),style:"width: 160px;",editable:!1,menuCls:"menu-aligned",cls:"input-group-nr",data:[{value:2,displayValue:this.txtStopMacros,descValue:this.txtStopMacrosDesc},{value:0,displayValue:this.txtWarnMacros,descValue:this.txtWarnMacrosDesc},{value:1,displayValue:this.txtRunMacros,descValue:this.txtRunMacrosDesc}]}).on("selected",function(t,i){e.lblMacrosDesc.text(i.descValue)}),this.lblMacrosDesc=i.findById("#fms-lbl-macros"),this.chPaste=new Common.UI.CheckBox({el:i.findById("#fms-chb-paste-settings"),labelText:this.strPasteButton}),this.btnAutoCorrect=new Common.UI.Button({el:i.findById("#fms-btn-auto-correct")}),this.btnAutoCorrect.on("click",_.bind(this.autoCorrect,this)),this.cmbTheme=new Common.UI.ComboBox({el:i.findById("#fms-cmb-theme"),style:"width: 160px;",editable:!1,cls:"input-group-nr"}),i.find(".btn.primary").each(function(t,i){new Common.UI.Button({el:$(i)}).on("click",_.bind(e.applySettings,e))}),this.pnlSettings=i.find(".flex-settings").addBack().filter(".flex-settings"),this.pnlApply=i.find(".fms-flex-apply").addBack().filter(".fms-flex-apply"),this.pnlTable=this.pnlSettings.find("table"),this.trApply=i.find(".fms-btn-apply"),this.$el=$(t).html(i),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.pnlSettings,suppressScrollX:!0,alwaysVisibleY:!0})),Common.NotificationCenter.on({"window:resize":function(){e.isVisible()&&e.updateScroller()}}),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.updateSettings(),this.updateScroller()},updateScroller:function(){if(this.scroller){Common.UI.Menu.Manager.hideAll();var t=this.$el.height()<this.pnlTable.height()+25+this.pnlApply.height();this.pnlApply.toggleClass("hidden",!t),this.trApply.toggleClass("hidden",t),this.pnlSettings.css("overflow",t?"hidden":"visible"),this.scroller.update(),this.pnlSettings.toggleClass("bordered",this.scroller.isVisible())}},setMode:function(t){this.mode=t;var e=Common.Utils.InternalSettings.get("de-settings-coauthmode");$("tr.edit",this.el)[t.isEdit?"show":"hide"](),$("tr.autosave",this.el)[!t.isEdit||!t.canChangeCoAuthoring&&e?"hide":"show"](),$("tr.forcesave",this.el)[t.canForcesave?"show":"hide"](),this.mode.isDesktopApp&&this.mode.isOffline&&(this.chAutosave.setCaption(this.strAutoRecover),this.lblAutosave.text(this.textAutoRecover)),$("tr.coauth",this.el)[t.isEdit&&t.canCoAuthoring?"show":"hide"](),$("tr.coauth.changes-mode",this.el)[t.isEdit&&!t.isOffline&&t.canCoAuthoring&&t.canChangeCoAuthoring?"show":"hide"](),$("tr.coauth.changes-show",this.el)[t.isEdit&&!t.isOffline&&t.canCoAuthoring?"show":"hide"](),$("tr.comments",this.el)[t.canCoAuthoring?"show":"hide"](),$("tr.macros",this.el)[t.customization&&!1===t.customization.macros?"hide":"show"](),Common.UI.Themes.available()||$("tr.themes, tr.themes + tr.divider",this.el).hide()},setApi:function(t){return this.api=t,this},updateSettings:function(){this.chInputMode.setValue(Common.Utils.InternalSettings.get("de-settings-inputmode"));var t=Common.Utils.InternalSettings.get("de-settings-zoom");t=null!==t?parseInt(t):this.mode.customization&&this.mode.customization.zoom?parseInt(this.mode.customization.zoom):100;var e=this.cmbZoom.store.findWhere({value:t});this.cmbZoom.setValue(e?parseInt(e.get("value")):t>0?t+"%":100),this.chLiveComment.setValue(Common.Utils.InternalSettings.get("de-settings-livecomment")),this.chResolvedComment.setValue(Common.Utils.InternalSettings.get("de-settings-resolvedcomment"));var i=Common.Utils.InternalSettings.get("de-settings-coauthmode");e=this.cmbCoAuthMode.store.findWhere({value:i?1:0}),this.cmbCoAuthMode.setValue(e?e.get("value"):1),this.lblCoAuthMode.text(e?e.get("descValue"):this.strCoAuthModeDescFast),this.fillShowChanges(i),t=Common.Utils.InternalSettings.get(i?"de-settings-showchanges-fast":"de-settings-showchanges-strict"),e=this.cmbShowChanges.store.findWhere({value:t}),this.cmbShowChanges.setValue(e?e.get("value"):i?"none":"last"),t=Common.Utils.InternalSettings.get("de-settings-fontrender"),e=this.cmbFontRender.store.findWhere({value:parseInt(t)}),this.cmbFontRender.setValue(e?e.get("value"):0),this._fontRender=this.cmbFontRender.getValue(),t=Common.Utils.InternalSettings.get("de-settings-cachemode"),e=this.cmbFontRender.store.findWhere({value:"custom"}),e&&t&&e.set("checked",!!t),e&&t&&this.cmbFontRender.cmpEl.find("#"+e.get("id")+" a").addClass("checked"),t=Common.Utils.InternalSettings.get("de-settings-unit"),e=this.cmbUnit.store.findWhere({value:t}),this.cmbUnit.setValue(e?parseInt(e.get("value")):Common.Utils.Metric.getDefaultMetric()),this._oldUnits=this.cmbUnit.getValue(),t=Common.Utils.InternalSettings.get("de-settings-autosave"),this.chAutosave.setValue(1==t),this.mode.canForcesave&&this.chForcesave.setValue(Common.Utils.InternalSettings.get("de-settings-forcesave")),this.chSpell.setValue(Common.Utils.InternalSettings.get("de-settings-spellcheck")),this.chAlignGuides.setValue(Common.Utils.InternalSettings.get("de-settings-showsnaplines")),this.chCompatible.setValue(Common.Utils.InternalSettings.get("de-settings-compatible")),e=this.cmbMacros.store.findWhere({value:Common.Utils.InternalSettings.get("de-macros-mode")}),this.cmbMacros.setValue(e?e.get("value"):0),this.lblMacrosDesc.text(e?e.get("descValue"):this.txtWarnMacrosDesc),this.chPaste.setValue(Common.Utils.InternalSettings.get("de-settings-paste-button"));var n=[];for(var o in Common.UI.Themes.map())n.push({value:o,displayValue:Common.UI.Themes.get(o).text});n.length&&(this.cmbTheme.setData(n),e=this.cmbTheme.store.findWhere({value:Common.UI.Themes.currentThemeId()}),this.cmbTheme.setValue(e?e.get("value"):Common.UI.Themes.defaultThemeId()))},applySettings:function(){Common.UI.Themes.setTheme(this.cmbTheme.getValue()),Common.localStorage.setItem("de-settings-inputmode",this.chInputMode.isChecked()?1:0),Common.localStorage.setItem("de-settings-zoom",this.cmbZoom.getValue()),Common.Utils.InternalSettings.set("de-settings-zoom",Common.localStorage.getItem("de-settings-zoom")),Common.localStorage.setItem("de-settings-livecomment",this.chLiveComment.isChecked()?1:0),Common.localStorage.setItem("de-settings-resolvedcomment",this.chResolvedComment.isChecked()?1:0),this.mode.isEdit&&!this.mode.isOffline&&this.mode.canCoAuthoring&&(this.mode.canChangeCoAuthoring&&Common.localStorage.setItem("de-settings-coauthmode",this.cmbCoAuthMode.getValue()),Common.localStorage.setItem(this.cmbCoAuthMode.getValue()?"de-settings-showchanges-fast":"de-settings-showchanges-strict",this.cmbShowChanges.getValue())),Common.localStorage.setItem("de-settings-fontrender",this.cmbFontRender.getValue());var t=this.cmbFontRender.store.findWhere({value:"custom"});Common.localStorage.setItem("de-settings-cachemode",t&&!t.get("checked")?0:1),Common.localStorage.setItem("de-settings-unit",this.cmbUnit.getValue()),!this.mode.canChangeCoAuthoring&&Common.Utils.InternalSettings.get("de-settings-coauthmode")||Common.localStorage.setItem("de-settings-autosave",this.chAutosave.isChecked()?1:0),this.mode.canForcesave&&Common.localStorage.setItem("de-settings-forcesave",this.chForcesave.isChecked()?1:0),Common.localStorage.setItem("de-settings-spellcheck",this.chSpell.isChecked()?1:0),Common.localStorage.setItem("de-settings-compatible",this.chCompatible.isChecked()?1:0),Common.Utils.InternalSettings.set("de-settings-compatible",this.chCompatible.isChecked()?1:0),Common.Utils.InternalSettings.set("de-settings-showsnaplines",this.chAlignGuides.isChecked()),Common.localStorage.setItem("de-macros-mode",this.cmbMacros.getValue()),Common.Utils.InternalSettings.set("de-macros-mode",this.cmbMacros.getValue()),Common.localStorage.setItem("de-settings-paste-button",this.chPaste.isChecked()?1:0),Common.localStorage.save(),this.menu&&(this.menu.fireEvent("settings:apply",[this.menu]),this._oldUnits!==this.cmbUnit.getValue()&&Common.NotificationCenter.trigger("settings:unitschanged",this))},fillShowChanges:function(t){if(t&&3==this.cmbShowChanges.store.length||!t&&2==this.cmbShowChanges.store.length){var e=[{value:"none",displayValue:this.txtNone},{value:"all",displayValue:this.txtAll}];t||e.push({value:"last",displayValue:this.txtLast}),this.cmbShowChanges.store.reset(e)}},onSelectCoAuthMode:function(t){this.lblCoAuthMode.text(t.descValue),this.fillShowChanges(1==t.value),this.cmbShowChanges.setValue(1==t.value?"none":"last")},onFontRenderSelected:function(t,e){if("custom"==e.value){var i=t.store.findWhere({value:"custom"});i&&i.set("checked",!e.checked),t.cmpEl.find("#"+e.id+" a").toggleClass("checked",!e.checked),t.setValue(this._fontRender)}this._fontRender=t.getValue()},autoCorrect:function(){this.dlgAutoCorrect&&this.dlgAutoCorrect.isVisible()||(this.dlgAutoCorrect=new Common.Views.AutoCorrectDialog({api:this.api}),this.dlgAutoCorrect.show())},strLiveComment:"Turn on option",strInputMode:"Turn on hieroglyphs",strZoom:"Default Zoom Value",strShowChanges:"Realtime Collaboration Changes",txtAll:"View All",txtNone:"View Nothing",txtLast:"View Last",txtLiveComment:"Live Commenting",okButtonText:"Apply",txtInput:"Alternate Input",txtWin:"as Windows",txtMac:"as OS X",txtNative:"Native",strFontRender:"Font Hinting",strUnit:"Unit of Measurement",txtCm:"Centimeter",txtPt:"Point",textAutoSave:"Autosave",strAutosave:"Turn on autosave",txtSpellCheck:"Spell Checking",strSpellCheckMode:"Turn on spell checking option",textAlignGuides:"Alignment Guides",strAlignGuides:"Turn on alignment guides",strCoAuthMode:"Co-editing mode",strCoAuthModeDescFast:"Other users will see your changes at once",strCoAuthModeDescStrict:"You will need to accept changes before you can see them",strFast:"Fast",strStrict:"Strict",textAutoRecover:"Autorecover",strAutoRecover:"Turn on autorecover",txtInch:"Inch",txtFitPage:"Fit to Page",txtFitWidth:"Fit to Width",textForceSave:"Save to Server",strForcesave:"Always save to server (otherwise save to server on document close)",strResolvedComment:"Turn on display of the resolved comments",textCompatible:"Compatibility",textOldVersions:"Make the files compatible with older MS Word versions when saved as DOCX",txtCacheMode:"Default cache mode",strMacrosSettings:"Macros Settings",txtWarnMacros:"Show Notification",txtRunMacros:"Enable All",txtStopMacros:"Disable All",txtWarnMacrosDesc:"Disable all macros with notification",txtRunMacrosDesc:"Enable all macros without notification",txtStopMacrosDesc:"Disable all macros without notification",strPaste:"Cut, copy and paste",strPasteButton:"Show Paste Options button when content is pasted",txtProofing:"Proofing",strTheme:"Theme",txtAutoCorrect:"AutoCorrect options..."},DE.Views.FileMenuPanels.Settings||{})),DE.Views.FileMenuPanels.RecentFiles=Common.UI.BaseView.extend({el:"#panel-recentfiles",menu:void 0,template:_.template(['<div id="id-recent-view" style="margin: 20px 0;"></div>'].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=t.menu,this.recent=t.recent},render:function(){return this.$el.html(this.template()),this.viewRecentPicker=new Common.UI.DataView({el:$("#id-recent-view"),store:new Common.UI.DataViewStore(this.recent),itemTemplate:_.template(['<div class="recent-wrap">','<div class="recent-icon">',"<svg>",'<use xlink:href="#svg-file-recent"></use>',"</svg>","</div>",'<div class="file-name"><% if (typeof title !== "undefined") {%><%= Common.Utils.String.htmlEncode(title || "") %><% } %></div>','<div class="file-info"><% if (typeof folder !== "undefined") {%><%= Common.Utils.String.htmlEncode(folder || "") %><% } %></div>',"</div>"].join(""))}),this.viewRecentPicker.on("item:click",_.bind(this.onRecentFileClick,this)),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el,suppressScrollX:!0,alwaysVisibleY:!0})),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.scroller&&this.scroller.update()},onRecentFileClick:function(t,e,i){this.menu&&this.menu.fireEvent("recent:open",[this.menu,i.get("url")])}}),DE.Views.FileMenuPanels.CreateNew=Common.UI.BaseView.extend(_.extend({el:"#panel-createnew",menu:void 0,events:function(){return{"click .blank-document-btn":_.bind(this._onBlankDocument,this),"click .thumb-list .thumb-wrap":_.bind(this._onDocumentTemplate,this)}},template:_.template(['<h3 style="margin-top: 20px;"><%= scope.fromBlankText %></h3><hr noshade />','<div class="blank-document">','<div class="blank-document-btn">','<svg class="btn-blank-format">','<use xlink:href="#svg-format-blank"></use>',"</svg>","</div>",'<div class="blank-document-info">',"<h3><%= scope.newDocumentText %></h3>","<%= scope.newDescriptionText %>","</div>","</div>","<h3><%= scope.fromTemplateText %></h3><hr noshade />",'<div class="thumb-list">',"<% _.each(docs, function(item) { %>",'<div class="thumb-wrap" template="<%= item.url %>">','<div class="thumb"',"<% if (!_.isEmpty(item.image)) { %> ",' style="background-image: url(<%= item.image %>);">',"<% } else { print(\"><svg class='btn-blank-format'><use xlink:href='#svg-file-template'></use></svg>\") } %>","</div>",'<div class="title"><%= Common.Utils.String.htmlEncode(item.title || item.name || "") %></div>',"</div>","<% }) %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=t.menu},render:function(){return this.$el.html(this.template({scope:this,docs:this.options[0].docs})),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el,suppressScrollX:!0,alwaysVisibleY:!0})),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.scroller&&this.scroller.update()},_onBlankDocument:function(){this.menu&&this.menu.fireEvent("create:new",[this.menu,"blank"])},_onDocumentTemplate:function(t){this.menu&&this.menu.fireEvent("create:new",[this.menu,t.currentTarget.attributes.template.value])},fromBlankText:"From Blank",newDocumentText:"New Text Document",newDescriptionText:"Create a new blank text document which you will be able to style and format after it is created during the editing. Or choose one of the templates to start a document of a certain type or purpose where some styles have already been pre-applied.",fromTemplateText:"From Template",noTemplatesText:"There are no templates"},DE.Views.FileMenuPanels.CreateNew||{})),DE.Views.FileMenuPanels.DocumentInfo=Common.UI.BaseView.extend(_.extend({el:"#panel-info",menu:void 0,initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.rendered=!1,this.template=_.template(['<div class="flex-settings">','<table class="main" style="margin: 30px 0 0;">',"<tr>",'<td class="left"><label>'+this.txtPlacement+"</label></td>",'<td class="right"><label id="id-info-placement">-</label></td>',"</tr>","<tr>",'<td class="left"><label>'+this.txtOwner+"</label></td>",'<td class="right"><label id="id-info-owner">-</label></td>',"</tr>","<tr>",'<td class="left"><label>'+this.txtUploaded+"</label></td>",'<td class="right"><label id="id-info-uploaded">-</label></td>',"</tr>",'<tr class="divider general"></tr>','<tr class="divider general"></tr>',"<tr>",'<td class="left"><label>'+this.txtPages+"</label></td>",'<td class="right"><label id="id-info-pages"></label></td>',"</tr>","<tr>",'<td class="left"><label>'+this.txtParagraphs+"</label></td>",'<td class="right"><label id="id-info-paragraphs"></label></td>',"</tr>","<tr>",'<td class="left"><label>'+this.txtWords+"</label></td>",'<td class="right"><label id="id-info-words"></label></td>',"</tr>","<tr>",'<td class="left"><label>'+this.txtSymbols+"</label></td>",'<td class="right"><label id="id-info-symbols"></label></td>',"</tr>","<tr>",'<td class="left"><label>'+this.txtSpaces+"</label></td>",'<td class="right"><label id="id-info-spaces"></label></td>',"</tr>",'<tr class="divider"></tr>','<tr class="divider"></tr>',"<tr>",'<td class="left"><label>'+this.txtTitle+"</label></td>",'<td class="right"><div id="id-info-title"></div></td>',"</tr>","<tr>",'<td class="left"><label>'+this.txtSubject+"</label></td>",'<td class="right"><div id="id-info-subject"></div></td>',"</tr>","<tr>",'<td class="left"><label>'+this.txtComment+"</label></td>",'<td class="right"><div id="id-info-comment"></div></td>',"</tr>",'<tr class="divider"></tr>','<tr class="divider"></tr>',"<tr>",'<td class="left"><label>'+this.txtModifyDate+"</label></td>",'<td class="right"><label id="id-info-modify-date"></label></td>',"</tr>","<tr>",'<td class="left"><label>'+this.txtModifyBy+"</label></td>",'<td class="right"><label id="id-info-modify-by"></label></td>',"</tr>",'<tr class="divider modify">','<tr class="divider modify">',"<tr>",'<td class="left"><label>'+this.txtCreated+"</label></td>",'<td class="right"><label id="id-info-date"></label></td>',"</tr>","<tr>",'<td class="left"><label>'+this.txtAppName+"</label></td>",'<td class="right"><label id="id-info-appname"></label></td>',"</tr>","<tr>",'<td class="left" style="vertical-align: top;"><label style="margin-top: 3px;">'+this.txtAuthor+"</label></td>",'<td class="right" style="vertical-align: top;"><div id="id-info-author">',"<table>","<tr>",'<td><div id="id-info-add-author"><input type="text" spellcheck="false" class="form-control" placeholder="'+this.txtAddAuthor+'"></div></td>',"</tr>","</table>","</div></td>","</tr>",'<tr style="height: 5px;"></tr>',"</table>","</div>",'<div id="fms-flex-apply">','<table class="main" style="margin: 10px 0;">',"<tr>",'<td class="left"></td>','<td class="right"><button id="fminfo-btn-apply" class="btn normal dlg-btn primary"><%= scope.okButtonText %></button></td>',"</tr>","</table>","</div>"].join("")),this.infoObj={PageCount:0,WordsCount:0,ParagraphCount:0,SymbolsCount:0,SymbolsWSCount:0},this.inProgress=!1,this.menu=t.menu,this.coreProps=null,this.authors=[],this._locked=!1},render:function(t){var e=this,i=$(e.template({scope:e}));this.lblPlacement=i.findById("#id-info-placement"),this.lblOwner=i.findById("#id-info-owner"),this.lblUploaded=i.findById("#id-info-uploaded"),this.lblStatPages=i.findById("#id-info-pages"),this.lblStatWords=i.findById("#id-info-words"),this.lblStatParagraphs=i.findById("#id-info-paragraphs"),this.lblStatSymbols=i.findById("#id-info-symbols"),this.lblStatSpaces=i.findById("#id-info-spaces");var n=function(t,e){if(e.keyCode===Common.UI.Keys.ESC){var i=t._input.val(),n=t.getValue();i!==n&&(t.setValue(n),e.stopPropagation())}};return this.inputTitle=new Common.UI.InputField({el:i.findById("#id-info-title"),style:"width: 200px;",placeHolder:this.txtAddText,validateOnBlur:!1}).on("keydown:before",n),this.inputSubject=new Common.UI.InputField({el:i.findById("#id-info-subject"),style:"width: 200px;",placeHolder:this.txtAddText,validateOnBlur:!1}).on("keydown:before",n),this.inputComment=new Common.UI.InputField({el:i.findById("#id-info-comment"),style:"width: 200px;",placeHolder:this.txtAddText,validateOnBlur:!1}).on("keydown:before",n),this.lblModifyDate=i.findById("#id-info-modify-date"),this.lblModifyBy=i.findById("#id-info-modify-by"),this.lblDate=i.findById("#id-info-date"),this.lblApplication=i.findById("#id-info-appname"),this.tblAuthor=i.findById("#id-info-author table"),this.trAuthor=i.findById("#id-info-add-author").closest("tr"),this.authorTpl='<tr><td><div style="display: inline-block;width: 200px;"><input type="text" spellcheck="false" class="form-control" readonly="true" value="{0}" ></div><div class="close img-commonctrl"></div></td></tr>',this.tblAuthor.on("click",function(t){var n=i.find(t.target);if(n.hasClass("close")&&!n.hasClass("disabled")){var o=n.closest("tr"),s=e.tblAuthor.find("tr").index(o);o.remove(),e.authors.splice(s,1),e.updateScroller(!0)}}),this.inputAuthor=new Common.UI.InputField({el:i.findById("#id-info-add-author"),style:"width: 200px;",validateOnBlur:!1,placeHolder:this.txtAddAuthor}).on("changed:after",function(t,i,n,o){if(i!=n){var s=i.trim();if(s&&s!==n.trim()){var a=o&&o.relatedTarget&&"fminfo-btn-apply"==o.relatedTarget.id;s.split(/\s*[,;]\s*/).forEach(function(t){var i=t.trim();if(i&&(e.authors.push(t),!a)){var n=$(Common.Utils.String.format(e.authorTpl,Common.Utils.String.htmlEncode(i)));e.trAuthor.before(n),e.updateScroller()}}),!a&&e.inputAuthor.setValue("")}}}).on("keydown:before",n),this.btnApply=new Common.UI.Button({el:i.findById("#fminfo-btn-apply")}),this.btnApply.on("click",_.bind(this.applySettings,this)),this.pnlInfo=i.find(".flex-settings").addBack().filter(".flex-settings"),this.pnlApply=i.findById("#fms-flex-apply"),this.rendered=!0,this.updateInfo(this.doc),this.$el=$(t).html(i),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.pnlInfo,suppressScrollX:!0,alwaysVisibleY:!0})),Common.NotificationCenter.on({"window:resize":function(){e.isVisible()&&e.updateScroller()}}),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.updateStatisticInfo(),this.updateFileInfo(),this.scroller&&this.scroller.scrollTop(0),this.updateScroller()},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments),this.stopUpdatingStatisticInfo()},updateScroller:function(t){this.scroller&&(this.scroller.update(t?{}:void 0),this.pnlInfo.toggleClass("bordered",this.scroller.isVisible()))},updateInfo:function(t){if(this.doc=t,this.rendered){var e=!1;if(t=t||{},t.info){t.info.folder&&this.lblPlacement.text(t.info.folder),e=this._ShowHideInfoItem(this.lblPlacement,void 0!==t.info.folder&&null!==t.info.folder)||e;var i=t.info.owner;i&&this.lblOwner.text(i),e=this._ShowHideInfoItem(this.lblOwner,!!i)||e,i=t.info.uploaded,i&&this.lblUploaded.text(i),e=this._ShowHideInfoItem(this.lblUploaded,!!i)||e}else this._ShowHideDocInfo(!1);$("tr.divider.general",this.el)[e?"show":"hide"]();var n=this.api?this.api.asc_getAppProps():null;if(n&&(n=(n.asc_getApplication()||"")+(n.asc_getAppVersion()?" ":"")+(n.asc_getAppVersion()||""),this.lblApplication.text(n)),this._ShowHideInfoItem(this.lblApplication,!!n),this.coreProps=this.api?this.api.asc_getCoreProps():null,this.coreProps){var i=this.coreProps.asc_getCreated();i&&this.lblDate.text(i.toLocaleString(this.mode.lang,{year:"numeric",month:"2-digit",day:"2-digit"})+" "+i.toLocaleString(this.mode.lang,{timeStyle:"short"})),this._ShowHideInfoItem(this.lblDate,!!i)}}},updateFileInfo:function(){if(this.rendered){var t,e=this,i=this.api?this.api.asc_getCoreProps():null;if(this.coreProps=i,i){var n=!1;t=i.asc_getModified(),t&&this.lblModifyDate.text(t.toLocaleString(this.mode.lang,{year:"numeric",month:"2-digit",day:"2-digit"})+" "+t.toLocaleString(this.mode.lang,{timeStyle:"short"})),n=this._ShowHideInfoItem(this.lblModifyDate,!!t)||n,t=i.asc_getLastModifiedBy(),t&&this.lblModifyBy.text(AscCommon.UserInfoParser.getParsedName(t)),n=this._ShowHideInfoItem(this.lblModifyBy,!!t)||n,$("tr.divider.modify",this.el)[n?"show":"hide"](),t=i.asc_getTitle(),this.inputTitle.setValue(t||""),t=i.asc_getSubject(),this.inputSubject.setValue(t||""),t=i.asc_getDescription(),this.inputComment.setValue(t||""),this.inputAuthor.setValue(""),this.tblAuthor.find("tr:not(:last-of-type)").remove(),this.authors=[],t=i.asc_getCreator(),t&&t.split(/\s*[,;]\s*/).forEach(function(t){var i=$(Common.Utils.String.format(e.authorTpl,Common.Utils.String.htmlEncode(t)));e.trAuthor.before(i),e.authors.push(t)}),this.tblAuthor.find(".close").toggleClass("hidden",!this.mode.isEdit),!this.mode.isEdit&&this._ShowHideInfoItem(this.tblAuthor,!!this.authors.length)}this.SetDisabled()}},_ShowHideInfoItem:function(t,e){return t.closest("tr")[e?"show":"hide"](),e},_ShowHideDocInfo:function(t){this._ShowHideInfoItem(this.lblPlacement,t),this._ShowHideInfoItem(this.lblOwner,t),this._ShowHideInfoItem(this.lblUploaded,t)},updateStatisticInfo:function(){this.api&&this.doc&&this.api.startGetDocInfo()},stopUpdatingStatisticInfo:function(){this.api&&this.api.stopGetDocInfo()},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onGetDocInfoStart",_.bind(this._onGetDocInfoStart,this)),this.api.asc_registerCallback("asc_onGetDocInfoStop",_.bind(this._onGetDocInfoEnd,this)),this.api.asc_registerCallback("asc_onDocInfo",_.bind(this._onDocInfo,this)),this.api.asc_registerCallback("asc_onGetDocInfoEnd",_.bind(this._onGetDocInfoEnd,this)),this.api.asc_registerCallback("asc_onLockCore",_.bind(this.onLockCore,this)),this.updateInfo(this.doc),this},setMode:function(t){return this.mode=t,this.inputAuthor.setVisible(t.isEdit),this.pnlApply.toggleClass("hidden",!t.isEdit),this.tblAuthor.find(".close").toggleClass("hidden",!t.isEdit),t.isEdit||(this.inputTitle._input.attr("placeholder",""),this.inputSubject._input.attr("placeholder",""),this.inputComment._input.attr("placeholder",""),this.inputAuthor._input.attr("placeholder","")),this.SetDisabled(),this},_onGetDocInfoStart:function(){var t=this;this.inProgress=!0,this.infoObj={PageCount:0,WordsCount:0,ParagraphCount:0,SymbolsCount:0,SymbolsWSCount:0},_.defer(function(){t.inProgress&&(t.lblStatPages.text(t.txtLoading),t.lblStatWords.text(t.txtLoading),t.lblStatParagraphs.text(t.txtLoading),t.lblStatSymbols.text(t.txtLoading),t.lblStatSpaces.text(t.txtLoading))},2e3)},_onDocInfo:function(t){t&&(t.get_PageCount()>-1&&(this.infoObj.PageCount=t.get_PageCount()),t.get_WordsCount()>-1&&(this.infoObj.WordsCount=t.get_WordsCount()),t.get_ParagraphCount()>-1&&(this.infoObj.ParagraphCount=t.get_ParagraphCount()),t.get_SymbolsCount()>-1&&(this.infoObj.SymbolsCount=t.get_SymbolsCount()),t.get_SymbolsWSCount()>-1&&(this.infoObj.SymbolsWSCount=t.get_SymbolsWSCount()))},_onGetDocInfoEnd:function(){this.inProgress=!1,this.lblStatPages.text(this.infoObj.PageCount),this.lblStatWords.text(this.infoObj.WordsCount),this.lblStatParagraphs.text(this.infoObj.ParagraphCount),this.lblStatSymbols.text(this.infoObj.SymbolsCount),this.lblStatSpaces.text(this.infoObj.SymbolsWSCount)},onDocumentName:function(t){},onLockCore:function(t){this._locked=t,this.updateFileInfo()},SetDisabled:function(){var t=!this.mode.isEdit||this._locked;this.inputTitle.setDisabled(t),this.inputSubject.setDisabled(t),this.inputComment.setDisabled(t),this.inputAuthor.setDisabled(t),this.tblAuthor.find(".close").toggleClass("disabled",this._locked),this.tblAuthor.toggleClass("disabled",t),this.btnApply.setDisabled(this._locked)},applySettings:function(){this.coreProps&&this.api&&(this.coreProps.asc_putTitle(this.inputTitle.getValue()),this.coreProps.asc_putSubject(this.inputSubject.getValue()),this.coreProps.asc_putDescription(this.inputComment.getValue()),this.coreProps.asc_putCreator(this.authors.join(";")),this.api.asc_setCoreProps(this.coreProps)),this.menu.hide()},txtPlacement:"Location",txtOwner:"Owner",txtUploaded:"Uploaded",txtPages:"Pages",txtWords:"Words",txtParagraphs:"Paragraphs",txtSymbols:"Symbols",txtSpaces:"Symbols with spaces",txtLoading:"Loading...",txtAppName:"Application",txtEditTime:"Total Editing time",txtTitle:"Title",txtSubject:"Subject",txtComment:"Comment",txtModifyDate:"Last Modified",txtModifyBy:"Last Modified By",txtCreated:"Created",txtAuthor:"Author",txtAddAuthor:"Add Author",txtAddText:"Add Text",txtMinutes:"min",okButtonText:"Apply"},DE.Views.FileMenuPanels.DocumentInfo||{})),DE.Views.FileMenuPanels.DocumentRights=Common.UI.BaseView.extend(_.extend({el:"#panel-rights",menu:void 0,initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.rendered=!1,this.template=_.template(['<table class="main" style="margin: 30px 0;">','<tr class="rights">','<td class="left" style="vertical-align: top;"><label>'+this.txtRights+"</label></td>",'<td class="right"><div id="id-info-rights"></div></td>',"</tr>",'<tr class="edit-rights">','<td class="left"></td><td class="right"><button id="id-info-btn-edit" class="btn normal dlg-btn primary custom" style="margin-right: 10px;">'+this.txtBtnAccessRights+"</button></td>","</tr>","</table>"].join("")),this.templateRights=_.template(["<table>","<% _.each(users, function(item) { %>","<tr>",'<td><span class="userLink img-commonctrl  <% if (item.isLink) { %>sharedLink<% } %>"></span><span><%= Common.Utils.String.htmlEncode(item.user) %></span></td>',"<td><%= Common.Utils.String.htmlEncode(item.permissions) %></td>","</tr>","<% }); %>","</table>"].join("")),this.menu=t.menu},render:function(t){var e=$(this.template());return this.cntRights=e.findById("#id-info-rights"),this.btnEditRights=new Common.UI.Button({el:e.elementById("#id-info-btn-edit")}),this.btnEditRights.on("click",_.bind(this.changeAccessRights,this)),this.rendered=!0,this.updateInfo(this.doc),Common.NotificationCenter.on("collaboration:sharingupdate",this.updateSharingSettings.bind(this)),Common.NotificationCenter.on("collaboration:sharingdeny",this.onLostEditRights.bind(this)),this.$el=$(t).html(e),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el,suppressScrollX:!0,alwaysVisibleY:!0})),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.scroller&&this.scroller.update()},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments)},updateInfo:function(t){this.doc=t,this.rendered&&(t=t||{},t.info?(t.info.sharingSettings&&this.cntRights.html(this.templateRights({users:t.info.sharingSettings})),this._ShowHideInfoItem("rights",void 0!==t.info.sharingSettings&&null!==t.info.sharingSettings&&t.info.sharingSettings.length>0),this._ShowHideInfoItem("edit-rights",(!!this.sharingSettingsUrl&&this.sharingSettingsUrl.length||this.mode.canRequestSharingSettings)&&!0!==this._readonlyRights)):this._ShowHideDocInfo(!1))},_ShowHideInfoItem:function(t,e){$("tr."+t,this.el)[e?"show":"hide"]()},_ShowHideDocInfo:function(t){this._ShowHideInfoItem("rights",t),this._ShowHideInfoItem("edit-rights",t)},setApi:function(t){return this.api=t,this},setMode:function(t){return this.mode=t,this.sharingSettingsUrl=t.sharingSettingsUrl,this},changeAccessRights:function(t,e,i){Common.NotificationCenter.trigger("collaboration:sharing")},updateSharingSettings:function(t){this._ShowHideInfoItem("rights",void 0!==this.doc.info.sharingSettings&&null!==this.doc.info.sharingSettings&&this.doc.info.sharingSettings.length>0),this.cntRights.html(this.templateRights({users:this.doc.info.sharingSettings}))},onLostEditRights:function(){this._readonlyRights=!0,this.rendered&&this._ShowHideInfoItem("edit-rights",!1)},txtRights:"Persons who have rights",txtBtnAccessRights:"Change access rights"},DE.Views.FileMenuPanels.DocumentRights||{})),DE.Views.FileMenuPanels.Help=Common.UI.BaseView.extend({el:"#panel-help",menu:void 0,template:_.template(['<div style="width:100%; height:100%; position: relative;">','<div id="id-help-contents" style="position: absolute; width:220px; top: 0; bottom: 0;" class="no-padding"></div>','<div id="id-help-frame" style="position: absolute; left: 220px; top: 0; right: 0; bottom: 0;" class="no-padding"></div>',"</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=t.menu,this.urlPref="resources/help/en/",this.openUrl=null,this.en_data=[{src:"ProgramInterface/ProgramInterface.htm",name:"Introducing Document Editor user interface",headername:"Program Interface"},{src:"ProgramInterface/FileTab.htm",name:"File tab"},{src:"ProgramInterface/HomeTab.htm",name:"Home Tab"},{src:"ProgramInterface/InsertTab.htm",name:"Insert tab"},{src:"ProgramInterface/LayoutTab.htm",name:"Layout tab"},{src:"ProgramInterface/ReviewTab.htm",name:"Review tab"},{src:"ProgramInterface/PluginsTab.htm",name:"Plugins tab"},{src:"UsageInstructions/ChangeColorScheme.htm",name:"Change color scheme",headername:"Basic operations"},{src:"UsageInstructions/CopyPasteUndoRedo.htm",name:"Copy/paste text passages, undo/redo your actions"},{src:"UsageInstructions/OpenCreateNew.htm",
name:"Create a new document or open an existing one"},{src:"UsageInstructions/SetPageParameters.htm",name:"Set page parameters",headername:"Page formatting"},{src:"UsageInstructions/NonprintingCharacters.htm",name:"Show/hide nonprinting characters"},{src:"UsageInstructions/SectionBreaks.htm",name:"Insert section breaks"},{src:"UsageInstructions/InsertHeadersFooters.htm",name:"Insert headers and footers"},{src:"UsageInstructions/InsertPageNumbers.htm",name:"Insert page numbers"},{src:"UsageInstructions/InsertFootnotes.htm",name:"Insert footnotes"},{src:"UsageInstructions/AlignText.htm",name:"Align your text in a paragraph",headername:"Paragraph formatting"},{src:"UsageInstructions/BackgroundColor.htm",name:"Select background color for a paragraph"},{src:"UsageInstructions/ParagraphIndents.htm",name:"Change paragraph indents"},{src:"UsageInstructions/LineSpacing.htm",name:"Set paragraph line spacing"},{src:"UsageInstructions/PageBreaks.htm",name:"Insert page breaks"},{src:"UsageInstructions/AddBorders.htm",name:"Add borders"},{src:"UsageInstructions/SetTabStops.htm",name:"Set tab stops"},{src:"UsageInstructions/CreateLists.htm",name:"Create lists"},{src:"UsageInstructions/FormattingPresets.htm",name:"Apply formatting styles",headername:"Text formatting"},{src:"UsageInstructions/FontTypeSizeColor.htm",name:"Set font type, size, and color"},{src:"UsageInstructions/DecorationStyles.htm",name:"Apply font decoration styles"},{src:"UsageInstructions/CopyClearFormatting.htm",name:"Copy/clear text formatting"},{src:"UsageInstructions/AddHyperlinks.htm",name:"Add hyperlinks"},{src:"UsageInstructions/InsertDropCap.htm",name:"Insert a drop cap"},{src:"UsageInstructions/InsertTables.htm",name:"Insert tables",headername:"Operations on objects"},{src:"UsageInstructions/InsertImages.htm",name:"Insert images"},{src:"UsageInstructions/InsertAutoshapes.htm",name:"Insert autoshapes"},{src:"UsageInstructions/InsertCharts.htm",name:"Insert charts"},{src:"UsageInstructions/InsertTextObjects.htm",name:"Insert text objects"},{src:"UsageInstructions/AlignArrangeObjects.htm",name:"Align and arrange objects on a page"},{src:"UsageInstructions/ChangeWrappingStyle.htm",name:"Change wrapping style"},{src:"UsageInstructions/UseMailMerge.htm",name:"Use mail merge",headername:"Mail Merge"},{src:"UsageInstructions/InsertEquation.htm",name:"Insert equations",headername:"Math equations"},{src:"HelpfulHints/CollaborativeEditing.htm",name:"Collaborative document editing",headername:"Document co-editing"},{src:"HelpfulHints/Review.htm",name:"Document Review"},{src:"UsageInstructions/ViewDocInfo.htm",name:"View document information",headername:"Tools and settings"},{src:"UsageInstructions/SavePrintDownload.htm",name:"Save/download/print your document"},{src:"HelpfulHints/AdvancedSettings.htm",name:"Advanced settings of Document Editor"},{src:"HelpfulHints/Navigation.htm",name:"View settings and navigation tools"},{src:"HelpfulHints/Search.htm",name:"Search and replace function"},{src:"HelpfulHints/SpellChecking.htm",name:"Spell-checking"},{src:"HelpfulHints/About.htm",name:"About Document Editor",headername:"Helpful hints"},{src:"HelpfulHints/SupportedFormats.htm",name:"Supported formats of electronic documents"},{src:"HelpfulHints/KeyboardShortcuts.htm",name:"Keyboard shortcuts"}],Common.Utils.isIE&&(window.onhelp=function(){return!1})},render:function(){var t=this;return this.$el.html(this.template()),this.viewHelpPicker=new Common.UI.DataView({el:$("#id-help-contents"),store:new Common.UI.DataViewStore([]),keyMoveDirection:"vertical",itemTemplate:_.template(['<div id="<%= id %>" class="help-item-wrap">','<div class="caption"><%= name %></div>',"</div>"].join(""))}),this.viewHelpPicker.on("item:add",function(t,e,i){i.has("headername")&&$(e.el).before('<div class="header-name">'+i.get("headername")+"</div>")}),this.viewHelpPicker.on("item:select",function(e,i,n){t.onSelectItem(n.get("src"))}),this.iFrame=document.createElement("iframe"),this.iFrame.src="",this.iFrame.align="top",this.iFrame.frameBorder="0",this.iFrame.width="100%",this.iFrame.height="100%",Common.Gateway.on("internalcommand",function(e){if("help:hyperlink"==e.type){var i=e.data,n=t.viewHelpPicker.store.find(function(t){return i.indexOf(t.get("src"))>0});n&&(t.viewHelpPicker.selectRecord(n,!0),t.viewHelpPicker.scrollToRecord(n))}}),$("#id-help-frame").append(this.iFrame),this},setLangConfig:function(t){var e=this,i=this.viewHelpPicker.store;if(t){t=t.split(/[\-\_]/)[0];var n={dataType:"json",error:function(){e.urlPref.indexOf("resources/help/en/")<0?(e.urlPref="resources/help/en/",i.url="resources/help/en/Contents.json",i.fetch(n)):(e.urlPref="resources/help/en/",i.reset(e.en_data))},success:function(){var t=e.openUrl?i.find(function(t){return e.openUrl.indexOf(t.get("src"))>=0}):i.at(0);t&&(e.viewHelpPicker.selectRecord(t,!0),e.viewHelpPicker.scrollToRecord(t)),e.onSelectItem(e.openUrl?e.openUrl:t.get("src"))}};i.url="resources/help/"+t+"/Contents.json",i.fetch(n),this.urlPref="resources/help/"+t+"/"}},show:function(t){if(Common.UI.BaseView.prototype.show.call(this),this._scrollerInited||(this.viewHelpPicker.scroller.update(),this._scrollerInited=!0),t)if(this.viewHelpPicker.store.length>0){var e=this.viewHelpPicker.store.find(function(e){return t.indexOf(e.get("src"))>=0});e&&(this.viewHelpPicker.selectRecord(e,!0),this.viewHelpPicker.scrollToRecord(e)),this.onSelectItem(t)}else this.openUrl=t},onSelectItem:function(t){this.iFrame.src=this.urlPref+t}}),DE.Views.FileMenuPanels.ProtectDoc=Common.UI.BaseView.extend(_.extend({el:"#panel-protect",menu:void 0,template:_.template(['<label id="id-fms-lbl-protect-header" style="font-size: 18px;"><%= scope.strProtect %></label>','<div id="id-fms-password">','<label class="header"><%= scope.strEncrypt %></label>','<div id="fms-btn-add-pwd" style="width:190px;"></div>','<table id="id-fms-view-pwd" cols="2" width="300">',"<tr>",'<td colspan="2"><label style="cursor: default;"><%= scope.txtEncrypted %></label></td>',"</tr>","<tr>",'<td><div id="fms-btn-change-pwd" style="width:190px;"></div></td>','<td align="right"><div id="fms-btn-delete-pwd" style="width:190px; margin-left:20px;"></div></td>',"</tr>","</table>","</div>",'<div id="id-fms-signature">','<label class="header"><%= scope.strSignature %></label>','<div id="fms-btn-invisible-sign" style="width:190px; margin-bottom: 20px;"></div>','<div id="id-fms-signature-view"></div>',"</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=t.menu;var e=this;this.templateSignature=_.template(['<table cols="2" width="300" class="<% if (!hasRequested && !hasSigned) { %>hidden<% } %>"">',"<tr>",'<td colspan="2"><label style="cursor: default;"><%= tipText %></label></td>',"</tr>","<tr>",'<td><label class="link signature-view-link">'+e.txtView+"</label></td>",'<td align="right"><label class="link signature-edit-link <% if (!hasSigned) { %>hidden<% } %>">'+e.txtEdit+"</label></td>","</tr>","</table>"].join(""))},render:function(){this.$el.html(this.template({scope:this}));var t=DE.getController("Common.Controllers.Protection").getView();return this.btnAddPwd=t.getButton("add-password"),this.btnAddPwd.render(this.$el.find("#fms-btn-add-pwd")),this.btnAddPwd.on("click",_.bind(this.closeMenu,this)),this.btnChangePwd=t.getButton("change-password"),this.btnChangePwd.render(this.$el.find("#fms-btn-change-pwd")),this.btnChangePwd.on("click",_.bind(this.closeMenu,this)),this.btnDeletePwd=t.getButton("del-password"),this.btnDeletePwd.render(this.$el.find("#fms-btn-delete-pwd")),this.btnDeletePwd.on("click",_.bind(this.closeMenu,this)),this.cntPassword=$("#id-fms-password"),this.cntPasswordView=$("#id-fms-view-pwd"),this.btnAddInvisibleSign=t.getButton("signature"),this.btnAddInvisibleSign.render(this.$el.find("#fms-btn-invisible-sign")),this.btnAddInvisibleSign.on("click",_.bind(this.closeMenu,this)),this.cntSignature=$("#id-fms-signature"),this.cntSignatureView=$("#id-fms-signature-view"),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el,suppressScrollX:!0,alwaysVisibleY:!0})),this.$el.on("click",".signature-edit-link",_.bind(this.onEdit,this)),this.$el.on("click",".signature-view-link",_.bind(this.onView,this)),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.updateSignatures(),this.updateEncrypt(),this.scroller&&this.scroller.update()},setMode:function(t){this.mode=t,this.cntSignature.toggleClass("hidden",!this.mode.isSignatureSupport),this.cntPassword.toggleClass("hidden",!this.mode.isPasswordSupport)},setApi:function(t){return this.api=t,this},closeMenu:function(){this.menu&&this.menu.hide()},onEdit:function(){this.menu&&this.menu.hide();var t=this;Common.UI.warning({title:this.notcriticalErrorTitle,msg:this.txtEditWarning,buttons:["ok","cancel"],primary:"ok",callback:function(e){"ok"==e&&t.api.asc_RemoveAllSignatures()}})},onView:function(){this.menu&&this.menu.hide(),DE.getController("RightMenu").rightmenu.SetActivePane(Common.Utils.documentSettingsType.Signature,!0)},updateSignatures:function(){var t=this.api.asc_getRequestSignatures(),e=this.api.asc_getSignatures(),i=t&&t.length>0,n=!1,o=!1;_.each(e,function(t,e){0==t.asc_getValid()?n=!0:o=!0});var s=o?this.txtSignedInvalid:n?this.txtSigned:"";i&&(s=this.txtRequestedSignatures+(""!=s?"<br><br>":"")+s),this.cntSignatureView.html(this.templateSignature({tipText:s,hasSigned:n||o,hasRequested:i}))},updateEncrypt:function(){this.cntPasswordView.toggleClass("hidden",this.btnAddPwd.isVisible())},strProtect:"Protect Document",strSignature:"With Signature",txtView:"View signatures",txtEdit:"Edit document",txtSigned:"Valid signatures has been added to the document. The document is protected from editing.",txtSignedInvalid:"Some of the digital signatures in document are invalid or could not be verified. The document is protected from editing.",txtRequestedSignatures:"This document needs to be signed.",notcriticalErrorTitle:"Warning",txtEditWarning:"Editing will remove the signatures from the document.<br>Are you sure you want to continue?",strEncrypt:"With Password",txtEncrypted:"This document has been protected by password"},DE.Views.FileMenuPanels.ProtectDoc||{}))}),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/HistoryVersion",["underscore","backbone","common/main/lib/component/BaseView"],function(t,e){"use strict";Common.Models.HistoryVersion=e.Model.extend({defaults:function(){return{version:0,revision:0,changeid:void 0,userid:void 0,username:"Guest",usercolor:"#ff0000",created:void 0,id:Common.UI.getId(),url:"",urlDiff:"",urlGetTime:"",docId:"",docIdPrev:"",token:"",arrColors:[],markedAsVersion:!1,canRestore:!1,isRevision:!0,hasChanges:!1,isExpanded:!0,isVisible:!0,allowSelected:!0,selected:!1,serverVersion:0,fileType:"docx"}}})}),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/HistoryVersions",["underscore","backbone","common/main/lib/model/HistoryVersion"],function(t,e){"use strict";Common.Collections.HistoryVersions=e.Collection.extend({model:Common.Models.HistoryVersion,findRevision:function(t){return this.findWhere({revision:t})},findRevisions:function(t){return this.where({revision:t})},hasChanges:function(){return!!this.findWhere({isRevision:!1})},hasCollapsed:function(){return!!this.findWhere({isRevision:!0,hasChanges:!0,isExpanded:!1})}})}),define("common/main/lib/controller/History",["core","common/main/lib/collection/HistoryVersions","common/main/lib/view/History"],function(){"use strict";Common.Controllers.History=Backbone.Controller.extend(_.extend({models:[],collections:["Common.Collections.HistoryVersions"],views:["Common.Views.History"],initialize:function(){this.currentChangeId=-1,this.currentArrColors=[],this.currentDocId="",this.currentDocIdPrev="",this.currentRev=0,this.currentServerVersion=0},events:{},onLaunch:function(){this.panelHistory=this.createView("Common.Views.History",{storeHistory:this.getApplication().getCollection("Common.Collections.HistoryVersions")}),this.panelHistory.storeHistory.on("reset",_.bind(this.onResetStore,this)),this.panelHistory.on("render:after",_.bind(this.onAfterRender,this)),Common.Gateway.on("sethistorydata",_.bind(this.onSetHistoryData,this))},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onDownloadUrl",_.bind(this.onDownloadUrl,this)),this.api.asc_registerCallback("asc_onExpiredToken",_.bind(this.onExpiredToken,this)),this},setMode:function(t){this.mode=t,t.canHistoryClose||(this.panelHistory.$el.find("#history-header").hide(),this.panelHistory.$el.find("#history-list").css("padding-top",0))},onAfterRender:function(t){t.viewHistoryList.on("item:click",_.bind(this.onSelectRevision,this)),t.btnBackToDocument.on("click",_.bind(this.onClickBackToDocument,this)),t.btnExpand.on("click",_.bind(this.onClickExpand,this))},onResetStore:function(){var t=this.panelHistory.storeHistory.hasChanges();this.panelHistory.$el.find("#history-expand-changes")[t?"show":"hide"](),this.panelHistory.$el.find("#history-list").css("padding-bottom",t?"45px":0)},onDownloadUrl:function(t){void 0!==this.isFromSelectRevision&&Common.Gateway.requestRestore(this.isFromSelectRevision,t),this.isFromSelectRevision=void 0},onSelectRevision:function(t,e,i,n){if(n){var o=$(n.target);if(o&&o.hasClass("revision-restore")){if(i.get("isRevision"))Common.Gateway.requestRestore(i.get("revision"));else{this.isFromSelectRevision=i.get("revision");var s=Asc.c_oAscFileType[(i.get("fileType")||"").toUpperCase()]||Asc.c_oAscFileType.DOCX;this.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(s,!0))}return}}!t&&i&&this.panelHistory.viewHistoryList.scrollToRecord(i);var a=i.get("url"),r=i.get("revision"),l=new Date;if(this.currentChangeId=i.get("changeid"),this.currentArrColors=i.get("arrColors"),this.currentDocId=i.get("docId"),this.currentDocIdPrev=i.get("docIdPrev"),this.currentRev=r,this.currentServerVersion=i.get("serverVersion"),_.isEmpty(a)||l-i.get("urlGetTime")>3e5){var c=this;c.timerId||(c.timerId=setTimeout(function(){c.timerId=0},3e4),_.delay(function(){Common.Gateway.requestHistoryData(r)},10))}else{var d=this.getApplication().getController("Common.Controllers.Comments");d&&(d.onApiHideComment(),d.clearCollections());var h=i.get("urlDiff"),p=i.get("token"),m=new Asc.asc_CVersionHistory;m.asc_setDocId(_.isEmpty(h)?this.currentDocId:this.currentDocIdPrev),m.asc_setUrl(a),m.asc_setUrlChanges(h),m.asc_setCurrentChangeId(this.currentChangeId),m.asc_setArrColors(this.currentArrColors),m.asc_setToken(p),m.asc_setIsRequested(!1),m.asc_setServerVersion(this.currentServerVersion),this.api.asc_showRevision(m);var u=this.getApplication().getController("Common.Controllers.ReviewChanges");u&&u.onApiShowChange()}},onSetHistoryData:function(t){if(this.mode.canUseHistory)if(this.timerId&&(clearTimeout(this.timerId),this.timerId=0),t.data.error){var e={title:this.notcriticalErrorTitle,msg:t.data.error,iconCls:"warn",buttons:["ok"]};Common.UI.alert(e)}else{var i=this.getApplication().getController("Common.Controllers.Comments");i&&(i.onApiHideComment(),i.clearCollections());var n=t.data,o=this.getApplication().getCollection("Common.Collections.HistoryVersions");if(o&&null!==n){var s,a=o.findRevisions(n.version),r=new Date,l=t.data.previous&&void 0!==this.currentChangeId?t.data.changesUrl:null,c=!_.isEmpty(l)&&t.data.previous?t.data.previous.url:t.data.url,d=t.data.key?t.data.key:this.currentDocId,h=t.data.previous&&t.data.previous.key?t.data.previous.key:this.currentDocIdPrev,p=t.data.token;if(a&&a.length>0)for(var m=0;m<a.length;m++)s=a[m],s.set("url",c,{silent:!0}),s.set("urlDiff",l,{silent:!0}),s.set("urlGetTime",r,{silent:!0}),t.data.key&&(s.set("docId",d,{silent:!0}),s.set("docIdPrev",h,{silent:!0})),s.set("token",p,{silent:!0});var u=new Asc.asc_CVersionHistory;u.asc_setUrl(c),u.asc_setUrlChanges(l),u.asc_setDocId(_.isEmpty(l)?d:h),u.asc_setCurrentChangeId(this.currentChangeId),u.asc_setArrColors(this.currentArrColors),u.asc_setToken(p),u.asc_setIsRequested(!0),u.asc_setServerVersion(this.currentServerVersion),this.api.asc_showRevision(u),this.currentRev=n.version;var g=this.getApplication().getController("Common.Controllers.ReviewChanges");g&&g.onApiShowChange()}}},onExpiredToken:function(){var t=this;_.delay(function(){Common.Gateway.requestHistoryData(t.currentRev)},10)},onClickBackToDocument:function(){Common.Gateway.requestHistoryClose()},onClickExpand:function(){var t=this.panelHistory.storeHistory,e=t.hasCollapsed();t.where({isRevision:!0,hasChanges:!0,isExpanded:!e}).forEach(function(t){t.set("isExpanded",e)}),t.where({isRevision:!1}).forEach(function(t){t.set("isVisible",e)}),this.panelHistory.viewHistoryList.scroller.update({minScrollbarLength:40}),this.panelHistory.btnExpand.cmpEl.text(e?this.panelHistory.textHideAll:this.panelHistory.textShowAll)},notcriticalErrorTitle:"Warning"},Common.Controllers.History||{}))}),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/Comment",["underscore","backbone","common/main/lib/component/BaseView"],function(t,e){"use strict";Common.Models.Comment=e.Model.extend({defaults:{uid:0,guid:"",userid:0,username:"Guest",usercolor:null,date:void 0,quote:"",comment:"",resolved:!1,lock:!1,lockuserid:"",unattached:!1,userdata:"",id:Common.UI.getId(),time:0,showReply:!1,showReplyInPopover:!1,editText:!1,editTextInPopover:!1,last:void 0,replys:[],hideAddReply:!1,scope:null,hide:!1,hint:!1,dummy:void 0,editable:!0,removable:!0}}),Common.Models.Reply=e.Model.extend({defaults:{time:0,userid:0,username:"Guest",usercolor:null,reply:"",date:void 0,userdata:"",id:Common.UI.getId(),editText:!1,editTextInPopover:!1,scope:null,editable:!0,removable:!0,hide:!1}})}),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/Comments",["underscore","backbone","common/main/lib/model/Comment"],function(t,e){"use strict";Common.Collections.Comments=e.Collection.extend({model:Common.Models.Comment,groups:null,clearEditing:function(){this.each(function(t){t.set("editText",!1),t.set("editTextInPopover",!1),t.set("showReply",!1),t.set("showReplyInPopover",!1),t.set("hideAddReply",!1)})},getCommentsReplysCount:function(t){var e=0;return this.each(function(i){i.get("userid")==t&&e++;var n=i.get("replys");n&&n.length>0&&n.forEach(function(i){i.get("userid")==t&&e++})}),e}})}),define("text!common/main/lib/template/CommentsPopover.template",[],function(){return'<% if (!hide) { %>\r\n<div id="<%=id%>" class="user-comment-item">\r\n\r\n    \x3c!-- comment block --\x3e\r\n\r\n    <div class="user-name">\r\n        <div class="color" style="display: inline-block; background-color: <% if (usercolor!==null) { %><%=usercolor%><% } else { %> #cfcfcf <% } %>; " ></div><%= scope.getUserName(username) %>\r\n    </div>\r\n    <div class="user-date"><%=date%></div>\r\n    <% if (!editTextInPopover || hint) { %>\r\n        <div oo_editor_input="true" tabindex="-1" class="user-message user-select"><%=scope.pickLink(comment)%></div>\r\n    <% } else { %>\r\n        <div class="inner-edit-ct">\r\n            <textarea class="msg-reply user-select" maxlength="maxCommLength" spellcheck="false" <% if (!!dummy) { %> placeholder="textMention"<% } %>><%=comment%></textarea>\r\n            <% if (hideAddReply) { %>\r\n                <button class="btn normal dlg-btn primary btn-inner-edit" id="id-comments-change-popover">textAdd</button>\r\n            <% } else { %>\r\n                <button class="btn normal dlg-btn primary btn-inner-edit" id="id-comments-change-popover">textEdit</button>\r\n            <% } %>\r\n            <button class="btn normal dlg-btn btn-inner-close">textCancel</button>\r\n        </div>\r\n    <% } %>\r\n\r\n    \x3c!-- replys elements --\x3e\r\n\r\n    <% var add_arrow = true; %>\r\n    <% if (replys.length) { %>\r\n        <% _.each(replys, function (item) { %>\r\n            <% if (!item.get("hide")) { %>\r\n            <% if (add_arrow) { add_arrow = false; %>\r\n                <div class="reply-arrow img-commonctrl"></div>\r\n            <% } %>\r\n            <div class="reply-item-ct">\r\n                <div class="user-name">\r\n                    <div class="color" style="display: inline-block; background-color: <% if (item.get("usercolor")!==null) { %><%=item.get("usercolor")%><% } else { %> #cfcfcf <% } %>; " ></div><%= scope.getUserName(item.get("username")) %>\r\n                </div>\r\n                <div class="user-date"><%=item.get("date")%></div>\r\n                <% if (!item.get("editTextInPopover")) { %>\r\n                    <div oo_editor_input="true" tabindex="-1" class="user-message user-select"><%=scope.pickLink(item.get("reply"))%></div>\r\n                    <% if (!hint) { %>\r\n                        <div class="btns-reply-ct">\r\n                            <% if (item.get("editable")) { %>\r\n                                <div class="btn-edit img-commonctrl" data-value="<%=item.get("id")%>"></div>\r\n                            <%}%>\r\n                            <% if (item.get("removable")) { %>\r\n                               <div class="btn-delete img-commonctrl" data-value="<%=item.get("id")%>"></div>\r\n                            <%}%>\r\n                        </div>\r\n                    <%}%>\r\n                <% } else { %>\r\n                    <div class="inner-edit-ct">\r\n                        <textarea class="msg-reply textarea-fix user-select" maxlength="maxCommLength" spellcheck="false"><%=item.get("reply")%></textarea>\r\n                        <button class="btn normal dlg-btn primary btn-inner-edit btn-fix" id="id-comments-change-popover">textEdit</button>\r\n                        <button class="btn normal dlg-btn btn-inner-close">textClose</button>\r\n                    </div>\r\n                <% } %>\r\n            </div>\r\n            <% } %>\r\n        <% }); %>\r\n    <% } %>\r\n\r\n    \x3c!-- add reply button --\x3e\r\n\r\n    <% if (!showReplyInPopover && !hideAddReply && !hint) { %>\r\n        <% if (replys.length && !add_arrow) { %>\r\n            <label class="user-reply" style="margin-left: 20px; margin-top: 5px;" role="presentation" tabindex="-1">textAddReply</label>\r\n        <% } else { %>\r\n            <label class="user-reply" role="presentation" tabindex="-1">textAddReply</label>\r\n        <% } %>\r\n    <% } %>\r\n\r\n    \x3c!-- edit buttons --\x3e\r\n\r\n    <% if (!editTextInPopover && !lock && !hint) { %>\r\n        <div class="edit-ct">\r\n            <% if (editable) { %>\r\n                <div class="btn-edit img-commonctrl"></div>\r\n            <% } %>\r\n            <% if (removable) { %>\r\n                <div class="btn-delete img-commonctrl"></div>\r\n            <% } %>\r\n            <% if (editable) { %>\r\n            <div class="btn-resolve <% if (resolved) print(\'comment-resolved\') %>" data-toggle="tooltip"></div>\r\n            <% } %>\r\n        </div>\r\n    <% } %>\r\n\r\n    \x3c!-- reply --\x3e\r\n\r\n    <% if (showReplyInPopover) { %>\r\n        <div class="reply-ct">\r\n            <textarea class="msg-reply user-select" placeholder="textAddReply" maxlength="maxCommLength" spellcheck="false"></textarea>\r\n            <button class="btn normal dlg-btn primary btn-reply" id="id-comments-change-popover">textReply</button>\r\n            <button class="btn normal dlg-btn btn-close">textClose</button>\r\n        </div>\r\n    <% } %>\r\n\r\n    \x3c!-- locked user --\x3e\r\n\r\n    <% if (lock) { %>\r\n        <div class="lock-area" style="cursor: default;"></div>\r\n        <div class="lock-author" style="cursor: default;"><%=lockuserid%></div>\r\n    <% } %>\r\n\r\n</div>\r\n<% } %>'}),define("text!common/main/lib/template/ReviewChangesPopover.template",[],function(){return'<div id="<%=id%>" class="user-comment-item">\r\n    <div class="user-name">\r\n        <div class="color" style="display: inline-block; background-color: <% if (usercolor!==null) { %><%=usercolor%><% } else { %> #cfcfcf <% } %>; " ></div><%= scope.getUserName(username) %>\r\n    </div>\r\n    <div class="user-date"><%=date%></div>\r\n    <div class="user-message limit-height"><%=changetext%></div>\r\n    <div class="edit-ct">\r\n        <% if (goto) { %>\r\n        <div class="btn-goto img-commonctrl"></div>\r\n        <% } %>\r\n        <% if (!hint) { %>\r\n            <% if (scope.appConfig.isReviewOnly) { %>\r\n                <% if (editable) { %>\r\n                <div class="btn-delete img-commonctrl"></div>\r\n                <% } %>\r\n            <% } else if (editable) { %>\r\n            <div class="btn-accept img-commonctrl"></div>\r\n            <div class="btn-reject img-commonctrl"></div>\r\n            <% } %>\r\n        <% } %>\r\n    </div>\r\n    <% if (!hint && lock) { %>\r\n    <div class="lock-area" style="cursor: default;"></div>\r\n    <div class="lock-author" style="cursor: default;"><%=lockuser%></div>\r\n    <% } %>\r\n</div>'}),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/ReviewPopover",["text!common/main/lib/template/CommentsPopover.template","text!common/main/lib/template/ReviewChangesPopover.template","common/main/lib/util/utils","common/main/lib/component/Button","common/main/lib/component/ComboBox","common/main/lib/component/DataView","common/main/lib/component/Layout","common/main/lib/component/Window"],function(t,e){"use strict";function i(t,e){var i,n,o=t;for(i in e)void 0!==i&&(n=e[i],o=o.replace(new RegExp(i,"g"),n));return o}Common.Views.ReviewPopover=Common.UI.Window.extend(_.extend({initialize:function(t){var e={};return _.extend(e,{closable:!1,width:265,height:120,header:!1,modal:!1,alias:"Common.Views.ReviewPopover"},t),this.template=t.template||['<div class="box">','<div id="id-popover" class="comments-popover" style="overflow-y: hidden;position: relative;">','<div id="id-review-popover"></div>','<div id="id-comments-popover"></div>',"</div>",'<div id="id-comments-arrow" class="comments-arrow"></div>',"</div>"].join(""),this.commentsStore=t.commentsStore,this.reviewStore=t.reviewStore,this.canRequestUsers=t.canRequestUsers,this.canRequestSendNotify=t.canRequestSendNotify,this.mentionShare=t.mentionShare,this.api=t.api,this.externalUsers=[],this._state={commentsVisible:!1,reviewVisible:!1},e.tpl=_.template(this.template)(e),this.arrow={margin:20,width:10,height:30},this.sdkBounds={width:0,height:0,padding:10,paddingTop:20},Common.UI.Window.prototype.initialize.call(this,e),this.canRequestUsers&&(Common.Gateway.on("setusers",_.bind(this.setUsers,this)),Common.NotificationCenter.on("mentions:clearusers",_.bind(this.clearUsers,this))),this},render:function(n,o){Common.UI.Window.prototype.render.call(this);var s=this,a=this.$window;a.css({height:"",minHeight:"",overflow:"hidden",position:"absolute",zIndex:"990"});var r=a.find(".body");r&&r.css("position","relative");var l=Common.UI.DataView.extend(function(){var t=s;return{options:{handleSelect:!1,allowScrollbar:!1,template:_.template('<div class="dataview-ct inner" style="overflow-y: visible;"></div>')},getTextBox:function(){var t=$(this.el).find("textarea");return t&&t.length?t:void 0},setFocusToTextBox:function(t){var e=$(this.el).find("textarea");if(t)e.blur();else if(e&&e.length){var i=e.val();e.focus(),e.val(""),e.val(i)}},getActiveTextBoxVal:function(){var t=$(this.el).find("textarea");return t&&t.length?t.val().trim():""},autoHeightTextBox:function(){function e(){r=t.scroller.getScrollTop(),n.scrollHeight>n.clientHeight?(i.css({height:n.scrollHeight+a+"px"}),t.calculateSizeOfContent()):(l=n.clientHeight)>=o&&(i.css({height:o+"px"}),n.scrollHeight>n.clientHeight&&(c=Math.max(n.scrollHeight+a,o),i.css({height:c+"px"})),t.calculateSizeOfContent(),t.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),t.calculateSizeOfContent()),t.scroller.scrollTop(r),t.autoScrollToEditButtons()}var i=this.$el.find("textarea"),n=null,o=55,a=0,r=0,l=0,c=0;i&&i.length&&(n=i.get(0))&&(a=.25*parseInt(i.css("lineHeight"),10),e(),i.bind("input propertychange",e)),this.textBox=i},clearTextBoxBind:function(){this.textBox&&(this.textBox.unbind("input propertychange"),this.textBox=void 0)}}}());if(l)if(this.commentsView)this.commentsView.render($("#id-comments-popover")),this.commentsView.onResetItems();else{this.commentsView=new l({el:$("#id-comments-popover"),store:s.commentsStore,itemTemplate:_.template(i(t,{textAddReply:s.textAddReply,textAdd:s.textAdd,textCancel:s.textCancel,textEdit:s.textEdit,textReply:s.textReply,textClose:s.textClose,maxCommLength:Asc.c_oAscMaxCellOrCommentLength,textMention:s.canRequestSendNotify?s.mentionShare?s.textMention:s.textMentionNotify:""}))});var c=function(t,e,i){e.tipsArray&&e.tipsArray.forEach(function(t){t.remove()});var n=[],o=$(e.el).find(".btn-resolve:not(.comment-resolved)");o.tooltip({title:s.textResolve,placement:"cursor"}),o.each(function(t,e){n.push($(e).data("bs.tooltip").tip())}),o=$(e.el).find(".comment-resolved"),o.tooltip({title:s.textOpenAgain,placement:"cursor"}),o.each(function(t,e){n.push($(e).data("bs.tooltip").tip())}),e.tipsArray=n,this.autoHeightTextBox()},d=function(){s._isMouseOver=!0},h=function(){s._isMouseOver=!1};this.commentsView.on("item:add",c),this.commentsView.on("item:remove",c),this.commentsView.on("item:change",c),this.commentsView.cmpEl.on("mouseover",d).on("mouseout",h),this.commentsView.on("item:click",function(t,e,i,n){function o(){s.update()}var a,r,l,c,d,h;if(a=$(n.target)){if(r=i.get("editTextInPopover"),l=i.get("showReplyInPopover"),h=i.get("hideAddReply"),c=i.get("uid"),d=a.attr("data-value"),i.get("hint"))return void s.fireEvent("comment:disableHint",[i]);if(a.hasClass("btn-edit"))_.isUndefined(d)?r||(s.fireEvent("comment:closeEditing"),i.set("editTextInPopover",!0),s.fireEvent("comment:show",[c]),this.autoHeightTextBox(),s.calculateSizeOfContent(),s.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),s.calculateSizeOfContent(),o(),s.hookTextBox(),s.autoScrollToEditButtons(),this.setFocusToTextBox()):(s.fireEvent("comment:closeEditing",[c]),s.fireEvent("comment:editReply",[c,d,!0]),this.replyId=d,this.autoHeightTextBox(),s.calculateSizeOfContent(),s.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),s.calculateSizeOfContent(),o(),s.hookTextBox(),s.autoScrollToEditButtons(),this.setFocusToTextBox());else if(a.hasClass("btn-delete"))_.isUndefined(d)?s.fireEvent("comment:remove",[c]):(s.fireEvent("comment:removeReply",[c,d]),s.calculateSizeOfContent(),s.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),s.calculateSizeOfContent()),s.fireEvent("comment:closeEditing"),o();else if(a.hasClass("user-reply"))s.fireEvent("comment:closeEditing"),i.set("showReplyInPopover",!0),s.calculateSizeOfContent(),s.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),s.calculateSizeOfContent(),o(),this.autoHeightTextBox(),s.hookTextBox(),s.autoScrollToEditButtons(),this.setFocusToTextBox();else if(a.hasClass("btn-reply",!1))l&&(this.clearTextBoxBind(),s.fireEvent("comment:addReply",[c,this.getActiveTextBoxVal()]),s.fireEvent("comment:closeEditing"),s.calculateSizeOfContent(),o());else if(a.hasClass("btn-close",!1))s.fireEvent("comment:closeEditing",[c]),s.calculateSizeOfContent(),s.fireEvent("comment:show",[c]),o();else if(a.hasClass("btn-inner-edit",!1)){if(i.get("dummy")){var p=this.getActiveTextBoxVal();if(s.clearDummyText(),p.length>0)s.fireEvent("comment:addDummyComment",[p]);else{var m=s.$window.find("textarea:not(.user-message)");m&&m.length&&setTimeout(function(){m.focus()},10)}return}this.clearTextBoxBind(),_.isUndefined(this.replyId)?r&&(s.fireEvent("comment:change",[c,this.getActiveTextBoxVal()]),s.fireEvent("comment:closeEditing"),s.calculateSizeOfContent()):(s.fireEvent("comment:changeReply",[c,this.replyId,this.getActiveTextBoxVal()]),this.replyId=void 0,s.fireEvent("comment:closeEditing")),o()}else if(a.hasClass("btn-inner-close",!1)){
if(i.get("dummy"))return s.clearDummyText(),void s.hide();h&&this.getActiveTextBoxVal().length>0?(s.saveText(),i.set("hideAddReply",!1),this.getTextBox().val(s.textVal),this.autoHeightTextBox()):(this.clearTextBoxBind(),s.fireEvent("comment:closeEditing",[c])),this.replyId=void 0,s.calculateSizeOfContent(),s.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),s.calculateSizeOfContent(),o()}else if(a.hasClass("btn-resolve")){var u=a.data("bs.tooltip");u&&(u.dontShow=!0),s.fireEvent("comment:resolve",[c]),o()}}}),this.emailMenu=new Common.UI.Menu({maxHeight:200,cyclic:!1,items:[]}).on("render:after",function(t){this.scroller=new Common.UI.Scroller({el:$(this.el).find(".dropdown-menu "),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:40,alwaysVisibleY:!0})}).on("show:after",function(){this.scroller.update({alwaysVisibleY:!0}),s.$window.css({zIndex:"1001"})}).on("hide:after",function(){s.$window.css({zIndex:"990"})}),s.on({show:function(){s.commentsView.autoHeightTextBox(),s.$window.find("textarea").keydown(function(t){t.keyCode==Common.UI.Keys.ESC&&s.hide(!0)})},"animate:before":function(){var t=s.$window.find("textarea");t&&t.length&&t.focus()}})}var p=Common.UI.DataView.extend(function(){return{options:{handleSelect:!1,scrollable:!0,template:_.template('<div class="dataview-ct inner" style="overflow-y: visible;"></div>')}}}());if(p)if(this.reviewChangesView)this.reviewChangesView.render($("#id-review-popover")),this.reviewChangesView.onResetItems();else{this.reviewChangesView=new p({el:$("#id-review-popover"),store:s.reviewStore,itemTemplate:_.template(e)});var c=function(t,e,i){e.tipsArray&&e.tipsArray.forEach(function(t){t.remove()});var n=[],o=$(e.el).find(".btn-goto");o.tooltip({title:s.textFollowMove,placement:"cursor"}),o.each(function(t,e){n.push($(e).data("bs.tooltip").tip())}),e.tipsArray=n};this.reviewChangesView.on("item:add",c),this.reviewChangesView.on("item:remove",c),this.reviewChangesView.on("item:change",c),this.reviewChangesView.on("item:click",function(t,e,i,n){var o=$(n.target);if(o)if(o.hasClass("btn-accept"))s.fireEvent("reviewchange:accept",[i.get("changedata")]);else if(o.hasClass("btn-reject"))s.fireEvent("reviewchange:reject",[i.get("changedata")]);else if(o.hasClass("btn-delete"))s.fireEvent("reviewchange:delete",[i.get("changedata")]);else if(o.hasClass("btn-goto")){var a=o.data("bs.tooltip");a&&(a.dontShow=!0),s.fireEvent("reviewchange:goto",[i.get("changedata")])}})}_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:a.find("#id-popover"),minScrollbarLength:40,wheelSpeed:10,alwaysVisibleY:!0}))},showComments:function(t,e,i,n){this.options.animate=t;var o=this.commentsView.getTextBox();e&&this.textVal&&o&&o.val(this.textVal),n&&n.length&&o&&o.val(n),this.show(t),this.hookTextBox(),this._state.commentsVisible=!0},showReview:function(t,e,i){this.show(t),this._state.reviewVisible=!0},show:function(t,e,i,n){this.options.animate=t,Common.UI.Window.prototype.show.call(this),this.scroller&&this.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})},hideComments:function(){this.handlerHide&&this.handlerHide(),this.hideTips(),this._state.commentsVisible=!1,this._state.reviewVisible?this.calculateSizeOfContent():this.hide()},hideReview:function(){this.handlerHide&&this.handlerHide(),this.hideTips(),this._state.reviewVisible=!1,this._state.commentsVisible?this.calculateSizeOfContent():this.hide()},hide:function(){this.handlerHide&&this.handlerHide.apply(this,arguments),this.hideTips(),Common.UI.Window.prototype.hide.call(this),_.isUndefined(this.e)||this.e.keyCode!=Common.UI.Keys.ESC||(this.e.preventDefault(),this.e.stopImmediatePropagation(),this.e=void 0)},update:function(t){this.commentsView&&t&&this.commentsView.onResetItems(),this.scroller&&this.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})},isVisible:function(){return this.$window&&this.$window.is(":visible")},setLeftTop:function(t,e,i,n,o){if(this.$window||this.render(),n&&(t=this.arrowPosX,e=this.arrowPosY,i=this.leftX),!_.isUndefined(t)||!_.isUndefined(e)){this.arrowPosX=t,this.arrowPosY=e,this.leftX=i;var s=$("#id-popover"),a=$("#id-comments-arrow"),r=$("#editor_sdk"),l=null,c=0,d="",h=0,p="",m=0,u="",g=0,b="",f=0,C=0,v=0,y=0,x=0,w=0;s&&a&&r&&r.get(0)&&(l=r.get(0).getBoundingClientRect())&&(c=l.height-2*this.sdkBounds.padding,this.$window.css({maxHeight:c+"px"}),this.sdkBounds.width=l.width,this.sdkBounds.height=l.height,_.isUndefined(t)||(d=$("#id_vertical_scroll"),d.length?h="none"!==d.css("display")?d.width():0:(d=$("#ws-v-scrollbar"),d.length&&(h="none"!==d.css("display")?d.width():0)),this.sdkBounds.width-=h,p=$("#id_panel_left"),p.length&&(m="none"!==p.css("display")?p.width():0),u=$("#id_panel_thumbnails"),u.length&&(g="none"!==u.css("display")?u.width():0,this.sdkBounds.width-=g),C=Math.min(0+t+this.arrow.width,0+this.sdkBounds.width-this.$window.outerWidth()-25),C=Math.max(0+m+this.arrow.width,C),a.removeClass("right").addClass("left"),_.isUndefined(i)||(v=this.$window.outerWidth())&&(t+v>this.sdkBounds.width-this.arrow.width+5&&this.leftX>v?(C=this.leftX-v+0-this.arrow.width,a.removeClass("left").addClass("right")):C=0+t+this.arrow.width),this.$window.css("left",C+"px")),_.isUndefined(e)||(b=$("#id_panel_top"),w=0,b.length?(f="none"!==b.css("display")?b.height():0,w+=this.sdkBounds.paddingTop):(b=$("#ws-h-scrollbar"),b.length&&(f="none"!==b.css("display")?b.height():0)),this.sdkBounds.height-=f,y=this.$window.outerHeight(),x=Math.min(0+c-y,this.arrowPosY+0-this.arrow.height),x=Math.max(x,w),parseInt(a.css("top"))+this.arrow.height>y&&a.css({top:y-this.arrow.height+"px"}),this.$window.css("top",x+"px"))),o&&!this.isOverCursor()||this.calculateSizeOfContent()}},calculateSizeOfContent:function(t){if(!t||this.$window.is(":visible")){this.$window.css({overflow:"hidden"});var e=$("#id-comments-arrow"),i=$("#id-popover"),n=null,o=null,s=null,a=0,r="",l=0,c=0,d=0,h=0,p=0,m=0;if(i&&e&&i.get(0)){var u=this.scroller.getScrollTop();if(i.css({height:"100%"}),(n=i.get(0).getBoundingClientRect())&&(o=$("#editor_sdk"))&&o.get(0)&&(s=o.get(0).getBoundingClientRect())){a=s.height-2*this.sdkBounds.padding,m=0,d=this.$window.outerHeight(),r=$("#id_panel_top"),r.length?(l="none"!==r.css("display")?r.height():0,m+=this.sdkBounds.paddingTop):(r=$("#ws-h-scrollbar"),r.length&&(l="none"!==r.css("display")?r.height():0)),h=Math.max(i.outerHeight(),this.$window.outerHeight());var g=this.isOverCursor();if(g){var b=g[1]+l,f=g[0]+l;if(b+h>0+a){var C=0+a-b;if(f-h<0){var v=f-0;C<.9*v?(this.$window.css({maxHeight:v+"px",top:"0px"}),i.css({height:v-3+"px"})):(this.$window.css({maxHeight:C+"px",top:b+"px"}),i.css({height:C-3+"px"}))}else this.$window.css("top",f-h+"px")}else this.$window.css("top",b+"px");e.addClass("hidden")}else a<=h?(this.$window.css({maxHeight:a-l+"px",top:0+l+"px"}),i.css({height:a-l-3+"px"}),c=Math.min(c,a-(l+this.arrow.margin+this.arrow.height)),e.css({top:c+"px"}),e.removeClass("hidden"),this.scroller.scrollTop(u)):(h=d,h>0&&(n.top+h>a+0||0===n.height)&&(p=Math.min(0+a-h,this.arrowPosY+0-this.arrow.height),p=Math.max(p,m),this.$window.css({top:p+"px"})),c=Math.max(this.arrow.margin,this.arrowPosY-(a-h)-this.arrow.height),c=Math.min(c,h-this.arrow.margin-this.arrow.height),e.css({top:c+"px"}),e.removeClass("hidden"))}}this.$window.css({overflow:""}),this.scroller&&this.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})}},isOverCursor:function(){if(this.api.asc_GetSelectionBounds){var t=this.api.asc_GetSelectionBounds(),e=Math.abs(t[0][0]-t[1][0])<.1&&Math.abs(t[0][1]-t[1][1])<.1&&Math.abs(t[2][0]-t[3][0])<.1&&Math.abs(t[2][1]-t[3][1])<.1,i=t[0][0],n=t[0][1],o=t[e?2:1][0],s=t[e?2:1][1],a=parseInt(this.$window.css("left"))-25,r=this.$window.outerWidth();if(i>a&&i<a+r||o>a&&o<a+r){var l=Math.max(n,s);return[Math.min(n,s),l]}}},saveText:function(t){this.commentsView&&this.commentsView.cmpEl.find(".lock-area").length<1&&(this.textVal=void 0,t?this.commentsView.clearTextBoxBind():this.textVal=this.commentsView.getActiveTextBoxVal())},loadText:function(){if(this.textVal&&this.commentsView){var t=this.commentsView.getTextBox();t&&t.val(this.textVal)}},getEditText:function(){if(this.commentsView)return this.commentsView.getActiveTextBoxVal()},saveDummyText:function(){this.commentsView&&this.commentsView.cmpEl.find(".lock-area").length<1&&(this.textDummyVal=this.commentsView.getActiveTextBoxVal())},clearDummyText:function(){if(this.commentsView&&this.commentsView.cmpEl.find(".lock-area").length<1){this.textDummyVal=void 0;var t=this.commentsView.getTextBox();t&&t.val(""),this.commentsView.clearTextBoxBind()}},getDummyText:function(){return this.textDummyVal||""},hookTextBox:function(){var t=this,e=this.commentsView.getTextBox();e&&e.keydown(function(e){if(!e.ctrlKey&&!e.metaKey||e.altKey||e.keyCode!==Common.UI.Keys.RETURN){if(e.keyCode===Common.UI.Keys.TAB){var i,n,o;o=this.selectionStart,n=this.selectionEnd,i=$(this),i.val(i.val().substring(0,o)+"\t"+i.val().substring(n)),this.selectionStart=this.selectionEnd=o+1,e.preventDefault()}}else{var s=$("#id-comments-change-popover");s&&s.length&&s.click(),e.stopImmediatePropagation()}t.e=e}),this.canRequestUsers&&(e&&e.keydown(function(e){e.keyCode==Common.UI.Keys.SPACE||e.keyCode===Common.UI.Keys.TAB||e.keyCode==Common.UI.Keys.HOME||e.keyCode==Common.UI.Keys.END||e.keyCode==Common.UI.Keys.RIGHT||e.keyCode==Common.UI.Keys.LEFT||e.keyCode==Common.UI.Keys.UP?t.onEmailListMenu():e.keyCode==Common.UI.Keys.DOWN&&t.emailMenu&&t.emailMenu.rendered&&t.emailMenu.isVisible()&&(_.delay(function(){var e=t.emailMenu.cmpEl.find("li:not(.divider):first");e=e.find("a"),e.focus()},10),e.preventDefault()),t.e=e}),e&&e.on("input",function(e){for(var i=$(this),n=this.selectionStart,o=i.val(),s=0,a=o.length-1,r=n-1;r>=0;r--)if(32==o.charCodeAt(r)||13==o.charCodeAt(r)||10==o.charCodeAt(r)||9==o.charCodeAt(r)){s=r+1;break}for(var r=n;r<=a;r++)if(32==o.charCodeAt(r)||13==o.charCodeAt(r)||10==o.charCodeAt(r)||9==o.charCodeAt(r)){a=r-1;break}var l=o.substring(s,a+1),c=l.match(/^(?:[@]|[+](?!1))(\S*)/);c&&c.length>1?(l=c[1],t.onEmailListMenu(l,s,a)):t.onEmailListMenu()}))},hideTips:function(){this.commentsView&&_.each(this.commentsView.dataViewItems,function(t){t.tipsArray&&t.tipsArray.forEach(function(t){t.hide()})},this),this.reviewChangesView&&_.each(this.reviewChangesView.dataViewItems,function(t){t.tipsArray&&t.tipsArray.forEach(function(t){t.hide()})},this),this.emailMenu&&this.emailMenu.rendered&&this.emailMenu.cmpEl.css("display","none")},isCommentsViewMouseOver:function(){return this._isMouseOver},setReviewStore:function(t){this.reviewStore=t,this.reviewChangesView&&this.reviewChangesView.setStore(this.reviewStore)},setCommentsStore:function(t){this.commentsStore=t,this.commentsView&&this.commentsView.setStore(this.commentsStore)},setUsers:function(t){this.externalUsers=t.users||[],this.isUsersLoading=!1,this._state.emailSearch&&this.onEmailListMenu(this._state.emailSearch.str,this._state.emailSearch.left,this._state.emailSearch.right),this._state.emailSearch=null},clearUsers:function(){this.externalUsers=[]},getPopover:function(t){return this.popover||(this.popover=new Common.Views.ReviewPopover(t)),this.popover},autoScrollToEditButtons:function(){var t=$("#id-comments-change-popover"),e=null,i=this.$window[0].getBoundingClientRect(),n=0;t.length&&(e=t.get(0).getBoundingClientRect())&&i&&(n=i.bottom-(e.bottom+7))<0&&this.scroller.scrollTop(this.scroller.getScrollTop()-n)},onEmailListMenu:function(t,e,i,n){var o=this,s=o.externalUsers,a=o.emailMenu;if(s.length<1){if(this._state.emailSearch={str:t,left:e,right:i},this.isUsersLoading)return;return this.isUsersLoading=!0,void Common.Gateway.requestUsers()}if("string"==typeof t){var r=o.$window.find(Common.Utils.String.format("#menu-container-{0}",a.id)),l=this.commentsView.getTextBox(),c=l?l[0]:null,d=c?[c.offsetLeft,c.offsetTop+c.clientHeight+3]:[0,0];a.rendered||(r.length<1&&(r=$(Common.Utils.String.format('<div id="menu-container-{0}" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',a.id)),o.$window.append(r)),a.render(r),a.cmpEl.css("min-width",c?c.clientWidth:220),a.cmpEl.attr({tabindex:"-1"}),a.on("hide:after",function(){setTimeout(function(){var t=o.commentsView.getTextBox();t&&t.focus()},10)}));for(var h=0;h<a.items.length;h++)a.removeItem(a.items[h]),h--;if(s.length>0){t=t.toLowerCase(),t.length>0&&(s=_.filter(s,function(e){return e.email&&0===e.email.toLowerCase().indexOf(t)||e.name&&0===e.name.toLowerCase().indexOf(t)}));var p=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem" style="font-size: 12px;"><div style="overflow: hidden; text-overflow: ellipsis; max-width: 195px;"><%= Common.Utils.String.htmlEncode(caption) %></div><div style="overflow: hidden; text-overflow: ellipsis; max-width: 195px; color: #909090;"><%= Common.Utils.String.htmlEncode(options.value) %></div></a>'),m=!1;_.each(s,function(t,n){if(m&&!t.hasAccess&&(m=!1,a.addItem(new Common.UI.MenuItem({caption:"--"}))),t.email&&t.name){var s=new Common.UI.MenuItem({caption:t.name,value:t.email,template:p}).on("click",function(t,n){o.insertEmailToTextbox(t.options.value,e,i)});a.addItem(s),t.hasAccess&&(m=!0)}})}a.items.length>0?(r.css({left:d[0],top:d[1]}),a.menuAlignEl=l,a.show(),a.cmpEl.css("display",""),a.alignPosition("bl-tl",-5),a.scroller.update({alwaysVisibleY:!0})):a.rendered&&a.cmpEl.css("display","none")}else a.rendered&&a.cmpEl.css("display","none")},insertEmailToTextbox:function(t,e,i){var n=this.commentsView.getTextBox();if(n){var o=n.val();n.val(o.substring(0,e)+"+"+t+" "+o.substring(i+1,o.length)),setTimeout(function(){n[0].selectionStart=n[0].selectionEnd=e+t.length+2},10)}},textAddReply:"Add Reply",textAdd:"Add",textCancel:"Cancel",textEdit:"Edit",textReply:"Reply",textClose:"Close",textResolve:"Resolve",textOpenAgain:"Open Again",textFollowMove:"Follow Move",textMention:"+mention will provide access to the document and send an email",textMentionNotify:"+mention will notify the user via email"},Common.Views.ReviewPopover||{}))}),void 0===Common)var Common={};if(Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/Comments",["core","common/main/lib/model/Comment","common/main/lib/collection/Comments","common/main/lib/view/Comments","common/main/lib/view/ReviewPopover"],function(){"use strict";function t(){return void 0!==Asc.asc_CCommentDataWord?new Asc.asc_CCommentDataWord(null):new Asc.asc_CCommentData(null)}Common.Controllers.Comments=Backbone.Controller.extend(_.extend({models:[],collections:["Common.Collections.Comments"],views:["Common.Views.Comments","Common.Views.ReviewPopover"],sdkViewName:"#id_main",subEditStrings:{},filter:void 0,hintmode:!1,viewmode:!1,isSelectedComment:!1,uids:[],oldUids:[],isDummyComment:!1,initialize:function(){this.addListeners({"Common.Views.Comments":{"comment:add":_.bind(this.onCreateComment,this),"comment:change":_.bind(this.onChangeComment,this),"comment:remove":_.bind(this.onRemoveComment,this),"comment:resolve":_.bind(this.onResolveComment,this),"comment:show":_.bind(this.onShowComment,this),"comment:addReply":_.bind(this.onAddReplyComment,this),"comment:changeReply":_.bind(this.onChangeReplyComment,this),"comment:removeReply":_.bind(this.onRemoveReplyComment,this),"comment:editReply":_.bind(this.onShowEditReplyComment,this),"comment:closeEditing":_.bind(this.closeEditing,this)},"Common.Views.ReviewPopover":{"comment:change":_.bind(this.onChangeComment,this),"comment:remove":_.bind(this.onRemoveComment,this),"comment:resolve":_.bind(this.onResolveComment,this),"comment:show":_.bind(this.onShowComment,this),"comment:addReply":_.bind(this.onAddReplyComment,this),"comment:changeReply":_.bind(this.onChangeReplyComment,this),"comment:removeReply":_.bind(this.onRemoveReplyComment,this),"comment:editReply":_.bind(this.onShowEditReplyComment,this),"comment:closeEditing":_.bind(this.closeEditing,this),"comment:disableHint":_.bind(this.disableHint,this),"comment:addDummyComment":_.bind(this.onAddDummyComment,this)},"Common.Views.ReviewChanges":{"comment:removeComments":_.bind(this.onRemoveComments,this),"comment:resolveComments":_.bind(this.onResolveComments,this)}}),Common.NotificationCenter.on("comments:updatefilter",_.bind(this.onUpdateFilter,this)),Common.NotificationCenter.on("app:comment:add",_.bind(this.onAppAddComment,this)),Common.NotificationCenter.on("layout:changed",function(t){Common.Utils.asyncCall(function(t){"toolbar"!=t&&"status"!=t||!this.view.$el.is(":visible")||this.onAfterShow()},this,t)}.bind(this))},onLaunch:function(){this.collection=this.getApplication().getCollection("Common.Collections.Comments"),this.collection&&(this.collection.comparator=function(t){return-t.get("time")}),this.popoverComments=new Common.Collections.Comments,this.popoverComments&&(this.popoverComments.comparator=function(t){return t.get("time")}),this.groupCollection=[],this.view=this.createView("Common.Views.Comments",{store:this.collection}),this.view.render(),this.userCollection=this.getApplication().getCollection("Common.Collections.Users"),this.userCollection.on("reset",_.bind(this.onUpdateUsers,this)),this.userCollection.on("add",_.bind(this.onUpdateUsers,this)),this.bindViewEvents(this.view,this.events)},setConfig:function(t,e){this.setApi(e),t&&(this.currentUserId=t.config.user.id,this.sdkViewName=t.sdkviewname||this.sdkViewName,this.hintmode=t.hintmode||!1,this.viewmode=t.viewmode||!1)},setApi:function(t){t&&(this.api=t,this.api.asc_registerCallback("asc_onAddComment",_.bind(this.onApiAddComment,this)),this.api.asc_registerCallback("asc_onAddComments",_.bind(this.onApiAddComments,this)),this.api.asc_registerCallback("asc_onRemoveComment",_.bind(this.onApiRemoveComment,this)),this.api.asc_registerCallback("asc_onChangeComments",_.bind(this.onChangeComments,this)),this.api.asc_registerCallback("asc_onRemoveComments",_.bind(this.onApiRemoveComments,this)),this.api.asc_registerCallback("asc_onChangeCommentData",_.bind(this.onApiChangeCommentData,this)),this.api.asc_registerCallback("asc_onLockComment",_.bind(this.onApiLockComment,this)),this.api.asc_registerCallback("asc_onUnLockComment",_.bind(this.onApiUnLockComment,this)),this.api.asc_registerCallback("asc_onShowComment",_.bind(this.onApiShowComment,this)),this.api.asc_registerCallback("asc_onHideComment",_.bind(this.onApiHideComment,this)),this.api.asc_registerCallback("asc_onUpdateCommentPosition",_.bind(this.onApiUpdateCommentPosition,this)),this.api.asc_registerCallback("asc_onDocumentPlaceChanged",_.bind(this.onDocumentPlaceChanged,this)),this.api.asc_registerCallback("asc_onDeleteComment",_.bind(this.onDeleteComment,this)))},setMode:function(t){return this.mode=t,this.isModeChanged=!0,this.view.viewmode=!this.mode.canComments,this.view.changeLayout(t),this},onCreateComment:function(e,i,n,o,s){if(this.api&&i&&i.length>0){var a=t();a&&(this.showPopover=!0,this.editPopover=!!n,this.hidereply=o,this.isSelectedComment=!1,this.uids=[],a.asc_putText(i),a.asc_putTime(this.utcDateToString(new Date)),a.asc_putOnlyOfficeTime(this.ooDateToString(new Date)),a.asc_putUserId(this.currentUserId),a.asc_putUserName(AscCommon.UserInfoParser.getCurrentName()),a.asc_putSolved(!1),_.isUndefined(a.asc_putDocumentFlag)||a.asc_putDocumentFlag(s),this.api.asc_addComment(a),this.view.showEditContainer(!1))}this.view.txtComment.focus()},onRemoveComment:function(t){this.api&&t&&this.api.asc_removeComment(t)},onRemoveComments:function(t){this.api&&this.api.asc_RemoveAllComments("my"==t||!this.mode.canDeleteComments,"current"==t)},onResolveComments:function(t){this.api&&this.api.asc_ResolveAllComments("my"==t||!this.mode.canEditComments,"current"==t)},onResolveComment:function(e){var i=this,n=null,o=null,s=t(),a=i.findComment(e);return _.isUndefined(e)&&(e=a.get("uid")),!(!s||!a)&&(s.asc_putText(a.get("comment")),s.asc_putQuoteText(a.get("quote")),s.asc_putTime(i.utcDateToString(new Date(a.get("time")))),s.asc_putOnlyOfficeTime(i.ooDateToString(new Date(a.get("time")))),s.asc_putUserId(a.get("userid")),s.asc_putUserName(a.get("username")),s.asc_putSolved(!a.get("resolved")),s.asc_putGuid(a.get("guid")),s.asc_putUserData(a.get("userdata")),_.isUndefined(s.asc_putDocumentFlag)||s.asc_putDocumentFlag(a.get("unattached")),n=a.get("replys"),n&&n.length&&n.forEach(function(e){(o=t())&&(o.asc_putText(e.get("reply")),o.asc_putTime(i.utcDateToString(new Date(e.get("time")))),o.asc_putOnlyOfficeTime(i.ooDateToString(new Date(e.get("time")))),o.asc_putUserId(e.get("userid")),o.asc_putUserName(e.get("username")),o.asc_putUserData(e.get("userdata")),s.asc_addReply(o))}),i.api.asc_changeComment(e,s),!0)},onShowComment:function(t,e,i){var n=this.findComment(t);if(n)if(null!==n.get("quote")){if(this.api){if(this.hintmode){if(this.animate=!0,n.get("unattached")&&this.getPopover())return void this.getPopover().hideComments()}else{var o=this.popoverComments.findWhere({uid:t});if(o&&!this.getPopover().isVisible())return this.getPopover().showComments(!0),void this.api.asc_selectComment(t)}!_.isUndefined(e)&&this.hintmode&&(this.isSelectedComment=e),i&&0===_.difference(this.uids,[t]).length&&0===_.difference([t],this.uids).length||(this.api.asc_selectComment(t),this._dontScrollToComment=!0,this.api.asc_showComment(t,!1))}}else this.hintmode&&this.api.asc_selectComment(t),this.getPopover()&&this.getPopover().hideComments(),this.isSelectedComment=!1,this.uids=[]},onChangeComment:function(e,i){if(i&&i.length>0){var n=this,o=null,s=null,a=null,r=t(),l=n.findComment(e);if(l&&r)return r.asc_putText(i),r.asc_putQuoteText(l.get("quote")),r.asc_putTime(n.utcDateToString(new Date(l.get("time")))),r.asc_putOnlyOfficeTime(n.ooDateToString(new Date(l.get("time")))),r.asc_putUserId(n.currentUserId),r.asc_putUserName(AscCommon.UserInfoParser.getCurrentName()),r.asc_putSolved(l.get("resolved")),r.asc_putGuid(l.get("guid")),r.asc_putUserData(l.get("userdata")),_.isUndefined(r.asc_putDocumentFlag)||r.asc_putDocumentFlag(l.get("unattached")),l.set("editTextInPopover",!1),o=n.findPopupComment(e),o&&o.set("editTextInPopover",!1),n.subEditStrings[e]&&delete n.subEditStrings[e],n.subEditStrings[e+"-R"]&&delete n.subEditStrings[e+"-R"],s=l.get("replys"),s&&s.length&&s.forEach(function(e){(a=t())&&(a.asc_putText(e.get("reply")),a.asc_putTime(n.utcDateToString(new Date(e.get("time")))),a.asc_putOnlyOfficeTime(n.ooDateToString(new Date(e.get("time")))),a.asc_putUserId(e.get("userid")),a.asc_putUserName(e.get("username")),a.asc_putUserData(e.get("userdata")),r.asc_addReply(a))}),n.api.asc_changeComment(e,r),!0}return!1},onChangeReplyComment:function(e,i,n){if(n&&n.length>0){var o=this,s=null,a=null,r=t(),l=o.findComment(e);if(r&&l)return r.asc_putText(l.get("comment")),r.asc_putQuoteText(l.get("quote")),r.asc_putTime(o.utcDateToString(new Date(l.get("time")))),r.asc_putOnlyOfficeTime(o.ooDateToString(new Date(l.get("time")))),r.asc_putUserId(l.get("userid")),r.asc_putUserName(l.get("username")),r.asc_putSolved(l.get("resolved")),r.asc_putGuid(l.get("guid")),r.asc_putUserData(l.get("userdata")),_.isUndefined(r.asc_putDocumentFlag)||r.asc_putDocumentFlag(l.get("unattached")),s=l.get("replys"),s&&s.length&&s.forEach(function(e){(a=t())&&(e.get("id")!==i||_.isUndefined(n)?(a.asc_putText(e.get("reply")),a.asc_putUserId(e.get("userid")),a.asc_putUserName(e.get("username"))):(a.asc_putText(n),a.asc_putUserId(o.currentUserId),a.asc_putUserName(AscCommon.UserInfoParser.getCurrentName())),a.asc_putTime(o.utcDateToString(new Date(e.get("time")))),a.asc_putOnlyOfficeTime(o.ooDateToString(new Date(e.get("time")))),a.asc_putUserData(e.get("userdata")),r.asc_addReply(a))}),o.api.asc_changeComment(e,r),!0}return!1},onAddReplyComment:function(e,i){if(i.length>0){var n=this,o=null,s=null,a=null,r=t(),l=n.findComment(e);if(r&&l&&(o=l.get("uid"),o&&(n.subEditStrings[o]&&delete n.subEditStrings[o],n.subEditStrings[o+"-R"]&&delete n.subEditStrings[o+"-R"],l.set("showReplyInPopover",!1)),r.asc_putText(l.get("comment")),r.asc_putQuoteText(l.get("quote")),r.asc_putTime(n.utcDateToString(new Date(l.get("time")))),r.asc_putOnlyOfficeTime(n.ooDateToString(new Date(l.get("time")))),r.asc_putUserId(l.get("userid")),r.asc_putUserName(l.get("username")),r.asc_putSolved(l.get("resolved")),r.asc_putGuid(l.get("guid")),r.asc_putUserData(l.get("userdata")),_.isUndefined(r.asc_putDocumentFlag)||r.asc_putDocumentFlag(l.get("unattached")),s=l.get("replys"),s&&s.length&&s.forEach(function(e){(a=t())&&(a.asc_putText(e.get("reply")),a.asc_putTime(n.utcDateToString(new Date(e.get("time")))),a.asc_putOnlyOfficeTime(n.ooDateToString(new Date(e.get("time")))),a.asc_putUserId(e.get("userid")),a.asc_putUserName(e.get("username")),a.asc_putUserData(e.get("userdata")),r.asc_addReply(a))}),a=t()))return a.asc_putText(i),a.asc_putTime(n.utcDateToString(new Date)),a.asc_putOnlyOfficeTime(n.ooDateToString(new Date)),a.asc_putUserId(n.currentUserId),a.asc_putUserName(AscCommon.UserInfoParser.getCurrentName()),r.asc_addReply(a),n.api.asc_changeComment(e,r),n.mode&&n.mode.canRequestSendNotify&&n.view.pickEMail(r.asc_getGuid(),i),!0}return!1},onRemoveReplyComment:function(e,i){if(!_.isUndefined(e)&&!_.isUndefined(i)){var n=this,o=null,s=null,a=t(),r=n.findComment(e);if(a&&r)return a.asc_putText(r.get("comment")),a.asc_putQuoteText(r.get("quote")),a.asc_putTime(n.utcDateToString(new Date(r.get("time")))),a.asc_putOnlyOfficeTime(n.ooDateToString(new Date(r.get("time")))),a.asc_putUserId(r.get("userid")),a.asc_putUserName(r.get("username")),a.asc_putSolved(r.get("resolved")),a.asc_putGuid(r.get("guid")),a.asc_putUserData(r.get("userdata")),_.isUndefined(a.asc_putDocumentFlag)||a.asc_putDocumentFlag(r.get("unattached")),o=r.get("replys"),o&&o.length&&o.forEach(function(e){e.get("id")!==i&&(s=t())&&(s.asc_putText(e.get("reply")),s.asc_putTime(n.utcDateToString(new Date(e.get("time")))),s.asc_putOnlyOfficeTime(n.ooDateToString(new Date(e.get("time")))),s.asc_putUserId(e.get("userid")),s.asc_putUserName(e.get("username")),s.asc_putUserData(e.get("userdata")),a.asc_addReply(s))}),n.api.asc_changeComment(e,a),!0}return!1},onShowEditReplyComment:function(t,e,i){var n,o,s,a;if(!_.isUndefined(t)&&!_.isUndefined(e))if(i){if((o=this.popoverComments.findWhere({uid:t}))&&(s=o.get("replys"),a=_.clone(o.get("replys"))))for(n=0;n<a.length;++n)if(e===a[n].get("id"))return a[n].set("editTextInPopover",!0),s.length=0,o.set("replys",a),!0}else if((o=this.collection.findWhere({uid:t}))&&(s=o.get("replys"),a=_.clone(o.get("replys"))))for(n=0;n<a.length;++n)if(e===a[n].get("id"))return a[n].set("editText",!0),s.length=0,o.set("replys",a),!0;return!1},onUpdateFilter:function(t,e){if(t){this.view.isVisible()||(this.view.needUpdateFilter=t,e=!0),this.filter=t;var i=this,n=[];if(this.filter.forEach(function(t){i.groupCollection[t]||(i.groupCollection[t]=new Backbone.Collection([],{model:Common.Models.Comment})),n=n.concat(i.groupCollection[t].models)}),this.collection.reset(n),this.collection.groups=this.filter,!e){this.getPopover()&&this.getPopover().hide(),this.view.needUpdateFilter=!1;for(var o=!0,s=this.collection.length-1;s>=0;--s)o?this.collection.at(s).set("last",!0,{silent:!0}):this.collection.at(s).get("last")&&this.collection.at(s).set("last",!1,{silent:!0}),o=!1;this.view.render(),this.view.update()}}},onAppAddComment:function(t,e){this.api.can_AddQuotedComment&&!1===this.api.can_AddQuotedComment()||e||this.addDummyComment()},addCommentToGroupCollection:function(t){var e=t.get("groupName");this.groupCollection[e]||(this.groupCollection[e]=new Backbone.Collection([],{model:Common.Models.Comment})),this.groupCollection[e].push(t)},onApiAddComment:function(t,e){var i=this.readSDKComment(t,e);i&&(i.get("groupName")?(this.addCommentToGroupCollection(i),_.indexOf(this.collection.groups,i.get("groupName"))>-1&&this.collection.push(i)):this.collection.push(i),this.updateComments(!0),this.showPopover&&(null!==e.asc_getQuoteText()&&(this.api.asc_selectComment(t),this._dontScrollToComment=!0,this.api.asc_showComment(t,!0)),this.showPopover=void 0,this.editPopover=!1))},onApiAddComments:function(t){for(var e=0;e<t.length;++e){var i=this.readSDKComment(t[e].asc_getId(),t[e]);i.get("groupName")?this.addCommentToGroupCollection(i):this.collection.push(i)}this.updateComments(!0)},onApiRemoveComment:function(t,e){for(var i in this.groupCollection){var n=this.groupCollection[i],o=n.findWhere({uid:t});if(o){n.remove(o);break}}if(this.collection.length){var o=this.collection.findWhere({uid:t});o&&(this.collection.remove(o),e||this.updateComments(!0)),this.popoverComments.length&&(o=this.popoverComments.findWhere({uid:t}))&&(this.popoverComments.remove(o),0===this.popoverComments.length&&this.getPopover()&&this.getPopover().hideComments())}},onChangeComments:function(t){for(var e=0;e<t.length;++e)this.onApiChangeCommentData(t[e].Comment.Id,t[e].Comment,!0);this.updateComments(!0)},onApiRemoveComments:function(t){for(var e=0;e<t.length;++e)this.onApiRemoveComment(t[e],!0);this.updateComments(!0)},onApiChangeCommentData:function(t,e,i){var n=this,o=0,s=null,a=null,r=0,l=null,c=this.findComment(t)||this.findCommentInGroup(t);if(c){n=this,s=e.asc_getOnlyOfficeTime()?new Date(this.stringOOToLocalDate(e.asc_getOnlyOfficeTime())):""==e.asc_getTime()?new Date:new Date(this.stringUtcToLocalDate(e.asc_getTime()));var d=this.userCollection.findOriginalUser(e.asc_getUserId());for(c.set("comment",e.asc_getText()),c.set("userid",e.asc_getUserId()),c.set("username",e.asc_getUserName()),c.set("usercolor",d?d.get("color"):null),c.set("resolved",e.asc_getSolved()),c.set("quote",e.asc_getQuoteText()),c.set("userdata",e.asc_getUserData()),c.set("time",s.getTime()),c.set("date",n.dateToLocaleTimeString(s)),c.set("editable",(n.mode.canEditComments||e.asc_getUserId()==n.currentUserId)&&AscCommon.UserInfoParser.canEditComment(e.asc_getUserName())),c.set("removable",(n.mode.canDeleteComments||e.asc_getUserId()==n.currentUserId)&&AscCommon.UserInfoParser.canDeleteComment(e.asc_getUserName())),c.set("hide",!AscCommon.UserInfoParser.canViewComment(e.asc_getUserName())),a=_.clone(c.get("replys")),a.length=0,r=e.asc_getRepliesCount(),o=0;o<r;++o)l=e.asc_getReply(o).asc_getOnlyOfficeTime()?new Date(this.stringOOToLocalDate(e.asc_getReply(o).asc_getOnlyOfficeTime())):""==e.asc_getReply(o).asc_getTime()?new Date:new Date(this.stringUtcToLocalDate(e.asc_getReply(o).asc_getTime())),d=this.userCollection.findOriginalUser(e.asc_getReply(o).asc_getUserId()),a.push(new Common.Models.Reply({id:Common.UI.getId(),userid:e.asc_getReply(o).asc_getUserId(),username:e.asc_getReply(o).asc_getUserName(),usercolor:d?d.get("color"):null,date:n.dateToLocaleTimeString(l),reply:e.asc_getReply(o).asc_getText(),userdata:e.asc_getReply(o).asc_getUserData(),time:l.getTime(),editText:!1,editTextInPopover:!1,showReplyInPopover:!1,scope:n.view,editable:(n.mode.canEditComments||e.asc_getReply(o).asc_getUserId()==n.currentUserId)&&AscCommon.UserInfoParser.canEditComment(e.asc_getReply(o).asc_getUserName()),removable:(n.mode.canDeleteComments||e.asc_getReply(o).asc_getUserId()==n.currentUserId)&&AscCommon.UserInfoParser.canDeleteComment(e.asc_getReply(o).asc_getUserName())}));c.set("replys",a),this.popoverComments.findWhere({hide:!1})||this.getPopover()&&this.getPopover().hideComments(),i||this.updateComments(!1,!0)}},onApiLockComment:function(t,e){var i=this.findComment(t)||this.findCommentInGroup(t),n=null;i&&this.userCollection&&(n=this.userCollection.findUser(e))&&(this.getPopover()&&this.getPopover().saveText(),this.view.saveText(),i.set("lock",!0),i.set("lockuserid",this.view.getUserName(n.get("username"))))},onApiUnLockComment:function(t){var e=this.findComment(t)||this.findCommentInGroup(t);e&&(e.set("lock",!1),this.getPopover()&&this.getPopover().loadText(),this.view.loadText())},onApiShowComment:function(t,e,i,n,o,s){var a=s,r=0===_.difference(this.uids,t).length&&0===_.difference(t,this.uids).length;if(!(s&&this.isSelectedComment&&r)||this.isModeChanged){this.mode&&!this.mode.canComments&&(s=!0);var l=this.getPopover();if(l){
if(this.clearDummyComment(),this.isSelectedComment&&r&&!this.isModeChanged)return void(this.api&&(l.commentsView&&l.commentsView.setFocusToTextBox(!0),this.api.asc_enableKeyEvents(!0)));var c=0,d="",h="",p=null,m="",u=!0,g=[];for(c=0;c<t.length;++c)d=t[c],h=t[c]+"-R",(p=this.findComment(d))&&(this.subEditStrings[d]&&!s?(p.set("editTextInPopover",!0),m=this.subEditStrings[d]):this.subEditStrings[h]&&!s&&(p.set("showReplyInPopover",!0),m=this.subEditStrings[h]),p.set("hint",!_.isUndefined(s)&&s),!s&&this.hintmode&&(r&&0===this.uids.length&&(u=!1),this.oldUids.length&&0===_.difference(this.oldUids,t).length&&0===_.difference(t,this.oldUids).length&&(u=!1,this.oldUids=[])),this.animate&&(u=this.animate,this.animate=!1),this.isSelectedComment=!a||!this.hintmode,this.uids=_.clone(t),g.push(p),this._dontScrollToComment||this.view.commentsView.scrollToRecord(p),this._dontScrollToComment=!1);g.sort(function(t,e){return t.get("time")-e.get("time")}),this.popoverComments.reset(g),this.popoverComments.findWhere({hide:!1})?(l.isVisible()&&l.hide(),l.setLeftTop(e,i,n),l.showComments(u,!1,!0,m)):l.hideComments()}this.isModeChanged=!1}},onApiHideComment:function(t){var e=this;if(this.getPopover()){if(this.isSelectedComment&&t)return;if(t&&this.getPopover().isCommentsViewMouseOver())return;this.popoverComments.each(function(t){t.get("editTextInPopover")&&(e.subEditStrings[t.get("uid")]=e.getPopover().getEditText()),t.get("showReplyInPopover")&&(e.subEditStrings[t.get("uid")+"-R"]=e.getPopover().getEditText())}),this.getPopover().saveText(!0),this.getPopover().hideComments(),this.collection.clearEditing(),this.popoverComments.clearEditing(),this.oldUids=_.clone(this.uids),this.isSelectedComment=!1,this.uids=[],this.popoverComments.reset()}},onApiUpdateCommentPosition:function(t,e,i,n){var o,s=!1,a=null,r=void 0,l="",c="";if(this.getPopover())if(this.getPopover().saveText(),this.getPopover().hideTips(),i<0||this.getPopover().sdkBounds.height<i||!_.isUndefined(n)&&this.getPopover().sdkBounds.width<n)this.getPopover().hide();else{if(this.isModeChanged&&this.onApiShowComment(t,e,i,n),0===this.popoverComments.length){var d=[];for(o=0;o<t.length;++o)l=t[o],c=t[o]+"-R",(a=this.findComment(l))&&(this.subEditStrings[l]?(a.set("editTextInPopover",!0),r=this.subEditStrings[l]):this.subEditStrings[c]&&(a.set("showReplyInPopover",!0),r=this.subEditStrings[c]),d.push(a));d.sort(function(t,e){return t.get("time")-e.get("time")}),this.popoverComments.reset(d),this.popoverComments.findWhere({hide:!1})?(s=!0,this.getPopover().showComments(s,void 0,void 0,r)):this.getPopover().hideComments()}else!this.getPopover().isVisible()&&this.popoverComments.findWhere({hide:!1})&&this.getPopover().showComments(!1,void 0,void 0,r);this.getPopover().setLeftTop(e,i,n,void 0,!0)}},onDocumentPlaceChanged:function(){if(this.isDummyComment&&this.getPopover()&&this.getPopover().isVisible()){var t=this.api.asc_getAnchorPosition();t&&this.getPopover().setLeftTop(t.asc_getX()+t.asc_getWidth(),t.asc_getY(),this.hintmode?t.asc_getX():void 0)}},onDeleteComment:function(t,e){this.api&&this.api.asc_RemoveAllComments(!this.mode.canDeleteComments,!0)},updateComments:function(t,e,i){var n=this;n.updateCommentsTime=new Date,void 0===n.timerUpdateComments&&(n.timerUpdateComments=setInterval(function(){new Date-n.updateCommentsTime>100&&(clearInterval(n.timerUpdateComments),n.timerUpdateComments=void 0,n.updateCommentsView(t,e,i))},25))},updateCommentsView:function(t,e,i){if(t&&!this.view.isVisible())return this.view.needRender=t,void this.onUpdateFilter(this.filter,!0);var n,o=!0;if(_.isUndefined(e)&&this.collection.sort(),t){for(this.onUpdateFilter(this.filter,!0),n=this.collection.length-1;n>=0;--n)o?this.collection.at(n).set("last",!0,{silent:!0}):this.collection.at(n).get("last")&&this.collection.at(n).set("last",!1,{silent:!0}),o=!1;this.view.render(),this.view.needRender=!1}this.view.update(),i&&this.view.loadText()},findComment:function(t){return this.collection.findWhere({uid:t})},findPopupComment:function(t){return this.popoverComments.findWhere({id:t})},findCommentInGroup:function(t){for(var e in this.groupCollection){var i=this.groupCollection[e],n=i.findWhere({uid:t});if(n)return n}},closeEditing:function(t){if(!_.isUndefined(t)){var e=this.findPopupComment(t);e&&(e.set("editTextInPopover",!1),e.set("showReplyInPopover",!1)),this.subEditStrings[t]&&delete this.subEditStrings[t],this.subEditStrings[t+"-R"]&&delete this.subEditStrings[t+"-R"]}this.collection.clearEditing(),this.collection.each(function(t){var e=_.clone(t.get("replys"));t.get("replys").length=0,e.forEach(function(t){t.get("editText")&&t.set("editText",!1),t.get("editTextInPopover")&&t.set("editTextInPopover",!1)}),t.set("replys",e)}),this.view.showEditContainer(!1),this.view.update()},disableHint:function(t){t&&this.mode.canComments&&(t.set("hint",!1),this.api.asc_showComment(t.get("uid"),!1),this.isSelectedComment=!0)},blockPopover:function(t){this.isSelectedComment=t,t&&this.getPopover().isVisible()&&this.getPopover().hide()},getPopover:function(){return _.isUndefined(this.popover)&&(this.popover=Common.Views.ReviewPopover.prototype.getPopover({commentsStore:this.popoverComments,renderTo:this.sdkViewName,canRequestUsers:this.mode?this.mode.canRequestUsers:void 0,canRequestSendNotify:this.mode?this.mode.canRequestSendNotify:void 0,mentionShare:!this.mode||this.mode.mentionShare,api:this.api}),this.popover.setCommentsStore(this.popoverComments)),this.popover},onUpdateUsers:function(){var t=this.userCollection,e=!1;for(var i in this.groupCollection)e=!0,this.groupCollection[i].each(function(e){var i=t.findOriginalUser(e.get("userid")),n=i?i.get("color"):null,o=!1;n!==e.get("usercolor")&&(o=!0,e.set("usercolor",n,{silent:!0})),e.get("replys").forEach(function(e){i=t.findOriginalUser(e.get("userid")),(n=i?i.get("color"):null)!==e.get("usercolor")&&(o=!0,e.set("usercolor",n,{silent:!0}))}),o&&e.trigger("change")});!e&&this.collection.each(function(e){var i=t.findOriginalUser(e.get("userid")),n=i?i.get("color"):null,o=!1;n!==e.get("usercolor")&&(o=!0,e.set("usercolor",n,{silent:!0})),e.get("replys").forEach(function(e){i=t.findOriginalUser(e.get("userid")),(n=i?i.get("color"):null)!==e.get("usercolor")&&(o=!0,e.set("usercolor",n,{silent:!0}))}),o&&e.trigger("change")})},readSDKComment:function(t,e){var i=e.asc_getOnlyOfficeTime()?new Date(this.stringOOToLocalDate(e.asc_getOnlyOfficeTime())):""==e.asc_getTime()?new Date:new Date(this.stringUtcToLocalDate(e.asc_getTime())),n=this.userCollection.findOriginalUser(e.asc_getUserId()),o=t.substr(0,t.lastIndexOf("_")+1).match(/^(doc|sheet[0-9_]+)_/),s=new Common.Models.Comment({uid:t,guid:e.asc_getGuid(),userid:e.asc_getUserId(),username:e.asc_getUserName(),usercolor:n?n.get("color"):null,date:this.dateToLocaleTimeString(i),quote:e.asc_getQuoteText(),comment:e.asc_getText(),resolved:e.asc_getSolved(),unattached:!_.isUndefined(e.asc_getDocumentFlag)&&e.asc_getDocumentFlag(),userdata:e.asc_getUserData(),id:Common.UI.getId(),time:i.getTime(),showReply:!1,editText:!1,last:void 0,editTextInPopover:!!this.editPopover,showReplyInPopover:!1,hideAddReply:_.isUndefined(this.hidereply)?!!this.showPopover:this.hidereply,scope:this.view,editable:(this.mode.canEditComments||e.asc_getUserId()==this.currentUserId)&&AscCommon.UserInfoParser.canEditComment(e.asc_getUserName()),removable:(this.mode.canDeleteComments||e.asc_getUserId()==this.currentUserId)&&AscCommon.UserInfoParser.canDeleteComment(e.asc_getUserName()),hide:!AscCommon.UserInfoParser.canViewComment(e.asc_getUserName()),hint:!this.mode.canComments,groupName:o&&o.length>1?o[1]:null});if(s){var a=this.readSDKReplies(e);a.length&&s.set("replys",a)}return s},readSDKReplies:function(t){var e=0,i=[],n=null,o=t.asc_getRepliesCount();if(o)for(e=0;e<o;++e){n=t.asc_getReply(e).asc_getOnlyOfficeTime()?new Date(this.stringOOToLocalDate(t.asc_getReply(e).asc_getOnlyOfficeTime())):""==t.asc_getReply(e).asc_getTime()?new Date:new Date(this.stringUtcToLocalDate(t.asc_getReply(e).asc_getTime()));var s=this.userCollection.findOriginalUser(t.asc_getReply(e).asc_getUserId());i.push(new Common.Models.Reply({id:Common.UI.getId(),userid:t.asc_getReply(e).asc_getUserId(),username:t.asc_getReply(e).asc_getUserName(),usercolor:s?s.get("color"):null,date:this.dateToLocaleTimeString(n),reply:t.asc_getReply(e).asc_getText(),userdata:t.asc_getReply(e).asc_getUserData(),time:n.getTime(),editText:!1,editTextInPopover:!1,showReplyInPopover:!1,scope:this.view,editable:(this.mode.canEditComments||t.asc_getReply(e).asc_getUserId()==this.currentUserId)&&AscCommon.UserInfoParser.canEditComment(t.asc_getReply(e).asc_getUserName()),removable:(this.mode.canDeleteComments||t.asc_getReply(e).asc_getUserId()==this.currentUserId)&&AscCommon.UserInfoParser.canDeleteComment(t.asc_getReply(e).asc_getUserName())}))}return i},addDummyComment:function(){if(this.api){var t=this,e=null,i=new Date,n=this.getPopover();if(n){if(this.popoverComments.length){if(this.isDummyComment)return void _.delay(function(){n.commentsView.setFocusToTextBox()},200);this.closeEditing()}var o=this.userCollection.findOriginalUser(this.currentUserId),s=new Common.Models.Comment({id:-1,time:i.getTime(),date:this.dateToLocaleTimeString(i),userid:this.currentUserId,username:AscCommon.UserInfoParser.getCurrentName(),usercolor:o?o.get("color"):null,editTextInPopover:!0,showReplyInPopover:!1,hideAddReply:!0,scope:this.view,dummy:!0});this.popoverComments.reset(),this.popoverComments.push(s),this.uids=[],this.isSelectedComment=!0,this.isDummyComment=!0,_.isUndefined(this.api.asc_SetDocumentPlaceChangedEnabled)||t.api.asc_SetDocumentPlaceChangedEnabled(!0),n.handlerHide=function(){},n.isVisible()&&n.hide(),n.handlerHide=function(e){t.clearDummyComment(e)},e=this.api.asc_getAnchorPosition(),e&&(n.setLeftTop(e.asc_getX()+e.asc_getWidth(),e.asc_getY(),this.hintmode?e.asc_getX():void 0),Common.NotificationCenter.trigger("comments:showdummy"),n.showComments(!0,!1,!0,n.getDummyText()))}}},onAddDummyComment:function(e){if(this.api&&e&&e.length>0){var i=t();i&&(this.showPopover=!0,this.editPopover=!1,this.hidereply=!1,this.isSelectedComment=!1,this.uids=[],this.popoverComments.reset(),this.getPopover().isVisible()&&this.getPopover().hideComments(),this.isDummyComment=!1,i.asc_putText(e),i.asc_putTime(this.utcDateToString(new Date)),i.asc_putOnlyOfficeTime(this.ooDateToString(new Date)),i.asc_putUserId(this.currentUserId),i.asc_putUserName(AscCommon.UserInfoParser.getCurrentName()),i.asc_putSolved(!1),_.isUndefined(i.asc_putDocumentFlag)||i.asc_putDocumentFlag(!1),this.api.asc_addComment(i),this.view.showEditContainer(!1),this.mode&&this.mode.canRequestSendNotify&&this.view.pickEMail(i.asc_getGuid(),e),_.isUndefined(this.api.asc_SetDocumentPlaceChangedEnabled)||this.api.asc_SetDocumentPlaceChangedEnabled(!1))}},clearDummyComment:function(t){if(this.isDummyComment){this.isDummyComment=!1,this.showPopover=!0,this.editPopover=!1,this.hidereply=!1,this.isSelectedComment=!1,this.uids=[];var e=this.getPopover();e&&(t&&e.clearDummyText(),e.saveDummyText(),e.handlerHide=function(){},e.isVisible()&&e.hideComments()),this.popoverComments.reset(),_.isUndefined(this.api.asc_SetDocumentPlaceChangedEnabled)||this.api.asc_SetDocumentPlaceChangedEnabled(!1),Common.NotificationCenter.trigger("comments:cleardummy")}},onEditComments:function(t){if(this.api){var e=0,i=this,n=null,o=this.api.asc_getAnchorPosition();if(o){for(this.isSelectedComment=!0,this.popoverComments.reset(),e=0;e<t.length;++e)(n=this.findComment(t[e].asc_getId()))&&(n.set("editTextInPopover",i.mode.canEditComments&&AscCommon.UserInfoParser.canEditComment(n.username)),n.set("hint",!1),this.popoverComments.push(n));this.getPopover()&&this.popoverComments.length>0&&this.popoverComments.findWhere({hide:!1})&&(this.getPopover().isVisible()&&this.getPopover().hide(),this.getPopover().setLeftTop(o.asc_getX()+o.asc_getWidth(),o.asc_getY(),this.hintmode?o.asc_getX():void 0),this.getPopover().showComments(!0,!1,!0))}}},onAfterShow:function(){if(this.view&&this.api){var t=$(".new-comment-ct",this.view.el);t&&t.length&&"none"!==t.css("display")&&this.view.txtComment.focus(),this.view.needRender?this.updateComments(!0):this.view.needUpdateFilter&&this.onUpdateFilter(this.view.needUpdateFilter),this.view.update()}},onBeforeHide:function(){this.view&&this.view.showEditContainer(!1)},timeZoneOffsetInMs:6e4*(new Date).getTimezoneOffset(),stringOOToLocalDate:function(t){return"string"==typeof t?parseInt(t):0},ooDateToString:function(t){return"[object Date]"===Object.prototype.toString.call(t)?t.getTime().toString():""},stringUtcToLocalDate:function(t){return"string"==typeof t?parseInt(t)+this.timeZoneOffsetInMs:0},utcDateToString:function(t){return"[object Date]"===Object.prototype.toString.call(t)?(t.getTime()-this.timeZoneOffsetInMs).toString():""},dateToLocaleTimeString:function(t){return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()+" "+function(t){var e=t.getHours(),i=t.getMinutes(),n=e>=12?"pm":"am";return e%=12,e=e||12,i=i<10?"0"+i:i,e+":"+i+" "+n}(t)},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},setPreviewMode:function(t){this.viewmode!==t&&(this.viewmode=t,t&&(this.prevcanComments=this.mode.canComments),this.mode.canComments=!t&&this.prevcanComments,this.closeEditing(),this.setMode(this.mode),this.updateComments(!0),this.getPopover()&&(t?this.getPopover().hide():this.getPopover().update(!0)))},clearCollections:function(){this.collection.reset(),this.groupCollection=[]}},Common.Controllers.Comments||{}))}),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/User",["underscore","backbone","common/main/lib/component/BaseView"],function(t,e){"use strict";Common.Models.User=e.Model.extend({defaults:function(){return{iid:Common.UI.getId(),id:void 0,idOriginal:void 0,username:"Guest",color:"#fff",colorval:null,online:!1,view:!1}}})}),define("common/main/lib/collection/Users",["backbone","common/main/lib/model/User"],function(t){"use strict";Common.Collections=Common.Collections||{},Common.Collections.Users=t.Collection.extend({model:Common.Models.User,getOnlineCount:function(){var t=0;return this.each(function(e){e.get("online")&&++t}),t},getEditingCount:function(){return this.filter(function(t){return t.get("online")&&!t.get("view")}).length},getEditingOriginalCount:function(){return this.chain().filter(function(t){return t.get("online")&&!t.get("view")}).groupBy(function(t){return t.get("idOriginal")}).size().value()},findUser:function(t){return this.find(function(e){return e.get("id")==t})},findOriginalUser:function(t){return this.find(function(e){return e.get("idOriginal")==t})}}),Common.Collections.HistoryUsers=t.Collection.extend({model:Common.Models.User,findUser:function(t){return this.find(function(e){return e.get("id")==t})}})}),define("common/main/lib/model/ChatMessage",["backbone"],function(t){"use strict";Common.Models=Common.Models||{},Common.Models.ChatMessage=t.Model.extend({defaults:{type:0,userid:null,username:"",message:""}})}),define("common/main/lib/collection/ChatMessages",["backbone","common/main/lib/model/ChatMessage"],function(t){"use strict";!Common.Collections&&(Common.Collections={}),Common.Collections.ChatMessages=t.Collection.extend({model:Common.Models.ChatMessage})}),define("common/main/lib/controller/Chat",["core","common/main/lib/collection/Users","common/main/lib/collection/ChatMessages","common/main/lib/view/Chat"],function(){"use strict";Common.Controllers.Chat=Backbone.Controller.extend(_.extend({models:[],collections:["Common.Collections.Users","Common.Collections.ChatMessages"],views:["Common.Views.Chat"],initialize:function(){this.addListeners({"Common.Views.Chat":{"message:add":_.bind(this.onSendMessage,this)}});var t=this;Common.NotificationCenter.on("layout:changed",function(e){Common.Utils.asyncCall(function(e){"toolbar"!=e&&"status"!=e||!t.panelChat.$el.is(":visible")||(t.panelChat.updateLayout(!0),t.panelChat.setupAutoSizingTextBox())},this,e)})},events:{},onLaunch:function(){this.panelChat=this.createView("Common.Views.Chat",{storeUsers:this.getApplication().getCollection("Common.Collections.Users"),storeMessages:this.getApplication().getCollection("Common.Collections.ChatMessages")})},setMode:function(t){return this.mode=t,this.api&&(this.mode.canCoAuthoring&&this.mode.canChat&&this.api.asc_registerCallback("asc_onCoAuthoringChatReceiveMessage",_.bind(this.onReceiveMessage,this)),this.mode.isEditDiagram||this.mode.isEditMailMerge||(this.api.asc_registerCallback("asc_onAuthParticipantsChanged",_.bind(this.onUsersChanged,this)),this.api.asc_registerCallback("asc_onConnectionStateChanged",_.bind(this.onUserConnection,this)),this.api.asc_coAuthoringGetUsers()),this.mode.canCoAuthoring&&this.mode.canChat&&this.api.asc_coAuthoringChatGetMessages()),this},setApi:function(t){return this.api=t,this},onUsersChanged:function(t,e){if(!this.mode.canLicense||!this.mode.canCoAuthoring){var i=0;for(o in t)void 0!==o&&i++;if(i>1&&void 0==this._isCoAuthoringStopped)return this._isCoAuthoringStopped=!0,this.api.asc_coAuthoringDisconnect(),void Common.NotificationCenter.trigger("api:disconnect")}var n=this.getApplication().getCollection("Common.Collections.Users");if(n){var o,s,a=[];for(o in t)if(void 0!==o&&(s=t[o])){var r=new Common.Models.User({id:s.asc_getId(),idOriginal:s.asc_getIdOriginal(),username:s.asc_getUserName(),online:!0,color:s.asc_getColor(),view:s.asc_getView()});a[s.asc_getId()==e?"unshift":"push"](r)}n[n.size()>0?"add":"reset"](a)}},onUserConnection:function(t){var e=this.getApplication().getCollection("Common.Collections.Users");if(e){var i=e.findUser(t.asc_getId());i?(i.set({online:t.asc_getState()}),i.set({username:t.asc_getUserName()})):e.add(new Common.Models.User({id:t.asc_getId(),idOriginal:t.asc_getIdOriginal(),username:t.asc_getUserName(),online:t.asc_getState(),color:t.asc_getColor(),view:t.asc_getView()}))}},onReceiveMessage:function(t,e){var i=this.getApplication().getCollection("Common.Collections.ChatMessages");if(i){var n=[];t.forEach(function(t){n.push(new Common.Models.ChatMessage({userid:t.useridoriginal,message:t.message,username:t.username}))}),i[i.size()<1||e?"reset":"add"](n)}},onSendMessage:function(t,e){if(e.length>0){var i=this;(function(t,e){for(var i=[];t;){if(t.length<e){i.push(t);break}i.push(t.substr(0,e)),t=t.substr(e)}return i})(e,2048).forEach(function(t){i.api.asc_coAuthoringChatSendMessage(t)})}},notcriticalErrorTitle:"Warning"},Common.Controllers.Chat||{}))}),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/Plugin",["underscore","backbone","common/main/lib/component/BaseView"],function(t,e){"use strict";Common.Models.PluginVariation=e.Model.extend({defaults:function(){return{description:"",url:"",index:0,icons:void 0,isSystem:!1,isViewer:!1,isDisplayedInViewer:!0,EditorsSupport:["word","cell","slide"],isVisual:!1,isCustomWindow:!1,isModal:!0,isInsideMode:!1,initDataType:0,initData:"",isUpdateOleOnResize:!1,buttons:[],size:[800,600],initOnSelectionChanged:!1,visible:!0}}}),Common.Models.Plugin=e.Model.extend({defaults:function(){return{id:Common.UI.getId(),name:"",baseUrl:"",guid:Common.UI.getId(),variations:[],currentVariation:0,pluginObj:void 0,allowSelected:!1,selected:!1,visible:!0,groupName:"",groupRank:0}}})}),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/Plugins",["underscore","backbone","common/main/lib/model/Plugin"],function(t,e){"use strict";Common.Collections.Plugins=e.Collection.extend({model:Common.Models.Plugin,hasVisible:function(){return!!this.findWhere({visible:!0})}})}),define("common/main/lib/controller/Plugins",["core","common/main/lib/collection/Plugins","common/main/lib/view/Plugins"],function(){"use strict";Common.Controllers.Plugins=Backbone.Controller.extend(_.extend({models:[],appOptions:{},configPlugins:{autostart:[]},serverPlugins:{autostart:[]},collections:["Common.Collections.Plugins"],views:["Common.Views.Plugins"],initialize:function(){var t=this;this.addListeners({Toolbar:{"render:before":function(e){var i=t.getApplication().getController("Main").appOptions;if(!i.isEditMailMerge&&!i.isEditDiagram){var n={action:"plugins",caption:t.panelPlugins.groupCaption};t.$toolbarPanelPlugins=t.panelPlugins.getPanel(),e.addTab(n,t.$toolbarPanelPlugins,10)}}},"Common.Views.Plugins":{"plugin:select":function(e,i){t.api.asc_pluginRun(e,i,"")}}})},events:function(){return{"click #id-plugin-close":_.bind(this.onToolClose,this)}},onLaunch:function(){var t=this.getApplication().getCollection("Common.Collections.Plugins");this.panelPlugins=this.createView("Common.Views.Plugins",{storePlugins:t}),this.panelPlugins.on("render:after",_.bind(this.onAfterRender,this)),t.on({add:this.onAddPlugin.bind(this),reset:this.onResetPlugins.bind(this)}),this._moveOffset={x:0,y:0},this.autostart=[],Common.Gateway.on("init",this.loadConfig.bind(this)),Common.NotificationCenter.on("app:face",this.onAppShowed.bind(this)),Common.NotificationCenter.on("uitheme:changed",this.updatePluginsButtons.bind(this)),Common.NotificationCenter.on("window:resize",this.updatePluginsButtons.bind(this))},loadConfig:function(t){var e=this;e.configPlugins.config=t.config.plugins,e.editor=window.DE?"word":window.PE?"slide":"cell"},loadPlugins:function(){this.configPlugins.config?this.getPlugins(this.configPlugins.config.pluginsData).then(function(e){t.configPlugins.plugins=e,t.mergePlugins()}).catch(function(e){t.configPlugins.plugins=!1}):this.configPlugins.plugins=!1;var t=this;Common.Utils.loadConfig("../../../../plugins.json",function(e){"error"!=e?(t.serverPlugins.config=e,t.getPlugins(t.serverPlugins.config.pluginsData).then(function(e){t.serverPlugins.plugins=e,t.mergePlugins()}).catch(function(e){t.serverPlugins.plugins=!1})):t.serverPlugins.plugins=!1})},onAppShowed:function(t){},setApi:function(t){return this.api=t,this.appOptions.customization&&!1===this.appOptions.customization.plugins||(this.api.asc_registerCallback("asc_onPluginShow",_.bind(this.onPluginShow,this)),this.api.asc_registerCallback("asc_onPluginClose",_.bind(this.onPluginClose,this)),this.api.asc_registerCallback("asc_onPluginResize",_.bind(this.onPluginResize,this)),this.api.asc_registerCallback("asc_onPluginMouseUp",_.bind(this.onPluginMouseUp,this)),this.api.asc_registerCallback("asc_onPluginMouseMove",_.bind(this.onPluginMouseMove,this)),this.api.asc_registerCallback("asc_onPluginsReset",_.bind(this.resetPluginsList,this)),this.api.asc_registerCallback("asc_onPluginsInit",_.bind(this.onPluginsInit,this)),this.loadPlugins()),this},setMode:function(t,e){return this.appOptions=t,this.api=e,this.customPluginsComplete=!this.appOptions.canBrandingExt,this.appOptions.canBrandingExt&&this.getAppCustomPlugins(this.configPlugins),this},onAfterRender:function(t){t.viewPluginsList&&t.viewPluginsList.on("item:click",_.bind(this.onSelectPlugin,this)),this.bindViewEvents(this.panelPlugins,this.events);var e=this;Common.NotificationCenter.on({"layout:resizestart":function(t){if(e.panelPlugins.isVisible()){var i=e.panelPlugins.currentPluginFrame.offset();e._moveOffset={x:i.left+parseInt(e.panelPlugins.currentPluginFrame.css("padding-left")),y:i.top+parseInt(e.panelPlugins.currentPluginFrame.css("padding-top"))},e.api.asc_pluginEnableMouseEvents(!0)}},"layout:resizestop":function(t){e.panelPlugins.isVisible()&&e.api.asc_pluginEnableMouseEvents(!1)}})},refreshPluginsList:function(){var t=this.getApplication().getCollection("Common.Collections.Plugins"),e=[];t.each(function(t){var i=new Asc.CPlugin;i.set_Name(t.get("name")),i.set_Guid(t.get("guid")),i.set_BaseUrl(t.get("baseUrl")),i.set_MinVersion&&i.set_MinVersion(t.get("minVersion"));var n=t.get("variations"),o=[];n.forEach(function(t){var e=new Asc.CPluginVariation;e.set_Description(t.get("description")),e.set_Url(t.get("url")),e.set_Icons(t.get("icons")),e.set_Visual(t.get("isVisual")),e.set_CustomWindow(t.get("isCustomWindow")),e.set_System(t.get("isSystem")),e.set_Viewer(t.get("isViewer")),e.set_EditorsSupport(t.get("EditorsSupport")),e.set_Modal(t.get("isModal")),e.set_InsideMode(t.get("isInsideMode")),e.set_InitDataType(t.get("initDataType")),e.set_InitData(t.get("initData")),e.set_UpdateOleOnResize(t.get("isUpdateOleOnResize")),e.set_Buttons(t.get("buttons")),e.set_Size(t.get("size")),e.set_InitOnSelectionChanged(t.get("initOnSelectionChanged")),e.set_Events(t.get("events")),e.set_Help(t.get("help")),o.push(e)}),i.set_Variations(o),t.set("pluginObj",i),e.push(i)}),this.api.asc_pluginsRegister("",e),t.hasVisible()&&Common.NotificationCenter.trigger("tab:visible","plugins",!0),Common.Gateway.pluginsReady()},onAddPlugin:function(t){var e=this;if(e.$toolbarPanelPlugins){var i=e.panelPlugins.createPluginButton(t);if(!i)return;var n=$("> .group",e.$toolbarPanelPlugins),o=$('<span class="btn-slot text x-huge"></span>').appendTo(n);i.render(o)}},onResetPlugins:function(t){var e=this;if(e.appOptions.canPlugins=!t.isEmpty(),e.$toolbarPanelPlugins){e.$toolbarPanelPlugins.empty();var i=$('<div class="group"></div>'),n=-1,o=0;t.each(function(t){var s=t.get("groupRank");s!==n&&n>-1&&o>0&&(i.appendTo(e.$toolbarPanelPlugins),$('<div class="separator long"></div>').appendTo(e.$toolbarPanelPlugins),i=$('<div class="group"></div>'),o=0);var a=e.panelPlugins.createPluginButton(t);if(a){var r=$('<span class="btn-slot text x-huge"></span>').appendTo(i);a.render(r),o++}n=s}),i.appendTo(e.$toolbarPanelPlugins)}else console.error("toolbar panel isnot created")},updatePluginsButtons:function(){var t=this;this.getApplication().getCollection("Common.Collections.Plugins").each(function(e){t.panelPlugins.updatePluginIcons(e)})},onSelectPlugin:function(t,e,i,n){var o=$(n.target);if(o&&o.hasClass("plugin-caret")){var s=this.panelPlugins.pluginMenu;if(s.isVisible())return void s.hide();var a,r=this,l=$(n.currentTarget),c=$(this.panelPlugins.el),d=l.offset(),h=c.offset();if(a=[d.left-h.left+l.width(),d.top-h.top+l.height()/2],void 0!=i){for(var p=0;p<s.items.length;p++)s.removeItem(s.items[p]),p--;s.removeAll();for(var m=i.get("variations"),p=0;p<m.length;p++){var u=m[p],g=new Common.UI.MenuItem({caption:p>0?u.get("description"):r.panelPlugins.textStart,value:parseInt(u.get("index"))}).on("click",function(t,e){r.api&&r.api.asc_pluginRun(i.get("guid"),t.value,"")});s.addItem(g)}}var b=c.find("#menu-plugin-container");s.rendered||(b.length<1&&(b=$('<div id="menu-plugin-container" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',s.id),c.append(b)),s.render(b),s.cmpEl.attr({tabindex:"-1"}),s.on({"show:after":function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!0)},"hide:after":function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!1)}})),b.css({left:a[0],top:a[1]}),s.menuAlignEl=l,s.setOffset(-20,-l.height()/2-3),s.show(),_.delay(function(){s.cmpEl.focus()},10),n.stopPropagation(),n.preventDefault()}else this.api.asc_pluginRun(i.get("guid"),0,"")},onPluginShow:function(t,e,i,n){var o=t.get_Variations()[e];if(o.get_Visual()){var s=o.get_Url();if(s=(0==t.get_BaseUrl().length?s:t.get_BaseUrl())+s,n&&(s+=n),o.get_InsideMode())this.panelPlugins.openInsideMode(t.get_Name(),s,i)||this.api.asc_pluginButtonClick(-1);else{var a=this,r=o.get_CustomWindow(),l=o.get_Buttons(),c=[],d=o.get_Size(),h=o.get_Modal();(!d||d.length<2)&&(d=[800,600]),_.isArray(l)&&_.each(l,function(t,e){t.visible&&(c[e]={caption:t.text,value:e,primary:t.primary})});var p=o.get_Help();a.pluginDlg=new Common.Views.PluginDlg({cls:r?"plain":"",header:!r,title:t.get_Name(),width:d[0],height:d[1],url:s,frameId:i,buttons:r?void 0:c,toolcallback:_.bind(this.onToolClose,this),help:!!p,modal:void 0===h||h}),a.pluginDlg.on({"render:after":function(t){t.getChild(".footer .dlg-btn").on("click",_.bind(a.onDlgBtnClick,a)),a.pluginContainer=a.pluginDlg.$window.find("#id-plugin-container")},close:function(t){a.pluginDlg=void 0},drag:function(t){a.api.asc_pluginEnableMouseEvents("start"==t[1])},resize:function(t){a.api.asc_pluginEnableMouseEvents("start"==t[1])},help:function(){p&&window.open(p,"_blank")}}),a.pluginDlg.show()}}this.panelPlugins.openedPluginMode(t.get_Guid())},onPluginClose:function(t){this.pluginDlg?this.pluginDlg.close():this.panelPlugins.iframePlugin&&this.panelPlugins.closeInsideMode(),this.panelPlugins.closedPluginMode(t.get_Guid()),this.runAutoStartPlugins()},onPluginResize:function(t,e,i,n){if(this.pluginDlg){var o=e&&e.length>1&&i&&i.length>1&&(i[0]>e[0]||i[1]>e[1]||0==i[0]||0==i[1]);this.pluginDlg.setResizable(o,e,i),this.pluginDlg.setInnerSize(t[0],t[1]),n&&n.call()}},onDlgBtnClick:function(t){var e=t.currentTarget.attributes.result.value;this.api.asc_pluginButtonClick(parseInt(e))},onToolClose:function(){this.api.asc_pluginButtonClick(-1)},onPluginMouseUp:function(t,e){this.pluginDlg?(this.pluginDlg.binding.dragStop&&this.pluginDlg.binding.dragStop(),this.pluginDlg.binding.resizeStop&&this.pluginDlg.binding.resizeStop()):Common.NotificationCenter.trigger("frame:mouseup",{pageX:t*Common.Utils.zoom()+this._moveOffset.x,pageY:e*Common.Utils.zoom()+this._moveOffset.y})},onPluginMouseMove:function(t,e){if(this.pluginDlg){var i=this.pluginContainer.offset();this.pluginDlg.binding.drag&&this.pluginDlg.binding.drag({pageX:t*Common.Utils.zoom()+i.left,pageY:e*Common.Utils.zoom()+i.top}),this.pluginDlg.binding.resize&&this.pluginDlg.binding.resize({pageX:t*Common.Utils.zoom()+i.left,pageY:e*Common.Utils.zoom()+i.top})}else Common.NotificationCenter.trigger("frame:mousemove",{pageX:t*Common.Utils.zoom()+this._moveOffset.x,pageY:e*Common.Utils.zoom()+this._moveOffset.y})},onPluginsInit:function(t){!(t instanceof Array)&&(t=t.pluginsData),this.parsePlugins(t)},runAutoStartPlugins:function(){this.autostart&&this.autostart.length>0&&this.api.asc_pluginRun(this.autostart.shift(),0,"")},resetPluginsList:function(){this.getApplication().getCollection("Common.Collections.Plugins").reset()},applyUICustomization:function(){var me=this;return new Promise(function(resolve,reject){var timer_sl=setInterval(function(){if(me.customPluginsComplete){clearInterval(timer_sl);try{me.configPlugins.UIplugins&&me.configPlugins.UIplugins.forEach(function(c){c.code&&eval(c.code)})}catch(t){}resolve()}},10)})},parsePlugins:function(t,e){var i=this,n=this.getApplication().getCollection("Common.Collections.Plugins"),o=i.appOptions.isEdit,s=i.editor,a=i.api?i.api.GetVersion():void 0;if(t instanceof Array){var r=[],l=[],c=i.appOptions.lang.split(/[\-_]/)[0];t.forEach(function(t){if(!(r.some(function(e){return e.get("baseUrl")==t.baseUrl||e.get("guid")==t.guid})||n.findWhere({baseUrl:t.baseUrl})||n.findWhere({guid:t.guid}))){var e=[],d=!1;if(t.variations.forEach(function(i){var n=(o||i.isViewer&&!1!==i.isDisplayedInViewer)&&_.contains(i.EditorsSupport,s)&&!i.isSystem;if(n&&(d=!0),t.isUICustomizer)n&&l.push({url:t.baseUrl+i.url});else{var a=new Common.Models.PluginVariation(i),r=i.description;"object"==typeof i.descriptionLocale&&(r=i.descriptionLocale[c]||i.descriptionLocale.en||r||""),_.each(i.buttons,function(t,e){"object"==typeof t.textLocale&&(t.text=t.textLocale[c]||t.textLocale.en||t.text||""),t.visible=o||!1!==t.isViewer}),a.set({description:r,index:e.length,url:i.url,icons:i.icons2||i.icons,buttons:i.buttons,visible:n,help:i.help}),e.push(a)}}),e.length>0&&!t.isUICustomizer){var h=t.name;"object"==typeof t.nameLocale&&(h=t.nameLocale[c]||t.nameLocale.en||h||""),d&&(d=i.checkPluginVersion(a,t.minVersion)),r.push(new Common.Models.Plugin({name:h,guid:t.guid,baseUrl:t.baseUrl,variations:e,currentVariation:0,visible:d,groupName:t.group?t.group.name:"",groupRank:t.group?t.group.rank:0,minVersion:t.minVersion}))}}}),!1!==e&&(i.configPlugins.UIplugins=l),!e&&n&&(r=n.models.concat(r),r.sort(function(t,e){var i=t.get("groupRank"),n=e.get("groupRank");return i<n?0==i?1:-1:i>n?0==n?-1:1:0}),n.reset(r),this.appOptions.canPlugins=!n.isEmpty())}else e||(this.appOptions.canPlugins=!1)
;e||this.getApplication().getController("LeftMenu").enablePlugins(),this.appOptions.canPlugins&&(this.refreshPluginsList(),this.runAutoStartPlugins())},checkPluginVersion:function(t,e){if(t&&"develop"!==t&&e&&"string"==typeof e){var i=e.match(/^([0-9]+)(?:.([0-9]+))?(?:.([0-9]+))?$/),n=t.match(/^([0-9]+)(?:.([0-9]+))?(?:.([0-9]+))?$/);if(i&&i.length>1&&n&&n.length>1)for(var o=0;o<3;o++){var s=i[o+1]?parseInt(i[o+1]):0,a=n[o+1]?parseInt(n[o+1]):0;if(s>a)return!1;if(s<a)return!0}}return!0},getPlugins:function(t,e){if(!t||t.length<1)return Promise.resolve([]);e=e||function(t){return fetch(t).then(function(e){return e.ok?e.json():Promise.reject(t)}).then(function(e){return e.baseUrl=t.substring(0,t.lastIndexOf("config.json")),e})};var i=[];return t.map(e).reduce(function(t,e){return t.then(function(){return e}).then(function(t){return i.push(t),Promise.resolve(t)}).catch(function(t){return Promise.resolve(t)})},Promise.resolve()).then(function(){return Promise.resolve(i)})},mergePlugins:function(){if(void 0!==this.serverPlugins.plugins&&void 0!==this.configPlugins.plugins){var t=[],e=[],i=this.configPlugins,n=!1;if(i.plugins&&i.plugins.length>0&&(e=i.plugins),i&&i.config){var o=i.config.autostart||i.config.autoStartGuid;"string"==typeof o&&(o=[o]),n=!!i.config.autoStartGuid,t=o||[]}i=this.serverPlugins,i.plugins&&i.plugins.length>0&&(e=e.concat(i.plugins)),i&&i.config&&(o=i.config.autostart||i.config.autoStartGuid,"string"==typeof o&&(o=[o]),(n||i.config.autoStartGuid)&&console.warn("Obsolete: The autoStartGuid parameter is deprecated. Please check the documentation for new plugin connection configuration."),t=t.concat(o||[])),this.autostart=t,this.parsePlugins(e,!1)}},getAppCustomPlugins:function(t){var e=this,i=function(){e.customPluginsComplete=!0};t.config?this.getPlugins(t.config.UIpluginsData).then(function(n){e.parsePlugins(n,!0),e.getPlugins(t.UIplugins,function(t){return fetch(t.url).then(function(t){return t.ok?t.text():Promise.reject()}).then(function(e){return t.code=e,e})}).then(i,i)},i):i()}},Common.Controllers.Plugins||{}))}),define("common/main/lib/view/ExternalDiagramEditor",["common/main/lib/component/Window"],function(){"use strict";Common.Views.ExternalDiagramEditor=Common.UI.Window.extend(_.extend({initialize:function(t){var e={},i=Common.Utils.innerHeight()-Common.Utils.InternalSettings.get("window-inactive-area-top");_.extend(e,{title:this.textTitle,width:910,height:i-700<0?i:700,cls:"advanced-settings-dlg",header:!0,toolclose:"hide",toolcallback:_.bind(this.onToolClose,this)},t),this.template=['<div id="id-diagram-editor-container" class="box" style="height:'+(e.height-85)+'px;">','<div id="id-diagram-editor-placeholder" style="width: 100%;height: 100%;"></div>',"</div>",'<div class="separator horizontal"></div>','<div class="footer" style="text-align: center;">','<button id="id-btn-diagram-editor-apply" class="btn normal dlg-btn primary custom" result="ok">'+this.textSave+"</button>",'<button id="id-btn-diagram-editor-cancel" class="btn normal dlg-btn" result="cancel">'+this.textClose+"</button>","</div>"].join(""),e.tpl=_.template(this.template)(e),this.handler=e.handler,this._chartData=null,this._isNewChart=!0,Common.UI.Window.prototype.initialize.call(this,e)},render:function(){Common.UI.Window.prototype.render.call(this),this.btnSave=new Common.UI.Button({el:$("#id-btn-diagram-editor-apply"),disabled:!0}),this.btnCancel=new Common.UI.Button({el:$("#id-btn-diagram-editor-cancel")}),this.$window.find(".dlg-btn").on("click",_.bind(this.onDlgBtnClick,this))},show:function(){this.setPlaceholder(),Common.UI.Window.prototype.show.apply(this,arguments)},setChartData:function(t){this._chartData=t,this._isExternalDocReady&&this.fireEvent("setchartdata",this)},setEditMode:function(t){this._isNewChart=!t},isEditMode:function(){return!this._isNewChart},setControlsDisabled:function(t){this.btnSave.setDisabled(t),this.btnCancel.setDisabled(t),t?this.$window.find(".tool.close").addClass("disabled"):this.$window.find(".tool.close").removeClass("disabled")},onDlgBtnClick:function(t){if(this.handler)return void this.handler.call(this,t.currentTarget.attributes.result.value);this.hide()},onToolClose:function(){if(this.handler)return void this.handler.call(this,"cancel");this.hide()},setHeight:function(t){if(t>=0){var e=parseInt(this.$window.css("min-height"));t<e&&(t=e),this.$window.height(t);var i=this.initConfig.header?parseInt(this.$window.find("> .header").css("height")):0;this.$window.find("> .body").css("height",t-i),this.$window.find("> .body > .box").css("height",t-85);var n=(Common.Utils.innerHeight()-Common.Utils.InternalSettings.get("window-inactive-area-top")-parseInt(t))/2,o=(Common.Utils.innerWidth()-parseInt(this.initConfig.width))/2;this.$window.css("left",o),this.$window.css("top",Common.Utils.InternalSettings.get("window-inactive-area-top")+n)}},setPlaceholder:function(t){this._placeholder=t},getPlaceholder:function(){return this._placeholder},textSave:"Save & Exit",textClose:"Close",textTitle:"Chart Editor"},Common.Views.ExternalDiagramEditor||{}))}),void 0===Common)var Common={};if(Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/ExternalDiagramEditor",["core","common/main/lib/view/ExternalDiagramEditor"],function(){"use strict";Common.Controllers.ExternalDiagramEditor=Backbone.Controller.extend(_.extend(function(){var t="en",e=void 0,i="",n=null,o=!0,s=function(){!!e&&(e.uiTheme=Common.localStorage.getItem("ui-theme-id","theme-light")),n=new DocsAPI.DocEditor("id-diagram-editor-placeholder",{width:"100%",height:"100%",documentType:"cell",document:{url:"_chart_",permissions:{edit:!0,download:!1}},editorConfig:{mode:"editdiagram",targetApp:i,lang:t,canCoAuthoring:!1,canBackToFolder:!1,canCreateNew:!1,customization:e,user:{id:"uid-"+Date.now()}},events:{onAppReady:function(){},onDocumentStateChange:function(){},onError:function(){},onInternalMessage:_.bind(this.onInternalMessage,this)}}),Common.Gateway.on("processmouse",_.bind(this.onProcessMouse,this))};return{views:["Common.Views.ExternalDiagramEditor"],initialize:function(){this.addListeners({"Common.Views.ExternalDiagramEditor":{setchartdata:_.bind(this.setChartData,this),drag:_.bind(function(t,e){n&&n.serviceCommand("window:drag","start"==e)},this),show:_.bind(function(t){var e=this.diagramEditorView.getHeight(),i=Common.Utils.innerHeight()-Common.Utils.InternalSettings.get("window-inactive-area-top");(i>e&&e<700||i<e)&&(e=Math.min(i,700),this.diagramEditorView.setHeight(e)),n?(n.serviceCommand("setAppDisabled",!1),o&&this.diagramEditorView._isExternalDocReady&&(o=!1,this.diagramEditorView._chartData&&this.setChartData()),this.needDisableEditing&&this.diagramEditorView._isExternalDocReady&&this.onDiagrammEditingDisabled(),n.attachMouseEvents()):s.apply(this),this.isExternalEditorVisible=!0,this.isHandlerCalled=!1},this),hide:_.bind(function(t){n&&(n.detachMouseEvents(),this.isExternalEditorVisible=!1)},this)}})},onLaunch:function(){this.diagramEditorView=this.createView("Common.Views.ExternalDiagramEditor",{handler:_.bind(this.handler,this)})},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onCloseChartEditor",_.bind(this.onDiagrammEditingDisabled,this)),this},handler:function(t,e){this.isHandlerCalled||(this.isHandlerCalled=!0,this.diagramEditorView._isExternalDocReady?n&&n.serviceCommand("queryClose",{mr:t}):(this.diagramEditorView.hide(),this.isHandlerCalled=!1))},setChartData:function(){o||(n&&n.serviceCommand("setChartData",this.diagramEditorView._chartData),this.diagramEditorView._chartData=null)},loadConfig:function(n){n&&n.config&&(n.config.lang&&(t=n.config.lang),n.config.customization&&(e=n.config.customization),n.config.targetApp&&(i=n.config.targetApp))},onDiagrammEditingDisabled:function(){if(!this.diagramEditorView.isVisible()||!this.diagramEditorView._isExternalDocReady)return void(this.needDisableEditing=!0);this.diagramEditorView.setControlsDisabled(!0),Common.UI.alert({title:this.warningTitle,msg:this.warningText,iconCls:"warn",buttons:["ok"],callback:_.bind(function(t){this.setControlsDisabled(!1),this.diagramEditorView.hide()},this)}),this.needDisableEditing=!1},onInternalMessage:function(t){var e=t.data;if(this.diagramEditorView)if("documentReady"==e.type)this.diagramEditorView._isExternalDocReady=!0,this.isExternalEditorVisible&&(o=!1),this.diagramEditorView._chartData&&this.setChartData(),this.needDisableEditing&&this.onDiagrammEditingDisabled();else if("chartDataReady"==e.type)void 0===this.needDisableEditing&&this.diagramEditorView.setControlsDisabled(!1);else if("shortcut"==e.type)"escape"==e.data.key&&this.diagramEditorView.hide();else if("canClose"==e.type)!0===e.data.answer&&(n&&(n.serviceCommand("setAppDisabled",!0),n.serviceCommand("ok"==e.data.mr?"getChartData":"clearChartData")),this.diagramEditorView.hide()),this.isHandlerCalled=!1;else if("processMouse"==e.type){if("mouse:up"==e.data.event)this.diagramEditorView.binding.dragStop();else if("mouse:move"==e.data.event){var i=parseInt(this.diagramEditorView.$window.css("left"))+e.data.pagex,s=parseInt(this.diagramEditorView.$window.css("top"))+e.data.pagey+34;this.diagramEditorView.binding.drag({pageX:i,pageY:s})}}else this.diagramEditorView.fireEvent("internalmessage",this.diagramEditorView,e)},onProcessMouse:function(t){"mouseup"==t.type&&this.isExternalEditorVisible&&n&&n.serviceCommand("processmouse",t)},showExternalEditor:function(){if(n){var t=Common.localStorage.getItem("ui-theme-id","theme-light");n.serviceCommand("theme:change",t)}this.diagramEditorView.show()},warningTitle:"Warning",warningText:"The object is disabled because of editing by another user.",textClose:"Close",textAnonymous:"Anonymous"}}(),Common.Controllers.ExternalDiagramEditor||{}))}),define("common/main/lib/view/ExternalMergeEditor",["common/main/lib/component/Window"],function(){"use strict";Common.Views.ExternalMergeEditor=Common.UI.Window.extend(_.extend({initialize:function(t){var e={};_.extend(e,{title:this.textTitle,width:910,height:Common.Utils.innerHeight()-700<0?Common.Utils.innerHeight():700,cls:"advanced-settings-dlg",header:!0,toolclose:"hide",toolcallback:_.bind(this.onToolClose,this)},t),this.template=['<div id="id-merge-editor-container" class="box" style="height:'+(e.height-85)+'px;">','<div id="id-merge-editor-placeholder" style="width: 100%;height: 100%;"></div>',"</div>",'<div class="separator horizontal"></div>','<div class="footer" style="text-align: center;">','<button id="id-btn-merge-editor-apply" class="btn normal dlg-btn primary custom" result="ok">'+this.textSave+"</button>",'<button id="id-btn-merge-editor-cancel" class="btn normal dlg-btn disabled" result="cancel">'+this.textClose+"</button>","</div>"].join(""),e.tpl=_.template(this.template)(e),this.handler=e.handler,this._mergeData=null,this._isNewMerge=!0,Common.UI.Window.prototype.initialize.call(this,e)},render:function(){Common.UI.Window.prototype.render.call(this),this.btnSave=new Common.UI.Button({el:$("#id-btn-merge-editor-apply"),disabled:!0}),this.btnCancel=new Common.UI.Button({el:$("#id-btn-merge-editor-cancel"),disabled:!0}),this.$window.find(".tool.close").addClass("disabled"),this.$window.find(".dlg-btn").on("click",_.bind(this.onDlgBtnClick,this))},setMergeData:function(t){this._mergeData=t,this._isExternalDocReady&&this.fireEvent("setmergedata",this)},setEditMode:function(t){this._isNewMerge=!t},isEditMode:function(){return!this._isNewMerge},setControlsDisabled:function(t){this.btnSave.setDisabled(t),this.btnCancel.setDisabled(t),t?this.$window.find(".tool.close").addClass("disabled"):this.$window.find(".tool.close").removeClass("disabled")},onDlgBtnClick:function(t){var e=t.currentTarget.attributes.result.value;this.handler&&this.handler.call(this,e)||this.hide()},onToolClose:function(){this.handler&&this.handler.call(this,"cancel")||this.hide()},setHeight:function(t){if(t>=0){var e=parseInt(this.$window.css("min-height"));t<e&&(t=e),this.$window.height(t);var i=this.initConfig.header?parseInt(this.$window.find("> .header").css("height")):0;this.$window.find("> .body").css("height",t-i),this.$window.find("> .body > .box").css("height",t-85);var n=(Common.Utils.innerHeight()-parseInt(t))/2,o=(Common.Utils.innerWidth()-parseInt(this.initConfig.width))/2;this.$window.css("left",o),this.$window.css("top",n)}},textSave:"Save & Exit",textClose:"Close",textTitle:"Mail Merge Recipients"},Common.Views.ExternalMergeEditor||{}))}),void 0===Common)var Common={};if(Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/ExternalMergeEditor",["core","common/main/lib/view/ExternalMergeEditor"],function(){"use strict";Common.Controllers.ExternalMergeEditor=Backbone.Controller.extend(_.extend(function(){var t="en",e=void 0,i="",n=null,o=function(){n=new DocsAPI.DocEditor("id-merge-editor-placeholder",{width:"100%",height:"100%",documentType:"cell",document:{url:"_chart_",permissions:{edit:!0,download:!1}},editorConfig:{mode:"editmerge",targetApp:i,lang:t,canCoAuthoring:!1,canBackToFolder:!1,canCreateNew:!1,customization:e,user:{id:"uid-"+Date.now()}},events:{onAppReady:function(){},onDocumentStateChange:function(){},onError:function(){},onInternalMessage:_.bind(this.onInternalMessage,this)}}),Common.Gateway.on("processmouse",_.bind(this.onProcessMouse,this))};return{views:["Common.Views.ExternalMergeEditor"],initialize:function(){this.addListeners({"Common.Views.ExternalMergeEditor":{setmergedata:_.bind(this.setMergeData,this),drag:_.bind(function(t,e){n&&n.serviceCommand("window:drag","start"==e)},this),show:_.bind(function(t){var e=this.mergeEditorView.getHeight(),i=Common.Utils.innerHeight();(i>e&&e<700||i<e)&&(e=Math.min(i,700),this.mergeEditorView.setHeight(e)),n?(n.serviceCommand("setAppDisabled",!1),this.needDisableEditing&&this.mergeEditorView._isExternalDocReady&&this.onMergeEditingDisabled(),n.attachMouseEvents()):o.apply(this),this.isExternalEditorVisible=!0},this),hide:_.bind(function(t){n&&(n.detachMouseEvents(),this.isExternalEditorVisible=!1)},this)}})},onLaunch:function(){this.mergeEditorView=this.createView("Common.Views.ExternalMergeEditor",{handler:_.bind(this.handler,this)})},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onCloseMergeEditor",_.bind(this.onMergeEditingDisabled,this)),this},handler:function(t,e){return n&&n.serviceCommand("queryClose",{mr:t}),!0},setMergeData:function(){n&&n.serviceCommand("setMergeData",this.mergeEditorView._mergeData),this.mergeEditorView.setEditMode(!0),this.mergeEditorView._mergeData=null},loadConfig:function(n){n&&n.config&&(n.config.lang&&(t=n.config.lang),n.config.customization&&(e=n.config.customization),n.config.targetApp&&(i=n.config.targetApp))},onMergeEditingDisabled:function(){if(!this.mergeEditorView.isVisible()||!this.mergeEditorView._isExternalDocReady)return void(this.needDisableEditing=!0);this.mergeEditorView.setControlsDisabled(!0),Common.UI.alert({title:this.warningTitle,msg:this.warningText,iconCls:"warn",buttons:["ok"],callback:_.bind(function(t){this.setControlsDisabled(!1),this.mergeEditorView.hide()},this)}),this.needDisableEditing=!1},onInternalMessage:function(t){var e=t.data;if(this.mergeEditorView)if("documentReady"==e.type)this.mergeEditorView._isExternalDocReady=!0,this.mergeEditorView.setControlsDisabled(!1),this.mergeEditorView._mergeData&&(n&&n.serviceCommand("setMergeData",this.mergeEditorView._mergeData),this.mergeEditorView._mergeData=null),this.needDisableEditing&&this.onMergeEditingDisabled();else if("shortcut"==e.type)"escape"==e.data.key&&this.mergeEditorView.hide();else if("canClose"==e.type)!0===e.data.answer&&(n&&(n.serviceCommand("setAppDisabled",!0),"ok"==e.data.mr&&n.serviceCommand("getMergeData")),this.mergeEditorView.hide());else if("processMouse"==e.type){if("mouse:up"==e.data.event)this.mergeEditorView.binding.dragStop();else if("mouse:move"==e.data.event){var i=parseInt(this.mergeEditorView.$window.css("left"))+e.data.pagex,o=parseInt(this.mergeEditorView.$window.css("top"))+e.data.pagey+34;this.mergeEditorView.binding.drag({pageX:i,pageY:o})}}else this.mergeEditorView.fireEvent("internalmessage",this.mergeEditorView,e)},onProcessMouse:function(t){"mouseup"==t.type&&this.isExternalEditorVisible&&n&&n.serviceCommand("processmouse",t)},warningTitle:"Warning",warningText:"The object is disabled because of editing by another user.",textClose:"Close",textAnonymous:"Anonymous"}}(),Common.Controllers.ExternalMergeEditor||{}))}),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/ReviewChange",["underscore","backbone","common/main/lib/component/BaseView"],function(t,e){"use strict";Common.Models.ReviewChange=e.Model.extend({defaults:{uid:0,userid:0,username:"Guest",usercolor:null,date:void 0,changetext:"",lock:!1,lockuser:"",type:0,changedata:null,hint:!1,editable:!1,id:Common.UI.getId(),scope:null}})}),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/ReviewChanges",["underscore","backbone","common/main/lib/model/ReviewChange"],function(t,e){"use strict";Common.Collections.ReviewChanges=e.Collection.extend({model:Common.Models.ReviewChange})}),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/ReviewChanges",["common/main/lib/util/utils","common/main/lib/component/Button","common/main/lib/component/DataView","common/main/lib/component/Layout","common/main/lib/component/Window"],function(){"use strict";Common.Views.ReviewChanges=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;t.appConfig.canReview&&(this.btnAccept.on("click",function(e){t.fireEvent("reviewchange:accept",[t.btnAccept,"current"])}),this.btnAccept.menu&&this.btnAccept.menu.on("item:click",function(e,i,n){t.fireEvent("reviewchange:accept",[e,i])}),this.btnReject.on("click",function(e){t.fireEvent("reviewchange:reject",[t.btnReject,"current"])}),this.btnReject.menu&&this.btnReject.menu.on("item:click",function(e,i,n){t.fireEvent("reviewchange:reject",[e,i])}),t.appConfig.canFeatureComparison&&(this.btnCompare.on("click",function(e){t.fireEvent("reviewchange:compare",["file"])}),this.btnCompare.menu.on("item:click",function(e,i,n){t.fireEvent("reviewchange:compare",[i.value])})),this.btnsTurnReview.forEach(function(e){e.on("click",function(t,e){Common.NotificationCenter.trigger("reviewchanges:turn",t.pressed),Common.NotificationCenter.trigger("edit:complete")}),!t.appConfig.isReviewOnly&&e.menu.on("item:toggle",function(e,i,n,o){n&&(2==i.value?Common.UI.warning({title:t.textWarnTrackChangesTitle,msg:t.textWarnTrackChanges,maxwidth:600,buttons:[{value:"enable",caption:t.textEnable},"cancel"],primary:"enable",callback:function(e){if("enable"==e)Common.NotificationCenter.trigger("reviewchanges:turn",0==i.value||2==i.value,i.value>1);else{var n=Common.Utils.InternalSettings.get(t.appPrefix+"track-changes");t.turnChanges(0==n||2==n,n>1)}Common.NotificationCenter.trigger("edit:complete")}}):Common.NotificationCenter.trigger("reviewchanges:turn",0==i.value||2==i.value,i.value>1))})})),this.appConfig.canViewReview&&(this.btnPrev.on("click",function(e){t.fireEvent("reviewchange:preview",[t.btnPrev,"prev"])}),this.btnNext.on("click",function(e){t.fireEvent("reviewchange:preview",[t.btnNext,"next"])}),this.btnReviewView&&this.btnReviewView.menu.on("item:click",function(e,i,n){t.fireEvent("reviewchange:view",[e,i])})),this.btnsSpelling.forEach(function(e){e.on("click",function(e,i){Common.NotificationCenter.trigger("spelling:turn",e.pressed?"on":"off"),Common.NotificationCenter.trigger("edit:complete",t)})}),this.btnsDocLang.forEach(function(e){e.on("click",function(e,i){t.fireEvent("lang:document",this)})}),this.btnSharing&&this.btnSharing.on("click",function(t,e){Common.NotificationCenter.trigger("collaboration:sharing")}),this.btnCoAuthMode&&this.btnCoAuthMode.menu.on("item:click",function(e,i,n){t.fireEvent("collaboration:coauthmode",[e,i])}),this.btnHistory&&this.btnHistory.on("click",function(t,e){Common.NotificationCenter.trigger("collaboration:history")}),this.btnChat&&this.btnChat.on("click",function(e,i){t.fireEvent("collaboration:chat",[e.pressed])}),this.btnCommentRemove&&(this.btnCommentRemove.on("click",function(e){t.fireEvent("comment:removeComments",["current"])}),this.btnCommentRemove.menu.on("item:click",function(e,i,n){t.fireEvent("comment:removeComments",[i.value])})),this.btnCommentResolve&&(this.btnCommentResolve.on("click",function(e){t.fireEvent("comment:resolveComments",["current"])}),this.btnCommentResolve.menu.on("item:click",function(e,i,n){t.fireEvent("comment:resolveComments",[i.value])}))}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.appConfig=t.mode;var e=Common.localStorage.getKeysFilter();if(this.appPrefix=e&&e.length?e.split(",")[0]:"",this.appConfig.canReview&&(this.btnAccept=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",caption:this.txtAccept,split:!this.appConfig.canUseReviewPermissions,iconCls:"toolbar__icon btn-review-save"}),this.btnReject=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",caption:this.txtReject,split:!this.appConfig.canUseReviewPermissions,iconCls:"toolbar__icon btn-review-deny"}),this.appConfig.canFeatureComparison&&(this.btnCompare=new Common.UI.Button({cls:"btn-toolbar  x-huge icon-top",caption:this.txtCompare,split:!0,iconCls:"toolbar__icon btn-compare"})),this.btnTurnOn=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-review",caption:this.txtTurnon,split:!this.appConfig.isReviewOnly,enableToggle:!0}),this.btnsTurnReview=[this.btnTurnOn]),this.appConfig.canViewReview&&(this.btnPrev=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-review-prev",caption:this.txtPrev}),this.btnNext=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-review-next",caption:this.txtNext}),!(this.appConfig.isRestrictedEdit||this.appConfig.customization&&this.appConfig.customization.review&&this.appConfig.customization.review.hideReviewDisplay))){var i=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div><%= caption %></div><% if (options.description !== null) { %><label style="display: block;color: #a5a5a5;cursor: pointer;white-space: normal;"><%= options.description %></label><% } %></a>');this.btnReviewView=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-reviewview",caption:this.txtView,menu:new Common.UI.Menu({cls:"ppm-toolbar",items:[{caption:this.txtMarkupCap,checkable:!0,toggleGroup:"menuReviewView",checked:!0,value:"markup",template:i,description:this.txtMarkup},{caption:this.txtMarkupSimpleCap,checkable:!0,toggleGroup:"menuReviewView",checked:!1,value:"simple",template:i,description:this.txtMarkupSimple},{caption:this.txtFinalCap,checkable:!0,toggleGroup:"menuReviewView",checked:!1,template:i,description:this.txtFinal,value:"final"},{caption:this.txtOriginalCap,checkable:!0,toggleGroup:"menuReviewView",checked:!1,template:i,description:this.txtOriginal,value:"original"}]})})}(this.appConfig.sharingSettingsUrl&&this.appConfig.sharingSettingsUrl.length||this.appConfig.canRequestSharingSettings)&&!0!==this._readonlyRights&&(this.btnSharing=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-sharing",caption:this.txtSharing})),this.appConfig.isEdit&&!this.appConfig.isOffline&&this.appConfig.canCoAuthoring&&this.appConfig.canChangeCoAuthoring&&(this.btnCoAuthMode=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-coedit",caption:this.txtCoAuthMode,menu:!0})),this.btnsSpelling=[],this.btnsDocLang=[],this.appConfig.canUseHistory&&!this.appConfig.isDisconnected&&(this.btnHistory=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-history",caption:this.txtHistory})),this.appConfig.canCoAuthoring&&this.appConfig.canChat&&(this.btnChat=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-chat",caption:this.txtChat,enableToggle:!0})),this.appConfig.canCoAuthoring&&this.appConfig.canComments&&(this.btnCommentRemove=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",caption:this.txtCommentRemove,split:!0,iconCls:"toolbar__icon btn-rem-comment"}),this.btnCommentResolve=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",caption:this.txtCommentResolve,split:!0,iconCls:"toolbar__icon btn-resolve-all"})),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return this.boxSdk=$("#editor_sdk"),t&&t.html(this.getPanel()),this},onAppReady:function(e){var i=this;new Promise(function(t,e){t()}).then(function(){var n=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div><%= caption %></div><% if (options.description !== null) { %><label style="display: block;color: #a5a5a5;cursor: pointer;white-space: normal;"><%= options.description %></label><% } %></a>');if(e.canReview){var o=Common.Utils.InternalSettings.get(i.appPrefix+"track-changes");!e.isReviewOnly&&i.btnTurnOn.setMenu(new Common.UI.Menu({items:[{caption:i.txtOn,value:0,checkable:!0,checked:0==o,toggleGroup:"menuTurnReviewTlb"},{caption:i.txtOff,value:1,checkable:!0,checked:1==o,toggleGroup:"menuTurnReviewTlb"},{caption:i.txtOnGlobal,value:2,checkable:!0,checked:2==o,toggleGroup:"menuTurnReviewTlb"},{caption:i.txtOffGlobal,value:3,checkable:!0,checked:3==o,toggleGroup:"menuTurnReviewTlb"}]})),i.btnTurnOn.updateHint(i.tipReview),i.appConfig.canUseReviewPermissions||(i.btnAccept.setMenu(new Common.UI.Menu({items:[{caption:i.txtAcceptCurrent,value:"current"},{caption:i.txtAcceptAll,value:"all"}]})),i.btnReject.setMenu(new Common.UI.Menu({items:[{caption:i.txtRejectCurrent,value:"current"},{caption:i.txtRejectAll,value:"all"}]}))),i.btnAccept.updateHint([i.tipAcceptCurrent,i.txtAcceptChanges]),i.btnReject.updateHint([i.tipRejectCurrent,i.txtRejectChanges]),e.canFeatureComparison&&(i.btnCompare.setMenu(new Common.UI.Menu({items:[{caption:i.mniFromFile,value:"file"},{caption:i.mniFromUrl,value:"url"},{caption:i.mniFromStorage,value:"storage"}]})),i.btnCompare.menu.items[2].setVisible(i.appConfig.canRequestCompareFile||i.appConfig.fileChoiceUrl&&i.appConfig.fileChoiceUrl.indexOf("{documentType}")>-1),i.btnCompare.updateHint(i.tipCompare)),i.btnAccept.setDisabled(e.isReviewOnly),i.btnReject.setDisabled(e.isReviewOnly)}if(i.appConfig.canViewReview&&(i.btnPrev.updateHint(i.hintPrev),i.btnNext.updateHint(i.hintNext),i.btnReviewView&&i.btnReviewView.updateHint(i.tipReviewView)),i.btnSharing&&i.btnSharing.updateHint(i.tipSharing),i.btnHistory&&i.btnHistory.updateHint(i.tipHistory),i.btnChat&&i.btnChat.updateHint(i.txtChat+Common.Utils.String.platformKey("Alt+Q")),i.btnCoAuthMode&&(i.btnCoAuthMode.setMenu(new Common.UI.Menu({cls:"ppm-toolbar",style:"max-width: 220px;",items:[{caption:i.strFast,checkable:!0,toggleGroup:"menuCoauthMode",checked:!0,template:n,description:i.strFastDesc,value:1},{caption:i.strStrict,checkable:!0,toggleGroup:"menuCoauthMode",checked:!1,template:n,description:i.strStrictDesc,value:0}]})),i.btnCoAuthMode.updateHint(i.tipCoAuthMode),i.turnCoAuthMode(Common.Utils.InternalSettings.get(i.appPrefix+"settings-coauthmode"))),i.btnCommentRemove){var s=[{caption:e.canDeleteComments?i.txtCommentRemCurrent:i.txtCommentRemMyCurrent,value:"current"},{caption:i.txtCommentRemMy,value:"my"}];e.canDeleteComments&&s.push({caption:i.txtCommentRemAll,value:"all"}),i.btnCommentRemove.setMenu(new Common.UI.Menu({items:s})),i.btnCommentRemove.updateHint([i.tipCommentRemCurrent,i.tipCommentRem])}if(i.btnCommentResolve){var s=[{caption:e.canEditComments?i.txtCommentResolveCurrent:i.txtCommentResolveMyCurrent,value:"current"},{caption:i.txtCommentResolveMy,value:"my"}];e.canEditComments&&s.push({caption:i.txtCommentResolveAll,value:"all"}),i.btnCommentResolve.setMenu(new Common.UI.Menu({items:s})),i.btnCommentResolve.updateHint([i.tipCommentResolveCurrent,i.tipCommentResolve])}var a,r=i.btnSharing||i.btnCoAuthMode?".separator.sharing":i.$el.find(".separator.sharing"),l=e.canComments&&e.canCoAuthoring?".separator.comments":i.$el.find(".separator.comments"),c=e.canReview||e.canViewReview?".separator.review":i.$el.find(".separator.review"),d=e.canReview&&e.canFeatureComparison?".separator.compare":i.$el.find(".separator.compare"),h=i.btnChat?".separator.chat":i.$el.find(".separator.chat");"object"==typeof r?r.hide().prev(".group").hide():a=r,"object"==typeof l?l.hide().prev(".group").hide():a=l,"object"==typeof c?c.hide().prevUntil(".separator.comments").hide():a=c,"object"==typeof d?d.hide().prev(".group").hide():a=d,"object"==typeof h?h.hide().prev(".group").hide():a=h,!i.btnHistory&&a&&i.$el.find(a).hide(),Common.NotificationCenter.trigger("tab:visible","review",e.isEdit||e.canViewReview||e.canCoAuthoring&&e.canComments),t.call(i)})},getPanel:function(){return this.$el=$(_.template('<section id="review-changes-panel" class="panel" data-tab="review"><div class="group no-group-mask review"><span id="slot-btn-sharing" class="btn-slot text x-huge"></span><span id="slot-btn-coauthmode" class="btn-slot text x-huge"></span></div><div class="separator long sharing"></div><div class="group"><span class="btn-slot text x-huge slot-comment"></span><span class="btn-slot text x-huge" id="slot-comment-remove"></span><span class="btn-slot text x-huge" id="slot-comment-resolve"></span></div><div class="separator long comments"></div><div class="group"><span id="btn-review-on" class="btn-slot text x-huge"></span></div><div class="group no-group-mask review" style="padding-left: 0;"><span id="btn-review-view" class="btn-slot text x-huge"></span></div><div class="group move-changes" style="padding-left: 0;"><span id="btn-change-prev" class="btn-slot text x-huge"></span><span id="btn-change-next" class="btn-slot text x-huge"></span><span id="btn-change-accept" class="btn-slot text x-huge"></span><span id="btn-change-reject" class="btn-slot text x-huge"></span></div><div class="separator long review"></div><div class="group"><span id="btn-compare" class="btn-slot text x-huge"></span></div><div class="separator long compare"></div><div class="group no-group-mask review form-view"><span id="slot-btn-chat" class="btn-slot text x-huge"></span></div><div class="separator long chat"></div><div class="group no-group-mask review form-view"><span id="slot-btn-history" class="btn-slot text x-huge"></span></div></section>')({})),this.appConfig.canReview&&(this.btnAccept.render(this.$el.find("#btn-change-accept")),this.btnReject.render(this.$el.find("#btn-change-reject")),this.appConfig.canFeatureComparison&&this.btnCompare.render(this.$el.find("#btn-compare")),this.btnTurnOn.render(this.$el.find("#btn-review-on"))),this.btnPrev&&this.btnPrev.render(this.$el.find("#btn-change-prev")),this.btnNext&&this.btnNext.render(this.$el.find("#btn-change-next")),this.btnReviewView&&this.btnReviewView.render(this.$el.find("#btn-review-view")),this.btnSharing&&this.btnSharing.render(this.$el.find("#slot-btn-sharing")),this.btnCoAuthMode&&this.btnCoAuthMode.render(this.$el.find("#slot-btn-coauthmode")),this.btnHistory&&this.btnHistory.render(this.$el.find("#slot-btn-history")),this.btnChat&&this.btnChat.render(this.$el.find("#slot-btn-chat")),this.btnCommentRemove&&this.btnCommentRemove.render(this.$el.find("#slot-comment-remove")),this.btnCommentResolve&&this.btnCommentResolve.render(this.$el.find("#slot-comment-resolve")),this.$el},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButton:function(t,e){if("turn"==t&&"statusbar"==e){var i=new Common.UI.Button({cls:"btn-toolbar",iconCls:"toolbar__icon btn-ic-review",hintAnchor:"top",hint:this.tipReview,split:!this.appConfig.isReviewOnly,enableToggle:!0,menu:!this.appConfig.isReviewOnly&&new Common.UI.Menu({menuAlign:"bl-tl",style:"margin-top:-5px;",items:[{caption:this.txtOn,value:0,checkable:!0,
toggleGroup:"menuTurnReviewStb"},{caption:this.txtOff,value:1,checkable:!0,toggleGroup:"menuTurnReviewStb"},{caption:this.txtOnGlobal,value:2,checkable:!0,toggleGroup:"menuTurnReviewStb"},{caption:this.txtOffGlobal,value:3,checkable:!0,toggleGroup:"menuTurnReviewStb"}]})});return this.btnsTurnReview.push(i),i}return"spelling"==t?(i=new Common.UI.Button({cls:"btn-toolbar",iconCls:"toolbar__icon btn-ic-docspell",hintAnchor:"top",hint:this.tipSetSpelling,enableToggle:!0}),this.btnsSpelling.push(i),i):"doclang"==t&&"statusbar"==e?(i=new Common.UI.Button({cls:"btn-toolbar",iconCls:"toolbar__icon btn-ic-doclang",hintAnchor:"top",hint:this.tipSetDocLang,disabled:!0}),this.btnsDocLang.push(i),i):void 0},getUserName:function(t){return Common.Utils.String.htmlEncode(AscCommon.UserInfoParser.getParsedName(t))},turnChanges:function(t,e){this.btnsTurnReview.forEach(function(i){i&&i.pressed!=t&&i.toggle(t,!0),i.menu&&(i.menu.items[0].setChecked(t&&!e,!0),i.menu.items[1].setChecked(!t&&!e,!0),i.menu.items[2].setChecked(t&&!!e,!0),i.menu.items[3].setChecked(!t&&!!e,!0))},this)},markChanges:function(t){this.btnsTurnReview.forEach(function(e){if(e){$(".icon",e.cmpEl)[t?"addClass":"removeClass"]("btn-ic-changes")}},this)},turnSpelling:function(t){this.btnsSpelling.forEach(function(e){e&&e.pressed!=t&&e.toggle(t,!0)},this)},turnCoAuthMode:function(t){this.btnCoAuthMode&&(this.btnCoAuthMode.menu.items[0].setChecked(t,!0),this.btnCoAuthMode.menu.items[1].setChecked(!t,!0))},turnChat:function(t){this.btnChat&&this.btnChat.toggle(t,!0)},turnDisplayMode:function(t){this.btnReviewView&&(this.btnReviewView.menu.items[0].setChecked("markup"==t,!0),this.btnReviewView.menu.items[1].setChecked("simple"==t,!0),this.btnReviewView.menu.items[2].setChecked("final"==t,!0),this.btnReviewView.menu.items[3].setChecked("original"==t,!0))},SetDisabled:function(t,e){this.btnsSpelling&&this.btnsSpelling.forEach(function(e){e&&e.setDisabled(t)},this),this.btnsDocLang&&this.btnsDocLang.forEach(function(i){i&&i.setDisabled(t||e&&e.length<1)},this),this.btnsTurnReview&&this.btnsTurnReview.forEach(function(e){e&&e.setDisabled(t)},this),this.btnCommentRemove&&this.btnCommentRemove.setDisabled(t||!Common.Utils.InternalSettings.get(this.appPrefix+"settings-livecomment")),this.btnCommentResolve&&this.btnCommentResolve.setDisabled(t||!Common.Utils.InternalSettings.get(this.appPrefix+"settings-livecomment"))},onLostEditRights:function(){this._readonlyRights=!0,this.rendered&&this.btnSharing&&this.btnSharing.setDisabled(!0)},txtAccept:"Accept",txtAcceptCurrent:"Accept current Changes",txtAcceptAll:"Accept all Changes",txtReject:"Reject",txtRejectCurrent:"Reject current Changes",txtRejectAll:"Reject all Changes",hintNext:"To Next Change",hintPrev:"To Previous Change",txtPrev:"Previous",txtNext:"Next",txtTurnon:"Turn On",txtSpelling:"Spell checking",txtDocLang:"Language",tipSetDocLang:"Set Document Language",tipSetSpelling:"Spell checking",tipReview:"Review",txtAcceptChanges:"Accept Changes",txtRejectChanges:"Reject Changes",txtView:"Display Mode",txtMarkup:"Text with changes (Editing)",txtFinal:"All changes like accept (Preview)",txtOriginal:"Text without changes (Preview)",tipReviewView:"Select the way you want the changes to be displayed",tipAcceptCurrent:"Accept current changes",tipRejectCurrent:"Reject current changes",txtSharing:"Sharing",tipSharing:"Manage document access rights",txtCoAuthMode:"Co-editing Mode",tipCoAuthMode:"Set co-editing mode",strFast:"Fast",strStrict:"Strict",txtHistory:"Version History",tipHistory:"Show version history",txtChat:"Chat",txtMarkupCap:"Markup",txtFinalCap:"Final",txtOriginalCap:"Original",strFastDesc:"Real-time co-editing. All changes are saved automatically.",strStrictDesc:"Use the 'Save' button to sync the changes you and others make.",txtCompare:"Compare",tipCompare:"Compare current document with another one",mniFromFile:"Document from File",mniFromUrl:"Document from URL",mniFromStorage:"Document from Storage",mniSettings:"Comparison Settings",txtCommentRemove:"Remove",tipCommentRemCurrent:"Remove current comments",tipCommentRem:"Remove comments",txtCommentRemCurrent:"Remove Current Comments",txtCommentRemMyCurrent:"Remove My Current Comments",txtCommentRemMy:"Remove My Comments",txtCommentRemAll:"Remove All Comments",txtCommentResolve:"Resolve",tipCommentResolveCurrent:"Resolve current comments",tipCommentResolve:"Resolve comments",txtCommentResolveCurrent:"Resolve Current Comments",txtCommentResolveMyCurrent:"Resolve My Current Comments",txtCommentResolveMy:"Resolve My Comments",txtCommentResolveAll:"Resolve All Comments",txtOnGlobal:"ON for me and everyone",txtOffGlobal:"OFF for me and everyone",txtOn:"ON for me",txtOff:"OFF for me",textWarnTrackChangesTitle:"Enable Track Changes for everyone?",textWarnTrackChanges:"Track Changes will be switched ON for all users with full access. The next time anyone opens the doc, Track Changes will remain enabled.",textEnable:"Enable",txtMarkupSimpleCap:"Simple Markup",txtMarkupSimple:"All changes (Editing)<br>Turn off balloons"}}(),Common.Views.ReviewChanges||{})),Common.Views.ReviewChangesDialog=Common.UI.Window.extend(_.extend({options:{width:330,height:90,title:"Review Changes",modal:!1,cls:"review-changes modal-dlg",alias:"Common.Views.ReviewChangesDialog"},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box">','<div class="input-row">','<div id="id-review-button-prev" style=""></div>','<div id="id-review-button-next" style=""></div>','<div id="id-review-button-accept" style=""></div>','<div id="id-review-button-reject" style="margin-right: 0;"></div>',"</div>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.popoverChanges=this.options.popoverChanges,this.mode=this.options.mode,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.btnPrev=new Common.UI.Button({cls:"dlg-btn iconic",iconCls:"img-commonctrl prev",hint:this.txtPrev,hintAnchor:"top"}),this.btnPrev.render(this.$window.find("#id-review-button-prev")),this.btnNext=new Common.UI.Button({cls:" dlg-btn iconic",iconCls:"img-commonctrl next",hint:this.txtNext,hintAnchor:"top"}),this.btnNext.render(this.$window.find("#id-review-button-next")),this.btnAccept=new Common.UI.Button({cls:"btn-toolbar",caption:this.txtAccept,split:!0,disabled:this.mode.isReviewOnly,menu:!this.mode.canUseReviewPermissions&&new Common.UI.Menu({items:[this.mnuAcceptCurrent=new Common.UI.MenuItem({caption:this.txtAcceptCurrent,value:"current"}),this.mnuAcceptAll=new Common.UI.MenuItem({caption:this.txtAcceptAll,value:"all"})]})}),this.btnAccept.render(this.$window.find("#id-review-button-accept")),this.btnReject=new Common.UI.Button({cls:"btn-toolbar",caption:this.txtReject,split:!0,disabled:this.mode.isReviewOnly,menu:!this.mode.canUseReviewPermissions&&new Common.UI.Menu({items:[this.mnuRejectCurrent=new Common.UI.MenuItem({caption:this.txtRejectCurrent,value:"current"}),this.mnuRejectAll=new Common.UI.MenuItem({caption:this.txtRejectAll,value:"all"})]})}),this.btnReject.render(this.$window.find("#id-review-button-reject"));var t=this;return this.btnPrev.on("click",function(e){t.fireEvent("reviewchange:preview",[t.btnPrev,"prev"])}),this.btnNext.on("click",function(e){t.fireEvent("reviewchange:preview",[t.btnNext,"next"])}),this.btnAccept.on("click",function(e){t.fireEvent("reviewchange:accept",[t.btnAccept,"current"])}),this.btnAccept.menu&&this.btnAccept.menu.on("item:click",function(e,i,n){t.fireEvent("reviewchange:accept",[e,i])}),this.btnReject.on("click",function(e){t.fireEvent("reviewchange:reject",[t.btnReject,"current"])}),this.btnReject.menu&&this.btnReject.menu.on("item:click",function(e,i,n){t.fireEvent("reviewchange:reject",[e,i])}),this},textTitle:"Review Changes",txtPrev:"To previous change",txtNext:"To next change",txtAccept:"Accept",txtAcceptCurrent:"Accept Current Change",txtAcceptAll:"Accept All Changes",txtReject:"Reject",txtRejectCurrent:"Reject Current Change",txtRejectAll:"Reject All Changes"},Common.Views.ReviewChangesDialog||{}))}),void 0===Common)var Common={};if(define("common/main/lib/view/LanguageDialog",["common/main/lib/component/Window"],function(){"use strict";Common.Views.LanguageDialog=Common.UI.Window.extend(_.extend({options:{header:!1,width:350,cls:"modal-dlg",buttons:["ok","cancel"]},template:'<div class="box"><div class="input-row"><label><%= label %></label></div><div class="input-row" id="id-document-language"></div></div>',initialize:function(t){_.extend(this.options,t||{},{label:this.labelSelect}),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this.getChild();t.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.cmbLanguage=new Common.UI.ComboBox({el:t.find("#id-document-language"),cls:"input-group-nr",menuStyle:"min-width: 318px; max-height: 285px;",editable:!1,template:_.template(['<span class="input-group combobox <%= cls %> combo-langs" id="<%= id %>" style="<%= style %>">','<input type="text" class="form-control">','<span class="icon input-icon spellcheck-lang toolbar__icon btn-ic-docspell"></span>','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret" />',"</button>",'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>">','<a tabindex="-1" type="menuitem" style="padding-left: 28px !important;" langval="<%= item.value %>">','<i class="icon <% if (item.spellcheck) { %> toolbar__icon btn-ic-docspell spellcheck-lang <% } %>"></i>',"<%= scope.getDisplayValue(item) %>","</a>","</li>","<% }); %>","</ul>","</span>"].join("")),data:this.options.languages,takeFocusOnClose:!0,search:!0,scrollAlwaysVisible:!0}),this.cmbLanguage.scroller&&this.cmbLanguage.scroller.update({alwaysVisibleY:!0}),this.cmbLanguage.on("selected",_.bind(this.onLangSelect,this));var e=Common.util.LanguageInfo.getLocalLanguageName(this.options.current);this.cmbLanguage.setValue(e[0],e[1]),this.onLangSelect(this.cmbLanguage,this.cmbLanguage.getSelectedRecord());var i=this;setTimeout(function(){i.cmbLanguage.focus()},100)},close:function(t){this.getChild().find(".combobox.open").length||Common.UI.Window.prototype.close.call(this,arguments)},onBtnClick:function(t){this.options.handler&&this.options.handler.call(this,t.currentTarget.attributes.result.value,this.cmbLanguage.getValue()),this.close()},onLangSelect:function(t,e,i){t.$el.find(".input-icon").toggleClass("spellcheck-lang",e&&e.spellcheck),t._input.css("padding-left",e&&e.spellcheck?25:3)},onPrimary:function(){return this.options.handler&&this.options.handler.call(this,"ok",this.cmbLanguage.getValue()),this.close(),!1},labelSelect:"Select document language"},Common.Views.LanguageDialog||{}))}),void 0===Common)var Common={};if(Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/ReviewChanges",["core","common/main/lib/model/ReviewChange","common/main/lib/collection/ReviewChanges","common/main/lib/view/ReviewChanges","common/main/lib/view/ReviewPopover","common/main/lib/view/LanguageDialog","common/main/lib/view/OptionsDialog"],function(){"use strict";Common.Controllers.ReviewChanges=Backbone.Controller.extend(_.extend({models:[],collections:["Common.Collections.ReviewChanges"],views:["Common.Views.ReviewChanges","Common.Views.ReviewPopover"],sdkViewName:"#id_main",initialize:function(){this.addListeners({FileMenu:{"settings:apply":this.applySettings.bind(this)},LeftMenu:{"comments:show":_.bind(this.commentsShowHide,this,"show"),"comments:hide":_.bind(this.commentsShowHide,this,"hide")},"Common.Views.ReviewChanges":{"reviewchange:accept":_.bind(this.onAcceptClick,this),"reviewchange:reject":_.bind(this.onRejectClick,this),"reviewchange:delete":_.bind(this.onDeleteClick,this),"reviewchange:preview":_.bind(this.onBtnPreviewClick,this),"reviewchange:view":_.bind(this.onReviewViewClick,this),"reviewchange:compare":_.bind(this.onCompareClick,this),"lang:document":_.bind(this.onDocLanguage,this),"collaboration:coauthmode":_.bind(this.onCoAuthMode,this)},"Common.Views.ReviewChangesDialog":{"reviewchange:accept":_.bind(this.onAcceptClick,this),"reviewchange:reject":_.bind(this.onRejectClick,this),"reviewchange:preview":_.bind(this.onBtnPreviewClick,this)},"Common.Views.ReviewPopover":{"reviewchange:accept":_.bind(this.onAcceptClick,this),"reviewchange:reject":_.bind(this.onRejectClick,this),"reviewchange:delete":_.bind(this.onDeleteClick,this),"reviewchange:goto":_.bind(this.onGotoClick,this)}})},onLaunch:function(){this.collection=this.getApplication().getCollection("Common.Collections.ReviewChanges"),this.userCollection=this.getApplication().getCollection("Common.Collections.Users"),this._state={posx:-1e3,posy:-1e3,popoverVisible:!1,previewMode:!1,compareSettings:null},Common.NotificationCenter.on("reviewchanges:turn",this.onTurnPreview.bind(this)),Common.NotificationCenter.on("spelling:turn",this.onTurnSpelling.bind(this)),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("collaboration:sharing",this.changeAccessRights.bind(this)),Common.NotificationCenter.on("collaboration:sharingdeny",this.onLostEditRights.bind(this)),this.userCollection.on("reset",_.bind(this.onUpdateUsers,this)),this.userCollection.on("add",_.bind(this.onUpdateUsers,this))},setConfig:function(t,e){return this.setApi(e),t&&(this.currentUserId=t.config.user.id,this.sdkViewName=t.sdkviewname||this.sdkViewName),this},setApi:function(t){t&&(this.api=t,(this.appConfig.canReview||this.appConfig.canViewReview)&&(this.api.asc_registerCallback("asc_onShowRevisionsChange",_.bind(this.onApiShowChange,this)),this.api.asc_registerCallback("asc_onUpdateRevisionsChangesPosition",_.bind(this.onApiUpdateChangePosition,this)),this.api.asc_registerCallback("asc_onAuthParticipantsChanged",_.bind(this.onAuthParticipantsChanged,this)),this.api.asc_registerCallback("asc_onParticipantsChanged",_.bind(this.onAuthParticipantsChanged,this)),this.api.asc_registerCallback("asc_onChangeDisplayModeInReview",_.bind(this.onChangeDisplayModeInReview,this))),this.appConfig.canReview&&this.api.asc_registerCallback("asc_onOnTrackRevisionsChange",_.bind(this.onApiTrackRevisionsChange,this)),this.api.asc_registerCallback("asc_onAcceptChangesBeforeCompare",_.bind(this.onAcceptChangesBeforeCompare,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.Gateway.on("setrevisedfile",_.bind(this.setRevisedFile,this)))},setMode:function(t){return this.appConfig=t,this.popoverChanges=new Common.Collections.ReviewChanges,this.view=this.createView("Common.Views.ReviewChanges",{mode:t}),(this.appConfig.sharingSettingsUrl&&this.appConfig.sharingSettingsUrl.length||this.appConfig.canRequestSharingSettings)&&(Common.Gateway.on("showsharingsettings",_.bind(this.changeAccessRights,this)),Common.Gateway.on("setsharingsettings",_.bind(this.setSharingSettings,this))),this},loadDocument:function(t){this.document=t.doc},SetDisabled:function(t){this.dlgChanges&&this.dlgChanges.close(),this.view&&this.view.SetDisabled(t,this.langs),this.setPreviewMode(t)},setPreviewMode:function(t){if(this.viewmode!==t){this.viewmode=t,t&&(this.prevcanReview=this.appConfig.canReview),this.appConfig.canReview=!t&&this.prevcanReview;var e=this;this.popoverChanges&&this.popoverChanges.each(function(t){t.set("hint",!e.appConfig.canReview)})}},onApiShowChange:function(t){if(this.getPopover())if(!this.appConfig.reviewHoverMode&&t&&t.length>0){var e=this.readSDKChange(t),i=t[0].get_X(),n=t[0].get_Y(),o=Math.abs(this._state.posx-i)>.001||Math.abs(this._state.posy-n)>.001||t.length!==this._state.changes_length,s=null!==t[0].get_LockUserId(),a=this.getUserName(t[0].get_LockUserId()),r=e[0].get("editable");this.getPopover().hideTips(),this.popoverChanges.reset(e),o&&(this.getPopover().isVisible()&&this.getPopover().hide(),this.getPopover().setLeftTop(i,n)),this.getPopover().showReview(o,s,a);var l=s||!r;this.appConfig.canReview&&!this.appConfig.isReviewOnly&&this._state.lock!==l&&(this.view.btnAccept.setDisabled(l),this.view.btnReject.setDisabled(l),this.dlgChanges&&(this.dlgChanges.btnAccept.setDisabled(l),this.dlgChanges.btnReject.setDisabled(l)),this._state.lock=l),this._state.posx=i,this._state.posy=n,this._state.changes_length=t.length,this._state.popoverVisible=!0}else this._state.popoverVisible&&(this._state.posx=this._state.posy=-1e3,this._state.changes_length=0,this._state.popoverVisible=!1,this.getPopover().hideTips(),this.popoverChanges.reset(),this.getPopover().hideReview())},onApiUpdateChangePosition:function(t,e){this.getPopover()&&(e<0||this.getPopover().sdkBounds.height<e?this.getPopover().hide():this.popoverChanges.length>0&&(this.getPopover().isVisible()||this.getPopover().show(!1),this.getPopover().setLeftTop(t,e)))},findChange:function(t,e){return _.isUndefined(t)?this.collection.findWhere({id:e}):this.collection.findWhere({uid:t})},getPopover:function(){return(this.appConfig.canReview||this.appConfig.canViewReview)&&_.isUndefined(this.popover)&&(this.popover=Common.Views.ReviewPopover.prototype.getPopover({reviewStore:this.popoverChanges,renderTo:this.sdkViewName,api:this.api}),this.popover.setReviewStore(this.popoverChanges)),this.popover},readSDKChange:function(t){var e=this,i=[];return _.each(t,function(t){var n="",o="",s=t.get_Value(),a=t.get_MoveType();switch(t.get_Type()){case Asc.c_oAscRevisionsChangeType.TextAdd:n=a==Asc.c_oAscRevisionsMove.NoMove?e.textInserted:e.textParaMoveTo,"object"==typeof s?_.each(s,function(t){if("string"==typeof t)n+=" "+Common.Utils.String.htmlEncode(t);else switch(t){case 0:n+=" &lt;"+e.textImage+"&gt;";break;case 1:n+=" &lt;"+e.textShape+"&gt;";break;case 2:n+=" &lt;"+e.textChart+"&gt;";break;case 3:n+=" &lt;"+e.textEquation+"&gt;"}}):"string"==typeof s&&(n+=" "+Common.Utils.String.htmlEncode(s));break;case Asc.c_oAscRevisionsChangeType.TextRem:n=a==Asc.c_oAscRevisionsMove.NoMove?e.textDeleted:t.is_MovedDown()?e.textParaMoveFromDown:e.textParaMoveFromUp,"object"==typeof s?_.each(s,function(t){if("string"==typeof t)n+=" "+Common.Utils.String.htmlEncode(t);else switch(t){case 0:n+=" &lt;"+e.textImage+"&gt;";break;case 1:n+=" &lt;"+e.textShape+"&gt;";break;case 2:n+=" &lt;"+e.textChart+"&gt;";break;case 3:n+=" &lt;"+e.textEquation+"&gt;"}}):"string"==typeof s&&(n+=" "+Common.Utils.String.htmlEncode(s));break;case Asc.c_oAscRevisionsChangeType.ParaAdd:n=e.textParaInserted;break;case Asc.c_oAscRevisionsChangeType.ParaRem:n=e.textParaDeleted;break;case Asc.c_oAscRevisionsChangeType.TextPr:n="<b>"+e.textFormatted,void 0!==s.Get_Bold()&&(o+=(s.Get_Bold()?"":e.textNot)+e.textBold+", "),void 0!==s.Get_Italic()&&(o+=(s.Get_Italic()?"":e.textNot)+e.textItalic+", "),void 0!==s.Get_Underline()&&(o+=(s.Get_Underline()?"":e.textNot)+e.textUnderline+", "),void 0!==s.Get_Strikeout()&&(o+=(s.Get_Strikeout()?"":e.textNot)+e.textStrikeout+", "),void 0!==s.Get_DStrikeout()&&(o+=(s.Get_DStrikeout()?"":e.textNot)+e.textDStrikeout+", "),void 0!==s.Get_Caps()&&(o+=(s.Get_Caps()?"":e.textNot)+e.textCaps+", "),void 0!==s.Get_SmallCaps()&&(o+=(s.Get_SmallCaps()?"":e.textNot)+e.textSmallCaps+", "),void 0!==s.Get_VertAlign()&&(o+=(1==s.Get_VertAlign()?e.textSuperScript:2==s.Get_VertAlign()?e.textSubScript:e.textBaseline)+", "),void 0!==s.Get_Color()&&(o+=e.textColor+", "),void 0!==s.Get_Highlight()&&(o+=e.textHighlight+", "),void 0!==s.Get_Shd()&&(o+=e.textShd+", "),void 0!==s.Get_FontFamily()&&(o+=s.Get_FontFamily()+", "),void 0!==s.Get_FontSize()&&(o+=s.Get_FontSize()+", "),void 0!==s.Get_Spacing()&&(o+=e.textSpacing+" "+Common.Utils.Metric.fnRecalcFromMM(s.Get_Spacing()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+", "),void 0!==s.Get_Position()&&(o+=e.textPosition+" "+Common.Utils.Metric.fnRecalcFromMM(s.Get_Position()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+", "),void 0!==s.Get_Lang()&&(o+=Common.util.LanguageInfo.getLocalLanguageName(s.Get_Lang())[1]+", "),_.isEmpty(o)||(n+=": ",o=o.substring(0,o.length-2)),n+="</b>",n+=o;break;case Asc.c_oAscRevisionsChangeType.ParaPr:if(n="<b>"+e.textParaFormatted,s.Get_ContextualSpacing()&&(o+=(s.Get_ContextualSpacing()?e.textContextual:e.textNoContextual)+", "),void 0!==s.Get_IndLeft()&&(o+=e.textIndentLeft+" "+Common.Utils.Metric.fnRecalcFromMM(s.Get_IndLeft()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+", "),void 0!==s.Get_IndRight()&&(o+=e.textIndentRight+" "+Common.Utils.Metric.fnRecalcFromMM(s.Get_IndRight()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+", "),void 0!==s.Get_IndFirstLine()&&(o+=e.textFirstLine+" "+Common.Utils.Metric.fnRecalcFromMM(s.Get_IndFirstLine()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+", "),void 0!==s.Get_Jc())switch(s.Get_Jc()){case 0:o+=e.textRight+", ";break;case 1:o+=e.textLeft+", ";break;case 2:o+=e.textCenter+", ";break;case 3:o+=e.textJustify+", "}if(void 0!==s.Get_KeepLines()&&(o+=(s.Get_KeepLines()?e.textKeepLines:e.textNoKeepLines)+", "),s.Get_KeepNext()&&(o+=(s.Get_KeepNext()?e.textKeepNext:e.textNoKeepNext)+", "),s.Get_PageBreakBefore()&&(o+=(s.Get_PageBreakBefore()?e.textBreakBefore:e.textNoBreakBefore)+", "),void 0!==s.Get_SpacingLineRule()&&void 0!==s.Get_SpacingLine()&&(o+=e.textLineSpacing,o+=(s.Get_SpacingLineRule()==c_paragraphLinerule.LINERULE_LEAST?e.textAtLeast:s.Get_SpacingLineRule()==c_paragraphLinerule.LINERULE_AUTO?e.textMultiple:e.textExact)+" ",o+=(s.Get_SpacingLineRule()==c_paragraphLinerule.LINERULE_AUTO?s.Get_SpacingLine():Common.Utils.Metric.fnRecalcFromMM(s.Get_SpacingLine()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName())+", "),s.Get_SpacingBeforeAutoSpacing()?o+=e.textSpacingBefore+" "+e.textAuto+", ":void 0!==s.Get_SpacingBefore()&&(o+=e.textSpacingBefore+" "+Common.Utils.Metric.fnRecalcFromMM(s.Get_SpacingBefore()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+", "),s.Get_SpacingAfterAutoSpacing()?o+=e.textSpacingAfter+" "+e.textAuto+", ":void 0!==s.Get_SpacingAfter()&&(o+=e.textSpacingAfter+" "+Common.Utils.Metric.fnRecalcFromMM(s.Get_SpacingAfter()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+", "),s.Get_WidowControl()&&(o+=(s.Get_WidowControl()?e.textWidow:e.textNoWidow)+", "),void 0!==s.Get_Tabs()&&(o+=e.textTabs+", "),void 0!==s.Get_NumPr()&&(o+=e.textNum+", "),void 0!==s.Get_PStyle()){var r=e.api.asc_GetStyleNameById(s.Get_PStyle());_.isEmpty(r)||(o+=r+", ")}_.isEmpty(o)||(n+=": ",o=o.substring(0,o.length-2)),n+="</b>",n+=o;break;case Asc.c_oAscRevisionsChangeType.TablePr:n=e.textTableChanged;break;case Asc.c_oAscRevisionsChangeType.RowsAdd:n=e.textTableRowsAdd;break;case Asc.c_oAscRevisionsChangeType.RowsRem:n=e.textTableRowsDel}var l=""==t.get_DateTime()?new Date:new Date(t.get_DateTime()),c=e.userCollection.findOriginalUser(t.get_UserId()),d=new Common.Models.ReviewChange({uid:Common.UI.getId(),userid:t.get_UserId(),username:t.get_UserName(),usercolor:c?c.get("color"):null,date:e.dateToLocaleTimeString(l),changetext:n,id:Common.UI.getId(),lock:null!==t.get_LockUserId(),lockuser:e.getUserName(t.get_LockUserId()),type:t.get_Type(),changedata:t,scope:e.view,hint:!e.appConfig.canReview,goto:t.get_MoveType()==Asc.c_oAscRevisionsMove.MoveTo||t.get_MoveType()==Asc.c_oAscRevisionsMove.MoveFrom,editable:e.appConfig.isReviewOnly&&t.get_UserId()==e.currentUserId||!e.appConfig.isReviewOnly&&(!e.appConfig.canUseReviewPermissions||AscCommon.UserInfoParser.canEditReview(t.get_UserName()))});i.push(d)}),i},getUserName:function(t){if(this.userCollection&&null!==t){var e=this.userCollection.findUser(t);if(e)return AscCommon.UserInfoParser.getParsedName(e.get("username"))}return""},dateToLocaleTimeString:function(t){return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()+" "+function(t){var e=t.getHours(),i=t.getMinutes(),n=e>=12?"pm":"am";return e%=12,e=e||12,i=i<10?"0"+i:i,e+":"+i+" "+n}(t)},onBtnPreviewClick:function(t,e){switch(e){case"prev":this.api.asc_GetPrevRevisionsChange();break;case"next":this.api.asc_GetNextRevisionsChange()}Common.NotificationCenter.trigger("edit:complete",this.view)},onAcceptClick:function(t,e,i){this.api&&(e?"all"===e.value?this.api.asc_AcceptAllChanges():this.api.asc_AcceptChanges():this.api.asc_AcceptChanges(t)),Common.NotificationCenter.trigger("edit:complete",this.view)},onRejectClick:function(t,e,i){this.api&&(e?"all"===e.value?this.api.asc_RejectAllChanges():this.api.asc_RejectChanges():this.api.asc_RejectChanges(t)),Common.NotificationCenter.trigger("edit:complete",this.view)},onDeleteClick:function(t){this.api&&this.api.asc_RejectChanges(t),Common.NotificationCenter.trigger("edit:complete",this.view)},onGotoClick:function(t){this.api&&this.api.asc_FollowRevisionMove(t),Common.NotificationCenter.trigger("edit:complete",this.view)},onTurnPreview:function(t,e,i){this.appConfig.isReviewOnly?this.view.turnChanges(!0):this.appConfig.canReview&&(t="off"!=t&&t,e?(this.api.asc_SetLocalTrackRevisions(null),this.api.asc_SetGlobalTrackRevisions(!!t)):this.api.asc_SetLocalTrackRevisions(!!t))},onApiTrackRevisionsChange:function(t,e,i){if(this.appConfig.isReviewOnly)this.view.turnChanges(!0);else if(this.appConfig.canReview){var n=null===t,o=n?e:t;if(Common.Utils.InternalSettings.set(this.view.appPrefix+"track-changes",(o?0:1)+(n?2:0)),this.view.turnChanges(o,n),i&&this.userCollection){var s=this.userCollection.findOriginalUser(i);s&&this.showTips(Common.Utils.String.format(e?this.textOnGlobal:this.textOffGlobal,AscCommon.UserInfoParser.getParsedName(s.get("username"))))}}},onTurnSpelling:function(t){t="on"==t,this.view.turnSpelling(t),Common.localStorage.setItem(this.view.appPrefix+"settings-spellcheck",t?1:0),this.api.asc_setSpellCheck(t),Common.Utils.InternalSettings.set(this.view.appPrefix+"settings-spellcheck",t)},onReviewViewClick:function(t,e,i){this.turnDisplayMode(e.value),this.appConfig.isEdit||this.appConfig.isRestrictedEdit?"markup"!=e.value&&"simple"!=e.value||Common.localStorage.setItem(this.view.appPrefix+"review-mode-editor",e.value):Common.localStorage.setItem(this.view.appPrefix+"review-mode",e.value),Common.NotificationCenter.trigger("edit:complete",this.view)},onCompareClick:function(t){if(this.api){var e=this;if(this._state.compareSettings||(this._state.compareSettings=new AscCommonWord.ComparisonOptions,this._state.compareSettings.putWords(!Common.localStorage.getBool("de-compare-char"))),"file"===t)this.api&&this.api.asc_CompareDocumentFile(this._state.compareSettings),Common.NotificationCenter.trigger("edit:complete",this.view);else if("url"===t)new Common.Views.ImageFromUrlDialog({title:e.textUrl,handler:function(t,i){if("ok"==t){if(e.api){var n=i.replace(/ /g,"");_.isEmpty(n)||e.api.asc_CompareDocumentUrl(n,e._state.compareSettings)}Common.NotificationCenter.trigger("edit:complete",e.view)}}}).show();else if("storage"===t)this.appConfig.canRequestCompareFile?Common.Gateway.requestCompareFile():new Common.Views.SelectFileDlg({fileChoiceUrl:this.appConfig.fileChoiceUrl.replace("{fileExt}","").replace("{documentType}","DocumentsOnly")}).on("selectfile",function(t,i){e.setRevisedFile(i,e._state.compareSettings)}).show();else if("settings"===t){var i=!e._state.compareSettings||e._state.compareSettings.getWords();new Common.Views.OptionsDialog({title:e.textTitleComparison,items:[{caption:e.textChar,value:!1,checked:!1===i},{caption:e.textWord,value:!0,checked:!1!==i}],label:e.textShow,handler:function(t,i){"ok"==i&&(e._state.compareSettings=new AscCommonWord.ComparisonOptions,e._state.compareSettings.putWords(t.getSettings())),Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}).show()}}Common.NotificationCenter.trigger("edit:complete",this.view)},setRevisedFile:function(t){this._state.compareSettings||(this._state.compareSettings=new AscCommonWord.ComparisonOptions,this._state.compareSettings.putWords(!Common.localStorage.getBool("de-compare-char"))),t&&t.url&&this.api.asc_CompareDocumentUrl(t.url,this._state.compareSettings,t.token)},onAcceptChangesBeforeCompare:function(t){Common.UI.warning({width:550,msg:this.textAcceptBeforeCompare,buttons:["yes","no"],primary:"yes",callback:function(e){_.defer(function(){t&&t("yes"==e)}),Common.NotificationCenter.trigger("edit:complete",this.view)}})},turnDisplayMode:function(t){if(this.api){var e=Asc.c_oAscDisplayModeInReview.Edit;switch(t){case"final":e=Asc.c_oAscDisplayModeInReview.Final;break;case"original":e=Asc.c_oAscDisplayModeInReview.Original;break;case"simple":e=Asc.c_oAscDisplayModeInReview.Simple}this.api.asc_SetDisplayModeInReview(e)}this.disableEditing("final"==t||"original"==t),this._state.previewMode="final"==t||"original"==t},onChangeDisplayModeInReview:function(t){this.disableEditing(t===Asc.c_oAscDisplayModeInReview.Final||t===Asc.c_oAscDisplayModeInReview.Original);var e="markup";switch(t){case Asc.c_oAscDisplayModeInReview.Final:e="final";break;case Asc.c_oAscDisplayModeInReview.Original:e="original";break;case Asc.c_oAscDisplayModeInReview.Simple:e="simple"}this.view&&this.view.turnDisplayMode(e),this._state.previewMode=t===Asc.c_oAscDisplayModeInReview.Final||t===Asc.c_oAscDisplayModeInReview.Original},isPreviewChangesMode:function(){return this._state.previewMode},onCoAuthMode:function(t,e,i){if(Common.localStorage.setItem(this.view.appPrefix+"settings-coauthmode",e.value),Common.Utils.InternalSettings.set(this.view.appPrefix+"settings-coauthmode",e.value),this.api){if(this.api.asc_SetFastCollaborative(1==e.value),this.api.SetCollaborativeMarksShowType){var n=Common.localStorage.getItem(e.value?this.view.appPrefix+"settings-showchanges-fast":this.view.appPrefix+"settings-showchanges-strict");null!==n?this.api.SetCollaborativeMarksShowType("all"==n?Asc.c_oAscCollaborativeMarksShowType.All:"none"==n?Asc.c_oAscCollaborativeMarksShowType.None:Asc.c_oAscCollaborativeMarksShowType.LastChanges):this.api.SetCollaborativeMarksShowType(e.value?Asc.c_oAscCollaborativeMarksShowType.None:Asc.c_oAscCollaborativeMarksShowType.LastChanges)}n=Common.localStorage.getItem(this.view.appPrefix+"settings-autosave"),null===n&&this.appConfig.customization&&!1===this.appConfig.customization.autosave&&(n=0),n=e.value||null===n?1:parseInt(n),Common.localStorage.setItem(this.view.appPrefix+"settings-autosave",n),Common.Utils.InternalSettings.set(this.view.appPrefix+"settings-autosave",n),this.api.asc_setAutoSaveGap(n)}Common.NotificationCenter.trigger("edit:complete",this.view),this.view.fireEvent("settings:apply",[this])},disableEditing:function(t){var e=this.getApplication();e.getController("Toolbar").DisableToolbar(t,!1,!0),e.getController("DocumentHolder").getView().SetDisabled(t),this.appConfig.canReview&&(t&&e.getController("RightMenu").getView("RightMenu").clearSelection(),e.getController("RightMenu").SetDisabled(t,!1),e.getController("Statusbar").getView("Statusbar").SetDisabled(t),e.getController("Navigation")&&e.getController("Navigation").SetDisabled(t),e.getController("Common.Controllers.Plugins").getView("Common.Views.Plugins").disableControls(t));var i=e.getController("Common.Controllers.Comments");i&&i.setPreviewMode(t);var n=e.getController("LeftMenu");n.leftMenu.getMenu("file").getButton("protect").setDisabled(t),n.setPreviewMode(t),this.view&&(this.view.$el.find(".no-group-mask.review").css("opacity",1),this.view.btnsDocLang&&this.view.btnsDocLang.forEach(function(e){e&&e.setDisabled(t||!this.langs||this.langs.length<1)},this))},createToolbarPanel:function(){return this.view.getPanel()},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onAppReady:function(t){var e=this
;if(e.view&&Common.localStorage.getBool(e.view.appPrefix+"settings-spellcheck",!(t.customization&&!1===t.customization.spellcheck))&&e.view.turnSpelling(!0),t.canReview)new Promise(function(t){t()}).then(function(){var i="object"==typeof e.appConfig.customization?e.appConfig.customization.trackChanges:void 0;t.isReviewOnly||void 0!==i?e.api.asc_SetLocalTrackRevisions(t.isReviewOnly||!0===i):e.onApiTrackRevisionsChange(e.api.asc_GetLocalTrackRevisions(),e.api.asc_GetGlobalTrackRevisions()),e.api.asc_HaveRevisionsChanges()&&e.view.markChanges(!0);var n=Common.localStorage.getItem(e.view.appPrefix+"review-mode-editor");if(null===n&&(n=e.appConfig.customization&&/^(original|final|markup|simple)$/i.test(e.appConfig.customization.reviewDisplay)?e.appConfig.customization.reviewDisplay.toLocaleLowerCase():"markup"),e.turnDisplayMode(n),e.view.turnDisplayMode(n),"object"==typeof e.appConfig.customization&&1==e.appConfig.customization.showReviewChanges){e.dlgChanges=new Common.Views.ReviewChangesDialog({popoverChanges:e.popoverChanges,mode:e.appConfig});var o=$("#editor_sdk"),s=o.offset();e.dlgChanges.show(Math.max(10,s.left+o.width()-300),Math.max(10,s.top+o.height()-150))}});else if(t.canViewReview&&(t.canViewReview=t.isEdit||e.api.asc_HaveRevisionsChanges(!0),t.canViewReview)){var i=Common.localStorage.getItem(e.view.appPrefix+(t.isEdit||t.isRestrictedEdit?"review-mode-editor":"review-mode"));null===i&&(i=e.appConfig.customization&&/^(original|final|markup|simple)$/i.test(e.appConfig.customization.reviewDisplay)?e.appConfig.customization.reviewDisplay.toLocaleLowerCase():t.isEdit||t.isRestrictedEdit?"markup":"original"),e.turnDisplayMode(i),e.view.turnDisplayMode(i)}e.view&&e.view.btnChat&&e.getApplication().getController("LeftMenu").leftMenu.btnChat.on("toggle",function(t,i){i!==e.view.btnChat.pressed&&e.view.turnChat(i)}),e.view&&(e.view.btnCommentRemove&&e.view.btnCommentRemove.setDisabled(!Common.localStorage.getBool(e.view.appPrefix+"settings-livecomment",!0)),e.view.btnCommentResolve&&e.view.btnCommentResolve.setDisabled(!Common.localStorage.getBool(e.view.appPrefix+"settings-livecomment",!0)));var i=Common.localStorage.getItem(e.view.appPrefix+"settings-review-hover-mode");i=null===i?!(!e.appConfig.customization||!e.appConfig.customization.review)&&!!e.appConfig.customization.review.hoverMode:!!parseInt(i),Common.Utils.InternalSettings.set(e.view.appPrefix+"settings-review-hover-mode",i),e.appConfig.reviewHoverMode=i},showTips:function(t){function e(){var e=t.shift();e&&(i.tooltip.setTitle(e),i.tooltip.show(),i.tipTimeout=setTimeout(function(){i.tooltip.hide()},5e3))}var i=this;t.length&&("object"!=typeof t&&(t=[t]),this.tooltip||(this.tooltip=new Common.UI.Tooltip({owner:this.getApplication().getController("Toolbar").getView(),hideonclick:!0,placement:"bottom",cls:"main-info",offset:30}),this.tooltip.on("tooltip:hide",function(t){t==i.tooltip&&(clearTimeout(i.tipTimeout),setTimeout(e,300))})),e())},applySettings:function(t){this.view&&this.view.turnSpelling(Common.localStorage.getBool(this.view.appPrefix+"settings-spellcheck",!0)),this.view&&this.view.turnCoAuthMode(Common.localStorage.getBool(this.view.appPrefix+"settings-coauthmode",!0))},synchronizeChanges:function(){this.appConfig&&this.appConfig.canReview&&this.view.markChanges(this.api.asc_HaveRevisionsChanges())},setLanguages:function(t){this.langs=t,this.view&&this.view.btnsDocLang&&this.view.btnsDocLang.forEach(function(t){t&&t.setDisabled(this.langs.length<1)},this)},onDocLanguage:function(){var t=this;new Common.Views.LanguageDialog({languages:t.langs,current:t.api.asc_getDefaultLanguage(),handler:function(e,i){if("ok"==e){var n=_.findWhere(t.langs,{value:i});n&&t.api.asc_setDefaultLanguage(n.code)}}}).show()},onLostEditRights:function(){this._readonlyRights=!0,this.view&&this.view.onLostEditRights()},changeAccessRights:function(t,e,i){if(!this._docAccessDlg&&!this._readonlyRights)if(this.appConfig.canRequestSharingSettings)Common.Gateway.requestSharingSettings();else{var n=this;n._docAccessDlg=new Common.Views.DocumentAccessDialog({settingsurl:this.appConfig.sharingSettingsUrl}),n._docAccessDlg.on("accessrights",function(t,e){n.setSharingSettings({sharingSettings:e})}).on("close",function(t){n._docAccessDlg=void 0}),n._docAccessDlg.show()}},setSharingSettings:function(t){t&&(this.document.info.sharingSettings=t.sharingSettings,Common.NotificationCenter.trigger("collaboration:sharingupdate",t.sharingSettings),Common.NotificationCenter.trigger("mentions:clearusers",this))},onCoAuthoringDisconnect:function(){this.SetDisabled(!0)},onUpdateUsers:function(){var t=this.userCollection;this.popoverChanges&&this.popoverChanges.each(function(e){var i=t.findOriginalUser(e.get("userid"));e.set("usercolor",i?i.get("color"):null)})},onAuthParticipantsChanged:function(t){if(this.view&&this.view.btnCompare){var e=0;_.each(t,function(t){t.asc_getView()||e++}),this.view.btnCompare.setDisabled(e>1||this.viewmode)}},commentsShowHide:function(t){if(this.view){var e=Common.Utils.InternalSettings.get(this.view.appPrefix+"settings-livecomment");void 0!==e&&this.view.btnCommentRemove&&this.view.btnCommentRemove.setDisabled("show"!=t&&!e),void 0!==e&&this.view.btnCommentResolve&&this.view.btnCommentResolve.setDisabled("show"!=t&&!e)}},textInserted:"<b>Inserted:</b>",textDeleted:"<b>Deleted:</b>",textParaInserted:"<b>Paragraph Inserted</b> ",textParaDeleted:"<b>Paragraph Deleted</b> ",textFormatted:"Formatted",textParaFormatted:"Paragraph Formatted",textNot:"Not ",textBold:"Bold",textItalic:"Italic",textStrikeout:"Strikeout",textUnderline:"Underline",textColor:"Font color",textBaseline:"Baseline",textSuperScript:"Superscript",textSubScript:"Subscript",textHighlight:"Highlight color",textSpacing:"Spacing",textDStrikeout:"Double strikeout",textCaps:"All caps",textSmallCaps:"Small caps",textPosition:"Position",textFontSize:"Font size",textShd:"Background color",textContextual:"Don't add interval between paragraphs of the same style",textNoContextual:"Add interval between paragraphs of the same style",textIndentLeft:"Indent left",textIndentRight:"Indent right",textFirstLine:"First line",textRight:"Align right",textLeft:"Align left",textCenter:"Align center",textJustify:"Align justify",textBreakBefore:"Page break before",textKeepNext:"Keep with next",textKeepLines:"Keep lines together",textNoBreakBefore:"No page break before",textNoKeepNext:"Don't keep with next",textNoKeepLines:"Don't keep lines together",textLineSpacing:"Line Spacing: ",textMultiple:"multiple",textAtLeast:"at least",textExact:"exactly",textSpacingBefore:"Spacing before",textSpacingAfter:"Spacing after",textAuto:"auto",textWidow:"Widow control",textNoWidow:"No widow control",textTabs:"Change tabs",textNum:"Change numbering",textEquation:"Equation",textImage:"Image",textChart:"Chart",textShape:"Shape",textTableChanged:"<b>Table Settings Changed</b>",textTableRowsAdd:"<b>Table Rows Added</b>",textTableRowsDel:"<b>Table Rows Deleted</b>",textParaMoveTo:"<b>Moved:</b>",textParaMoveFromUp:"<b>Moved Up:</b>",textParaMoveFromDown:"<b>Moved Down:</b>",textUrl:"Paste a document URL",textAcceptBeforeCompare:"In order to compare documents all the tracked changes in them will be considered to have been accepted. Do you want to continue?",textTitleComparison:"Comparison Settings",textShow:"Show changes at",textChar:"Character level",textWord:"Word level",textOnGlobal:"{0} enabled Track Changes for everyone.",textOffGlobal:"{0} disabled Track Changes for everyone.",textOn:"{0} is now using Track Changes.",textOff:"{0} is no longer using Track Changes."},Common.Controllers.ReviewChanges||{}))}),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/Protection",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout","common/main/lib/component/Window"],function(t){"use strict";Common.Views.Protection=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;t.appConfig.isPasswordSupport&&(this.btnsAddPwd.concat(this.btnsChangePwd).forEach(function(e){e.on("click",function(e,i){t.fireEvent("protect:password",[e,"add"])})}),this.btnsDelPwd.forEach(function(e){e.on("click",function(e,i){t.fireEvent("protect:password",[e,"delete"])})}),this.btnPwd.menu.on("item:click",function(e,i,n){t.fireEvent("protect:password",[e,i.value])})),t.appConfig.isSignatureSupport&&(this.btnSignature.menu&&this.btnSignature.menu.on("item:click",function(e,i,n){t.fireEvent("protect:signature",[i.value,!1])}),this.btnsInvisibleSignature.forEach(function(e){e.on("click",function(e,i){t.fireEvent("protect:signature",["invisible"])})})),t._isSetEvents=!0}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.appConfig=t.mode,this.btnsInvisibleSignature=[],this.btnsAddPwd=[],this.btnsDelPwd=[],this.btnsChangePwd=[],this._state={disabled:!1,hasPassword:!1,disabledPassword:!1,invisibleSignDisabled:!1};var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:"",this.appConfig.isPasswordSupport&&(this.btnAddPwd=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-protect",caption:this.txtEncrypt}),this.btnsAddPwd.push(this.btnAddPwd),this.btnPwd=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-protect",caption:this.txtEncrypt,menu:!0,visible:!1})),this.appConfig.isSignatureSupport&&(this.btnSignature=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-signature",caption:this.txtSignature,menu:"pe-"!==this.appPrefix}),this.btnSignature.menu||this.btnsInvisibleSignature.push(this.btnSignature)),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return this.boxSdk=$("#editor_sdk"),t&&t.html(this.getPanel()),this},onAppReady:function(e){var i=this;new Promise(function(t,e){t()}).then(function(){e.canProtect&&(e.isPasswordSupport&&(i.btnAddPwd.updateHint(i.hintAddPwd),i.btnPwd.updateHint(i.hintPwd),i.btnPwd.setMenu(new Common.UI.Menu({items:[{caption:i.txtChangePwd,value:"add"},{caption:i.txtDeletePwd,value:"delete"}]}))),i.btnSignature&&(i.btnSignature.updateHint(i.btnSignature.menu?i.hintSignature:i.txtInvisibleSignature),i.btnSignature.menu&&i.btnSignature.setMenu(new Common.UI.Menu({items:[{caption:i.txtInvisibleSignature,value:"invisible"},{caption:i.txtSignatureLine,value:"visible",disabled:i._state.disabled}]}))),Common.NotificationCenter.trigger("tab:visible","protect",!0)),t.call(i)})},getPanel:function(){return this.$el=$(_.template('<section id="protection-panel" class="panel" data-tab="protect"><div class="group"><span id="slot-btn-add-password" class="btn-slot text x-huge"></span><span id="slot-btn-change-password" class="btn-slot text x-huge"></span><span id="slot-btn-signature" class="btn-slot text x-huge"></span></div></section>')({})),this.appConfig.canProtect&&(this.btnAddPwd&&this.btnAddPwd.render(this.$el.find("#slot-btn-add-password")),this.btnPwd&&this.btnPwd.render(this.$el.find("#slot-btn-change-password")),this.btnSignature&&this.btnSignature.render(this.$el.find("#slot-btn-signature"))),this.$el},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButton:function(t,e){var i=this;if("signature"==t){var n=new Common.UI.Button({cls:"btn-text-default",style:"width: 100%;",caption:this.txtInvisibleSignature,disabled:this._state.invisibleSignDisabled});return this.btnsInvisibleSignature.push(n),this._isSetEvents&&n.on("click",function(t,e){i.fireEvent("protect:signature",["invisible"])}),n}if("add-password"==t){var n=new Common.UI.Button({cls:"btn-text-default",style:"width: 100%;",caption:this.txtAddPwd,disabled:this._state.disabled||this._state.disabledPassword,visible:!this._state.hasPassword});return this.btnsAddPwd.push(n),this._isSetEvents&&n.on("click",function(t,e){i.fireEvent("protect:password",[t,"add"])}),n}if("del-password"==t){var n=new Common.UI.Button({cls:"btn-text-default",style:"width: 100%;",caption:this.txtDeletePwd,disabled:this._state.disabled||this._state.disabledPassword,visible:this._state.hasPassword});return this.btnsDelPwd.push(n),this._isSetEvents&&n.on("click",function(t,e){i.fireEvent("protect:password",[t,"delete"])}),n}if("change-password"==t){var n=new Common.UI.Button({cls:"btn-text-default",style:"width: 100%;",caption:this.txtChangePwd,disabled:this._state.disabled||this._state.disabledPassword,visible:this._state.hasPassword});return this.btnsChangePwd.push(n),this._isSetEvents&&n.on("click",function(t,e){i.fireEvent("protect:password",[t,"add"])}),n}},SetDisabled:function(t,e){this._state.disabled=t,this._state.invisibleSignDisabled=t&&!e,this.btnsInvisibleSignature&&this.btnsInvisibleSignature.forEach(function(i){i&&i.setDisabled(t&&!e)},this),this.btnSignature&&this.btnSignature.menu&&(this.btnSignature.menu.items&&this.btnSignature.menu.items[1].setDisabled(t),this.btnSignature.setDisabled(t&&!e)),this.btnsAddPwd.concat(this.btnsDelPwd,this.btnsChangePwd).forEach(function(e){e&&e.setDisabled(t||this._state.disabledPassword)},this)},onDocumentPassword:function(t,e){this._state.hasPassword=t,this._state.disabledPassword=!!e;var i=this._state.disabledPassword||this._state.disabled;this.btnsAddPwd&&this.btnsAddPwd.forEach(function(e){e&&(e.setVisible(!t),e.setDisabled(i))},this),this.btnsDelPwd.concat(this.btnsChangePwd).forEach(function(e){e&&(e.setVisible(t),e.setDisabled(i))},this),this.btnPwd.setVisible(t)},txtEncrypt:"Encrypt",txtSignature:"Signature",hintAddPwd:"Encrypt with password",hintPwd:"Change or delete password",hintSignature:"Add digital signature or signature line",txtChangePwd:"Change password",txtDeletePwd:"Delete password",txtAddPwd:"Add password",txtInvisibleSignature:"Add digital signature",txtSignatureLine:"Add Signature line"}}(),Common.Views.Protection||{}))}),define("common/main/lib/view/PasswordDialog",["common/main/lib/component/Window"],function(){"use strict";Common.Views.PasswordDialog=Common.UI.Window.extend(_.extend({applyFunction:void 0,initialize:function(t){var e=this,i={};_.extend(i,{width:395,height:270,header:!0,cls:"modal-dlg",contentTemplate:"",title:e.txtTitle,buttons:["ok","cancel"]},t),this.template=t.template||['<div class="box">','<div class="input-row" style="margin-bottom: 10px;">',"<label>"+e.txtDescription+"</label>","</div>",'<div class="input-row">',"<label>"+e.txtPassword+"</label>","</div>",'<div id="id-password-txt" class="input-row" style="margin-bottom: 5px;"></div>','<div class="input-row">',"<label>"+e.txtRepeat+"</label>","</div>",'<div id="id-repeat-txt" class="input-row" style="margin-bottom: 10px;"></div>',"<label>"+e.txtWarning+"</label>","</div>"].join(""),this.handler=t.handler,this.settings=t.settings,i.tpl=_.template(this.template)(i),Common.UI.Window.prototype.initialize.call(this,i)},render:function(){if(Common.UI.Window.prototype.render.call(this),this.$window){var t=this;this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.inputPwd=new Common.UI.InputField({el:$("#id-password-txt"),type:"password",allowBlank:!1,style:"width: 100%;",maxLength:255,validateOnBlur:!1}),this.repeatPwd=new Common.UI.InputField({el:$("#id-repeat-txt"),type:"password",allowBlank:!1,style:"width: 100%;",maxLength:255,validateOnBlur:!1,validation:function(e){return t.txtIncorrectPwd}})}},getFocusedComponents:function(){return[this.inputPwd,this.repeatPwd]},getDefaultFocusableComponent:function(){return this.inputPwd},onPrimary:function(t){return this._handleInput("ok"),!1},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},_handleInput:function(t){if(this.handler){if("ok"==t){if(!0!==this.inputPwd.checkValidate())return void this.inputPwd.focus();if(this.inputPwd.getValue()!==this.repeatPwd.getValue())return this.repeatPwd.checkValidate(),void this.repeatPwd.focus()}this.handler.call(this,t,this.inputPwd.getValue())}this.close()},txtTitle:"Set Password",txtPassword:"Password",txtDescription:"A Password is required to open this document",txtRepeat:"Repeat password",txtIncorrectPwd:"Confirmation password is not identical",txtWarning:"Warning: If you lose or forget the password, it cannot be recovered. Please keep it in a safe place."},Common.Views.PasswordDialog||{}))}),void 0===Common)var Common={};if(define("common/main/lib/view/SignDialog",["common/main/lib/util/utils","common/main/lib/component/InputField","common/main/lib/component/Window","common/main/lib/component/ComboBoxFonts"],function(){"use strict";Common.Views.SignDialog=Common.UI.Window.extend(_.extend({options:{width:370,style:"min-width: 350px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.api=this.options.api,this.signType=this.options.signType||"invisible",this.signSize=this.options.signSize||{width:0,height:0},this.certificateId=null,this.signObject=null,this.fontStore=this.options.fontStore,this.font={size:11,name:"Arial",bold:!1,italic:!1};var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:"",this.template=['<div class="box" style="height: '+("invisible"==this.signType?"132px;":"300px;")+'">','<div id="id-dlg-sign-invisible">','<div class="input-row">',"<label>"+this.textPurpose+"</label>","</div>",'<div id="id-dlg-sign-purpose" class="input-row"></div>',"</div>",'<div id="id-dlg-sign-visible">','<div class="input-row">',"<label>"+this.textInputName+"</label>","</div>",'<div id="id-dlg-sign-name" class="input-row" style="margin-bottom: 5px;"></div>','<div id="id-dlg-sign-fonts" class="input-row" style="display: inline-block;"></div>','<div id="id-dlg-sign-font-size" class="input-row" style="display: inline-block;margin-left: 3px;"></div>','<div id="id-dlg-sign-bold" style="display: inline-block;margin-left: 3px;"></div>','<div id="id-dlg-sign-italic" style="display: inline-block;margin-left: 3px;"></div>','<div style="margin: 10px 0 5px 0;">',"<label>"+this.textUseImage+"</label>","</div>",'<button id="id-dlg-sign-image" class="btn btn-text-default auto">'+this.textSelectImage+"</button>",'<div class="input-row" style="margin-top: 10px;">','<label style="font-weight: bold;">'+this.textSignature+"</label>","</div>",'<div style="border: 1px solid #cbcbcb;"><div id="signature-preview-img" style="width: 100%; height: 50px;position: relative;"></div></div>',"</div>",'<table style="margin-top: 30px;">',"<tr>",'<td><label style="font-weight: bold;margin-bottom: 3px;">'+this.textCertificate+'</label></td><td rowspan="2" style="vertical-align: top; padding-left: 20px;"><button id="id-dlg-sign-change" class="btn btn-text-default" style="float:right;">'+this.textSelect+"</button></td>","</tr>",'<tr><td><div id="id-dlg-sign-certificate" class="hidden" style="max-width: 240px;overflow: hidden;white-space: nowrap;"></td></tr>',"</table>","</div>"].join(""),this.templateCertificate=_.template(['<label style="display: block;margin-bottom: 3px;overflow: hidden;text-overflow: ellipsis;"><%= Common.Utils.String.htmlEncode(name) %></label>','<label style="display: block;"><%= Common.Utils.String.htmlEncode(valid) %></label>'].join("")),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this,e=this.getChild();t.inputPurpose=new Common.UI.InputField({el:$("#id-dlg-sign-purpose"),style:"width: 100%;"}),t.inputName=new Common.UI.InputField({el:$("#id-dlg-sign-name"),style:"width: 100%;",validateOnChange:!0}).on("changing",_.bind(t.onChangeName,t)),t.cmbFonts=new Common.UI.ComboBoxFonts({el:$("#id-dlg-sign-fonts"),cls:"input-group-nr",style:"width: 234px;",menuCls:"scrollable-menu",menuStyle:"min-width: 234px;max-height: 270px;",store:new Common.Collections.Fonts,recent:0,takeFocusOnClose:!0,hint:t.tipFontName}).on("selected",function(e,i){t.signObject&&t.signObject.setText(t.inputName.getValue(),i.name,t.font.size,t.font.italic,t.font.bold),t.font.name=i.name}),this.cmbFontSize=new Common.UI.ComboBox({el:$("#id-dlg-sign-font-size"),cls:"input-group-nr",style:"width: 55px;",menuCls:"scrollable-menu",menuStyle:"min-width: 55px;max-height: 270px;",hint:this.tipFontSize,takeFocusOnClose:!0,data:[{value:8,displayValue:"8"},{value:9,displayValue:"9"},{value:10,displayValue:"10"},{value:11,displayValue:"11"},{value:12,displayValue:"12"},{value:14,displayValue:"14"},{value:16,displayValue:"16"},{value:18,displayValue:"18"},{value:20,displayValue:"20"},{value:22,displayValue:"22"},{value:24,displayValue:"24"},{value:26,displayValue:"26"},{value:28,displayValue:"28"},{value:36,displayValue:"36"},{value:48,displayValue:"48"},{value:72,displayValue:"72"},{value:96,displayValue:"96"}]}).on("selected",function(e,i){t.signObject&&t.signObject.setText(t.inputName.getValue(),t.font.name,i.value,t.font.italic,t.font.bold),t.font.size=i.value}),this.cmbFontSize.setValue(this.font.size),this.cmbFontSize.on("changed:before",_.bind(this.onFontSizeChanged,this,!0)),this.cmbFontSize.on("changed:after",_.bind(this.onFontSizeChanged,this,!1)),t.btnBold=new Common.UI.Button({parentEl:$("#id-dlg-sign-bold"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-bold",enableToggle:!0,hint:t.textBold}),t.btnBold.on("click",function(e,i){t.signObject&&t.signObject.setText(t.inputName.getValue(),t.font.name,t.font.size,t.font.italic,e.pressed),t.font.bold=e.pressed}),t.btnItalic=new Common.UI.Button({parentEl:$("#id-dlg-sign-italic"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-italic",enableToggle:!0,hint:t.textItalic}),t.btnItalic.on("click",function(e,i){t.signObject&&t.signObject.setText(t.inputName.getValue(),t.font.name,t.font.size,e.pressed,t.font.bold),t.font.italic=e.pressed}),t.btnSelectImage=new Common.UI.Button({el:"#id-dlg-sign-image"}),t.btnSelectImage.on("click",_.bind(t.onSelectImage,t)),t.btnChangeCertificate=new Common.UI.Button({el:"#id-dlg-sign-change"}),t.btnChangeCertificate.on("click",_.bind(t.onChangeCertificate,t)),t.btnOk=new Common.UI.Button({el:e.find(".primary"),disabled:!0}),t.cntCertificate=$("#id-dlg-sign-certificate"),t.cntVisibleSign=$("#id-dlg-sign-visible"),t.cntInvisibleSign=$("#id-dlg-sign-invisible"),"visible"==t.signType?t.cntInvisibleSign.addClass("hidden"):t.cntVisibleSign.addClass("hidden"),e.find(".dlg-btn").on("click",_.bind(t.onBtnClick,t)),t.afterRender()},getFocusedComponents:function(){return[this.inputPurpose,this.inputName,this.cmbFonts,this.cmbFontSize]},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var t=this;_.delay(function(){("visible"==t.signType?t.inputName:t.inputPurpose).cmpEl.find("input").focus()},500)},close:function(){this.api.asc_unregisterCallback("on_signature_defaultcertificate_ret",this.binding.certificateChanged),this.api.asc_unregisterCallback("on_signature_selectsertificate_ret",this.binding.certificateChanged),Common.UI.Window.prototype.close.apply(this,arguments),this.signObject&&this.signObject.destroy()},afterRender:function(){this.api&&(this.binding||(this.binding={}),this.binding.certificateChanged=_.bind(this.onCertificateChanged,this),this.api.asc_registerCallback("on_signature_defaultcertificate_ret",this.binding.certificateChanged),this.api.asc_registerCallback("on_signature_selectsertificate_ret",this.binding.certificateChanged),this.api.asc_GetDefaultCertificate()),"visible"==this.signType&&(this.cmbFonts.fillFonts(this.fontStore),this.cmbFonts.selectRecord(this.fontStore.findWhere({name:this.font.name})||this.fontStore.at(0)),this.signObject=new AscCommon.CSignatureDrawer("signature-preview-img",this.api,this.signSize.width,this.signSize.height))},getSettings:function(){var t={};return t.certificateId=this.certificateId,"invisible"==this.signType?t.purpose=this.inputPurpose.getValue():t.images=this.signObject?this.signObject.getImages():[null,null],t},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(t){return this._handleInput("ok"),!1},_handleInput:function(t){if(this.options.handler){if("ok"==t&&(this.btnOk.isDisabled()||this.signObject&&!this.signObject.isValid()))return void(this.btnOk.isDisabled()||(this.inputName.showError([this.textNameError]),this.inputName.focus()));this.options.handler.call(this,this,t)}this.close()},onChangeCertificate:function(){this.api.asc_SelectCertificate()},onCertificateChanged:function(t){this.certificateId=t.id;var e=t.date,i="string"==typeof e?e.split(" - "):["",""];this.cntCertificate.html(this.templateCertificate({name:t.name,valid:this.textValid.replace("%1",i[0]).replace("%2",i[1])})),this.cntCertificate.toggleClass("hidden",_.isEmpty(this.certificateId)||this.certificateId<0),this.btnChangeCertificate.setCaption(_.isEmpty(this.certificateId)||this.certificateId<0?this.textSelect:this.textChange),this.btnOk.setDisabled(_.isEmpty(this.certificateId)||this.certificateId<0)},onSelectImage:function(){this.signObject&&(this.signObject.selectImage(),this.inputName.setValue(""))},onChangeName:function(t,e){this.signObject&&this.signObject.setText(e,this.font.name,this.font.size,this.font.italic,this.font.bold)},onFontSizeChanged:function(t,e,i,n){var o;if(t){if(!e.store.findWhere({displayValue:i.value})&&!(o=/^\+?(\d*(\.|,)?\d+)$|^\+?(\d+(\.|,)?\d*)$/.exec(i.value)))return o=e.getValue(),e.setRawValue(o),n.preventDefault(),!1}else{var s="sse-"==this.appPrefix?409:300;o=Common.Utils.String.parseFloat(i.value),o=o>s?s:o<1?1:Math.floor(2*(o+.4))/2,e.setRawValue(o),this.signObject&&this.signObject.setText(this.inputName.getValue(),this.font.name,o,this.font.italic,this.font.bold),this.font.size=o}},textTitle:"Sign Document",textPurpose:"Purpose for signing this document",textCertificate:"Certificate",textValid:"Valid from %1 to %2",textChange:"Change",textInputName:"Input signer name",textUseImage:"or click 'Select Image' to use a picture as signature",textSelectImage:"Select Image",textSignature:"Signature looks as",tipFontName:"Font Name",tipFontSize:"Font Size",textBold:"Bold",textItalic:"Italic",textSelect:"Select",textNameError:"Signer name must not be empty."},Common.Views.SignDialog||{}))}),void 0===Common)var Common={};if(define("common/main/lib/view/SignSettingsDialog",["common/main/lib/util/utils","common/main/lib/component/InputField","common/main/lib/component/CheckBox","common/main/lib/component/Window"],function(){"use strict";Common.Views.SignSettingsDialog=Common.UI.Window.extend(_.extend({options:{width:350,style:"min-width: 350px;",cls:"modal-dlg",type:"edit"},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box" style="height: 260px;">','<div class="input-row">',"<label>"+this.textInfo+"</label>","</div>",'<div class="input-row">',"<label>"+this.textInfoName+"</label>","</div>",'<div id="id-dlg-sign-settings-name" class="input-row" style="margin-bottom: 5px;"></div>','<div class="input-row">',"<label>"+this.textInfoTitle+"</label>","</div>",'<div id="id-dlg-sign-settings-title" class="input-row" style="margin-bottom: 5px;"></div>','<div class="input-row">',"<label>"+this.textInfoEmail+"</label>","</div>",'<div id="id-dlg-sign-settings-email" class="input-row" style="margin-bottom: 10px;"></div>','<div class="input-row">',"<label>"+this.textInstructions+"</label>","</div>",'<textarea id="id-dlg-sign-settings-instructions" class="form-control" style="width: 100%;height: 35px;margin-bottom: 10px;resize: none;"></textarea>','<div id="id-dlg-sign-settings-date"></div>',"</div>",'<div class="footer center">','<button class="btn normal dlg-btn primary" result="ok">'+this.okButtonText+"</button>",'<% if (type == "edit") { %>','<button class="btn normal dlg-btn" result="cancel">'+this.cancelButtonText+"</button>","<% } %>","</div>"].join(""),this.api=this.options.api,this.type=this.options.type||"edit",this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this,e=this.getChild();t.inputName=new Common.UI.InputField({el:$("#id-dlg-sign-settings-name"),style:"width: 100%;",disabled:"view"==this.type}),t.inputTitle=new Common.UI.InputField({el:$("#id-dlg-sign-settings-title"),style:"width: 100%;",disabled:"view"==this.type}),t.inputEmail=new Common.UI.InputField({el:$("#id-dlg-sign-settings-email"),style:"width: 100%;",disabled:"view"==this.type}),t.textareaInstructions=this.$window.find("textarea"),t.textareaInstructions.keydown(function(t){t.keyCode==Common.UI.Keys.RETURN&&t.stopPropagation()}),"view"==this.type?this.textareaInstructions.attr("disabled","disabled"):this.textareaInstructions.removeAttr("disabled"),this.textareaInstructions.toggleClass("disabled","view"==this.type),this.chDate=new Common.UI.CheckBox({el:$("#id-dlg-sign-settings-date"),labelText:this.textShowDate,disabled:"view"==this.type}),e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this))},getFocusedComponents:function(){return[this.inputName,this.inputTitle,this.inputEmail,this.textareaInstructions,this.chDate]},getDefaultFocusableComponent:function(){return this.inputName},setSettings:function(t){if(t){var e=this,i=t.asc_getSigner1();e.inputName.setValue(i||""),i=t.asc_getSigner2(),e.inputTitle.setValue(i||""),i=t.asc_getEmail(),e.inputEmail.setValue(i||""),i=t.asc_getInstructions(),e.textareaInstructions.val(i||""),e.chDate.setValue(t.asc_getShowDate()),e._currentGuid=t.asc_getGuid()}},getSettings:function(){var t=this,e=new AscCommon.asc_CSignatureLine;return e.asc_setSigner1(t.inputName.getValue()),e.asc_setSigner2(t.inputTitle.getValue()),e.asc_setEmail(t.inputEmail.getValue()),e.asc_setInstructions(t.textareaInstructions.val()),e.asc_setShowDate("checked"==t.chDate.getValue()),void 0!==t._currentGuid&&e.asc_setGuid(t._currentGuid),e},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(t){return this._handleInput("ok"),!1},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,this,t),this.close()},textInfo:"Signer Info",textInfoName:"Name",textInfoTitle:"Signer Title",textInfoEmail:"E-mail",textInstructions:"Instructions for Signer",txtEmpty:"This field is required",textAllowComment:"Allow signer to add comment in the signature dialog",textShowDate:"Show sign date in signature line",textTitle:"Signature Setup"},Common.Views.SignSettingsDialog||{}))}),void 0===Common)var Common={};Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/Protection",["core","common/main/lib/view/Protection","common/main/lib/view/PasswordDialog","common/main/lib/view/SignDialog","common/main/lib/view/SignSettingsDialog"],function(){"use strict";Common.Controllers.Protection=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["Common.Views.Protection"],sdkViewName:"#id_main",initialize:function(){this.addListeners({"Common.Views.Protection":{"protect:password":_.bind(this.onPasswordClick,this),"protect:signature":_.bind(this.onSignatureClick,this)}})},onLaunch:function(){this._state={},Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this))},setConfig:function(t,e){this.setApi(e),t&&(this.sdkViewName=t.sdkviewname||this.sdkViewName)},setApi:function(t){t&&(this.api=t,this.appConfig.isPasswordSupport&&this.api.asc_registerCallback("asc_onDocumentPassword",_.bind(this.onDocumentPassword,this)),this.appConfig.isSignatureSupport&&(Common.NotificationCenter.on("protect:sign",_.bind(this.onSignatureRequest,this)),Common.NotificationCenter.on("protect:signature",_.bind(this.onSignatureClick,this)),this.api.asc_registerCallback("asc_onSignatureClick",_.bind(this.onSignatureSign,this)),this.api.asc_registerCallback("asc_onUpdateSignatures",_.bind(this.onApiUpdateSignatures,this))),
this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)))},setMode:function(t){return this.appConfig=t,this.view=this.createView("Common.Views.Protection",{mode:t}),this},onDocumentPassword:function(t,e){this.view&&this.view.onDocumentPassword(t,e)},SetDisabled:function(t,e){this.view&&this.view.SetDisabled(t,e)},onPasswordClick:function(t,e){switch(e){case"add":this.addPassword();break;case"delete":this.deletePassword()}Common.NotificationCenter.trigger("edit:complete",this.view)},onSignatureRequest:function(t){this.api.asc_RequestSign(t)},onSignatureClick:function(t,e,i){switch(t){case"invisible":this.onSignatureRequest("unvisibleAdd");break;case"visible":this.addVisibleSignature(e,i)}},createToolbarPanel:function(){return this.view.getPanel()},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onAppReady:function(t){},addPassword:function(){var t=this;new Common.Views.PasswordDialog({api:t.api,signType:"invisible",handler:function(e,i){"ok"==e&&t.api.asc_setCurrentPassword(i),Common.NotificationCenter.trigger("edit:complete")}}).show()},deletePassword:function(){this.api.asc_resetPassword()},addInvisibleSignature:function(){var t=this;new Common.Views.SignDialog({api:t.api,signType:"invisible",handler:function(e,i){if("ok"==i){var n=e.getSettings();t.api.asc_Sign(n.certificateId)}Common.NotificationCenter.trigger("edit:complete")}}).show()},addVisibleSignature:function(t,e){var i=this,n=new Common.Views.SignSettingsDialog({type:t?"view":"edit",handler:function(e,n){t||"ok"!=n||i.api.asc_AddSignatureLine2(e.getSettings()),Common.NotificationCenter.trigger("edit:complete")}});n.show(),e&&n.setSettings(this.api.asc_getSignatureSetup(e))},signVisibleSignature:function(t,e,i){var n=this;if(_.isUndefined(n.fontStore)){n.fontStore=new Common.Collections.Fonts;var o=n.getApplication().getController("Toolbar").getView("Toolbar").cmbFontName.store.toJSON(),s=[];_.each(o,function(t,e){t.cloneid||s.push(_.clone(t))}),n.fontStore.add(s)}new Common.Views.SignDialog({api:n.api,signType:"visible",fontStore:n.fontStore,signSize:{width:e||0,height:i||0},handler:function(e,i){if("ok"==i){var o=e.getSettings();n.api.asc_Sign(o.certificateId,t,o.images[0],o.images[1])}Common.NotificationCenter.trigger("edit:complete")}}).show()},onSignatureSign:function(t,e,i,n){n?this.signVisibleSignature(t,e,i):this.addInvisibleSignature()},onApiUpdateSignatures:function(t,e){this.SetDisabled(t&&t.length>0,!0)},onCoAuthoringDisconnect:function(){this.SetDisabled(!0)}},Common.Controllers.Protection||{}))}),define("common/main/lib/controller/Themes",["core"],function(){"use strict";!Common.UI&&(Common.UI={}),Common.UI.Themes=new function(t){!t&&(t={});var e={"theme-light":{text:t.txtThemeLight||"Light",type:"light"},"theme-classic-light":{text:t.txtThemeClassicLight||"Classic Light",type:"light"},"theme-dark":{text:t.txtThemeDark||"Dark",type:"dark"}},i=["background-normal","background-toolbar","background-toolbar-additional","background-primary-dialog-button","background-tab-underline","background-notification-popover","background-notification-badge","background-scrim","background-loader","highlight-button-hover","highlight-button-pressed","highlight-button-pressed-hover","highlight-primary-dialog-button-hover","highlight-header-button-hover","highlight-header-button-pressed","highlight-toolbar-tab-underline","highlight-text-select","border-toolbar","border-divider","border-regular-control","border-toolbar-button-hover","border-preview-hover","border-preview-select","border-control-focus","border-color-shading","border-error","text-normal","text-normal-pressed","text-secondary","text-tertiary","text-link","text-link-hover","text-link-active","text-link-visited","text-inverse","text-toolbar-header","text-contrast-background","icon-normal","icon-normal-pressed","icon-inverse","icon-toolbar-header","icon-notification-badge","icon-contrast-popover","icon-success","canvas-background","canvas-content-background","canvas-page-border","canvas-ruler-background","canvas-ruler-margins-background","canvas-ruler-mark","canvas-ruler-handle-border","canvas-ruler-handle-border-disabled","canvas-high-contrast","canvas-high-contrast-disabled","canvas-cell-border","canvas-cell-title-border","canvas-cell-title-border-hover","canvas-cell-title-border-selected","canvas-cell-title-hover","canvas-cell-title-selected","canvas-dark-cell-title","canvas-dark-cell-title-hover","canvas-dark-cell-title-selected","canvas-dark-cell-title-border","canvas-dark-cell-title-border-hover","canvas-dark-cell-title-border-selected","canvas-scroll-thumb","canvas-scroll-thumb-hover","canvas-scroll-thumb-pressed","canvas-scroll-thumb-border","canvas-scroll-thumb-border-hover","canvas-scroll-thumb-border-pressed","canvas-scroll-arrow","canvas-scroll-arrow-hover","canvas-scroll-arrow-pressed","canvas-scroll-thumb-target","canvas-scroll-thumb-target-hover","canvas-scroll-thumb-target-pressed"],n=function(t){var e={};if(!Common.Utils.isIE10&&!Common.Utils.isIE11){var i=getComputedStyle(document.body);t.forEach(function(t,n){e[t]=i.getPropertyValue("--"+t).trim()})}return e},o=function(t){},s=function(t){return"string"==typeof t&&t.startsWith("{")&&t.endsWith("}")&&(t=JSON.parse(t)),t&&"object"==typeof t?t.id:t};return{init:function(t){var a=this;$(window).on("storage",function(t){"ui-theme"!=t.key&&"ui-theme-id"!=t.key||a.setTheme(t.originalEvent.newValue,!0)}),this.api=t;var r=s(Common.localStorage.getItem("ui-theme"));r||Common.Utils.isIE10||Common.Utils.isIE11||document.body.classList.forEach(function(t,i,n){if(!r&&t.startsWith("theme-")&&!t.startsWith("theme-type-")&&e[t]){r=t;var o={id:r,type:e[r].type};Common.localStorage.setItem("ui-theme",JSON.stringify(o))}}),e[r]||(r="theme-classic-light"),$("body").hasClass(r)||$("body").addClass(r),document.body.className.match(/theme-type-/)||document.body.classList.add("theme-type-"+e[r].type);var l=n(i);l.type=e[r].type,l.name=r,t.asc_setSkin(l),Common.NotificationCenter.on("document:ready",o.bind(this))},available:function(){return!Common.Utils.isIE&&!this.locked},setAvailable:function(t){this.locked=!t},map:function(){return e},get:function(t){return e[t]},currentThemeId:function(){var t=Common.localStorage.getItem("ui-theme")||Common.localStorage.getItem("ui-theme-id"),i=s(t);return e[i]?i:"theme-classic-light"},defaultThemeId:function(t){return"dark"==t?"theme-dark":"theme-classic-light"},defaultTheme:function(t){return e[this.defaultThemeId(t)]},isDarkTheme:function(){return"dark"==e[this.currentThemeId()].type},setTheme:function(t,o){var a=s(t);if((this.currentThemeId()!=a||o)&&e[a]){if(document.body.className=document.body.className.replace(/theme-[\w-]+\s?/gi,"").trim(),document.body.classList.add(a,"theme-type-"+e[a].type),this.api){var t=n(i);t.type=e[a].type,t.name=a,this.api.asc_setSkin(t)}if(!Common.Utils.isIE10&&!Common.Utils.isIE11){var r={id:a,type:t.type};Common.localStorage.setItem("ui-theme",JSON.stringify(r))}Common.localStorage.setItem("ui-theme-id",a),Common.NotificationCenter.trigger("uitheme:changed",a)}},toggleTheme:function(){this.setTheme(this.isDarkTheme()?"theme-classic-light":"theme-dark")}}}(Common.UI.Themes)}),define("common/main/lib/controller/Desktop",["core"],function(){"use strict";var t={version:"0.0.0",eventloading:!0,titlebuttons:!0,uithemes:!0},e=window.desktop||window.AscDesktopEditor;!!e&&e.execCommand("webapps:features",JSON.stringify(t));var i=function(){var i,n={version:"0.0.0"},o=window.DE||window.PE||window.SSE,s={"btn-save":"save","btn-save-coauth":"coauth","btn-synch":"synch"};if(e){if(window.on_native_message=function(t,s){if(/^style:change/.test(t)){var a=JSON.parse(s);if("toolbar"==a.element)"off"==a.action&&"native-color"==a.style&&$(".toolbar").removeClass("editor-native-color");else if("body"==a.element&&"merge"==a.action){var r=document.createElement("style");r.innerHTML=a.style,document.body.appendChild(r)}}else if(/window:features/.test(t)){var a=JSON.parse(s);_.isNumber(a.skiptoparea)?($(".asc-window.modal").length&&$(".asc-window.modal").position().top<a.skiptoparea&&$(".asc-window.modal").css("top",a.skiptoparea),Common.Utils.InternalSettings.set("window-inactive-area-top",a.skiptoparea)):void 0!=a.lockthemes&&Common.UI.Themes.setAvailable(!a.lockthemes)}else if(/editor:config/.test(t)){if("request"==s)if(i){var c={user:n.user,title:{buttons:[]}},d=o.getController("Viewport").getView("Common.Views.Header");if(d)for(var h in i)c.title.buttons.push(l(h,i[h]));e.execCommand("editor:config",JSON.stringify(c))}else n.callback_editorconfig||(n.callback_editorconfig=function(){setTimeout(function(){window.on_native_message(t,s)},0)})}else if(/button:click/.test(t)){var a=JSON.parse(s);a.action&&i[a.action]&&i[a.action].btn.click()}else if(/theme:changed/.test(t))Common.UI.Themes.setTheme(s);else if(/element:show/.test(t)){var p=/title:(?:(true|show)|(false|hide))/.exec(s);p&&(p[1]?$("#app-title").show():p[2]&&$("#app-title").hide())}},window.on_native_message("editor:config","request"),window.native_message_cmd)for(var a in window.native_message_cmd)window.on_native_message(a,window.native_message_cmd[a]);e.execCommand("webapps:features",JSON.stringify(t));var r=document.createElement("style");r.appendChild(document.createTextNode(".modals-mask{opacity:0 !important;}")),document.getElementsByTagName("head")[0].appendChild(r)}var l=function(t,e){return{action:t,icon:e.icon||void 0,hint:e.btn.options.hint,disabled:e.btn.isDisabled()}},c=function(t,i,n){var o={};o[t]=n,e.execCommand("title:button",JSON.stringify({disabled:o}))},d=function(t,i){e.execCommand("title:button",JSON.stringify({"icon:changed":{save:s[i.next]}}))},h=function(t){if("open"==t)e.execCommand("title:button",JSON.stringify({disabled:{all:!0}}));else{var n={};for(var o in i)n[o]=i[o].btn.isDisabled();e.execCommand("title:button",JSON.stringify({disabled:n}))}};return{init:function(a){_.extend(n,a),n.isDesktopApp&&(Common.NotificationCenter.on("app:ready",function(t){_.extend(n,t),!!e&&e.execCommand("doc:onready",""),$(".toolbar").addClass("editor-native-color")}),Common.NotificationCenter.on("document:ready",function(){if(n.isEdit){var t=o.getController("Main");t.api.asc_isReadOnly&&t.api.asc_isReadOnly()&&t.warningDocumentIsLocked()}}),Common.NotificationCenter.on("app:face",function(a){if(t.viewmode=!a.isEdit,t.crypted=a.isCrypted,e.execCommand("webapps:features",JSON.stringify(t)),i={},a.isEdit){var r=o.getController("Viewport").getView("Common.Views.Header");if(r.btnSave){i.save={btn:r.btnSave};var l=/\s?([^\s]+)$/.exec(i.save.btn.$icon.attr("class"));!!l&&l.length&&(i.save.icon=s[l])}r.btnPrint&&(i.print={btn:r.btnPrint}),r.btnUndo&&(i.undo={btn:r.btnUndo}),r.btnRedo&&(i.redo={btn:r.btnRedo});for(var h in i)i[h].btn.options.signals=["disabled"],i[h].btn.on("disabled",c.bind(this,h));i.save&&(i.save.btn.options.signals.push("icon:changed"),i.save.btn.on("icon:changed",d.bind(this)))}n.callback_editorconfig&&(n.callback_editorconfig(),delete n.callback_editorconfig)}),Common.NotificationCenter.on({"modal:show":h.bind(this,"open"),"modal:close":h.bind(this,"close"),"uitheme:changed":function(t){var i=Common.UI.Themes.get(t);i&&e.execCommand("uitheme:changed",JSON.stringify({name:t,type:i.type}))}}))},process:function(t){if(n.isDesktopApp&&e){if("goback"==t)return e.execCommand("go:folder",n.isOffline?"offline":n.customization.goback.url),!0;if("preloader:hide"==t)return e.execCommand("editor:onready",""),!0;if("create:new"==t&&"desktop://create.new"==n.createUrl)return e.execCommand("create:new",window.SSE?"cell":window.PE?"slide":"word"),!0}return!1},requestClose:function(){n.isDesktopApp&&e&&e.execCommand("editor:event",JSON.stringify({action:"close",url:n.customization.goback.url}))}}};Common.Controllers.Desktop=new i});var reqerr;require.config({baseUrl:"../../",paths:{jquery:"../vendor/jquery/jquery",underscore:"../vendor/underscore/underscore",backbone:"../vendor/backbone/backbone",bootstrap:"../vendor/bootstrap/dist/js/bootstrap",text:"../vendor/requirejs-text/text",perfectscrollbar:"common/main/lib/mods/perfect-scrollbar",jmousewheel:"../vendor/perfect-scrollbar/src/jquery.mousewheel",xregexp:"../vendor/xregexp/xregexp-all-min",sockjs:"../vendor/sockjs/sockjs.min",jszip:"../vendor/jszip/jszip.min",jsziputils:"../vendor/jszip-utils/jszip-utils.min",allfonts:"../../sdkjs/common/AllFonts",sdk:"../../sdkjs/word/sdk-all-min",api:"api/documents/api",core:"common/main/lib/core/application",notification:"common/main/lib/core/NotificationCenter",keymaster:"common/main/lib/core/keymaster",tip:"common/main/lib/util/Tip",localstorage:"common/main/lib/util/LocalStorage",analytics:"common/Analytics",gateway:"common/Gateway",locale:"common/locale",irregularstack:"common/IrregularStack"},shim:{underscore:{exports:"_"},backbone:{deps:["underscore","jquery"],exports:"Backbone"},bootstrap:{deps:["jquery"]},perfectscrollbar:{deps:["jmousewheel"]},notification:{deps:["backbone"]},core:{deps:["backbone","notification","irregularstack"]},sdk:{deps:["jquery","underscore","allfonts","xregexp","sockjs","jszip","jsziputils"]},gateway:{deps:["jquery"]},analytics:{deps:["jquery"]}}}),require(["backbone","bootstrap","core","sdk","api","analytics","gateway","locale"],function(t,e,i){t.history.start();var n=new t.Application({nameSpace:"DE",autoCreate:!1,controllers:["Viewport","DocumentHolder","Toolbar","Statusbar","Links","FormsTab","Navigation","RightMenu","LeftMenu","Main","Common.Controllers.Fonts","Common.Controllers.History","Common.Controllers.Chat","Common.Controllers.Comments","Common.Controllers.Plugins","Common.Controllers.ExternalDiagramEditor","Common.Controllers.ExternalMergeEditor","Common.Controllers.ReviewChanges","Common.Controllers.Protection"]});Common.Locale.apply(function(){require(["documenteditor/main/app/controller/Viewport","documenteditor/main/app/controller/DocumentHolder","documenteditor/main/app/controller/Toolbar","documenteditor/main/app/controller/Statusbar","documenteditor/main/app/controller/FormsTab","documenteditor/main/app/controller/Links","documenteditor/main/app/controller/Navigation","documenteditor/main/app/controller/RightMenu","documenteditor/main/app/controller/LeftMenu","documenteditor/main/app/controller/Main","documenteditor/main/app/view/FileMenuPanels","documenteditor/main/app/view/ParagraphSettings","documenteditor/main/app/view/HeaderFooterSettings","documenteditor/main/app/view/ImageSettings","documenteditor/main/app/view/TableSettings","documenteditor/main/app/view/ShapeSettings","documenteditor/main/app/view/TextArtSettings","documenteditor/main/app/view/SignatureSettings","common/main/lib/util/utils","common/main/lib/util/LocalStorage","common/main/lib/controller/Fonts","common/main/lib/controller/History","common/main/lib/controller/Comments","common/main/lib/controller/Chat","common/main/lib/controller/Plugins","documenteditor/main/app/view/ChartSettings","common/main/lib/controller/ExternalDiagramEditor","common/main/lib/controller/ExternalMergeEditor","common/main/lib/controller/ReviewChanges","common/main/lib/controller/Protection","common/main/lib/controller/Themes","common/main/lib/controller/Desktop"],function(){n.start()})})},function(t){"timeout"==t.requireType&&!reqerr&&window.requireTimeourError&&(reqerr=window.requireTimeourError(),window.alert(reqerr),window.location.reload())}),define("../apps/documenteditor/main/app.js",function(){});