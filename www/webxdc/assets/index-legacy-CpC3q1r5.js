console.log('XXX: loaded');
!function(){function e(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */e=function(){return n};var r,n={},o=Object.prototype,i=o.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},l=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function f(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(r){f=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var o=t&&t.prototype instanceof y?t:y,i=Object.create(o.prototype),s=new q(n||[]);return a(i,"_invoke",{value:P(e,r,s)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}n.wrap=d;var p="suspendedStart",v="suspendedYield",m="executing",g="completed",b={};function y(){}function w(){}function _(){}var k={};f(k,l,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(I([])));S&&S!==o&&i.call(S,l)&&(k=S);var E=_.prototype=y.prototype=Object.create(k);function C(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,r){function n(o,a,s,l){var u=h(e[o],e,a);if("throw"!==u.type){var c=u.arg,f=c.value;return f&&"object"==t(f)&&i.call(f,"__await")?r.resolve(f.__await).then((function(e){n("next",e,s,l)}),(function(e){n("throw",e,s,l)})):r.resolve(f).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,l)}))}l(u.arg)}var o;a(this,"_invoke",{value:function(e,t){function i(){return new r((function(r,o){n(e,t,r,o)}))}return o=o?o.then(i,i):i()}})}function P(e,t,n){var o=p;return function(i,a){if(o===m)throw Error("Generator is already running");if(o===g){if("throw"===i)throw a;return{value:r,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var l=N(s,n);if(l){if(l===b)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=h(e,t,n);if("normal"===u.type){if(o=n.done?g:v,u.arg===b)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=g,n.method="throw",n.arg=u.arg)}}}function N(e,t){var n=t.method,o=e.iterator[n];if(o===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=r,N(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var i=h(o,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,b;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,b):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,b)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function q(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function I(e){if(e||""===e){var n=e[l];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function t(){for(;++o<e.length;)if(i.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=r,t.done=!0,t};return a.next=a}}throw new TypeError(t(e)+" is not iterable")}return w.prototype=_,a(E,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=f(_,c,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,f(e,c,"GeneratorFunction")),e.prototype=Object.create(E),e},n.awrap=function(e){return{__await:e}},C(A.prototype),f(A.prototype,u,(function(){return this})),n.AsyncIterator=A,n.async=function(e,t,r,o,i){void 0===i&&(i=Promise);var a=new A(d(e,t,r,o),i);return n.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},C(E),f(E,c,"Generator"),f(E,l,(function(){return this})),f(E,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},n.values=I,q.prototype={constructor:q,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,o){return s.type="throw",s.arg=e,t.next=n,o&&(t.method="next",t.arg=r),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var l=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:I(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),b}},n}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function n(e,t,r){return(t=o(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e){var r=function(e,r){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,r||"default");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==t(r)?r:r+""}function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw i}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}System.register([],(function(o,a){"use strict";return{execute:function(){var o=document.createElement("style");o.textContent="/*! chessboard.js v1.0.0 | (c) 2019 Chris Oakman | MIT License chessboardjs.com/license */.clearfix-7da63{clear:both}.board-b72b1{border:2px solid #404040;box-sizing:content-box}.square-55d63{float:left;position:relative;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.white-1e1d7{background-color:#f0d9b5;color:#b58863}.black-3c85d{background-color:#b58863;color:#f0d9b5}.highlight1-32417,.highlight2-9c5d2{box-shadow:inset 0 0 3px 3px #ff0}.notation-322f9{cursor:default;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:14px;position:absolute}.alpha-d2270{bottom:1px;right:3px}.numeric-fc462{top:2px;left:2px}html,body{height:100%}body{background-image:url(../img/board-background.png);background-position:center top;margin:0}.btn{background:#ffdc10;border-radius:6px;border:none;display:inline-block;padding:8px 16px;vertical-align:middle;overflow:hidden;text-decoration:none;color:#333;text-align:center;cursor:pointer;white-space:nowrap;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.btn:hover{box-shadow:0 8px 16px rgba(0,0,0,.2),0 6px 20px rgba(0,0,0,.19)}.sub{color:#fff;font-size:16px;font-weight:300;margin:0}.tag{display:inline-block;padding-left:8px;padding-right:8px;text-align:center;border-radius:5px}.black{background-color:#000;color:#fff}.white{background-color:#fff;color:#000}#home .sub{padding-top:8px}#app-icon{display:block;height:80px;width:80px;margin:0 auto}#app-name{color:#fff;font-size:44px;font-weight:400;margin:20px 0 0;padding:0}#join-btn{margin-top:45px;margin-bottom:0;padding:12px 24px}#game .btn{margin-top:1em;margin-bottom:0}#home{margin:10px}#board{width:100%;max-width:400px;margin-top:10px;margin-bottom:10px}#game{width:100%;max-width:400px;margin-top:10px;margin-left:10px;margin-right:10px}.highlight-lastmove{box-shadow:inset 0 0 3px 3px #ff0}#root{width:100%;height:100%;padding:0;margin:0;display:flex;justify-content:center;text-align:center}#footer{font-family:Courier,monospace,sans-serif;position:fixed;bottom:.5em;left:.5em;color:#fff;opacity:.8;text-decoration:none}\n/*$vite$:1*/",document.head.appendChild(o);
/**
       * @license
       * Copyright (c) 2023, Jeff Hlywa (jhlywa@gmail.com)
       * All rights reserved.
       *
       * Redistribution and use in source and binary forms, with or without
       * modification, are permitted provided that the following conditions are met:
       *
       * 1. Redistributions of source code must retain the above copyright notice,
       *    this list of conditions and the following disclaimer.
       * 2. Redistributions in binary form must reproduce the above copyright notice,
       *    this list of conditions and the following disclaimer in the documentation
       *    and/or other materials provided with the distribution.
       *
       * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
       * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
       * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
       * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
       * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
       * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
       * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
       * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
       * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
       * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
       * POSSIBILITY OF SUCH DAMAGE.
       */
var a="w",s="b",l="p",u="b",c="r",f="q",d="k",h="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",p=-1,v={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},m={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},g={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},b={b:[16,32,17,15],w:[-16,-32,-17,-15]},y={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},w=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],_=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],k={p:1,n:2,b:4,r:8,q:16,k:32},x=["n",u,c,f],S=n(n({},d,m.KSIDE_CASTLE),f,m.QSIDE_CASTLE),E={w:[{square:g.a1,flag:m.QSIDE_CASTLE},{square:g.h1,flag:m.KSIDE_CASTLE}],b:[{square:g.a8,flag:m.QSIDE_CASTLE},{square:g.h8,flag:m.KSIDE_CASTLE}]},C={b:1,w:6},A=["1-0","0-1","1/2-1/2","*"];function P(e){return e>>4}function N(e){return 15&e}function T(e){return-1!=="0123456789".indexOf(e)}function O(e){var t=N(e),r=P(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(r,r+1)}function q(e){return e===a?s:a}function I(e,t,r,n,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:m.NORMAL,s=P(n);if(o!==l||7!==s&&0!==s)e.push({color:t,from:r,to:n,piece:o,captured:i,flags:a});else for(var u=0;u<x.length;u++){var c=x[u];e.push({color:t,from:r,to:n,piece:o,captured:i,promotion:c,flags:a|m.PROMOTION})}}function L(e){var t=e.charAt(0);if(t>="a"&&t<="h"){if(e.match(/[a-h]\d.*[a-h]\d/))return;return l}return"o"===(t=t.toLowerCase())?d:t}function j(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function R(e){return e.split(" ").slice(0,4).join(" ")}var M,D,z,U,K,F,Q,B,G,H,W,Y,X,J,V,Z,ee,te,re,ne,oe,ie,ae,se,le,ue,ce,fe,de,he,pe,ve,me,ge,be,ye,we,_e,ke,xe,Se,Ee,Ce,Ae,Pe,Ne,Te=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n(this,"_board",new Array(128)),n(this,"_turn",a),n(this,"_header",{}),n(this,"_kings",{w:p,b:p}),n(this,"_epSquare",-1),n(this,"_halfMoves",0),n(this,"_moveNumber",0),n(this,"_history",[]),n(this,"_comments",{}),n(this,"_castling",{w:0,b:0}),n(this,"_positionCount",{}),this.load(t)},o=[{key:"clear",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).preserveHeaders,t=void 0!==e&&e;this._board=new Array(128),this._kings={w:p,b:p},this._turn=a,this._castling={w:0,b:0},this._epSquare=p,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{},this._positionCount={},delete this._header.SetUp,delete this._header.FEN}},{key:"removeHeader",value:function(e){e in this._header&&delete this._header[e]}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.skipValidation,n=void 0!==r&&r,o=t.preserveHeaders,i=void 0!==o&&o,l=e.split(/\s+/);if(l.length>=2&&l.length<6&&(e=l.concat(["-","-","0","1"].slice(-(6-l.length))).join(" ")),l=e.split(/\s+/),!n){var u=function(e){var t=e.split(/\s+/);if(6!==t.length)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};var r=parseInt(t[5],10);if(isNaN(r)||r<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};var n=parseInt(t[4],10);if(isNaN(n)||n<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};var o=t[0].split("/");if(8!==o.length)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(var i=0;i<o.length;i++){for(var a=0,s=!1,l=0;l<o[i].length;l++)if(T(o[i][l])){if(s)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};a+=parseInt(o[i][l],10),s=!0}else{if(!/^[prnbqkPRNBQK]$/.test(o[i][l]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};a+=1,s=!1}if(8!==a)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if("3"==t[3][1]&&"w"==t[1]||"6"==t[3][1]&&"b"==t[1])return{ok:!1,error:"Invalid FEN: illegal en-passant square"};for(var u=0,c=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];u<c.length;u++){var f=c[u],d=f.color,h=f.regex;if(!h.test(t[0]))return{ok:!1,error:"Invalid FEN: missing ".concat(d," king")};if((t[0].match(h)||[]).length>1)return{ok:!1,error:"Invalid FEN: too many ".concat(d," kings")}}return Array.from(o[0]+o[7]).some((function(e){return"P"===e.toUpperCase()}))?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}(e),c=u.ok,f=u.error;if(!c)throw new Error(f)}var d=l[0],h=0;this.clear({preserveHeaders:i});for(var v=0;v<d.length;v++){var b=d.charAt(v);if("/"===b)h+=8;else if(T(b))h+=parseInt(b,10);else{var y=b<"a"?a:s;this._put({type:b.toLowerCase(),color:y},O(h)),h++}}this._turn=l[1],l[2].indexOf("K")>-1&&(this._castling.w|=m.KSIDE_CASTLE),l[2].indexOf("Q")>-1&&(this._castling.w|=m.QSIDE_CASTLE),l[2].indexOf("k")>-1&&(this._castling.b|=m.KSIDE_CASTLE),l[2].indexOf("q")>-1&&(this._castling.b|=m.QSIDE_CASTLE),this._epSquare="-"===l[3]?p:g[l[3]],this._halfMoves=parseInt(l[4],10),this._moveNumber=parseInt(l[5],10),this._updateSetup(e),this._incPositionCount(e)}},{key:"fen",value:function(){for(var e=0,t="",r=g.a8;r<=g.h1;r++){if(this._board[r]){e>0&&(t+=e,e=0);var n=this._board[r],o=n.color,i=n.type;t+=o===a?i.toUpperCase():i.toLowerCase()}else e++;r+1&136&&(e>0&&(t+=e),r!==g.h1&&(t+="/"),e=0,r+=8)}var u="";this._castling[a]&m.KSIDE_CASTLE&&(u+="K"),this._castling[a]&m.QSIDE_CASTLE&&(u+="Q"),this._castling[s]&m.KSIDE_CASTLE&&(u+="k"),this._castling[s]&m.QSIDE_CASTLE&&(u+="q"),u=u||"-";var c="-";if(this._epSquare!==p)for(var f=this._epSquare+(this._turn===a?16:-16),d=0,h=[f+1,f-1];d<h.length;d++){var v,b,y=h[d];if(!(136&y)){var w=this._turn;if((null===(v=this._board[y])||void 0===v?void 0:v.color)===w&&(null===(b=this._board[y])||void 0===b?void 0:b.type)===l){this._makeMove({color:w,from:y,to:this._epSquare,piece:l,captured:l,flags:m.EP_CAPTURE});var _=!this._isKingAttacked(w);if(this._undoMove(),_){c=O(this._epSquare);break}}}}return[t,this._turn,u,c,this._halfMoves,this._moveNumber].join(" ")}},{key:"_updateSetup",value:function(e){this._history.length>0||(e!==h?(this._header.SetUp="1",this._header.FEN=e):(delete this._header.SetUp,delete this._header.FEN))}},{key:"reset",value:function(){this.load(h)}},{key:"get",value:function(e){return this._board[g[e]]||!1}},{key:"put",value:function(e,t){var r=e.type,n=e.color;return!!this._put({type:r,color:n},t)&&(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0)}},{key:"_put",value:function(e,t){var r=e.type,n=e.color;if(-1==="pnbrqkPNBRQK".indexOf(r.toLowerCase()))return!1;if(!(t in g))return!1;var o=g[t];if(r==d&&this._kings[n]!=p&&this._kings[n]!=o)return!1;var i=this._board[o];return i&&i.type===d&&(this._kings[i.color]=p),this._board[o]={type:r,color:n},r===d&&(this._kings[n]=o),!0}},{key:"remove",value:function(e){var t=this.get(e);return delete this._board[g[e]],t&&t.type===d&&(this._kings[t.color]=p),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}},{key:"_updateCastlingRights",value:function(){var e,t,r,n,o,i,l,u,f,h,p,v,b=(null===(e=this._board[g.e1])||void 0===e?void 0:e.type)===d&&(null===(t=this._board[g.e1])||void 0===t?void 0:t.color)===a,y=(null===(r=this._board[g.e8])||void 0===r?void 0:r.type)===d&&(null===(n=this._board[g.e8])||void 0===n?void 0:n.color)===s;b&&(null===(o=this._board[g.a1])||void 0===o?void 0:o.type)===c&&(null===(i=this._board[g.a1])||void 0===i?void 0:i.color)===a||(this._castling.w&=~m.QSIDE_CASTLE),b&&(null===(l=this._board[g.h1])||void 0===l?void 0:l.type)===c&&(null===(u=this._board[g.h1])||void 0===u?void 0:u.color)===a||(this._castling.w&=~m.KSIDE_CASTLE),y&&(null===(f=this._board[g.a8])||void 0===f?void 0:f.type)===c&&(null===(h=this._board[g.a8])||void 0===h?void 0:h.color)===s||(this._castling.b&=~m.QSIDE_CASTLE),y&&(null===(p=this._board[g.h8])||void 0===p?void 0:p.type)===c&&(null===(v=this._board[g.h8])||void 0===v?void 0:v.color)===s||(this._castling.b&=~m.KSIDE_CASTLE)}},{key:"_updateEnPassantSquare",value:function(){var e,t,r=this;if(this._epSquare!==p){var n=this._epSquare+(this._turn===a?-16:16),o=this._epSquare+(this._turn===a?16:-16),i=[o+1,o-1];null===this._board[n]&&null===this._board[this._epSquare]&&(null===(e=this._board[o])||void 0===e?void 0:e.color)===q(this._turn)&&(null===(t=this._board[o])||void 0===t?void 0:t.type)===l&&i.some((function(e){var t,n;return!(136&e)&&(null===(t=r._board[e])||void 0===t?void 0:t.color)===r._turn&&(null===(n=r._board[e])||void 0===n?void 0:n.type)===l}))||(this._epSquare=p)}}},{key:"_attacked",value:function(e,t){for(var r=g.a8;r<=g.h1;r++)if(136&r)r+=7;else if(void 0!==this._board[r]&&this._board[r].color===e){var n=this._board[r],o=r-t;if(0!==o){var i=o+119;if(w[i]&k[n.type]){if(n.type===l){if(o>0){if(n.color===a)return!0}else if(n.color===s)return!0;continue}if("n"===n.type||"k"===n.type)return!0;for(var u=_[i],c=r+u,f=!1;c!==t;){if(null!=this._board[c]){f=!0;break}c+=u}if(!f)return!0}}}return!1}},{key:"_isKingAttacked",value:function(e){var t=this._kings[e];return-1!==t&&this._attacked(q(e),t)}},{key:"isAttacked",value:function(e,t){return this._attacked(t,g[e])}},{key:"isCheck",value:function(){return this._isKingAttacked(this._turn)}},{key:"inCheck",value:function(){return this.isCheck()}},{key:"isCheckmate",value:function(){return this.isCheck()&&0===this._moves().length}},{key:"isStalemate",value:function(){return!this.isCheck()&&0===this._moves().length}},{key:"isInsufficientMaterial",value:function(){for(var e={b:0,n:0,r:0,q:0,k:0,p:0},t=[],r=0,n=0,o=g.a8;o<=g.h1;o++)if(n=(n+1)%2,136&o)o+=7;else{var i=this._board[o];i&&(e[i.type]=i.type in e?e[i.type]+1:1,i.type===u&&t.push(n),r++)}if(2===r)return!0;if(3===r&&(1===e[u]||1===e.n))return!0;if(r===e[u]+2){for(var a=0,s=t.length,l=0;l<s;l++)a+=t[l];if(0===a||a===s)return!0}return!1}},{key:"isThreefoldRepetition",value:function(){return this._getPositionCount(this.fen())>=3}},{key:"isDraw",value:function(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}},{key:"isGameOver",value:function(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}},{key:"moves",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.verbose,n=void 0!==r&&r,o=t.square,i=void 0===o?void 0:o,a=t.piece,s=void 0===a?void 0:a,l=this._moves({square:i,piece:s});return n?l.map((function(t){return e._makePretty(t)})):l.map((function(t){return e._moveToSan(t,l)}))}},{key:"_moves",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.legal,r=void 0===t||t,n=e.piece,o=void 0===n?void 0:n,i=e.square,a=void 0===i?void 0:i,s=a?a.toLowerCase():void 0,u=null==o?void 0:o.toLowerCase(),c=[],f=this._turn,h=q(f),p=g.a8,v=g.h1,w=!1;if(s){if(!(s in g))return[];p=v=g[s],w=!0}for(var _=p;_<=v;_++)if(136&_)_+=7;else if(this._board[_]&&this._board[_].color!==h){var k=this._board[_].type,x=void 0;if(k===l){if(u&&u!==k)continue;x=_+b[f][0],this._board[x]||(I(c,f,_,x,l),x=_+b[f][1],C[f]!==P(_)||this._board[x]||I(c,f,_,x,l,void 0,m.BIG_PAWN));for(var S=2;S<4;S++){var E;136&(x=_+b[f][S])||((null===(E=this._board[x])||void 0===E?void 0:E.color)===h?I(c,f,_,x,l,this._board[x].type,m.CAPTURE):x===this._epSquare&&I(c,f,_,x,l,l,m.EP_CAPTURE))}}else{if(u&&u!==k)continue;for(var A=0,N=y[k].length;A<N;A++){var T=y[k][A];for(x=_;!(136&(x+=T));){if(this._board[x]){if(this._board[x].color===f)break;I(c,f,_,x,k,this._board[x].type,m.CAPTURE);break}if(I(c,f,_,x,k),"n"===k||k===d)break}}}}if(!(void 0!==u&&u!==d||w&&v!==this._kings[f])){if(this._castling[f]&m.KSIDE_CASTLE){var O=this._kings[f],L=O+2;this._board[O+1]||this._board[L]||this._attacked(h,this._kings[f])||this._attacked(h,O+1)||this._attacked(h,L)||I(c,f,this._kings[f],L,d,void 0,m.KSIDE_CASTLE)}if(this._castling[f]&m.QSIDE_CASTLE){var j=this._kings[f],R=j-2;this._board[j-1]||this._board[j-2]||this._board[j-3]||this._attacked(h,this._kings[f])||this._attacked(h,j-1)||this._attacked(h,R)||I(c,f,this._kings[f],R,d,void 0,m.QSIDE_CASTLE)}}if(!r||-1===this._kings[f])return c;for(var M=[],D=0,z=c.length;D<z;D++)this._makeMove(c[D]),this._isKingAttacked(f)||M.push(c[D]),this._undoMove();return M}},{key:"move",value:function(e){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).strict,n=void 0!==r&&r,o=null;if("string"==typeof e)o=this._moveFromSan(e,n);else if("object"===t(e))for(var i=this._moves(),a=0,s=i.length;a<s;a++)if(e.from===O(i[a].from)&&e.to===O(i[a].to)&&(!("promotion"in i[a])||e.promotion===i[a].promotion)){o=i[a];break}if(!o)throw"string"==typeof e?new Error("Invalid move: ".concat(e)):new Error("Invalid move: ".concat(JSON.stringify(e)));var l=this._makePretty(o);return this._makeMove(o),this._incPositionCount(l.after),l}},{key:"_push",value:function(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}},{key:"_makeMove",value:function(e){var t=this._turn,r=q(t);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&m.EP_CAPTURE&&(this._turn===s?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:t}),this._board[e.to].type===d){if(this._kings[t]=e.to,e.flags&m.KSIDE_CASTLE){var n=e.to-1,o=e.to+1;this._board[n]=this._board[o],delete this._board[o]}else if(e.flags&m.QSIDE_CASTLE){var i=e.to+1,a=e.to-2;this._board[i]=this._board[a],delete this._board[a]}this._castling[t]=0}if(this._castling[t])for(var u=0,c=E[t].length;u<c;u++)if(e.from===E[t][u].square&&this._castling[t]&E[t][u].flag){this._castling[t]^=E[t][u].flag;break}if(this._castling[r])for(var f=0,h=E[r].length;f<h;f++)if(e.to===E[r][f].square&&this._castling[r]&E[r][f].flag){this._castling[r]^=E[r][f].flag;break}e.flags&m.BIG_PAWN?this._epSquare=t===s?e.to-16:e.to+16:this._epSquare=p,e.piece===l||e.flags&(m.CAPTURE|m.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===s&&this._moveNumber++,this._turn=r}},{key:"undo",value:function(){var e=this._undoMove();if(e){var t=this._makePretty(e);return this._decPositionCount(t.after),t}return null}},{key:"_undoMove",value:function(){var e=this._history.pop();if(void 0===e)return null;var t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;var r,n,o,i=this._turn,a=q(i);return this._board[t.from]=this._board[t.to],this._board[t.from].type=t.piece,delete this._board[t.to],t.captured&&(t.flags&m.EP_CAPTURE?(r=i===s?t.to-16:t.to+16,this._board[r]={type:l,color:a}):this._board[t.to]={type:t.captured,color:a}),t.flags&(m.KSIDE_CASTLE|m.QSIDE_CASTLE)&&(t.flags&m.KSIDE_CASTLE?(n=t.to+1,o=t.to-1):(n=t.to-2,o=t.to+1),this._board[n]=this._board[o],delete this._board[o]),t}},{key:"pgn",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.newline,n=void 0===r?"\n":r,o=t.maxWidth,a=void 0===o?0:o,s=[],l=!1;for(var u in this._header)s.push("["+u+' "'+this._header[u]+'"]'+n),l=!0;l&&this._history.length&&s.push(n);for(var c=function(t){var r=e._comments[e.fen()];if(void 0!==r){var n=t.length>0?" ":"";t="".concat(t).concat(n,"{").concat(r,"}")}return t},f=[];this._history.length>0;)f.push(this._undoMove());var d=[],h="";for(0===f.length&&d.push(c(""));f.length>0;){h=c(h);var p=f.pop();if(!p)break;if(this._history.length||"b"!==p.color)"w"===p.color&&(h.length&&d.push(h),h=this._moveNumber+".");else{var v="".concat(this._moveNumber,". ...");h=h?"".concat(h," ").concat(v):v}h=h+" "+this._moveToSan(p,this._moves({legal:!0})),this._makeMove(p)}if(h.length&&d.push(c(h)),void 0!==this._header.Result&&d.push(this._header.Result),0===a)return s.join("")+d.join(" ");for(var m=function(){return s.length>0&&" "===s[s.length-1]&&(s.pop(),!0)},g=function(e,t){var r,o=i(t.split(" "));try{for(o.s();!(r=o.n()).done;){var l=r.value;if(l){if(e+l.length>a){for(;m();)e--;s.push(n),e=0}s.push(l),e+=l.length,s.push(" "),e++}}}catch(u){o.e(u)}finally{o.f()}return m()&&e--,e},b=0,y=0;y<d.length;y++)b+d[y].length>a&&d[y].includes("{")?b=g(b,d[y]):(b+d[y].length>a&&0!==y?(" "===s[s.length-1]&&s.pop(),s.push(n),b=0):0!==y&&(s.push(" "),b++),s.push(d[y]),b+=d[y].length);return s.join("")}},{key:"header",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0;n<t.length;n+=2)"string"==typeof t[n]&&"string"==typeof t[n+1]&&(this._header[t[n]]=t[n+1]);return this._header}},{key:"loadPgn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.strict,n=void 0!==r&&r,o=t.newlineChar,i=void 0===o?"\r?\n":o;function a(e){return e.replace(/\\/g,"\\")}e=e.trim();var s=new RegExp("^(\\[((?:"+a(i)+")|.)*\\])((?:\\s*"+a(i)+"){2}|(?:\\s*"+a(i)+")*$)").exec(e),l=s&&s.length>=2?s[1]:"";this.reset();var u=function(e){for(var t={},r=e.split(new RegExp(a(i))),n="",o="",s=0;s<r.length;s++){var l=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;n=r[s].replace(l,"$1"),o=r[s].replace(l,"$2"),n.trim().length>0&&(t[n]=o)}return t}(l),c="";for(var f in u)"fen"===f.toLowerCase()&&(c=u[f]),this.header(f,u[f]);if(n){if("1"===u.SetUp){if(!("FEN"in u))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(u.FEN,{preserveHeaders:!0})}}else c&&this.load(c,{preserveHeaders:!0});for(var d=function(e){return e=e.replace(new RegExp(a(i),"g")," "),"{".concat(function(e){return Array.from(e).map((function(e){return e.charCodeAt(0)<128?e.charCodeAt(0).toString(16):encodeURIComponent(e).replace(/%/g,"").toLowerCase()})).join("")}(e.slice(1,e.length-1)),"}")},h=function(e){if(e.startsWith("{")&&e.endsWith("}"))return function(e){return 0==e.length?"":decodeURIComponent("%"+(e.match(/.{1,2}/g)||[]).join("%"))}(e.slice(1,e.length-1))},p=e.replace(l,"").replace(new RegExp("({[^}]*})+?|;([^".concat(a(i),"]*)"),"g"),(function(e,t,r){return void 0!==t?d(t):" "+d("{".concat(r.slice(1),"}"))})).replace(new RegExp(a(i),"g")," "),v=/(\([^()]+\))+?/g;v.test(p);)p=p.replace(v,"");var m=(p=(p=(p=p.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).trim().split(new RegExp(/\s+/));m=m.filter((function(e){return""!==e}));for(var g="",b=0;b<m.length;b++){var y=h(m[b]);if(void 0===y){var w=this._moveFromSan(m[b],n);if(null==w){if(!(A.indexOf(m[b])>-1))throw new Error("Invalid move in PGN: ".concat(m[b]));g=m[b]}else g="",this._makeMove(w),this._incPositionCount(this.fen())}else this._comments[this.fen()]=y}g&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",g)}},{key:"_moveToSan",value:function(e,t){var r="";if(e.flags&m.KSIDE_CASTLE)r="O-O";else if(e.flags&m.QSIDE_CASTLE)r="O-O-O";else{if(e.piece!==l){var n=function(e,t){for(var r=e.from,n=e.to,o=e.piece,i=0,a=0,s=0,l=0,u=t.length;l<u;l++){var c=t[l].from,f=t[l].to;o===t[l].piece&&r!==c&&n===f&&(i++,P(r)===P(c)&&a++,N(r)===N(c)&&s++)}return i>0?a>0&&s>0?O(r):s>0?O(r).charAt(1):O(r).charAt(0):""}(e,t);r+=e.piece.toUpperCase()+n}e.flags&(m.CAPTURE|m.EP_CAPTURE)&&(e.piece===l&&(r+=O(e.from)[0]),r+="x"),r+=O(e.to),e.promotion&&(r+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?r+="#":r+="+"),this._undoMove(),r}},{key:"_moveFromSan",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=j(e),n=L(r),o=this._moves({legal:!0,piece:n}),i=0,a=o.length;i<a;i++)if(r===j(this._moveToSan(o[i],o)))return o[i];if(t)return null;var s=void 0,l=void 0,u=void 0,c=void 0,f=void 0,d=!1;if(((l=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/))||(l=r.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/)))&&(s=l[1],u=l[2],c=l[3],f=l[4],1==u.length&&(d=!0)),n=L(r),o=this._moves({legal:!0,piece:s||n}),!c)return null;for(var h=0,p=o.length;h<p;h++)if(u){if(!(s&&s.toLowerCase()!=o[h].piece||g[u]!=o[h].from||g[c]!=o[h].to||f&&f.toLowerCase()!=o[h].promotion))return o[h];if(d){var v=O(o[h].from);if(!(s&&s.toLowerCase()!=o[h].piece||g[c]!=o[h].to||u!=v[0]&&u!=v[1]||f&&f.toLowerCase()!=o[h].promotion))return o[h]}}else if(r===j(this._moveToSan(o[h],o)).replace("x",""))return o[h];return null}},{key:"ascii",value:function(){for(var e="   +------------------------+\n",t=g.a8;t<=g.h1;t++){if(0===N(t)&&(e+=" "+"87654321"[P(t)]+" |"),this._board[t]){var r=this._board[t].type;e+=" "+(this._board[t].color===a?r.toUpperCase():r.toLowerCase())+" "}else e+=" . ";t+1&136&&(e+="|\n",t+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h"}},{key:"perft",value:function(e){for(var t=this._moves({legal:!1}),r=0,n=this._turn,o=0,i=t.length;o<i;o++)this._makeMove(t[o]),this._isKingAttacked(n)||(e-1>0?r+=this.perft(e-1):r++),this._undoMove();return r}},{key:"_makePretty",value:function(e){var t=e.color,r=e.piece,n=e.from,o=e.to,i=e.flags,a=e.captured,s=e.promotion,l="";for(var u in m)m[u]&i&&(l+=v[u]);var c=O(n),f=O(o),d={color:t,piece:r,from:c,to:f,san:this._moveToSan(e,this._moves({legal:!0})),flags:l,lan:c+f,before:this.fen(),after:""};return this._makeMove(e),d.after=this.fen(),this._undoMove(),a&&(d.captured=a),s&&(d.promotion=s,d.lan+=s),d}},{key:"turn",value:function(){return this._turn}},{key:"board",value:function(){for(var e=[],t=[],r=g.a8;r<=g.h1;r++)null==this._board[r]?t.push(null):t.push({square:O(r),type:this._board[r].type,color:this._board[r].color}),r+1&136&&(e.push(t),t=[],r+=8);return e}},{key:"squareColor",value:function(e){if(e in g){var t=g[e];return(P(t)+N(t))%2==0?"light":"dark"}return null}},{key:"history",value:function(){for(var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).verbose,t=void 0!==e&&e,r=[],n=[];this._history.length>0;)r.push(this._undoMove());for(;;){var o=r.pop();if(!o)break;t?n.push(this._makePretty(o)):n.push(this._moveToSan(o,this._moves())),this._makeMove(o)}return n}},{key:"_getPositionCount",value:function(e){var t=R(e);return this._positionCount[t]||0}},{key:"_incPositionCount",value:function(e){var t=R(e);void 0===this._positionCount[t]&&(this._positionCount[t]=0),this._positionCount[t]+=1}},{key:"_decPositionCount",value:function(e){var t=R(e);1===this._positionCount[t]?delete this._positionCount[t]:this._positionCount[t]-=1}},{key:"_pruneComments",value:function(){for(var e=this,t=[],r={},n=function(t){t in e._comments&&(r[t]=e._comments[t])};this._history.length>0;)t.push(this._undoMove());for(n(this.fen());;){var o=t.pop();if(!o)break;this._makeMove(o),n(this.fen())}this._comments=r}},{key:"getComment",value:function(){return this._comments[this.fen()]}},{key:"setComment",value:function(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}},{key:"deleteComment",value:function(){var e=this._comments[this.fen()];return delete this._comments[this.fen()],e}},{key:"getComments",value:function(){var e=this;return this._pruneComments(),Object.keys(this._comments).map((function(t){return{fen:t,comment:e._comments[t]}}))}},{key:"deleteComments",value:function(){var e=this;return this._pruneComments(),Object.keys(this._comments).map((function(t){var r=e._comments[t];return delete e._comments[t],{fen:t,comment:r}}))}},{key:"setCastlingRights",value:function(e,t){for(var r=0,n=[d,f];r<n.length;r++){var o=n[r];void 0!==t[o]&&(t[o]?this._castling[e]|=S[o]:this._castling[e]&=~S[o])}this._updateCastlingRights();var i=this.getCastlingRights(e);return!(void 0!==t[d]&&t[d]!==i[d]||void 0!==t[f]&&t[f]!==i[f])}},{key:"getCastlingRights",value:function(e){return n(n({},d,!!(this._castling[e]&S[d])),f,!!(this._castling[e]&S[f]))}},{key:"moveNumber",value:function(){return this._moveNumber}}],o&&r(e.prototype,o),x&&r(e,x),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,o,x}(),Oe={whiteAddr:void 0,whiteName:void 0,blackAddr:void 0,blackName:void 0,request:void 0,surrenderAddr:void 0,lastMove:void 0,inReplayMode:!1,board:void 0,game:new Te};function qe(e){return e.length>16?e.substring(0,16)+"…":e}function Ie(){var e,t=qe("w"===Oe.game.turn()?Oe.whiteName:Oe.blackName);if(Oe.game.isCheckmate()){var r=qe("b"===Oe.game.turn()?Oe.whiteName:Oe.blackName);e="Checkmate! ".concat(r," wins 🎉")}else if(Oe.surrenderAddr){var n="b"===Oe.game.turn()?qe(Oe.whiteName):qe(Oe.blackName);e="".concat(t," surrenders, ").concat(n," wins 🎉")}else Oe.game.isDraw()?e="Game over, it is a draw! 🤝":(e="Turn: ".concat(t),Oe.game.inCheck()&&(e+=" (in check!)"));return e}function Le(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function je(){if(D)return M;function e(e,t,r,n,o,i){return{tag:e,key:t,attrs:r,children:n,text:o,dom:i,domSize:void 0,state:void 0,events:void 0,instance:void 0}}return D=1,e.normalize=function(r){return Array.isArray(r)?e("[",void 0,void 0,e.normalizeChildren(r),void 0,void 0):null==r||"boolean"==typeof r?null:"object"===t(r)?r:e("#",void 0,void 0,String(r),void 0,void 0)},e.normalizeChildren=function(t){var r=[];if(t.length){for(var n=null!=t[0]&&null!=t[0].key,o=1;o<t.length;o++)if((null!=t[o]&&null!=t[o].key)!==n)throw new TypeError(!n||null==t[o]&&"boolean"!=typeof t[o]?"In fragments, vnodes must either all have keys or none have keys.":"In fragments, vnodes must either all have keys or none have keys. You may wish to consider using an explicit keyed empty fragment, m.fragment({key: ...}), instead of a hole.");for(o=0;o<t.length;o++)r[o]=e.normalize(t[o])}return r},M=e}function Re(){if(U)return z;U=1;var e=je();return z=function(){var r,n=arguments[this],o=this+1;if(null==n?n={}:("object"!==t(n)||null!=n.tag||Array.isArray(n))&&(n={},o=this),arguments.length===o+1)r=arguments[o],Array.isArray(r)||(r=[r]);else for(r=[];o<arguments.length;)r.push(arguments[o++]);return e("",n.key,n,r)},z}function Me(){return F?K:(F=1,K={}.hasOwnProperty)}function De(){if(B)return Q;B=1;var e=je(),t=Re(),r=Me(),n=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,o=Object.create(null);function i(e){for(var t,i="div",a=[],s={};t=n.exec(e);){var l=t[1],u=t[2];if(""===l&&""!==u)i=u;else if("#"===l)s.id=u;else if("."===l)a.push(u);else if("["===t[3][0]){var c=t[6];c&&(c=c.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),"class"===t[4]?a.push(c):s[t[4]]=""===c?c:c||!0}}return a.length>0&&(s.className=a.join(" ")),function(e){for(var t in e)if(r.call(e,t))return!1;return!0}(s)&&(s=null),o[e]={tag:i,attrs:s}}return Q=function(n){if(null==n||"string"!=typeof n&&"function"!=typeof n&&"function"!=typeof n.view)throw Error("The selector must be either a string or a component.");var a=t.apply(1,arguments);return"string"==typeof n&&(a.children=e.normalizeChildren(a.children),"["!==n)?function(e,t){var n=t.attrs,o=r.call(n,"class"),i=o?n.class:n.className;return t.tag=e.tag,null!=e.attrs?(n=Object.assign({},e.attrs,n),null==i&&null==e.attrs.className||(n.className=null!=i?null!=e.attrs.className?String(e.attrs.className)+" "+String(i):i:null!=e.attrs.className?e.attrs.className:null)):null!=i&&(n.className=i),o&&(n.class=null),"input"===e.tag&&r.call(n,"type")&&(n=Object.assign({type:n.type},n)),t.attrs=n,t}(o[n]||i(n),a):(a.tag=n,a)},Q}function ze(){if(J)return X;J=1;var e=De();return e.trust=function(){if(H)return G;H=1;var e=je();return G=function(t){return null==t&&(t=""),e("<",void 0,void 0,t,void 0,void 0)}}(),e.fragment=function(){if(Y)return W;Y=1;var e=je(),t=Re();return W=function(){var r=t.apply(0,arguments);return r.tag="[",r.children=e.normalizeChildren(r.children),r},W}(),X=e}function Ue(){if(Z)return V;Z=1;var t=new WeakMap;return V={delayedRemoval:t,domFor:function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e().mark((function o(){var i,a,s,l;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.dom,a=r.domSize,s=n.generation,null==i){e.next=11;break}case 4:if(l=i.nextSibling,t.get(i)!==s){e.next=9;break}return e.next=8,i;case 8:a--;case 9:i=l;case 10:if(a){e.next=4;break}case 11:case"end":return e.stop()}}),o)}))()}},V}function Ke(){if(te)return ee;te=1;var e=je(),r=Ue(),n=r.delayedRemoval,o=r.domFor;return ee=function(){var r,a,s={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function l(e){return e.ownerDocument}function u(e){return e.attrs&&e.attrs.xmlns||s[e.tag]}function c(e,t){if(e.state!==t)throw new Error("'vnode.state' must not be modified.")}function f(e){var t=e.state;try{return this.apply(t,arguments)}finally{c(e,t)}}function d(e){try{return l(e).activeElement}catch(t){return null}}function h(e,t,r,n,o,i,a){for(var s=r;s<n;s++){var l=t[s];null!=l&&p(e,l,o,a,i)}}function p(t,r,n,o,i){var a=r.tag;if("string"==typeof a)switch(r.state={},null!=r.attrs&&M(r.attrs,r,n),a){case"#":!function(e,t,r){t.dom=l(e).createTextNode(t.children),S(e,t.dom,r)}(t,r,i);break;case"<":m(t,r,o,i);break;case"[":!function(e,t,r,n,o){var i=l(e).createDocumentFragment();if(null!=t.children){var a=t.children;h(i,a,0,a.length,r,null,n)}t.dom=i.firstChild,t.domSize=i.childNodes.length,S(e,i,o)}(t,r,n,o,i);break;default:!function(e,t,r,n,o){var i=t.tag,a=t.attrs,s=a&&a.is;n=u(t)||n;var c=n?s?l(e).createElementNS(n,i,{is:s}):l(e).createElementNS(n,i):s?l(e).createElement(i,{is:s}):l(e).createElement(i);t.dom=c,null!=a&&function(e,t,r){for(var n in t)T(e,n,null,t[n],r)}(t,a,n);if(S(e,c,o),!E(t)&&null!=t.children){var f=t.children;h(c,f,0,f.length,r,null,n),"select"===t.tag&&null!=a&&function(e,t){if("value"in t)if(null===t.value)-1!==e.dom.selectedIndex&&(e.dom.value=null);else{var r=""+t.value;e.dom.value===r&&-1!==e.dom.selectedIndex||(e.dom.value=r)}"selectedIndex"in t&&T(e,"selectedIndex",null,t.selectedIndex,void 0)}(t,a)}}(t,r,n,o,i)}else!function(t,r,n,o,i){(function(t,r){var n;if("function"==typeof t.tag.view){if(t.state=Object.create(t.tag),null!=(n=t.state.view).$$reentrantLock$$)return;n.$$reentrantLock$$=!0}else{if(t.state=void 0,null!=(n=t.tag).$$reentrantLock$$)return;n.$$reentrantLock$$=!0,t.state=null!=t.tag.prototype&&"function"==typeof t.tag.prototype.view?new t.tag(t):t.tag(t)}M(t.state,t,r),null!=t.attrs&&M(t.attrs,t,r);if(t.instance=e.normalize(f.call(t.state.view,t)),t.instance===t)throw Error("A view cannot return the vnode it received as argument");n.$$reentrantLock$$=null})(r,n),null!=r.instance?(p(t,r.instance,n,o,i),r.dom=r.instance.dom,r.domSize=null!=r.dom?r.instance.domSize:0):r.domSize=0}(t,r,n,o,i)}var v={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function m(e,t,r,n){var o=t.children.match(/^\s*?<(\w+)/im)||[],i=l(e).createElement(v[o[1]]||"div");"http://www.w3.org/2000/svg"===r?(i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+t.children+"</svg>",i=i.firstChild):i.innerHTML=t.children,t.dom=i.firstChild,t.domSize=i.childNodes.length;for(var a,s=l(e).createDocumentFragment();a=i.firstChild;)s.appendChild(a);S(e,s,n)}function g(e,t,r,n,o,i){if(t!==r&&(null!=t||null!=r))if(null==t||0===t.length)h(e,r,0,r.length,n,o,i);else if(null==r||0===r.length)C(e,t,0,t.length);else{var a=null!=t[0]&&null!=t[0].key,s=null!=r[0]&&null!=r[0].key,l=0,u=0;if(!a)for(;u<t.length&&null==t[u];)u++;if(!s)for(;l<r.length&&null==r[l];)l++;if(a!==s)C(e,t,u,t.length),h(e,r,l,r.length,n,o,i);else if(s){for(var c,f,d,v,m,g=t.length-1,w=r.length-1;g>=u&&w>=l&&(d=t[g],v=r[w],d.key===v.key);)d!==v&&b(e,d,v,n,o,i),null!=v.dom&&(o=v.dom),g--,w--;for(;g>=u&&w>=l&&(c=t[u],f=r[l],c.key===f.key);)u++,l++,c!==f&&b(e,c,f,n,k(t,u,o),i);for(;g>=u&&w>=l&&l!==w&&c.key===v.key&&d.key===f.key;)x(e,d,m=k(t,u,o)),d!==f&&b(e,d,f,n,m,i),++l<=--w&&x(e,c,o),c!==v&&b(e,c,v,n,o,i),null!=v.dom&&(o=v.dom),u++,d=t[--g],v=r[w],c=t[u],f=r[l];for(;g>=u&&w>=l&&d.key===v.key;)d!==v&&b(e,d,v,n,o,i),null!=v.dom&&(o=v.dom),w--,d=t[--g],v=r[w];if(l>w)C(e,t,u,g+1);else if(u>g)h(e,r,l,w+1,n,o,i);else{var S,E,P=o,N=w-l+1,T=new Array(N),O=0,q=0,I=2147483647,L=0;for(q=0;q<N;q++)T[q]=-1;for(q=w;q>=l;q--){null==S&&(S=y(t,u,g+1));var j=S[(v=r[q]).key];null!=j&&(I=j<I?j:-1,T[q-l]=j,d=t[j],t[j]=null,d!==v&&b(e,d,v,n,o,i),null!=v.dom&&(o=v.dom),L++)}if(o=P,L!==g-u+1&&C(e,t,u,g+1),0===L)h(e,r,l,w+1,n,o,i);else if(-1===I)for(E=function(e){var t=[0],r=0,n=0,o=0,i=_.length=e.length;for(o=0;o<i;o++)_[o]=e[o];for(o=0;o<i;++o)if(-1!==e[o]){var a=t[t.length-1];if(e[a]<e[o])_[o]=a,t.push(o);else{for(r=0,n=t.length-1;r<n;){var s=(r>>>1)+(n>>>1)+(r&n&1);e[t[s]]<e[o]?r=s+1:n=s}e[o]<e[t[r]]&&(r>0&&(_[o]=t[r-1]),t[r]=o)}}r=t.length,n=t[r-1];for(;r-- >0;)t[r]=n,n=_[n];return _.length=0,t}(T),O=E.length-1,q=w;q>=l;q--)f=r[q],-1===T[q-l]?p(e,f,n,i,o):E[O]===q-l?O--:x(e,f,o),null!=f.dom&&(o=r[q].dom);else for(q=w;q>=l;q--)f=r[q],-1===T[q-l]&&p(e,f,n,i,o),null!=f.dom&&(o=r[q].dom)}}else{var R=t.length<r.length?t.length:r.length;for(l=l<u?l:u;l<R;l++)(c=t[l])===(f=r[l])||null==c&&null==f||(null==c?p(e,f,n,i,k(t,l+1,o)):null==f?A(e,c):b(e,c,f,n,k(t,l+1,o),i));t.length>R&&C(e,t,l,t.length),r.length>R&&h(e,r,l,r.length,n,o,i)}}}function b(t,r,n,o,i,a){var s=r.tag;if(s===n.tag){if(n.state=r.state,n.events=r.events,function(e,t){do{var r;if(null!=e.attrs&&"function"==typeof e.attrs.onbeforeupdate)if(void 0!==(r=f.call(e.attrs.onbeforeupdate,e,t))&&!r)break;if("string"!=typeof e.tag&&"function"==typeof e.state.onbeforeupdate)if(void 0!==(r=f.call(e.state.onbeforeupdate,e,t))&&!r)break;return!1}while(0);return e.dom=t.dom,e.domSize=t.domSize,e.instance=t.instance,e.attrs=t.attrs,e.children=t.children,e.text=t.text,!0}(n,r))return;if("string"==typeof s)switch(null!=n.attrs&&D(n.attrs,n,o),s){case"#":!function(e,t){e.children.toString()!==t.children.toString()&&(e.dom.nodeValue=t.children);t.dom=e.dom}(r,n);break;case"<":!function(e,t,r,n,o){t.children!==r.children?(P(e,t,void 0),m(e,r,n,o)):(r.dom=t.dom,r.domSize=t.domSize)}(t,r,n,a,i);break;case"[":!function(e,t,r,n,o,i){g(e,t.children,r.children,n,o,i);var a=0,s=r.children;if(r.dom=null,null!=s){for(var l=0;l<s.length;l++){var u=s[l];null!=u&&null!=u.dom&&(null==r.dom&&(r.dom=u.dom),a+=u.domSize||1)}1!==a&&(r.domSize=a)}}(t,r,n,o,i,a);break;default:!function(e,t,r,n){var o=t.dom=e.dom;n=u(t)||n,function(e,t,r,n){t&&t===r&&console.warn("Don't reuse attrs object, use new object for every redraw, this will throw in next major");if(null!=r)for(var o in r)T(e,o,t&&t[o],r[o],n);var i;if(null!=t)for(var o in t)null==(i=t[o])||null!=r&&null!=r[o]||O(e,o,i,n)}(t,e.attrs,t.attrs,n),E(t)||g(o,e.children,t.children,r,null,n)}(r,n,o,a)}else!function(t,r,n,o,i,a){if(n.instance=e.normalize(f.call(n.state.view,n)),n.instance===n)throw Error("A view cannot return the vnode it received as argument");D(n.state,n,o),null!=n.attrs&&D(n.attrs,n,o);null!=n.instance?(null==r.instance?p(t,n.instance,o,a,i):b(t,r.instance,n.instance,o,i,a),n.dom=n.instance.dom,n.domSize=n.instance.domSize):null!=r.instance?(A(t,r.instance),n.dom=void 0,n.domSize=0):(n.dom=r.dom,n.domSize=r.domSize)}(t,r,n,o,i,a)}else A(t,r),p(t,n,o,a,i)}function y(e,t,r){for(var n=Object.create(null);t<r;t++){var o=e[t];if(null!=o){var i=o.key;null!=i&&(n[i]=t)}}return n}var w,_=[];function k(e,t,r){for(;t<e.length;t++)if(null!=e[t]&&null!=e[t].dom)return e[t].dom;return r}function x(e,t,r){if(null!=t.dom){var n;if(null==t.domSize)n=t.dom;else{n=l(e).createDocumentFragment();var a,s=i(o(t));try{for(s.s();!(a=s.n()).done;){var u=a.value;n.appendChild(u)}}catch(c){s.e(c)}finally{s.f()}}S(e,n,r)}}function S(e,t,r){null!=r?e.insertBefore(t,r):e.appendChild(t)}function E(e){if(null==e.attrs||null==e.attrs.contenteditable&&null==e.attrs.contentEditable)return!1;var t=e.children;if(null!=t&&1===t.length&&"<"===t[0].tag){var r=t[0].children;e.dom.innerHTML!==r&&(e.dom.innerHTML=r)}else if(null!=t&&0!==t.length)throw new Error("Child node of a contenteditable must be trusted.");return!0}function C(e,t,r,n){for(var o=r;o<n;o++){var i=t[o];null!=i&&A(e,i)}}function A(e,t){var r,s,l,u,d=0,h=t.state;"string"!=typeof t.tag&&"function"==typeof t.state.onbeforeremove&&(null!=(l=f.call(t.state.onbeforeremove,t))&&"function"==typeof l.then&&(d=1,r=l));t.attrs&&"function"==typeof t.attrs.onbeforeremove&&(null!=(l=f.call(t.attrs.onbeforeremove,t))&&"function"==typeof l.then&&(d|=2,s=l));if(c(t,h),d){u=a;var p,v=i(o(t));try{for(v.s();!(p=v.n()).done;){var m=p.value;n.set(m,u)}}catch(g){v.e(g)}finally{v.f()}null!=r&&r.finally((function(){1&d&&((d&=2)||(c(t,h),N(t),P(e,t,u)))})),null!=s&&s.finally((function(){2&d&&((d&=1)||(c(t,h),N(t),P(e,t,u)))}))}else N(t),P(e,t,u)}function P(e,t,r){if(null!=t.dom)if(null==t.domSize)n.get(t.dom)===r&&e.removeChild(t.dom);else{var a,s=i(o(t,{generation:r}));try{for(s.s();!(a=s.n()).done;){var l=a.value;e.removeChild(l)}}catch(u){s.e(u)}finally{s.f()}}}function N(e){if("string"!=typeof e.tag&&"function"==typeof e.state.onremove&&f.call(e.state.onremove,e),e.attrs&&"function"==typeof e.attrs.onremove&&f.call(e.attrs.onremove,e),"string"!=typeof e.tag)null!=e.instance&&N(e.instance);else{var t=e.children;if(Array.isArray(t))for(var r=0;r<t.length;r++){var n=t[r];null!=n&&N(n)}}}function T(e,r,n,o,i){if("key"!==r&&"is"!==r&&null!=o&&!q(r)&&(n!==o||function(e,t){return"value"===t||"checked"===t||"selectedIndex"===t||"selected"===t&&e.dom===d(e.dom)||"option"===e.tag&&e.dom.parentNode===d(e.dom)}(e,r)||"object"===t(o))){if("o"===r[0]&&"n"===r[1])return R(e,r,o);if("xlink:"===r.slice(0,6))e.dom.setAttributeNS("http://www.w3.org/1999/xlink",r.slice(6),o);else if("style"===r)L(e.dom,n,o);else if(I(e,r,i)){if("value"===r){var a="input"===e.tag&&"file"===e.attrs.type;if(("input"===e.tag||"textarea"===e.tag)&&e.dom.value===""+o&&(a||e.dom===d(e.dom)))return;if("select"===e.tag&&null!==n&&e.dom.value===""+o)return;if("option"===e.tag&&null!==n&&e.dom.value===""+o)return;if(a&&""+o!="")return void console.error("`value` is read-only on file inputs!")}"input"===e.tag&&"type"===r?e.dom.setAttribute(r,o):e.dom[r]=o}else"boolean"==typeof o?o?e.dom.setAttribute(r,""):e.dom.removeAttribute(r):e.dom.setAttribute("className"===r?"class":r,o)}}function O(e,t,r,n){if("key"!==t&&"is"!==t&&null!=r&&!q(t))if("o"===t[0]&&"n"===t[1])R(e,t,void 0);else if("style"===t)L(e.dom,r,null);else if(!I(e,t,n)||"className"===t||"title"===t||"value"===t&&("option"===e.tag||"select"===e.tag&&-1===e.dom.selectedIndex&&e.dom===d(e.dom))||"input"===e.tag&&"type"===t){var o=t.indexOf(":");-1!==o&&(t=t.slice(o+1)),!1!==r&&e.dom.removeAttribute("className"===t?"class":t)}else e.dom[t]=null}function q(e){return"oninit"===e||"oncreate"===e||"onupdate"===e||"onremove"===e||"onbeforeremove"===e||"onbeforeupdate"===e}function I(e,t,r){return void 0===r&&(e.tag.indexOf("-")>-1||null!=e.attrs&&e.attrs.is||"href"!==t&&"list"!==t&&"form"!==t&&"width"!==t&&"height"!==t)&&t in e.dom}function L(e,r,n){if(r===n);else if(null==n)e.style="";else if("object"!==t(n))e.style=n;else if(null==r||"object"!==t(r))for(var o in e.style.cssText="",n){null!=(i=n[o])&&(o.includes("-")?e.style.setProperty(o,String(i)):e.style[o]=String(i))}else{for(var o in n){var i;null!=(i=n[o])&&(i=String(i))!==String(r[o])&&(o.includes("-")?e.style.setProperty(o,i):e.style[o]=i)}for(var o in r)null!=r[o]&&null==n[o]&&(o.includes("-")?e.style.removeProperty(o):e.style[o]="")}}function j(){this._=r}function R(e,n,o){if(null!=e.events){if(e.events._=r,e.events[n]===o)return;null==o||"function"!=typeof o&&"object"!==t(o)?(null!=e.events[n]&&e.dom.removeEventListener(n.slice(2),e.events,!1),e.events[n]=void 0):(null==e.events[n]&&e.dom.addEventListener(n.slice(2),e.events,!1),e.events[n]=o)}else null==o||"function"!=typeof o&&"object"!==t(o)||(e.events=new j,e.dom.addEventListener(n.slice(2),e.events,!1),e.events[n]=o)}function M(e,t,r){"function"==typeof e.oninit&&f.call(e.oninit,t),"function"==typeof e.oncreate&&r.push(f.bind(e.oncreate,t))}function D(e,t,r){"function"==typeof e.onupdate&&r.push(f.bind(e.onupdate,t))}return j.prototype=Object.create(null),j.prototype.handleEvent=function(e){var t,r=this["on"+e.type];"function"==typeof r?t=r.call(e.currentTarget,e):"function"==typeof r.handleEvent&&r.handleEvent(e),this._&&!1!==e.redraw&&(0,this._)(),!1===t&&(e.preventDefault(),e.stopPropagation())},function(t,n,o){if(!t)throw new TypeError("DOM element being rendered to does not exist.");if(null!=w&&t.contains(w))throw new TypeError("Node is currently being rendered to and thus is locked.");var i=r,s=w,l=[],u=d(t),c=t.namespaceURI;w=t,r="function"==typeof o?o:void 0,a={};try{null==t.vnodes&&(t.textContent=""),n=e.normalizeChildren(Array.isArray(n)?n:[n]),g(t,t.vnodes,n,l,null,"http://www.w3.org/1999/xhtml"===c?void 0:c),t.vnodes=n,null!=u&&d(t)!==u&&"function"==typeof u.focus&&u.focus();for(var f=0;f<l.length;f++)l[f]()}finally{r=i,w=s}}},ee}function $e(){return ne?re:(ne=1,re=Ke()("undefined"!=typeof window?window:null))}function Fe(){if(se)return ae;se=1;var e=$e();return ae=function(){if(ie)return oe;ie=1;var e=je();return oe=function(t,r,n){var o=[],i=!1,a=-1;function s(){for(a=0;a<o.length;a+=2)try{t(o[a],e(o[a+1]),l)}catch(r){n.error(r)}a=-1}function l(){i||(i=!0,r((function(){i=!1,s()})))}return l.sync=s,{mount:function(r,n){if(null!=n&&null==n.view&&"function"!=typeof n)throw new TypeError("m.mount expects a component, not a vnode.");var i=o.indexOf(r);i>=0&&(o.splice(i,2),i<=a&&(a-=2),t(r,[])),null!=n&&(o.push(r,n),t(r,e(n),l))},redraw:l}},oe}()(e,"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:null,"undefined"!=typeof console?console:null),ae}function Qe(){return ue?le:(ue=1,le=function(e){if("[object Object]"!==Object.prototype.toString.call(e))return"";var t=[];for(var r in e)n(r,e[r]);return t.join("&");function n(e,r){if(Array.isArray(r))for(var o=0;o<r.length;o++)n(e+"["+o+"]",r[o]);else if("[object Object]"===Object.prototype.toString.call(r))for(var o in r)n(e+"["+o+"]",r[o]);else t.push(encodeURIComponent(e)+(null!=r&&""!==r?"="+encodeURIComponent(r):""))}})}function Be(){if(fe)return ce;fe=1;var e=Qe();return ce=function(t,r){if(/:([^\/\.-]+)(\.{3})?:/.test(t))throw new SyntaxError("Template parameter names must be separated by either a '/', '-', or '.'.");if(null==r)return t;var n=t.indexOf("?"),o=t.indexOf("#"),i=o<0?t.length:o,a=n<0?i:n,s=t.slice(0,a),l={};Object.assign(l,r);var u=s.replace(/:([^\/\.-]+)(\.{3})?/g,(function(e,t,n){return delete l[t],null==r[t]?e:n?r[t]:encodeURIComponent(String(r[t]))})),c=u.indexOf("?"),f=u.indexOf("#"),d=f<0?u.length:f,h=c<0?d:c,p=u.slice(0,h);n>=0&&(p+=t.slice(n,i)),c>=0&&(p+=(n<0?"?":"&")+u.slice(c,d));var v=e(l);return v&&(p+=(n<0&&c<0?"?":"&")+v),o>=0&&(p+=t.slice(o)),f>=0&&(p+=(o<0?"":"&")+u.slice(f)),p},ce}function Ge(){if(he)return de;he=1;var e=Be(),t=Me();return de=function(r,n){function o(e){return new Promise(e)}function i(e,r){for(var n in e.headers)if(t.call(e.headers,n)&&n.toLowerCase()===r)return!0;return!1}return o.prototype=Promise.prototype,o.__proto__=Promise,{request:function(a,s){"string"!=typeof a?(s=a,a=a.url):null==s&&(s={});var l=function(n,o){return new Promise((function(a,s){n=e(n,o.params);var l,u=null!=o.method?o.method.toUpperCase():"GET",c=o.body,f=(null==o.serialize||o.serialize===JSON.serialize)&&!(c instanceof r.FormData||c instanceof r.URLSearchParams),d=o.responseType||("function"==typeof o.extract?"":"json"),h=new r.XMLHttpRequest,p=!1,v=!1,m=h,g=h.abort;for(var b in h.abort=function(){p=!0,g.call(this)},h.open(u,n,!1!==o.async,"string"==typeof o.user?o.user:void 0,"string"==typeof o.password?o.password:void 0),f&&null!=c&&!i(o,"content-type")&&h.setRequestHeader("Content-Type","application/json; charset=utf-8"),"function"==typeof o.deserialize||i(o,"accept")||h.setRequestHeader("Accept","application/json, text/*"),o.withCredentials&&(h.withCredentials=o.withCredentials),o.timeout&&(h.timeout=o.timeout),h.responseType=d,o.headers)t.call(o.headers,b)&&h.setRequestHeader(b,o.headers[b]);h.onreadystatechange=function(e){if(!p&&4===e.target.readyState)try{var t,r=e.target.status>=200&&e.target.status<300||304===e.target.status||/^file:\/\//i.test(n),i=e.target.response;if("json"===d){if(!e.target.responseType&&"function"!=typeof o.extract)try{i=JSON.parse(e.target.responseText)}catch(c){i=null}}else d&&"text"!==d||null==i&&(i=e.target.responseText);if("function"==typeof o.extract?(i=o.extract(e.target,o),r=!0):"function"==typeof o.deserialize&&(i=o.deserialize(i)),r){if("function"==typeof o.type)if(Array.isArray(i))for(var l=0;l<i.length;l++)i[l]=new o.type(i[l]);else i=new o.type(i);a(i)}else{var u=function(){try{t=e.target.responseText}catch(c){t=i}var r=new Error(t);r.code=e.target.status,r.response=i,s(r)};0===h.status?setTimeout((function(){v||u()})):u()}}catch(c){s(c)}},h.ontimeout=function(e){v=!0;var t=new Error("Request timed out");t.code=e.target.status,s(t)},"function"==typeof o.config&&(h=o.config(h,o,n)||h)!==m&&(l=h.abort,h.abort=function(){p=!0,l.call(this)}),null==c?h.send():"function"==typeof o.serialize?h.send(o.serialize(c)):c instanceof r.FormData||c instanceof r.URLSearchParams?h.send(c):h.send(JSON.stringify(c))}))}(a,s);if(!0===s.background)return l;var u=0;function c(){0==--u&&"function"==typeof n&&n()}return function e(t){var r=t.then;return t.constructor=o,t.then=function(){u++;var n=r.apply(t,arguments);return n.then(c,(function(e){if(c(),0===u)throw e})),e(n)},t}(l)}}},de}function He(){if(ve)return pe;ve=1;var e=Fe();return pe=Ge()("undefined"!=typeof window?window:null,e.redraw)}function We(){if(ge)return me;function e(e){try{return decodeURIComponent(e)}catch(t){return e}}return ge=1,me=function(t){if(""===t||null==t)return{};"?"===t.charAt(0)&&(t=t.slice(1));for(var r=t.split("&"),n={},o={},i=0;i<r.length;i++){var a=r[i].split("="),s=e(a[0]),l=2===a.length?e(a[1]):"";"true"===l?l=!0:"false"===l&&(l=!1);var u=s.split(/\]\[?|\[/),c=o;s.indexOf("[")>-1&&u.pop();for(var f=0;f<u.length;f++){var d=u[f],h=u[f+1],p=""==h||!isNaN(parseInt(h,10));if(""===d)null==n[s=u.slice(0,f).join()]&&(n[s]=Array.isArray(c)?c.length:0),d=n[s]++;else if("__proto__"===d)break;if(f===u.length-1)c[d]=l;else{var v=Object.getOwnPropertyDescriptor(c,d);null!=v&&(v=v.value),null==v&&(c[d]=v=p?[]:{}),c=v}}}return o}}function Ye(){if(ye)return be;ye=1;var e=We();return be=function(t){var r=t.indexOf("?"),n=t.indexOf("#"),o=n<0?t.length:n,i=r<0?o:r,a=t.slice(0,i).replace(/\/{2,}/g,"/");return a?"/"!==a[0]&&(a="/"+a):a="/",{path:a,params:r<0?{}:e(t.slice(r+1,o))}}}function Xe(){if(_e)return we;_e=1;var e=Ye();return we=function(t){var r=e(t),n=Object.keys(r.params),o=[],i=new RegExp("^"+r.path.replace(/:([^\/.-]+)(\.{3}|\.(?!\.)|-)?|[\\^$*+.()|\[\]{}]/g,(function(e,t,r){return null==t?"\\"+e:(o.push({k:t,r:"..."===r}),"..."===r?"(.*)":"."===r?"([^/]+)\\.":"([^/]+)"+(r||""))}))+"$");return function(e){for(var t=0;t<n.length;t++)if(r.params[n[t]]!==e.params[n[t]])return!1;if(!o.length)return i.test(e.path);var a=i.exec(e.path);if(null==a)return!1;for(t=0;t<o.length;t++)e.params[o[t].k]=o[t].r?a[t+1]:decodeURIComponent(a[t+1]);return!0}},we}function Je(){if(xe)return ke;xe=1;var e=Me(),t=new RegExp("^(?:key|oninit|oncreate|onbeforeupdate|onupdate|onbeforeremove|onremove)$");return ke=function(r,n){var o={};if(null!=n)for(var i in r)e.call(r,i)&&!t.test(i)&&n.indexOf(i)<0&&(o[i]=r[i]);else for(var i in r)e.call(r,i)&&!t.test(i)&&(o[i]=r[i]);return o}}function Ve(){if(Ae)return Ce;Ae=1;var e=Fe();return Ce=function(){if(Ee)return Se;Ee=1;var e=je(),r=De(),n=Be(),o=Ye(),i=Xe(),a=Je(),s={};function l(e){try{return decodeURIComponent(e)}catch(t){return e}}return Se=function(u,c){var f,d,h,p,v,m,g=null==u?null:"function"==typeof u.setImmediate?u.setImmediate:u.setTimeout,b=Promise.resolve(),y=!1,w=!1,_=0,k=s,x={onbeforeupdate:function(){return!(!(_=_?2:1)||s===k)},onremove:function(){u.removeEventListener("popstate",C,!1),u.removeEventListener("hashchange",E,!1)},view:function(){if(_&&s!==k){var t=[e(h,p.key,p)];return k&&(t=k.render(t[0])),t}}},S=P.SKIP={};function E(){y=!1;var e=u.location.hash;"#"!==P.prefix[0]&&(e=u.location.search+e,"?"!==P.prefix[0]&&"/"!==(e=u.location.pathname+e)[0]&&(e="/"+e));var t=e.concat().replace(/(?:%[a-f89][a-f0-9])+/gim,l).slice(P.prefix.length),r=o(t);function n(e){console.error(e),A(d,null,{replace:!0})}Object.assign(r.params,u.history.state),function e(o){for(;o<f.length;o++)if(f[o].check(r)){var i=f[o].component,a=f[o].route,s=i,l=m=function(n){if(l===m){if(n===S)return e(o+1);h=null==n||"function"!=typeof n.view&&"function"!=typeof n?"div":n,p=r.params,v=t,m=null,k=i.render?i:null,2===_?c.redraw():(_=2,c.redraw.sync())}};return void(i.view||"function"==typeof i?(i={},l(s)):i.onmatch?b.then((function(){return i.onmatch(r.params,t,a)})).then(l,t===d?null:n):l("div"))}if(t===d)throw new Error("Could not resolve default route "+d+".");A(d,null,{replace:!0})}(0)}function C(){y||(y=!0,g(E))}function A(e,t,r){if(e=n(e,t),w){C();var o=r?r.state:null,i=r?r.title:null;r&&r.replace?u.history.replaceState(o,i,P.prefix+e):u.history.pushState(o,i,P.prefix+e)}else u.location.href=P.prefix+e}function P(e,t,r){if(!e)throw new TypeError("DOM element being rendered to does not exist.");if(f=Object.keys(r).map((function(e){if("/"!==e[0])throw new SyntaxError("Routes must start with a '/'.");if(/:([^\/\.-]+)(\.{3})?:/.test(e))throw new SyntaxError("Route parameter names must be separated with either '/', '.', or '-'.");return{route:e,component:r[e],check:i(e)}})),d=t,null!=t){var n=o(t);if(!f.some((function(e){return e.check(n)})))throw new ReferenceError("Default route doesn't match any known routes.")}"function"==typeof u.history.pushState?u.addEventListener("popstate",C,!1):"#"===P.prefix[0]&&u.addEventListener("hashchange",E,!1),w=!0,c.mount(e,x),E()}return P.set=function(e,t,r){null!=m&&((r=r||{}).replace=!0),m=null,A(e,t,r)},P.get=function(){return v},P.prefix="#!",P.Link={view:function(e){var o,i,s,l=r(e.attrs.selector||"a",a(e.attrs,["options","params","selector","onclick"]),e.children);return(l.attrs.disabled=Boolean(l.attrs.disabled))?(l.attrs.href=null,l.attrs["aria-disabled"]="true"):(o=e.attrs.options,i=e.attrs.onclick,s=n(l.attrs.href,e.attrs.params),l.attrs.href=P.prefix+s,l.attrs.onclick=function(e){var r;"function"==typeof i?r=i.call(e.currentTarget,e):null==i||"object"!==t(i)||"function"==typeof i.handleEvent&&i.handleEvent(e),!1===r||e.defaultPrevented||0!==e.button&&0!==e.which&&1!==e.which||e.currentTarget.target&&"_self"!==e.currentTarget.target||e.ctrlKey||e.metaKey||e.shiftKey||e.altKey||(e.preventDefault(),e.redraw=!1,P.set(s,null,o))}),l}},P.param=function(e){return p&&null!=e?p[e]:p},P},Se}()("undefined"!=typeof window?window:null,e),Ce}var Ze=function(){if(Ne)return Pe;Ne=1;var e=ze(),t=He(),r=Fe(),n=Ue(),o=function(){return e.apply(this,arguments)};return o.m=e,o.trust=e.trust,o.fragment=e.fragment,o.Fragment="[",o.mount=r.mount,o.route=Ve(),o.render=$e(),o.redraw=r.redraw,o.request=t.request,o.parseQueryString=We(),o.buildQueryString=Qe(),o.parsePathname=Ye(),o.buildPathname=Be(),o.vnode=je(),o.censor=Je(),o.domFor=n.domFor,Pe=o}(),et=Le(Ze);!function(){var e=window.jQuery,r="abcdefgh".split(""),n="1.8.3",o=_("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"),i={};function a(e,t,r){function n(){o=0,i&&(i=!1,s())}var o=0,i=!1,a=[],s=function(){o=window.setTimeout(n,t),e.apply(r,a)};return function(e){a=arguments,o?i=!0:s()}}function s(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,(function(e){return(16*Math.random()|0).toString(16)}))}function l(e){return JSON.parse(JSON.stringify(e))}function u(e){var t=e.split(".");return{major:parseInt(t[0],10),minor:parseInt(t[1],10),patch:parseInt(t[2],10)}}function c(e,t){for(var r in t)if(t.hasOwnProperty(r))for(var n="{"+r+"}",o=t[r];-1!==e.indexOf(n);)e=e.replace(n,o);return e}function f(e){return"string"==typeof e}function d(e){return"function"==typeof e}function h(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}function p(e){return"fast"===e||"slow"===e||!!h(e)&&0<=e}function v(e){if(!f(e))return!1;var t=e.split("-");return 2===t.length&&m(t[0])&&m(t[1])}function m(e){return f(e)&&-1!==e.search(/^[a-h][1-8]$/)}function g(e){return f(e)&&-1!==e.search(/^[bw][KQRNBP]$/)}function b(e){if(!f(e))return!1;var t=(e=function(e){return e.replace(/8/g,"11111111").replace(/7/g,"1111111").replace(/6/g,"111111").replace(/5/g,"11111").replace(/4/g,"1111").replace(/3/g,"111").replace(/2/g,"11")}(e=e.replace(/ .+$/,""))).split("/");if(8!==t.length)return!1;for(var r=0;r<8;r++)if(8!==t[r].length||-1!==t[r].search(/[^kqrnbpKQRNBP1]/))return!1;return!0}function y(t){if(!e.isPlainObject(t))return!1;for(var r in t)if(t.hasOwnProperty(r)&&(!m(r)||!g(t[r])))return!1;return!0}function w(){return t(window.$)&&e.fn&&e.fn.jquery&&function(e,t){e=u(e),t=u(t);var r=1e5*e.major*1e5+1e5*e.minor+e.patch;return 1e5*t.major*1e5+1e5*t.minor+t.patch<=r}(e.fn.jquery,n)}function _(e){if(!b(e))return!1;for(var t,n=(e=e.replace(/ .+$/,"")).split("/"),o={},i=8,a=0;a<8;a++){for(var s=n[a].split(""),l=0,u=0;u<s.length;u++)-1!==s[u].search(/[1-8]/)?l+=parseInt(s[u],10):(o[r[l]+i]=(t=s[u]).toLowerCase()===t?"b"+t.toUpperCase():"w"+t.toUpperCase(),l+=1);i-=1}return o}function k(e){if(!y(e))return!1;for(var t,n="",o=8,i=0;i<8;i++){for(var a=0;a<8;a++){var s=r[a]+o;e.hasOwnProperty(s)?n+=(t=void 0,"w"===(t=e[s].split(""))[0]?t[1].toUpperCase():t[1].toLowerCase()):n+="1"}7!==i&&(n+="/"),o-=1}return function(e){return e.replace(/11111111/g,"8").replace(/1111111/g,"7").replace(/111111/g,"6").replace(/11111/g,"5").replace(/1111/g,"4").replace(/111/g,"3").replace(/11/g,"2")}(n)}function x(e,t,n){for(var o=function(e){for(var t=[],n=0;n<8;n++)for(var o=0;o<8;o++){var i=r[n]+(o+1);e!==i&&t.push({square:i,distance:(a=e,s=i,l=a.split(""),u=r.indexOf(l[0])+1,c=parseInt(l[1],10),f=s.split(""),d=r.indexOf(f[0])+1,h=parseInt(f[1],10),p=Math.abs(u-d),v=Math.abs(c-h),v<=p?p:v)})}var a,s,l,u,c,f,d,h,p,v;t.sort((function(e,t){return e.distance-t.distance}));var m=[];for(n=0;n<t.length;n++)m.push(t[n].square);return m}(n),i=0;i<o.length;i++){var a=o[i];if(e.hasOwnProperty(a)&&e[a]===t)return a}return!1}function S(e){return"black"!==e.orientation&&(e.orientation="white"),!1!==e.showNotation&&(e.showNotation=!0),!0!==e.draggable&&(e.draggable=!1),"trash"!==e.dropOffBoard&&(e.dropOffBoard="snapback"),!0!==e.sparePieces&&(e.sparePieces=!1),e.sparePieces&&(e.draggable=!0),e.hasOwnProperty("pieceTheme")&&(f(e.pieceTheme)||d(e.pieceTheme))||(e.pieceTheme="img/chesspieces/wikipedia/{piece}.png"),p(e.appearSpeed)||(e.appearSpeed=200),p(e.moveSpeed)||(e.moveSpeed=200),p(e.snapbackSpeed)||(e.snapbackSpeed=60),p(e.snapSpeed)||(e.snapSpeed=30),p(e.trashSpeed)||(e.trashSpeed=100),function(e){return h(e)&&1<=e}(e.dragThrottleRate)||(e.dragThrottleRate=20),e}i.alpha="alpha-d2270",i.black="black-3c85d",i.board="board-b72b1",i.chessboard="chessboard-63f37",i.clearfix="clearfix-7da63",i.highlight1="highlight1-32417",i.highlight2="highlight2-9c5d2",i.notation="notation-322f9",i.numeric="numeric-fc462",i.piece="piece-417db",i.row="row-5277c",i.sparePieces="spare-pieces-7492f",i.sparePiecesBottom="spare-pieces-bottom-ae20f",i.sparePiecesTop="spare-pieces-top-4028b",i.square="square-55d63",i.white="white-1e1d7",window.Chessboard=function(n,u){if(!function(){if(w())return!0;return window.alert("Chessboard Error 1005: Unable to find a valid version of jQuery. Please include jQuery 1.8.3 or higher on the page\n\nExiting…"),!1}())return null;var h=function(t){if(""===t){return window.alert("Chessboard Error 1001: The first argument to Chessboard() cannot be an empty string.\n\nExiting…"),!1}f(t)&&"#"!==t.charAt(0)&&(t="#"+t);var r=e(t);if(1===r.length)return r;return window.alert("Chessboard Error 1003: The first argument to Chessboard() must be the ID of a DOM node, an ID query selector, or a single DOM node.\n\nExiting…"),!1}(n);if(!h)return null;u=S(u=function(t){return"start"===t?t={position:l(o)}:b(t)?t={position:_(t)}:y(t)&&(t={position:l(t)}),e.isPlainObject(t)||(t={}),t}(u));var p=null,g=null,E=null,C=null,A={},P=2,N="white",T={},O=null,q=null,I=null,L=!1,j={},R={},M={},D=16;function z(e,r,n){if(!0===u.hasOwnProperty("showErrors")&&!1!==u.showErrors){var o="Chessboard Error "+e+": "+r;return"console"===u.showErrors&&"object"==("undefined"==typeof console?"undefined":t(console))&&"function"==typeof console.log?(console.log(o),void(2<=arguments.length&&console.log(n))):"alert"===u.showErrors?(n&&(o+="\n\n"+JSON.stringify(n)),void window.alert(o)):void(d(u.showErrors)&&u.showErrors(e,r,n))}}function U(e){return d(u.pieceTheme)?u.pieceTheme(e):f(u.pieceTheme)?c(u.pieceTheme,{piece:e}):(z(8272,"Unable to build image source for config.pieceTheme."),"")}function K(e,t,r){var n='<img src="'+U(e)+'" ';return f(r)&&""!==r&&(n+='id="'+r+'" '),n+='alt="" class="{piece}" data-piece="'+e+'" style="width:'+D+"px;height:"+D+"px;",t&&(n+="display:none;"),c(n+='" />',i)}function $(e){var t=["wK","wQ","wR","wB","wN","wP"];"black"===e&&(t=["bK","bQ","bR","bB","bN","bP"]);for(var r="",n=0;n<t.length;n++)r+=K(t[n],!1,j[t[n]]);return r}function F(t,r,n,o){var a=e("#"+R[t]),l=a.offset(),c=e("#"+R[r]),f=c.offset(),h=s();e("body").append(K(n,!0,h));var p=e("#"+h);p.css({display:"",position:"absolute",top:l.top,left:l.left}),a.find("."+i.piece).remove();var v={duration:u.moveSpeed,complete:function(){c.append(K(n)),p.remove(),d(o)&&o()}};p.animate(f,v)}function Q(t,r,n){var o=e("#"+j[t]).offset(),a=e("#"+R[r]),l=a.offset(),c=s();e("body").append(K(t,!0,c));var f=e("#"+c);f.css({display:"",position:"absolute",left:o.left,top:o.top});var h={duration:u.moveSpeed,complete:function(){a.find("."+i.piece).remove(),a.append(K(t)),f.remove(),d(n)&&n()}};f.animate(l,h)}function B(){for(var t in p.find("."+i.piece).remove(),T)T.hasOwnProperty(t)&&e("#"+R[t]).append(K(T[t]))}function G(){p.html(function(e){"black"!==e&&(e="white");var t="",n=l(r),o=8;"black"===e&&(n.reverse(),o=1);for(var a="white",s=0;s<8;s++){t+='<div class="{row}">';for(var f=0;f<8;f++){var d=n[f]+o;t+='<div class="{square} '+i[a]+" square-"+d+'" style="width:'+D+"px;height:"+D+'px;" id="'+R[d]+'" data-square="'+d+'">',u.showNotation&&(("white"===e&&1===o||"black"===e&&8===o)&&(t+='<div class="{notation} {alpha}">'+n[f]+"</div>"),0===f&&(t+='<div class="{notation} {numeric}">'+o+"</div>")),t+="</div>",a="white"===a?"black":"white"}t+='<div class="{clearfix}"></div></div>',a="white"===a?"black":"white","white"===e?o-=1:o+=1}return c(t,i)}(N,u.showNotation)),B(),u.sparePieces&&("white"===N?(E.html($("black")),C.html($("white"))):(E.html($("white")),C.html($("black"))))}function H(e){var t=l(T),r=l(e);k(t)!==k(r)&&(d(u.onChange)&&u.onChange(t,r),T=e)}function W(e,t){for(var r in M)if(M.hasOwnProperty(r)){var n=M[r];if(e>=n.left&&e<n.left+D&&t>=n.top&&t<n.top+D)return r}return"offboard"}function Y(){p.find("."+i.square).removeClass(i.highlight1+" "+i.highlight2)}function X(){Y();var e=l(T);delete e[I],H(e),B(),g.fadeOut(u.trashSpeed),L=!1}function J(t,r,n,o){d(u.onDragStart)&&!1===u.onDragStart(t,r,l(T),N)||(L=!0,O=r,q="spare"===(I=t)?"offboard":t,function(){for(var t in M={},R)R.hasOwnProperty(t)&&(M[t]=e("#"+R[t]).offset())}(),g.attr("src",U(r)).css({display:"",position:"absolute",left:n-D/2,top:o-D/2}),"spare"!==t&&e("#"+R[t]).addClass(i.highlight1).find("."+i.piece).css("display","none"))}function V(t,r){g.css({left:t-D/2,top:r-D/2});var n=W(t,r);n!==q&&(m(q)&&e("#"+R[q]).removeClass(i.highlight2),m(n)&&e("#"+R[n]).addClass(i.highlight2),d(u.onDragMove)&&u.onDragMove(n,q,I,O,l(T),N),q=n)}function Z(t){var r="drop";if("offboard"===t&&"snapback"===u.dropOffBoard&&(r="snapback"),"offboard"===t&&"trash"===u.dropOffBoard&&(r="trash"),d(u.onDrop)){var n=l(T);"spare"===I&&m(t)&&(n[t]=O),m(I)&&"offboard"===t&&delete n[I],m(I)&&m(t)&&(delete n[I],n[t]=O);var o=l(T),i=u.onDrop(I,t,O,n,o,N);"snapback"!==i&&"trash"!==i||(r=i)}"snapback"===r?function(){if("spare"!==I){Y();var t=e("#"+R[I]).offset(),r={duration:u.snapbackSpeed,complete:function(){B(),g.css("display","none"),d(u.onSnapbackEnd)&&u.onSnapbackEnd(O,I,l(T),N)}};g.animate(t,r),L=!1}else X()}():"trash"===r?X():"drop"===r&&function(t){Y();var r=l(T);delete r[I],r[t]=O,H(r);var n=e("#"+R[t]).offset(),o={duration:u.snapSpeed,complete:function(){B(),g.css("display","none"),d(u.onSnapEnd)&&u.onSnapEnd(I,t,O)}};g.animate(n,o),L=!1}(t)}function ee(e){e.preventDefault()}function te(t){if(u.draggable){var r=e(this).attr("data-square");m(r)&&T.hasOwnProperty(r)&&J(r,T[r],t.pageX,t.pageY)}}function re(t){if(u.draggable){var r=e(this).attr("data-square");m(r)&&T.hasOwnProperty(r)&&(t=t.originalEvent,J(r,T[r],t.changedTouches[0].pageX,t.changedTouches[0].pageY))}}function ne(t){u.sparePieces&&J("spare",e(this).attr("data-piece"),t.pageX,t.pageY)}function oe(t){u.sparePieces&&J("spare",e(this).attr("data-piece"),(t=t.originalEvent).changedTouches[0].pageX,t.changedTouches[0].pageY)}A.clear=function(e){A.position({},e)},A.destroy=function(){h.html(""),g.remove(),h.unbind()},A.fen=function(){return A.position("fen")},A.flip=function(){return A.orientation("flip")},A.move=function(){if(0!==arguments.length){for(var e=!0,t={},r=0;r<arguments.length;r++)if(!1!==arguments[r])if(v(arguments[r])){var n=arguments[r].split("-");t[n[0]]=n[1]}else z(2826,"Invalid move passed to the move method.",arguments[r]);else e=!1;var o=function(e,t){var r=l(e);for(var n in t)if(t.hasOwnProperty(n)&&r.hasOwnProperty(n)){var o=r[n];delete r[n],r[t[n]]=o}return r}(T,t);return A.position(o,e),o}},A.orientation=function(e){return 0===arguments.length?N:"white"===e||"black"===e?(N=e,G(),N):"flip"===e?(N="white"===N?"black":"white",G(),N):void z(5482,"Invalid value passed to the orientation method.",e)},A.position=function(t,r){return 0===arguments.length?l(T):f(t)&&"fen"===t.toLowerCase()?k(T):(f(t)&&"start"===t.toLowerCase()&&(t=l(o)),b(t)&&(t=_(t)),void(y(t)?(!1!==r&&(r=!0),r?(function(t,r,n){if(0!==t.length)for(var o=0,a=0;a<t.length;a++){var s=t[a];"clear"===s.type?e("#"+R[s.square]+" ."+i.piece).fadeOut(u.trashSpeed,c):"add"!==s.type||u.sparePieces?"add"===s.type&&u.sparePieces?Q(s.piece,s.square,c):"move"===s.type&&F(s.source,s.destination,s.piece,c):e("#"+R[s.square]).append(K(s.piece,!0)).find("."+i.piece).fadeIn(u.appearSpeed,c)}function c(){(o+=1)===t.length&&(B(),d(u.onMoveEnd)&&u.onMoveEnd(l(r),l(n)))}}(function(e,t){e=l(e),t=l(t);var r=[],n={};for(var o in t)t.hasOwnProperty(o)&&e.hasOwnProperty(o)&&e[o]===t[o]&&(delete e[o],delete t[o]);for(o in t)if(t.hasOwnProperty(o)){var i=x(e,t[o],o);i&&(r.push({type:"move",source:i,destination:o,piece:t[o]}),delete e[i],delete t[o],n[o]=!0)}for(o in t)t.hasOwnProperty(o)&&(r.push({type:"add",square:o,piece:t[o]}),delete t[o]);for(o in e)e.hasOwnProperty(o)&&(n.hasOwnProperty(o)||(r.push({type:"clear",square:o,piece:e[o]}),delete e[o]));return r}(T,t),T,t),H(t)):(H(t),B())):z(6482,"Invalid value passed to the position method.",t)))},A.resize=function(){D=function(){var e=parseInt(h.width(),10);if(!e||e<=0)return 0;for(var t=e-1;t%8!=0&&0<t;)t-=1;return t/8}(),p.css("width",8*D+"px"),g.css({height:D,width:D}),u.sparePieces&&h.find("."+i.sparePieces).css("paddingLeft",D+P+"px"),G()},A.start=function(e){A.position("start",e)};var ie=a((function(e){L&&V(e.pageX,e.pageY)}),u.dragThrottleRate),ae=a((function(e){L&&(e.preventDefault(),V(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))}),u.dragThrottleRate);function se(e){L&&Z(W(e.pageX,e.pageY))}function le(e){L&&Z(W(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))}function ue(t){if(!L&&d(u.onMouseoverSquare)){var r=e(t.currentTarget).attr("data-square");if(m(r)){var n=!1;T.hasOwnProperty(r)&&(n=T[r]),u.onMouseoverSquare(r,n,l(T),N)}}}function ce(t){if(!L&&d(u.onMouseoutSquare)){var r=e(t.currentTarget).attr("data-square");if(m(r)){var n=!1;T.hasOwnProperty(r)&&(n=T[r]),u.onMouseoutSquare(r,n,l(T),N)}}}return N=u.orientation,u.hasOwnProperty("position")&&("start"===u.position?T=l(o):b(u.position)?T=_(u.position):y(u.position)?T=l(u.position):z(7263,"Invalid value passed to config.position.",u.position)),function(){!function(){for(var e=0;e<r.length;e++)for(var t=1;t<=8;t++){var n=r[e]+t;R[n]=n+"-"+s()}var o="KQRNBP".split("");for(e=0;e<o.length;e++){var i="w"+o[e],a="b"+o[e];j[i]=i+"-"+s(),j[a]=a+"-"+s()}}(),h.html(function(e){var t='<div class="{chessboard}">';return e&&(t+='<div class="{sparePieces} {sparePiecesTop}"></div>'),t+='<div class="{board}"></div>',e&&(t+='<div class="{sparePieces} {sparePiecesBottom}"></div>'),c(t+="</div>",i)}(u.sparePieces)),p=h.find("."+i.board),u.sparePieces&&(E=h.find("."+i.sparePiecesTop),C=h.find("."+i.sparePiecesBottom));var t=s();e("body").append(K("wP",!0,t)),g=e("#"+t),P=parseInt(p.css("borderLeftWidth"),10),A.resize()}(),function(){e("body").on("mousedown mousemove","."+i.piece,ee),p.on("mousedown","."+i.square,te),h.on("mousedown","."+i.sparePieces+" ."+i.piece,ne),p.on("mouseenter","."+i.square,ue).on("mouseleave","."+i.square,ce);var t=e(window);t.on("mousemove",ie).on("mouseup",se),"ontouchstart"in document.documentElement&&(p.on("touchstart","."+i.square,re),h.on("touchstart","."+i.sparePieces+" ."+i.piece,oe),t.on("touchmove",ae).on("touchend",le))}(),A},window.ChessBoard=window.Chessboard,window.Chessboard.fenToObj=_,window.Chessboard.objToFen=k}();var tt=void 0,rt={view:function(){$("#root").css("align-items","");var e=et("div#game",[et("h3.sub",[et("div.tag.white",qe(Oe.whiteName))," Vs. ",et("div.tag.black",qe(Oe.blackName))]),et("div#board"),et("h3.sub",nt())]),t="w"===Oe.game.turn()?Oe.whiteAddr:Oe.blackAddr;return Oe.inReplayMode||(Oe.surrenderAddr||Oe.game.isGameOver()?e.children.push(et("a",{class:"btn",onclick:function(){return function(){Oe.inReplayMode=!0;var e=Oe.game.history();Oe.game.reset(),Oe.board.position("start"),ot();var t=0;function r(){setTimeout((function(){Oe.game.move(e[t]),Oe.board.position(Oe.game.fen()),et.redraw(),++t<e.length?r():(Oe.inReplayMode=!1,et.redraw())}),1500)}r()}()}},"Replay"),et("br"),et("a",{class:"btn",onclick:function(){return Oe.game.header("White",Oe.whiteName,"Black",Oe.blackName),void window.webxdc.sendToChat({file:{name:"game.pgn",plainText:Oe.game.pgn()},text:Ie()})}},"Share")):window.webxdc.selfAddr===t&&e.children.push(et("a",{class:"btn",onclick:function(){return function(){if(Oe.surrenderAddr)return void console.log("Warning: ignoring call to surrender()");Oe.surrenderAddr=window.webxdc.selfAddr;var e=Ie(),t={payload:{surrenderAddr:window.webxdc.selfAddr},info:e,summary:e,notify:{"*":e}};window.webxdc.sendUpdate(t,"")}()}},"Surrender"))),e},oncreate:function(){this.initBoard()},setHighlight:function(){ot(),Oe.lastMove&&(tt.find(".square-"+Oe.lastMove.from).addClass("highlight-lastmove"),tt.find(".square-"+Oe.lastMove.to).addClass("highlight-lastmove"))},initBoard:function(){var e=this;tt=$("#board"),Oe.board=Chessboard("board",{draggable:!0,pieceTheme:"img/{piece}.svg",position:Oe.game.fen(),orientation:Oe.blackAddr===window.webxdc.selfAddr?"black":"white",onDragStart:at,onDrop:st,onSnapEnd:this.onSnapEnd.bind(this),showErrors:"console"}),this.setHighlight(),$(window).resize((function(){Oe.board.resize(),e.setHighlight()}))},onSnapEnd:function(){Oe.board.position(Oe.game.fen()),this.setHighlight()}};function nt(){var e,t="w"===Oe.game.turn()?et("div.tag.white",qe(Oe.whiteName)):et("div.tag.black",qe(Oe.blackName));if(Oe.game.isCheckmate())e=["Game over, ",t," is in checkmate, ","b"===Oe.game.turn()?et("div.tag.white",qe(Oe.whiteName)):et("div.tag.black",qe(Oe.blackName))," wins"];else if(Oe.surrenderAddr&&!Oe.inReplayMode){e=["Game over, ",t," surrenders, ","b"===Oe.game.turn()?et("div.tag.white",qe(Oe.whiteName)):et("div.tag.black",qe(Oe.blackName))," wins"]}else Oe.game.isDraw()?e="Game over, drawn position":(e=["Turn: ",t],Oe.game.inCheck()&&e.push(" (in check)"));return e}function ot(){tt.find(".square-55d63").removeClass("highlight-lastmove")}function it(e){var t=tt.find(".square-"+e);t.css("background",t.hasClass("black-3c85d")?"#696969":"#a9a9a9")}function at(e,t,r,n){if(Oe.inReplayMode||Oe.surrenderAddr||Oe.game.isGameOver())return!1;var o=window.webxdc.selfAddr;if("w"===Oe.game.turn()&&(Oe.whiteAddr!==o||-1!==t.search(/^b/))||"b"===Oe.game.turn()&&(Oe.blackAddr!==o||-1!==t.search(/^w/)))return!1;var i=Oe.game.moves({square:e,verbose:!0});if(0!==i.length){it(e);for(var a=0;a<i.length;a++)it(i[a].to)}}function st(e,t){tt.find(".square-55d63").css("background","");var r={from:e,to:t,promotion:"q"};try{Oe.game.move(r)}catch(s){return"snapback"}Oe.lastMove=r;var o={payload:{move:r},summary:Ie()};if(Oe.game.isGameOver())o.info=o.summary,o.notify={"*":o.info};else{var i="It's your turn"+(Oe.game.inCheck()?" (in check!)":""),a="w"===Oe.game.turn()?Oe.whiteAddr:Oe.blackAddr;o.notify=n({},a,i)}window.webxdc.sendUpdate(o,"")}var lt={view:function(){var e=et("div#home");if(e.children.push(et("img#app-icon",{src:"img/bK.svg"}),et("h1#app-name","Chess Board")),Oe.whiteAddr===window.webxdc.selfAddr)e.children.push(et("h3.sub","Waiting for opponent..."));else{var t;if(Oe.whiteAddr)t=Oe.request?Oe.request.addr===window.webxdc.selfAddr?["Waiting for ",et("div.tag.white",qe(Oe.whiteName))," to accept..."]:[et("div.tag.black",qe(Oe.request.name))," requested to join ",et("div.tag.white",qe(Oe.whiteName))]:[et("div.tag.white",qe(Oe.whiteName))," is waiting for opponent..."],e.children.push(et("h3.sub",t));Oe.request||e.children.push(et("a#join-btn",{class:"btn",onclick:function(){return function(){var e=window.webxdc.selfName,t=window.webxdc.selfAddr;if(Oe.whiteAddr)if(Oe.blackAddr||Oe.whiteAddr===t)console.log("Warning: ignoring call to joinGame()");else{var r=qe(e)+" requested to join game",o={payload:{request:Oe.whiteAddr,addr:t,name:e},info:r,notify:n({},Oe.whiteAddr,r)};window.webxdc.sendUpdate(o,"")}else{var i=qe(e)+" is waiting for an opponent",a={payload:{whiteAddr:t,whiteName:e},info:i,summary:i,notify:{"*":i}};window.webxdc.sendUpdate(a,"")}}()}},Oe.whiteAddr?"Join Game":"Start Game"))}return e}};function ut(e){var t=e.payload;if(t.move)if(Oe.board&&e.serial===e.max_serial){var r=Oe.lastMove||{};r.from===t.move.from&&r.to===t.move.to||(Oe.game.move(t.move),Oe.lastMove=t.move,Oe.board.position(Oe.game.fen()),rt.setHighlight())}else Oe.game.move(t.move),Oe.lastMove=t.move;else t.surrenderAddr?Oe.surrenderAddr=t.surrenderAddr:t.whiteAddr&&!Oe.whiteAddr?(Oe.whiteAddr=t.whiteAddr,Oe.whiteName=t.whiteName):!Oe.request&&t.request&&t.request===Oe.whiteAddr?Oe.request=t:t.blackAddr&&!Oe.blackAddr&&(Oe.blackAddr=t.blackAddr,Oe.blackName=t.blackName);if(e.serial===e.max_serial){if(!Oe.blackAddr&&Oe.request&&window.webxdc.selfAddr===Oe.whiteAddr){Oe.blackAddr=Oe.request.addr,Oe.blackName=Oe.request.name;var n=qe(Oe.whiteName),o=qe(Oe.blackName),i="Game started! ".concat(n," 🆚 ").concat(o),a={payload:{blackAddr:Oe.blackAddr,blackName:Oe.blackName},info:i,summary:Ie(),notify:{"*":i}};window.webxdc.sendUpdate(a,"")}et.redraw()}}onload=function(){et.mount(document.getElementById("root"),{view:function(){return et(Oe.blackAddr?rt:lt)}}),window.webxdc.setUpdateListener(ut,0)}}}}))}();
